

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/Xbox%20L.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Luo QI">
  <meta name="keywords" content="">
  
    <meta name="description" content="æ‘˜è¦">
<meta property="og:type" content="article">
<meta property="og:title" content="ChatGPTé—®ç­”åŠ©æ‰‹">
<meta property="og:url" content="https://varcel.luoqi.icu/2024/01/12/ChatGPT%E9%97%AE%E7%AD%94%E5%8A%A9%E6%89%8B/index.html">
<meta property="og:site_name" content="è½»æ¾çš„æ´›äº“">
<meta property="og:description" content="æ‘˜è¦">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/wallpaper1705067456487.jpg">
<meta property="article:published_time" content="2024-01-12T15:46:44.000Z">
<meta property="article:modified_time" content="2024-01-12T15:46:44.000Z">
<meta property="article:author" content="Luo QI">
<meta property="article:tag" content="project">
<meta property="article:tag" content="java">
<meta property="article:tag" content="chatgpt">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/wallpaper1705067456487.jpg">
  
  
  
  <title>ChatGPTé—®ç­”åŠ©æ‰‹ - è½»æ¾çš„æ´›äº“</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"varcel.luoqi.icu","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  <meta name="baidu-site-verification" content="codeva-Oq0KOjHuD3" />
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>è½»æ¾çš„æ´›äº“</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/wallpaper1705067456487.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ChatGPTé—®ç­”åŠ©æ‰‹"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-12 15:46" pubdate>
          2024å¹´1æœˆ12æ—¥ ä¸‹åˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          20k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          170 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ChatGPTé—®ç­”åŠ©æ‰‹</h1>
            
            
              <div class="markdown-body">
                
                <p>å‰é¢ä¸€éƒ¨åˆ†å†…å®¹æ˜¯å¼€æºé¡¹ç›® <a target="_blank" rel="noopener" href="https://github.com/fuzhengwei/chatbot-api">https://github.com/fuzhengwei/chatbot-api</a> çš„ä¸€äº›å†…å®¹ï¼Œåé¢æ˜¯å¾®ä¿¡API è°ƒç”¨å’Œ é€šä¹‰åƒé—®çš„éƒ¨åˆ†ä½¿ç”¨ä»‹ç»ã€‚</p>
<p>æœ¬é¡¹ç›®æ¥è‡ªçŸ¥è¯†æ˜Ÿçƒã€Šç å†œä¼šé”ã€‹çš„å¼€æºé¡¹ç›®ã€ChatGPT AI é—®ç­”åŠ©æ‰‹ã€‘</p>
<p>é¡¹ç›®åœ°å€ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://gitcode.net/fuzhengwei/chatbot-api">https://gitcode.net/fuzhengwei/chatbot-api</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/fuzhengwei/chatbot-api">https://github.com/fuzhengwei/chatbot-api</a></li>
</ul>
<p>æœ¬é¡¹ç›®ä½¿ç”¨åˆ°äº†åŸºæœ¬çš„é¡¹ç›®å·¥ç¨‹æ„å»ºã€SpringBootã€DDDæ¶æ„ã€Githubä»“åº“ä½¿ç”¨ã€çˆ¬è™«æ¥å£ã€é•œåƒæ‰“åŒ…ã€Dockerå®¹å™¨éƒ¨ç½²ã€‚</p>
<p>æ„å»ºçš„åŸºæœ¬è¿‡ç¨‹è¿™é‡Œè·³è¿‡ï¼Œè¿›å…¥åˆ°å®é™…ä½¿ç”¨å’Œåˆ†æé˜¶æ®µã€‚</p>
<blockquote>
<p>ä»‹ç»DDDæ¶æ„</p>
</blockquote>
<p>å…ˆä»‹ç»ä¸€ä¸‹ DDD æ¶æ„ï¼ŒDDD æ¶æ„å¯ä»¥æƒ³è±¡ç±»ä¼¼æ˜¯ åœ¨ MVC åˆ†å±‚çš„åŸºç¡€ä¸­å†è¿›è¡Œäº†åˆ†ç±»ï¼Œå°†æœåŠ¡ä¹‹é—´çš„è°ƒç”¨è€¦åˆå‡è½»ã€‚</p>
<p>DDD ï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ–¹æ³•ï¼Œä¸»è¦å…³æ³¨çš„æ˜¯ä¸šåŠ¡é¢†åŸŸå’Œä¸šåŠ¡é€»è¾‘ã€‚å¼ºè°ƒåŸºäºä¸šåŠ¡æ¨¡å‹æ¥æ„å»ºè½¯ä»¶ï¼Œä½¿å¾—è½¯ä»¶èƒ½å¤Ÿæ›´å¥½åœ°åæ˜ å’Œæ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p>
<ul>
<li>å°†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘åˆ’åˆ†ä¸ºä¸åŒçš„é¢†åŸŸï¼Œæ¯ä¸ªé¢†åŸŸä»£è¡¨ä¸€ä¸ªä¸šåŠ¡çš„å­é›†ã€‚</li>
<li>é€šè¿‡ä¸°å¯Œçš„é¢†åŸŸæ¨¡å‹æ¥æ•æ‰ä¸šåŠ¡é¢†åŸŸçš„æ ¸å¿ƒæ¦‚å¿µå’Œé€»è¾‘ã€‚<br> <strong>å®ç°æ–¹å¼</strong>ï¼š</li>
<li>é€šå¸¸åŒ…æ‹¬å®ä½“ï¼ˆEntitiesï¼‰ã€å€¼å¯¹è±¡ï¼ˆValue Objectsï¼‰ã€é¢†åŸŸæœåŠ¡ï¼ˆDomain Servicesï¼‰ã€èšåˆï¼ˆAggregatesï¼‰å’Œä»“å‚¨ï¼ˆRepositoriesï¼‰ç­‰æ¦‚å¿µã€‚</li>
<li>DDD è¿˜å¼ºè°ƒé¢†åŸŸå±‚å’Œåº”ç”¨å±‚çš„åˆ†ç¦»ï¼Œç¡®ä¿ä¸šåŠ¡é€»è¾‘çš„ç‹¬ç«‹æ€§ã€‚<br><strong>ç›®çš„</strong>ï¼š</li>
<li>æä¾›ä¸€ç§æ–¹æ³•è®ºï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œè®¾è®¡å¤æ‚ä¸šåŠ¡ç³»ç»Ÿã€‚</li>
<li>é€šè¿‡é¢†åŸŸæ¨¡å‹çš„ä¸°å¯Œæ€§æ¥æé«˜è½¯ä»¶çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§</li>
</ul>
<p>æ˜Ÿçƒè¯¾ç¨‹å…¥å£ï¼š <a target="_blank" rel="noopener" href="https://wx.zsxq.com/dweb2/index/columns/48411118851818">https://wx.zsxq.com/dweb2/index/columns/48411118851818</a></p>
<p>B ç«™è§†é¢‘åœ°å€ï¼š <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1RR4y1b7UQ">https://www.bilibili.com/video/BV1RR4y1b7UQ</a></p>
<p>å¤§çº²</p>
<ul>
<li>é¡¹ç›®è¿è¡Œ</li>
<li>é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹åˆ†æ</li>
<li>äºŒå¼€ï¼ˆè®¢é˜…å·ä¿¡æ¯å›å¤ï¼‰å®šæ—¶å‘é€æ¶ˆæ¯</li>
<li>æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤</li>
<li>QQæ¶ˆæ¯å›å¤</li>
<li>å°è¯•å›½å†…çš„å¤§è¯­è¨€æ¨¡å‹</li>
</ul>
<h3 id="1ã€é¡¹ç›®è¿è¡Œ"><a href="#1ã€é¡¹ç›®è¿è¡Œ" class="headerlink" title="1ã€é¡¹ç›®è¿è¡Œ"></a>1ã€é¡¹ç›®è¿è¡Œ</h3><p>ä» é¡¹ç›®åœ°å€ <a target="_blank" rel="noopener" href="https://gitcode.net/fuzhengwei/chatbot-api">https://gitcode.net/fuzhengwei/chatbot-api</a>  ï¼›</p>
<h4 id="é¡¹ç›®åŠ è½½"><a href="#é¡¹ç›®åŠ è½½" class="headerlink" title="é¡¹ç›®åŠ è½½"></a>é¡¹ç›®åŠ è½½</h4><p>æ‹‰å–é¡¹ç›®ä»£ç åï¼Œéœ€è¦åœ¨ Maven ä¸‹é¢çš„ Lifecycle ä¸‹å…ˆè¿›è¡Œæ€»ä½“çš„ä¸€ä¸ª clean å† install ï¼›</p>
<p>install å®Œæˆåå†é‡æ–°åŠ è½½ä¸€ä¸‹ä¾èµ–ï¼›</p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240112222113.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>åœ¨è¿›è¡Œä¸Šä¸€æ­¥æ“ä½œçš„æ—¶å€™æœ¬äººå¯¹éƒ¨åˆ†æ¨¡å—å…ˆå¼•ç”¨æ‰“åŒ…åˆ°äº†æœ¬åœ° chatbot-api-commonã€  chatbot-api-domain  ï¼›ä½†è¿™ä¸ªåº”è¯¥ä¸æ˜¯å…³é”®å½±å“å› ç´ ï¼ˆå¯å¿½ç•¥ï¼‰</p>
<h4 id="é¡¹ç›®ç»“æ„åˆ†æ"><a href="#é¡¹ç›®ç»“æ„åˆ†æ" class="headerlink" title="é¡¹ç›®ç»“æ„åˆ†æ"></a>é¡¹ç›®ç»“æ„åˆ†æ</h4><ul>
<li>chatbot-api-application<ul>
<li>ext<ul>
<li>è¿›è¡Œä»»åŠ¡æ³¨å†ŒæœåŠ¡ï¼Œæ”¯æŒå¤šç»„ä»»åŠ¡é…ç½®</li>
</ul>
</li>
<li>job<ul>
<li>å®šä¹‰å®šæ—¶ä»»åŠ¡ï¼Œè¿›è¡Œæ£€ç´¢é—®é¢˜å¹¶è¿›è¡ŒAIå›ç­”ï¼ŒAIå›ç­”åè¿›è¡Œé—®é¢˜å›å¤ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>chatbot-api-common<ul>
<li>å…¬å…±æœåŠ¡</li>
</ul>
</li>
<li>chatbot-api-domain<ul>
<li>é¢†åŸŸæœåŠ¡<ul>
<li>ai<ul>
<li>è°ƒç”¨ openai çš„ chatgpt æ¥å£</li>
</ul>
</li>
<li>zsxq<ul>
<li>queryUnAnsweredQuestionsTopicId  è·å–çŸ¥è¯†æ˜Ÿçƒçš„æœªå›ç­”å†…å®¹</li>
<li>answer   å›å¤çŸ¥è¯†æ˜Ÿçƒçš„æœªå›ç­”å†…å®¹</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>chatbot-api-infrastructure<ul>
<li>èšåˆ</li>
</ul>
</li>
<li>chatbot-api-interface<ul>
<li>å¯åŠ¨ç±»</li>
</ul>
</li>
</ul>
<hr>
<h3 id="2ã€é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹åˆ†æ"><a href="#2ã€é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹åˆ†æ" class="headerlink" title="2ã€é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹åˆ†æ"></a>2ã€é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹åˆ†æ</h3><p>æ ¹æ®è§†é¢‘æ•™ç¨‹å†…å®¹æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªçŸ¥è¯†æ˜Ÿçƒï¼Œè·å–å…¶ä¸­åˆ†æ â€ç­‰æˆ‘å›ç­”ä¸­çš„ä¿¡æ¯â€ï¼Œä¸è¿‡è¿™é‡ŒçŸ¥è¯†æ˜Ÿçƒå®ƒåˆ›å»ºå…è´¹æ˜Ÿçƒæœ‰é™åˆ¶ï¼Œè€Œåˆ›å»ºæ”¶è´¹æ˜Ÿçƒé™åˆ¶æœ€å°‘æ”¶è´¹50ï¼›</p>
<p>ä¸‹é¢ä¸»è¦åˆ†æä¸€ä¸‹å…¶é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹å®ç°æµç¨‹ã€‚</p>
<p>æµ‹è¯•åŒ… cn.bugstack.chatbot.api.test ä¸‹ç±»ApiTest æ–¹æ³•åˆ†æ</p>
<p>è¿™é‡Œå¤§è‡´çš„ä¸€ä¸ªå®ç°æ€è·¯ï¼š</p>
<p>é¦–å…ˆæ˜¯é€šè¿‡æŸ¥è¯¢â€œæœªå›ç­”é—®é¢˜â€çˆ¬å–çŸ¥è¯†æ˜Ÿçƒçš„æ¥å£ä¿¡æ¯ï¼Œç„¶åæ˜¯é€šè¿‡ chatgpt å›å¤ç›¸å…³å†…å®¹ï¼ˆæ¶‰åŠåˆ°ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯å›ç­”çŸ¥è¯†æ˜Ÿçƒçš„ç›¸å…³é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯è°ƒç”¨ openai çš„ chatgpt æ¥å£è¿”å›æ•°æ®ï¼‰</p>
<p>è¿™é‡Œæ¥æ‰§è¡Œå›å¤æ“ä½œæ˜¯é€šè¿‡å®šæ—¶ä»»åŠ¡æ¥è¿›è¡Œæ‰§è¡Œçš„ï¼Œåœ¨æ•™ç¨‹è§†é¢‘ï¼š <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1XR4y1h7JP/">https://www.bilibili.com/video/BV1XR4y1h7JP/</a></p>
<p>æåŠåˆ°äº†ä¸€ä¸ªå¤šç»„ä»»åŠ¡æœåŠ¡é…ç½®çš„æŠ€æœ¯å®ç°ï¼Œæ˜¯é€šè¿‡å°†åŒä¸€å¥—æµç¨‹ä½†ä¸åŒçˆ¬å–æ¥å£æ–¹ï¼ˆæ¯”å¦‚ï¼šçŸ¥è¯†æ˜Ÿçƒçš„å¤šä¸ªç¾¤å¯¹åº”å¤šä¸ªé…ç½®)ï¼›to be continedâ€¦</p>
<h4 id="æŸ¥è¯¢â€œæœªå›ç­”é—®é¢˜â€"><a href="#æŸ¥è¯¢â€œæœªå›ç­”é—®é¢˜â€" class="headerlink" title="æŸ¥è¯¢â€œæœªå›ç­”é—®é¢˜â€"></a>æŸ¥è¯¢â€œæœªå›ç­”é—®é¢˜â€</h4><p>çˆ¬å–çŸ¥è¯†æ˜Ÿçƒçš„æ¥å£ä¿¡æ¯æ“ä½œ</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs csharp">@Test<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">query_unanswered_questions</span>() throws IOException</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ HttpClientBuilder åˆ›å»ºä¸€ä¸ª CloseableHttpClient å®ä¾‹ã€‚</span><br>    CloseableHttpClient httpClient = HttpClientBuilder.create().build();<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª HttpGet è¯·æ±‚å¯¹è±¡ï¼ŒURL æŒ‡å‘çŸ¥è¯†æ˜ŸçƒAPIçš„ç‰¹å®šç«¯ç‚¹ã€‚</span><br>    <span class="hljs-comment">// è¿™ä¸ªç«¯ç‚¹ç”¨äºè·å–æŒ‡å®šç¾¤ç»„ä¸­çš„â€œæœªå›ç­”é—®é¢˜â€ã€‚</span><br>    HttpGet <span class="hljs-keyword">get</span> = <span class="hljs-keyword">new</span> HttpGet(<span class="hljs-string">&quot;https://api.zsxq.com/v2/groups/48411118851818/topics?scope=unanswered_questions&amp;count=20&quot;</span>);<br><br>    <span class="hljs-comment">// æ·»åŠ è¯·æ±‚å¤´ã€‚è¿™é‡Œçš„ &quot;cookie&quot; éœ€è¦æ›¿æ¢ä¸ºæœ‰æ•ˆçš„çŸ¥è¯†æ˜Ÿçƒä¸ªäººcookieä¿¡æ¯ï¼Œç”¨äºèº«ä»½éªŒè¯ã€‚</span><br>    <span class="hljs-keyword">get</span>.addHeader(<span class="hljs-string">&quot;cookie&quot;</span>, <span class="hljs-string">&quot;çŸ¥è¯†æ˜Ÿçƒä¸ªäººcookieä¿¡æ¯&quot;</span>);<br><br>    <span class="hljs-comment">// è®¾ç½®è¯·æ±‚çš„å†…å®¹ç±»å‹ä¸º JSONï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†ä¸º UTF-8ã€‚</span><br>    <span class="hljs-keyword">get</span>.addHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json;charset=utf8&quot;</span>);<br><br>    <span class="hljs-comment">// æ‰§è¡Œ HTTP GET è¯·æ±‚å¹¶è·å–å“åº”ã€‚</span><br>    CloseableHttpResponse response = httpClient.execute(<span class="hljs-keyword">get</span>);<br><br>    <span class="hljs-comment">// æ£€æŸ¥å“åº”çŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç ä¸º 200 (HttpStatus.SC_OK)ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚</span><br>    <span class="hljs-keyword">if</span> (response.getStatusLine().getStatusCode() == HttpStatus.SC_OK) &#123;<br>        <span class="hljs-comment">// å°†å“åº”å®ä½“è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚è¿™é€šå¸¸æ˜¯ JSON æ ¼å¼çš„æ•°æ®ã€‚</span><br>        String res = EntityUtils.toString(response.getEntity());<br>        System.<span class="hljs-keyword">out</span>.println(res);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœçŠ¶æ€ç ä¸æ˜¯ 200ï¼Œæ‰“å°å‡ºçŠ¶æ€ç ã€‚</span><br>        <span class="hljs-comment">// è¿™å¯èƒ½è¡¨æ˜è¯·æ±‚å‡ºé”™æˆ–å…¶ä»–é—®é¢˜ã€‚</span><br>        System.<span class="hljs-keyword">out</span>.println(response.getStatusLine().getStatusCode());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šéœ€è¦æ­£ç¡®è®¾ç½®çŸ¥è¯†æ˜Ÿçƒçš„ä¸ªäººcookieä¿¡æ¯æ‰èƒ½æˆåŠŸå‘èµ·è¯·æ±‚ï¼Œä¿¡æ¯ä»æµè§ˆå™¨çš„F12ä¸­æŸ¥çœ‹ã€‚</p>
<h4 id="å›ç­”ç›¸å…³é—®é¢˜"><a href="#å›ç­”ç›¸å…³é—®é¢˜" class="headerlink" title="å›ç­”ç›¸å…³é—®é¢˜"></a>å›ç­”ç›¸å…³é—®é¢˜</h4><p>ç”¨äºå›ç­”çŸ¥è¯†æ˜Ÿçƒå¹³å°ä¸Šçš„æŸä¸ªç‰¹å®šè¯é¢˜</p>
<figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs wren">@<span class="hljs-title class_">Test</span><br><span class="hljs-variable">public</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">answer</span>() <span class="hljs-variable">throws</span> <span class="hljs-title class_">IOException</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ HttpClientBuilder åˆ›å»ºä¸€ä¸ª CloseableHttpClient å®ä¾‹ã€‚</span><br>    <span class="hljs-title class_">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">HttpClientBuilder</span>.<span class="hljs-property">create</span>().<span class="hljs-property">build</span>();<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª HttpPost è¯·æ±‚å¯¹è±¡ï¼ŒURL æŒ‡å‘çŸ¥è¯†æ˜ŸçƒAPIçš„ç‰¹å®šç«¯ç‚¹ã€‚</span><br>    <span class="hljs-comment">// è¿™ä¸ªç«¯ç‚¹ç”¨äºå›ç­”ä¸€ä¸ªæŒ‡å®šçš„è¯é¢˜ã€‚</span><br>    <span class="hljs-title class_">HttpPost</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">HttpPost</span>(<span class="hljs-string">&quot;https://api.zsxq.com/v2/topics/412884248251548/answer&quot;</span>);<br><br>    <span class="hljs-comment">// æ·»åŠ è¯·æ±‚å¤´ã€‚è¿™é‡Œçš„ &quot;cookie&quot; éœ€è¦æ›¿æ¢ä¸ºæœ‰æ•ˆçš„çŸ¥è¯†æ˜Ÿçƒä¸ªäººcookieä¿¡æ¯ï¼Œç”¨äºèº«ä»½éªŒè¯ã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">addHeader</span>(<span class="hljs-string">&quot;cookie&quot;</span>, <span class="hljs-string">&quot;çŸ¥è¯†æ˜Ÿçƒä¸ªäººcookieä¿¡æ¯&quot;</span>);<br><br>    <span class="hljs-comment">// è®¾ç½®è¯·æ±‚çš„å†…å®¹ç±»å‹ä¸º JSONï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†ä¸º UTF-8ã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">addHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json;charset=utf8&quot;</span>);<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä½œä¸º POST è¯·æ±‚çš„å‚æ•°ã€‚</span><br>    <span class="hljs-comment">// è¿™é‡Œçš„å‚æ•°åŒ…æ‹¬å›ç­”çš„æ–‡æœ¬ã€å›¾ç‰‡IDï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å’Œæ˜¯å¦é™éŸ³ï¼ˆsilencedï¼‰ã€‚</span><br>    <span class="hljs-title class_">String</span> <span class="hljs-variable">paramJson</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;  <span class="hljs-char escape_">\&quot;</span>req_data<span class="hljs-char escape_">\&quot;</span>: &#123;<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;    <span class="hljs-char escape_">\&quot;</span>text<span class="hljs-char escape_">\&quot;</span>: <span class="hljs-char escape_">\&quot;</span>è‡ªå·±å»ç™¾åº¦ï¼<span class="hljs-char escape_">\\</span>n<span class="hljs-char escape_">\&quot;</span>,<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;    <span class="hljs-char escape_">\&quot;</span>image_ids<span class="hljs-char escape_">\&quot;</span>: [],<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;    <span class="hljs-char escape_">\&quot;</span>silenced<span class="hljs-char escape_">\&quot;</span>: false<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;  &#125;<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;&#125;&quot;</span>;<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª StringEntity æ¥å°è£… JSON å‚æ•°ï¼Œè®¾ç½®å…¶å†…å®¹ç±»å‹å’Œç¼–ç ã€‚</span><br>    <span class="hljs-title class_">StringEntity</span> <span class="hljs-variable">stringEntity</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">StringEntity</span>(<span class="hljs-variable">paramJson</span>, <span class="hljs-title class_">ContentType</span>.<span class="hljs-property">create</span>(<span class="hljs-string">&quot;text/json&quot;</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>));<br><br>    <span class="hljs-comment">// å°†å°è£…å¥½çš„å‚æ•°è®¾ç½®åˆ° POST è¯·æ±‚ä¸­ã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">setEntity</span>(<span class="hljs-variable">stringEntity</span>);<br><br>    <span class="hljs-comment">// æ‰§è¡Œ HTTP POST è¯·æ±‚å¹¶è·å–å“åº”ã€‚</span><br>    <span class="hljs-title class_">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-variable">httpClient</span>.<span class="hljs-property">execute</span>(<span class="hljs-variable">post</span>);<br><br>    <span class="hljs-comment">// æ£€æŸ¥å“åº”çŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç ä¸º 200 (HttpStatus.SC_OK)ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">response</span>.<span class="hljs-property">getStatusLine</span>().<span class="hljs-property">getStatusCode</span>() <span class="hljs-operator">==</span> <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">SC_OK</span>) &#123;<br>        <span class="hljs-comment">// å°†å“åº”å®ä½“è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚è¿™é€šå¸¸æ˜¯ JSON æ ¼å¼çš„æ•°æ®ã€‚</span><br>        <span class="hljs-title class_">String</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">EntityUtils</span>.<span class="hljs-property">toString</span>(<span class="hljs-variable">response</span>.<span class="hljs-property">getEntity</span>());<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-property">println</span>(<span class="hljs-variable">res</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœçŠ¶æ€ç ä¸æ˜¯ 200ï¼Œæ‰“å°å‡ºçŠ¶æ€ç ã€‚</span><br>        <span class="hljs-comment">// è¿™å¯èƒ½è¡¨æ˜è¯·æ±‚å‡ºé”™æˆ–å…¶ä»–é—®é¢˜ã€‚</span><br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-property">println</span>(<span class="hljs-variable">response</span>.<span class="hljs-property">getStatusLine</span>().<span class="hljs-property">getStatusCode</span>());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨-ChatGPT-æ¨¡å‹ç”Ÿæˆæ–‡æœ¬"><a href="#ä½¿ç”¨-ChatGPT-æ¨¡å‹ç”Ÿæˆæ–‡æœ¬" class="headerlink" title="ä½¿ç”¨ ChatGPT æ¨¡å‹ç”Ÿæˆæ–‡æœ¬"></a>ä½¿ç”¨ ChatGPT æ¨¡å‹ç”Ÿæˆæ–‡æœ¬</h4><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs wren">@<span class="hljs-title class_">Test</span><br><span class="hljs-variable">public</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">test_chatGPT</span>() <span class="hljs-variable">throws</span> <span class="hljs-title class_">IOException</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ HttpClientBuilder åˆ›å»ºä¸€ä¸ª CloseableHttpClient å®ä¾‹ã€‚</span><br>    <span class="hljs-title class_">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">HttpClientBuilder</span>.<span class="hljs-property">create</span>().<span class="hljs-property">build</span>();<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª HttpPost è¯·æ±‚å¯¹è±¡ï¼ŒURL è®¾ç½®ä¸º OpenAI API çš„åœ°å€ã€‚</span><br>    <span class="hljs-title class_">HttpPost</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">HttpPost</span>(<span class="hljs-string">&quot;https://api.openai.com/v1/completions&quot;</span>);<br><br>    <span class="hljs-comment">// è®¾ç½®è¯·æ±‚å¤´ï¼ŒæŒ‡å®šå†…å®¹ç±»å‹ä¸º JSONã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">addHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>);<br><br>    <span class="hljs-comment">// è®¾ç½®æˆæƒå¤´ã€‚&quot;Bearer è‡ªè¡Œç”³è¯· https://beta.openai.com/overview&quot; éœ€è¦æ›¿æ¢ä¸ºæœ‰æ•ˆçš„æˆæƒä»¤ç‰Œã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">addHeader</span>(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;Bearer è‡ªè¡Œç”³è¯· https://beta.openai.com/overview&quot;</span>);<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª JSON å­—ç¬¦ä¸²ä½œä¸ºè¯·æ±‚ä½“ã€‚è¿™é‡ŒæŒ‡å®šæ¨¡å‹ä¸º &quot;text-davinci-003&quot;ï¼Œ</span><br>    <span class="hljs-comment">// æç¤ºè¯ä¸º &quot;å¸®æˆ‘å†™ä¸€ä¸ªjavaå†’æ³¡æ’åº&quot;ï¼Œæ¸©åº¦è®¾ç½®ä¸º0ï¼ˆç”Ÿæˆæ–‡æœ¬çš„ç¡®å®šæ€§æ›´é«˜ï¼‰ï¼Œ</span><br>    <span class="hljs-comment">// å¹¶ä¸”æœ€å¤§ä»¤ç‰Œæ•°è®¾ç½®ä¸º1024ã€‚</span><br>    <span class="hljs-title class_">String</span> <span class="hljs-variable">paramJson</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;<span class="hljs-char escape_">\&quot;</span>model<span class="hljs-char escape_">\&quot;</span>: <span class="hljs-char escape_">\&quot;</span>text-davinci-003<span class="hljs-char escape_">\&quot;</span>, <span class="hljs-char escape_">\&quot;</span>prompt<span class="hljs-char escape_">\&quot;</span>: <span class="hljs-char escape_">\&quot;</span>å¸®æˆ‘å†™ä¸€ä¸ªjavaå†’æ³¡æ’åº<span class="hljs-char escape_">\&quot;</span>, <span class="hljs-char escape_">\&quot;</span>temperature<span class="hljs-char escape_">\&quot;</span>: 0, <span class="hljs-char escape_">\&quot;</span>max_tokens<span class="hljs-char escape_">\&quot;</span>: 1024&#125;&quot;</span>;<br><br>    <span class="hljs-comment">// å°† JSON å‚æ•°å°è£…åˆ°ä¸€ä¸ª StringEntity å¯¹è±¡ä¸­ï¼Œå¹¶è®¾ç½®å…¶å†…å®¹ç±»å‹å’Œç¼–ç ã€‚</span><br>    <span class="hljs-title class_">StringEntity</span> <span class="hljs-variable">stringEntity</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">StringEntity</span>(<span class="hljs-variable">paramJson</span>, <span class="hljs-title class_">ContentType</span>.<span class="hljs-property">create</span>(<span class="hljs-string">&quot;text/json&quot;</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>));<br><br>    <span class="hljs-comment">// å°†å°è£…å¥½çš„å‚æ•°æ·»åŠ åˆ° POST è¯·æ±‚ä¸­ã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">setEntity</span>(<span class="hljs-variable">stringEntity</span>);<br><br>    <span class="hljs-comment">// æ‰§è¡Œ HTTP POST è¯·æ±‚å¹¶è·å–å“åº”ã€‚</span><br>    <span class="hljs-title class_">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-variable">httpClient</span>.<span class="hljs-property">execute</span>(<span class="hljs-variable">post</span>);<br><br>    <span class="hljs-comment">// æ£€æŸ¥å“åº”çŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç ä¸º 200 (HttpStatus.SC_OK)ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">response</span>.<span class="hljs-property">getStatusLine</span>().<span class="hljs-property">getStatusCode</span>() <span class="hljs-operator">==</span> <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">SC_OK</span>) &#123;<br>        <span class="hljs-comment">// å°†å“åº”å®ä½“è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°ã€‚è¿™é€šå¸¸æ˜¯ JSON æ ¼å¼çš„æ•°æ®ï¼ŒåŒ…å«ç”±æ¨¡å‹ç”Ÿæˆçš„æ–‡æœ¬ã€‚</span><br>        <span class="hljs-title class_">String</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">EntityUtils</span>.<span class="hljs-property">toString</span>(<span class="hljs-variable">response</span>.<span class="hljs-property">getEntity</span>());<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-property">println</span>(<span class="hljs-variable">res</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœçŠ¶æ€ç ä¸æ˜¯ 200ï¼Œæ‰“å°å‡ºçŠ¶æ€ç ã€‚</span><br>        <span class="hljs-comment">// è¿™å¯èƒ½è¡¨æ˜è¯·æ±‚å‡ºé”™æˆ–å…¶ä»–é—®é¢˜ã€‚</span><br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-property">println</span>(<span class="hljs-variable">response</span>.<span class="hljs-property">getStatusLine</span>().<span class="hljs-property">getStatusCode</span>());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="å®šæ—¶ä»»åŠ¡è¿›è¡Œçˆ¬å–é—®é¢˜å¹¶è¿›è¡Œå›å¤"><a href="#å®šæ—¶ä»»åŠ¡è¿›è¡Œçˆ¬å–é—®é¢˜å¹¶è¿›è¡Œå›å¤" class="headerlink" title="å®šæ—¶ä»»åŠ¡è¿›è¡Œçˆ¬å–é—®é¢˜å¹¶è¿›è¡Œå›å¤"></a>å®šæ—¶ä»»åŠ¡è¿›è¡Œçˆ¬å–é—®é¢˜å¹¶è¿›è¡Œå›å¤</h4><p>æ ¸å¿ƒæ–¹æ³•æ˜¯ ChatbotTaskä¸‹é‡å†™çš„ run æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// éšæœºå†³å®šæ˜¯å¦æ‰§è¡Œæ­¤æ¬¡ä»»åŠ¡ã€‚</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextBoolean()) &#123;<br>            logger.info(<span class="hljs-string">&quot;&#123;&#125; éšæœºæ‰“çƒŠä¸­...&quot;</span>, groupName);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// è·å–å½“å‰æ—¶é—´ã€‚</span><br>        <span class="hljs-type">GregorianCalendar</span> <span class="hljs-variable">calendar</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GregorianCalendar</span>();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">hour</span> <span class="hljs-operator">=</span> calendar.get(Calendar.HOUR_OF_DAY);<br><br>        <span class="hljs-comment">// åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨éå·¥ä½œæ—¶é—´ï¼ˆæ™šä¸Š 22 ç‚¹åæˆ–æ—©ä¸Š 7 ç‚¹å‰ï¼‰ã€‚</span><br>        <span class="hljs-keyword">if</span> (hour &gt; <span class="hljs-number">22</span> || hour &lt; <span class="hljs-number">7</span>) &#123;<br>            logger.info(<span class="hljs-string">&quot;&#123;&#125; æ‰“çƒŠæ—¶é—´ä¸å·¥ä½œï¼ŒAI ä¸‹ç­äº†ï¼&quot;</span>, groupName);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 1. æ£€ç´¢é—®é¢˜ï¼šä»æŸ API è·å–æœªå›ç­”çš„é—®é¢˜ã€‚</span><br>        <span class="hljs-type">UnAnsweredQuestionsAggregates</span> <span class="hljs-variable">unAnsweredQuestionsAggregates</span> <span class="hljs-operator">=</span> zsxqApi.queryUnAnsweredQuestionsTopicId(groupId, cookie);<br>        logger.info(<span class="hljs-string">&quot;&#123;&#125; æ£€ç´¢ç»“æœï¼š&#123;&#125;&quot;</span>, groupName, JSON.toJSONString(unAnsweredQuestionsAggregates));<br>        List&lt;Topics&gt; topics = unAnsweredQuestionsAggregates.getResp_data().getTopics();<br><br>        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ£€ç´¢åˆ°æœªå›ç­”çš„é—®é¢˜ã€‚</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == topics || topics.isEmpty()) &#123;<br>            logger.info(<span class="hljs-string">&quot;&#123;&#125; æœ¬æ¬¡æ£€ç´¢æœªæŸ¥è¯¢åˆ°å¾…ä¼šç­”é—®é¢˜&quot;</span>, groupName);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 2. AI å›ç­”ï¼šä½¿ç”¨ AIï¼ˆå¯èƒ½æ˜¯ ChatGPT æˆ–ç±»ä¼¼æœåŠ¡ï¼‰æ¥ç”Ÿæˆå›ç­”ã€‚</span><br>        <span class="hljs-type">Topics</span> <span class="hljs-variable">topic</span> <span class="hljs-operator">=</span> topics.get(topics.size() - <span class="hljs-number">1</span>); <span class="hljs-comment">// å–æœ€åä¸€ä¸ªé—®é¢˜è¿›è¡Œå›ç­”ã€‚</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">answer</span> <span class="hljs-operator">=</span> openAI.doChatGPT(openAiKey, topic.getQuestion().getText().trim());<br><br>        <span class="hljs-comment">// 3. é—®é¢˜å›å¤ï¼šå°† AI ç”Ÿæˆçš„å›ç­”å‘é€å› APIã€‚</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> zsxqApi.answer(groupId, cookie, topic.getTopic_id(), answer, silenced);<br>        logger.info(<span class="hljs-string">&quot;&#123;&#125; ç¼–å·ï¼š&#123;&#125; é—®é¢˜ï¼š&#123;&#125; å›ç­”ï¼š&#123;&#125; çŠ¶æ€ï¼š&#123;&#125;&quot;</span>, groupName, topic.getTopic_id(), topic.getQuestion().getText(), answer, status);<br><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        <span class="hljs-comment">// è®°å½•ä»»ä½•å¼‚å¸¸ã€‚</span><br>        logger.error(<span class="hljs-string">&quot;&#123;&#125; è‡ªåŠ¨å›ç­”é—®é¢˜å¼‚å¸¸&quot;</span>, groupName, e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="å¤šç»„ä»»åŠ¡é…ç½®æ“ä½œ"><a href="#å¤šç»„ä»»åŠ¡é…ç½®æ“ä½œ" class="headerlink" title="å¤šç»„ä»»åŠ¡é…ç½®æ“ä½œ"></a>å¤šç»„ä»»åŠ¡é…ç½®æ“ä½œ</h4><p>TaskRegistrarAutoConfig é…ç½®ç±», è¿™ä¸ªç±»æ˜¯ç”¨äºé…ç½®å’Œå®‰æ’ä¸€ç³»åˆ—çš„å®šæ—¶ä»»åŠ¡</p>
<p>ä¸‹é¢æ˜¯å…¶ä¸­çš„ä¸¤ä¸ªæ–¹æ³•çš„è¯´æ˜å’Œé˜è¿°ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setEnvironment</span>(<span class="hljs-params">Environment environment</span>) &#123;<br>    <span class="hljs-comment">// è®¾ç½®é…ç½®å‰ç¼€ã€‚</span><br>    <span class="hljs-title class_">String</span> prefix = <span class="hljs-string">&quot;chatbot-api.&quot;</span>;<br><br>    <span class="hljs-comment">// ä»ç¯å¢ƒå˜é‡ä¸­è·å–é…ç½®é¡¹ &#x27;chatbot-api.launchList&#x27;ã€‚</span><br>    <span class="hljs-title class_">String</span> launchListStr = environment.<span class="hljs-title function_">getProperty</span>(prefix + <span class="hljs-string">&quot;launchList&quot;</span>);<br><br>    <span class="hljs-comment">// å¦‚æœé…ç½®é¡¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å›ã€‚</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isEmpty</span>(launchListStr)) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-comment">// åˆ†å‰²é…ç½®å­—ç¬¦ä¸²ï¼Œéå†æ¯ä¸ªç»„é”®ã€‚</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> groupKey : launchListStr.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;,&quot;</span>)) &#123;<br>        <span class="hljs-comment">// æ ¹æ®ç»„é”®è·å–ç›¸å…³çš„ä»»åŠ¡ç»„å±æ€§ã€‚</span><br>        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; taskGroupProps = <span class="hljs-title class_">PropertyUtil</span>.<span class="hljs-title function_">handle</span>(environment, prefix + groupKey, <span class="hljs-title class_">Map</span>.<span class="hljs-property">class</span>);<br><br>        <span class="hljs-comment">// å°†ä»»åŠ¡ç»„å±æ€§å­˜å‚¨åœ¨ taskGroupMap ä¸­ã€‚</span><br>        taskGroupMap.<span class="hljs-title function_">put</span>(groupKey, taskGroupProps);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ä»åº”ç”¨ç¨‹åºçš„ç¯å¢ƒå˜é‡ä¸­è¯»å–ä»»åŠ¡é…ç½®ã€‚</li>
<li>å°†é…ç½®å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ï¼Œåˆ†ç»„é”®ï¼‰åˆ†å‰²å¹¶éå†æ¯ä¸ªåˆ†ç»„ã€‚</li>
<li>å¯¹äºæ¯ä¸ªåˆ†ç»„é”®ï¼Œè·å–å…¶ç›¸å…³å±æ€§å¹¶å­˜å‚¨åœ¨ <code>taskGroupMap</code> ä¸­ã€‚</li>
</ul>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Override</span><br>public <span class="hljs-keyword">void</span> configureTasks(ScheduledTaskRegistrar taskRegistrar) &#123;<br>    <span class="hljs-comment">// è·å–æ‰€æœ‰ä»»åŠ¡ç»„çš„é”®é›†ã€‚</span><br>    <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; taskGroups = taskGroupMap.keySet();<br><br>    <span class="hljs-comment">// éå†æ¯ä¸ªä»»åŠ¡ç»„çš„é”®ã€‚</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">String</span> groupKey : taskGroups) &#123;<br>        <span class="hljs-comment">// è·å–æ¯ä¸ªä»»åŠ¡ç»„çš„é…ç½®ã€‚</span><br>        <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt; taskGroup = taskGroupMap.<span class="hljs-keyword">get</span>(groupKey);<br><br>        <span class="hljs-comment">// ä»é…ç½®ä¸­æå–ä»»åŠ¡ç›¸å…³ä¿¡æ¯ã€‚</span><br>        <span class="hljs-built_in">String</span> groupName = taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;groupName&quot;</span>).toString();<br>        <span class="hljs-built_in">String</span> groupId = taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;groupId&quot;</span>).toString();<br>        <span class="hljs-built_in">String</span> cookie = taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;cookie&quot;</span>).toString();<br>        <span class="hljs-built_in">String</span> openAiKey = taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;openAiKey&quot;</span>).toString();<br>        <span class="hljs-built_in">String</span> cronExpressionBase64 = taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;cronExpression&quot;</span>).toString();<br><br>        <span class="hljs-comment">// è§£ç  Base64 ç¼–ç çš„ cron è¡¨è¾¾å¼ã€‚</span><br>        <span class="hljs-built_in">String</span> cronExpression = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(Base64.getDecoder().decode(cronExpressionBase64), StandardCharsets.UTF_8);<br><br>        <span class="hljs-comment">// è·å–æ˜¯å¦é™éŸ³çš„å¸ƒå°”å€¼ã€‚</span><br>        boolean silenced = Boolean.parseBoolean(taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;silenced&quot;</span>).toString());<br><br>        <span class="hljs-comment">// è®°å½•æ—¥å¿—ä¿¡æ¯ã€‚</span><br>        logger.info(<span class="hljs-string">&quot;åˆ›å»ºä»»åŠ¡ groupNameï¼š&#123;&#125; groupIdï¼š&#123;&#125; cronExpressionï¼š&#123;&#125;&quot;</span>, groupName, groupId, cronExpression);<br><br>        <span class="hljs-comment">// æ·»åŠ å®šæ—¶ä»»åŠ¡ã€‚</span><br>        taskRegistrar.addCronTask(<span class="hljs-keyword">new</span> ChatbotTask(groupName, groupId, cookie, openAiKey, zsxqApi, openAI, silenced), cronExpression);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>é…ç½®å’Œå®‰æ’å®šæ—¶ä»»åŠ¡ã€‚</li>
<li>éå†ä¹‹å‰åœ¨ <code>setEnvironment</code> æ–¹æ³•ä¸­è®¾ç½®çš„ä»»åŠ¡ç»„ã€‚</li>
<li>ä»æ¯ä¸ªä»»åŠ¡ç»„é…ç½®ä¸­æå–å¿…è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»»åŠ¡åç§°ã€ç¾¤ç»„ IDã€cookieã€OpenAI å¯†é’¥ã€cron è¡¨è¾¾å¼å’Œé™éŸ³æ ‡å¿—ã€‚</li>
<li>å¯¹ Base64 ç¼–ç çš„ cron è¡¨è¾¾å¼è¿›è¡Œè§£ç ã€‚</li>
<li>åˆ›å»ºå¹¶å®‰æ’æ¯ä¸ªä»»åŠ¡ï¼Œä½¿ç”¨æå–çš„ä¿¡æ¯åˆå§‹åŒ– <code>ChatbotTask</code> å¹¶å°†å…¶æ·»åŠ åˆ° <code>ScheduledTaskRegistrar</code>ã€‚</li>
</ul>
<h4 id="é¡¹ç›®è¿è¡Œ-ğŸ¦…ğŸ¦…"><a href="#é¡¹ç›®è¿è¡Œ-ğŸ¦…ğŸ¦…" class="headerlink" title="é¡¹ç›®è¿è¡Œ ğŸ¦…ğŸ¦…"></a>é¡¹ç›®è¿è¡Œ ğŸ¦…ğŸ¦…</h4><p>ä¸ªäººå……å€¼ openai çš„ key å­˜åœ¨é—®é¢˜ï¼Œè¿™é‡Œæ˜¯ä½¿ç”¨æ·˜å®ç¬¬ä¸‰æ–¹è´­ä¹°çš„ apikey</p>
<p>to  be continedâ€¦.</p>
<h3 id="3ã€äºŒå¼€ï¼ˆè®¢é˜…å·ä¿¡æ¯å›å¤ï¼‰å®šæ—¶å‘é€æ¶ˆæ¯"><a href="#3ã€äºŒå¼€ï¼ˆè®¢é˜…å·ä¿¡æ¯å›å¤ï¼‰å®šæ—¶å‘é€æ¶ˆæ¯" class="headerlink" title="3ã€äºŒå¼€ï¼ˆè®¢é˜…å·ä¿¡æ¯å›å¤ï¼‰å®šæ—¶å‘é€æ¶ˆæ¯"></a>3ã€äºŒå¼€ï¼ˆè®¢é˜…å·ä¿¡æ¯å›å¤ï¼‰å®šæ—¶å‘é€æ¶ˆæ¯</h3><p>æœ‰ä¸€ä¸ªå…¬ä¼—å·å®šæ—¶æ¨é€çš„å¼€æºé¡¹ç›®ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ï¼š  <a target="_blank" rel="noopener" href="https://gitee.com/love_c/wechatPush?_from=gitee_searc">https://gitee.com/love_c/wechatPush?_from=gitee_searc</a></p>
<p>å¾®ä¿¡å…¬ä¼—å·å›å¤çš„åšå®¢ï¼š <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1641549">https://cloud.tencent.com/developer/article/1641549</a></p>
<p>å…¶åšå®¢å†…å®¹çš„ä»£ç åœ°å€ï¼š <a target="_blank" rel="noopener" href="https://github.com/tsmyk0715/wechatproject">https://github.com/tsmyk0715/wechatproject</a> ï¼ˆè¿™ä¸ªé¡¹ç›®è¿˜æ˜¯å››å¹´å‰çš„é¡¹ç›®ï¼‰</p>
<p>å°è¯•åç»­ä½¿ç”¨ä¸€ä¸‹ WxJava è¿™ä¸ªå¼€æºé¡¹ç›®çš„ç›¸å…³å†…å®¹ ï¼š <a target="_blank" rel="noopener" href="https://gitee.com/binary/weixin-java-tools">https://gitee.com/binary/weixin-java-tools</a></p>
<hr>
<p>å®é™…è¿è¡Œçš„æ—¶å€™å‘ç°è¿™é‡Œçš„æ¥å£å‚æ•°è¿˜æ˜¯éœ€è¦ä½¿ç”¨æµ‹è¯•å·ï¼Œå¦‚æœä½¿ç”¨ä¸ªäººå·çš„è¯æœ‰æƒé™é™åˆ¶ï¼Œå¾®ä¿¡å¾ˆå¤šæ¥å£ä¸èƒ½ä½¿ç”¨ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚æˆ–è€…ä»¥åæœ‰æœºä¼šæ‹¥æœ‰è‡ªå·±çš„æœåŠ¡å·ã€‚</p>
<p>æµ‹è¯•å·ç”³è¯·åœ°å€ï¼š <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login">https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login</a></p>
<h4 id="å®šåˆ¶åŒ–å‘é€æ¶ˆæ¯æ¨¡æ¿"><a href="#å®šåˆ¶åŒ–å‘é€æ¶ˆæ¯æ¨¡æ¿" class="headerlink" title="å®šåˆ¶åŒ–å‘é€æ¶ˆæ¯æ¨¡æ¿"></a>å®šåˆ¶åŒ–å‘é€æ¶ˆæ¯æ¨¡æ¿</h4><p>wechatPush è¿™ä¸ªå¼€æºé¡¹ç›®ä¸­ä¸»è¦çš„å·¥å…·ç±»æ˜¯ï¼š PushUtil</p>
<p>è¿™é‡Œè¿›è¡Œéƒ¨åˆ†åˆ†æï¼Œè¯¥å·¥å…·ç±» PushUtil ä¸‹ çš„ push æ–¹æ³•æ˜¯ å®šä¹‰äº†ä¸€ä¸ªå¾®ä¿¡æ¶ˆæ¯æ¨é€çš„æ–¹æ³•ã€‚å®ƒåˆ›å»ºå’Œå‘é€å®šåˆ¶åŒ–çš„æ¨¡æ¿æ¶ˆæ¯ç»™ç‰¹å®šçš„ç”¨æˆ·</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¶ˆæ¯æ¨é€ä¸»è¦ä¸šåŠ¡ä»£ç </span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">push</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª CloseableHttpClient å®ä¾‹ã€‚</span><br>    <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClientBuilder.create().build();<br><br>    <span class="hljs-comment">// æ„å»ºå¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯ã€‚</span><br>    <span class="hljs-type">WxMpTemplateMessage</span> <span class="hljs-variable">templateMessage</span> <span class="hljs-operator">=</span> WxMpTemplateMessage.builder()<br>            .templateId(PushConfigure.getTemplateId())<br>            .build();<br><br>    <span class="hljs-comment">// è®¡ç®—ä¸ç‰¹å®šæ—¥æœŸç›¸å…³çš„å¤©æ•°ï¼Œä¾‹å¦‚æ‹çˆ±çºªå¿µæ—¥ã€‚</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">loveDays</span> <span class="hljs-operator">=</span> MemoryDayUtil.calculationLianAi(PushConfigure.getLoveDate());<br><br>    <span class="hljs-comment">// è®¡ç®—è·ç¦»ç”Ÿæ—¥çš„å¤©æ•°ã€‚</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">birthdays</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (PushConfigure.isUseLunar()) &#123;<br>        <span class="hljs-comment">// å¦‚æœä½¿ç”¨å†œå†ç”Ÿæ—¥ï¼Œè°ƒç”¨ç›¸åº”æ–¹æ³•è®¡ç®—ã€‚</span><br>        birthdays = MemoryDayUtil.calculationBirthdayByLunar(PushConfigure.getBirthday());<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨é˜³å†ç”Ÿæ—¥è®¡ç®—ã€‚</span><br>        birthdays = MemoryDayUtil.calculationBirthday(PushConfigure.getBirthday());<br>    &#125;<br><br>    <span class="hljs-comment">// å‘æ¨¡æ¿æ¶ˆæ¯æ·»åŠ ç›¸å…³æ•°æ®ã€‚</span><br>    templateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">&quot;loveDays&quot;</span>, loveDays + <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;#FF1493&quot;</span>));<br>    templateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">&quot;birthdays&quot;</span>, birthdays + <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;#FFA500&quot;</span>));<br><br>    <span class="hljs-comment">// è·å–å¤©æ°”æ•°æ®ã€‚</span><br>    <span class="hljs-type">Result</span> <span class="hljs-variable">weatherResult</span> <span class="hljs-operator">=</span> WeatherUtil.getWeather();<br>    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">messageAll</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br><br>    <span class="hljs-comment">// å¤„ç†å¤©æ°”æ•°æ®ã€‚</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;0&quot;</span>.equals(weatherResult.getCode())) &#123;<br>        <span class="hljs-comment">// å¦‚æœè·å–å¤©æ°”æ•°æ®å¤±è´¥ï¼Œè®°å½•å¤±è´¥ä¿¡æ¯ã€‚</span><br>        messageAll.append(<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>);<br>        messageAll.append(weatherResult.getMessage());<br>        templateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">&quot;weather&quot;</span>, <span class="hljs-string">&quot;***&quot;</span>, <span class="hljs-string">&quot;#00FFFF&quot;</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœæˆåŠŸè·å–å¤©æ°”æ•°æ®ï¼Œæå–å¹¶æ·»åŠ åˆ°æ¨¡æ¿æ¶ˆæ¯ä¸­ã€‚</span><br>        <span class="hljs-type">Weather</span> <span class="hljs-variable">weather</span> <span class="hljs-operator">=</span> (Weather) weatherResult.getData();<br>        <span class="hljs-comment">// åˆå§‹åŒ–å†œå†æ—¥æœŸå·¥å…·ç±»ã€‚</span><br>        <span class="hljs-type">LunarCalendarFestivalUtils</span> <span class="hljs-variable">festival</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LunarCalendarFestivalUtils</span>();<br>        festival.initLunarCalendarInfo(weather.getDate());<br><br>        <span class="hljs-comment">// å‘æ¨¡æ¿æ¶ˆæ¯ä¸­æ·»åŠ å„ç§å¤©æ°”å’Œæ—¥æœŸä¿¡æ¯ã€‚</span><br>        <span class="hljs-comment">// ... (ä»£ç çœç•¥)</span><br><br>        <span class="hljs-comment">// å¤©è¡Œæ•°æ®æ¥å£è°ƒç”¨ã€‚</span><br>        <span class="hljs-type">Result</span> <span class="hljs-variable">rainbowResult</span> <span class="hljs-operator">=</span> RainbowUtil.getRainbow();<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;200&quot;</span>.equals(rainbowResult.getCode())) &#123;<br>            <span class="hljs-comment">// å¦‚æœå¤©è¡Œæ•°æ®æ¥å£è°ƒç”¨å¤±è´¥ï¼Œè®°å½•å¤±è´¥ä¿¡æ¯ã€‚</span><br>            messageAll.append(<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>);<br>            messageAll.append(rainbowResult.getMessage());<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// æˆåŠŸè·å–å¤©è¡Œæ•°æ®ï¼Œæ·»åŠ åˆ°æ¨¡æ¿æ¶ˆæ¯ã€‚</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> (String) rainbowResult.getData();<br>            data = data.replaceAll(<span class="hljs-string">&quot;\r|\n&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>            templateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">&quot;rainbow&quot;</span>, data, <span class="hljs-string">&quot;#FF69B4&quot;</span>));<br>        &#125;<br><br>        <span class="hljs-comment">// æ ¹æ®ä¸åŒçš„æ—¥æœŸæ¡ä»¶æ·»åŠ å¤‡æ³¨ä¿¡æ¯ã€‚</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">remark</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;â¤&quot;</span>;<br>        <span class="hljs-comment">// ... (å¤„ç†ç‰¹å®šæ—¥æœŸé€»è¾‘çš„ä»£ç )</span><br><br>        templateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">&quot;remark&quot;</span>, remark, <span class="hljs-string">&quot;#FF1493&quot;</span>));<br><br>        <span class="hljs-comment">// è¾“å‡ºæ¨¡æ¿æ¶ˆæ¯çš„ JSON è¡¨ç¤ºã€‚</span><br>        System.out.println(templateMessage.toJson());<br><br>        <span class="hljs-comment">// è·å–å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯æœåŠ¡ã€‚</span><br>        <span class="hljs-type">WxMpTemplateMsgService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> getService();<br><br>        <span class="hljs-comment">// è®°å½•å‘é€æˆåŠŸå’Œå¤±è´¥çš„è®¡æ•°ã€‚</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">suc</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">err</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (String userId : PushConfigure.getUserId()) &#123;<br>            templateMessage.setToUser(userId);<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// å‘é€æ¨¡æ¿æ¶ˆæ¯ã€‚</span><br>                service.sendTemplateMsg(templateMessage);<br>                suc += <span class="hljs-number">1</span>;<br>            &#125; <span class="hljs-keyword">catch</span> (WxErrorException e) &#123;<br>                <span class="hljs-comment">// å¦‚æœå‘é€å¤±è´¥ï¼Œè®°å½•å¤±è´¥ä¿¡æ¯ã€‚</span><br>	            err += <span class="hljs-number">1</span>;<br>	            messageAll.append(suc).append(<span class="hljs-string">&quot;ä¸ªæˆåŠŸ!&quot;</span>);<br>	            messageAll.append(err).append(<span class="hljs-string">&quot;ä¸ªå¤±è´¥!&quot;</span>);<br>	            messageAll.append(<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>);<br>	            messageAll.append(e.getMessage());<br>	            <span class="hljs-comment">// è¿”å›æ¨é€ç»“æœã€‚</span><br>	            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ¨é€ç»“æœ:&quot;</span> + messageAll;<br>	        &#125;<br>	    &#125;<br><br>	    <span class="hljs-comment">// å¦‚æœæ‰€æœ‰æ¶ˆæ¯å‘é€å®Œæ¯•ï¼Œè¿”å›æˆåŠŸæ¨é€çš„ç”¨æˆ·æ•°é‡å’Œæ¶ˆæ¯ã€‚</span><br>	    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æˆåŠŸæ¨é€ç»™&quot;</span> + suc + <span class="hljs-string">&quot;ä¸ªç”¨æˆ·!&quot;</span> + messageAll;<br>&#125;<br></code></pre></td></tr></table></figure>


<p>åŠŸèƒ½æ¦‚è¿°ï¼š</p>
<ul>
<li>æ­¤æ–¹æ³•ä¸»è¦ç”¨äºæ„å»ºå’Œå‘é€å®šåˆ¶åŒ–çš„å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯ã€‚</li>
<li>å®ƒåŒ…å«å¯¹æ‹çˆ±çºªå¿µæ—¥å’Œç”Ÿæ—¥çš„è®¡ç®—ï¼Œè·å–å¤©æ°”ä¿¡æ¯ï¼Œä»¥åŠè°ƒç”¨å¤©è¡Œæ•°æ®æ¥å£ã€‚</li>
<li>æ¶ˆæ¯çš„å†…å®¹æ ¹æ®ç‰¹å®šçš„æ—¥æœŸæ¡ä»¶è¿›è¡Œå®šåˆ¶ã€‚</li>
<li>æœ€åï¼Œè¯¥æ–¹æ³•é€šè¿‡å¾®ä¿¡å…¬ä¼—å·å¹³å°çš„ API å‘é€æ¶ˆæ¯ç»™æŒ‡å®šçš„ç”¨æˆ·åˆ—è¡¨ã€‚</li>
</ul>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>éœ€è¦æœ‰æ•ˆçš„å¾®ä¿¡å…¬ä¼—å·é…ç½®ä¿¡æ¯ï¼Œå¦‚æ¨¡æ¿ ID å’Œç”¨æˆ· IDã€‚</li>
<li><code>PushConfigure</code> ç±»ä¸­åº”åŒ…å«æ‰€æœ‰ç›¸å…³çš„é…ç½®ä¿¡æ¯ã€‚</li>
<li>å¤©æ°”ä¿¡æ¯å’Œå¤©è¡Œæ•°æ®æ¥å£çš„å®ç°ç»†èŠ‚æ²¡æœ‰åœ¨ä»£ç ä¸­ç»™å‡ºï¼Œéœ€è¦å•ç‹¬å®ç°ã€‚</li>
<li>å¼‚å¸¸å¤„ç†ç”¨äºæ•è·å’Œè®°å½•æ¶ˆæ¯å‘é€è¿‡ç¨‹ä¸­çš„é”™è¯¯ã€‚</li>
<li>æ­¤æ–¹æ³•åœ¨æˆåŠŸå‘é€æ‰€æœ‰æ¶ˆæ¯åï¼Œè¿”å›ä¸€ä¸ªæ±‡æ€»çš„ç»“æœå­—ç¬¦ä¸²ã€‚</li>
</ul>
<h4 id="å¾®ä¿¡æ¶ˆæ¯æ¨é€"><a href="#å¾®ä¿¡æ¶ˆæ¯æ¨é€" class="headerlink" title="å¾®ä¿¡æ¶ˆæ¯æ¨é€"></a>å¾®ä¿¡æ¶ˆæ¯æ¨é€</h4><p>çœ‹äº†ä¸€ä¸‹è°ƒç”¨å…³ç³»ï¼Œå…¶ä¸­æ ¸å¿ƒæ–¹æ³•æ˜¯ï¼š executeInternal</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> &lt;T, E&gt; <span class="hljs-function">T <span class="hljs-title">executeInternal</span><span class="hljs-params">(RequestExecutor&lt;T, E&gt; executor, String uri, E data)</span> <span class="hljs-keyword">throws</span> WxErrorException </span>&#123;<br>    <span class="hljs-comment">// å¤„ç†æ—¥å¿—ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è„±æ•ã€‚</span><br>    E dataForLog = DataUtils.handleDataWithSecret(data);<br><br>    <span class="hljs-comment">// æ£€æŸ¥ URI æ˜¯å¦é”™è¯¯åœ°åŒ…å« access_tokenï¼Œå¦‚æœåŒ…å«åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span><br>    <span class="hljs-keyword">if</span> (uri.contains(<span class="hljs-string">&quot;access_token=&quot;</span>)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;uriå‚æ•°ä¸­ä¸å…è®¸æœ‰access_token: &quot;</span> + uri);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// è·å– access tokenï¼Œå¹¶æ„é€ å¸¦æœ‰ access token çš„å®Œæ•´ URIã€‚</span><br>        String accessToken = <span class="hljs-keyword">this</span>.getAccessToken(<span class="hljs-keyword">false</span>);<br>        String uriWithAccessToken = uri + (uri.contains(<span class="hljs-string">&quot;?&quot;</span>) ? <span class="hljs-string">&quot;&amp;&quot;</span> : <span class="hljs-string">&quot;?&quot;</span>) + <span class="hljs-string">&quot;access_token=&quot;</span> + accessToken;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// ä½¿ç”¨ä¼ å…¥çš„ executor æ‰§è¡Œè¯·æ±‚ï¼Œå¹¶è·å–ç»“æœã€‚</span><br>            T result = executor.execute(uriWithAccessToken, data);<br><br>            <span class="hljs-comment">// è®°å½•è¯·æ±‚å’Œå“åº”æ•°æ®åˆ°æ—¥å¿—ã€‚</span><br>            <span class="hljs-keyword">this</span>.log.debug(<span class="hljs-string">&quot;\nã€è¯·æ±‚åœ°å€ã€‘: &#123;&#125;\nã€è¯·æ±‚å‚æ•°ã€‘ï¼š&#123;&#125;\nã€å“åº”æ•°æ®ã€‘ï¼š&#123;&#125;&quot;</span>, <span class="hljs-keyword">new</span> Object[]&#123;uriWithAccessToken, dataForLog, result&#125;);<br>            <span class="hljs-keyword">return</span> result;<br>        &#125; <span class="hljs-keyword">catch</span> (WxErrorException var9) &#123;<br>            <span class="hljs-comment">// å¤„ç†å¾®ä¿¡é”™è¯¯å¼‚å¸¸ã€‚</span><br>            WxError <span class="hljs-keyword">error</span> = var9.getError();<br><br>            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯å› ä¸º access token è¿‡æœŸå¼•èµ·çš„é”™è¯¯ï¼Œå¹¶å°è¯•åˆ·æ–°ã€‚</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">error</span>.getErrorCode() == <span class="hljs-number">42001</span> || <span class="hljs-keyword">error</span>.getErrorCode() == <span class="hljs-number">40001</span> || <span class="hljs-keyword">error</span>.getErrorCode() == <span class="hljs-number">40014</span>) &#123;<br>                <span class="hljs-keyword">this</span>.getWxMpConfigStorage().expireAccessToken();<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.getWxMpConfigStorage().autoRefreshToken()) &#123;<br>                    <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.<span class="hljs-title">execute</span><span class="hljs-params">(executor, uri, data)</span></span>;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment">// å¦‚æœé”™è¯¯ç ä¸ä¸º0ï¼Œè®°å½•é”™è¯¯å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">error</span>.getErrorCode() != <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">this</span>.log.<span class="hljs-keyword">error</span>(<span class="hljs-string">&quot;\nã€è¯·æ±‚åœ°å€ã€‘: &#123;&#125;\nã€è¯·æ±‚å‚æ•°ã€‘ï¼š&#123;&#125;\nã€é”™è¯¯ä¿¡æ¯ã€‘ï¼š&#123;&#125;&quot;</span>, <span class="hljs-keyword">new</span> Object[]&#123;uriWithAccessToken, dataForLog, <span class="hljs-keyword">error</span>&#125;);<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> WxErrorException(<span class="hljs-keyword">error</span>, var9);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var10) &#123;<br>            <span class="hljs-comment">// å¤„ç† IO å¼‚å¸¸ã€‚</span><br>            <span class="hljs-keyword">this</span>.log.<span class="hljs-keyword">error</span>(<span class="hljs-string">&quot;\nã€è¯·æ±‚åœ°å€ã€‘: &#123;&#125;\nã€è¯·æ±‚å‚æ•°ã€‘ï¼š&#123;&#125;\nã€å¼‚å¸¸ä¿¡æ¯ã€‘ï¼š&#123;&#125;&quot;</span>, <span class="hljs-keyword">new</span> Object[]&#123;uriWithAccessToken, dataForLog, var10.getMessage()&#125;);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> WxErrorException(WxError.builder().errorMsg(var10.getMessage()).build(), var10);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å…·ä½“çš„è°ƒç”¨å…³ç³»æœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹é¡¹ç›®ä»£ç ã€‚</p>
<h4 id="å¤©æ°”æŸ¥è¯¢"><a href="#å¤©æ°”æŸ¥è¯¢" class="headerlink" title="å¤©æ°”æŸ¥è¯¢"></a>å¤©æ°”æŸ¥è¯¢</h4><p>é€šè¿‡ç™¾åº¦åœ°å›¾å¼€å‘å¹³å°è·å–å½“åœ°å¤©æ°”ï¼Œéœ€è¦ç”³è¯·æˆä¸ºå¼€å‘è€…ï¼š <a target="_blank" rel="noopener" href="https://lbsyun.baidu.com/apiconsole/center">https://lbsyun.baidu.com/apiconsole/center</a></p>
<p>å›½å†…å¤©æ°”æŸ¥è¯¢ï¼š <a target="_blank" rel="noopener" href="https://lbs.baidu.com/faq/api?title=webapi/weather/base">https://lbs.baidu.com/faq/api?title=webapi/weather/base</a></p>
<p>ç”¨æˆ·å¯é€šè¿‡è¡Œæ”¿åŒºåˆ’ä»£ç æŸ¥è¯¢å®æ—¶å¤©æ°”ä¿¡æ¯åŠæœªæ¥5å¤©å¤©æ°”é¢„æŠ¥ã€‚</p>
<p>api æœåŠ¡åœ°å€ï¼š </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>api.map.baidu.com<span class="hljs-regexp">/weather/</span>v1/?district_id=<span class="hljs-number">222405</span>&amp;data_type=all&amp;ak=ä½ çš„ak  <br><span class="hljs-regexp">//</span>GETè¯·æ±‚<br></code></pre></td></tr></table></figure>

<p>éœ€è¦å…ˆè·å–åˆ° Access Key </p>
<p>åœ¨æ§åˆ¶å°ç®¡ç† â†’  åº”ç”¨ç®¡ç† â†’ æˆ‘çš„åº”ç”¨ï¼š <a target="_blank" rel="noopener" href="https://lbs.baidu.com/apiconsole/key/create">https://lbs.baidu.com/apiconsole/key/create</a></p>
<p>éœ€è¦åˆ›å»ºä¸€ä¸ªåº”ç”¨æ‰èƒ½çœ‹åˆ° AK</p>
<p>æœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œé€šè¿‡IPåœ°å€è·å–é‚®æ”¿ç¼–ç : <a target="_blank" rel="noopener" href="https://blog.51cto.com/u_16175454/7185643">https://blog.51cto.com/u_16175454/7185643</a></p>
<p>ä½†å®é™…å¹¶ä¸æ˜¯é‚®æ”¿ç¼–ç ï¼Œè€Œæ˜¯çœ‹ä¸€ä¸‹å®˜ç½‘æ–‡æ¡£ç»™çš„IDç¼–å·ã€‚</p>
<p>å®˜ç½‘æœ‰ä¸€ä»½æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://lbs.baidu.com/faq/api?title=webapi/weather/base">https://lbs.baidu.com/faq/api?title=webapi/weather/base</a>   ï¼Œ</p>
<p>å¯ä»¥ä¸‹è½½çœ‹ä¸€ä¸‹ï¼šå¹¿å· 440100  æ·±åœ³ 440300</p>
<p>è®¾ç½®IPè®¿é—®ç™½åå•ï¼š  å»ºè®®ç›´æ¥è®¾ç½®  0.0.0.0&#x2F;0 </p>
<p>ç”±äºä¸æ˜¯å…¬ç½‘è®¿é—®ï¼Œè®¾ç½®çš„IPåº”è¯¥æ˜¯æœ‰ç‚¹é—®é¢˜ã€‚</p>
<h4 id="â€å½©è™¹å±â€œæ¥å£"><a href="#â€å½©è™¹å±â€œæ¥å£" class="headerlink" title="â€å½©è™¹å±â€œæ¥å£"></a>â€å½©è™¹å±â€œæ¥å£</h4><p>è°ƒç”¨çš„ç¬¬ä¸‰æ–¹æ¥å£ï¼Œå¤©èšæ•°è¡Œå¹³å°çš„</p>
<p>æ¥å£åœ°å€ï¼š <a target="_blank" rel="noopener" href="https://www.tianapi.com/apiview/181">https://www.tianapi.com/apiview/181</a></p>
<p>è®¿é—®éœ€è¦å¯†é’¥ï¼š <a target="_blank" rel="noopener" href="https://www.tianapi.com/console/">https://www.tianapi.com/console/</a></p>
<p>æ§åˆ¶å° â†’ å®‰å…¨ç®¡ç†</p>
<p>å®é™…ä½¿ç”¨çš„æ—¶å€™ä»–è¿™ä¸ªç¬¬ä¸‰æ–¹æ¥å£çš„ IP ç™½åå•æœ‰é‡åˆ°å‘ï¼Œè®¾ç½®ä¸ç”Ÿæ•ˆï¼Œæ–°å¢ä¹‹åï¼›</p>
<p>åé¢ä¸æ–­å°è¯•ä¹‹åå‘ç°ä½ å……å€¼ä»–çš„ å¯†é’¥Key å¥½åƒæ‰åˆ·æ–°ç”Ÿæ•ˆäº†ã€‚</p>
<h4 id="ç¼–è¾‘æ¨¡æ¿"><a href="#ç¼–è¾‘æ¨¡æ¿" class="headerlink" title="ç¼–è¾‘æ¨¡æ¿"></a>ç¼–è¾‘æ¨¡æ¿</h4><p>æœ€åæ¨é€çš„æ—¶å€™ç”¨åˆ°äº†ä¸€ä¸ªæ¨¡æ¿IDï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµ‹è¯•å¾®ä¿¡å…¬ä¼—å·è¿™é‡Œç¼–è¾‘ä¸€ä¸‹æ¨¡æ¿</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">ä½ å¥½ï¼Œä»Šå¤©æ˜¯</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">date.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">å†œå†</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">lunar.DATA</span>&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">festival.DATA</span>&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">remark.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">ä½ æ‰€åœ¨çš„åŸå¸‚ä½ç½®:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">city.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">å½“å‰å¤©æ°”:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">weather.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">æœ€ä½æ°”æ¸©: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">low.DATA</span>&#125;&#125;</span><span class="language-xml">åº¦</span><br><span class="language-xml">æœ€é«˜æ°”æ¸©: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">high.DATA</span>&#125;&#125;</span><span class="language-xml">åº¦</span><br><span class="language-xml">é£åŠ›: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">wc_day.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">é£å‘: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">wd_day.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">å­¦ä¹ æ‰“å¡~</span><br><span class="language-xml">è¯·å¼€å§‹ä»Šå¤©æ™šä¸Šçš„å­¦ä¹ å§ï¼</span><br><span class="language-xml">ä»Šå¤©æ˜¯æ‰“å¡çš„ç¬¬</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">loveDays.DATA</span>&#125;&#125;</span><span class="language-xml">å¤©</span><br><span class="language-xml">è·ç¦»ä¸€å¹´è¿˜å‰©ä¸‹</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">birthdays.DATA</span>&#125;&#125;</span><span class="language-xml">å¤©</span><br><span class="language-xml">Encourage:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">rainbow.DATA</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰æ¨¡æ¿åè¿›è¡Œæäº¤ï¼Œå¤åˆ¶æäº¤åçš„ æ¨¡æ¿IDï¼Œæ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­</p>
<p>userID ä¹Ÿæ˜¯ç›´æ¥å¯ä»¥åœ¨å…¬ä¼—å·å¹³å°çš„åˆ—è¡¨å¯ä»¥çœ‹åˆ°</p>
<p>è°ƒç”¨æµ‹è¯•åœ°å€ï¼š <a target="_blank" rel="noopener" href="http://localhost/test">http://localhost/test</a></p>
<h4 id="å®šæ—¶æ¨é€"><a href="#å®šæ—¶æ¨é€" class="headerlink" title="å®šæ—¶æ¨é€"></a>å®šæ—¶æ¨é€</h4><p>å»ºç«‹äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡é…ç½®ç±»</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> com.tsmyk.wechatproject.wechat.scheduled;<br><br><span class="hljs-keyword">import</span> com.tsmyk.wechatproject.wechat.utils.PushMessageUtils;<br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.<span class="hljs-keyword">annotation</span>.EnableScheduling;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.<span class="hljs-keyword">annotation</span>.Scheduled;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Task å®šæ—¶ä»»åŠ¡</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> cws</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/8/22 21:42</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@EnableScheduling</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> &#123;<br>    <span class="hljs-comment">// å®šæ—¶ä»»åŠ¡</span><br>    <span class="hljs-meta">@Scheduled(cron = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wechat.cron&#125;</span>&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> void goodMorning() &#123;<br>        PushMessageUtils.push();;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4ã€æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤"><a href="#4ã€æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤" class="headerlink" title="4ã€æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤"></a>4ã€æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤</h3><p>é¡¹ç›®åœ°å€ï¼š <a target="_blank" rel="noopener" href="https://github.com/tsmyk0715/wechatproject">https://github.com/tsmyk0715/wechatproject</a></p>
<h4 id="é¡¹ç›®ä»‹ç»-ğŸ¦ŒğŸ¦ŒğŸ¦Œ"><a href="#é¡¹ç›®ä»‹ç»-ğŸ¦ŒğŸ¦ŒğŸ¦Œ" class="headerlink" title="é¡¹ç›®ä»‹ç»  ğŸ¦ŒğŸ¦ŒğŸ¦Œ"></a>é¡¹ç›®ä»‹ç»  ğŸ¦ŒğŸ¦ŒğŸ¦Œ</h4><p>å…ˆç”³è¯·ä¸€ä¸ªè®¢é˜…å·ï¼Œç™»é™†åœ°å€ï¼š <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/cgi-bin/loginpage?t=wxm2-login&lang=zh_CN">https://mp.weixin.qq.com/cgi-bin/loginpage?t=wxm2-login&amp;lang=zh_CN</a></p>
<p>æˆæƒä¿¡æ¯åœ¨ è®¾ç½®ä¸å¼€å‘ â†’ åŸºæœ¬é…ç½®ï¼ˆç”³è¯·æˆä¸ºå¼€å‘è€…ï¼‰</p>
<p>ä¹Ÿå¯ä»¥è¿›å…¥åˆ°è¿™ä¸ªæµ‹è¯•å¾®ä¿¡å…¬ä¼—å·åœ°å€ï¼š <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login">https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login</a></p>
<p>æµ‹è¯•ä¸€ä¸‹è·å–ç”¨æˆ·æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤</p>
<p>ä¸‹è½½è¯¥é¡¹ç›®ï¼š <a target="_blank" rel="noopener" href="https://github.com/tsmyk0715/wechatproject">https://github.com/tsmyk0715/wechatproject</a> </p>
<h5 id="é¡¹ç›®åˆ†æ"><a href="#é¡¹ç›®åˆ†æ" class="headerlink" title="é¡¹ç›®åˆ†æ"></a>é¡¹ç›®åˆ†æ</h5><p>è¿™ä¸ªé¡¹ç›®æ˜¯ä½¿ç”¨çš„ å¼€æºå·¥å…· <code>weixin-java-mp</code> è¿›è¡Œå¼€å‘çš„</p>
<p>åŒæ—¶ä½ éœ€è¦è·å–åˆ°å¾®ä¿¡å‘ä½ å‘é€æ¶ˆæ¯ï¼Œå› æ­¤éœ€è¦å†…ç½‘ç©¿é€ä¸€ä¸‹ï¼Œå°†æœ¬åœ°çš„è®¿é—®æ˜ å°„åˆ°å…¬ç½‘ã€‚â€˜</p>
<p>è¿™ä¸ªé¡¹ç›®ç›¸å½“äºäº†ä½ å¯¹è‡ªå·±çš„å¾®ä¿¡å·æœåŠ¡è¿›è¡Œä¸ªæ€§åŒ–æ“ä½œï¼Œå…³é”®æ“ä½œæ˜¯é€šè¿‡å…³è”å¾®ä¿¡æ¥å£æ¥è¿›è¡Œå®ç°çš„ã€‚</p>
<p>ç¬¬ä¸‰ç« çš„å­¦ä¹ å†…å®¹å»ºè®®å­¦ä¹ ä¸€ä¸‹å®ƒçš„æ¨¡æ¿åŒ–æ“ä½œå’Œå®šæ—¶å‘é€æ“ä½œã€‚</p>
<p>è¿™ä¸ªé¡¹ç›®å€¼å¾—å­¦ä¹ è¿˜æŒºå¤šå†…å®¹çš„ï¼Œå¾®ä¿¡å¹³å°åœ¨åç»­çš„ä½¿ç”¨åº”è¯¥æ˜¯æ¯”è¾ƒé¢‘ç¹çš„ï¼Œåç»­ä¹Ÿå¯ä»¥å­¦ä¹  WxJava ç­‰å†…å®¹ã€‚</p>
<p>æ¥å£å‚æ•°é…ç½®å»ºè®®ä½¿ç”¨æµ‹è¯•å·ã€‚</p>
<h5 id="é…ç½®IPç™½åå•"><a href="#é…ç½®IPç™½åå•" class="headerlink" title="é…ç½®IPç™½åå•"></a>é…ç½®IPç™½åå•</h5><p>åœ¨å…¬ä¼—å·çš„åŸºæœ¬é…ç½®é‡Œé¢çš„ IP ç™½åå•ï¼Œéœ€è¦é…ç½®ä¸€ä¸‹ä½ çš„æœåŠ¡å™¨IP</p>
<h5 id="è·å–access-token"><a href="#è·å–access-token" class="headerlink" title="è·å–access_token"></a>è·å–access_token</h5><p>è¿™ä¸ªæ˜¯å¾®ä¿¡æ¥å£ä¸­çš„å…¶ä¸­ä¸€ä¸ªæ¥å£ï¼Œéœ€è¦è·å–åˆ°å…¶ä»–æ¥å£ä¿¡æ¯éœ€è¦ç”¨åˆ°è¿™ä¸ªä¿¡æ¯</p>
<p>å¾®ä¿¡å…¬ä¼—å·å¼€å‘è€…æ–‡æ¡£ï¼š <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html">https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html</a></p>
<p>ä»€ä¹ˆæ˜¯ <code>access_token</code>? å®˜ç½‘çš„ä»‹ç»å¦‚ä¸‹ï¼š</p>
<p><code>access_token</code>æ˜¯å…¬ä¼—å·çš„å…¨å±€å”¯ä¸€æ¥å£è°ƒç”¨å‡­æ®ï¼Œå…¬ä¼—å·è°ƒç”¨å„æ¥å£æ—¶éƒ½éœ€ä½¿ç”¨<code>access_token</code>ã€‚å¼€å‘è€…éœ€è¦è¿›è¡Œå¦¥å–„ä¿å­˜ã€‚<code>access_token</code>çš„å­˜å‚¨è‡³å°‘è¦ä¿ç•™512ä¸ªå­—ç¬¦ç©ºé—´ã€‚<code>access_token</code>çš„æœ‰æ•ˆæœŸç›®å‰ä¸º<code>2</code>ä¸ªå°æ—¶ï¼Œéœ€å®šæ—¶åˆ·æ–°ï¼Œé‡å¤è·å–å°†å¯¼è‡´ä¸Šæ¬¡è·å–çš„access_tokenå¤±æ•ˆã€‚</p>
<p>è·å– <code>access_token</code> çš„æ¥å£æ¯æ—¥è°ƒç”¨æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ‰€ä»¥ä¸æ˜¯æ¯æ¬¡è°ƒç”¨æ¥å£éƒ½é‡æ–°è·å–<code>access_token</code>ï¼Œè€Œæ˜¯è·å–åˆ°ä¹‹åç¼“å­˜èµ·æ¥ï¼Œç¼“å­˜å¤±æ•ˆä¹‹åå†å»é‡æ–°è·å–å³åˆ·æ–°ã€‚</p>
<p>è·å–è¿™ä¸ªä¿¡æ¯éœ€è¦è°ƒç”¨å¾®ä¿¡çš„ç¬¬ä¸‰æ–¹APIæ¥å£è·å–</p>
<ol>
<li>æ¥å£åœ°å€ä¸ºï¼š</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">httpsè¯·æ±‚æ–¹å¼: <br><br><span class="hljs-attr">https</span>:<span class="hljs-comment">//api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET</span><br></code></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜</strong></p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>æ˜¯å¦å¿…é¡»</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>grant_type</td>
<td>æ˜¯</td>
<td>è·å–access_tokenå¡«å†™client_credential</td>
</tr>
<tr>
<td>appid</td>
<td>æ˜¯</td>
<td>ç¬¬ä¸‰æ–¹ç”¨æˆ·å”¯ä¸€å‡­è¯</td>
</tr>
<tr>
<td>secret</td>
<td>æ˜¯</td>
<td>ç¬¬ä¸‰æ–¹ç”¨æˆ·å”¯ä¸€å‡­è¯å¯†é’¥ï¼Œå³appsecret</td>
</tr>
<tr>
<td>è¿”å›çš„æ˜¯JSONæ ¼å¼çš„æŠ¥æ–‡ï¼š</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<span class="hljs-string">&quot;access_token&quot;</span>:<span class="hljs-string">&quot;ACCESS_TOKEN&quot;</span>,<span class="hljs-string">&quot;expires_in&quot;</span>:<span class="hljs-number">7200</span>&#125;<br></code></pre></td></tr></table></figure>


<p>ä¿®æ”¹é…ç½®ï¼š</p>
<h5 id="è·å–ç”¨æˆ·æ¶ˆæ¯"><a href="#è·å–ç”¨æˆ·æ¶ˆæ¯" class="headerlink" title="è·å–ç”¨æˆ·æ¶ˆæ¯"></a>è·å–ç”¨æˆ·æ¶ˆæ¯</h5><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è·å–å…³æ³¨è€…çš„åˆ—è¡¨ï¼Œå…³æ³¨è€…çš„ä¿¡æ¯ç­‰ã€‚</p>
<p><strong>è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼š</strong></p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">WechatController</span> </span>&#123;<br>    <span class="hljs-comment">/** æ—¥å¿— */</span><br>    <span class="hljs-keyword">private</span> Logger logger = LoggerFactory.getLogger(getClass());<br>    <span class="hljs-comment">/** å·¥å…·ç±» */</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> WechatUtils wechatUtils;<br><br>    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">&quot;getUserInfo&quot;</span>)<br>    <span class="hljs-keyword">public</span> void getUserInfo() &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            WxMpUserList userList = wechatUtils.getUserList();<br>            <span class="hljs-keyword">if</span> (userList == <span class="hljs-literal">null</span> || userList.getOpenIds().isEmpty()) &#123;<br>                logger.warn(<span class="hljs-string">&quot;å…³æ³¨è€…openIdåˆ—è¡¨ä¸ºç©º&quot;</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            List&lt;<span class="hljs-keyword">String</span>&gt; openIds = userList.getOpenIds();<br>            logger.info(<span class="hljs-string">&quot;å…³æ³¨è€…openIdåˆ—è¡¨ = &#123;&#125;&quot;</span>, openIds.toString());<br><br>            <span class="hljs-keyword">String</span> openId = openIds.<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);<br>            logger.info(<span class="hljs-string">&quot;å¼€å§‹è·å– &#123;&#125; çš„åŸºæœ¬ä¿¡æ¯&quot;</span>, openId);<br>            WxMpUser userInfo = wechatUtils.getUserInfo(openId);<br>            <span class="hljs-keyword">if</span> (userInfo == <span class="hljs-literal">null</span>) &#123;<br>                logger.warn(<span class="hljs-string">&quot;è·å– &#123;&#125; çš„åŸºæœ¬ä¿¡æ¯ä¸ºç©º&quot;</span>, openId);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <span class="hljs-keyword">String</span> city = userInfo.getCity();<br>            <span class="hljs-keyword">String</span> nickname = userInfo.getNickname();<br>            logger.info(<span class="hljs-string">&quot;&#123;&#125; çš„æ˜µç§°ä¸ºï¼š&#123;&#125;, åŸå¸‚ä¸ºï¼š&#123;&#125;&quot;</span>, openId, nickname, city);<br>        &#125; <span class="hljs-keyword">catch</span> (WxErrorException e) &#123;<br>            logger.error(<span class="hljs-string">&quot;è·å–ç”¨æˆ·æ¶ˆæ¯å¤±è´¥&quot;</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯"><a href="#æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯" class="headerlink" title="æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯"></a><strong>æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯</strong></h5><p>å½“å¾®ä¿¡ç”¨æˆ·å‘å…¬ä¼—å·å‘é€æ¶ˆæ¯æ—¶ï¼Œå¾®ä¿¡æœåŠ¡å™¨ä¼šé€šè¿‡å…¬ä¼—å·åå°é…ç½®çš„URLæŠŠä¿¡æ¯å‘é€åˆ°æˆ‘ä»¬åå°çš„æ¥å£ä¸Šï¼Œæ³¨æ„æ­¤æ—¶çš„è¯·æ±‚æ ¼å¼ä¸º <code>POST</code>è¯·æ±‚ï¼Œå‘é€è¿‡æ¥çš„æ¶ˆæ¯æŠ¥æ–‡æ ¼å¼æ˜¯XMLæ ¼å¼çš„ï¼Œæ¯ç§æ¶ˆæ¯ç±»å‹çš„XMLæ ¼å¼ä¸ä¸€æ ·ã€‚</p>
<p>è¿™é‡Œè·³è¿‡ï¼Œå…·ä½“å†…å®¹çœ‹ä¸€ä¸‹å¼€æºé¡¹ç›®çš„ä»£ç ã€‚</p>
<h5 id="å“åº”å¾®ä¿¡å‘å‡ºçš„è¯·æ±‚æ¶ˆæ¯"><a href="#å“åº”å¾®ä¿¡å‘å‡ºçš„è¯·æ±‚æ¶ˆæ¯" class="headerlink" title="å“åº”å¾®ä¿¡å‘å‡ºçš„è¯·æ±‚æ¶ˆæ¯"></a>å“åº”å¾®ä¿¡å‘å‡ºçš„è¯·æ±‚æ¶ˆæ¯</h5><p>æ¥å£æ–‡æ¡£ï¼š <a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html">https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html</a></p>
<p>å¾®ä¿¡è¦æ±‚å“åº”ä¿¡æ¯å¿…é¡»è¦åœ¨äº”ç§’å†…ï¼Œå› æ­¤å®é™…è°ƒç”¨ API çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªæ—¶é—´å†²çªã€‚</p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240114222207.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="é¡¹ç›®è¿è¡Œ"><a href="#é¡¹ç›®è¿è¡Œ" class="headerlink" title="é¡¹ç›®è¿è¡Œ"></a>é¡¹ç›®è¿è¡Œ</h4><p>é€šè¿‡ä½ è·å–çš„æµ‹è¯•å·çš„ appidã€appsecretã€token ä¿¡æ¯ï¼Œé…ç½®å·å†…ç½‘ç©¿é€ï¼ˆè·å–åˆ°å¾®ä¿¡å‘é€çš„æ¶ˆæ¯ï¼‰</p>
<p>å°±å¯ä»¥å¯åŠ¨è¿™ä¸ªé¡¹ç›®äº†ï¼Œå¯åŠ¨ç±»ï¼š WechatprojectApplication</p>
<h3 id="5ã€QQæ¶ˆæ¯å›å¤"><a href="#5ã€QQæ¶ˆæ¯å›å¤" class="headerlink" title="5ã€QQæ¶ˆæ¯å›å¤"></a>5ã€QQæ¶ˆæ¯å›å¤</h3><p>æ—¢ç„¶éƒ½äº†è§£åˆ°è¿™é‡Œäº†ï¼Œä¸å¦‚ä¹Ÿçœ‹ä¸€ä¸‹QQæ¶ˆæ¯æ˜¯å¦èƒ½è‡ªåŠ¨è·å–å¹¶é—®ç­”ã€‚</p>
<p>to be continedâ€¦</p>
<h3 id="6ã€å°è¯•å›½å†…çš„å¤§è¯­è¨€æ¨¡å‹"><a href="#6ã€å°è¯•å›½å†…çš„å¤§è¯­è¨€æ¨¡å‹" class="headerlink" title="6ã€å°è¯•å›½å†…çš„å¤§è¯­è¨€æ¨¡å‹"></a>6ã€å°è¯•å›½å†…çš„å¤§è¯­è¨€æ¨¡å‹</h3><p>å›½å¤–çš„è¿™ä¸ªå°é”å¯¹å¤§é™†ä¹ŸçœŸçš„æ¶å¿ƒï¼Œä»£ç†æœåŠ¡ç­‰ä¹Ÿå¾ˆéš¾å—ï¼›</p>
<p>ä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹å›½å†…çš„ ç™¾åº¦æ–‡å¿ƒä¸€è¨€ã€è®¯é£æ˜Ÿç«ã€é˜¿é‡Œé€šä¹‰åƒé—®ç­‰ã€‚</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://yiyan.baidu.com/">https://yiyan.baidu.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://passport.xfyun.cn/login">https://passport.xfyun.cn/login</a></li>
<li><a target="_blank" rel="noopener" href="https://tongyi.aliyun.com/">https://tongyi.aliyun.com/</a></li>
</ul>
<p>åç»­è€ƒè™‘ä½¿ç”¨é€šä¹‰åƒé—®ã€‚</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E9%A1%B9%E7%9B%AE/" class="category-chain-item">é¡¹ç›®</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/project/" class="print-no-link">#project</a>
      
        <a href="/tags/java/" class="print-no-link">#java</a>
      
        <a href="/tags/chatgpt/" class="print-no-link">#chatgpt</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ChatGPTé—®ç­”åŠ©æ‰‹</div>
      <div>https://varcel.luoqi.icu/2024/01/12/ChatGPTé—®ç­”åŠ©æ‰‹/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Luo QI</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2024å¹´1æœˆ12æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/01/13/%E9%80%9A%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E5%87%BD%E6%95%B0%E8%AE%A1%E7%AE%97FC%E8%BF%9B%E8%A1%8COpenAI%E8%AE%BF%E9%97%AE%E5%9B%BD%E5%86%85%E4%BB%A3%E7%90%86/" title="é€šè¿‡é˜¿é‡Œäº‘çš„å‡½æ•°è®¡ç®—FCè¿›è¡ŒOpenAIè®¿é—®å›½å†…ä»£ç†">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">é€šè¿‡é˜¿é‡Œäº‘çš„å‡½æ•°è®¡ç®—FCè¿›è¡ŒOpenAIè®¿é—®å›½å†…ä»£ç†</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/01/12/obsidian%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/" title="obsidianå¸¸ç”¨æ’ä»¶ä½¿ç”¨è®°å½•">
                        <span class="hidden-mobile">obsidianå¸¸ç”¨æ’ä»¶ä½¿ç”¨è®°å½•</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div style="font-size: 0.85rem"> <span id="timeDate">è½½å…¥å¤©æ•°...</span> <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
