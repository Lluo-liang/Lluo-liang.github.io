

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/Xbox%20L.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Luo QI">
  <meta name="keywords" content="">
  
    <meta name="description" content="面试题_RocketMQ">
<meta property="og:type" content="article">
<meta property="og:title" content="面试题_RocketMQ">
<meta property="og:url" content="https://varcel.luoqi.icu/2024/01/25/%E8%87%AA%E6%B5%8B%E9%A2%98_RocketMQ/index.html">
<meta property="og:site_name" content="轻松的洛亓">
<meta property="og:description" content="面试题_RocketMQ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/wallpaper1702453206266.jpg">
<meta property="article:published_time" content="2024-01-25T09:33:14.000Z">
<meta property="article:modified_time" content="2024-01-25T09:33:14.000Z">
<meta property="article:author" content="Luo QI">
<meta property="article:tag" content="java">
<meta property="article:tag" content="面试题">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/wallpaper1702453206266.jpg">
  
  
  
  <title>面试题_RocketMQ - 轻松的洛亓</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"varcel.luoqi.icu","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  <meta name="baidu-site-verification" content="codeva-Oq0KOjHuD3" />
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>轻松的洛亓</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311131716524.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="面试题_RocketMQ"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-25 09:33" pubdate>
          2024年1月25日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.8k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          65 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">面试题_RocketMQ</h1>
            
            
              <div class="markdown-body">
                
                <h3 id="面试自测题"><a href="#面试自测题" class="headerlink" title="面试自测题"></a>面试自测题</h3><ul>
<li>基础内容<ul>
<li>RocketMQ 是什么？</li>
<li>RocketMQ的架构是怎样的？</li>
</ul>
</li>
<li>常见问题<ul>
<li>RocketMQ如何保证消息的可靠性传输？RocketMQ 如何保证不丢失消息？</li>
<li>RocketMQ 如何实现顺序消息？</li>
<li>RocketMQ如何实现消息的延迟投递？</li>
<li>RocketMQ如何处理消息的重复消费问题？</li>
<li>RocketMQ的事务消息是如何实现的？</li>
<li>RocketMQ如何实现消息的持久化?</li>
</ul>
</li>
<li>组件<ul>
<li>NameServer在RocketMQ中扮演什么角色？RocketMQ的NameServer有什么作用？</li>
<li>Broker在RocketMQ中的作用是什么？</li>
<li>RocketMQ的Producer和Consumer有什么区别？Producer和Consumer在RocketMQ中分别承担什么职责？</li>
<li>RocketMQ的Topic和Tag有什么作用？</li>
<li>RocketMQ中的Topic和JMS的queue有什么区别？</li>
<li>RocketMQ 主题拆分不合理会有什么后果。</li>
<li>RocketMQ 中的主题，什么场景下需要增加队列数？当主题内的队列数过多，可能会导致什么问题。</li>
<li>RocketMQ 怎么避免产生大量垃圾主题。</li>
</ul>
</li>
<li>模型<ul>
<li>讲一下RocketMQ 的领域模型，RocketMQ 支持的消息传输模型有哪些。</li>
<li>RocketMQ的消息模型有哪些？</li>
<li>RocketMQ的消息顺序性如何保证？如何实现消息的顺序消费。</li>
</ul>
</li>
<li>发送<ul>
<li>RocketMQ如何实现消息的延迟投递？RocketMQ 延时消息可以设置任意时间吗？</li>
<li>RocketMQ如何处理消息的重试机制？如何实现的？</li>
</ul>
</li>
<li>消费<ul>
<li>RocketMQ 的消费充实的应用场景有哪些？在什么情况下会实现消费重试，怎么避免无限消费重试。</li>
<li>RocketMQ Broker中的消息被消费后会立即删除吗？</li>
<li>RocketMQ的Offset是什么？RocketMQ的Offset机制是如何工作的？</li>
<li>RocketMQ 消费者启动后从哪里开始消费消息。</li>
<li>消费消息是push还是pull？</li>
<li>为什么要主动拉取消息而不使用事件监听方式？</li>
<li>broker如何处理拉取请求的？</li>
</ul>
</li>
<li>事务<ul>
<li>RocketMQ的事务消息是如何实现的？</li>
</ul>
</li>
<li>集群<ul>
<li>RocketMQ消费模式有几种？</li>
<li>RocketMQ如何实现消息的广播和集群？</li>
<li>RocketMQ的集群模式有哪些？</li>
</ul>
</li>
<li>其他<ul>
<li>RocketMQ如何实现消息的过滤？</li>
<li>消息会堆积吗？什么时候清理过期消息？</li>
</ul>
</li>
<li>存储<ul>
<li>RocketMQ的存储机制是怎样的？</li>
<li>RocketMQ 中的消息有没有大小限制?</li>
</ul>
</li>
<li>生产问题<ul>
<li>RocketMQ 如果出现异常需要故障恢复，已消费的消息是否被重新消费？</li>
<li>RocketMQ 消费者建议打印日志吗？RocketMQ 消息发送重试是否会阻塞业务调用。</li>
<li>RocketMQ如何实现消息的回溯消费？</li>
<li>RocketMQ的监控和报警机制是怎样的？</li>
<li>RocketMQ如何进行集群的扩容和缩容？</li>
<li>RocketMQ如何进行故障恢复和数据备份？</li>
<li>RocketMQ如何进行消息的监控和管理？</li>
<li>RocketMQ如何实现消息的批量发送？</li>
</ul>
</li>
</ul>
<h3 id="面试解答篇"><a href="#面试解答篇" class="headerlink" title="面试解答篇"></a>面试解答篇</h3><ul>
<li>基础内容<ul>
<li>RocketMQ 是什么？<ul>
<li>RocketMQ是一个分布式消息中间件和流计算平台，由阿里巴巴开源。它提供了高性能、高吞吐量、可扩展和可靠的消息和流处理机制。RocketMQ主要用于处理大规模消息的发送、接收和存储，支持严格的消息顺序、分布式事务、消息回溯等特性，广泛应用于大数据处理、分布式系统的解耦、流量削峰等场景。</li>
</ul>
</li>
<li>RocketMQ的架构是怎样的？<ul>
<li>RocketMQ采用四层架构：名称服务（Name Server）、代理服务器（Broker Server）、生产者（Producer）和消费者（Consumer）。<ul>
<li><strong>名称服务（Name Server）</strong>：提供轻量级服务发现和路由，每个名称服务记录完整的Broker路由信息，客户端通过名称服务来获取Broker的IP地址。</li>
<li><strong>代理服务器（Broker Server）</strong>：负责消息存储、传输、处理等功能，可以部署为主从架构以提高可用性。</li>
<li><strong>生产者（Producer）</strong>：负责产生并发送消息到Broker。</li>
<li><strong>消费者（Consumer）</strong>：从Broker订阅并消费消息。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>常见问题<ul>
<li>RocketMQ如何保证消息的可靠性传输？RocketMQ 如何保证不丢失消息？<ul>
<li>RocketMQ通过同步或异步刷盘和消息确认机制保证消息的可靠性传输。生产者发送消息后，消息会被存储在Broker的消息存储文件中，可以配置为消息写入磁盘后才返回确认信息。消费者消费消息后，需要向Broker发送消费成功的确认，确保消息不会因为消费失败而丢失</li>
</ul>
</li>
<li>RocketMQ 如何实现顺序消息？<ul>
<li>RocketMQ通过使用有序消息队列和严格的生产者到消费者的顺序保证机制实现顺序消息。生产者发送消息时指定消息的队列，同一个队列中的消息会按照发送的顺序来消费。消费者在消费消息时，需要单线程顺序消费同一个队列中的消息，以保证顺序。</li>
</ul>
</li>
<li>RocketMQ如何实现消息的延迟投递？<ul>
<li>RocketMQ通过内置的延迟队列实现消息的延迟投递。生产者在发送消息时可以设置消息的延迟级别，消息会在指定的延迟时间后才被投递给消费者。RocketMQ预设了多个延迟级别，满足不同的延迟需求。</li>
</ul>
</li>
<li>RocketMQ如何处理消息的重复消费问题？<ul>
<li>RocketMQ不能完全避免消息的重复消费，但提供了一些机制减轻这个问题，如消息唯一ID、消费者幂等处理。消费者在处理消息时应该设计为幂等操作，即重复执行操作结果不变，通过业务逻辑检查或数据库约束来防止重复消费的影响。</li>
</ul>
</li>
<li>RocketMQ的事务消息是如何实现的？<ul>
<li>RocketMQ的事务消息通过半消息和本地事务状态回查来实现。生产者发送半消息到Broker，然后执行本地事务。如果事务提交，生产者再发送另一个消息来确认消费；如果事务回滚，发送的半消息将被Broker删除。如果Broker长时间没有收到确认，会向生产者请求本地事务状态，根据回查结果决定是提交还是回滚消息。</li>
</ul>
</li>
<li>RocketMQ如何实现消息的持久化?<ul>
<li>RocketMQ通过将消息存储在磁盘的CommitLog文件中实现消息的持久化。为了提高性能，消息首先被存储在内存的写缓冲区，然后异步批量写入磁盘。此外，RocketMQ还支持同步和异步刷盘策略，确保消息在系统崩溃时不丢失。</li>
</ul>
</li>
</ul>
</li>
<li>组件<ul>
<li>NameServer在RocketMQ中扮演什么角色？RocketMQ的NameServer有什么作用？<ul>
<li>NameServer在RocketMQ中扮演路由信息管理的角色。它负责维护Broker和Topic的路由信息，为Producer和Consumer提供网络路由发现和负载均衡服务。客户端通过查询NameServer获取Broker的地址及Topic的队列信息。</li>
</ul>
</li>
<li>Broker在RocketMQ中的作用是什么？<ul>
<li>Broker是RocketMQ的核心组件，负责消息的接收、存储和传输。它处理Producer的消息发送请求和Consumer的消息拉取请求，同时负责消息的存储管理和服务的高可用保障。</li>
</ul>
</li>
<li>RocketMQ的Producer和Consumer有什么区别？Producer和Consumer在RocketMQ中分别承担什么职责？<ul>
<li>Producer负责生成并发送消息到Broker。Consumer负责从Broker拉取并消费消息。Producer主要职责是确保消息可靠地发送到指定Topic的Broker上；Consumer的职责是高效地拉取并处理这些消息。</li>
</ul>
</li>
<li>RocketMQ的Topic和Tag有什么作用？<ul>
<li>Topic是消息分类的标识，Producer按Topic发布消息，Consumer按Topic订阅消息。Tag是对同一Topic下消息进一步细分的标志，用于过滤消息。利用Topic和Tag，可以实现更灵活的消息订阅模式。</li>
</ul>
</li>
<li>RocketMQ中的Topic和JMS的queue有什么区别？<ul>
<li>RocketMQ的Topic支持发布&#x2F;订阅模型，一个消息可以被多个Consumer消费。JMS的queue属于点对点模型，消息只能被单个Consumer消费。RocketMQ的Topic更适用于广播和分组消费的场景。</li>
</ul>
</li>
<li>RocketMQ 主题拆分不合理会有什么后果。<ul>
<li>主题拆分不合理可能导致消息分布不均匀、负载不平衡、资源利用率低下，以及消费延迟增加等问题</li>
</ul>
</li>
<li>RocketMQ 中的主题，什么场景下需要增加队列数？当主题内的队列数过多，可能会导致什么问题。<ul>
<li>当消息量大、消费压力增大时需要增加队列数以提高并行消费能力。队列数过多可能导致Broker负载过高、管理复杂度增加以及资源利用率低下。</li>
</ul>
</li>
<li>RocketMQ 怎么避免产生大量垃圾主题。<ul>
<li>通过合理规划Topic使用策略、定期清理不再使用的Topic和队列、监控和预警机制来避免产生大量垃圾主题。</li>
<li>RocketMQ 避免产生大量垃圾主题的策略包括：<ul>
<li><strong>合理规划主题</strong>：在创建主题之前进行详细规划，避免不必要或临时的主题创建。</li>
<li><strong>监控和清理</strong>：定期监控主题的使用情况，及时清理长时间未使用或不再需要的主题。</li>
<li><strong>权限控制</strong>：限制主题创建权限，只允许有权用户创建主题，减少随意创建。</li>
<li><strong>自动化管理工具</strong>：使用自动化工具检测和清理无用主题，保持Broker的整洁。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>模型<ul>
<li>讲一下RocketMQ 的领域模型，RocketMQ 支持的消息传输模型有哪些。<ul>
<li>RocketMQ 的领域模型主要包括Producer（生产者）、Consumer（消费者）、Broker（消息处理节点）、NameServer（命名服务）。RocketMQ 支持的消息传输模型包括：<ul>
<li><strong>同步传输</strong>：消息发送者等待服务器响应，确认消息已被处理。</li>
<li><strong>异步传输</strong>：消息发送者不等待响应，通过回调方式处理响应。</li>
<li><strong>单向传输</strong>：消息发送者只负责发送消息，不等待任何响应。</li>
</ul>
</li>
</ul>
</li>
<li>RocketMQ的消息模型有哪些？<ul>
<li>RocketMQ 支持多种消息模型，包括：<ul>
<li><strong>点对点模式</strong>：消息直接从生产者发送到指定的消费者。</li>
<li><strong>发布&#x2F;订阅模式</strong>：消息发送到主题，由多个消费者订阅处理。</li>
<li><strong>顺序消息</strong>：保证特定主题的消息顺序消费。</li>
<li><strong>延时消息</strong>：消息在指定时间后才能被消费。</li>
<li><strong>事务消息</strong>：支持分布式事务处理。</li>
</ul>
</li>
</ul>
</li>
<li>RocketMQ的消息顺序性如何保证？如何实现消息的顺序消费。<ul>
<li>RocketMQ 通过队列（Queue）来保证同一主题下的消息顺序性。实现消息的顺序消费主要通过以下方式：<ul>
<li><strong>顺序生产</strong>：同一类消息发送到同一个队列。</li>
<li><strong>顺序消费</strong>：消费者从队列中顺序拉取并消费消息。</li>
<li><strong>单线程消费</strong>：确保消费者并发消费时使用单线程顺序处理队列中的消息。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>发送<ul>
<li>RocketMQ如何实现消息的延迟投递？RocketMQ 延时消息可以设置任意时间吗？<ul>
<li>RocketMQ 通过预设的延时级别来实现消息的延迟投递。在发送消息时，可以设置消息的延时等级，但不能设置任意时间，只能选择RocketMQ已经定义的几个延时等级，例如1s、5s、10s等到数小时的延时。</li>
</ul>
</li>
<li>RocketMQ如何处理消息的重试机制？如何实现的？<ul>
<li>RocketMQ 处理消息的重试机制主要依赖于消费者端的重试策略。当消费者消费消息失败时，可以选择重新发送ACK请求进行重试。RocketMQ 支持局部顺序的重试队列，消费者从重试队列中按失败次数延迟拉取消息进行重试。Broker侧配置了消息重试的次数和延迟时间，一旦重试次数超过限制，则消息会被转移到死信队列，等待人工干预处理。</li>
</ul>
</li>
</ul>
</li>
<li>消费<ul>
<li>RocketMQ 的消费充实的应用场景有哪些？在什么情况下会实现消费重试，怎么避免无限消费重试。<ul>
<li>应用场景包括处理暂时性的错误如网络异常、依赖服务不可用等。消费重试发生在消费者处理消息失败后。避免无限重试，可以通过设置最大重试次数，一旦超过这个次数，消息将转移到死信队列，需要人工干预处理</li>
</ul>
</li>
<li>RocketMQ Broker中的消息被消费后会立即删除吗？<ul>
<li>不会立即删除。消息被成功消费并确认（ACK）后，RocketMQ标记该消息为已消费状态，但物理删除操作是在后台通过定时任务进行的，以优化性能和资源利用。</li>
</ul>
</li>
<li>RocketMQ的Offset是什么？RocketMQ的Offset机制是如何工作的？<ul>
<li>Offset是指消费者在消息队列中的位置标记，表示消费到哪一条消息。RocketMQ通过维护每个消费者或消费者组的Offset来记录其消费进度。当消费者重新启动或者进行负载均衡时，可以根据Offset从上次消费的位置继续消费，确保消息不被遗漏。</li>
</ul>
</li>
<li>RocketMQ 消费者启动后从哪里开始消费消息。<ul>
<li>消费者启动后，默认从上次停止的位置（Offset）开始消费。消费者可以通过设置消费模式来改变这一行为，如设置为“最新”（CONSUME_FROM_LAST_OFFSET）从最新的消息开始消费，或“最早”（CONSUME_FROM_FIRST_OFFSET）从队列头部的消息开始消费。</li>
</ul>
</li>
<li>消费消息是push还是pull？<ul>
<li>RocketMQ 支持 push 和 pull 两种消费模式。</li>
<li>在 push 模式下，Broker 主动将消息推送给消费者；而在 pull 模式下，消费者主动从 Broker 拉取消息。</li>
<li>默认情况下，RocketMQ 客户端采用的是 push 模式，但实际上是在客户端内部采用拉（pull）的方式来实现的，即消费者定时从Broker拉取消息，然后再回调用户的消费逻辑。</li>
</ul>
</li>
<li>为什么要主动拉取消息而不使用事件监听方式？<ul>
<li>主动拉取消息提供了更大的灵活性和控制性，消费者可以根据自己的处理能力来控制拉取消息的速率，避免因为消息到来过快而导致消费者处理不过来，进而影响系统的稳定性。此外，主动拉取可以更好地支持消息的批量处理，提高消费效率。</li>
</ul>
</li>
<li>broker如何处理拉取请求的？<ul>
<li>当消费者向Broker发送拉取请求时，Broker首先计算出合适的消息位置（Offset），然后从消息存储文件中找到这个位置对应的消息，根据请求中指定的数量返回一批消息给消费者。Broker还会根据消费者的消费速度动态调整返回消息的数量，以实现流量控制。</li>
</ul>
</li>
</ul>
</li>
<li>事务<ul>
<li>RocketMQ的事务消息是如何实现的？<ul>
<li>RocketMQ的事务消息通过半消息机制实现。首先发送一个“半消息”到Broker，然后本地执行业务逻辑。如果业务执行成功，发送另一个消息告诉Broker确认提交这条消息；如果失败，则告知Broker回滚，不对外发布这条消息。RocketMQ还会定期对未确定的事务状态进行回查，以确保事务最终一致性。</li>
</ul>
</li>
</ul>
</li>
<li>集群<ul>
<li>RocketMQ消费模式有几种？<ul>
<li>RocketMQ支持两种消费模式：集群消费（Clustering）和广播消费（Broadcasting）。集群消费模式下，同一个消费组中的多个消费者共同消费队列中的消息，每条消息只被消费一次；广播消费模式下，消息被广播到所有消费者，每个消费者都会收到所有的消息。</li>
</ul>
</li>
<li>RocketMQ如何实现消息的广播和集群？<ul>
<li>消息广播是通过广播消费模式实现，消息被发送给所有的订阅者。集群消费通过集群模式实现，每条消息被分配给消费组中的一个消费者处理，保证负载均衡和消息的有效处理。</li>
</ul>
</li>
<li>RocketMQ的集群模式有哪些？<ul>
<li>RocketMQ支持多种集群部署模式，包括单Master模式、多Master模式、多Master多Slave异步复制模式、多Master多Slave同步双写模式等。这些模式提供了不同级别的数据可靠性和可用性保障，满足不同业务场景的需求。</li>
</ul>
</li>
</ul>
</li>
<li>其他<ul>
<li>RocketMQ如何实现消息的过滤？<ul>
<li>RocketMQ实现消息过滤主要通过两种方式：标签过滤（Tag）和SQL92过滤。生产者在发送消息时可以指定消息的标签或自定义属性，消费者在订阅时可以基于这些标签或通过SQL92的语法对属性进行过滤，只消费符合条件的消息。</li>
</ul>
</li>
<li>消息会堆积吗？什么时候清理过期消息？<ul>
<li>是的，消息在消费者处理能力不足或出现故障时会堆积。RocketMQ允许设置消息的存活时间（Time to Live，TTL），过期消息会在消息存储时检查其是否超过TTL，超时的消息会被定期清理，避免无用消息的堆积。</li>
</ul>
</li>
</ul>
</li>
<li>存储<ul>
<li>RocketMQ的存储机制是怎样的？<ul>
<li>RocketMQ使用基于文件的存储机制，将消息顺序存储在CommitLog文件中。为了提高性能，RocketMQ将消息索引信息存储在ConsumeQueue文件中，ConsumeQueue为消息消费队列提供了快速索引。此外，还有IndexFile文件存储关键字查找的索引，支持快速按消息属性查询。</li>
</ul>
</li>
<li>RocketMQ 中的消息有没有大小限制?<ul>
<li>是的，RocketMQ中的消息大小有限制。默认情况下，单个消息的最大大小为4MB。但是，这个大小是可以配置的，可以根据实际需求调整最大消息体大小限制。需要注意的是，增加消息大小限制可能会影响消息传输的性能和Broker的存储效率。</li>
</ul>
</li>
</ul>
</li>
<li>生产问题<ul>
<li>RocketMQ 如果出现异常需要故障恢复，已消费的消息是否被重新消费？<ul>
<li>如果正确设置了消息消费的确认机制（ACK），在故障恢复时，只有未被确认消费的消息可能会被重新消费。RocketMQ 通过消费进度（Offset）来记录消费状态，已确认消费的消息不会被重复消费。</li>
</ul>
</li>
<li>RocketMQ 消费者建议打印日志吗？RocketMQ 消息发送重试是否会阻塞业务调用。<ul>
<li>建议在消费者处理消息时打印必要的日志，以便故障排查和性能监控。RocketMQ 消息发送重试默认是异步进行的，不会阻塞业务调用。但如果业务逻辑需要同步处理结果，可以根据发送API的返回值或使用同步发送模式，这可能会增加业务调用的延迟。</li>
</ul>
</li>
<li>RocketMQ如何实现消息的回溯消费？<ul>
<li>RocketMQ 支持通过设置消费者的时间戳属性来实现消息的回溯消费。消费者可以指定一个历史时间点，重新从该时间点对应的消息开始消费，实现消息的回溯。</li>
</ul>
</li>
<li>RocketMQ的监控和报警机制是怎样的？<ul>
<li>RocketMQ 提供了丰富的监控指标，可以通过集成Prometheus和Grafana进行实时监控。同时，RocketMQ 控制台（RocketMQ Dashboard）提供了队列深度、消费延迟等监控视图。报警机制可以通过第三方系统如Alertmanager实现，根据监控数据触发报警规则。</li>
</ul>
</li>
<li>RocketMQ如何进行集群的扩容和缩容？<ul>
<li>RocketMQ 集群的扩容可以通过增加Broker节点实现，新加入的Broker需要正确配置并加入到NameServer的路由注册中。缩容时，需要先停止需要移除的Broker，然后从NameServer中注销该Broker，最后确保消息数据迁移，防止数据丢失。</li>
</ul>
</li>
<li>RocketMQ如何进行故障恢复和数据备份？<ul>
<li>RocketMQ 故障恢复依赖于其消息存储机制，包括同步复制或异步复制到Slave节点保证数据可靠性。数据备份可以通过定期备份存储文件或使用磁盘快照等方式进行，确保在发生故障时可以快速恢复数据。</li>
</ul>
</li>
<li>RocketMQ如何进行消息的监控和管理？<ul>
<li>RocketMQ 可以通过RocketMQ 控制台（Dashboard）进行消息的监控和管理，提供Topic、队列、消费者组等信息的查看，消息发送和消费状态监控，以及消息查询、重置消费偏移量等管理操作。</li>
</ul>
</li>
<li>RocketMQ如何实现消息的批量发送？<ul>
<li>RocketMQ 支持消息的批量发送，生产者可以将多个消息集合为一个批量消息包进行发送。需要注意的是，批量消息的总大小不应超过4MB的限制，且批量消息内的所有消息应该有相同的Topic和相同的等待存储队列。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h3><p>看一下这个视频，过一下相关内容： <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ua4y1N7P2">https://www.bilibili.com/video/BV1ua4y1N7P2</a></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/" class="category-chain-item">面试题</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/java/" class="print-no-link">#java</a>
      
        <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" class="print-no-link">#面试题</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>面试题_RocketMQ</div>
      <div>https://varcel.luoqi.icu/2024/01/25/自测题_RocketMQ/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Luo QI</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年1月25日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
