

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/Xbox%20L.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Luo QI">
  <meta name="keywords" content="">
  
    <meta name="description" content="客诉项目速通">
<meta property="og:type" content="article">
<meta property="og:title" content="客诉项目速通">
<meta property="og:url" content="https://varcel.luoqi.icu/2024/04/17/%E5%AE%A2%E8%AF%89%E9%A1%B9%E7%9B%AE%E9%80%9F%E9%80%9A/index.html">
<meta property="og:site_name" content="轻松的洛亓">
<meta property="og:description" content="客诉项目速通">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312150024266.jpeg">
<meta property="article:published_time" content="2024-04-17T19:48:46.000Z">
<meta property="article:modified_time" content="2024-04-17T19:48:46.000Z">
<meta property="article:author" content="Luo QI">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312150024266.jpeg">
  
  
  
  <title>客诉项目速通 - 轻松的洛亓</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"varcel.luoqi.icu","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  <meta name="baidu-site-verification" content="codeva-Oq0KOjHuD3" />
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>轻松的洛亓</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311131716524.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="客诉项目速通"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-04-17 19:48" pubdate>
          2024年4月17日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.5k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          63 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">客诉项目速通</h1>
            
            
              <div class="markdown-body">
                
                <p>问题：</p>
<ul>
<li>1、记录表和日志表有什么区别，记录表的划分有什么细节吗</li>
<li>2、这个记录表是只是客诉服务在用吗</li>
<li>3、技术文档你们一般怎么写的，有什么规范吗（包括文档规范、代码规范、数据库规范）</li>
<li>4、客诉是24小时都有值班吗，定时任务一直在跑进行分配，还是有工作日历</li>
<li>5、Full GC 的优化场景，怎么处理的，相关八股</li>
<li>6、团队人员配置，服务器内存配置等</li>
<li>7、项目介绍和印象深刻难点这里有套路或者提前准备内容文稿吗</li>
<li>8、为什么要重开</li>
</ul>
<h4 id="简历内容"><a href="#简历内容" class="headerlink" title="简历内容"></a>简历内容</h4><p>工作内容</p>
<ul>
<li>1、日常需求迭代</li>
<li>2、后期微服务的拆分（客诉平台的拆分：客诉平台，催收平台，申请单平台）</li>
</ul>
<p>项目名称：物流客诉中台(2022.7-2023.10)</p>
<p>技术栈：Springcloud,MySql,Redis,Mybatis,RocketMQ,ElasticSearch</p>
<p>微服务模块：运单部门、交易部门、工单部门、客诉部门、货源部门、用户中心，外呼部门、中间件团<br>队，风控部门</p>
<p>项目描述：本平台主要是对司机和货主在交易中产生的投诉进行处理。货主发货，司机接货，中途如果<br>产生纠纷会创建客诉单，该客诉单会流向公司的客服部门，客服进行客诉单的审核，如果涉及退钱的客<br>诉类型还需要客服领导审核。整个模块业务和其他部门交互采用mq消息形式，也有采用 rpc同步远<br>程调用对方接口的方式。如果有公司垫付费用的情况还会涉及催收单和申诉单的业务产生。客诉系统包<br>括催收单、申请单、客诉单、申诉单。我们部门主要负责整个客诉平台的迭代和优化，提升客服的办事<br>效率。</p>
<p>责任描述：</p>
<ul>
<li>1、负责日常的需求开发和技术文档的编写（比如：客诉单创建以及重开，催收单，申请单等需求开发）</li>
<li>2、负责对客诉中台一些响应时间长的接口进行优化，提升接口响应时间</li>
<li>3、编写 redis 分布式锁，解决页面重复提交、分单定时任务重复执行以及并发修改申请单状态问题</li>
<li>4、负责客诉监控平台日常检测  慢SQL 的调优以及针对个别大表制定拆解方案，</li>
<li>5、组织其他部门讨论客诉核心创单接口涉及分布式事务的处理方案，并采用rocketMq半事务消息编写回滚逻辑。</li>
<li>6、参与对整个客诉平台的拆分，拆分成客诉平台，催收平台，申请单平台三个独立的微服务，方便职责划分和后期迭代</li>
<li>7、独立定位线上redis内存溢出问题以及创单接口高峰期频繁出现full gc问题和VM内存oom问题并解决。</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240419214548.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h5 id="01-整体业务"><a href="#01-整体业务" class="headerlink" title="01 整体业务"></a>01 整体业务</h5><p>负责日常的需求开发和技术文档的编写（比如：客诉单创建以及重开，催收单，申请单等需求开发）</p>
<ul>
<li><p>客诉单创建业务</p>
<ul>
<li>1、司机或者货主通过平台界面进行选择进入到申诉界面，填写申诉信息进行提交（包括图片截图信息）</li>
<li>2、司机或者货主联系客服，客服进行人工后台进行创建，图片相关信息通过联系司机&#x2F;货主进行二次提交操作。</li>
</ul>
</li>
<li><p>重开业务</p>
<ul>
<li>针对同一个运单，可能会出现申诉单结束后，进行二次申诉的场景，此时会在原申诉单ID 的基础上进行重开操作（申诉单记录只有一条，记录表多条数据）</li>
</ul>
</li>
<li><p>催收单业务</p>
<ul>
<li>出现类似货主不退还押金的情况，司机申诉的操作（涉及押金）</li>
<li>此时客服会进行垫付操作，先将押金退还给司机，生成  平台 →  货主 的一个催收单</li>
<li>货主催收也不还  →  打标  →  拉黑</li>
</ul>
</li>
<li><p>申请单</p>
<ul>
<li>客诉单进行创建的时候，会将 客诉类型 ID  + 客诉单 ID 传给工单部门，工单后台根据规则引擎生成 申请单模板</li>
<li>点击客诉单详情的时候，详情界面会有多个按钮数据，一个客诉单对应多个申请单，点击不同的按钮，对应不同的操作，并会对应不同的申请单给工单部门那边进行审核操作。</li>
</ul>
</li>
<li><p>关于客诉单的部分业务内容</p>
<ul>
<li>客诉单状态<ul>
<li>待领取，已领取，审核中，审核完成，已办结</li>
<li>当该客诉单处于【待领取】状态，司机&#x2F;货主可以进行撤销操作</li>
<li>分配到客服手中，状态会被修改为【已领取】</li>
</ul>
</li>
<li>创建客诉对应的后台业务操作<ul>
<li>1、远程调用运单服务，冻结运单【MQ 方式交互】</li>
<li>2、客诉单入库（数据库是1主2从）</li>
<li>3、图片入库（OSS 地址关联客诉单 ID）</li>
<li>4、客诉单ID  →  详情信息  → 组装 ES 关键数据   → 存入ES</li>
<li>5、调用生成申请单接口（客诉单ID + 投诉单 ID 发送） → 工单部门  →  规则引擎生成模板</li>
<li>6、记录表记录事件内容</li>
<li>7、生成外呼表记录</li>
<li>8、定时任务：分配客诉单到客服手上</li>
</ul>
</li>
</ul>
</li>
<li><p>互联网业务交互流程</p>
<ul>
<li>会议</li>
<li>天数</li>
<li>技术文档<ul>
<li>技术点 + 改动点 + 风险点</li>
</ul>
</li>
<li>技术评审<ul>
<li>风险评估</li>
<li>开发前前后对接</li>
</ul>
</li>
<li>开发阶段</li>
</ul>
</li>
</ul>
<h5 id="02-接口优化"><a href="#02-接口优化" class="headerlink" title="02 接口优化"></a>02 接口优化</h5><p>负责对客诉中台一些响应时间长的接口进行优化，提升接口响应时间</p>
<ul>
<li><p>这里主要是针对客诉单详情页进行优化操作，使用异步编码 + 三级结构存入 Redis 中</p>
</li>
<li><p>细讲业务，每一步从哪里操作的</p>
</li>
<li><p>多线程 +  三级分类</p>
</li>
<li><p>多线程某个任务失败了怎么办，如何感知（异常如何感知）</p>
</li>
<li><p>2 秒怎么得出来的（前端界面的响应时间）</p>
</li>
<li><p>Redis 缓存一致性</p>
</li>
<li><p>多线程的问题</p>
</li>
</ul>
<p>开启子线程，去查询数据【看一下他视频怎么做的】</p>
<ul>
<li>主线程 + 子线程</li>
</ul>
<p>怎么保持</p>
<ul>
<li><p>Comn</p>
</li>
<li><p>CountDownLatch +  </p>
</li>
<li><h2 id="数据表设计-id-parents"><a href="#数据表设计-id-parents" class="headerlink" title="数据表设计  - id parents "></a>数据表设计<br>  - id parents </h2></li>
</ul>
<h5 id="03-Redis-使用"><a href="#03-Redis-使用" class="headerlink" title="03 Redis 使用"></a>03 Redis 使用</h5><p>编写 redis 分布式锁，解决页面重复提交、分单定时任务重复执行以及并发修改申请单状态问题</p>
<ul>
<li><p>Redis 分布式锁的底层方式可以讲一下</p>
</li>
<li><p>Redis  集群模式  3 主 3 从</p>
</li>
<li><p>持久化策略  AOF + RDB  混合模式</p>
</li>
<li><p>MQ  3 主 3 从</p>
</li>
<li><p>ES 3 主 3 从 3 个副片</p>
</li>
<li><p>线程池</p>
<ul>
<li>配置文件：动态可变</li>
</ul>
</li>
</ul>
<p>常见面试题</p>
<ul>
<li>1、redission lock </li>
<li>2、lock 的实现原理  看门狗机制</li>
<li>3、数据结构</li>
<li>4、为什么不适用原生的 setnx ，节点宕机锁失效  redlock、zookeeper 去解决</li>
<li>5、除了 redis 还有哪些可以做分布式锁</li>
<li>6、超时时间设置（使用 redission 的默认时间 30秒）</li>
<li>7、分布式锁的 key 怎么设计的</li>
<li>8、防重复提交代码具体怎么实现的</li>
</ul>
<h5 id="04-SQL，大表拆分"><a href="#04-SQL，大表拆分" class="headerlink" title="04  SQL，大表拆分"></a>04  SQL，大表拆分</h5><p>负责客诉监控平台日常检测  慢SQL 的调优以及针对个别大表制定拆解方案，</p>
<ul>
<li>针对记录表，进行大表拆分：使用动态 SQL，进行批量插入迁移和新数据插入接口功能改造（拆分多表操作）</li>
<li>记录表（三千万数据量左右）<ul>
<li>历史表（2年之前） + 物理删除  + 分表拆分（保证数据量在 2 -300万）</li>
</ul>
</li>
<li>SQL优化 <ul>
<li>1、隐式转换</li>
<li>2、分组</li>
</ul>
</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240419233513.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>常见面试题</p>
<ul>
<li>1、索引结构：索引的区别，hash 索引和 B+ 索引的区别，其他索引结构。</li>
<li>2、大表拆分是如何做的<ul>
<li>1、通过记录表的关联业务ID(客诉单ID)进行取模操作，将旧数据迁移以及新数据插入功能改造 + 历史表</li>
<li>2、拆分为了  11 张表（保持一个平均的数据量)</li>
</ul>
</li>
<li>3、为什么不分库分表：业务操作上已经满足需求了</li>
<li>4、为什么不使用 ES：记录表没必要放，ES占用内存，已经有很多数据了</li>
<li>5、慢SQL调优</li>
<li>6、Mysql 可重复读的情况下怎么解决部分幻读：+ 间隙锁</li>
<li>7、索引下推</li>
</ul>
<h5 id="05-分布式事务"><a href="#05-分布式事务" class="headerlink" title="05  分布式事务"></a>05  分布式事务</h5><p>组织其他部门讨论客诉核心创单接口涉及分布式事务的处理方案，并采用 rocketMq 半事务消息编写回滚逻辑。</p>
<ul>
<li><p>客诉单生成 + 运单冻结  没有分布式事务问题</p>
</li>
<li><p>运单冻结 +  客诉单生成 分布式事务问题，这里不能保证 运单冻结这一步是成功的</p>
</li>
<li><p>运单冻结 + 客诉单生成 + 工单模板生成   →  分布式事务问题，所以当时考虑到成本问题，seata 组件引入依赖成本</p>
<ul>
<li>但是当时考虑到引入这个组件的成本较高（其他部门也需要引入）</li>
<li>seata rocketmq 弱一致性  →  技术选型（成本，组件引用）</li>
<li>seat  at   强一致性</li>
</ul>
</li>
<li><p>工单模板生成  返回 true 或者 false ；根据返回值来进行事务回滚</p>
</li>
<li></li>
<li><p>针对分布式事务问题</p>
<ul>
<li>场景一：运单冻结 + 客诉单生成 + 工单模板生成<ul>
<li>使用 RocketMQ 的具体使用方式可以讲一下（多个接口时会产生分布式事务问题）</li>
<li>分布式事务：运单冻结 + 客诉单生成 </li>
<li>工单模板生成：本地事务回滚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>常见面试题</p>
<ul>
<li>1、分布式事务场景</li>
<li>2、具体如何使用的（结合业务讲一下）</li>
</ul>
<h5 id="06-服务的拆分"><a href="#06-服务的拆分" class="headerlink" title="06  服务的拆分"></a>06  服务的拆分</h5><p>参与对整个客诉平台的拆分，拆分成客诉平台，催收平台，申请单平台三个独立的微服务，方便职责划分和后期迭代</p>
<p>常见面试题</p>
<ul>
<li>1、为什么要拆分</li>
<li>2、拆分遇到什么难点<ul>
<li>遇到拆分不全的问题，后续是通过画整个流程图，然后根据业务去进行拆分操作</li>
<li>自测麻烦</li>
</ul>
</li>
<li>拆分有没有引入什么设计模式</li>
<li>拆分之后怎么部署的</li>
</ul>
<p>记录表没有拆分，远程调用，记录日志</p>
<p>其他拆分，进行了分库操作</p>
<h5 id="07-线上问题"><a href="#07-线上问题" class="headerlink" title="07 线上问题"></a>07 线上问题</h5><ul>
<li>场景问题：广告问题，没有显示，排查到是Redis 的问题，然后发现是内存爆了、</li>
<li>创单接口高峰期频繁出现full gc问题（涉及八股）</li>
</ul>
<p>独立定位线上redis内存溢出问题以及创单接口高峰期频繁出现full gc问题和VM内存oom问题并解决。</p>
<ul>
<li>JVM 内存 OOM 问题定位</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/d1d42bfc62ade5b873562194471336e.png" srcset="/img/loading.gif" lazyload alt="d1d42bfc62ade5b873562194471336e.png"></p>
<ul>
<li>Full GC 问题排查</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420100010.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>触发条件</p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420100206.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>自适应调节策略</p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420104042.png" srcset="/img/loading.gif" lazyload alt="image.png"><br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420104118.png" srcset="/img/loading.gif" lazyload alt="image.png"><br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420104133.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420104233.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>对于 JVM 相关的一些内容</p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420151126.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420151143.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>待看一下 ： fullgc话术.pdf</p>
<p>常见面试题</p>
<ul>
<li>1、你有没有独立参与过 JVM 调优</li>
<li>JVM 内存 40% 以下</li>
</ul>
<h6 id="广告弹窗"><a href="#广告弹窗" class="headerlink" title="广告弹窗"></a>广告弹窗</h6><p>用户 ID </p>
<p>后台自动定时拉取：广告 ID + 位置信息 + json 信息</p>
<p>现象：运营发现客诉单界面上没有广告推送</p>
<p>排查：</p>
<ul>
<li>1、先查看广告接口调用是否正常（这里是正常情况）</li>
<li>2、排查<ul>
<li>原因：key 设置不过期，导致大量缓存数据堆积</li>
<li>解决方案：<ul>
<li>临时方案：先通过模糊删除一个月的，先看是否能正常</li>
<li>解决方案：设置过期时间，更改内存溢出策略</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Redis 内存溢出</p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420095229.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h3 id="客诉项目"><a href="#客诉项目" class="headerlink" title="客诉项目"></a>客诉项目</h3><p>运费收费：佣金</p>
<p>押金：司机给货主的保证金</p>
<p>用户类型：卡车，大型货物等</p>
<p>客诉是该中台下的一个服务</p>
<ul>
<li>物流客诉中台</li>
<li>微服务模块：运单部门、交易部门、工单部门、客诉部门、货源部门、用户中江外呼部门，中间件团队，风控部门</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240417191845.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><h4 id="客诉单"><a href="#客诉单" class="headerlink" title="客诉单"></a>客诉单</h4><ul>
<li><p>当该客诉单处于【未处理】状态，司机&#x2F;货主可以进行撤销操作</p>
</li>
<li><p>分配到客服手中，状态会被修改为【处理中】</p>
</li>
<li><p>对应的后台操作</p>
<ul>
<li>1、远程调用运单服务，冻结运单</li>
<li>2、客诉单入库（数据库是1主2从）</li>
<li>3、图片入库（OSS 地址关联客诉单 ID）</li>
<li>4、客诉单ID  →  详情信息  → 组装 ES 关键数据   → 存入ES</li>
<li>5、调用生成申请单接口（客诉单ID + 投诉单 ID 发送） → 工单部门  →  规则引擎生成模板</li>
<li>6、记录表记录事件内容</li>
<li>7、生成外呼表记录</li>
<li>8、定时任务：分配客诉单到客服手上</li>
</ul>
</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240417193011.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="催收单"><a href="#催收单" class="headerlink" title="催收单"></a>催收单</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240417193759.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<ul>
<li>催收单（了解）：相关表设计，业务功能，该业务代码怎么实现</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240419170320.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h5 id="风控-高危单"><a href="#风控-高危单" class="headerlink" title="风控(高危单)"></a>风控(高危单)</h5><ul>
<li>业务场景：非正常运单，司机和货主协商进行客诉，客服进行垫付正常金额1000；但催收的时候货主只愿意给500（中间贪墨公司 500）</li>
<li>在生成客诉单的时候，会调用风控接口监控用户风险等级，如果是高级，会直接发延时队列，30分钟后自动关单（保证交易开始进行）</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240419170947.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="申诉单"><a href="#申诉单" class="headerlink" title="申诉单"></a>申诉单</h4><ul>
<li>只有一次申诉机会</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240417194111.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="申请单"><a href="#申请单" class="headerlink" title="申请单"></a>申请单</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240417194812.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h3 id="界面"><a href="#界面" class="headerlink" title="界面"></a>界面</h3><h4 id="创建客诉单"><a href="#创建客诉单" class="headerlink" title="创建客诉单"></a>创建客诉单</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240417200028.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="客服界面"><a href="#客服界面" class="headerlink" title="客服界面"></a>客服界面</h4><p>该界面会从 ES 中查询出，详情是从数据库中查询（客诉单ID_主键ID）【VIP 用户会先优先处理】</p>
<p>首先司机或者货主或者客服创建客诉单，调用客诉部门客诉单接口创建客诉单，</p>
<p>创建后，数据库，ES 中有一条客诉单记录，然后后台定时任务，10分钟一次分配给客服，客服选出客诉单，点击详情进行审批判断是否要进行申请单操作</p>
<p>客服点击申请单，客诉申请单表保存一条记录，状态是审核中，然后将详情信息传到工单部门.</p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240418105427.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<ul>
<li>大数据根据客服状态和处理单量自动分配到客服</li>
<li>后台操作：定时将客诉进行分配</li>
</ul>
<h4 id="客诉单详情"><a href="#客诉单详情" class="headerlink" title="客诉单详情"></a>客诉单详情</h4><ul>
<li>提交的申请单，客服在这个界面也可以进行撤销操作</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/%E5%AE%A2%E8%AF%89%E5%8D%95%E8%AF%A6%E6%83%85%E9%A1%B5.png" srcset="/img/loading.gif" lazyload alt="客诉单详情页.png"></p>
<h5 id="重开操作"><a href="#重开操作" class="headerlink" title="重开操作"></a>重开操作</h5><ul>
<li>重开操作指的是同一个运单，发生申请单完结后，司机&#x2F;货主又重新发起一次客诉操作</li>
<li>从而进行申请单重开操作（同时有重开次数限制）</li>
</ul>
<h4 id="申请单-1"><a href="#申请单-1" class="headerlink" title="申请单"></a>申请单</h4><h5 id="退佣操作"><a href="#退佣操作" class="headerlink" title="退佣操作"></a>退佣操作</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240418104727.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<ul>
<li>提供一个调用工单部门的接口</li>
<li>提供一个回传审核状态的接口<ul>
<li>更新 ES + 更新申请单状态</li>
</ul>
</li>
<li>退佣<ul>
<li>审核通过<ul>
<li>会发送一级或者两级领导审核的内容（根据佣金金额区分，大于 1000 需要 两级审核）</li>
<li>回传审核状态接口（如果是需要两级审核的时候，一级也会进行回传，进行一条记录，二级的话再进行后续操作）</li>
</ul>
</li>
<li>监听MQ<ul>
<li>插入记录表</li>
<li>自动关单</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="业务操作"><a href="#业务操作" class="headerlink" title="业务操作"></a>业务操作</h3><h4 id="分布式锁场景"><a href="#分布式锁场景" class="headerlink" title="分布式锁场景"></a>分布式锁场景</h4><p>可能会问的一些问题</p>
<p>3、编写reds分布式锁，解决页面重复提交和分单定时任务重复执行问题，申请单并发修改状态问题。</p>
<ul>
<li>描述一下为什么要使用分布式锁，或者不使用会怎么样，还有没有其他方式解决<ul>
<li>其他方式：zookeeper,.数据库，数据库乐观锁</li>
</ul>
</li>
<li>分布式锁<ul>
<li>加锁原理（Redisson：看门狗机制原理）</li>
</ul>
</li>
<li>为什么不使用原生的 redis 分布式锁</li>
<li>分布式数据结构</li>
<li>解决页面重复提交：代码怎么实现，不同的接口参数不一样怎么处理，项目中每个接口都有固定的参数和可变的参数，怎么获取方法参数值。</li>
<li>节点宕机导致锁丢失。Redlock加锁原理，</li>
<li>分布式锁的key怎么设计的。<ul>
<li>APPLICATION_申请单_id。</li>
</ul>
</li>
<li>Redisson 是不是可重入锁</li>
</ul>
<h5 id="退佣操作-1"><a href="#退佣操作-1" class="headerlink" title="退佣操作"></a>退佣操作</h5><ul>
<li><p>进行退佣操作的时候，客服是可以进行撤销的操作，撤销和工单部门的审核两个操作（两个操作都是会对退佣操作的表状态【客诉单状态】进行修改的），这里是需要加一个分布式锁，保证同一时刻只能进行一个操作（保证原子锁）。</p>
<ul>
<li>这种情况下使用数据库的乐观锁也可以考虑使用</li>
</ul>
</li>
<li><p>撤销的时候，查询数据库状态，如果是审核中状态，则可以操作（保证查询和修改是原子性）</p>
</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240419164858.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<ul>
<li>这里的 lock 实际使用的数据结构是 hash 结构   key  uuid + 线程名称  次数</li>
<li>分布式锁场景<ul>
<li>页面重复提交，定时任务重复执行，更改申请单状态</li>
</ul>
</li>
</ul>
<h5 id="重复提交-AOP-代码"><a href="#重复提交-AOP-代码" class="headerlink" title="重复提交 AOP 代码"></a>重复提交 AOP 代码</h5><ul>
<li>Around 注解方法</li>
<li>ProceedingJoinPoint 类</li>
<li>类名 + 方法名 + 参数<ul>
<li>这里可以说我们设置的方法中会给定一些公参，比如客服ID 之类的</li>
</ul>
</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240418130404.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="拉黑操作"><a href="#拉黑操作" class="headerlink" title="拉黑操作"></a>拉黑操作</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240418105314.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h4 id="分布式事务场景"><a href="#分布式事务场景" class="headerlink" title="分布式事务场景"></a>分布式事务场景</h4><h5 id="创建客诉单-冻结运单"><a href="#创建客诉单-冻结运单" class="headerlink" title="创建客诉单 + 冻结运单"></a>创建客诉单 + 冻结运单</h5><p>1、使用的方式是通过 RocketMQ 的半事务消息二阶段提交方式进行</p>
<p>2、场景</p>
<ul>
<li>2.1  创建客诉单后面的一些操作，如果有异常，进行事务回滚<ul>
<li>冻结运单这里使用了分布式事务，创建工单这里没加（可以说从业务上考虑，当时主要的问题是：客诉单创建 + 冻结运单 这里使用了分布式事务；创建工单由于是调用接口的方式去进行，接口的并发性小一点，出现的分布式事务问题较少一些；解决方案：可以通过 seata 的方式，但是当时考虑到引入这个组件的成本较高（其他部门也需要引入）；而且当时考虑到出现事务问题，工单那里也就是出现一条脏数据，其实影响不大）</li>
<li>客诉：高峰期有时候几百左右，客户：几十万左右；注册用户：70左右，活跃用户：十几万。</li>
</ul>
</li>
</ul>
<hr>
<p>5、参与讨论客诉核心接口涉及分布式事务的处理方案，并采用 rocketMg 半事务消息编写回滚逻辑。</p>
<ul>
<li>这个分布式事务是怎么出现的 ?</li>
<li>之前用户比较少，这种现象不多，一般一星期最多一次，然后都是靠运单和客诉手动修改数据库一些操作处理，后面用户多了，或者高峰期，出现频率较大，一星期好几次用户反馈。</li>
<li>通过这个反馈用户的id, 找到 传单失败的接口</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308102444.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>代码实现：看一下 [[消息队列_RocketMQ_基础使用#分布式事务的实现]]</p>
<p>消费者这里的常见操作</p>
<ul>
<li>1、监听有重试机制 3次</li>
<li>2、定时重试</li>
</ul>
<h4 id="客诉单详情-1"><a href="#客诉单详情-1" class="headerlink" title="客诉单详情"></a>客诉单详情</h4><p>接口优化</p>
<ul>
<li>客服反馈：存在接口慢的现象，然后产品分配这个给你</li>
<li>详情优化：先通过链路追踪工具查看，哪个节点耗时多，然后再进行优化操作</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240418142350.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>2、对客诉详情整个大的接口进行优化，由之前的4-5秒响应，优化到2秒左右响应</p>
<p>可能会问的一些问题</p>
<ul>
<li>怎么优化的，为什么考虑优化这里，多线程里面子线程出了异常怎么感知，涉及多线程的一些八股文<ul>
<li>线程池参数怎么设置的</li>
<li>redis:如何和数据库保持一致性，详情页为什么需要三级分类：string底层数据结构</li>
<li>还有哪些地方用到了redis 数据结构，<ul>
<li>set：存 mq 重复消费（场景）</li>
<li>hash 底层数据结构<ul>
<li>页面广告拉取（场景）</li>
<li>Hash：手机安卓和ios pc,用户的年龄段，广告详情配置，最终拉取广告还是请求广告平台</li>
</ul>
</li>
</ul>
</li>
<li>一个请求到页面展示经历了哪些流程<ul>
<li>DNS  域名解析  http tcp</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="SQL-优化"><a href="#SQL-优化" class="headerlink" title="SQL 优化"></a>SQL 优化</h4><p>4、负责监控平台检测日常慢 sql 的调优以及大表的拆解。</p>
<ul>
<li><p>token    12345    47832    varchar     88万条时间在5-30多秒  type all</p>
<ul>
<li>类型 where a &#x3D; 123  （索引失效）</li>
</ul>
</li>
<li><p>其他一些优化，代码中有一些关联查询没有小表驱动大表导致耗时    2s,</p>
</li>
<li><p>原生的 sql 调优怎么实现，开启 慢 sql ，2 种 方式，explain, discribber，执行计划有哪些字段</p>
</li>
<li><p>extra 文件排序   filesort ，id，type</p>
</li>
<li><p>索引失效还有哪些场景，建立索引如何考虑，索引下推</p>
</li>
<li><p>为什么类型不匹配会索引失效，为什么要符合最左匹配原则</p>
<ul>
<li>a  b  c    b&#x3D; 1  and  a &#x3D; 2 and c &#x3D; 2; b &#x3D; 1 and  c &#x3D; 2; a  &#x3D; 1 b &#x3D;2 ; b &#x3D; 2 and a &#x3D; 1</li>
</ul>
</li>
<li><p>代码中有一些关联查询没有小表驱动大表导致耗时</p>
<ul>
<li>为什么需要小表驱动大表</li>
</ul>
</li>
<li><p>大表的拆解</p>
<ul>
<li>为什么不使用分库分表：<ul>
<li>风险太大，对整个项目改动比较大</li>
<li>以前项目没有分库分表，只做了读写分离，1主 2 从，对整个项目进行分库分表主键需要重新设计</li>
<li>很多主键已经被其他部门所依赖。</li>
<li>考虑到风险太大，记录表 id  客诉单 id 事件  创建时间  detail</li>
</ul>
</li>
<li>为什么需要拆分</li>
<li>怎么拆分的<ul>
<li>11 张表，通过客诉表 Id 取模，用了 mybatis 动态表名 sql  ${} <ul>
<li>record_${}</li>
</ul>
</li>
<li>为什么是 11 张，<ul>
<li>客诉单表有 400 万条数据</li>
<li>有一张历史表，客诉单会定期把5年前的数据转移到历史表，一个客诉单大概对应8条数据，3200万11每张记录表在300万左右。</li>
</ul>
</li>
<li>原记录表数据怎么迁移的（迁移到历史数据）<ul>
<li>limit  50000 一批</li>
<li>通过定时任务扫描</li>
<li>多线程（分批插入）<ul>
<li>一次性批量插入 1000 条</li>
</ul>
</li>
<li>20000 条一个线程处理，按照 1000 一批<ul>
<li>For(i &lt; 10)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240418154304.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<hr>
<h4 id="服务拆分"><a href="#服务拆分" class="headerlink" title="服务拆分"></a>服务拆分</h4><p>参与对整个客诉平台的拆分，拆分成落诉平台，催收平台，申请单平台三个独立的微服务，方便职责划分和后期迭代</p>
<ul>
<li>怎么业务拆分</li>
<li>拆分不全问题，拆分难点，测试怎么做的</li>
<li>怎么实现服务切换<ul>
<li>开一个开关，写两套逻辑，正式上线后去掉老逻辑（开关控制）</li>
</ul>
</li>
</ul>
<h4 id="记录表（大表拆分操作）"><a href="#记录表（大表拆分操作）" class="headerlink" title="记录表（大表拆分操作）"></a>记录表（大表拆分操作）</h4><p>关键词：动态 SQL，分批插入</p>
<p>数据量超过 1 千万</p>
<p>拆分为 11 张表</p>
<ul>
<li>cp_record_1</li>
<li>cp_record_2</li>
</ul>
<p>创建数据可以考虑使用存储过程（百万数据）</p>
<p>动态 SQL 分批插入，这里主要的一个技术点是这个动态SQL  cp_record_${sum} 的方式（待实践一下）</p>
<p>查询，然后进行批量插入即可（实际拆分的时候）</p>
<hr>
<p>查询的时候需要考虑到避免索引失效场景</p>
<ul>
<li>业务场景：考虑到记录表的数据量太大，由于业务量的持续增大，当时进行拆分表操作<ul>
<li>1、将旧数据进行迁移到了新表（cp_record_xx）<ul>
<li>先批量查，再通过动态 SQL 进行插入（通过取余获取后缀）</li>
</ul>
</li>
<li>2、新增数据，方法需要更新（切换新方法）</li>
</ul>
</li>
</ul>
<p>疑问：</p>
<ul>
<li>1、关于拆表之后，查询操作的改动？【这里应该还是根据客诉单ID之类的键值去查】</li>
</ul>
<h4 id="OOM"><a href="#OOM" class="headerlink" title="OOM"></a>OOM</h4><ul>
<li>分析工具<ul>
<li>VisualVM：dump 文件</li>
<li>MAT</li>
</ul>
</li>
<li>实践一下分析流程</li>
</ul>
<h4 id="MQ-重复消费"><a href="#MQ-重复消费" class="headerlink" title="MQ 重复消费"></a>MQ 重复消费</h4><ul>
<li>场景：</li>
<li>解决方案：通过业务唯一性 ID 保证操作幂等性。</li>
</ul>
<h4 id="分布式ID"><a href="#分布式ID" class="headerlink" title="分布式ID"></a>分布式ID</h4><ul>
<li>美图 leaf<ul>
<li>前缀 + 数字13 位数字代号</li>
<li>客诉单<ul>
<li>业务 ID ，自增ID</li>
<li>查询操作一般使用的 业务 ID</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h4><ul>
<li><h2 id="模板-申请单创建的步骤-→-使用模板设计模式"><a href="#模板-申请单创建的步骤-→-使用模板设计模式" class="headerlink" title="模板  - 申请单创建的步骤  → 使用模板设计模式"></a>模板<br>  - 申请单创建的步骤  → 使用模板设计模式</h2></li>
<li>工厂（简单工厂模式，工厂方法模式，抽家工厂模式）</li>
<li>单例（双重检加 volatile )<ul>
<li>oom 问题</li>
<li>okhttpclient,  通过这个可以实现第三方接口的调用</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45112292/article/details/134726024">https://blog.csdn.net/weixin_45112292/article/details/134726024</a></li>
</ul>
</li>
<li>责任链</li>
<li>动态代理模式</li>
<li>生产者消费者模式</li>
</ul>
<p>工厂 + 模板：视频 5</p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420164504.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>责任链</p>
<p>文件交换功能（之前的业务功能）</p>
<p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240420165131.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>客诉项目速通</div>
      <div>https://varcel.luoqi.icu/2024/04/17/客诉项目速通/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Luo QI</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年4月17日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
