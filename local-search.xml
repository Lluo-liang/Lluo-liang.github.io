<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>é¡¹ç›®å­¦ä¹ _mallå­¦ä¹ æ•™ç¨‹</title>
    <link href="/2024/06/03/%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0_mall%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B/"/>
    <url>/2024/06/03/%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0_mall%E5%AD%A6%E4%B9%A0%E6%95%99%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>æ–‡æ¡£åœ°å€ï¼š <a href="https://www.macrozheng.com/">https://www.macrozheng.com/</a></p><p>è§†é¢‘å­¦ä¹ åœ°å€ï¼š <a href="https://wx.zsxq.com/dweb2/index/columns/88885815888252">https://wx.zsxq.com/dweb2/index/columns/88885815888252</a></p><p>æ•™ç¨‹æ–‡æ¡£åœ°å€ï¼š <a href="https://www.yuque.com/macrozheng/mall-learning">https://www.yuque.com/macrozheng/mall-learning</a></p><h3 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h3><h3 id="åºç« "><a href="#åºç« " class="headerlink" title="åºç« "></a>åºç« </h3><h4 id="é¡¹ç›®å­¦ä¹ æ€è·¯"><a href="#é¡¹ç›®å­¦ä¹ æ€è·¯" class="headerlink" title="é¡¹ç›®å­¦ä¹ æ€è·¯"></a>é¡¹ç›®å­¦ä¹ æ€è·¯</h4><ul><li>1ã€å…ˆå°†é¡¹ç›®è·‘èµ·æ¥</li><li>2ã€å­¦ä¹ é¡¹ç›®ä¸­ç”¨åˆ°çš„æŠ€æœ¯æ ˆå†…å®¹</li><li>3ã€é˜…è¯»é¡¹ç›®æºç </li><li>4ã€äºŒæ¬¡å¼€å‘ï¼ˆåœ¨åŸæœ‰åŠŸèƒ½åŸºç¡€ä¸Šæ”¹é€ ï¼‰</li></ul><h4 id="åŠŸèƒ½æ¦‚è§ˆ"><a href="#åŠŸèƒ½æ¦‚è§ˆ" class="headerlink" title="åŠŸèƒ½æ¦‚è§ˆ"></a>åŠŸèƒ½æ¦‚è§ˆ</h4><ul><li>å•†å“æ¨¡å—<ul><li>å•†å“ç®¡ç†</li><li>å•†å“åˆ†ç±»ç®¡ç†</li><li>å•†å“ç±»å‹ç®¡ç†</li><li>å“ç‰Œç®¡ç†</li></ul></li><li>è®¢å•æ¨¡å—<ul><li>è®¢å•ç®¡ç†</li><li>è®¢å•è®¾ç½®</li><li>é€€è´§ç”³è¯·å¤„ç†</li><li>é€€è´§åŸå› è®¾ç½®</li></ul></li><li>è¥é”€æ¨¡å—<ul><li>ç§’æ€æ´»åŠ¨ç®¡ç†</li><li>ä¼˜æƒ ä»·ç®¡ç†</li><li>å“ç‰Œæ¨èç®¡ç†</li><li>æ–°å“æ¨èç®¡ç†</li><li>äººæ°”æ¨èç®¡ç†</li><li>ä¸“é¢˜æ¨èç®¡ç†</li><li>é¦–é¡µå¹¿å‘Šç®¡ç†</li></ul></li></ul><h4 id="æ•°æ®åº“è¡¨æ¦‚è§ˆ"><a href="#æ•°æ®åº“è¡¨æ¦‚è§ˆ" class="headerlink" title="æ•°æ®åº“è¡¨æ¦‚è§ˆ"></a>æ•°æ®åº“è¡¨æ¦‚è§ˆ</h4><p>mallé¡¹ç›®ç›®å‰æœ‰71å¼ æ•°æ®è¡¨ï¼Œä¸šåŠ¡é€»è¾‘æœ‰ä¸€å®šå¤æ‚åº¦ï¼Œå¹³æ—¶åšé¡¹ç›®å‚è€ƒä¹Ÿå¤Ÿäº†ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240531190205.png" alt="image.png"></p><p>æ•°æ®åº“è¡¨å‰ç¼€è¯´æ˜</p><ul><li>cms_* ï¼šå†…å®¹ç®¡ç†æ¨¡å—ç›¸å…³è¡¨</li><li>oms_* ï¼šè®¢å•ç®¡ç†æ¨¡å—ç›¸å…³è¡¨</li><li>pms_* ï¼šå•†å“æ¨¡å—ç›¸å…³è¡¨</li><li>sms_* ï¼šè¥é”€æ¨¡å—ç›¸å…³è¡¨</li><li>ums_* ï¼šä¼šå‘˜æ¨¡å—ç›¸å…³è¡¨</li></ul><h4 id="å‰ç½®æŠ€èƒ½ç‚¹"><a href="#å‰ç½®æŠ€èƒ½ç‚¹" class="headerlink" title="å‰ç½®æŠ€èƒ½ç‚¹"></a>å‰ç½®æŠ€èƒ½ç‚¹</h4><ul><li>IDEA</li><li>Spring</li><li>SpringBoot</li><li>Mybatis</li><li>Mysql</li><li>Linux</li><li>Elasticsearch</li><li>Mongodb</li><li>Docker</li></ul><h3 id="æ¶æ„ç¯‡"><a href="#æ¶æ„ç¯‡" class="headerlink" title="æ¶æ„ç¯‡"></a>æ¶æ„ç¯‡</h3><ul><li>mall æ•´åˆ SpringBoot + MyBatis æ­å»ºåŸºæœ¬éª¨æ¶</li><li>mall æ•´åˆ Swagger-UI å®ç°åœ¨çº¿ API  æ–‡æ¡£</li><li>mall æ•´åˆ Redis å®ç°ç¼“å­˜åŠŸèƒ½</li><li>mall æ•´åˆ SpringSecurity å’Œ JWT å®ç°è®¤è¯å’Œæˆæƒ</li><li>mall æ•´åˆ SpringTask å®ç°å®šæ—¶ä»»åŠ¡</li><li>mall æ•´åˆ Elasticsearch å®ç°å•†å“æœç´¢</li><li>mall æ•´åˆ MongoDB å®ç°æ–‡æ¡£æ“ä½œ</li><li>mall æ•´åˆ RabbitMQ å®ç°å»¶è¿Ÿæ¶ˆæ¯</li><li>mall æ•´åˆ OSS å®ç°æ–‡ä»¶ä¸Šä¼ </li></ul><h4 id="é¡¹ç›®æ‹‰å–ä¸è¿è¡Œ"><a href="#é¡¹ç›®æ‹‰å–ä¸è¿è¡Œ" class="headerlink" title="é¡¹ç›®æ‹‰å–ä¸è¿è¡Œ"></a>é¡¹ç›®æ‹‰å–ä¸è¿è¡Œ</h4><h3 id="ä¸šåŠ¡ç¯‡"><a href="#ä¸šåŠ¡ç¯‡" class="headerlink" title="ä¸šåŠ¡ç¯‡"></a>ä¸šåŠ¡ç¯‡</h3><h3 id="æŠ€æœ¯è¦ç‚¹ç¯‡"><a href="#æŠ€æœ¯è¦ç‚¹ç¯‡" class="headerlink" title="æŠ€æœ¯è¦ç‚¹ç¯‡"></a>æŠ€æœ¯è¦ç‚¹ç¯‡</h3><h3 id="éƒ¨ç½²ç¯‡"><a href="#éƒ¨ç½²ç¯‡" class="headerlink" title="éƒ¨ç½²ç¯‡"></a>éƒ¨ç½²ç¯‡</h3><h3 id="å‚è€ƒç¯‡"><a href="#å‚è€ƒç¯‡" class="headerlink" title="å‚è€ƒç¯‡"></a>å‚è€ƒç¯‡</h3>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootå­¦ä¹ _å­¦ä¹ 02</title>
    <link href="/2024/05/01/SpringBoot%E5%AD%A6%E4%B9%A0_%E5%AD%A6%E4%B9%A002/"/>
    <url>/2024/05/01/SpringBoot%E5%AD%A6%E4%B9%A0_%E5%AD%A6%E4%B9%A002/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒï¼š <a href="http://svip.iocoder.cn/Spring-Boot/Interview/">http://svip.iocoder.cn/Spring-Boot/Interview/</a></p><p>çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œæ„Ÿè§‰æ”¶æ•ˆç”šå¾®ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹è¿™å¥—è§†é¢‘çš„ç›¸å…³ç¬”è®°ï¼ŒåŒæ—¶å¦‚æœåç»­è¿›è¡Œå›é¡¾çš„è¯å¸Œæœ›å¯¹äº SpringBoot æœ‰æ›´å¥½çš„ä¸€ä¸ªç†è§£å’Œå…·ä½“ä½¿ç”¨ã€‚ï¼ˆåç»­æ‰“ç®—å°†ç›¸å…³çš„æ¡†æ¶é›†æˆç›¸å…³å®é™…é¡¹ç›®ä½¿ç”¨çš„å†…å®¹æä¸€ä¸‹ï¼Œæ ¹æ®è¿™ä¸ªé¡¹ç›®ï¼š <a href="https://github.com/YunaiV/SpringBoot-Labs">https://github.com/YunaiV/SpringBoot-Labs</a> ï¼‰</p><p>è§†é¢‘åœ°å€ï¼š <a href="https://www.bilibili.com/video/BV1Fh4y1D7Aq">https://www.bilibili.com/video/BV1Fh4y1D7Aq</a></p><p>å­¦ä¹ æ—¶é—´ï¼š2024-05-01 10:49:20</p><h4 id="SpringBoot-è‡ªåŠ¨é…ç½®åŸç†"><a href="#SpringBoot-è‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="SpringBoot è‡ªåŠ¨é…ç½®åŸç†"></a>SpringBoot è‡ªåŠ¨é…ç½®åŸç†</h4><ul><li>1ã€é€šè¿‡ @SpringBootConfiguration  å¼•å…¥äº† @EnableAutoConfiguration(è´Ÿè´£å¯åŠ¨è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼‰</li><li>2ã€@EnableAutoConfiguration å¼•å…¥äº† @Import</li><li>3ã€Spring å®¹å™¨å¯åŠ¨æ—¶ï¼šåŠ è½½locå®¹å™¨æ—¶ä¼šè§£æ@Importæ³¨è§£</li><li>4ã€@Importå¯¼å…¥äº†ä¸€ä¸ªdeferredlmportSelector,å®ƒä¼šä½¿SpringBootçš„è‡ªåŠ¨é…ç½®ç±»çš„é¡ºåºåœ¨æœ€åï¼Œè¿™æ ·æ–¹ä¾¿æˆ‘ä»¬æ‰©å±•å’Œè¦†ç›–</li><li>5ã€ç„¶åè¯»å–æ‰€æœ‰çš„  &#x2F;META-INF&#x2F;spring.factories æ–‡ä»¶  <ul><li>ä¼šå»æ‰€æœ‰çš„ jar åŒ…ä¸­å’Œç±»è·¯å¾„ä¸­å»è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼ˆä¼ª SPI ï¼‰</li></ul></li><li>6ã€è¿‡æ»¤å‡ºæ‰€æœ‰AutoConfigurtionClassç±»å‹çš„ç±»</li><li>7ã€æœ€åé€šè¿‡ @Condition æ’é™¤æ— æ•ˆçš„è‡ªåŠ¨é…ç½®ç±»</li></ul><p>æ¢…ç‰¹ in For</p><p>çœ‹ä¸€ä¸‹è¿™æ®µè¯ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240502113552.png" alt="image.png"></p><p>å…³äºæ¡ä»¶è¯„ä¼°è¿™æ­¥ï¼š</p><ul><li><code>@ConditionalOnClass</code>: å½“ç±»è·¯å¾„ä¸Šå­˜åœ¨æŒ‡å®šçš„ç±»æ—¶ï¼Œç›¸å…³çš„é…ç½®æ‰ä¼šè¢«åº”ç”¨ã€‚</li><li><code>@ConditionalOnBean</code>: å½“ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨æŒ‡å®šçš„ Bean æ—¶ï¼Œç›¸å…³çš„é…ç½®æ‰ä¼šè¢«åº”ç”¨ã€‚</li><li><code>@ConditionalOnProperty</code>: å½“å­˜åœ¨æŒ‡å®šçš„é…ç½®å±æ€§ä¸”æ»¡è¶³æŒ‡å®šçš„å€¼æ—¶ï¼Œç›¸å…³çš„é…ç½®æ‰ä¼šè¢«åº”ç”¨ã€‚</li></ul><h4 id="ä¸ºä»€ä¹ˆ-SpringBoot-çš„-jar-å¯ä»¥ç›´æ¥è¿è¡Œï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-SpringBoot-çš„-jar-å¯ä»¥ç›´æ¥è¿è¡Œï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ SpringBoot çš„ jar å¯ä»¥ç›´æ¥è¿è¡Œï¼Ÿ"></a>ä¸ºä»€ä¹ˆ SpringBoot çš„ jar å¯ä»¥ç›´æ¥è¿è¡Œï¼Ÿ</h4><ul><li>1ã€SpringBootæä¾›äº†ä¸€ä¸ªæ’ä»¶ spring-boot-maven-plugin, ç”¨äºæŠŠç¨‹åºæ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jaråŒ…ã€‚</li><li>2ã€Spring Bootåº”ç”¨æ‰“åŒ…ä¹‹åï¼Œç”Ÿæˆä¸€ä¸ªFat jar(jaråŒ…ä¸­åŒ…å«jar),åŒ…å«äº†åº”ç”¨ä¾èµ–çš„ jaråŒ…å’ŒSpring Boot loaderç›¸å…³çš„ç±»ã€‚</li><li>3ã€java -jar ä¼šå»æ‰¾ jarä¸­çš„ manifestæ–‡ä»¶ï¼Œåœ¨é‚£é‡Œé¢æ‰¾åˆ°çœŸæ­£çš„å¯åŠ¨ç±»ï¼›</li><li>4ã€Fat jarçš„å¯åŠ¨Mainå‡½æ•°æ˜¯ JarLauncher, å®ƒè´Ÿè´£åˆ›å»ºä¸€ä¸ªLaunchedURLClassLoader:æ¥åŠ è½½boot-libä¸‹é¢çš„jar,å¹¶ä»¥ä¸€ä¸ªæ–°çº¿ç¨‹å¯åŠ¨åº”ç”¨çš„å¯åŠ¨ç±»çš„ Mainå‡½æ•°ï¼ˆæ‰¾åˆ° manifest ä¸­çš„ Start-Classï¼‰ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240503000739.png" alt="image.png"></p><hr><p>æš‚æ—¶æ²¡æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼Œè€Œä¸” MainClass å¯¹åº”ç›¸å…³é…ç½®ä¹Ÿæ²¡çœ‹åˆ°ï¼Œå¯èƒ½ç†è§£å’Œå®é™…æœ‰ç‚¹é—®é¢˜ã€‚</p><h4 id="SpringBoot-çš„å¯åŠ¨åŸç†"><a href="#SpringBoot-çš„å¯åŠ¨åŸç†" class="headerlink" title="SpringBoot çš„å¯åŠ¨åŸç†"></a>SpringBoot çš„å¯åŠ¨åŸç†</h4><h4 id="SpringBoot-çš„æ ¸å¿ƒæ³¨è§£"><a href="#SpringBoot-çš„æ ¸å¿ƒæ³¨è§£" class="headerlink" title="SpringBoot çš„æ ¸å¿ƒæ³¨è§£"></a>SpringBoot çš„æ ¸å¿ƒæ³¨è§£</h4><ul><li>1ã€@SpringBootApplicationæ³¨è§£ï¼šè¿™ä¸ªæ³¨è§£æ ‡è¯†äº†ä¸€ä¸ªSpringBoot.å·¥ç¨‹ï¼Œå®ƒå®é™…ä¸Šæ˜¯å¦å¤–ä¸‰ä¸ªæ³¨è§£çš„ç»„åˆï¼Œè¿™ä¸‰ä¸ªæ³¨è§£æ˜¯</li><li>2ã€@SpringBootConfiguration:è¿™ä¸ªæ³¨è§£å®é™…å°±æ˜¯ä¸€ä¸ª@Configuration,è¡¨ç¤ºå¯åŠ¨ç±»ä¹Ÿæ˜¯ä¸€ä¸ªé…ç½®ç±»</li><li>3ã€@EnableAutoConfiguration:å‘Springå®¹å™¨ä¸­å¯¼å…¥äº†ä¸€ä¸ªSelectorï¼Œç”¨æ¥åŠ è½½ ClassPath ä¸‹ SpringFactoriest ä¸­æ‰€å®šä¹‰çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå°†è¿™äº›è‡ªåŠ¨åŠ è½½ä¸ºé…ç½®Beanã€‚</li><li>4ã€@Conditionalä¹Ÿå¾ˆå…³é”®ï¼Œå¦‚æœæ²¡æœ‰å®ƒæˆ‘ä»¬æ— æ³•åœ¨è‡ªå®šä¹‰åº”ç”¨ä¸­è¿›è¡Œå®šåˆ¶å¼€å‘<ul><li>@ConditionalOnBean</li><li>@ConditionalOnClass</li><li>@ConditionalOnExpression</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡</title>
    <link href="/2024/04/25/SpringCloud_%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    <url>/2024/04/25/SpringCloud_%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<p>è§†é¢‘åœ°å€ï¼š <a href="https://www.bilibili.com/video/BV1Q4411y7ip">https://www.bilibili.com/video/BV1Q4411y7ip</a></p><p>å‚è€ƒæ–‡æ¡£ï¼š <a href="https://blog.csdn.net/hancoder/article/details/120213532">https://blog.csdn.net/hancoder/article/details/120213532</a></p><p>å»ºè®®çœ‹ä¸€ä¸‹æ——ä¸‹çš„è§†é¢‘è¯¾ä»¶æ–‡æ¡£</p><h3 id="ä¸€ã€åŸºç¡€æ¦‚å¿µ"><a href="#ä¸€ã€åŸºç¡€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºç¡€æ¦‚å¿µ"></a>ä¸€ã€åŸºç¡€æ¦‚å¿µ</h3><h4 id="CAP-ç†è®º"><a href="#CAP-ç†è®º" class="headerlink" title="CAP  ç†è®º"></a>CAP  ç†è®º</h4><p>CAPç†è®ºæ˜¯åˆ†å¸ƒå¼è®¡ç®—ä¸­çš„ä¸€ä¸ªé‡è¦ç†è®ºï¼Œç”±Eric Breweræå‡ºã€‚CAPæŒ‡çš„æ˜¯Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ã€‚ç†è®ºå£°ç§°ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³è¿™ä¸‰ä¸ªè¦æ±‚ï¼Œæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ï¼š</p><ol><li><strong>ä¸€è‡´æ€§ï¼ˆCï¼‰</strong>ï¼šæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´å…·æœ‰ç›¸åŒçš„æ•°æ®ã€‚</li><li><strong>å¯ç”¨æ€§ï¼ˆAï¼‰</strong>ï¼šä¿è¯æ¯ä¸ªè¯·æ±‚éƒ½èƒ½å¾—åˆ°ä¸€ä¸ªå“åº”ï¼Œæ— è®ºå“åº”æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚</li><li><strong>åˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼‰</strong>ï¼šç³»ç»Ÿä¸­ä»»æ„ä¿¡æ¯çš„ä¸¢å¤±æˆ–å¤±è´¥éƒ½ä¸ä¼šå½±å“ç³»ç»Ÿçš„ç»§ç»­è¿ä½œã€‚</li></ol><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§æ˜¯å¿…é¡»è¦ä¿è¯çš„ï¼Œå› ä¸ºç½‘ç»œåˆ†åŒºåœ¨å®é™…ç¯å¢ƒä¸­æ˜¯å¸¸è§çš„ï¼ˆåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç³»ç»ŸèŠ‚ç‚¹ä¹‹é—´è‚¯å®šçš„éœ€è¦æœ‰ç½‘ç»œè¿æ¥çš„ï¼Œå› æ­¤åˆ†åŒºï¼ˆP) æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼‰ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„æŠ‰æ‹©é€šå¸¸æ˜¯åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¹‹é—´åšæƒè¡¡ã€‚</p><h4 id="BASE-ç†è®º"><a href="#BASE-ç†è®º" class="headerlink" title="BASE ç†è®º"></a>BASE ç†è®º</h4><p>ç›¸å¯¹äºCAPçš„ä¸¥æ ¼è¦æ±‚ï¼ŒBASEç†è®ºæä¾›äº†ä¸€ç§è¾ƒä¸ºå®½æ¾çš„äº‹åŠ¡ä¸€è‡´æ€§æ¨¡å‹ã€‚BASEæ˜¯Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰ã€Eventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰çš„ç¼©å†™ï¼š</p><ol><li><strong>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰</strong>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§â€”â€”ä¾‹å¦‚ï¼Œå“åº”æ—¶é—´å¯èƒ½ä¼šå»¶é•¿ã€‚</li><li><strong>è½¯çŠ¶æ€ï¼ˆSoft stateï¼‰</strong>ï¼šç³»ç»Ÿçš„çŠ¶æ€ä¸éœ€è¦æ—¶åˆ»ä¸€è‡´ï¼Œå…è®¸åœ¨ä¸åŒèŠ‚ç‚¹é—´å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè€Œè¿™ç§çŠ¶æ€ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œé€æ¸ä¸€è‡´ã€‚</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually consistentï¼‰</strong>ï¼šç³»ç»Ÿä¿è¯åœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼Œæ•°æ®æœ€ç»ˆå°†æ˜¯ä¸€è‡´çš„ã€‚</li></ol><p>BASEï¼šç‰ºç‰²å¼ºä¸€è‡´æ€§ï¼Œä¿è¯å¯ç”¨æ€§ï¼Œç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p>BASEç†è®ºæ˜¯å¯¹CAPä¸­APçš„ä¸€ä¸ªæ‰©å±•ï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ï¼Œå½“å‡ºç°æ•…éšœå…è®¸éƒ¨åˆ†ä¸å¯ç”¨ä½†è¦ä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ï¼Œå…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†<code>æœ€ç»ˆä¸€è‡´æ€§</code>ã€‚æ»¡è¶³BASEç†è®ºçš„äº‹åŠ¡ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œ<strong>æŸ”æ€§äº‹åŠ¡</strong>â€ã€‚</p><h4 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h4><p>æ•°æ®åº“äº‹åŠ¡å›é¡¾ï¼šäº‹åŠ¡çš„ç‰¹æ€§æ˜¯ï¼šACIDï¼›</p><ul><li>åŸå­æ€§(Atomicity):äº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li><li>ä¸€è‡´æ€§(Consistency):äº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚</li><li>éš”ç¦»æ€§(Isolation)ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚</li><li>æŒä¹…æ€§(Durability)ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚</li></ul><hr><p>æˆ‘ä»¬éœ€è¦ç†è§£çš„æ˜¯ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼š</p><blockquote><p>åˆ†å¸ƒå¼äº‹åŠ¡äº§ç”Ÿçš„åœºæ™¯</p></blockquote><ul><li>1ã€å…¸å‹çš„åœºæ™¯ï¼šå¾®æœåŠ¡æ¶æ„<ul><li>å¾®æœåŠ¡ä¹‹é—´é€šè¿‡è¿œç¨‹è°ƒç”¨å®Œæˆäº‹åŠ¡æ“ä½œ<ul><li><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240425155013.png" alt="image.png"></li></ul></li><li>è·¨ JVM è¿›ç¨‹äº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</li></ul></li><li>2ã€å•ä½“ç³»ç»Ÿè®¿é—®å¤šä¸ªæ•°æ®åº“å®ä¾‹<ul><li>è·¨æ•°æ®åº“å®ä¾‹äº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡</li></ul></li><li>3ã€å¤šæœåŠ¡è®¿é—®åŒä¸€ä¸ªæ•°æ®åº“å®ä¾‹<ul><li>è·¨ JVM è¿›ç¨‹</li><li>ä¸¤ä¸ªå¾®æœåŠ¡æŒæœ‰äº†ä¸åŒçš„æ•°æ®åº“é“¾æ¥è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œæ­¤æ—¶äº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡ã€‚</li></ul></li></ul><h3 id="äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"><a href="#äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ" class="headerlink" title="äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"></a>äºŒã€åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</h3><p>åœ¨Javaä¸­å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œå¸¸è§çš„æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li><strong>ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰</strong>ï¼šæ˜¯XAäº‹åŠ¡çš„ä¸€ä¸ªå®ç°ï¼Œå®ƒåˆ†ä¸ºâ€œå‡†å¤‡é˜¶æ®µâ€å’Œâ€œæäº¤é˜¶æ®µâ€ï¼Œç¡®ä¿æ‰€æœ‰å‚ä¸è€…éƒ½åŒæ„æäº¤äº‹åŠ¡ã€‚è¿™ç§æ–¹å¼å¼ºè°ƒçš„æ˜¯ä¸€è‡´æ€§ï¼Œä½†ç‰ºç‰²äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</li><li><strong>è¡¥å¿äº‹åŠ¡ï¼ˆTCCï¼ŒTry-Confirm-Cancelï¼‰</strong>ï¼šè¿™ç§æ–¹å¼é¦–å…ˆæ‰§è¡Œè¯•æ“ä½œï¼Œå¦‚æœæ‰€æœ‰å‚ä¸è€…éƒ½æˆåŠŸï¼Œåˆ™è¿›è¡Œç¡®è®¤æ“ä½œï¼Œå¦åˆ™æ‰§è¡Œå–æ¶ˆæ“ä½œã€‚å®ƒé€‚åˆäºä¸šåŠ¡é€»è¾‘è¾ƒä¸ºå¤æ‚çš„ç³»ç»Ÿã€‚</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§æ¡†æ¶</strong>ï¼šå¦‚ Apache Kafka å’Œ RocketMQ ç­‰æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œé€šè¿‡å¼‚æ­¥æ¶ˆæ¯ç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™ç±»æ–¹æ³•å¼ºè°ƒçš„æ˜¯å¯ç”¨æ€§å’Œåˆ†åŒºå®¹å¿æ€§ã€‚</li><li><strong>åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶</strong>ï¼šä¾‹å¦‚ Seata ï¼Œå®ƒé€šè¿‡åˆ›å»ºåˆ†å¸ƒå¼äº‹åŠ¡åè°ƒè€…æ¥ç®¡ç†å„ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„äº‹åŠ¡ï¼Œå®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚</li></ol><h4 id="2PC-ä¸¤é˜¶æ®µæäº¤"><a href="#2PC-ä¸¤é˜¶æ®µæäº¤" class="headerlink" title="2PC ä¸¤é˜¶æ®µæäº¤"></a>2PC ä¸¤é˜¶æ®µæäº¤</h4><ul><li>ä¸¤é˜¶æ®µï¼šå‡†å¤‡é˜¶æ®µ  Prepare phaseã€æäº¤é˜¶æ®µ  comomit phase</li></ul><p>æ•°æ®åº“æ”¯æŒçš„<code>2pc</code>ã€äºŒé˜¶æ®µæäº¤ã€‘ï¼Œåˆå«åš <code>XA Transactions</code> </p><p>2PCï¼ˆTwo-phase commit protocolï¼‰ï¼Œä¸­æ–‡å«äºŒé˜¶æ®µæäº¤ã€‚Â <strong>äºŒé˜¶æ®µæäº¤æ˜¯ä¸€ç§å¼ºä¸€è‡´æ€§è®¾è®¡</strong>ï¼Œ2PC å¼•å…¥ä¸€ä¸ªäº‹åŠ¡åè°ƒè€…çš„è§’è‰²æ¥åè°ƒç®¡ç†å„å‚ä¸è€…ï¼ˆä¹Ÿå¯ç§°ä¹‹ä¸ºå„æœ¬åœ°èµ„æºï¼‰çš„æäº¤å’Œå›æ»šï¼ŒäºŒé˜¶æ®µåˆ†åˆ«æŒ‡çš„æ˜¯å‡†å¤‡ï¼ˆæŠ•ç¥¨ï¼‰å’Œæäº¤ä¸¤ä¸ªé˜¶æ®µã€‚</p><p>XAï¼šå¼ºä¸€è‡´æ€§ï¼Œæ¯”è¾ƒé€‚â½¤äºæ‰§â¾æ—¶é—´ç¡®å®šçš„çŸ­äº‹åŠ¡ï¼Œæ•´ä½“æ€§èƒ½æ¯”è¾ƒå·®ã€‚</p><p>åœ¨è®¡ç®—æœºä¸­éƒ¨åˆ†å…³ç³»æ•°æ®åº“å¦‚Oracleã€MySQLæ”¯æŒä¸¤é˜¶æ®µæäº¤åè®®ï¼š</p><ul><li><ol><li>å‡†å¤‡é˜¶æ®µï¼ˆPrepare phaseï¼‰ï¼šäº‹åŠ¡ç®¡ç†å™¨ç»™æ¯ä¸ªå‚ä¸è€…å‘é€Prepareæ¶ˆæ¯ï¼Œæ¯ä¸ªæ•°æ®åº“å‚ä¸è€…åœ¨æœ¬åœ°æ‰§è¡Œäº‹åŠ¡ï¼Œå¹¶å†™æœ¬åœ°çš„Undo&#x2F;Redoæ—¥å¿—ï¼Œæ­¤æ—¶äº‹åŠ¡æ²¡æœ‰æäº¤ã€‚</li></ol><ul><li>ï¼ˆUndoæ—¥å¿—æ˜¯è®°å½•ä¿®æ”¹å‰çš„æ•°æ®ï¼Œç”¨äºæ•°æ®åº“å›æ»šï¼ŒRedoæ—¥å¿—æ˜¯è®°å½•ä¿®æ”¹åçš„æ•°æ®ï¼Œç”¨äºæäº¤äº‹åŠ¡åå†™å…¥æ•°æ®æ–‡ä»¶ï¼‰</li></ul></li><li><ol start="2"><li>æäº¤é˜¶æ®µï¼ˆcommit phaseï¼‰ï¼šå¦‚æœäº‹åŠ¡ç®¡ç†å™¨æ”¶åˆ°äº†å‚ä¸è€…çš„æ‰§è¡Œå¤±è´¥æˆ–è€…è¶…æ—¶æ¶ˆæ¯æ—¶ï¼Œç›´æ¥ç»™æ¯ä¸ªå‚ä¸è€…å‘é€å›æ»š(Rollback)æ¶ˆæ¯ï¼›å¦åˆ™ï¼Œå‘é€æäº¤(Commit)æ¶ˆæ¯ï¼›å‚ä¸è€…æ ¹æ®äº‹åŠ¡ç®¡ç†å™¨çš„æŒ‡ä»¤æ‰§è¡Œæäº¤æˆ–è€…å›æ»šæ“ä½œï¼Œå¹¶é‡Šæ”¾äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„é”èµ„æºã€‚æ³¨æ„:å¿…é¡»åœ¨æœ€åé˜¶æ®µé‡Šæ”¾é”èµ„æºã€‚</li></ol></li></ul><p>å¦‚æœä»»ä¸€èµ„æºç®¡ç†å™¨åœ¨ç¬¬ä¸€é˜¶æ®µè¿”å›å‡†å¤‡å¤±è´¥ï¼Œé‚£ä¹ˆäº‹åŠ¡ç®¡ç†å™¨ä¼šè¦æ±‚æ‰€æœ‰èµ„æºç®¡ç†å™¨åœ¨ç¬¬äºŒé˜¶æ®µæ‰§è¡Œå›æ»šæ“ä½œã€‚é€šè¿‡äº‹åŠ¡ç®¡ç†å™¨çš„ä¸¤é˜¶æ®µåè°ƒï¼Œæœ€ç»ˆæ‰€æœ‰èµ„æºç®¡ç†å™¨è¦ä¹ˆå…¨éƒ¨æäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šï¼Œæœ€ç»ˆçŠ¶æ€éƒ½æ˜¯ä¸€è‡´çš„</p><h4 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h4><h4 id="Seata"><a href="#Seata" class="headerlink" title="Seata"></a>Seata</h4><h4 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a>MQ</h4><h3 id="ä¸‰ã€Seata-çš„ä½¿ç”¨ç¤ºä¾‹"><a href="#ä¸‰ã€Seata-çš„ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä¸‰ã€Seata çš„ä½¿ç”¨ç¤ºä¾‹"></a>ä¸‰ã€Seata çš„ä½¿ç”¨ç¤ºä¾‹</h3><h4 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h4><p>æ–‡æ¡£ï¼š <a href="https://seata.apache.org/zh-cn/blog/seata-quick-start/">https://seata.apache.org/zh-cn/blog/seata-quick-start/</a></p><p>Seata æ˜¯<strong>é˜¿é‡Œ</strong>å¼€æºçš„ä¸€æ¬¾å¼€æºçš„<strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡</p><p>äº‹åŠ¡æ¨¡å¼</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426182642.png" alt="image.png"></p><p>Seata çš„è§’è‰²</p><ul><li><strong>TC</strong>Â (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€…ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨<strong>å…¨å±€äº‹åŠ¡</strong>æäº¤æˆ–å›æ»šã€‚</li><li><strong>TM</strong>Â (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ï¼šå®šä¹‰<strong>å…¨å±€äº‹åŠ¡</strong>çš„èŒƒå›´ï¼Œå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</li><li><strong>RM</strong>Â ( Resource Manager ) - èµ„æºç®¡ç†å™¨ï¼šç®¡ç†<strong>åˆ†æ”¯äº‹åŠ¡</strong>å¤„ç†çš„èµ„æº( Resource )ï¼Œä¸ TC äº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨<strong>åˆ†æ”¯äº‹åŠ¡</strong>æäº¤æˆ–å›æ»šã€‚</li></ul><p>å…¶ä¸­ï¼ŒTC ä¸ºå•ç‹¬éƒ¨ç½²çš„Â <strong>Server</strong>Â æœåŠ¡ç«¯ï¼ŒTM å’Œ RM ä¸ºåµŒå…¥åˆ°åº”ç”¨ä¸­çš„Â <strong>Client</strong>Â å®¢æˆ·ç«¯</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426182814.png" alt="image.png"></p><p>åˆ†å¸ƒå¼äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426183259.png" alt="image.png"></p><ul><li>TM è¯·æ±‚ TC å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ã€‚TC ä¼šç”Ÿæˆä¸€ä¸ªÂ <strong>XID</strong>Â ä½œä¸ºè¯¥å…¨å±€äº‹åŠ¡çš„ç¼–å·ã€‚<ul><li><strong>XID</strong>ï¼Œä¼šåœ¨å¾®æœåŠ¡çš„è°ƒç”¨é“¾è·¯ä¸­ä¼ æ’­ï¼Œä¿è¯å°†å¤šä¸ªå¾®æœåŠ¡çš„å­äº‹åŠ¡å…³è”åœ¨ä¸€èµ·ã€‚</li></ul></li><li>RM è¯·æ±‚ TC å°†æœ¬åœ°äº‹åŠ¡æ³¨å†Œä¸ºå…¨å±€äº‹åŠ¡çš„åˆ†æ”¯äº‹åŠ¡ï¼Œé€šè¿‡å…¨å±€äº‹åŠ¡çš„Â <strong>XID</strong>Â è¿›è¡Œå…³è”ã€‚</li><li>TM è¯·æ±‚ TC å‘Šè¯‰Â <strong>XID</strong>Â å¯¹åº”çš„å…¨å±€äº‹åŠ¡æ˜¯è¿›è¡Œæäº¤è¿˜æ˜¯å›æ»šã€‚</li><li>TC é©±åŠ¨ RM ä»¬å°†Â <strong>XID</strong>Â å¯¹åº”çš„è‡ªå·±çš„æœ¬åœ°äº‹åŠ¡è¿›è¡Œæäº¤è¿˜æ˜¯å›æ»šã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240427230315.png" alt="image.png"></p><hr><h4 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h4><p>è™šæ‹Ÿæœºå®‰è£…ä¸€ä¸‹  MySQL 5.7 ã€Nacos 1.3.2 ç‰ˆæœ¬</p><h5 id="éƒ¨ç½²å•æœº-TC-Server"><a href="#éƒ¨ç½²å•æœº-TC-Server" class="headerlink" title="éƒ¨ç½²å•æœº TC Server"></a>éƒ¨ç½²å•æœº TC Server</h5><p>Â TC éœ€è¦è¿›è¡Œå…¨å±€äº‹åŠ¡å’Œåˆ†æ”¯äº‹åŠ¡çš„è®°å½•ï¼Œæ‰€ä»¥éœ€è¦å¯¹åº”çš„<strong>å­˜å‚¨</strong>ã€‚ç›®å‰ï¼ŒTC æœ‰ä¸¤ç§å­˜å‚¨æ¨¡å¼(Â <code>store.mode</code>Â )ï¼š</p><ul><li>file æ¨¡å¼ï¼šé€‚åˆ<strong>å•æœº</strong>æ¨¡å¼ï¼Œå…¨å±€äº‹åŠ¡ä¼šè¯ä¿¡æ¯åœ¨<strong>å†…å­˜</strong>ä¸­è¯»å†™ï¼Œå¹¶æŒä¹…åŒ–æœ¬åœ°æ–‡ä»¶Â <code>root.data</code>ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚</li><li>db æ¨¡å¼ï¼šé€‚åˆ<strong>é›†ç¾¤</strong>æ¨¡å¼ï¼Œå…¨å±€äº‹åŠ¡ä¼šè¯ä¿¡æ¯é€šè¿‡Â <strong>db</strong>Â å…±äº«ï¼Œç›¸å¯¹æ€§èƒ½å·®ç‚¹ã€‚</li></ul><p>è¿™ä¸ªä¸ç”¨ç®¡ï¼Œå†™çš„æœ‰ç‚¹é—®é¢˜ ğŸ‘†</p><blockquote><p>Seata æœåŠ¡</p></blockquote><p>æ ¹æ®é¡¹ç›®çš„ä»‹ç»æ–‡æ¡£ï¼Œè¿™é‡Œä¸‹è½½ 1.3 ç‰ˆæœ¬çš„ seata çš„æœåŠ¡</p><p>è¿™é‡Œå…ˆä¸ç”¨ docker çš„æ–¹å¼ï¼Œæœ‰ç‚¹ç†è§£é—®é¢˜ï¼Œå…ˆä½¿ç”¨ä¸€ä¸‹ windows ä¸‹çš„ zip æ–¹å¼</p><p>å‚è€ƒï¼š <a href="https://github.com/WinterChenS/spring-cloud-hoxton-study/blob/main/doc/SpringCloud%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B(%E5%85%AB)%E4%B9%8B%E6%95%B4%E5%90%88seata%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.md">https://github.com/WinterChenS/spring-cloud-hoxton-study/blob/main/doc/SpringCloud%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B(%E5%85%AB)%E4%B9%8B%E6%95%B4%E5%90%88seata%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1.md</a></p><p>ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/apache/incubator-seata/releases?page=2">https://github.com/apache/incubator-seata/releases?page=2</a></p><p>windowä¸‹è½½zipï¼Œlinux&#x2F;macä¸‹è½½tar.gz</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426091449.png" alt="image.png"></p><h6 id="å‰æœŸå‡†å¤‡"><a href="#å‰æœŸå‡†å¤‡" class="headerlink" title="å‰æœŸå‡†å¤‡"></a>å‰æœŸå‡†å¤‡</h6><p>è¿™é‡Œå°±ä¸‹è½½ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œå¹¶å°†æ•°æ®åº“æ–‡ä»¶æ‰§è¡Œä¸€ä¸‹ï¼Œwindows çš„ç›¸å…³æ“ä½œå…ˆä¸ç®¡</p><p>çœ‹åˆ°ä¸€ä¸ªå¾ˆä¸é”™çš„é¡¹ç›®ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ä¸‹å®ƒï¼š<a href="https://github.com/YunaiV/SpringBoot-Labs">https://github.com/YunaiV/SpringBoot-Labs</a>Â çš„Â <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-17">labx-17</a>Â ç›®å½•</p><p>seata + openfeign</p><p>æ”¹ä¸€ä¸‹è¿™ä¸ª pom æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--    &lt;parent&gt;--&gt;</span>  <br><span class="hljs-comment">&lt;!--        &lt;artifactId&gt;labx-17&lt;/artifactId&gt;--&gt;</span>  <br><span class="hljs-comment">&lt;!--        &lt;groupId&gt;cn.iocoder.springboot.labs&lt;/groupId&gt;--&gt;</span>  <br><span class="hljs-comment">&lt;!--        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;--&gt;</span>  <br><span class="hljs-comment">&lt;!--    &lt;/parent&gt;--&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.iocoder.springboot.labs<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>labx-17-sc-seata-at-feign-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ data.sql æ–‡ä»¶</p><p>éƒ¨ç½²è¿‡ç¨‹çœ‹ä¸€ä¸‹è¿™ä¸ªè§†é¢‘ï¼ŒæŒºè¯¦ç»†çš„ï¼š <a href="https://www.bilibili.com/video/BV1wW4y147k3">https://www.bilibili.com/video/BV1wW4y147k3</a></p><p>æ”¹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ–‡ä»¶çš„é…ç½®å†…å®¹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426194656.png" alt="image.png"></p><p>file.conf</p><p>ä¿®æ”¹é…ç½®ä¸ºé€šè¿‡ db çš„æ–¹å¼ï¼Œæ”¹ä¸€ä¸‹ mysql ç›¸å…³çš„é…ç½®æ–‡ä»¶å†…å®¹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426194815.png" alt="image.png"></p><p>å¯¹åº”æ•°æ®åº“ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹è„šæœ¬æ–‡ä»¶ï¼š <a href="https://github.com/apache/incubator-seata/blob/1.3.0/script/server/db/mysql.sql">https://github.com/apache/incubator-seata/blob/1.3.0/script/server/db/mysql.sql</a></p><p>å…ˆåˆ›å»ºä¸€ä¸‹æ•°æ®åº“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426201234.png" alt="image.png"></p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">-- -------------------------------- The script used when storeMode is &#x27;db&#x27; --------------------------------<br>-- the table to store GlobalSession data<br>CREATE TABLE IF <span class="hljs-literal">NOT</span> EXISTS `global_table`<br>(<br>    `xid`                       VARCHAR(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL,<br>    `transaction_id`            BIGINT,<br>    `status`                    TINYINT      <span class="hljs-literal">NOT</span> NULL,<br>    `application_id`            VARCHAR(<span class="hljs-number">32</span>),<br>    `transaction_service_group` VARCHAR(<span class="hljs-number">32</span>),<br>    `transaction_name`          VARCHAR(<span class="hljs-number">128</span>),<br>    `timeout`                   INT,<br>    `begin_time`                BIGINT,<br>    `application_data`          VARCHAR(<span class="hljs-number">2000</span>),<br>    `gmt_create`                DATETIME,<br>    `gmt_modified`              DATETIME,<br>    PRIMARY KEY (`xid`),<br>    KEY `idx_gmt_modified_status` (`gmt_modified`, `status`),<br>    KEY `idx_transaction_id` (`transaction_id`)<br>) ENGINE = InnoDB<br>  DEFAULT CHARSET = utf8<span class="hljs-comment">;</span><br><br>-- the table to store BranchSession data<br>CREATE TABLE IF <span class="hljs-literal">NOT</span> EXISTS `branch_table`<br>(<br>    `branch_id`         BIGINT       <span class="hljs-literal">NOT</span> NULL,<br>    `xid`               VARCHAR(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL,<br>    `transaction_id`    BIGINT,<br>    `resource_group_id` VARCHAR(<span class="hljs-number">32</span>),<br>    `resource_id`       VARCHAR(<span class="hljs-number">256</span>),<br>    `branch_type`       VARCHAR(<span class="hljs-number">8</span>),<br>    `status`            TINYINT,<br>    `client_id`         VARCHAR(<span class="hljs-number">64</span>),<br>    `application_data`  VARCHAR(<span class="hljs-number">2000</span>),<br>    `gmt_create`        DATETIME(<span class="hljs-number">6</span>),<br>    `gmt_modified`      DATETIME(<span class="hljs-number">6</span>),<br>    PRIMARY KEY (`branch_id`),<br>    KEY `idx_xid` (`xid`)<br>) ENGINE = InnoDB<br>  DEFAULT CHARSET = utf8<span class="hljs-comment">;</span><br><br>-- the table to store lock data<br>CREATE TABLE IF <span class="hljs-literal">NOT</span> EXISTS `lock_table`<br>(<br>    `row_key`        VARCHAR(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL,<br>    `xid`            VARCHAR(<span class="hljs-number">96</span>),<br>    `transaction_id` BIGINT,<br>    `branch_id`      BIGINT       <span class="hljs-literal">NOT</span> NULL,<br>    `resource_id`    VARCHAR(<span class="hljs-number">256</span>),<br>    `table_name`     VARCHAR(<span class="hljs-number">32</span>),<br>    `pk`             VARCHAR(<span class="hljs-number">36</span>),<br>    `gmt_create`     DATETIME,<br>    `gmt_modified`   DATETIME,<br>    PRIMARY KEY (`row_key`),<br>    KEY `idx_branch_id` (`branch_id`)<br>) ENGINE = InnoDB<br>  DEFAULT CHARSET = utf8<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>registry.conf</p><p>æ”¹ä¸€ä¸‹é…ç½®ä¸­å¿ƒå’Œæ³¨å†Œä¸­å¿ƒçš„é…ç½®å†…å®¹</p><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-keyword">registry</span> &#123;<br>  <span class="hljs-comment"># file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa</span><br>  <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;nacos&quot;</span><br><br>  nacos &#123;<br>    application = <span class="hljs-string">&quot;seata-server&quot;</span><br>    serverAddr = <span class="hljs-string">&quot;192.168.56.105:8848&quot;</span><br>    <span class="hljs-literal">group</span> = <span class="hljs-string">&quot;SEATA_GROUP&quot;</span><br><span class="hljs-comment">#ä¸å†™é»˜è®¤æ˜¯ public</span><br>    namespace = <span class="hljs-string">&quot;&quot;</span>  <br>    cluster = <span class="hljs-string">&quot;default&quot;</span><br>    username = <span class="hljs-string">&quot;nacos&quot;</span><br>    <span class="hljs-literal">password</span> = <span class="hljs-string">&quot;nacos&quot;</span><br>  &#125;<br>  ...<br><span class="hljs-keyword">config</span> &#123;<br>  <span class="hljs-comment"># fileã€nacos ã€apolloã€zkã€consulã€etcd3</span><br>  <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;nacos&quot;</span><br><br>  nacos &#123;<br>    serverAddr = <span class="hljs-string">&quot;192.168.56.105:8848&quot;</span><br>    namespace = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-literal">group</span> = <span class="hljs-string">&quot;SEATA_GROUP&quot;</span><br>    username = <span class="hljs-string">&quot;nacos&quot;</span><br>    <span class="hljs-literal">password</span> = <span class="hljs-string">&quot;nacos&quot;</span><br>    dataId = <span class="hljs-string">&quot;seataServer.properties&quot;</span> <br>  &#125;<br>  ...<br></code></pre></td></tr></table></figure><p>åœ¨ nacos ä¸­æ·»åŠ é…ç½®æ–‡ä»¶</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426202340.png" alt="image.png"></p><p>é…ç½®å†…å®¹ï¼š <a href="https://github.com/apache/incubator-seata/blob/1.3.0/script/config-center/config.txt">https://github.com/apache/incubator-seata/blob/1.3.0/script/config-center/config.txt</a></p><p>å¾®æ”¹äº†ä¸€ä¸‹ï¼Œåé¢æœ‰éœ€è¦å†è¿›è¡Œæ”¹åŠ¨</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">transport.type</span>=TCP<br><span class="hljs-attr">transport.server</span>=NIO<br><span class="hljs-attr">transport.heartbeat</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">transport.enableClientBatchSendRequest</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">transport.threadFactory.bossThreadPrefix</span>=NettyBoss<br><span class="hljs-attr">transport.threadFactory.workerThreadPrefix</span>=NettyServerNIOWorker<br><span class="hljs-attr">transport.threadFactory.serverExecutorThreadPrefix</span>=NettyServerBizHandler<br><span class="hljs-attr">transport.threadFactory.shareBossWorker</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">transport.threadFactory.clientSelectorThreadPrefix</span>=NettyClientSelector<br><span class="hljs-attr">transport.threadFactory.clientSelectorThreadSize</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">transport.threadFactory.clientWorkerThreadPrefix</span>=NettyClientWorkerThread<br><span class="hljs-attr">transport.threadFactory.bossThreadSize</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">transport.threadFactory.workerThreadSize</span>=default<br><span class="hljs-attr">transport.shutdown.wait</span>=<span class="hljs-number">3</span><br><span class="hljs-attr">service.vgroupMapping.my_test_tx_group</span>=default<br><span class="hljs-comment"># ç«¯å£ 8091 é€šå¸¸ç”¨äº Seata æœåŠ¡çš„é»˜è®¤é€šä¿¡ç«¯å£</span><br><span class="hljs-attr">service.default.grouplist</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8091</span><br><span class="hljs-attr">service.enableDegrade</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">service.disableGlobalTransaction</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.rm.asyncCommitBufferLimit</span>=<span class="hljs-number">10000</span><br><span class="hljs-attr">client.rm.lock.retryInterval</span>=<span class="hljs-number">10</span><br><span class="hljs-attr">client.rm.lock.retryTimes</span>=<span class="hljs-number">30</span><br><span class="hljs-attr">client.rm.lock.retryPolicyBranchRollbackOnConflict</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">client.rm.reportRetryCount</span>=<span class="hljs-number">5</span><br><span class="hljs-attr">client.rm.tableMetaCheckEnable</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.rm.sqlParserType</span>=druid<br><span class="hljs-attr">client.rm.reportSuccessEnable</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.rm.sagaBranchRegisterEnable</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.tm.commitRetryCount</span>=<span class="hljs-number">5</span><br><span class="hljs-attr">client.tm.rollbackRetryCount</span>=<span class="hljs-number">5</span><br><span class="hljs-attr">client.tm.degradeCheck</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.tm.degradeCheckAllowTimes</span>=<span class="hljs-number">10</span><br><span class="hljs-attr">client.tm.degradeCheckPeriod</span>=<span class="hljs-number">2000</span><br><span class="hljs-attr">store.mode</span>=file<br><span class="hljs-attr">store.file.dir</span>=file_store/data<br><span class="hljs-attr">store.file.maxBranchSessionSize</span>=<span class="hljs-number">16384</span><br><span class="hljs-attr">store.file.maxGlobalSessionSize</span>=<span class="hljs-number">512</span><br><span class="hljs-attr">store.file.fileWriteBufferCacheSize</span>=<span class="hljs-number">16384</span><br><span class="hljs-attr">store.file.flushDiskMode</span>=async<br><span class="hljs-attr">store.file.sessionReloadReadSize</span>=<span class="hljs-number">100</span><br><span class="hljs-attr">store.db.datasource</span>=druid<br><span class="hljs-attr">store.db.dbType</span>=mysql<br><span class="hljs-attr">store.db.driverClassName</span>=com.mysql.jdbc.Driver<br><span class="hljs-attr">store.db.url</span>=jdbc:mysql://<span class="hljs-number">192.168</span>.<span class="hljs-number">56.105</span>:<span class="hljs-number">3306</span>/seata?useUnicode=<span class="hljs-literal">true</span><br><span class="hljs-attr">store.db.user</span>=username<br><span class="hljs-attr">store.db.password</span>=password<br><span class="hljs-attr">store.db.minConn</span>=<span class="hljs-number">5</span><br><span class="hljs-attr">store.db.maxConn</span>=<span class="hljs-number">30</span><br><span class="hljs-attr">store.db.globalTable</span>=global_table<br><span class="hljs-attr">store.db.branchTable</span>=branch_table<br><span class="hljs-attr">store.db.queryLimit</span>=<span class="hljs-number">100</span><br><span class="hljs-attr">store.db.lockTable</span>=lock_table<br><span class="hljs-attr">store.db.maxWait</span>=<span class="hljs-number">5000</span><br><span class="hljs-attr">store.redis.host</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><span class="hljs-attr">store.redis.port</span>=<span class="hljs-number">6379</span><br><span class="hljs-attr">store.redis.maxConn</span>=<span class="hljs-number">10</span><br><span class="hljs-attr">store.redis.minConn</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">store.redis.database</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">store.redis.password</span>=null<br><span class="hljs-attr">store.redis.queryLimit</span>=<span class="hljs-number">100</span><br><span class="hljs-attr">server.recovery.committingRetryPeriod</span>=<span class="hljs-number">1000</span><br><span class="hljs-attr">server.recovery.asynCommittingRetryPeriod</span>=<span class="hljs-number">1000</span><br><span class="hljs-attr">server.recovery.rollbackingRetryPeriod</span>=<span class="hljs-number">1000</span><br><span class="hljs-attr">server.recovery.timeoutRetryPeriod</span>=<span class="hljs-number">1000</span><br><span class="hljs-attr">server.maxCommitRetryTimeout</span>=-<span class="hljs-number">1</span><br><span class="hljs-attr">server.maxRollbackRetryTimeout</span>=-<span class="hljs-number">1</span><br><span class="hljs-attr">server.rollbackRetryTimeoutUnlockEnable</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.undo.dataValidation</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">client.undo.logSerialization</span>=jackson<br><span class="hljs-attr">client.undo.onlyCareUpdateColumns</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">server.undo.logSaveDays</span>=<span class="hljs-number">7</span><br><span class="hljs-attr">server.undo.logDeletePeriod</span>=<span class="hljs-number">86400000</span><br><span class="hljs-attr">client.undo.logTable</span>=undo_log<br><span class="hljs-attr">client.log.exceptionRate</span>=<span class="hljs-number">100</span><br><span class="hljs-attr">transport.serialization</span>=seata<br><span class="hljs-attr">transport.compressor</span>=none<br><span class="hljs-attr">metrics.enabled</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">metrics.registryType</span>=compact<br><span class="hljs-attr">metrics.exporterList</span>=prometheus<br><span class="hljs-attr">metrics.exporterPrometheusPort</span>=<span class="hljs-number">9898</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨æ“ä½œ</p><p>ç›´æ¥ç‚¹å‡» seata-server.bat æ–‡ä»¶è¿›è¡Œå¯åŠ¨æ“ä½œ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426202545.png" alt="image.png"></p><p>æŸ¥çœ‹æœåŠ¡å®ä¾‹ï¼Œå‘ç°æ˜¯å·²ç»åœ¨æœåŠ¡åˆ—è¡¨äº†</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426202627.png" alt="image.png"></p><p>ç„¶åå†å¯åŠ¨ä¸€ä¸‹å®¢æˆ·ç«¯ï¼Œå¯åŠ¨å‰å…ˆè¿‡ä¸€ä¸‹åŸºç¡€æ¦‚å¿µå†…å®¹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240427230315.png" alt="image.png"></p><p>å¯åŠ¨å®¢æˆ·ç«¯æœ‰æŠ¥é”™ä¿¡æ¯</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">2024</span>-<span class="hljs-number">04</span>-<span class="hljs-number">27</span> <span class="hljs-number">23</span>:<span class="hljs-number">03</span>:<span class="hljs-number">46.363</span> ERROR <span class="hljs-number">15912</span> --- <span class="hljs-selector-attr">[imeoutChecker_2]</span> <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.s</span><span class="hljs-selector-class">.c</span><span class="hljs-selector-class">.r</span><span class="hljs-selector-class">.netty</span><span class="hljs-selector-class">.NettyClientChannelManager</span>  : no available service <span class="hljs-string">&#x27;default&#x27;</span> found, please make sure registry config correct<br></code></pre></td></tr></table></figure><h6 id="éƒ¨ç½²-æœåŠ¡ç«¯-TC"><a href="#éƒ¨ç½²-æœåŠ¡ç«¯-TC" class="headerlink" title="éƒ¨ç½² æœåŠ¡ç«¯ TC"></a>éƒ¨ç½² æœåŠ¡ç«¯ TC</h6><p>æœ‰é—®é¢˜ï¼Œè¿™é‡Œæ”¹ä¸€ä¸‹ä¸º docker çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦æ˜¯ TC ç«¯çš„é—®é¢˜ï¼ˆçœ‹å¾ˆå¤šæ˜¯å¯ä»¥è¿›è¡Œä¸€ä¸ª config.txt æ–‡ä»¶æ¨é€çš„ï¼‰</p><p>è¿™é‡Œä½¿ç”¨ docker çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> pull seataio/seata-server:<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>éƒ¨ç½²å‚è€ƒï¼š </p><ul><li><a href="https://seata.apache.org/zh-cn/docs/ops/deploy-by-docker/">https://seata.apache.org/zh-cn/docs/ops/deploy-by-docker/</a></li><li><a href="https://www.cnblogs.com/lvlinguang/p/17038658.html#1docker%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85">https://www.cnblogs.com/lvlinguang/p/17038658.html#1docker%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85</a></li></ul><p>æ–°å»ºç›®å½•</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino">mkdir -p /home/apps/seata/config<br><br># è¿›å…¥ç›®å½•<br>cd /home/apps/seata/config<br></code></pre></td></tr></table></figure><p><strong>nacos ä¸­æ–°å»ºä¸€ä¸ª seata çš„å‘½åç©ºé—´</strong></p><p>æ–°å»º registry.conf</p><ul><li>githubåœ°å€ï¼š<a href="https://github.com/seata/seata/blob/1.3.0/server/src/main/resources/registry.conf">https://github.com/seata/seata/blob/1.3.0/server/src/main/resources/registry.conf</a></li></ul><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-comment"># æ³¨å†Œä¸­å¿ƒ</span><br><span class="hljs-keyword">registry</span> &#123;<br>  <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;nacos&quot;</span><br>  nacos &#123;<br>    application = <span class="hljs-string">&quot;seata-server&quot;</span><br>    serverAddr = <span class="hljs-string">&quot;192.168.56.105:8848&quot;</span><br>    <span class="hljs-literal">group</span> = <span class="hljs-string">&quot;SEATA_GROUP&quot;</span><br>    namespace = <span class="hljs-string">&quot;6487cc37-2434-4574-81f9-83d2c2fb0dd5&quot;</span><br>    cluster = <span class="hljs-string">&quot;default&quot;</span><br>    username = <span class="hljs-string">&quot;nacos&quot;</span><br>    <span class="hljs-literal">password</span> = <span class="hljs-string">&quot;nacos&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># é…ç½®ä¸­å¿ƒ</span><br><span class="hljs-keyword">config</span> &#123;<br>  <span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;nacos&quot;</span><br>  nacos &#123;<br>    serverAddr = <span class="hljs-string">&quot;192.168.56.105:8848&quot;</span><br>    namespace = <span class="hljs-string">&quot;6487cc37-2434-4574-81f9-83d2c2fb0dd5&quot;</span><br>    <span class="hljs-literal">group</span> = <span class="hljs-string">&quot;SEATA_GROUP&quot;</span><br>    username = <span class="hljs-string">&quot;nacos&quot;</span><br>    <span class="hljs-literal">password</span> = <span class="hljs-string">&quot;nacos&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨å‘½ä»¤</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> \<br>-d \<br>--name seata-server \<br><span class="hljs-attribute">--restart</span>=always \<br><span class="hljs-attribute">--privileged</span>=<span class="hljs-literal">true</span> \<br>-p 8091:8091 \<br>-e <span class="hljs-attribute">SEATA_IP</span>=192.168.56.105 \<br>-e <span class="hljs-attribute">SEATA_PORT</span>=8091 \<br>-e <span class="hljs-attribute">SEATA_CONFIG_NAME</span>=file:/root/seata-config/registry \<br>-v /home/apps/seata/config:/root/seata-config  \<br>seataio/seata-server:1.3.0<br></code></pre></td></tr></table></figure><h6 id="æ¨é€é…ç½®ä¿¡æ¯"><a href="#æ¨é€é…ç½®ä¿¡æ¯" class="headerlink" title="æ¨é€é…ç½®ä¿¡æ¯"></a>æ¨é€é…ç½®ä¿¡æ¯</h6><p>ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/seata/seata/tree/1.3.0">https://github.com/seata/seata/tree/1.3.0</a></p><p>ç›®å½•ï¼š incubator-seata-1.3.0\script\config-center\config.txt</p><p>config.txt</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">transport.type</span>=TCP<br><span class="hljs-attr">transport.server</span>=NIO<br><span class="hljs-attr">transport.heartbeat</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">transport.enableClientBatchSendRequest</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">transport.threadFactory.bossThreadPrefix</span>=NettyBoss<br><span class="hljs-attr">transport.threadFactory.workerThreadPrefix</span>=NettyServerNIOWorker<br><span class="hljs-attr">transport.threadFactory.serverExecutorThreadPrefix</span>=NettyServerBizHandler<br><span class="hljs-attr">transport.threadFactory.shareBossWorker</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">transport.threadFactory.clientSelectorThreadPrefix</span>=NettyClientSelector<br><span class="hljs-attr">transport.threadFactory.clientSelectorThreadSize</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">transport.threadFactory.clientWorkerThreadPrefix</span>=NettyClientWorkerThread<br><span class="hljs-attr">transport.threadFactory.bossThreadSize</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">transport.threadFactory.workerThreadSize</span>=default<br><span class="hljs-attr">transport.shutdown.wait</span>=<span class="hljs-number">3</span><br><span class="hljs-attr">service.vgroupMapping.my_test_tx_group</span>=default<br><span class="hljs-attr">service.default.grouplist</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8091</span><br><span class="hljs-attr">service.enableDegrade</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">service.disableGlobalTransaction</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.rm.asyncCommitBufferLimit</span>=<span class="hljs-number">10000</span><br><span class="hljs-attr">client.rm.lock.retryInterval</span>=<span class="hljs-number">10</span><br><span class="hljs-attr">client.rm.lock.retryTimes</span>=<span class="hljs-number">30</span><br><span class="hljs-attr">client.rm.lock.retryPolicyBranchRollbackOnConflict</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">client.rm.reportRetryCount</span>=<span class="hljs-number">5</span><br><span class="hljs-attr">client.rm.tableMetaCheckEnable</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.rm.sqlParserType</span>=druid<br><span class="hljs-attr">client.rm.reportSuccessEnable</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.rm.sagaBranchRegisterEnable</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.tm.commitRetryCount</span>=<span class="hljs-number">5</span><br><span class="hljs-attr">client.tm.rollbackRetryCount</span>=<span class="hljs-number">5</span><br><span class="hljs-attr">client.tm.degradeCheck</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.tm.degradeCheckAllowTimes</span>=<span class="hljs-number">10</span><br><span class="hljs-attr">client.tm.degradeCheckPeriod</span>=<span class="hljs-number">2000</span><br><span class="hljs-attr">store.mode</span>=file<br><span class="hljs-attr">store.file.dir</span>=file_store/data<br><span class="hljs-attr">store.file.maxBranchSessionSize</span>=<span class="hljs-number">16384</span><br><span class="hljs-attr">store.file.maxGlobalSessionSize</span>=<span class="hljs-number">512</span><br><span class="hljs-attr">store.file.fileWriteBufferCacheSize</span>=<span class="hljs-number">16384</span><br><span class="hljs-attr">store.file.flushDiskMode</span>=async<br><span class="hljs-attr">store.file.sessionReloadReadSize</span>=<span class="hljs-number">100</span><br><span class="hljs-attr">store.db.datasource</span>=druid<br><span class="hljs-attr">store.db.dbType</span>=mysql<br><span class="hljs-attr">store.db.driverClassName</span>=com.mysql.jdbc.Driver<br><span class="hljs-attr">store.db.url</span>=jdbc:mysql://<span class="hljs-number">192.168</span>.<span class="hljs-number">56.105</span>:<span class="hljs-number">3306</span>/seata?useUnicode=<span class="hljs-literal">true</span><br><span class="hljs-attr">store.db.user</span>=root<br><span class="hljs-attr">store.db.password</span>=<span class="hljs-number">123456</span><br><span class="hljs-attr">store.db.minConn</span>=<span class="hljs-number">5</span><br><span class="hljs-attr">store.db.maxConn</span>=<span class="hljs-number">30</span><br><span class="hljs-attr">store.db.globalTable</span>=global_table<br><span class="hljs-attr">store.db.branchTable</span>=branch_table<br><span class="hljs-attr">store.db.queryLimit</span>=<span class="hljs-number">100</span><br><span class="hljs-attr">store.db.lockTable</span>=lock_table<br><span class="hljs-attr">store.db.maxWait</span>=<span class="hljs-number">5000</span><br><span class="hljs-attr">store.redis.host</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><span class="hljs-attr">store.redis.port</span>=<span class="hljs-number">6379</span><br><span class="hljs-attr">store.redis.maxConn</span>=<span class="hljs-number">10</span><br><span class="hljs-attr">store.redis.minConn</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">store.redis.database</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">store.redis.password</span>=null<br><span class="hljs-attr">store.redis.queryLimit</span>=<span class="hljs-number">100</span><br><span class="hljs-attr">server.recovery.committingRetryPeriod</span>=<span class="hljs-number">1000</span><br><span class="hljs-attr">server.recovery.asynCommittingRetryPeriod</span>=<span class="hljs-number">1000</span><br><span class="hljs-attr">server.recovery.rollbackingRetryPeriod</span>=<span class="hljs-number">1000</span><br><span class="hljs-attr">server.recovery.timeoutRetryPeriod</span>=<span class="hljs-number">1000</span><br><span class="hljs-attr">server.maxCommitRetryTimeout</span>=-<span class="hljs-number">1</span><br><span class="hljs-attr">server.maxRollbackRetryTimeout</span>=-<span class="hljs-number">1</span><br><span class="hljs-attr">server.rollbackRetryTimeoutUnlockEnable</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">client.undo.dataValidation</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">client.undo.logSerialization</span>=jackson<br><span class="hljs-attr">client.undo.onlyCareUpdateColumns</span>=<span class="hljs-literal">true</span><br><span class="hljs-attr">server.undo.logSaveDays</span>=<span class="hljs-number">7</span><br><span class="hljs-attr">server.undo.logDeletePeriod</span>=<span class="hljs-number">86400000</span><br><span class="hljs-attr">client.undo.logTable</span>=undo_log<br><span class="hljs-attr">client.log.exceptionRate</span>=<span class="hljs-number">100</span><br><span class="hljs-attr">transport.serialization</span>=seata<br><span class="hljs-attr">transport.compressor</span>=none<br><span class="hljs-attr">metrics.enabled</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">metrics.registryType</span>=compact<br><span class="hljs-attr">metrics.exporterList</span>=prometheus<br><span class="hljs-attr">metrics.exporterPrometheusPort</span>=<span class="hljs-number">9898</span><br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240428123249.png" alt="image.png"></p><p>æ¨é€æ“ä½œï¼Œè¿›å…¥æ”¹ç›®å½•</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nacos</span>-config.sh -h <span class="hljs-number">192.168.56.105</span> -p <span class="hljs-number">8848</span> -g SEATA_GROUP -t <span class="hljs-number">6487</span>cc37-<span class="hljs-number">2434</span>-<span class="hljs-number">4574</span>-<span class="hljs-number">81</span>f9-<span class="hljs-number">83</span>d2c2fb0dd5<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ“ä½œä¼šæ¨é€å¯¹åº”é…ç½®åˆ°ç›¸åº”çš„å‘½ä»¤ç©ºé—´åŒºåŸŸ</p><p>æ ¹æ®åé¢åé¦ˆæƒ…å†µï¼Œéœ€è¦å†æ”¹ä¸€ä¸‹è¿™ä¸ªé…ç½®</p><p>15 è¡Œåé¢å†åŠ ä¸‰è¡Œé…ç½®</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">transport.shutdown.wait</span>=<span class="hljs-number">3</span><br><span class="hljs-attr">service.vgroupMapping.my_test_tx_group</span>=default<br><span class="hljs-attr">service.vgroupMapping.account-service-group</span>=default<br><span class="hljs-attr">service.vgroupMapping.order-service-group</span>=default<br><span class="hljs-attr">service.vgroupMapping.product-service-group</span>=default<br><span class="hljs-attr">service.default.grouplist</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8091</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ é…ç½®åï¼Œå†è¿›è¡Œä¸€æ¬¡æ¨é€ï¼ˆé‡å¤å‘½ä»¤å³å¯ï¼Œçœ‹äº†ä¸€ä¸‹ä»– set æ‰§è¡Œçš„æ˜¯è¦†ç›–æ“ä½œï¼‰</p><h6 id="ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å¯åŠ¨"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å¯åŠ¨" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å¯åŠ¨"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å¯åŠ¨</h6><p>æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œä¸»è¦æ˜¯å‘½åç©ºé—´ï¼Œç„¶åè¿˜æœ‰ tx-service-group çš„ç›¸å…³é…ç½®</p><p>ä¸‰ä¸ªæ¨¡å—çš„å†…å®¹éƒ½å‚è€ƒä¸‹é¢çš„æ”¹ä¸€ä¸‹ï¼›å¦å¤–è¿˜æœ‰å°±æ˜¯ seata çš„ ç‰ˆæœ¬ç»Ÿä¸€æ”¹ä¸ºäº† 1.3.0</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs less">server:  <br>  port: 8081 # ç«¯å£  <br>  <br>spring:  <br>  application:  <br>    name: <span class="hljs-attribute">order-service  </span><br><span class="hljs-attribute">  </span><br><span class="hljs-attribute">  datasource</span>:  <br>    <span class="hljs-attribute">url</span>: <span class="hljs-attribute">jdbc</span>:<span class="hljs-attribute">mysql</span>:<span class="hljs-comment">//192.168.56.105:3306/seata_order?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8  </span><br>    <span class="hljs-attribute">driver-class-name</span>: com.mysql.jdbc.Driver  <br>    <span class="hljs-attribute">username</span>: root  <br>    <span class="hljs-attribute">password</span>: <span class="hljs-number">123456</span>  <br>  <br>  <span class="hljs-attribute">cloud</span>:  <br>    # Nacos ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„é…ç½®é¡¹  <br>    <span class="hljs-attribute">nacos</span>:  <br>      <span class="hljs-attribute">discovery</span>:  <br>        <span class="hljs-attribute">server-addr</span>: <span class="hljs-number">192.168</span>.<span class="hljs-number">56.105</span>:<span class="hljs-number">8848</span>  <br>        <span class="hljs-attribute">namespace</span>: <span class="hljs-number">6487</span>cc37-<span class="hljs-number">2434</span>-<span class="hljs-number">4574</span>-<span class="hljs-number">81</span>f9-<span class="hljs-number">83</span>d2c2fb0dd5  <br>#        <span class="hljs-attribute">group</span>: SEATA_GROUP  <br>  <br>  <br><span class="hljs-attribute">seata</span>:  <br>  <span class="hljs-attribute">enabled</span>: true  <br>  <span class="hljs-attribute">tx-service-group</span>: my_test_tx_group  <br>  <span class="hljs-attribute">service</span>:  <br>    <span class="hljs-attribute">vgroup-mapping</span>:  <br>      <span class="hljs-attribute">rapid_cloud_tx_group</span>: default  <br>  <span class="hljs-attribute">registry</span>:  <br>    <span class="hljs-attribute">type</span>: nacos  <br>    <span class="hljs-attribute">nacos</span>:  <br>      <span class="hljs-attribute">application</span>: seata-server  <br>      <span class="hljs-attribute">server-addr</span>: <span class="hljs-number">192.168</span>.<span class="hljs-number">56.105</span>:<span class="hljs-number">8848</span>  <br>      <span class="hljs-attribute">group</span>: SEATA_GROUP  <br>      <span class="hljs-attribute">namespace</span>: <span class="hljs-string">&#x27;6487cc37-2434-4574-81f9-83d2c2fb0dd5&#x27;</span>  <br>      <span class="hljs-attribute">username</span>: <span class="hljs-string">&#x27;nacos&#x27;</span>  <br>      <span class="hljs-attribute">password</span>: <span class="hljs-string">&#x27;nacos&#x27;</span>  <br>  <span class="hljs-attribute">config</span>:  <br>    <span class="hljs-attribute">type</span>: nacos  <br>    <span class="hljs-attribute">nacos</span>:  <br>      <span class="hljs-attribute">server-addr</span>: <span class="hljs-number">192.168</span>.<span class="hljs-number">56.105</span>:<span class="hljs-number">8848</span>  <br>      <span class="hljs-attribute">group</span>: SEATA_GROUP  <br>      <span class="hljs-attribute">namespace</span>: <span class="hljs-string">&#x27;6487cc37-2434-4574-81f9-83d2c2fb0dd5&#x27;</span>  <br>      <span class="hljs-attribute">username</span>: <span class="hljs-string">&#x27;nacos&#x27;</span>  <br>      <span class="hljs-attribute">password</span>: <span class="hljs-string">&#x27;nacos&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé…ç½®å†æ”¹ä¸€ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">seata:</span><br>  <span class="hljs-attr">application-id:</span> <span class="hljs-string">$&#123;spring.application.name&#125;</span> <span class="hljs-comment"># Seata åº”ç”¨ç¼–å·ï¼Œé»˜è®¤ä¸º $&#123;spring.application.name&#125;</span><br>  <span class="hljs-attr">tx-service-group:</span> <span class="hljs-string">$&#123;spring.application.name&#125;-group</span><br>  <span class="hljs-attr">service:</span><br>    <span class="hljs-attr">vgroup-mapping:</span><br>      <span class="hljs-attr">rapid_cloud_tx_group:</span> <span class="hljs-string">default</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">nacos</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">application:</span> <span class="hljs-string">seata-server</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.56</span><span class="hljs-number">.105</span><span class="hljs-string">:8848</span><br>      <span class="hljs-attr">group:</span> <span class="hljs-string">SEATA_GROUP</span><br>      <span class="hljs-attr">namespace:</span> <span class="hljs-string">&#x27;6487cc37-2434-4574-81f9-83d2c2fb0dd5&#x27;</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">&#x27;nacos&#x27;</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">&#x27;nacos&#x27;</span><br>  <span class="hljs-attr">config:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">nacos</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.56</span><span class="hljs-number">.105</span><span class="hljs-string">:8848</span><br>      <span class="hljs-attr">group:</span> <span class="hljs-string">SEATA_GROUP</span><br>      <span class="hljs-attr">namespace:</span> <span class="hljs-string">&#x27;6487cc37-2434-4574-81f9-83d2c2fb0dd5&#x27;</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">&#x27;nacos&#x27;</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">&#x27;nacos&#x27;</span><br></code></pre></td></tr></table></figure><p>åé¢çœ‹äº†ä¸‹ï¼Œå†æ”¹ä¸€ä¸‹</p><p>å…¶ä¸­ product-service-group: default æ˜¯å¯¹åº” tx-service-group å‰é¢çš„ config.txt ä¸­çš„åˆ†ç»„æ˜ å°„å…³ç³»</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Seata é…ç½®é¡¹ï¼Œå¯¹åº” SeataProperties ç±»</span><br><span class="hljs-attr">seata:</span><br>  <span class="hljs-attr">application-id:</span> <span class="hljs-string">$&#123;spring.application.name&#125;</span> <span class="hljs-comment"># Seata åº”ç”¨ç¼–å·ï¼Œé»˜è®¤ä¸º $&#123;spring.application.name&#125;</span><br>  <span class="hljs-attr">tx-service-group:</span> <span class="hljs-string">$&#123;spring.application.name&#125;-group</span> <span class="hljs-comment"># Seata äº‹åŠ¡ç»„ç¼–å·ï¼Œç”¨äº TC é›†ç¾¤å</span><br>  <span class="hljs-comment"># æœåŠ¡é…ç½®é¡¹ï¼Œå¯¹åº” ServiceProperties ç±»</span><br>  <span class="hljs-attr">service:</span><br>    <span class="hljs-comment"># è™šæ‹Ÿç»„å’Œåˆ†ç»„çš„æ˜ å°„</span><br>    <span class="hljs-attr">vgroup-mapping:</span><br>      <span class="hljs-attr">product-service-group:</span> <span class="hljs-string">default</span><br>      <span class="hljs-comment"># account-service-group: default</span><br>      <span class="hljs-comment"># order-service-group: default</span><br>    <span class="hljs-comment"># åˆ†ç»„å’Œ Seata æœåŠ¡çš„æ˜ å°„</span><br>    <span class="hljs-attr">grouplist:</span><br>      <span class="hljs-comment">#è®¾ç½®Seata TC çš„åœ°å€</span><br>      <span class="hljs-attr">default:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.56</span><span class="hljs-number">.105</span><span class="hljs-string">:8091</span><br></code></pre></td></tr></table></figure><hr><h5 id="éƒ¨ç½²é›†ç¾¤-TC-Server"><a href="#éƒ¨ç½²é›†ç¾¤-TC-Server" class="headerlink" title="éƒ¨ç½²é›†ç¾¤ TC  Server"></a>éƒ¨ç½²é›†ç¾¤ TC  Server</h5><p>è¿™é‡Œåé¢å†çœ‹ä¸€ä¸‹  to be continedâ€¦.</p><h4 id="ä¸šåŠ¡åœºæ™¯"><a href="#ä¸šåŠ¡åœºæ™¯" class="headerlink" title="ä¸šåŠ¡åœºæ™¯"></a>ä¸šåŠ¡åœºæ™¯</h4><p>ç»§ç»­é¡¹ç›®ï¼š<a href="https://github.com/YunaiV/SpringBoot-Labs">https://github.com/YunaiV/SpringBoot-Labs</a>Â çš„Â <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/labx-17">labx-17</a>Â </p><p>æ–‡æ¡£ï¼š <a href="https://www.iocoder.cn/Spring-Cloud-Alibaba/Seata/?self">https://www.iocoder.cn/Spring-Cloud-Alibaba/Seata/?self</a></p><p>ä¸šåŠ¡é€»è¾‘</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426203157.png" alt="image.png"></p><p>é¡¹ç›®æ¨¡å—</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426203253.png" alt="image.png"></p><ul><li>order ä¸‹å•æ“ä½œ</li><li>product å•†å“æœåŠ¡ï¼ˆæ‰£é™¤åº“å­˜ï¼‰</li><li>account è´¦æˆ·æœåŠ¡ï¼ˆæ‰£é™¤ä½™é¢ï¼‰</li></ul><p>data.sql æ–‡ä»¶ä¸­ï¼š æ¯ä¸ªåº“ä¸­çš„Â <code>undo_log</code>Â è¡¨ï¼Œæ˜¯ Seata AT æ¨¡å¼å¿…é¡»åˆ›å»ºçš„è¡¨ï¼Œä¸»è¦ç”¨äºåˆ†æ”¯äº‹åŠ¡çš„å›æ»š</p><p>è€ƒè™‘åˆ°æµ‹è¯•æ–¹ä¾¿ï¼Œæ•°æ®åº“ä¸­æ’å…¥äº†ä¸€æ¡Â <code>id = 1</code>Â çš„Â <code>account</code>Â è®°å½•ï¼Œå’Œä¸€æ¡Â <code>id = 1</code>Â çš„Â <code>product</code>Â è®°å½•</p><h5 id="ç®€å•æµ‹è¯•"><a href="#ç®€å•æµ‹è¯•" class="headerlink" title="ç®€å•æµ‹è¯•"></a>ç®€å•æµ‹è¯•</h5><p>æµ‹è¯•ä¸¤ç§æƒ…å†µï¼š</p><ol><li>åˆ†å¸ƒå¼äº‹åŠ¡æ­£å¸¸æäº¤</li><li>åˆ†å¸ƒå¼äº‹åŠ¡å¼‚å¸¸å›æ»š</li></ol><blockquote><p>åˆ†å¸ƒå¼äº‹åŠ¡æ­£å¸¸æäº¤</p></blockquote><p>å¦‚æœè¦æ­£å¸¸æäº¤çš„è¯ï¼Œå› ä¸ºè´¦æˆ·è¡¨ä¸­åªæœ‰ä¸€æ¡æ•°æ®ï¼Œç”¨æˆ· 1 æœ‰10 ä½™é¢ï¼›äº§å“è¡¨ä¸€æ¡æ•°æ®ï¼Œäº§å“ 1 æœ‰10ä¸ªåº“å­˜</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240428154235.png" alt="image.png"></p><p>è¿™ä¸ªæ˜¯ä¸€æ¬¡æ­£å¸¸è¯·æ±‚è®°å½•</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240428154332.png" alt="image.png"></p><p>æ—¥å¿—ï¼Œè®°å½•æ­£å¸¸æ“ä½œï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240428154441.png" alt="image.png"></p><blockquote><p>åˆ†å¸ƒå¼äº‹åŠ¡å¼‚å¸¸å›æ»š</p></blockquote><p>æ¨¡ä»¿ä½™é¢ä¸è¶³çš„æƒ…å†µä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240428154532.png" alt="image.png"></p><p>ç›¸å…³çš„æ—¥å¿—</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240428154601.png" alt="image.png"></p><h4 id="å·¥ç¨‹ä»£ç "><a href="#å·¥ç¨‹ä»£ç " class="headerlink" title="å·¥ç¨‹ä»£ç "></a>å·¥ç¨‹ä»£ç </h4><p>çœ‹ä¸€ä¸‹æ ¸å¿ƒä»£ç </p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs lasso">@Override  <br>@GlobalTransactional  <br><span class="hljs-keyword">public</span> <span class="hljs-built_in">Integer</span> createOrder(Long userId, Long productId, <span class="hljs-built_in">Integer</span> price) &#123;  <br>    <span class="hljs-built_in">Integer</span> amount = <span class="hljs-number">1</span>; <span class="hljs-comment">// è´­ä¹°æ•°é‡ï¼Œæš‚æ—¶è®¾ç½®ä¸º 1ã€‚  </span><br>  <br>    logger.info(<span class="hljs-string">&quot;[createOrder] å½“å‰ XID: &#123;&#125;&quot;</span>, RootContext.getXID());  <br>  <br>    <span class="hljs-comment">// æ‰£å‡åº“å­˜  </span><br>    productService.reduceStock(<span class="hljs-literal">new</span> ProductReduceStockDTO().setProductId(productId).setAmount(amount));  <br>  <br>    <span class="hljs-comment">// æ‰£å‡ä½™é¢  </span><br>    accountService.reduceBalance(<span class="hljs-literal">new</span> AccountReduceBalanceDTO().setUserId(userId).setPrice(price));  <br>  <br>    <span class="hljs-comment">// ä¿å­˜è®¢å•  </span><br>    OrderDO <span class="hljs-keyword">order</span> = <span class="hljs-literal">new</span> OrderDO().setUserId(userId).setProductId(productId).setPayAmount(amount * price);  <br>    orderDao.saveOrder(<span class="hljs-keyword">order</span>);  <br>    logger.info(<span class="hljs-string">&quot;[createOrder] ä¿å­˜è®¢å•: &#123;&#125;&quot;</span>, <span class="hljs-keyword">order</span>.getId());  <br>  <br>    <span class="hljs-comment">// è¿”å›è®¢å•ç¼–å·  </span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">order</span>.getId();  <br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸­é—´å‡ ä¸ªéƒ½æ˜¯è¿œç¨‹è°ƒç”¨çš„æ“ä½œ</p><p>ç„¶åå¯¹æ–¹æ‰§è¡Œçš„æ˜¯æœ¬åœ°äº‹åŠ¡ï¼Œæ¯”å¦‚ä½ çœ‹ä¸€ä¸‹æ‰£é™¤ä½™é¢çš„æ“ä½œ</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Override</span>  <br><span class="hljs-meta">@Transactional</span> <span class="hljs-comment">// å¼€å¯æ–°äº‹ç‰©  </span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reduceBalance</span><span class="hljs-params">(Long userId, Integer price)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;  <br>    logger.info(<span class="hljs-string">&quot;[reduceBalance] å½“å‰ XID: &#123;&#125;&quot;</span>, RootContext.getXID());  <br>  <br>    <span class="hljs-comment">// æ£€æŸ¥ä½™é¢  </span><br>    checkBalance(userId, price);  <br>  <br>    logger.info(<span class="hljs-string">&quot;[reduceBalance] å¼€å§‹æ‰£å‡ç”¨æˆ· &#123;&#125; ä½™é¢&quot;</span>, userId);  <br>    <span class="hljs-comment">// æ‰£é™¤ä½™é¢  </span><br>    <span class="hljs-keyword">int</span> updateCount = accountDao.reduceBalance(price);  <br>    <span class="hljs-comment">// æ‰£é™¤æˆåŠŸ  </span><br>    <span class="hljs-keyword">if</span> (updateCount == <span class="hljs-number">0</span>) &#123;  <br>        logger.warn(<span class="hljs-string">&quot;[reduceBalance] æ‰£é™¤ç”¨æˆ· &#123;&#125; ä½™é¢å¤±è´¥&quot;</span>, userId);  <br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">&quot;ä½™é¢ä¸è¶³&quot;</span>);  <br>    &#125;  <br>    logger.info(<span class="hljs-string">&quot;[reduceBalance] æ‰£é™¤ç”¨æˆ· &#123;&#125; ä½™é¢æˆåŠŸ&quot;</span>, userId);  <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>springcloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaåŸºç¡€_åå°„</title>
    <link href="/2024/04/24/Java%E5%9F%BA%E7%A1%80_%E5%8F%8D%E5%B0%84/"/>
    <url>/2024/04/24/Java%E5%9F%BA%E7%A1%80_%E5%8F%8D%E5%B0%84/</url>
    
    <content type="html"><![CDATA[<h4 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h4><p>åå°„å®šä¹‰ï¼š åœ¨ä¸€ä¸ªç±»ä¸­ å®šä¹‰äº†ä¸€ä¸ªç§æœ‰å±æ€§&#x2F;æ–¹æ³•ï¼Œä½†æ˜¯ä½¿ç”¨åå°„èƒ½ä½¿æ‰€æœ‰å±æ€§éƒ½è®¿é—®åˆ°ï¼Œä¼šç ´è§£ç§æœ‰å±æ€§</p><p>åå°„çš„åº”ç”¨åœºæ™¯ï¼š</p><p>åç¼–è¯‘ï¼š .class  â†’  .java</p><ul><li>é€šè¿‡åå°„æœºåˆ¶è®¿é—® java å¯¹è±¡çš„å±æ€§ï¼Œæ–¹æ³•ï¼Œæ„é€ æ–¹æ³•ç­‰</li><li>åå°„æŠ€æœ¯çš„ä½¿ç”¨<ul><li><code>Class</code>ç±» ä»£è¡¨ç±»çš„å®ä½“ï¼Œåœ¨è¿è¡Œçš„Javaåº”ç”¨ç¨‹åºä¸­è¡¨ç¤ºç±»å’Œæ¥å£</li><li><code>Field</code>ç±» ä»£è¡¨ç±»çš„æˆå‘˜å˜é‡ï¼ˆæˆå‘˜å˜é‡ä¹Ÿç§°ä¸ºç±»çš„å±æ€§ï¼‰</li><li><code>Method</code>ç±» ä»£è¡¨ç±»çš„æ–¹æ³•</li><li><code>Constructor</code>ç±» ä»£è¡¨ç±»çš„æ„é€ æ–¹æ³•<ul><li>1.<code>getField</code>ã€<code>getMethod</code>å’Œ<code>getCostructor</code>æ–¹æ³•å¯ä»¥è·å¾—æŒ‡å®šåå­—çš„åŸŸã€æ–¹æ³•å’Œæ„é€ å™¨</li><li>2.<code>getFields</code>ã€<code>getMethods</code>å’Œ<code>getCostructors</code>æ–¹æ³•å¯ä»¥è·å¾—ç±»æä¾›çš„publicåŸŸã€æ–¹æ³•å’Œæ„é€ å™¨æ•°ç»„ï¼Œå…¶ä¸­åŒ…æ‹¬è¶…ç±»çš„å…±æœ‰æˆå‘˜</li><li>3.<code>getDeclatedFields</code>ã€<code>getDeclatedMethods</code>å’Œ<code>getDeclaredConstructors</code>æ–¹æ³•å¯ä»¥è·å¾—ç±»ä¸­å£°æ˜çš„å…¨éƒ¨åŸŸã€æ–¹æ³•å’Œæ„é€ å™¨ï¼Œå…¶ä¸­åŒ…æ‹¬ç§æœ‰å’Œå—ä¿æŠ¤çš„æˆå‘˜ï¼Œä½†ä¸åŒ…æ‹¬è¶…ç±»çš„æˆå‘˜ã€‚</li></ul></li></ul></li></ul><p>åå°„çš„åŸºç¡€ä½¿ç”¨:  <a href="https://www.cnblogs.com/cg-ww/p/15609172.html">https://www.cnblogs.com/cg-ww/p/15609172.html</a></p><p>æ¼”ç¤ºä½¿ç”¨ç±»ï¼š</p><p>User</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs typescript">package com.<span class="hljs-property">ruoyi</span>.<span class="hljs-property">luoqi</span>.<span class="hljs-property">reflect</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> <span class="hljs-variable">luoqi</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> User.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/24 10:42</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;<br>    <span class="hljs-keyword">private</span> int age;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> email;<br><br>    <span class="hljs-comment">// æ— å‚æ•°æ„é€ å™¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span>() &#123;<br>    &#125;<br><br>    <span class="hljs-comment">// å¸¦æ‰€æœ‰å±æ€§çš„æ„é€ å™¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_">String</span> name, int age, <span class="hljs-title class_">String</span> email) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span> = email;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> int <span class="hljs-title function_">add</span>(<span class="hljs-params">int a,int b </span>)&#123;<br>        <span class="hljs-keyword">return</span> a + b;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> int <span class="hljs-title function_">subtract</span>(<span class="hljs-params">int a,int b </span>)&#123;<br>        <span class="hljs-keyword">return</span> a - b;<br>    &#125;<br><br>    <span class="hljs-comment">// Getter å’Œ Setter æ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getName</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> int <span class="hljs-title function_">getAge</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setAge</span>(<span class="hljs-params">int age</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getEmail</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> email;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setEmail</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> email</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">email</span> = email;<br>    &#125;<br><br>    <span class="hljs-comment">// é‡å†™ toString æ–¹æ³•ä»¥ä¾¿äºæ‰“å°ç”¨æˆ·ä¿¡æ¯</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">toString</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>                <span class="hljs-string">&quot;, email=&#x27;&quot;</span> + email + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ReflectionExample"><a href="#ReflectionExample" class="headerlink" title="ReflectionExample"></a>ReflectionExample</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ruoyi.luoqi.reflect;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> luoqi</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> ReflectionExample.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/24 10:40</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> java.lang.reflect.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectionExample</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;æ— å‚æ„é€ :&quot;</span>);<br>            <span class="hljs-comment">//åŠ è½½ User ç±»</span><br>            Class&lt;?&gt; cls = Class.forName(<span class="hljs-string">&quot;com.ruoyi.luoqi.reflect.User&quot;</span>);<br><br>            Constructor&lt;?&gt; constructor = cls.getConstructor();  <span class="hljs-comment">// è·å–æ— å‚å…¬å…±æ„é€ å‡½æ•°</span><br><br>            System.out.println(constructor);<br>            System.out.println(<span class="hljs-string">&quot;è·å–å…¬å…±è®¿é—®å­—æ®µï¼š&quot;</span>);<br>            <span class="hljs-comment">//Class.getFields() æ–¹æ³•è¿”å›çš„æ˜¯ç±»ä¸­æ‰€æœ‰å¯è®¿é—®çš„å…¬å…±å­—æ®µï¼ˆpublic fieldsï¼‰ï¼ŒåŒ…æ‹¬ä»è¶…ç±»ç»§æ‰¿æ¥çš„å…¬å…±å­—æ®µ</span><br>            Field[] fields = cls.getFields();<br>            System.out.println(fields.length);<br>            <span class="hljs-keyword">for</span>(Field d : fields) &#123;<br>                System.out.println(d.getName());<br>            &#125;<br>            System.out.println(<span class="hljs-string">&quot;---------&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;è·å–å…¨éƒ¨è®¿é—®å­—æ®µï¼š&quot;</span>);<br>            <span class="hljs-comment">//è·å¾—ç±»ä¸­å£°æ˜çš„å…¨éƒ¨åŸŸï¼Œå…¶ä¸­åŒ…æ‹¬ç§æœ‰å’Œå—ä¿æŠ¤çš„æˆå‘˜ï¼Œä½†ä¸åŒ…æ‹¬è¶…ç±»çš„æˆå‘˜ã€‚</span><br>            Field[] declaredFields = cls.getDeclaredFields();<br>            <span class="hljs-keyword">for</span>(Field d : declaredFields) &#123;<br>                System.out.println(d.getName());<br>            &#125;<br><br>            System.out.println(<span class="hljs-string">&quot;å¯¹å®ä¾‹è¿›è¡Œå±æ€§èµ‹å€¼æ“ä½œ&quot;</span>);<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> constructor.newInstance();  <span class="hljs-comment">// åˆ›å»º User ç±»çš„ä¸€ä¸ªå®ä¾‹</span><br>            <span class="hljs-comment">//åå°„ç»™å±æ€§èµ‹å€¼</span><br>            <span class="hljs-comment">//æŸ¥æ‰¾åˆ°å±æ€§</span><br>            <span class="hljs-type">Field</span> <span class="hljs-variable">pubUserName</span> <span class="hljs-operator">=</span> cls.getDeclaredField(<span class="hljs-string">&quot;name&quot;</span>);<br>            <span class="hljs-comment">//æŒ‡å®šç»™å“ªä¸ªuserEntityå¯¹è±¡èµ‹å€¼</span><br>            <span class="hljs-comment">//è¿™æ˜¯ç»™å…¬æœ‰å±æ€§èµ‹å€¼ï¼Œé»˜è®¤åªèƒ½è®¿é—®å…¬æœ‰å±æ€§ï¼Œå¦‚æœè¦è®¿é—®ç§æœ‰å±æ€§ï¼Œä¼šæŠ¥é”™</span><br>            <span class="hljs-comment">//åå°„æ²¡æœ‰æƒé™è®¿é—®ç§æœ‰å±æ€§ï¼Œå¦‚æœéœ€è¦è®¿é—®éœ€è¦è®¾ç½®æƒé™setAccessible</span><br>            <span class="hljs-comment">//è®¾ç½® accessible ä¸º trueï¼Œå…è®¸è®¿é—®ç§æœ‰å­—æ®µ</span><br>            pubUserName.setAccessible(<span class="hljs-literal">true</span>);<br>            pubUserName.set(instance,<span class="hljs-string">&quot;test&quot;</span>);<br><br>            System.out.println(instance);<br><br>            System.out.println(<span class="hljs-string">&quot;æœ‰å‚æ„é€ :&quot;</span>);<br>            <span class="hljs-comment">// è·å–æ¥å— String å’Œ int å’Œ String ä¸‰ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°</span><br>            Constructor&lt;?&gt; constructor2 = cls.getConstructor(String.class, <span class="hljs-type">int</span>.class,String.class);<br><br>            <span class="hljs-comment">// ä½¿ç”¨è·å–çš„æ„é€ å‡½æ•°åˆ›å»º User ç±»çš„å®ä¾‹</span><br>            <span class="hljs-type">Object</span> <span class="hljs-variable">userInstance</span> <span class="hljs-operator">=</span> constructor2.newInstance(<span class="hljs-string">&quot;John Doe&quot;</span>, <span class="hljs-number">30</span>,<span class="hljs-string">&quot;test@163.com&quot;</span>);<br><br>            System.out.println(userInstance);<br>            System.out.println(<span class="hljs-string">&quot;---------&quot;</span>);<br><br><br>            System.out.println(<span class="hljs-string">&quot;åå°„æœºåˆ¶çš„ä¸‰ç§æ–¹å¼åˆ›å»ºå¯¹è±¡:&quot;</span>);<br>            <span class="hljs-comment">//åå°„æœºåˆ¶çš„ä¸‰ç§æ–¹å¼åˆ›å»ºå¯¹è±¡</span><br>            <span class="hljs-comment">//ç¬¬ä¸€ç§æ–¹å¼ï¼šé€šè¿‡newå‡ºæ¥çš„å¯¹è±¡è·å–class</span><br>            <span class="hljs-type">User</span> <span class="hljs-variable">userEntity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>            <span class="hljs-type">Class</span> <span class="hljs-variable">userClass</span> <span class="hljs-operator">=</span> userEntity.getClass();<br>            <span class="hljs-comment">// é»˜è®¤æ‰§è¡Œæ— å‚æ„é€ å‡½æ•°</span><br>            <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> (User) userClass.newInstance();<br>            System.out.println(user1==userEntity);<span class="hljs-comment">//false</span><br><br>            <span class="hljs-comment">//ç¬¬äºŒç§æ–¹å¼ï¼šç›´æ¥è·å–class</span><br>            <span class="hljs-type">Class</span> <span class="hljs-variable">userClass2</span> <span class="hljs-operator">=</span> User.class;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> (User) userClass2.newInstance();<br>            System.out.println(user2);<br><br>            <span class="hljs-comment">//ç¬¬ä¸‰ç§æ–¹å¼ï¼šé€šè¿‡å®Œæ•´ç±»åè·å–classï¼ˆå¸¸ç”¨ï¼‰</span><br>            Class&lt;?&gt; aClass = Class.forName(<span class="hljs-string">&quot;com.ruoyi.luoqi.reflect.User&quot;</span>);<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user3</span> <span class="hljs-operator">=</span> (User) aClass.newInstance();<br>            System.out.println(user3);<br><br>            System.out.println(<span class="hljs-string">&quot;æ–¹æ³•çš„åŸºç¡€ä½¿ç”¨ï¼š&quot;</span>);<br>            <span class="hljs-comment">//æ–¹æ³•çš„åŸºç¡€ä½¿ç”¨</span><br>            <span class="hljs-comment">//getMethod: ç”¨äºè·å–ç±»çš„å…¬å…±æ–¹æ³•ï¼ˆpublic methodsï¼‰ï¼ŒåŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿çš„å…¬å…±æ–¹æ³•</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> aClass.getMethod(<span class="hljs-string">&quot;add&quot;</span>, <span class="hljs-type">int</span>.class,<span class="hljs-type">int</span>.class);<br>            <span class="hljs-comment">//è°ƒç”¨æ–¹æ³•</span><br>            <span class="hljs-type">Integer</span> <span class="hljs-variable">invoke</span> <span class="hljs-operator">=</span> (Integer)method.invoke(user3, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>            System.out.println(invoke);<br><br>            <span class="hljs-comment">//getDeclaredMethod ç”¨äºè·å–ç±»ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼Œä¸è€ƒè™‘å®ƒä»¬çš„è®¿é—®çº§åˆ«ï¼ˆå³å¯ä»¥æ˜¯å…¬å…±ã€ç§æœ‰ã€ä¿æŠ¤æˆ–åŒ…å†…è®¿é—®ï¼‰</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">method2</span> <span class="hljs-operator">=</span> aClass.getDeclaredMethod(<span class="hljs-string">&quot;subtract&quot;</span>, <span class="hljs-type">int</span>.class,<span class="hljs-type">int</span>.class);<br>            <span class="hljs-comment">//è°ƒç”¨æ–¹æ³•</span><br>            <span class="hljs-comment">//å¦‚æœéœ€è¦ç§æœ‰æ–¹æ³•ï¼Œéœ€è¦åŠ ä¸Š setAccessible</span><br>            method2.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-type">Integer</span> <span class="hljs-variable">invoke2</span> <span class="hljs-operator">=</span> (Integer)method2.invoke(user3, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>);<br>            System.out.println(invoke2);<br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰æ³¨è§£ä½¿ç”¨"><a href="#è‡ªå®šä¹‰æ³¨è§£ä½¿ç”¨" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£ä½¿ç”¨"></a>è‡ªå®šä¹‰æ³¨è§£ä½¿ç”¨</h4><p>è¿™éƒ¨åˆ†ä»£ç æ˜¯è˜‘è‡åšå®¢ä¸­å…³äºæ—¥å¿—è®°å½•è‡ªå®šä¹‰æ³¨è§£çš„ä½¿ç”¨ï¼šOperationLogger</p><p>OperationLogger</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.moxi.mogublog.admin.annotion.OperationLogger;<br><br><span class="hljs-keyword">import</span> com.moxi.mougblog.base.enums.PlatformEnum;<br><br><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ‡æ³¨è¯¥è¯¥æ³¨è§£çš„æ–¹æ³•éœ€è¦è®°å½•æ“ä½œæ—¥å¿—</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> é™Œæºª</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2020å¹´3æœˆ23æ—¥09:35:57</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> OperationLogger &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¸šåŠ¡åç§°</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¹³å°ï¼Œé»˜è®¤ä¸ºWEBç«¯</span><br><span class="hljs-comment">     */</span><br>    PlatformEnum <span class="hljs-title function_">platform</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> PlatformEnum.ADMIN;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ˜¯å¦å°†å½“å‰æ—¥å¿—è®°å½•åˆ°æ•°æ®åº“ä¸­</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ‡é¢ï¼šLoggerAspect</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.moxi.mogublog.admin.annotion.OperationLogger;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;<br><span class="hljs-keyword">import</span> com.moxi.mogublog.admin.global.RedisConf;<br><span class="hljs-keyword">import</span> com.moxi.mogublog.admin.global.SysConf;<br><span class="hljs-keyword">import</span> com.moxi.mogublog.commons.config.security.SecurityUser;<br><span class="hljs-keyword">import</span> com.moxi.mogublog.commons.entity.ExceptionLog;<br><span class="hljs-keyword">import</span> com.moxi.mogublog.utils.*;<br><span class="hljs-keyword">import</span> com.moxi.mougblog.base.global.Constants;<br><span class="hljs-keyword">import</span> com.moxi.mougblog.base.holder.RequestHolder;<br><span class="hljs-keyword">import</span> com.moxi.mougblog.base.util.RequestUtil;<br><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.aspectj.lang.JoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Around;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Pointcut;<br><span class="hljs-keyword">import</span> org.json.simple.JSONObject;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;<br><span class="hljs-keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.util.Date;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ—¥å¿—åˆ‡é¢</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> é™Œæºª</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2020å¹´12æœˆ31æ—¥21:26:04</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerAspect</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    RedisUtil redisUtil;<br><br>    <span class="hljs-meta">@Autowired</span><br>    ThreadPoolTaskExecutor threadPoolTaskExecutor;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¼€å§‹æ—¶é—´</span><br><span class="hljs-comment">     */</span><br>    Date startTime;<br><br>    <span class="hljs-comment">//ä½¿ç”¨ @Pointcut æ³¨è§£å®šä¹‰äº†ä¸€ä¸ªåˆ‡ç‚¹ï¼Œç”¨æ¥åŒ¹é…å¸¦æœ‰ OperationLogger æ³¨è§£çš„æ–¹æ³•ã€‚</span><br>    <span class="hljs-meta">@Pointcut(value = &quot;@annotation(operationLogger)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pointcut</span><span class="hljs-params">(OperationLogger operationLogger)</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">//ç¯ç»•é€šçŸ¥åŒ…è£…äº†ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œï¼Œå®ƒé¦–å…ˆä¿å­˜äº†æ–¹æ³•è°ƒç”¨çš„å¼€å§‹æ—¶é—´ï¼Œç„¶åæ‰§è¡Œæ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•æ‰§è¡Œåè¿›è¡Œæ—¥å¿—è®°å½•ã€‚</span><br>    <span class="hljs-meta">@Around(value = &quot;pointcut(operationLogger)&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doAround</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, OperationLogger operationLogger)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br><br>        startTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br><br>        <span class="hljs-comment">//å…ˆæ‰§è¡Œä¸šåŠ¡</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// æ—¥å¿—æ”¶é›†</span><br>            <span class="hljs-comment">//åœ¨ handle æ–¹æ³•ä¸­ï¼Œå¯ä»¥é€šè¿‡åå°„è·å–å½“å‰æ‰§è¡Œçš„æ–¹æ³•ï¼Œè·å–æ–¹æ³•ä¸Šçš„ OperationLogger æ³¨è§£ï¼Œå¹¶æ ¹æ®æ³¨è§£çš„å±æ€§å†³å®šå¦‚ä½•è®°å½•æ—¥å¿—ã€‚</span><br>            handle(joinPoint);<br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;æ—¥å¿—è®°å½•å‡ºé”™!&quot;</span>, e);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-comment">//å½“è¢«æ³¨è§£çš„æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œè¿™ä¸ªé€šçŸ¥ä¼šæ•è·å¼‚å¸¸ï¼Œå¹¶è®°å½•å¼‚å¸¸æ—¥å¿—ã€‚</span><br>    <span class="hljs-meta">@AfterThrowing(value = &quot;pointcut(operationLogger)&quot;, throwing = &quot;e&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAfterThrowing</span><span class="hljs-params">(JoinPoint joinPoint, OperationLogger operationLogger, Throwable e)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">ExceptionLog</span> <span class="hljs-variable">exception</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionLog</span>();<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> RequestHolder.getRequest();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> IpUtils.getIpAddr(request);<br>        exception.setIp(ip);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">operationName</span> <span class="hljs-operator">=</span> AspectUtil.INSTANCE.parseParams(joinPoint.getArgs(), operationLogger.value());<br><br>        <span class="hljs-comment">//ä»Redisä¸­è·å–IPæ¥æº</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">jsonResult</span> <span class="hljs-operator">=</span> redisUtil.get(RedisConf.IP_SOURCE + Constants.SYMBOL_COLON + ip);<br>        <span class="hljs-keyword">if</span> (StringUtils.isEmpty(jsonResult)) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">addresses</span> <span class="hljs-operator">=</span> IpUtils.getAddresses(SysConf.IP + SysConf.EQUAL_TO + ip, SysConf.UTF_8);<br>            <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(addresses)) &#123;<br>                exception.setIpSource(addresses);<br>                redisUtil.setEx(RedisConf.IP_SOURCE + Constants.SYMBOL_COLON + ip, addresses, <span class="hljs-number">24</span>, TimeUnit.HOURS);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            exception.setIpSource(jsonResult);<br>        &#125;<br><br>        <span class="hljs-comment">//è®¾ç½®è¯·æ±‚ä¿¡æ¯</span><br>        exception.setIp(ip);<br><br>        <span class="hljs-comment">//è®¾ç½®è°ƒç”¨çš„æ–¹æ³•</span><br>        exception.setMethod(joinPoint.getSignature().getName());<br><br>        exception.setExceptionJson(JSON.toJSONString(e,<br>                SerializerFeature.DisableCircularReferenceDetect,<br>                SerializerFeature.WriteMapNullValue));<br>        exception.setExceptionMessage(e.getMessage());<br><br>        exception.setOperation(operationName);<br>        exception.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        exception.setUpdateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br><br>        exception.insert();<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç®¡ç†å‘˜æ—¥å¿—æ”¶é›†</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> point</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(ProceedingJoinPoint point)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> RequestHolder.getRequest();<br><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">currentMethod</span> <span class="hljs-operator">=</span> AspectUtil.INSTANCE.getMethod(point);<br><br>        <span class="hljs-comment">//è·å–æ“ä½œåç§°</span><br>        <span class="hljs-type">OperationLogger</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> currentMethod.getAnnotation(OperationLogger.class);<br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">save</span> <span class="hljs-operator">=</span> annotation.save();<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">bussinessName</span> <span class="hljs-operator">=</span> AspectUtil.INSTANCE.parseParams(point.getArgs(), annotation.value());<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">ua</span> <span class="hljs-operator">=</span> RequestUtil.getUa();<br><br>        log.info(<span class="hljs-string">&quot;&#123;&#125; | &#123;&#125; - &#123;&#125; &#123;&#125; - &#123;&#125;&quot;</span>, bussinessName, IpUtils.getIpAddr(request), RequestUtil.getMethod(), RequestUtil.getRequestUrl(), ua);<br>        <span class="hljs-keyword">if</span> (!save) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// è·å–å‚æ•°åç§°å’Œå€¼</span><br>        Map&lt;String, Object&gt; nameAndArgsMap = AopUtils.getFieldsName(point);<br>        <span class="hljs-comment">// å½“å‰æ“ä½œç”¨æˆ·</span><br>        <span class="hljs-type">SecurityUser</span> <span class="hljs-variable">securityUser</span> <span class="hljs-operator">=</span> (SecurityUser) SecurityContextHolder.getContext().getAuthentication().getPrincipal();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">paramsJson</span> <span class="hljs-operator">=</span> JSONObject.toJSONString(nameAndArgsMap);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> request.getMethod();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> IpUtils.getIpAddr(request);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> request.getRequestURI();<br><br>        <span class="hljs-comment">// å¼‚æ­¥å­˜å‚¨æ—¥å¿—</span><br>        threadPoolTaskExecutor.execute(<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SysLogHandle</span>(ip, type, url, securityUser,<br>                        paramsJson, point.getTarget().getClass().getName(),<br>                        point.getSignature().getName(), bussinessName,<br>                        startTime, redisUtil));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…·ä½“å†…å®¹å¯ä»¥çœ‹ä¸€ä¸‹å®é™…ä»£ç ï¼ŒåŒæ—¶åç»­æœ‰å…¶ä»–ç¤ºä¾‹ï¼Œå¯ä»¥ç»§ç»­å¾€ä¸‹å†™ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>Base</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rediså…¥é—¨_åŸºç¡€æ“ä½œ</title>
    <link href="/2024/04/21/Redis%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/"/>
    <url>/2024/04/21/Redis%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œéœ€è¦å®é™…ç¼–ç¨‹çš„æ—¶å€™ï¼Œè¿›è¡Œç§¯ç´¯å¹¶è®°å½•ã€‚</p><h4 id="1ã€Redis-æ‰¹é‡åˆ é™¤æ“ä½œ"><a href="#1ã€Redis-æ‰¹é‡åˆ é™¤æ“ä½œ" class="headerlink" title="1ã€Redis æ‰¹é‡åˆ é™¤æ“ä½œ"></a>1ã€Redis æ‰¹é‡åˆ é™¤æ“ä½œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ruoyi.luoqi.redis;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> luoqi</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> RedisCacheTest.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/21 14:06</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> com.ruoyi.common.core.redis.RedisCache;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.Cursor;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.ScanOptions;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;<br><span class="hljs-keyword">import</span> java.time.LocalDate;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisCacheTest</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisCache redisCache;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsertAndDelete</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// æ’å…¥ä¸€å¹´çš„æ•°æ®</span><br><span class="hljs-comment">//        LocalDate start = LocalDate.of(2023, 1, 1);</span><br><span class="hljs-comment">//        LocalDate end = start.plusYears(1);</span><br><span class="hljs-comment">//        while (!start.isEqual(end)) &#123;</span><br><span class="hljs-comment">//            String key = &quot;date:&quot; + start.toString();</span><br><span class="hljs-comment">//            redisCache.setCacheObject(key, &quot;value_&quot; + start, 365, TimeUnit.DAYS);</span><br><span class="hljs-comment">//            start = start.plusDays(1);</span><br><span class="hljs-comment">//        &#125;</span><br><br><span class="hljs-comment">/*        //æ–¹å¼ä¸€ï¼šä½¿ç”¨çš„ redis çš„ DEL å‘½ä»¤</span><br><span class="hljs-comment">        // åˆ é™¤ä¸€ä¸ªæœˆçš„æ•°æ®</span><br><span class="hljs-comment">        LocalDate monthStart = LocalDate.of(2023, 6, 1);</span><br><span class="hljs-comment">        LocalDate monthEnd = monthStart.plusMonths(1);</span><br><span class="hljs-comment">        //éå†åˆ é™¤</span><br><span class="hljs-comment">        while (!monthStart.isEqual(monthEnd)) &#123;</span><br><span class="hljs-comment">            String key = &quot;date:&quot; + monthStart.toString();</span><br><span class="hljs-comment">            redisCache.deleteObject(key);</span><br><span class="hljs-comment">            monthStart = monthStart.plusDays(1);</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        // éªŒè¯åˆ é™¤æ“ä½œ</span><br><span class="hljs-comment">        monthStart = LocalDate.of(2023, 6, 1);</span><br><span class="hljs-comment">        monthEnd = monthStart.plusMonths(1);</span><br><span class="hljs-comment">        while (!monthStart.isEqual(monthEnd)) &#123;</span><br><span class="hljs-comment">            String key = &quot;date:&quot; + monthStart.toString();</span><br><span class="hljs-comment">            assert !stringRedisTemplate.hasKey(key); // ä½¿ç”¨JUnitçš„æ–­è¨€æ¥ç¡®ä¿é”®å·²è¢«åˆ é™¤</span><br><span class="hljs-comment">            monthStart = monthStart.plusDays(1);</span><br><span class="hljs-comment">        &#125;*/</span><br><br><span class="hljs-comment">/*        // å‡†å¤‡åˆ é™¤ä¸€ä¸ªæœˆçš„æ•°æ®</span><br><span class="hljs-comment">        LocalDate monthStart = LocalDate.of(2023, 6, 1);</span><br><span class="hljs-comment">        LocalDate monthEnd = monthStart.plusMonths(1);</span><br><span class="hljs-comment">        List&lt;String&gt; keysToDelete = new ArrayList&lt;&gt;();</span><br><span class="hljs-comment">        while (!monthStart.isEqual(monthEnd)) &#123;</span><br><span class="hljs-comment">            String key = &quot;date:&quot; + monthStart.toString();</span><br><span class="hljs-comment">            keysToDelete.add(key);</span><br><span class="hljs-comment">            monthStart = monthStart.plusDays(1);</span><br><span class="hljs-comment">        &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        // æ‰¹é‡åˆ é™¤</span><br><span class="hljs-comment">        redisCache.deleteObject(keysToDelete);</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        // éªŒè¯åˆ é™¤æ“ä½œ</span><br><span class="hljs-comment">        for (String key : keysToDelete) &#123;</span><br><span class="hljs-comment">            assert !redisCache.hasKey(key); // ä½¿ç”¨JUnitçš„æ–­è¨€æ¥ç¡®ä¿é”®å·²è¢«åˆ é™¤</span><br><span class="hljs-comment">        &#125;*/</span><br><br>        <span class="hljs-comment">//æ–¹å¼äºŒï¼šä½¿ç”¨ redis çš„ scan å‘½ä»¤</span><br>        <span class="hljs-comment">// ä½¿ç”¨SCANå‘½ä»¤å¯»æ‰¾å¹¶åˆ é™¤ç‰¹å®šæ¨¡å¼çš„é”®</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">pattern</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;date:2023-01*&quot;</span>;<br>        <span class="hljs-type">ScanOptions</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> ScanOptions.scanOptions().match(pattern).build();<br>        List&lt;String&gt; deletedKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(); <span class="hljs-comment">// ç”¨äºå­˜å‚¨å·²åˆ é™¤çš„é”®</span><br>        <span class="hljs-keyword">try</span> (Cursor&lt;<span class="hljs-type">byte</span>[]&gt; cursor = redisCache.redisTemplate.getConnectionFactory().getConnection().scan(options)) &#123;<br>            <span class="hljs-keyword">while</span> (cursor.hasNext()) &#123;<br>                <span class="hljs-type">byte</span>[] key = cursor.next();<br>                redisCache.redisTemplate.delete(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(key));  <span class="hljs-comment">// åˆ é™¤é”®</span><br>                deletedKeys.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(key));  <span class="hljs-comment">// å­˜å‚¨å·²åˆ é™¤çš„é”®</span><br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>        <span class="hljs-comment">// éªŒè¯åˆ é™¤æ“ä½œ</span><br>        deletedKeys.forEach(key -&gt; &#123;<br>            <span class="hljs-keyword">assert</span> !stringRedisTemplate.hasKey(key); <span class="hljs-comment">// æ£€æŸ¥æ¯ä¸ªé”®æ˜¯å¦å·²ç»è¢«åˆ é™¤</span><br>        &#125;);<br><br>        <span class="hljs-comment">// å¦‚æœæƒ³è¾“å‡ºéªŒè¯ç»“æœæˆ–ä½¿ç”¨JUnitæä¾›çš„æ›´å¤æ‚çš„æ–­è¨€æ–¹å¼</span><br>        deletedKeys.forEach(key -&gt; &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">stillExists</span> <span class="hljs-operator">=</span> stringRedisTemplate.hasKey(key);<br>            <span class="hljs-keyword">assert</span> !stillExists : <span class="hljs-string">&quot;Key &quot;</span> + key + <span class="hljs-string">&quot; still exists.&quot;</span>;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—_RocketMQ_åŸºç¡€ä½¿ç”¨</title>
    <link href="/2024/04/18/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RocketMQ_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/04/18/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RocketMQ_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°"></a>åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°</h3><h4 id="é€»è¾‘æ­¥éª¤"><a href="#é€»è¾‘æ­¥éª¤" class="headerlink" title="é€»è¾‘æ­¥éª¤"></a>é€»è¾‘æ­¥éª¤</h4><p>RocketMQ å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æœºåˆ¶æ˜¯é€šè¿‡äº‹åŠ¡æ¶ˆæ¯åŠ ä¸Šäº‹åŠ¡åæŸ¥æœºåˆ¶</p><p>å…·ä½“æ­¥éª¤ï¼š</p><ol><li><strong>å‘é€åŠæ¶ˆæ¯ï¼ˆPrepare Messageï¼‰</strong>ï¼š<ul><li>ç”Ÿäº§è€…å‘ MQ å‘é€ä¸€ä¸ªç‰¹æ®Šçš„æ¶ˆæ¯ï¼ˆåŠæ¶ˆæ¯ï¼‰ï¼Œè¿™ä¸ªæ¶ˆæ¯ä¸ä¼šç«‹å³æŠ•é€’ç»™æ¶ˆè´¹è€…ã€‚</li></ul></li><li><strong>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</strong>ï¼š<ul><li>ç”Ÿäº§è€…å‘é€åŠæ¶ˆæ¯åï¼Œå°†æ‰§è¡Œæœ¬åœ°äº‹åŠ¡é€»è¾‘ï¼ˆå¦‚æ•°æ®åº“æ“ä½œï¼‰ã€‚è¿™ä¸ªæ­¥éª¤çš„æˆåŠŸä¸å¦å°†å†³å®šæ¶ˆæ¯æ˜¯å¦å¯è¢«æ¶ˆè´¹ã€‚</li></ul></li><li><strong>æ ¹æ®æœ¬åœ°äº‹åŠ¡çŠ¶æ€æäº¤æˆ–å›æ»šæ¶ˆæ¯</strong>ï¼š<ul><li>å¦‚æœæœ¬åœ°äº‹åŠ¡æˆåŠŸï¼Œç”Ÿäº§è€…å°†é€šçŸ¥ MQ æäº¤æ¶ˆæ¯ï¼Œä½¿å…¶å¯¹æ¶ˆè´¹è€…å¯è§ã€‚</li><li>å¦‚æœæœ¬åœ°äº‹åŠ¡å¤±è´¥ï¼Œç”Ÿäº§è€…å°†é€šçŸ¥ MQ å›æ»šæ¶ˆæ¯ï¼Œæ¶ˆæ¯å°†è¢«åˆ é™¤ä¸ä¼šæŠ•é€’ç»™æ¶ˆè´¹è€…ã€‚</li></ul></li><li><strong>äº‹åŠ¡çŠ¶æ€å›æŸ¥</strong>ï¼š<ul><li>å¦‚æœ MQ é•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°å…³äºè¿™ä¸ªåŠæ¶ˆæ¯çš„æœ€ç»ˆçŠ¶æ€ï¼ˆæäº¤æˆ–å›æ»šï¼‰ï¼ŒMQ å°†å‘ç”Ÿäº§è€…å‘é€å›æŸ¥æ¶ˆæ¯ã€‚ç”Ÿäº§è€…éœ€è¦æ£€æŸ¥æœ¬åœ°äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶å›åº” MQ äº‹åŠ¡çš„æœ€ç»ˆçŠ¶æ€ã€‚</li></ul></li></ol><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307141544.png" alt="image.png"></p><p><strong>äº‹åŠ¡å›æŸ¥æœºåˆ¶</strong></p><p>ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªå®šæ—¶æœºåˆ¶ï¼Œç„¶åå¦‚æœé•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°äºŒæ¬¡ç¡®è®¤ï¼Œä¼šè¿›è¡Œäº‹åŠ¡å›æŸ¥</p><ul><li>è¿™ä¸ªæ˜¯ç”Ÿäº§è€…åè€Œæ˜¯æ¶ˆè´¹è€…ï¼Œæ”¶åˆ°è¿™æ¡æ¶ˆæ¯åï¼Œé€šè¿‡æœ¬åœ°å®ç°çš„ checker æ¥å£çš„ checkLocalTransaction æ–¹æ³•è¿›è¡Œæ£€æŸ¥æœ¬åœ°äº‹åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œå¹¶å°†ç»“æœå‘ŠçŸ¥ MQ æœåŠ¡å™¨ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307155659.png" alt="image.png"></p><h4 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h4><p>å‚è€ƒï¼š <a href="https://juejin.cn/post/6844904099993878536">https://juejin.cn/post/6844904099993878536</a></p><p>å­¦ä¹ é¡¹ç›®åœ°å€ï¼š <a href="https://gitee.com/wuhonglin2/rocketmq-jta-demo?skip_mobile=true">https://gitee.com/wuhonglin2/rocketmq-jta-demo?skip_mobile=true</a></p><hr><blockquote><p>ä½ å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ª gpt ç»™çš„ä¸€ä¸ª demo ç¤ºä¾‹</p></blockquote><p>å‡è®¾æ‚¨éœ€è¦åœ¨ç”µå•†ç³»ç»Ÿä¸­å¤„ç†è®¢å•æ”¯ä»˜çš„åœºæ™¯ï¼Œå…¶ä¸­ç”¨æˆ·çš„æ”¯ä»˜æ“ä½œéœ€è¦æ›´æ–°è®¢å•çŠ¶æ€å¹¶æ‰£å‡åº“å­˜ï¼Œè¿™ä¸¤ä¸ªæ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><p>æ­¥éª¤ä¸€ï¼šå‘é€åŠæ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.rocketmq.client.producer.TransactionMQProducer;<br><span class="hljs-keyword">import</span> org.apache.rocketmq.client.producer.SendResult;<br><span class="hljs-keyword">import</span> org.apache.rocketmq.common.message.Message;<br><span class="hljs-keyword">import</span> org.apache.rocketmq.client.exception.MQClientException;<br><br><span class="hljs-type">TransactionMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionMQProducer</span>(<span class="hljs-string">&quot;producer_group&quot;</span>);<br>producer.setNamesrvAddr(<span class="hljs-string">&quot;127.0.0.1:9876&quot;</span>);<br>producer.start();<br><br><span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">&quot;order_topic&quot;</span>, <span class="hljs-string">&quot;TagA&quot;</span>, <span class="hljs-string">&quot;OrderID001&quot;</span>, (<span class="hljs-string">&quot;æ”¯ä»˜è®¢å•&quot;</span> + order.getId()).getBytes(RemotingHelper.DEFAULT_CHARSET));<br><br><span class="hljs-comment">// å‘é€åŠæ¶ˆæ¯</span><br><span class="hljs-type">SendResult</span> <span class="hljs-variable">sendResult</span> <span class="hljs-operator">=</span> producer.sendMessageInTransaction(msg, <span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure><p>æ­¥éª¤ 2: æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</p><p>è¿™ä¸ªæ­¥éª¤é€šå¸¸æ˜¯åœ¨äº‹åŠ¡ç›‘å¬å™¨ä¸­å®ç°ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">rocketmq</span>.<span class="hljs-property">client</span>.<span class="hljs-property">producer</span>.<span class="hljs-property">LocalTransactionState</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">rocketmq</span>.<span class="hljs-property">client</span>.<span class="hljs-property">producer</span>.<span class="hljs-property">TransactionListener</span>;<br><br>producer.<span class="hljs-title function_">setTransactionListener</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionListener</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">LocalTransactionState</span> <span class="hljs-title function_">executeLocalTransaction</span>(<span class="hljs-params">Message msg, <span class="hljs-built_in">Object</span> arg</span>) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ˆæ¯”å¦‚æ•°æ®åº“æ“ä½œï¼‰</span><br>            orderService.<span class="hljs-title function_">payOrder</span>(order.<span class="hljs-title function_">getId</span>());<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">LocalTransactionState</span>.<span class="hljs-property">COMMIT_MESSAGE</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">LocalTransactionState</span>.<span class="hljs-property">ROLLBACK_MESSAGE</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">LocalTransactionState</span> <span class="hljs-title function_">checkLocalTransaction</span>(<span class="hljs-params">MessageExt msg</span>) &#123;<br>        <span class="hljs-comment">// å›æŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€</span><br>        <span class="hljs-title class_">String</span> orderId = msg.<span class="hljs-title function_">getKeys</span>();<br>        <span class="hljs-keyword">if</span> (orderService.<span class="hljs-title function_">checkOrderPaid</span>(orderId)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">LocalTransactionState</span>.<span class="hljs-property">COMMIT_MESSAGE</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">LocalTransactionState</span>.<span class="hljs-property">ROLLBACK_MESSAGE</span>;<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ­¥éª¤ 3: æäº¤æˆ–å›æ»šæ¶ˆæ¯</p><p>æ ¹æ®æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœï¼ŒRocketMQ å°†å¤„ç†æ¶ˆæ¯çš„æäº¤æˆ–å›æ»š</p><hr><blockquote><p>é¡¹ç›®å†…å®¹</p></blockquote><p>å»ºè¡¨ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">-- ç§¯åˆ†ç³»ç»Ÿ  </span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> rocketmq-demo-points;  <br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> `t_points`;  <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_points` (  <br>                            `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;ä¸»é”®&#x27;</span>,  <br>                            `user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;ç”¨æˆ·ID&#x27;</span>,  <br>                            `order_no` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;è®¢å•ç¼–å·&#x27;</span>,  <br>                            `points` <span class="hljs-type">int</span>(<span class="hljs-number">5</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;ç§¯åˆ†&#x27;</span>,  <br>                            `remarks` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;æ— &#x27;</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;å¤‡æ³¨&#x27;</span>,  <br>                            <span class="hljs-keyword">PRIMARY KEY</span> (`id`)  <br>) ENGINE=InnoDB AUTO_INCREMENT=<span class="hljs-number">2</span> <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8mb4 <span class="hljs-keyword">COMMENT</span>=<span class="hljs-string">&#x27;ç§¯åˆ†è¡¨&#x27;</span>;  <br>  <br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="hljs-number">1</span>;  <br>  <br><span class="hljs-comment">-- è®¢å•ç³»ç»Ÿ  </span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> `t_order`;  <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_order` (  <br>                           `order_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;è®¢å•ç¼–å·&#x27;</span>,  <br>                           `create_time` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,  <br>                           `user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;ç”¨æˆ·ID&#x27;</span>,  <br>                           `amount` <span class="hljs-type">decimal</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;è®¢å•é‡‘é¢&#x27;</span>,  <br>                           <span class="hljs-keyword">PRIMARY KEY</span> (`order_id`) <span class="hljs-keyword">USING</span> BTREE  <br>) ENGINE=InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8mb4 <span class="hljs-keyword">COMMENT</span>=<span class="hljs-string">&#x27;è®¢å•è¡¨&#x27;</span>;  <br>  <br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> `transaction_log`;  <br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `transaction_log` (  <br>                                   `id` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;äº‹åŠ¡ID&#x27;</span>,  <br>                                   `business` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;ä¸šåŠ¡æ ‡è¯†&#x27;</span>,  <br>                                   `foreign_key` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;å¯¹åº”ä¸šåŠ¡è¡¨ä¸­çš„ä¸»é”®&#x27;</span>,  <br>                                   <span class="hljs-keyword">PRIMARY KEY</span> (`id`)  <br>) ENGINE=InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8mb4 <span class="hljs-keyword">COMMENT</span>=<span class="hljs-string">&#x27;äº‹åŠ¡æ—¥å¿—è¡¨&#x27;</span>;  <br>  <br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé¡¹ç›®æ˜¯åˆ†ä¸ºäº†ä¸¤ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªæ˜¯è®¢å•æ¨¡å—ï¼Œä¸€ä¸ªæ˜¯ç§¯åˆ†æ¨¡å—ï¼›</p><p>ä½ å¯ä»¥ä» demo ä¸­çœ‹å‡ºï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå…ˆå‘é€ä¸€æ¡åŠæ¶ˆæ¯ï¼ˆé€šè¿‡ sendMessageInTransaction ï¼‰</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * äº‹åŠ¡æ¶ˆæ¯å‘é€  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> data  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> topic  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span>  </span><br><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-function">TransactionSendResult <span class="hljs-title">send</span><span class="hljs-params">(String data, String topic)</span> <span class="hljs-keyword">throws</span> MQClientException </span>&#123;  <br>    <span class="hljs-comment">//ä½¿ç”¨ RocketMQ çš„ TransactionMQProducer æ¥å‘é€äº‹åŠ¡æ€§æ¶ˆæ¯  </span><br>    Message message = <span class="hljs-keyword">new</span> Message(topic, data.getBytes());  <br>    <span class="hljs-function"><span class="hljs-keyword">return</span> producer.<span class="hljs-title">sendMessageInTransaction</span><span class="hljs-params">(message, <span class="hljs-keyword">null</span>)</span></span>;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œå½“ <code>TransactionProducer</code> å‘é€ä¸€ä¸ªäº‹åŠ¡æ¶ˆæ¯æ—¶ï¼Œ<code>TransactionMQProducer</code> ä¼šå…ˆå­˜å‚¨ä¸€ä¸ªåŠæ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åè°ƒç”¨ <code>TransactionListener</code> å®ç°çš„ <code>executeLocalTransaction</code> æ–¹æ³•</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs pf">@Override  <br>public LocalTransactionState executeLocalTransaction(Message message, Object o) &#123;  <br>    <span class="hljs-keyword">log</span>.info(<span class="hljs-string">&quot;å¼€å§‹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡....&quot;</span>);  <br>    LocalTransactionState <span class="hljs-keyword">state</span> = null;  <br>    try &#123;  <br>        String body = new String(message.getBody());  <br>        TOrder tOrder = JSONObject.parseObject(body, TOrder.class);  <br>        // æ‰§è¡Œæœ¬åœ°äº‹åŠ¡  <br>        orderService.insertOrder(tOrder, message.getTransactionId());  <br>        <span class="hljs-keyword">state</span> = LocalTransactionState.COMMIT_MESSAGE;  <br>        <span class="hljs-keyword">log</span>.info(<span class="hljs-string">&quot;æœ¬åœ°äº‹åŠ¡å·²æäº¤ã€‚&#123;&#125;&quot;</span>, message.getTransactionId());  <br>    &#125;catch (Exception e)&#123;  <br>        <span class="hljs-keyword">log</span>.error(<span class="hljs-string">&quot;æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¤±è´¥ã€‚&#123;&#125;&quot;</span>, e.getMessage());  <br>        <span class="hljs-keyword">state</span> = LocalTransactionState.ROLLBACK_MESSAGE;  <br>    &#125;  <br>    return <span class="hljs-keyword">state</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><p>äº‹åŠ¡å›æŸ¥ä¹Ÿæ˜¯åœ¨è¿™ä¸ªç±»ä¸­è¿›è¡Œæ“ä½œçš„ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆBrokerï¼‰æœªåœ¨è§„å®šæ—¶é—´å†…æ”¶åˆ°æ¶ˆæ¯çš„æœ€ç»ˆæäº¤ï¼ˆCOMMITï¼‰æˆ–å›æ»šï¼ˆROLLBACKï¼‰çŠ¶æ€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒBroker éœ€è¦ç¡®å®šæ¶ˆæ¯çš„ç¡®åˆ‡çŠ¶æ€ï¼Œä¼šè¿›è¡Œå›æŸ¥æ“ä½œã€‘</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs typescript">package com.<span class="hljs-property">xxx</span>.<span class="hljs-property">order</span>.<span class="hljs-property">service</span>;<br><br><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">fastjson</span>.<span class="hljs-property">JSONObject</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">xxx</span>.<span class="hljs-property">common</span>.<span class="hljs-property">domain</span>.<span class="hljs-property">TOrder</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">xxx</span>.<span class="hljs-property">common</span>.<span class="hljs-property">domain</span>.<span class="hljs-property">TransactionLog</span>;<br><span class="hljs-keyword">import</span> lombok.<span class="hljs-property">extern</span>.<span class="hljs-property">slf4j</span>.<span class="hljs-property">Slf4j</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">rocketmq</span>.<span class="hljs-property">client</span>.<span class="hljs-property">producer</span>.<span class="hljs-property">LocalTransactionState</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">rocketmq</span>.<span class="hljs-property">client</span>.<span class="hljs-property">producer</span>.<span class="hljs-property">TransactionListener</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">rocketmq</span>.<span class="hljs-property">common</span>.<span class="hljs-property">message</span>.<span class="hljs-property">Message</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">rocketmq</span>.<span class="hljs-property">common</span>.<span class="hljs-property">message</span>.<span class="hljs-property">MessageExt</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by Sinotn</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: libin</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@CreateTime</span>: 2020-10-28 14:07</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: è®¢å•äº‹åŠ¡ç›‘å¬ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTransactionListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TransactionListener</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">OrderService</span> orderService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">TransactionLogService</span> transactionLogService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">LocalTransactionState</span> <span class="hljs-title function_">executeLocalTransaction</span>(<span class="hljs-params">Message message, <span class="hljs-built_in">Object</span> o</span>) &#123;<br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;å¼€å§‹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡....&quot;</span>);<br>        <span class="hljs-title class_">LocalTransactionState</span> state = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-title class_">String</span> body = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.<span class="hljs-title function_">getBody</span>());<br>            <span class="hljs-title class_">TOrder</span> tOrder = <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>.<span class="hljs-title function_">parseObject</span>(body, <span class="hljs-title class_">TOrder</span>.<span class="hljs-property">class</span>);<br>            <span class="hljs-comment">// æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</span><br>            orderService.<span class="hljs-title function_">insertOrder</span>(tOrder, message.<span class="hljs-title function_">getTransactionId</span>());<br>            state = <span class="hljs-title class_">LocalTransactionState</span>.<span class="hljs-property">COMMIT_MESSAGE</span>;<br>            log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;æœ¬åœ°äº‹åŠ¡å·²æäº¤ã€‚&#123;&#125;&quot;</span>, message.<span class="hljs-title function_">getTransactionId</span>());<br>        &#125;<span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e)&#123;<br>            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¤±è´¥ã€‚&#123;&#125;&quot;</span>, e.<span class="hljs-title function_">getMessage</span>());<br>            state = <span class="hljs-title class_">LocalTransactionState</span>.<span class="hljs-property">ROLLBACK_MESSAGE</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> state;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">LocalTransactionState</span> <span class="hljs-title function_">checkLocalTransaction</span>(<span class="hljs-params">MessageExt messageExt</span>) &#123;<br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;å¼€å§‹å›æŸ¥æœ¬åœ°äº‹åŠ¡....&quot;</span>);<br>        <span class="hljs-title class_">LocalTransactionState</span> state = <span class="hljs-literal">null</span>;<br>        <span class="hljs-title class_">String</span> transId = messageExt.<span class="hljs-title function_">getTransactionId</span>();<br>        <span class="hljs-comment">// å¦‚æœæœ¬åœ°äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™äº‹åŠ¡æäº¤æˆåŠŸ</span><br>        <span class="hljs-title class_">TransactionLog</span> transactionLog = transactionLogService.<span class="hljs-title function_">getById</span>(transId);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != transactionLog)&#123;<br>            state = <span class="hljs-title class_">LocalTransactionState</span>.<span class="hljs-property">COMMIT_MESSAGE</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            state = <span class="hljs-title class_">LocalTransactionState</span>.<span class="hljs-property">ROLLBACK_MESSAGE</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> state;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å³åªæœ‰å½“ä¸šåŠ¡æ“ä½œæˆåŠŸå®Œæˆæ—¶ï¼Œç›¸å…³çš„æ¶ˆæ¯æ‰ä¼šè¢«å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¾›æ¶ˆè´¹è€…å¤„ç†ã€‚è¿™å¯¹äºéœ€è¦å¼ºä¸€è‡´æ€§çš„ä¸šåŠ¡æµç¨‹è‡³å…³é‡è¦</p><p>æ¥æ”¶è€…çš„éƒ¨åˆ†ä»£ç </p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Override</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-title class_">ConsumeConcurrentlyStatus</span> <span class="hljs-title function_">consumeMessage</span>(<span class="hljs-params">List&lt;MessageExt&gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext</span>) &#123;  <br>    log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;æ¶ˆè´¹è€…çº¿ç¨‹ç›‘å¬åˆ°æ¶ˆæ¯ã€‚&quot;</span>);  <br>    <span class="hljs-keyword">for</span> (<span class="hljs-title class_">MessageExt</span> <span class="hljs-attr">messageExt</span>: list)&#123;  <br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">processor</span>(messageExt))&#123;  <br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ConsumeConcurrentlyStatus</span>.<span class="hljs-property">RECONSUME_LATER</span>;  <br>        &#125;  <br>    &#125;  <br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ConsumeConcurrentlyStatus</span>.<span class="hljs-property">CONSUME_SUCCESS</span>;  <br>&#125;<br><br><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * æ¶ˆæ¯å¤„ç†ï¼Œç¬¬3æ¬¡å¤„ç†å¤±è´¥åï¼Œå‘é€é‚®ä»¶é€šçŸ¥äººå·¥ä»‹å…¥  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> messageExt  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span>  </span><br><span class="hljs-comment"> */</span><span class="hljs-keyword">private</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">processor</span>(<span class="hljs-params">MessageExt messageExt</span>)&#123;  <br>    <span class="hljs-title class_">String</span> body = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(messageExt.<span class="hljs-title function_">getBody</span>());  <br>    <span class="hljs-keyword">try</span>&#123;  <br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;æ¶ˆæ¯å¤„ç†...&#123;&#125;&quot;</span>, body);  <br>        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;å¼€å§‹å¤„ç†è®¢å•æ•°æ®ï¼Œå‡†å¤‡å¢åŠ ç§¯åˆ†....&quot;</span>);  <br>        <span class="hljs-title class_">TOrder</span> order  = <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>.<span class="hljs-title function_">parseObject</span>(body, <span class="hljs-title class_">TOrder</span>.<span class="hljs-property">class</span>);  <br>        pointsService.<span class="hljs-title function_">insert</span>(order);  <br>        <span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚å¸¸  </span><br>        <span class="hljs-comment">//int k = 1/0;  </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <br>    &#125;<span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e)&#123;  <br>        <span class="hljs-keyword">if</span> (messageExt.<span class="hljs-title function_">getReconsumeTimes</span>() &gt;= <span class="hljs-number">3</span>)&#123;  <br>            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;æ¶ˆæ¯é‡è¯•å·²è¾¾æœ€å¤§æ¬¡æ•°ï¼Œå°†é€šçŸ¥ä¸šåŠ¡äººå‘˜æ’æŸ¥é—®é¢˜ã€‚&#123;&#125;&quot;</span>,messageExt.<span class="hljs-title function_">getMsgId</span>());  <br>            <span class="hljs-comment">// å‘é€é‚®ä»¶æˆ–è€…æŠ¥è­¦  </span><br>            <span class="hljs-comment">// sendMail(messageExt);  </span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <br>        &#125;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçœ‹åŠæ¶ˆæ¯ sendMessageInTransaction å’Œ executeLocalTransaction çš„ç¡®æ˜¯å¯¹åº”å…³ç³»ï¼Œä¸è¿‡è¿™ä¸ªå…³ç³»æ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œå®šä¹‰çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xxx.order.service;<br><br><span class="hljs-keyword">import</span> org.apache.rocketmq.client.exception.MQClientException;<br><span class="hljs-keyword">import</span> org.apache.rocketmq.client.producer.TransactionMQProducer;<br><span class="hljs-keyword">import</span> org.apache.rocketmq.client.producer.TransactionSendResult;<br><span class="hljs-keyword">import</span> org.apache.rocketmq.common.message.Message;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> javax.annotation.PostConstruct;<br><span class="hljs-keyword">import</span> java.util.concurrent.ArrayBlockingQueue;<br><span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Created by Sinotn</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: libin</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@CreateTime</span>: 2020-10-28 14:05</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: äº‹åŠ¡ç”Ÿäº§</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionProducer</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">GROUP_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;order_trans_group&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> TransactionMQProducer producer;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderTransactionListener orderTransactionListener;<br><br>    <span class="hljs-comment">//æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± </span><br>    <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">60</span>,<br>            TimeUnit.SECONDS, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">50</span>));<br><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span>&#123;<br>        producer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionMQProducer</span>(GROUP_NAME);<br>        producer.setNamesrvAddr(<span class="hljs-string">&quot;192.168.56.105:9876&quot;</span>);<br>        producer.setSendMsgTimeout(<span class="hljs-number">100</span>);<br>        producer.setExecutorService(executor);<br>        producer.setTransactionListener(orderTransactionListener);<br>        <span class="hljs-built_in">this</span>.start();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-built_in">this</span>.producer.start();<br>        &#125; <span class="hljs-keyword">catch</span> (MQClientException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * äº‹åŠ¡æ¶ˆæ¯å‘é€</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> topic</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> TransactionSendResult <span class="hljs-title function_">send</span><span class="hljs-params">(String data, String topic)</span> <span class="hljs-keyword">throws</span> MQClientException &#123;<br>        <span class="hljs-comment">//ä½¿ç”¨ RocketMQ çš„ TransactionMQProducer æ¥å‘é€äº‹åŠ¡æ€§æ¶ˆæ¯</span><br>        <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(topic, data.getBytes());<br>        <span class="hljs-keyword">return</span> producer.sendMessageInTransaction(message, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLè°ƒä¼˜æ“ä½œ</title>
    <link href="/2024/04/10/MySQL%E8%B0%83%E4%BC%98%E6%93%8D%E4%BD%9C/"/>
    <url>/2024/04/10/MySQL%E8%B0%83%E4%BC%98%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<p>é“¾æ¥åœ°å€ï¼š <a href="https://www.bilibili.com/video/BV1SD42157HR">https://www.bilibili.com/video/BV1SD42157HR</a></p><p>åœ¨æ¼”ç¤ºä¹‹å‰ï¼Œæ·»åŠ éƒ¨åˆ†çš„æ•°æ®</p><p>æ–°å»ºè¡¨</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> employees (<br>    id <span class="hljs-type">INT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY KEY</span>,<br>    <span class="hljs-type">name</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),<br>age <span class="hljs-type">INT</span>,<br>    department_id <span class="hljs-type">INT</span>,<br>    hire_date <span class="hljs-type">DATE</span><br>);<br></code></pre></td></tr></table></figure><p>ç´¢å¼•åŸºç¡€æ“ä½œ</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">#æ·»åŠ ç´¢å¼•<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_department_id <span class="hljs-keyword">ON</span> employees(department_id);<br># åˆ é™¤ç´¢å¼•<br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">INDEX</span> idx_department_id <span class="hljs-keyword">ON</span> employees;<br># æ–°å¢ç´¢å¼•<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> employees <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">INDEX</span> idx_department_id (department_id);<br>#æŸ¥çœ‹ç´¢å¼•<br><span class="hljs-keyword">SHOW</span> INDEXES <span class="hljs-keyword">FROM</span> employees;<br>#ç»„åˆç´¢å¼•<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">INDEX</span> idx_name_age <span class="hljs-keyword">ON</span> employees(<span class="hljs-type">name</span>, age);<br></code></pre></td></tr></table></figure><p>æ‰¹é‡æ·»åŠ ç¤ºä¾‹æ•°æ®ï¼Œè¿™é‡Œæ˜¯é€šè¿‡ gpt4.0ï¼Œé€šè¿‡è¯´ç”Ÿæˆ excel ç±»ä¼¼æ ¼å¼çš„éšæœºå†…å®¹ï¼Œç„¶åç”Ÿæˆä¸€ä¸‡æ¡æ•°æ®ï¼Œå†é€šè¿‡ navicat å·¥å…·è¿›è¡Œå¯¼å…¥æ“ä½œã€‚</p><p><strong>ç´¢å¼•ä¼˜åŒ–</strong></p><h4 id="æœ€å·¦å‰ç¼€åŸåˆ™"><a href="#æœ€å·¦å‰ç¼€åŸåˆ™" class="headerlink" title="æœ€å·¦å‰ç¼€åŸåˆ™"></a>æœ€å·¦å‰ç¼€åŸåˆ™</h4><p>æœ€å·¦å‰ç¼€æ³•åˆ™ï¼šå¸¦å¤´å¤§å“¥ä¸èƒ½æ­»ï¼Œä¸­é—´å…„å¼Ÿä¸èƒ½æ–­</p><p>å½“é¢è¯•çš„æ—¶å€™ï¼Œå»ºè®®ä¸è¦ä»ç›´æ¥çš„è¡¨è±¡å»å›ç­”è¿™äº›é—®é¢˜ï¼Œå»ºè®®ç»“åˆä¸€ä¸‹ç›¸å…³çš„åº•å±‚å®ç°å»è®²ï¼›</p><p>æ¯”å¦‚è¯´è°ˆåˆ°å•Šæœ€å·¦å‰ç¼€åŸåˆ™å¤±æ•ˆçš„æ—¶å€™ï¼Œä½ å¯ä»¥è®²ä¸€ä¸‹ï¼Œæˆ‘ä»¬MySQL çš„ä½¿ç”¨çš„å­˜å‚¨å¼•æ“ innodb ä¸­ï¼Œé‡‡ç”¨ B+ æ ‘çš„ç´¢å¼•ç»“æ„ï¼ˆè¿™é‡Œå¯èƒ½ä¼šé—®ä¸€ä¸‹ä¸ºä»€ä¹ˆMysql ä¼šä½¿ç”¨ B+ æ ‘çš„æ•°æ®ç»“æ„ï¼Œæœ‰ä¸€ä¸ª é’©å­ç‚¹åŸ‹ä¸‹ï¼‰</p><p>ç„¶åè¿™é‡Œå¯ä»¥å›´ç»•è¯´ï¼Œå½“æˆ‘ä»¬æ²¿ç€ B+ æ ‘çš„å¶å­èŠ‚ç‚¹å¾€ä¸‹èµ°çš„æ—¶å€™ï¼Œå¦‚æœè¯´å‰ç¼€æœªåŒ¹é…ï¼ˆå¸¦å¤´å¤§å“¥ä¸èƒ½æ­»ï¼Œä¸­é—´å…„å¼Ÿä¸èƒ½æ–­ï¼‰ï¼Œè¿™ä¸ªæ ‘èŠ‚ç‚¹å°±èµ°ä¸ä¸‹å»ï¼ˆä¸èµ°ç´¢å¼•ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240410190357.png" alt="image.png"></p><p>æ ¸å¿ƒæ€æƒ³æ˜¯å›´ç»•ç´¢å¼• â€æœ‰åºâ€œ  è¿™ä¸ªç‚¹å‡ºå‘å»è®²ã€‚</p><h4 id="ç´¢å¼•ç±»ä¸Šå°‘è®¡ç®—æ•°"><a href="#ç´¢å¼•ç±»ä¸Šå°‘è®¡ç®—æ•°" class="headerlink" title="ç´¢å¼•ç±»ä¸Šå°‘è®¡ç®—æ•°"></a>ç´¢å¼•ç±»ä¸Šå°‘è®¡ç®—æ•°</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">explain</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> employees <span class="hljs-keyword">where</span> left(<span class="hljs-type">name</span>,<span class="hljs-number">2</span>) = <span class="hljs-string">&#x27;He&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šè¿›è¡Œçš„æ˜¯å…¨è¡¨æ‰«ææ“ä½œï¼Œå½“ä»–å®é™…ä¸Šåœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨åˆ°äº†å‡½æ•°ï¼Œä»–å®é™…ä¼šå¯¹äºå½“å‰ç´¢å¼•æ•°ä¸‹ï¼Œå½“å‰åˆ—æ¯ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œè¿ç®—ï¼Œä»è€Œä¼šè¿›è¡Œå…¨è¡¨æ‰«æã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240410192702.png" alt="image.png"></p><p>ä¼˜åŒ–ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">explain</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> employees <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;He%&#x27;</span>;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ like è¿ç®—ï¼Œè¿›è¡Œåç¼€æŸ¥è¯¢æ“ä½œï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šèµ°ç´¢å¼•ï¼ˆæœ‰åºæ“ä½œï¼‰ï¼Œä»è€Œè¿™é‡Œä¼šå®é™…èµ°äº†èŒƒå›´ç´¢å¼•æŸ¥è¯¢ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240410193006.png" alt="image.png"></p><p>æ€»ç»“ï¼šä¸åœ¨ç´¢å¼•ç±»ä¸Šåšä»»ä½•æ“ä½œï¼ˆè®¡ç®—ã€å‡½æ•°ã€ï¼ˆè‡ªåŠ¨ or æ‰‹åŠ¨ï¼‰ç±»å‹è½¬æ¢ï¼‰ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œè½¬å‘å…¨è¡¨æ‰«æã€‚</p><p>æ ¸å¿ƒå°±å›´ç»•ä¸€ä¸ªï¼šæœ‰åºï¼Œå°½å¯èƒ½èµ°å¶å­èŠ‚ç‚¹ä¸‹æœ‰åºçš„æ“ä½œã€‚</p><h4 id="èŒƒå›´åé¢å…¨å¤±æ•ˆ"><a href="#èŒƒå›´åé¢å…¨å¤±æ•ˆ" class="headerlink" title="èŒƒå›´åé¢å…¨å¤±æ•ˆ"></a>èŒƒå›´åé¢å…¨å¤±æ•ˆ</h4><h4 id="select-ä½¿ç”¨æ˜ç¡®å­—æ®µï¼ˆå°½å¯èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼‰"><a href="#select-ä½¿ç”¨æ˜ç¡®å­—æ®µï¼ˆå°½å¯èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼‰" class="headerlink" title="select ä½¿ç”¨æ˜ç¡®å­—æ®µï¼ˆå°½å¯èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼‰"></a>select ä½¿ç”¨æ˜ç¡®å­—æ®µï¼ˆå°½å¯èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼‰</h4><h4 id="ä¸ç­‰ç©ºå€¼æˆ–è€…-or"><a href="#ä¸ç­‰ç©ºå€¼æˆ–è€…-or" class="headerlink" title="ä¸ç­‰ç©ºå€¼æˆ–è€… or"></a>ä¸ç­‰ç©ºå€¼æˆ–è€… or</h4><p>å¦‚æœå‡ºç° !&#x3D; æˆ–è€… or çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•çš„æ“ä½œï¼›</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240410194918.png" alt="image.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">explain</span> <span class="hljs-keyword">select</span> <span class="hljs-type">name</span>,age <span class="hljs-keyword">from</span> employees <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> != <span class="hljs-string">&#x27;Colleen Perry&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;Marcus Wilson&#x27;</span>;<br><br><span class="hljs-keyword">explain</span> <span class="hljs-keyword">select</span> <span class="hljs-type">name</span>,age <span class="hljs-keyword">from</span> employees FORCE <span class="hljs-keyword">INDEX</span>(idx_name_age_part) <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> != <span class="hljs-string">&#x27;Colleen Perry&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;Marcus Wilson&#x27;</span><br></code></pre></td></tr></table></figure><p>å½“ä½¿ç”¨å¼ºåˆ¶ç´¢å¼• idx_name_age_partï¼Œç¬¬äºŒæ­¥ä»–è¿™é‡Œèµ°çš„æ˜¯èŒƒå›´æŸ¥è¯¢ç´¢å¼•ï¼Œæ‰«æçš„è¡Œæ•°å˜å°‘äº†ä¸€äº›ï¼ˆæ•°æ®é‡å¤§çš„è¯æ›´æ˜æ˜¾ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240410194935.png" alt="image.png"></p><h4 id="VAR-å¼•å·ä¸èƒ½ä¸¢"><a href="#VAR-å¼•å·ä¸èƒ½ä¸¢" class="headerlink" title="VAR å¼•å·ä¸èƒ½ä¸¢"></a>VAR å¼•å·ä¸èƒ½ä¸¢</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240410195606.png" alt="image.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">explain</span> <span class="hljs-keyword">select</span> <span class="hljs-type">name</span>,age <span class="hljs-keyword">from</span> employees <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = <span class="hljs-number">30</span>;<br><br><span class="hljs-keyword">explain</span> <span class="hljs-keyword">select</span> <span class="hljs-type">name</span>,age <span class="hljs-keyword">from</span> employees <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> = <span class="hljs-string">&#x27;30&#x27;</span>;<br></code></pre></td></tr></table></figure><p>å½“ var ç±»å‹ä½¿ç”¨çš„æŸ¥è¯¢æ¡ä»¶è¿™é‡Œä½¿ç”¨æ•°å­—çš„è¯ï¼Œä»–éšå«çš„æ“ä½œæ˜¯ç±»å‹è½¬æ¢æ“ä½œï¼Œä¼šå°†å­—æ®µå†…å®¹è½¬æ¢ä¸ºæ•°å€¼ç±»å‹ï¼Œå†è¿›è¡ŒæŸ¥è¯¢æ“ä½œï¼Œå› æ­¤è¿™é‡Œä¼šè¿›è¡Œå…¨è¡¨æ‰«ææ“ä½œï¼›</p><p>å› æ­¤å»ºè®® var å¼•å·ä¸èƒ½ä¸¢ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240410195634.png" alt="image.png"></p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IDEAä¸­çš„å¸¸è§ä½¿ç”¨</title>
    <link href="/2024/04/03/IDEA%E4%B8%AD%E7%9A%84%E5%B8%B8%E8%A7%81%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/04/03/IDEA%E4%B8%AD%E7%9A%84%E5%B8%B8%E8%A7%81%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="IDEAä¸­Debugæ–­ç‚¹çš„ä½¿ç”¨"><a href="#IDEAä¸­Debugæ–­ç‚¹çš„ä½¿ç”¨" class="headerlink" title="IDEAä¸­Debugæ–­ç‚¹çš„ä½¿ç”¨"></a>IDEAä¸­Debugæ–­ç‚¹çš„ä½¿ç”¨</h3><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/gen2122/p/15016013.html">https://www.cnblogs.com/gen2122/p/15016013.html</a></p><p>è°ƒè¯•çš„åŸºæœ¬æ“ä½œï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/4d98e7b1a63931eb11e8cf29dacd4b7d.png" alt="4d98e7b1a63931eb11e8cf29dacd4b7d.png"></p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">step</span> over<br>       è¿›å…¥ä¸‹ä¸€æ­¥<br>       åœ¨è°ƒè¯•çª—å£çš„ä¸Šæ–¹ï¼Œå«ä¹‰ä¸ºï¼šè¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå¦‚æœå½“å‰è¡Œæ–­ç‚¹æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œåˆ™ä¸è¿›å…¥å½“å‰æ–¹æ³•ä½“å†…ã€‚<br>       å³ä»ä»£ç è¡ŒAï¼Œè·³åˆ°ä¸‹ä¸€è¡Œä»£ç A + <span class="hljs-number">1</span>ï¼Œå¹¶æ‰§è¡ŒåŸæ¥Aè¡Œä»£ç <br><span class="hljs-keyword">step</span> <span class="hljs-keyword">into</span> <br>       è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå¦‚æœå½“å‰è¡Œæ–­ç‚¹æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œåˆ™è¿›å…¥å½“å‰æ–¹æ³•ä½“å†…ã€‚<br>       ä½†æœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œ<span class="hljs-keyword">step</span> <span class="hljs-keyword">into</span> åªé’ˆå¯¹è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œå¦‚æœå¯¹åº”çš„æ–¹æ³•æ˜¯å®˜æ–¹åº“çš„æ–¹æ³•ï¼Œå¹¶ä¸ä¼šè¿›å…¥æ–¹æ³•ä½“å†…ã€‚<br>Force <span class="hljs-keyword">step</span> <span class="hljs-keyword">into</span><br>      è¿›å…¥ä¸‹ä¸€æ­¥ï¼ŒForce <span class="hljs-keyword">step</span> <span class="hljs-keyword">into</span>ï¼Œæ— è®ºæ–¹æ³•æ˜¯ä»€ä¹ˆæ–¹æ³•ï¼Œéƒ½ä¼šè¿›å…¥åˆ°æ–¹æ³•ä½“ä¸­<br><span class="hljs-keyword">step</span> <span class="hljs-keyword">out</span>  å›åˆ°ä¸Šä¸€å±‚çš„æ–¹æ³•ä¸­ï¼ˆè·³å‡ºï¼‰<br>resume program   <br>      æ¢å¤ç¨‹åºè¿è¡Œï¼Œå¦‚æœè¯¥æ–­ç‚¹ä¸‹é¢ä»£ç è¿˜æœ‰æ–­ç‚¹åˆ™åœåœ¨ä¸‹ä¸€ä¸ªæ–­ç‚¹ä¸Šï¼Œå³ä»ä¸€ä¸ªæ–­ç‚¹è·³åˆ°å¦ä¸€ä¸ªæ–­ç‚¹<br>mute breakpoints<br>      ä½¿å¾—æ‰€æœ‰çš„æ–­ç‚¹å¤±æ•ˆ ï¼Œè®©æ‰€æœ‰æ–­ç‚¹å¤±æ•ˆï¼Œå¯ä»¥ç›´æ¥è¿è¡Œå®Œå‰©ä½™çš„ç¨‹åº<br></code></pre></td></tr></table></figure><h4 id="å¸¸ç”¨å¿«æ·é”®"><a href="#å¸¸ç”¨å¿«æ·é”®" class="headerlink" title="å¸¸ç”¨å¿«æ·é”®"></a>å¸¸ç”¨å¿«æ·é”®</h4>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
      <category>IDEA</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>JavaåŸºç¡€_IOåŸºç¡€æ“ä½œ</title>
    <link href="/2024/04/03/Java%E5%9F%BA%E7%A1%80_IO%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/"/>
    <url>/2024/04/03/Java%E5%9F%BA%E7%A1%80_IO%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><p>åœ¨ Java ä¸­ï¼Œ<code>File</code> ç±»æ˜¯ <code>java.io</code> åŒ…çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºè¡¨ç¤ºæ–‡ä»¶å’Œç›®å½•è·¯å¾„åçš„æŠ½è±¡è¡¨ç¤ºå½¢å¼ã€‚å®ƒå¯ä»¥ç”¨æ¥åˆ›å»ºã€åˆ é™¤ã€è·å–å’Œè®¾ç½®æ–‡ä»¶æˆ–ç›®å½•çš„å±æ€§ã€‚</p><p><code>File</code> ç±»ä¸å¯ä»¥ç”¨äºæ–‡ä»¶å†…å®¹çš„è¯»å†™ï¼›å¦‚æœéœ€è¦è¯»å†™æ–‡ä»¶å†…å®¹ï¼Œåº”ä½¿ç”¨ <code>FileInputStream</code>ã€<code>FileOutputStream</code>ã€<code>FileReader</code>ã€<code>FileWriter</code> ç­‰å…¶ä»–æµç±»ã€‚</p><p>File è¿™ä¸ªç±»ä¸€èˆ¬æ˜¯ç”¨äºå¯¹äºæ–‡ä»¶æˆ–è€…ç›®å½•çš„åˆ›å»ºåˆ é™¤çš„å¸¸ç”¨æ“ä½œã€‚</p><h4 id="åˆ›å»ºæ–‡ä»¶æ“ä½œ"><a href="#åˆ›å»ºæ–‡ä»¶æ“ä½œ" class="headerlink" title="åˆ›å»ºæ–‡ä»¶æ“ä½œ"></a>åˆ›å»ºæ–‡ä»¶æ“ä½œ</h4><p>åˆ›å»ºä¸€ä¸ª <code>File</code> å®ä¾‹ä¸ä¼šåœ¨ç¡¬ç›˜ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæŠ½è±¡è¡¨ç¤ºã€‚è¦åˆ›å»ºæˆ–è®¿é—®æ–‡ä»¶ï¼Œå¯ä»¥å¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">File</span> <span class="hljs-keyword">file</span> = <span class="hljs-keyword">new</span> <span class="hljs-keyword">File</span>(<span class="hljs-string">&quot;path/to/file.txt&quot;</span>);<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„è·¯å¾„å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ã€‚ç›¸å¯¹è·¯å¾„ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•ã€‚</p><p>å¦‚æœè¦çœ‹å½“å‰å·¥ä½œç©ºé—´ç›®å½•æ˜¯å“ªä¸ªï¼Œå¯ä»¥é€šè¿‡ ä¸‹è¿°æ“ä½œæŸ¥çœ‹ã€‚</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-comment">// è·å–å½“å‰å·¥ä½œç›®å½•  </span><br><span class="hljs-title class_">String</span> <span class="hljs-variable">workingDir</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">System</span>.<span class="hljs-property">getProperty</span>(<span class="hljs-string">&quot;user.dir&quot;</span>);  <br><span class="hljs-comment">// æ‰“å°å½“å‰å·¥ä½œç›®å½•  </span><br><span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-property">println</span>(<span class="hljs-string">&quot;å½“å‰å·¥ä½œç›®å½•: &quot;</span> <span class="hljs-operator">+</span> <span class="hljs-variable">workingDir</span>);<br></code></pre></td></tr></table></figure><h3 id="æ—¥å¸¸è®°å½•"><a href="#æ—¥å¸¸è®°å½•" class="headerlink" title="æ—¥å¸¸è®°å½•"></a>æ—¥å¸¸è®°å½•</h3><h4 id="éå†-D-ç›˜è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œè·å–æŒ‡å®šæ–‡ä»¶åçš„è·¯å¾„ä½ç½®"><a href="#éå†-D-ç›˜è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œè·å–æŒ‡å®šæ–‡ä»¶åçš„è·¯å¾„ä½ç½®" class="headerlink" title="éå† D ç›˜è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œè·å–æŒ‡å®šæ–‡ä»¶åçš„è·¯å¾„ä½ç½®"></a>éå† D ç›˜è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œè·å–æŒ‡å®šæ–‡ä»¶åçš„è·¯å¾„ä½ç½®</h4><blockquote><p>æ“ä½œä¸€ï¼šä½¿ç”¨ File è¿›è¡Œéå†æ“ä½œ</p></blockquote><p>ç¯å¢ƒï¼šæœ¬åœ°ç”µè„‘ï¼ŒD ç›˜å ç”¨ç£ç›˜å¤§æ¦‚ 300 G å·¦å³</p><p>è¾“å‡ºï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-symbol">Found:</span> D:\<span class="hljs-number">01</span>_LQ\<span class="hljs-keyword">DiaryLearn\2024å¹´Flag.mp4</span><br><span class="hljs-keyword"></span><span class="hljs-symbol">Found:</span> D:\<span class="hljs-number">01</span>_LQ\<span class="hljs-keyword">DiaryLearn\Java\MindMap\2024å¹´Flag.mp4</span><br><span class="hljs-keyword"></span>Cannot list files in the <span class="hljs-keyword">directory </span><span class="hljs-keyword">or </span>access is denied.<br>æ–¹æ³•è°ƒç”¨è€—æ—¶:<span class="hljs-number">8576</span>æ¯«ç§’<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ruoyi.luoqi.file;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> luoqi</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> FolderTraversalExample.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/12 16:10</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> java.io.File;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileSearcherMethodOne</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">folderName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;D:\\&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">filename</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;2024å¹´Flag.mp4&quot;</span>;<br>        findFilePath(folderName,filename);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(<span class="hljs-string">&quot;æ–¹æ³•è°ƒç”¨è€—æ—¶:&quot;</span> + (end - start) + <span class="hljs-string">&quot;æ¯«ç§’&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">findFilePath</span><span class="hljs-params">(String folderName,String filename)</span>&#123;<br>        <span class="hljs-comment">// æ­¥éª¤1ï¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡æ¥è¡¨ç¤ºè¦éå†çš„æ–‡ä»¶å¤¹</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">folder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(folderName);<br><br>        <span class="hljs-comment">// æ­¥éª¤2ï¼šæ£€æŸ¥æ–‡ä»¶å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹</span><br>        <span class="hljs-keyword">if</span> (folder.exists() &amp;&amp; folder.isDirectory()) &#123;<br>            <span class="hljs-comment">// æ­¥éª¤3ï¼šè·å–æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­æ–‡ä»¶å¤¹</span><br>            File[] files = folder.listFiles();<br><br>            <span class="hljs-comment">// æ­¥éª¤4ï¼šéå†æ‰€æœ‰æ–‡ä»¶å’Œå­æ–‡ä»¶å¤¹</span><br>            <span class="hljs-keyword">for</span> (File file : files) &#123;<br>                <span class="hljs-keyword">if</span> (file.isDirectory()) &#123;<br>                    <span class="hljs-comment">// æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé€’å½’éå†</span><br>                    traverseFolder(file,filename);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">// æ˜¯ä¸€ä¸ªæ–‡ä»¶</span><br>                    <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> file.getName();<br>                    <span class="hljs-comment">// å¯¹æ–‡ä»¶åç§°è¿›è¡Œå¤„ç†</span><br>                    <span class="hljs-keyword">if</span>(fileName.equals(filename))&#123;<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> file.getPath();<br>                        System.out.println(<span class="hljs-string">&quot;Found: &quot;</span> + path);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// æ–‡ä»¶å¤¹ä¸å­˜åœ¨æˆ–è€…ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">traverseFolder</span><span class="hljs-params">(File folder,String filename)</span> &#123;<br>        <span class="hljs-keyword">if</span> (folder == <span class="hljs-literal">null</span> || !folder.exists() || !folder.isDirectory()) &#123;<br>            System.out.println(<span class="hljs-string">&quot;Provided file is not a directory or does not exist.&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        File[] files = folder.listFiles();<br>        <span class="hljs-keyword">if</span> (files == <span class="hljs-literal">null</span>) &#123;  <span class="hljs-comment">// æ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸º null</span><br>            System.out.println(<span class="hljs-string">&quot;Cannot list files in the directory or access is denied.&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (File file : files) &#123;<br>            <span class="hljs-keyword">if</span> (file.isDirectory()) &#123;<br>                <span class="hljs-comment">// æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé€’å½’éå†</span><br>                traverseFolder(file,filename);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// æ˜¯ä¸€ä¸ªæ–‡ä»¶</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> file.getName();<br>                <span class="hljs-comment">// å¯¹æ–‡ä»¶åç§°è¿›è¡Œå¤„ç†</span><br>                <span class="hljs-keyword">if</span>(fileName.equals(filename))&#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> file.getPath();<br>                    System.out.println(<span class="hljs-string">&quot;Found: &quot;</span> + path);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>è¿›è¡Œäº†ä¸€ä¸ªæ‰«ææ–‡ä»¶æ“ä½œï¼Œç„¶åæ”¾å…¥åˆ° Node æ ‘èŠ‚ç‚¹ä¸­</p></blockquote><p>FileNode</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs typescript">package com.<span class="hljs-property">ruoyi</span>.<span class="hljs-property">luoqi</span>.<span class="hljs-property">file</span>;<br><br><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">ArrayList</span>;<br><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">HashMap</span>;<br><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">List</span>;<br><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> <span class="hljs-variable">luoqi</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> FileNode.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/12 14:44</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileNode</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> path;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> fileName;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">FileNode</span>&gt; children;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">FileNode</span>&gt;&gt; fileMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  <span class="hljs-comment">// ç”¨äºå­˜å‚¨æ–‡ä»¶åå’ŒèŠ‚ç‚¹çš„æ˜ å°„</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">FileNode</span>(<span class="hljs-title class_">String</span> path, <span class="hljs-title class_">String</span> fileName) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">path</span> = path;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileName</span> = fileName;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">children</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-title function_">addToFileMap</span>(fileName, <span class="hljs-variable language_">this</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addChild</span>(<span class="hljs-params">FileNode child</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">children</span>.<span class="hljs-title function_">add</span>(child);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getPath</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> path;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getFileName</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> fileName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">FileNode</span>&gt; <span class="hljs-title function_">getChildren</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> children;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">FileNode</span>&gt;&gt; <span class="hljs-title function_">getFileMap</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-keyword">return</span> fileMap;&#125;<br><br>    <span class="hljs-comment">// æ·»åŠ èŠ‚ç‚¹åˆ°fileMapä¸­</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addToFileMap</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> fileName, FileNode node</span>) &#123;<br>        fileMap.<span class="hljs-title function_">computeIfAbsent</span>(fileName, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;()).<span class="hljs-title function_">add</span>(node);<br>    &#125;<br><br>    <span class="hljs-comment">// é€šè¿‡æ–‡ä»¶åè·å–FileNodeåˆ—è¡¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">FileNode</span>&gt; <span class="hljs-title function_">getNodesByFileName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> fileName</span>) &#123;<br>        <span class="hljs-keyword">return</span> fileMap.<span class="hljs-title function_">getOrDefault</span>(fileName, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>FileSearcherMethodTwo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ruoyi.luoqi.file;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.nio.file.Path;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> luoqi</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> FileSearcherMethodTwo.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/12 17:50</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileSearcherMethodTwo</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> FileNode fileNode;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-comment">//String folderName = &quot;D:\\01_LQ\\DiaryLearn\\Java&quot;;</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">folderName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;D:\\&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">filename</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;2024å¹´Flag.mp4&quot;</span>;<br>        scanFilePath(folderName,filename);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(<span class="hljs-string">&quot;æ–¹æ³•è°ƒç”¨è€—æ—¶:&quot;</span> + (end - start) + <span class="hljs-string">&quot;æ¯«ç§’&quot;</span>);<br><br>        <span class="hljs-type">long</span> <span class="hljs-variable">start2</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-comment">//List&lt;FileNode&gt; fileNodes = fileNode.getFileMap().get(filename);</span><br>        List&lt;FileNode&gt; nodes = fileNode.getNodesByFileName(filename);<br>        <span class="hljs-keyword">if</span> (nodes.isEmpty()) &#123;<br>            System.out.println(<span class="hljs-string">&quot;No files found with the name &quot;</span> + filename);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;Found files:&quot;</span>);<br>            <span class="hljs-keyword">for</span> (FileNode node : nodes) &#123;<br>                System.out.println(node.getPath());<br>            &#125;<br>        &#125;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">end2</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(<span class="hljs-string">&quot;æ–¹æ³•2è°ƒç”¨è€—æ—¶:&quot;</span> + (end2 - start2) + <span class="hljs-string">&quot;æ¯«ç§’&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scanFilePath</span><span class="hljs-params">(String folderName,String filename)</span>&#123;<br>        <span class="hljs-comment">// æ­¥éª¤1ï¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¯¹è±¡æ¥è¡¨ç¤ºè¦éå†çš„æ–‡ä»¶å¤¹</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">folder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(folderName);<br>        <span class="hljs-comment">//å½“çš„ç¡®éœ€è¦å°†æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åä¿¡æ¯æ”¾å…¥åˆ°æ•´ä½“çš„ä¸€ä¸ª HashMap ä¸­</span><br>        <span class="hljs-comment">//ä¸€æ–¹é¢æ˜¯è¿›è¡Œéå†çš„æ—¶å€™ï¼Œä¸€æ–¹é¢æ˜¯ç”Ÿæˆæ–°çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¸€æ–¹é¢æ˜¯è¿›è¡Œå…³è”ä¸Šå±‚èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»è€Œå½¢æˆæ ‘ç»“æ„</span><br>        <span class="hljs-comment">//æ ¹èŠ‚ç‚¹</span><br>        fileNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileNode</span>(folderName, <span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-comment">// æ­¥éª¤2ï¼šæ£€æŸ¥æ–‡ä»¶å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹</span><br>        <span class="hljs-keyword">if</span> (folder.exists() &amp;&amp; folder.isDirectory()) &#123;<br>            <span class="hljs-comment">// æ­¥éª¤3ï¼šè·å–æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œå­æ–‡ä»¶å¤¹</span><br>            File[] files = folder.listFiles();<br><br>            <span class="hljs-comment">// æ­¥éª¤4ï¼šéå†æ‰€æœ‰æ–‡ä»¶å’Œå­æ–‡ä»¶å¤¹</span><br>            <span class="hljs-keyword">for</span> (File file : files) &#123;<br>                <span class="hljs-keyword">if</span> (file.isDirectory()) &#123;<br>                    <span class="hljs-comment">//å¦‚æœæ˜¯ç›®å½•çš„è¯ï¼Œæ­£å¸¸åº”è¯¥ Node å¯¹è±¡ä¸‹ children ä¸ä¸ºç©ºï¼ŒåŒæ—¶ filename æ˜¯ç©ºçš„</span><br>                    <span class="hljs-type">FileNode</span> <span class="hljs-variable">dirNode</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileNode</span>(file.getPath(), <span class="hljs-string">&quot;&quot;</span>);<br>                    fileNode.addChild(dirNode);<br>                    <span class="hljs-comment">// æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé€’å½’éå†</span><br>                    traverseFolder(file,filename,dirNode);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">// æ˜¯ä¸€ä¸ªæ–‡ä»¶</span><br>                    <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> file.getName();<br>                    <span class="hljs-comment">// å¯¹æ–‡ä»¶åç§°è¿›è¡Œå¤„ç†</span><br>                    <span class="hljs-keyword">if</span>(fileName.equals(filename))&#123;<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> file.getPath();<br>                        <span class="hljs-comment">//System.out.println(&quot;Found: &quot; + path);</span><br>                        <span class="hljs-type">FileNode</span> <span class="hljs-variable">fileNodeSon</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileNode</span>(path, filename);<br>                        fileNode.addChild(fileNodeSon);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// æ–‡ä»¶å¤¹ä¸å­˜åœ¨æˆ–è€…ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">traverseFolder</span><span class="hljs-params">(File folder,String filename,FileNode fileNode)</span> &#123;<br>        <span class="hljs-keyword">if</span> (folder == <span class="hljs-literal">null</span> || !folder.exists() || !folder.isDirectory()) &#123;<br>            System.out.println(<span class="hljs-string">&quot;Provided file is not a directory or does not exist.&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        File[] files = folder.listFiles();<br>        <span class="hljs-keyword">if</span> (files == <span class="hljs-literal">null</span>) &#123;  <span class="hljs-comment">// æ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸º null</span><br>            System.out.println(<span class="hljs-string">&quot;Cannot list files in the directory or access is denied.&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (File file : files) &#123;<br>            <span class="hljs-keyword">if</span> (file.isDirectory()) &#123;<br>                <span class="hljs-type">FileNode</span> <span class="hljs-variable">dirNode</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileNode</span>(file.getPath(), <span class="hljs-string">&quot;&quot;</span>);<br>                fileNode.addChild(dirNode);<br>                <span class="hljs-comment">// æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé€’å½’éå†</span><br>                traverseFolder(file,filename,dirNode);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// æ˜¯ä¸€ä¸ªæ–‡ä»¶</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> file.getName();<br>                <span class="hljs-comment">// å¯¹æ–‡ä»¶åç§°è¿›è¡Œå¤„ç†</span><br>                <span class="hljs-keyword">if</span>(fileName.equals(filename))&#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> file.getPath();<br>                    <span class="hljs-comment">//System.out.println(&quot;Found: &quot; + path);</span><br>                    <span class="hljs-type">FileNode</span> <span class="hljs-variable">fileNodeSon</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileNode</span>(path, filename);<br>                    fileNode.addChild(fileNodeSon);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Cannot list <span class="hljs-built_in">files</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">directory</span> <span class="hljs-keyword">or</span> access is denied.<br>æ–¹æ³•è°ƒç”¨è€—æ—¶:<span class="hljs-number">7785</span>æ¯«ç§’<br>Found <span class="hljs-built_in">files</span>:<br>D:\<span class="hljs-number">01</span>_LQ\DiaryLearn\<span class="hljs-number">2024</span>å¹´Flag.mp4<br>D:\<span class="hljs-number">01</span>_LQ\DiaryLearn\Java\MindMap\<span class="hljs-number">2024</span>å¹´Flag.mp4<br>æ–¹æ³•<span class="hljs-number">2</span>è°ƒç”¨è€—æ—¶:<span class="hljs-number">0</span>æ¯«ç§’<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€äº›æ›´é«˜çº§çš„å†…å®¹ï¼Œæ¯”å¦‚ NIOã€å¹¶è¡Œæµä¹‹ç±»çš„ï¼›è¿™ä¸ªå®é™…æ”¾åé¢çœ‹äº†ï¼ˆæŒæ¡ç¨‹åº¦å¤ªæµ…ï¼Œå®é™…è·‘çš„éšæ‚£å¤ªå¤§ï¼‰</p><hr>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>Base</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_æ€§èƒ½ä¼˜åŒ–</title>
    <link href="/2024/04/03/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    <url>/2024/04/03/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒï¼š <a href="https://wx.zsxq.com/dweb2/index/topic_detail/212244125425151">https://wx.zsxq.com/dweb2/index/topic_detail/212244125425151</a></p><p>4ä¸ªå¸¸è§çš„æ€§èƒ½ä¼˜åŒ–æ–¹å‘ï¼š å¤šçº¿ç¨‹ã€JVMã€æ•°æ®åº“&#x2F;ç¼“å­˜ã€æ•°æ®ç»“æ„ä¼˜åŒ–</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240324215139.png" alt="image.png"></p><h3 id="ä¸šåŠ¡ä¼˜åŒ–ï¼š"><a href="#ä¸šåŠ¡ä¼˜åŒ–ï¼š" class="headerlink" title="ä¸šåŠ¡ä¼˜åŒ–ï¼š"></a>ä¸šåŠ¡ä¼˜åŒ–ï¼š</h3><p>Excel å¯¼å…¥ä¼˜åŒ–ï¼š[[Excel å¤§æ‰¹é‡å¯¼å…¥å¯¼å‡ºæ“ä½œä¼˜åŒ–]]</p><h3 id="1ã€å¤šçº¿ç¨‹"><a href="#1ã€å¤šçº¿ç¨‹" class="headerlink" title="1ã€å¤šçº¿ç¨‹"></a>1ã€å¤šçº¿ç¨‹</h3><h4 id="å¼‚æ­¥æ–¹å¼"><a href="#å¼‚æ­¥æ–¹å¼" class="headerlink" title="å¼‚æ­¥æ–¹å¼"></a>å¼‚æ­¥æ–¹å¼</h4><p>åœ¨ SpringBoot ä¸­ä½¿ç”¨å¼‚æ­¥æ–¹æ³•ä¼˜åŒ– Service é€»è¾‘æé«˜æ¥å£å“åº”é€Ÿåº¦?</p><p>å‚è€ƒï¼š <a href="https://blog.csdn.net/weixin_43441509/article/details/119855613">https://blog.csdn.net/weixin_43441509/article/details/119855613</a></p><p>å‚è€ƒçš„è¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä½¿ç”¨SpringBootæä¾›çš„å¼‚æ­¥æ–¹æ³•æ”¯æŒæ³¨è§£çš„ä½¿ç”¨ï¼›åŒæ—¶ä»‹ç»äº†è‡ªå®šä¹‰çº¿ç¨‹æ± å’Œè·å–è¿”å›å€¼ä»¥åŠæ•è·å¼‚å¸¸æ“ä½œå¦‚ä½•è¿›è¡Œã€‚</p><p>æ€è€ƒï¼šå…³äºå¼‚æ­¥æ“ä½œï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ï¼ŒåŒ…æ‹¬ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰å’Œåˆ©ç”¨å¤šçº¿ç¨‹ï¼ˆå¦‚SpringBootä¸­çš„ <code>@Async</code> æ³¨è§£ï¼‰ï¼Œåœ¨æŠ€æœ¯é€‰å‹çš„æ—¶å€™åº”è¯¥å¦‚ä½•è€ƒè™‘ã€‚</p><p>é—®ç­”ï¼šä¸¤è€…åœ¨è®¾è®¡ç†å¿µã€ä½¿ç”¨åœºæ™¯å’Œç‰¹æ€§ä¸Šæœ‰æ‰€ä¸åŒï¼›å¦‚æœæ˜¯æ¶‰åŠå¤šä¸ªæœåŠ¡é—´çš„é€šä¿¡ï¼Œå»ºè®®ä½¿ç”¨MQï¼Œè€Œåœ¨å•ä¸ªåº”ç”¨å†…éƒ¨éœ€è¦å¼‚æ­¥å¤„ç†ï¼Œä½¿ç”¨<code>@Async</code>å¯èƒ½æ›´ç®€å•æ–¹ä¾¿ï¼›åŒæ—¶MQåœ¨å¯é æ€§ã€è§£è€¦ã€å¼‚æ­¥é€šä¿¡ç­‰æ–¹é¢æ›´æœ‰ä¼˜åŠ¿ã€‚</p><p>å»ºè®®å­¦ä¹ é¡¹ç›®ï¼š <a href="https://gitee.com/jd-platform-opensource/asyncTool">https://gitee.com/jd-platform-opensource/asyncTool</a></p><p>ï¼ˆäº¬ä¸œé›¶å”®å¼€æºçš„ä¸€ä¸ªå¹¶è¡Œæ¡†æ¶ï¼Œé‡Œé¢å¤§é‡ä½¿ç”¨åˆ°äº† CompletableFuture ï¼Œå¯ä»¥å­¦ä¹ å…¶ç²¾åæ¥è¿ç”¨åœ¨è‡ªå·±çš„é¡¹ç›®ä¸Šï¼‰</p><hr><p>20240324 </p><p>å…³äºæ–‡ç«  <a href="https://blog.csdn.net/weixin_43441509/article/details/119855613">https://blog.csdn.net/weixin_43441509/article/details/119855613</a> ä¸­æœ‰è®²è¿°åˆ°æ¥å£ä¼˜åŒ–å…¶å“åº”é€Ÿåº¦çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼å»è¿›è¡Œè°ƒç”¨ä¸€äº›æ–¹æ³•ï¼›åŒæ—¶ä¸€äº›ç”¨æ³•éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå¼‚æ­¥æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ç§ä»£ç†ï¼Œå› æ­¤åªèƒ½åœ¨ Controller å±‚é¢ä¸Šè°ƒç”¨ service æ–¹æ³•æ‰æœ‰æ•ˆï¼›</p><p>åŒæ—¶ä¸€èˆ¬æ¥è¯´ï¼ŒSpringBootä¸ºæˆ‘ä»¬é»˜è®¤æä¾›äº†çº¿ç¨‹æ± (SimpleAsyncTaskExecutor)æ¥æ‰§è¡Œæˆ‘ä»¬çš„å¼‚æ­¥æ–¹æ³•, æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä¸€èˆ¬ä¼šè‡ªå®šä¹‰è‡ªå·±çš„çº¿ç¨‹æ± ã€‚</p><p>åœ¨æ³¨è§£ <code>@Async(&quot;customExecutor&quot;)</code>  ä¸Šå¯ä»¥æŒ‡å®šæˆ‘ä»¬æ³¨å…¥çš„ Bean çº¿ç¨‹æ± ï¼›</p><p>åŒæ—¶å¦‚æœéœ€è¦è¿”å›ç»“æœï¼Œå¯ä»¥ä½¿ç”¨ Future ç±»åŠå…¶å­ç±»å»æ‰¿æ¥è¿”å›ç»“æœï¼›</p><p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¼ºä¸€è‡´æ€§ä¸šåŠ¡ä¸é€‚ç”¨å¼‚æ­¥æ–¹æ³•ï¼Œä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶å¯èƒ½ä¼šæ›´é€‚åˆ</p><h4 id="CompletableFuture-åŸç†ä¸å®è·µ"><a href="#CompletableFuture-åŸç†ä¸å®è·µ" class="headerlink" title="CompletableFuture åŸç†ä¸å®è·µ"></a>CompletableFuture åŸç†ä¸å®è·µ</h4><p>å‚è€ƒï¼š <a href="https://juejin.cn/post/7168261825165787149#heading-7">https://juejin.cn/post/7168261825165787149#heading-7</a></p><p>å»ºè®®å…ˆçœ‹è¿™ç¯‡æ–‡ç« ï¼Œä»‹ç»äº†ä¸€ä¸‹å¼‚æ­¥ä»»åŠ¡ç¼–æ’ CompletableFuture æ“ä½œ </p><p>é‡Œé¢é€šè¿‡ä»£ç è®²è¿°äº† åŒæ­¥ä¸²è¡Œã€å¼‚æ­¥ä¸²è¡Œã€å¹¶è¡Œä»»åŠ¡ã€å¤šä»»åŠ¡ç»“æœåˆå¹¶è®¡ç®—ä»¥åŠå…¶ä»–çš„ä½¿ç”¨ç¤ºä¾‹ã€‚</p><p>å‚è€ƒï¼š <a href="https://zhuanlan.zhihu.com/p/515993095">https://zhuanlan.zhihu.com/p/515993095</a></p><p>è¯¥ç¯‡æ–‡ç« å†…å®¹ä»‹ç»äº†å¹¶è¡Œä»ä¸‹æ¸¸è·å–æ•°æ®çš„ä¸šåŠ¡åœºæ™¯ï¼ˆIOå¯†é›†å‹ï¼‰ï¼Œé€šè¿‡ä¸åŒæ–¹å¼çš„ä½¿ç”¨å»ä¼˜åŒ–æ€§èƒ½ã€‚</p><p>ä¼˜åŒ–æ–¹å¼ä¸€èˆ¬æ˜¯é€šè¿‡åŒæ­¥æ¨¡å‹å’Œå¼‚æ­¥æ¨¡å‹ï¼›</p><p>å½“é‡‡ç”¨åŒæ­¥æ¨¡å‹çš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼æœ‰æ—¶å€™ä¼šæ•ˆç‡æ¯”è¾ƒä½ä¸‹ï¼Œé€ æˆçš„åŸå› ä¸€èˆ¬æœ‰ï¼šCPUèµ„æºæµªè´¹åœ¨é˜»å¡ç­‰å¾…ä¸Šã€å›è°ƒåœ°ç‹±ã€çº¿ç¨‹ç®¡ç†å¼€é”€ç­‰ã€‚</p><p>å…¶ä¸­å› ä¸ºç¬¬ä¸€ç‚¹ï¼šCPUèµ„æºæµªè´¹åœ¨é˜»å¡ç­‰å¾…ï¼Œåœ¨Java8 ä¹‹å‰ä¸€èˆ¬ä¼šé€šè¿‡å›è°ƒçš„æ–¹å¼æ¥å‡å°‘é˜»å¡ï¼Œä½†æ˜¯å¤§é‡ä½¿ç”¨å›è°ƒï¼Œåˆå¼•å‘è‡­åæ˜­è‘—çš„<strong>å›è°ƒåœ°ç‹±</strong>é—®é¢˜ï¼Œå¯¼è‡´ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§å¤§å¤§é™ä½ã€‚</p><p>è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ NIO å¹¶è¡Œæ¨¡å‹ä»ä¸‹æ¸¸è·å–æ•°æ®ï¼Œè§£å†³æ–¹å¼ä¸€èˆ¬æœ‰ä¸¤ç§ï¼š</p><ul><li>é€šè¿‡RPC NIOå¼‚æ­¥è°ƒç”¨çš„æ–¹å¼å¯ä»¥é™ä½çº¿ç¨‹æ•°ï¼Œä»è€Œé™ä½è°ƒåº¦ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰å¼€é”€</li><li>é€šè¿‡å¼•å…¥CompletableFuture å¯¹ä¸šåŠ¡æµç¨‹è¿›è¡Œç¼–æ’ï¼Œé™ä½ä¾èµ–ä¹‹é—´çš„é˜»å¡ã€‚</li></ul><p>å…³äº CompletableFuture çš„ä½¿ç”¨ï¼š</p><p>æ ¹æ®CompletableFutureä¾èµ–æ•°é‡ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼šé›¶ä¾èµ–ã€ä¸€å…ƒä¾èµ–ã€äºŒå…ƒä¾èµ–å’Œå¤šå…ƒä¾èµ–ã€‚</p><p>(ç­‰å¾… N ä¸ª å…¶ä»–ä»»åŠ¡å®Œæˆï¼Œå¯åŠ¨å¼‚æ­¥ä»»åŠ¡)</p><p>åŸç†ä¸è®¾è®¡æ€æƒ³ï¼što be continedâ€¦</p><p>é™„å½•ï¼šç•¥ã€‚</p><h3 id="é«˜å¹¶å‘"><a href="#é«˜å¹¶å‘" class="headerlink" title="é«˜å¹¶å‘"></a>é«˜å¹¶å‘</h3><p>å…³äºåœ¨é«˜å¹¶å‘æ¶æ„åœºæ™¯ä¸‹ï¼Œå¸¸ç”¨çš„ç¼“å­˜ã€é™æµå’Œé™çº§ä½¿ç”¨ï¼Œå‚è€ƒï¼š <a href="https://mp.weixin.qq.com/s/6hd3ckX-JwPTTZ0bgk1K4A">https://mp.weixin.qq.com/s/6hd3ckX-JwPTTZ0bgk1K4A</a></p>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>websocketçš„åŸºç¡€ä½¿ç”¨</title>
    <link href="/2024/03/31/websocket%E7%9A%84%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/03/31/websocket%E7%9A%84%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>åœ¨Webåº”ç”¨ä¸­ï¼ŒWebSocketæä¾›äº†åœ¨å•ä¸ªé•¿æ—¶é—´è¿æ¥ä¸Šè¿›è¡Œ<strong>å…¨åŒå·¥ã€åŒå‘é€šè®¯</strong>çš„èƒ½åŠ›(åŸºäºHTTPåè®®)ã€‚</p><p>å®ƒå…è®¸æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€ä¿¡æ¯ï¼Œé€‚åˆéœ€è¦å®æ—¶åŠŸèƒ½çš„åº”ç”¨ï¼Œå¦‚åœ¨çº¿èŠå¤©ã€å®æ—¶é€šçŸ¥ã€æ¸¸æˆç­‰ã€‚</p><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><p>æ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç›¸å…³é…ç½®</p><p>åˆ›å»ºä¸€ä¸ªWebSocketé…ç½®ç±»ï¼Œä½¿ç”¨<code>@EnableWebSocket</code>æ³¨è§£æ¥å¯ç”¨WebSocketï¼Œå¹¶æ³¨å†Œä¸€ä¸ªWebSocketç«¯ç‚¹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Configuration</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">config</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">EnableWebSocket</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">config</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">WebSocketConfigurer</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">socket</span>.<span class="hljs-property">config</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">WebSocketHandlerRegistry</span>;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableWebSocket</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketConfigurer</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">registerWebSocketHandlers</span>(<span class="hljs-params">WebSocketHandlerRegistry registry</span>) &#123;<br>        registry.<span class="hljs-title function_">addHandler</span>(<span class="hljs-title function_">myHandler</span>(), <span class="hljs-string">&quot;/myWebSocket&quot;</span>).<span class="hljs-title function_">withSockJS</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">WebSocketHandler</span> <span class="hljs-title function_">myHandler</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWebSocketHandler</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‰ç«¯æ“ä½œï¼Œvue é¡¹ç›®ï¼ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯è‹¥ ä¾ çš„æ¡†æ¶ï¼‰</p><p>å…ˆå®‰è£…ä¸€ä¸‹ä¾èµ–</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">npm install sockjs-<span class="hljs-keyword">client</span> webstomp-<span class="hljs-keyword">client</span> --registry=https:<span class="hljs-comment">//registry.npmmirror.com</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç»„ä»¶</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;messageToSend&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;è¾“å…¥æ¶ˆæ¯&quot;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sendMessage&quot;</span>&gt;</span>å‘é€æ¶ˆæ¯<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(msg, index) in messagesReceived&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span></span><br><span class="language-xml">      </span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">msg</span> &#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> <span class="hljs-title class_">SockJS</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;sockjs-client&#x27;</span>;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Stomp</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;webstomp-client&#x27;</span>;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-keyword">return</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-attr">stompClient</span>: <span class="hljs-literal">null</span>,</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-attr">messageToSend</span>: <span class="hljs-string">&#x27;&#x27;</span>,</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-attr">messagesReceived</span>: [],</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;;</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">connect</span>();</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">  <span class="hljs-attr">methods</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-title function_">connect</span>(<span class="hljs-params"></span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">const</span> socket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SockJS</span>(<span class="hljs-string">&#x27;/myWebSocket&#x27;</span>);</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stompClient</span> = <span class="hljs-title class_">Stomp</span>.<span class="hljs-title function_">over</span>(socket);</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">stompClient</span>.<span class="hljs-title function_">connect</span>(&#123;&#125;, <span class="hljs-function"><span class="hljs-params">frame</span> =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Connected: &#x27;</span> + frame);</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stompClient</span>.<span class="hljs-title function_">subscribe</span>(<span class="hljs-string">&#x27;/topic/messages&#x27;</span>, <span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span> &#123;</span></span><br><span class="language-javascript"><span class="language-xml">          <span class="hljs-variable language_">this</span>.<span class="hljs-property">messagesReceived</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(message.<span class="hljs-property">body</span>).<span class="hljs-property">content</span>);</span></span><br><span class="language-javascript"><span class="language-xml">        &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">      &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;,</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params"></span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">stompClient</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageToSend</span>) &#123;</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-keyword">const</span> message = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123; <span class="hljs-attr">content</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageToSend</span> &#125;);</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">stompClient</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;/app/message&#x27;</span>, &#123;&#125;, message);</span></span><br><span class="language-javascript"><span class="language-xml">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageToSend</span> = <span class="hljs-string">&#x27;&#x27;</span>; <span class="hljs-comment">// æ¸…ç©ºè¾“å…¥æ¡†</span></span></span><br><span class="language-javascript"><span class="language-xml">      &#125;</span></span><br><span class="language-javascript"><span class="language-xml">    &#125;</span></span><br><span class="language-javascript"><span class="language-xml">  &#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;;</span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç»„ä»¶ä¸­ï¼š</p><ul><li>ä½¿ç”¨<code>v-model</code>ç»‘å®šä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†çš„å€¼åˆ°<code>messageToSend</code>ã€‚</li><li>ç‚¹å‡»å‘é€æŒ‰é’®æ—¶ï¼Œè°ƒç”¨<code>sendMessage</code>æ–¹æ³•ã€‚</li><li>åœ¨<code>mounted</code>é’©å­ä¸­ï¼Œç»„ä»¶æŒ‚è½½åç«‹å³è°ƒç”¨<code>connect</code>æ–¹æ³•æ¥è¿æ¥WebSocketæœåŠ¡å™¨ã€‚</li><li><code>connect</code>æ–¹æ³•ä½¿ç”¨<code>SockJS</code>å’Œ<code>Stomp</code>åº“å»ºç«‹è¿æ¥ï¼Œå¹¶è®¢é˜…æœåŠ¡å™¨ä¸Šçš„æ¶ˆæ¯ã€‚æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¢«æ·»åŠ åˆ°<code>messagesReceived</code>æ•°ç»„ä¸­ï¼Œå¹¶åœ¨æ¨¡æ¿ä¸­éå†æ˜¾ç¤ºã€‚</li><li><code>sendMessage</code>æ–¹æ³•é€šè¿‡WebSocketå‘é€ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯åˆ°æœåŠ¡å™¨ã€‚</li></ul><p>ç¡®ä¿æœåŠ¡å™¨ç«¯WebSocketé…ç½®æ­£ç¡®ï¼Œä¸”<code>/myWebSocket</code>ç«¯ç‚¹ä»¥åŠ<code>/app/message</code>å’Œ<code>/topic/messages</code>ç›®çš„åœ°å¯ç”¨ã€‚è¿™ä¸ªç¤ºä¾‹å‡è®¾æœåŠ¡å™¨ç«¯èƒ½å¤Ÿæ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶èƒ½å°†æ¶ˆæ¯å¹¿æ’­åˆ°<code>/topic/messages</code>ç›®çš„åœ°</p><p><code>mounted</code>æ˜¯Vueç»„ä»¶çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå®ƒåœ¨ç»„ä»¶çš„æ¨¡æ¿å’ŒDOMå·²ç»æ¸²æŸ“å®Œæ¯•å¹¶æŒ‚è½½åˆ°é¡µé¢ä¸Šä¹‹åè¢«è°ƒç”¨ã€‚è¿™ä¸ªæ—¶åˆ»ï¼Œç»„ä»¶å·²ç»å‡ºç°åœ¨é¡µé¢ä¸Šï¼Œä»»ä½•å¯¹DOMçš„æ“ä½œéƒ½å¯ä»¥åœ¨è¿™ä¸ªé’©å­ä¸­æ‰§è¡Œã€‚</p><p>åœ¨è¿™ä¸ªWebSocketç¤ºä¾‹ä¸­ï¼Œ<code>mounted</code>é’©å­ç”¨æ¥åœ¨ç»„ä»¶æŒ‚è½½å®Œæˆåç«‹å³å»ºç«‹WebSocketè¿æ¥ï¼Œè¿™æ ·åšç¡®ä¿äº†ä¸€æ—¦ç»„ä»¶å‡†å¤‡å¥½ï¼Œå°±å¯ä»¥å¼€å§‹æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚</p><ul><li>**<code>/myWebSocket</code>**ï¼šæ˜¯WebSocketè¿æ¥çš„ç«¯ç‚¹ï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿™ä¸ªURLä¸æœåŠ¡å™¨å»ºç«‹WebSocketè¿æ¥ã€‚</li><li>**<code>/topic/messages</code>**ï¼šæ˜¯æœåŠ¡å™¨ä¸Šä¸€ä¸ªæ¶ˆæ¯ä¸»é¢˜ï¼Œå®¢æˆ·ç«¯é€šè¿‡è®¢é˜…è¿™ä¸ªä¸»é¢˜æ¥æ¥æ”¶æœåŠ¡å™¨å¹¿æ’­çš„æ¶ˆæ¯</li></ul><p>å»ºè®®å•ç‹¬æä¸€ä¸ªå‰ç«¯ç•Œé¢ä½œä¸ºæ¼”ç¤ºï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ä¸ªï¼Œå¦‚æœæ˜¯åšèŠå¤©å®¤ä¹‹ç±»çš„ï¼Œå¯ä»¥ç”¨è¿™ç§æ–¹å¼ï¼š</p><ul><li><a href="https://blog.csdn.net/BADAO_LIUMANG_QIZHI/article/details/114392573">https://blog.csdn.net/BADAO_LIUMANG_QIZHI/article/details/114392573</a></li><li><a href="https://gitee.com/huangzhejiang/springboot-vue-demo">https://gitee.com/huangzhejiang/springboot-vue-demo</a></li></ul><p>åé¢æµ‹è¯•è°ƒæ•´äº†ä¸€ä¸‹ï¼š</p><p>é¦–å…ˆæ˜¯å‰ç«¯ç»„ä»¶å¼•ç”¨ï¼š</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span>Â <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;websocket&quot;</span>Â <span class="hljs-attr">prop</span>=<span class="hljs-string">&quot;websocket&quot;</span>&gt;</span></span><br><span class="language-xml">Â Â </span><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">web-socket-component</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">web-socket-component</span>&gt;</span></span><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></span><br><br><span class="hljs-keyword">import</span> WebSocketComponent from <span class="hljs-string">&#x27;@/components/Luoqi/websocket/index.vue&#x27;</span>;<br><br>components: &#123; <br>  Treeselect, <br>  WebSocketComponent<br>&#125;,<br></code></pre></td></tr></table></figure><p>è¿æ¥åœ°å€æ”¹äº†ä¸€ä¸‹</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">const</span>Â socketÂ =Â <span class="hljs-keyword">new</span>Â SockJS(<span class="hljs-string">&#x27;http://localhost:8080/myWebSocket&#x27;</span>);<br></code></pre></td></tr></table></figure><p>åç«¯çš„ä¸€äº›è·¨åŸŸå’Œè®¿é—®æƒé™æ”¾è¡Œçš„é…ç½®éœ€è¦æ”¹ä¸€ä¸‹</p><p>SecurityConfig é…ç½®ç±»ä¸‹ çš„ configure æ–¹æ³•</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#è¿™é‡Œæ”¹åŒ¿åè®¿é—®ä¹Ÿå¯ä»¥</span><br><span class="hljs-string">.antMatchers</span><span class="hljs-params">(&quot;/myWebSocket/**&quot;)</span><span class="hljs-string">.permitAll</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure><p>WebSocketConfig é…ç½®ç±»ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸‹ setAllowedOrigins é…ç½®</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketConfigurer</span> &#123;  <br>  <br>  <br>    <span class="hljs-meta">@Override</span>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">registerWebSocketHandlers</span>(<span class="hljs-params">WebSocketHandlerRegistry registry</span>) &#123;  <br>        registry.<span class="hljs-title function_">addHandler</span>(<span class="hljs-title function_">myHandler</span>(), <span class="hljs-string">&quot;/myWebSocket&quot;</span>)  <br>                .<span class="hljs-title function_">setAllowedOrigins</span>(<span class="hljs-string">&quot;http://localhost&quot;</span>)  <br>                .<span class="hljs-title function_">withSockJS</span>();  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">WebSocketHandler</span> <span class="hljs-title function_">myHandler</span>(<span class="hljs-params"></span>) &#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWebSocketHandler</span>();  <br>    &#125;  <br>  <br>  <br>    <span class="hljs-comment">//å¼€å¯ WebSocketçš„æ”¯æŒ  </span><br>    <span class="hljs-meta">@Bean</span>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ServerEndpointExporter</span> <span class="hljs-title function_">serverEndpointExporter</span>(<span class="hljs-params"></span>)&#123;  <br>        <span class="hljs-keyword">return</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerEndpointExporter</span>();  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ—¶åœ¨è‹¥ä¾åˆ†ç¦»å¼é¡¹ç›®ä¸­ï¼Œå°½é‡éƒ½ clean å† install ä¸€ä¸‹</p><h3 id="èŠå¤©å®¤"><a href="#èŠå¤©å®¤" class="headerlink" title="èŠå¤©å®¤"></a>èŠå¤©å®¤</h3><p>è¿™ä¸ªæ˜¯æ¯”è¾ƒå¸¸è§çš„åŠŸèƒ½ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹å®ç°ã€‚</p><h3 id="åŸºç¡€ç”¨æ³•"><a href="#åŸºç¡€ç”¨æ³•" class="headerlink" title="åŸºç¡€ç”¨æ³•"></a>åŸºç¡€ç”¨æ³•</h3><p>çœ‹ä¸€ä¸‹è¿™ä¸ªï¼š <a href="https://mp.weixin.qq.com/s/0SI9C3tBPqyIeMtkfTZk8g">https://mp.weixin.qq.com/s/0SI9C3tBPqyIeMtkfTZk8g</a></p><h3 id="Netty-WebSocket"><a href="#Netty-WebSocket" class="headerlink" title="Netty + WebSocket"></a>Netty + WebSocket</h3><p>å‚è€ƒï¼š <a href="https://github.com/niezhiliang/netty-websocket-spring-boot">https://github.com/niezhiliang/netty-websocket-spring-boot</a></p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringSecurityå­¦ä¹ ä½¿ç”¨</title>
    <link href="/2024/03/31/SpringSecurity%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/03/31/SpringSecurity%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h3><p>è¿™é‡Œä½¿ç”¨è‹¥ä¾åˆ†ç¦»ç‰ˆé¡¹ç›®ï¼š <a href="https://gitee.com/y_project/RuoYi-Vue">https://gitee.com/y_project/RuoYi-Vue</a></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#å‰ç«¯è¿è¡Œ(ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ)</span><br>npm install<br><br><span class="hljs-comment"># å¼ºçƒˆå»ºè®®ä¸è¦ç”¨ç›´æ¥ä½¿ç”¨ cnpm å®‰è£…ï¼Œä¼šæœ‰å„ç§è¯¡å¼‚çš„ bugï¼Œå¯ä»¥é€šè¿‡é‡æ–°æŒ‡å®š registry æ¥è§£å†³ npm å®‰è£…é€Ÿåº¦æ…¢çš„é—®é¢˜ã€‚</span><br>npm install <span class="hljs-attribute">--registry</span>=https://registry.npmmirror.com<br><br><span class="hljs-comment"># æœ¬åœ°å¼€å‘ å¯åŠ¨é¡¹ç›®</span><br>npm <span class="hljs-built_in">run</span> dev<br></code></pre></td></tr></table></figure><p>åç«¯é…ç½®</p><p>æ”¹ä¸€ä¸‹æ•°æ®åº“é…ç½®å’ŒæœåŠ¡å™¨é…ç½®ï¼Œ</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-comment"># å¼€å‘ç¯å¢ƒé…ç½®</span><br><span class="hljs-attribute">server</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-comment"># æœåŠ¡å™¨çš„HTTPç«¯å£ï¼Œé»˜è®¤ä¸º80</span><br>  <span class="hljs-attribute">port</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ç«¯å£</span><br>  <span class="hljs-attribute">servlet</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-comment"># åº”ç”¨çš„è®¿é—®è·¯å¾„</span><br>    <span class="hljs-attribute">context-path</span><span class="hljs-punctuation">:</span> <span class="hljs-string">/åº”ç”¨è·¯å¾„</span><br></code></pre></td></tr></table></figure><blockquote><p>å…³äº context-path çš„é…ç½®è¯´æ˜</p></blockquote><p>å¦‚æœä½ çš„æœåŠ¡å™¨ï¼ˆæˆ–è™šæ‹Ÿä¸»æœºï¼‰<strong>åªéƒ¨ç½²äº†ä¸€ä¸ªåº”ç”¨</strong>ï¼Œæˆ–è€…ä½ å¸Œæœ›åº”ç”¨ç›´æ¥å“åº”åŸŸåæ ¹è·¯å¾„ï¼ˆä¾‹å¦‚ï¼Œ<code>http://www.example.com/</code>ï¼‰ï¼Œä½ å¯ä»¥ä¸è®¾ç½®ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œå³ä½¿ç”¨é»˜è®¤çš„æ ¹è·¯å¾„<code>/</code>ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­çœç•¥<code>context-path</code>çš„è®¾ç½®ã€‚</p><p>å¦‚æœæœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†<strong>å¤šä¸ªåº”ç”¨</strong>ï¼Œæˆ–è€…å‡ºäºå…¶ä»–åŸå› ï¼ˆå¦‚APIç‰ˆæœ¬æ§åˆ¶ï¼‰éœ€è¦å°†åº”ç”¨éƒ¨ç½²åœ¨éæ ¹è·¯å¾„ä¸‹ï¼Œå°±éœ€è¦è®¾ç½®ä¸€ä¸ªå…·ä½“çš„ä¸Šä¸‹æ–‡è·¯å¾„ã€‚è¿™æ ·åšå¯ä»¥é¿å…ä¸åŒåº”ç”¨é—´çš„è·¯ç”±å†²çªï¼Œä¹Ÿä½¿å¾—URLå…·æœ‰æ›´å¥½çš„å¯è¯»æ€§å’Œç»„ç»‡æ€§ã€‚</p><hr><blockquote><p>æŠ¥é”™ï¼šé”™è¯¯: æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» com.ruoyi.RuoYiApplication</p></blockquote><p>è§£å†³ï¼šé‡æ–° clean ï¼Œå† install ä¸€ä¸‹ï¼ŒåŒæ—¶å†åŠ è½½å‰é€šè¿‡ çˆ¶ç›®å½•ä¸‹çš„ Lifecycle ä¸‹è¿›è¡Œ clean installï¼›å†é‡æ–°åŠ è½½ä¾èµ–ã€‚</p><hr><blockquote><p>åŠ å¯†æ“ä½œï¼š</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">encryptPassword</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> password</span>)  <br>&#123;  <br>    <span class="hljs-comment">// åˆ›å»ºBCryptPasswordEncoderå¯¹è±¡(ç”¨äºå¯†ç åŠ å¯†çš„ç±»)  </span><br>    <span class="hljs-title class_">BCryptPasswordEncoder</span> passwordEncoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();  <br>    <span class="hljs-keyword">return</span> passwordEncoder.<span class="hljs-title function_">encode</span>(password);  <br>&#125;<br></code></pre></td></tr></table></figure><p>åŸºäºBCryptç®—æ³•çš„å¯†ç å“ˆå¸Œæœºåˆ¶ï¼›ä»–æä¾›çš„æ˜¯ä¸€ç§å•å‘çš„å¯†ç ä¿æŠ¤æœºåˆ¶ï¼Œæ—¨åœ¨ç¡®ä¿å³ä½¿æ•°æ®åº“è¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•æ¢å¤å‡ºç”¨æˆ·çš„åŸå§‹å¯†ç ã€‚è¿™æ˜¯ç›®å‰Webåº”ç”¨ä¸­å­˜å‚¨ç”¨æˆ·å¯†ç çš„æ¨èåšæ³•ä¹‹ä¸€ã€‚</p><p>BCryptç®—æ³•ä¼šåœ¨æ¯æ¬¡åŠ å¯†æ—¶è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç›ï¼ˆSaltï¼‰ã€éšæœºç›å€¼ã€‘ï¼Œå¹¶å°†ç›å€¼æ•´åˆåˆ°æœ€ç»ˆçš„å“ˆå¸Œç»“æœä¸­ã€‚è¿™æ„å‘³ç€å³ä½¿ä¸¤ä¸ªç”¨æˆ·ä½¿ç”¨äº†ç›¸åŒçš„å¯†ç ï¼Œç”±äºç›çš„éšæœºæ€§ï¼Œä»–ä»¬å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„å“ˆå¸Œå€¼ä¹Ÿå°†æ˜¯ä¸åŒçš„ã€‚</p><blockquote><p>åˆ¤å®šå¯†ç æ˜¯å¦ç›¸åŒ</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * åˆ¤æ–­å¯†ç æ˜¯å¦ç›¸åŒ  </span><br><span class="hljs-comment"> *  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> rawPassword çœŸå®å¯†ç   </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> encodedPassword åŠ å¯†åå­—ç¬¦  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> ç»“æœ  </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">matchesPassword</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> rawPassword, <span class="hljs-built_in">String</span> encodedPassword</span>)  <br>&#123;  <br>    <span class="hljs-title class_">BCryptPasswordEncoder</span> passwordEncoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();  <br>    <span class="hljs-keyword">return</span> passwordEncoder.<span class="hljs-title function_">matches</span>(rawPassword, encodedPassword);  <br>&#125;<br></code></pre></td></tr></table></figure><p>matches æ–¹æ³•ï¼ˆæå–ç›æ“ä½œï¼Œç”Ÿæˆå“ˆå¸Œå€¼ï¼Œæ¯”è¾ƒå“ˆå¸Œå€¼ï¼‰</p><ol><li><strong>æå–ç›å€¼</strong>ï¼š<code>encodedPassword</code>ï¼ˆæ•°æ®åº“ä¸­çš„å“ˆå¸Œå€¼ï¼‰åŒ…æ‹¬äº†åŸå§‹å¯†ç å“ˆå¸Œçš„ç»“æœå’Œç”¨äºåˆ›å»ºè¿™ä¸ªå“ˆå¸Œçš„ç›å€¼ã€‚<code>matches</code>æ–¹æ³•é¦–å…ˆä»<code>encodedPassword</code>ä¸­æå–å‡ºç”¨äºå“ˆå¸Œçš„ç›å€¼ã€‚</li><li><strong>é‡æ–°å“ˆå¸Œ</strong>ï¼šä½¿ç”¨æå–å‡ºçš„ç›å€¼å’ŒåŒæ ·çš„å“ˆå¸Œç®—æ³•ï¼ˆåŠå…¶å‚æ•°ï¼Œå¦‚å·¥ä½œå› å­ï¼‰ï¼Œå¯¹<code>rawPassword</code>ï¼ˆç”¨æˆ·è¾“å…¥çš„å¯†ç ï¼‰è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚</li><li><strong>æ¯”è¾ƒå“ˆå¸Œå€¼</strong>ï¼šå°†ä¸Šä¸€æ­¥ç”Ÿæˆçš„å“ˆå¸Œå€¼ä¸<code>encodedPassword</code>è¿›è¡Œæ¯”è¾ƒã€‚å› ä¸ºç›å€¼æ˜¯åœ¨åŸå§‹å¯†ç å“ˆå¸Œæ—¶éšæœºç”Ÿæˆçš„ï¼Œå¹¶å­˜å‚¨äº<code>encodedPassword</code>ä¸­ï¼Œæ‰€ä»¥å³ä½¿æ˜¯åŒä¸€ä¸ªå¯†ç ï¼Œæ¯æ¬¡å“ˆå¸Œçš„ç»“æœä¹Ÿæ˜¯å”¯ä¸€çš„ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ç›¸åŒçš„å¯†ç å’Œç›å€¼ï¼ŒæŒ‰ç…§ç›¸åŒçš„æ–¹æ³•è¿›è¡Œå“ˆå¸Œï¼Œå°†äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼ã€‚</li><li><strong>è¿”å›ç»“æœ</strong>ï¼š<ul><li>å¦‚æœä¸¤ä¸ªå“ˆå¸Œå€¼ç›¸åŒï¼Œè¯´æ˜ç”¨æˆ·è¾“å…¥çš„å¯†ç æ­£ç¡®ï¼Œ<code>matches</code>æ–¹æ³•è¿”å›<code>true</code>ã€‚</li><li>å¦‚æœä¸¤ä¸ªå“ˆå¸Œå€¼ä¸åŒï¼Œè¯´æ˜å¯†ç ä¸åŒ¹é…ï¼Œ<code>matches</code>æ–¹æ³•è¿”å›<code>false</code>ã€‚</li></ul></li></ol><hr><h3 id="è®¤è¯æˆæƒæµç¨‹"><a href="#è®¤è¯æˆæƒæµç¨‹" class="headerlink" title="è®¤è¯æˆæƒæµç¨‹"></a>è®¤è¯æˆæƒæµç¨‹</h3><h3 id="ä¸€ã€å¸¸ç”¨ç”¨æ³•"><a href="#ä¸€ã€å¸¸ç”¨ç”¨æ³•" class="headerlink" title="ä¸€ã€å¸¸ç”¨ç”¨æ³•"></a>ä¸€ã€å¸¸ç”¨ç”¨æ³•</h3><p>å¼•å…¥ä½¿ç”¨ï¼Œæ·»åŠ Spring Securityä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Maven --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åŸºæœ¬é…ç½®</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Securityä¼šæ·»åŠ ä¸€äº›è‡ªåŠ¨é…ç½®ï¼ŒåŒ…æ‹¬ä¸€ä¸ªé»˜è®¤çš„ç”¨æˆ·ï¼ˆç”¨æˆ·åæ˜¯<code>user</code>ï¼Œå¯†ç åœ¨å¯åŠ¨æ—¶æ§åˆ¶å°è¾“å‡ºï¼‰å’ŒåŸºæœ¬çš„ç™»å½•é¡µé¢ã€‚</p><p>è¦è‡ªå®šä¹‰é…ç½®ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªé…ç½®ç±»å¹¶ç»§æ‰¿<code>WebSecurityConfigurerAdapter</code>ï¼Œç„¶åè¦†ç›–å…¶ä¸­çš„æ–¹æ³•</p><p>åœ¨è‹¥ä¾çš„åˆ†ç¦»ç‰ˆæœ¬é¡¹ç›®ä¸­ï¼Œä½¿ç”¨çš„é…ç½®ç±»æ–‡ä»¶æ˜¯ï¼š SecurityConfig</p><p>ä¸€èˆ¬æˆ‘ä»¬ä¼š è¦†ç›– configure æ–¹æ³•è¿›è¡Œé‡å†™ï¼Œæ·»åŠ ä¸€äº›è‡ªå®šä¹‰é…ç½®</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">package</span> com.ruoyi.framework.config;  <br>  <br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.<span class="hljs-type">Autowired</span>;  <br><span class="hljs-keyword">import</span> org.springframework.context.annotation.<span class="hljs-type">Bean</span>;  <br><span class="hljs-keyword">import</span> org.springframework.http.<span class="hljs-type">HttpMethod</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.authentication.<span class="hljs-type">AuthenticationManager</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.authentication.builders.<span class="hljs-type">AuthenticationManagerBuilder</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.method.configuration.<span class="hljs-type">EnableGlobalMethodSecurity</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.builders.<span class="hljs-type">HttpSecurity</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.configuration.<span class="hljs-type">WebSecurityConfigurerAdapter</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.config.annotation.web.configurers.<span class="hljs-type">ExpressionUrlAuthorizationConfigurer</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.config.http.<span class="hljs-type">SessionCreationPolicy</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.core.userdetails.<span class="hljs-type">UserDetailsService</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.crypto.bcrypt.<span class="hljs-type">BCryptPasswordEncoder</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.web.authentication.<span class="hljs-type">UsernamePasswordAuthenticationFilter</span>;  <br><span class="hljs-keyword">import</span> org.springframework.security.web.authentication.logout.<span class="hljs-type">LogoutFilter</span>;  <br><span class="hljs-keyword">import</span> org.springframework.web.filter.<span class="hljs-type">CorsFilter</span>;  <br><span class="hljs-keyword">import</span> com.ruoyi.framework.config.properties.<span class="hljs-type">PermitAllUrlProperties</span>;  <br><span class="hljs-keyword">import</span> com.ruoyi.framework.security.filter.<span class="hljs-type">JwtAuthenticationTokenFilter</span>;  <br><span class="hljs-keyword">import</span> com.ruoyi.framework.security.handle.<span class="hljs-type">AuthenticationEntryPointImpl</span>;  <br><span class="hljs-keyword">import</span> com.ruoyi.framework.security.handle.<span class="hljs-type">LogoutSuccessHandlerImpl</span>;  <br>  <br><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * spring securityé…ç½®  </span><br><span class="hljs-comment"> *   </span><br><span class="hljs-comment"> * @author ruoyi  </span><br><span class="hljs-comment"> */</span><span class="hljs-meta">@EnableGlobalMethodSecurity</span>(prePostEnabled = <span class="hljs-literal">true</span>, securedEnabled = <span class="hljs-literal">true</span>)  <br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span>  </span><br>&#123;  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * è‡ªå®šä¹‰ç”¨æˆ·è®¤è¯é€»è¾‘  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">UserDetailsService</span> userDetailsService;  <br>      <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * è®¤è¯å¤±è´¥å¤„ç†ç±»  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">AuthenticationEntryPointImpl</span> unauthorizedHandler;  <br>  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * é€€å‡ºå¤„ç†ç±»  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">LogoutSuccessHandlerImpl</span> logoutSuccessHandler;  <br>  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * tokenè®¤è¯è¿‡æ»¤å™¨  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">JwtAuthenticationTokenFilter</span> authenticationTokenFilter;  <br>      <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * è·¨åŸŸè¿‡æ»¤å™¨  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">CorsFilter</span> corsFilter;  <br>  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * å…è®¸åŒ¿åè®¿é—®çš„åœ°å€  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">PermitAllUrlProperties</span> permitAllUrl;  <br>  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * è§£å†³ æ— æ³•ç›´æ¥æ³¨å…¥ AuthenticationManager  </span><br><span class="hljs-comment">     *     * @return     * @throws Exception  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-meta">@Bean</span>  <br>    <span class="hljs-meta">@Override</span>    public <span class="hljs-type">AuthenticationManager</span> authenticationManagerBean() <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span>  <br>    &#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.authenticationManagerBean();  <br>    &#125;  <br>  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * anyRequest          |   åŒ¹é…æ‰€æœ‰è¯·æ±‚è·¯å¾„  </span><br><span class="hljs-comment">     * access              |   SpringElè¡¨è¾¾å¼ç»“æœä¸ºtrueæ—¶å¯ä»¥è®¿é—®  </span><br><span class="hljs-comment">     * anonymous           |   åŒ¿åå¯ä»¥è®¿é—®  </span><br><span class="hljs-comment">     * denyAll             |   ç”¨æˆ·ä¸èƒ½è®¿é—®  </span><br><span class="hljs-comment">     * fullyAuthenticated  |   ç”¨æˆ·å®Œå…¨è®¤è¯å¯ä»¥è®¿é—®ï¼ˆéremember-meä¸‹è‡ªåŠ¨ç™»å½•ï¼‰  </span><br><span class="hljs-comment">     * hasAnyAuthority     |   å¦‚æœæœ‰å‚æ•°ï¼Œå‚æ•°è¡¨ç¤ºæƒé™ï¼Œåˆ™å…¶ä¸­ä»»ä½•ä¸€ä¸ªæƒé™å¯ä»¥è®¿é—®  </span><br><span class="hljs-comment">     * hasAnyRole          |   å¦‚æœæœ‰å‚æ•°ï¼Œå‚æ•°è¡¨ç¤ºè§’è‰²ï¼Œåˆ™å…¶ä¸­ä»»ä½•ä¸€ä¸ªè§’è‰²å¯ä»¥è®¿é—®  </span><br><span class="hljs-comment">     * hasAuthority        |   å¦‚æœæœ‰å‚æ•°ï¼Œå‚æ•°è¡¨ç¤ºæƒé™ï¼Œåˆ™å…¶æƒé™å¯ä»¥è®¿é—®  </span><br><span class="hljs-comment">     * hasIpAddress        |   å¦‚æœæœ‰å‚æ•°ï¼Œå‚æ•°è¡¨ç¤ºIPåœ°å€ï¼Œå¦‚æœç”¨æˆ·IPå’Œå‚æ•°åŒ¹é…ï¼Œåˆ™å¯ä»¥è®¿é—®  </span><br><span class="hljs-comment">     * hasRole             |   å¦‚æœæœ‰å‚æ•°ï¼Œå‚æ•°è¡¨ç¤ºè§’è‰²ï¼Œåˆ™å…¶è§’è‰²å¯ä»¥è®¿é—®  </span><br><span class="hljs-comment">     * permitAll           |   ç”¨æˆ·å¯ä»¥ä»»æ„è®¿é—®  </span><br><span class="hljs-comment">     * rememberMe          |   å…è®¸é€šè¿‡remember-meç™»å½•çš„ç”¨æˆ·è®¿é—®  </span><br><span class="hljs-comment">     * authenticated       |   ç”¨æˆ·ç™»å½•åå¯è®¿é—®  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-meta">@Override</span>  <br>    <span class="hljs-keyword">protected</span> void configure(<span class="hljs-type">HttpSecurity</span> httpSecurity) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span>  <br>    &#123;  <br>        <span class="hljs-comment">// æ³¨è§£æ ‡è®°å…è®¸åŒ¿åè®¿é—®çš„url  </span><br>        <span class="hljs-type">ExpressionUrlAuthorizationConfigurer</span>&lt;<span class="hljs-type">HttpSecurity</span>&gt;.<span class="hljs-type">ExpressionInterceptUrlRegistry</span> registry = httpSecurity.authorizeRequests();  <br>        permitAllUrl.getUrls().forEach(url -&gt; registry.antMatchers(url).permitAll());  <br>  <br>        httpSecurity  <br>                <span class="hljs-comment">// CSRFç¦ç”¨ï¼Œå› ä¸ºä¸ä½¿ç”¨session  </span><br>                .csrf().disable()  <br>                <span class="hljs-comment">// ç¦ç”¨HTTPå“åº”æ ‡å¤´  </span><br>                .headers().cacheControl().disable().and()  <br>                <span class="hljs-comment">// è®¤è¯å¤±è´¥å¤„ç†ç±»  </span><br>                .exceptionHandling().authenticationEntryPoint(unauthorizedHandler).and()  <br>                <span class="hljs-comment">// åŸºäºtokenï¼Œæ‰€ä»¥ä¸éœ€è¦session  </span><br>                .sessionManagement().sessionCreationPolicy(<span class="hljs-type">SessionCreationPolicy</span>.<span class="hljs-type">STATELESS</span>).and()  <br>                <span class="hljs-comment">// è¿‡æ»¤è¯·æ±‚  </span><br>                .authorizeRequests()  <br>                <span class="hljs-comment">// å¯¹äºç™»å½•login æ³¨å†Œregister éªŒè¯ç captchaImage å…è®¸åŒ¿åè®¿é—®  </span><br>                .antMatchers(<span class="hljs-string">&quot;/login&quot;</span>, <span class="hljs-string">&quot;/register&quot;</span>, <span class="hljs-string">&quot;/captchaImage&quot;</span>).permitAll()  <br>                <span class="hljs-comment">// é™æ€èµ„æºï¼Œå¯åŒ¿åè®¿é—®  </span><br>                .antMatchers(<span class="hljs-type">HttpMethod</span>.<span class="hljs-type">GET</span>, <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;/*.html&quot;</span>, <span class="hljs-string">&quot;/**/*.html&quot;</span>, <span class="hljs-string">&quot;/**/*.css&quot;</span>, <span class="hljs-string">&quot;/**/*.js&quot;</span>, <span class="hljs-string">&quot;/profile/**&quot;</span>).permitAll()  <br>                .antMatchers(<span class="hljs-string">&quot;/swagger-ui.html&quot;</span>, <span class="hljs-string">&quot;/swagger-resources/**&quot;</span>, <span class="hljs-string">&quot;/webjars/**&quot;</span>, <span class="hljs-string">&quot;/*/api-docs&quot;</span>, <span class="hljs-string">&quot;/druid/**&quot;</span>).permitAll()  <br>                <span class="hljs-comment">// é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯  </span><br>                .anyRequest().authenticated()  <br>                .and()  <br>                .headers().frameOptions().disable();  <br>        <span class="hljs-comment">// æ·»åŠ Logout filter  </span><br>        httpSecurity.logout().logoutUrl(<span class="hljs-string">&quot;/logout&quot;</span>).logoutSuccessHandler(logoutSuccessHandler);  <br>        <span class="hljs-comment">// æ·»åŠ JWT filter  </span><br>        httpSecurity.addFilterBefore(authenticationTokenFilter, <span class="hljs-type">UsernamePasswordAuthenticationFilter</span>.<span class="hljs-keyword">class</span>);  <br>        <span class="hljs-comment">// æ·»åŠ CORS filter  </span><br>        httpSecurity.addFilterBefore(corsFilter, <span class="hljs-type">JwtAuthenticationTokenFilter</span>.<span class="hljs-keyword">class</span>);  <br>        httpSecurity.addFilterBefore(corsFilter, <span class="hljs-type">LogoutFilter</span>.<span class="hljs-keyword">class</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * å¼ºæ•£åˆ—å“ˆå¸ŒåŠ å¯†å®ç°  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-meta">@Bean</span>  <br>    public <span class="hljs-type">BCryptPasswordEncoder</span> bCryptPasswordEncoder()  <br>    &#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">BCryptPasswordEncoder</span>();  <br>    &#125;  <br>  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * èº«ä»½è®¤è¯æ¥å£  </span><br><span class="hljs-comment">     */</span>  <br>    <span class="hljs-meta">@Override</span>  <br>    <span class="hljs-keyword">protected</span> void configure(<span class="hljs-type">AuthenticationManagerBuilder</span> auth) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span>  <br>    &#123;  <br>        auth.userDetailsService(userDetailsService).passwordEncoder(bCryptPasswordEncoder());  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="äºŒã€æƒé™æ§åˆ¶"><a href="#äºŒã€æƒé™æ§åˆ¶" class="headerlink" title="äºŒã€æƒé™æ§åˆ¶"></a>äºŒã€æƒé™æ§åˆ¶</h3>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>SpringSecurity</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_å…¶ä»–å¸¸è§é¢è¯•é¢˜</title>
    <link href="/2024/03/27/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E5%85%B6%E4%BB%96%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <url>/2024/03/27/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E5%85%B6%E4%BB%96%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="Netty"><a href="#Netty" class="headerlink" title="Netty"></a>Netty</h3><h4 id="åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«"><a href="#åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«" class="headerlink" title="åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«"></a>åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«</h4><h4 id="é˜»å¡å’Œâ¾®é˜»å¡çš„åŒºåˆ«"><a href="#é˜»å¡å’Œâ¾®é˜»å¡çš„åŒºåˆ«" class="headerlink" title="é˜»å¡å’Œâ¾®é˜»å¡çš„åŒºåˆ«"></a>é˜»å¡å’Œâ¾®é˜»å¡çš„åŒºåˆ«</h4><h4 id="TCPç²˜åŒ…-æ‹†åŒ…"><a href="#TCPç²˜åŒ…-æ‹†åŒ…" class="headerlink" title="TCPç²˜åŒ…&#x2F;æ‹†åŒ…"></a>TCPç²˜åŒ…&#x2F;æ‹†åŒ…</h4><h4 id="å¸¸â»…çš„IOæ¨¡å‹"><a href="#å¸¸â»…çš„IOæ¨¡å‹" class="headerlink" title="å¸¸â»…çš„IOæ¨¡å‹"></a>å¸¸â»…çš„IOæ¨¡å‹</h4><h4 id="Nettyæœ‰å“ªäº›æ ¸â¼¼ç»„ä»¶"><a href="#Nettyæœ‰å“ªäº›æ ¸â¼¼ç»„ä»¶" class="headerlink" title="Nettyæœ‰å“ªäº›æ ¸â¼¼ç»„ä»¶"></a>Nettyæœ‰å“ªäº›æ ¸â¼¼ç»„ä»¶</h4><ul><li>Channel ä¸»è¦è´Ÿè´£â½¹ç»œæ“ä½œï¼Œâ½å¦‚è¿æ¥ã€IOè¯»å†™æ“ä½œ</li><li>Bootstrap&#x2F;ServerBootstrap åˆ†åˆ«æ˜¯å®¢æˆ·ç«¯å¯åŠ¨ç±»ã€æœåŠ¡ç«¯å¯åŠ¨ç±»</li><li>EventLoop é…åˆChannelå¤„ç†IOæ“ä½œ</li><li>ChannelHandler ä¸»è¦è´Ÿè´£å¤„ç†å„ç§äº‹ä»¶ï¼Œâ½å¦‚æ•°æ®å¤„ç†</li><li>ChannelPipeline ç›¸å½“äºå­˜æ”¾ChannelHandlerçš„å®¹å™¨ï¼Œæ¯ä¸ªChannelä¼šç»‘å®šâ¼€ä¸ª</li><li>ByteBuf æ˜¯Nettyâ¾ƒâ¼°å­—èŠ‚å®¹å™¨ï¼Œâ½¤äºâ½¹ç»œæ•°æ®è¯»å†™</li></ul><h4 id="è°ˆè°ˆä½ å¯¹Nettyä¸­Pipelineâ¼¯ä½œåŸç†ç†è§£"><a href="#è°ˆè°ˆä½ å¯¹Nettyä¸­Pipelineâ¼¯ä½œåŸç†ç†è§£" class="headerlink" title="è°ˆè°ˆä½ å¯¹Nettyä¸­Pipelineâ¼¯ä½œåŸç†ç†è§£"></a>è°ˆè°ˆä½ å¯¹Nettyä¸­Pipelineâ¼¯ä½œåŸç†ç†è§£</h4><h4 id="Nettyä¸­æä¾›äº†å“ªäº›çº¿ç¨‹æ¨¡å‹"><a href="#Nettyä¸­æä¾›äº†å“ªäº›çº¿ç¨‹æ¨¡å‹" class="headerlink" title="Nettyä¸­æä¾›äº†å“ªäº›çº¿ç¨‹æ¨¡å‹"></a>Nettyä¸­æä¾›äº†å“ªäº›çº¿ç¨‹æ¨¡å‹</h4><h4 id="Nettyæ˜¯å¦‚ä½•å®ç°é›¶æ‹·â»‰çš„"><a href="#Nettyæ˜¯å¦‚ä½•å®ç°é›¶æ‹·â»‰çš„" class="headerlink" title="Nettyæ˜¯å¦‚ä½•å®ç°é›¶æ‹·â»‰çš„"></a>Nettyæ˜¯å¦‚ä½•å®ç°é›¶æ‹·â»‰çš„</h4><h3 id="ZK"><a href="#ZK" class="headerlink" title="ZK"></a>ZK</h3><h3 id="ES"><a href="#ES" class="headerlink" title="ES"></a>ES</h3><h4 id="ES-äº†è§£å¤šå—ï¼Œè®²ä¸€ä¸‹ä»–çš„åŸç†"><a href="#ES-äº†è§£å¤šå—ï¼Œè®²ä¸€ä¸‹ä»–çš„åŸç†" class="headerlink" title="ES äº†è§£å¤šå—ï¼Œè®²ä¸€ä¸‹ä»–çš„åŸç†"></a>ES äº†è§£å¤šå—ï¼Œè®²ä¸€ä¸‹ä»–çš„åŸç†</h4><h4 id="å€’æ’ç´¢å¼•"><a href="#å€’æ’ç´¢å¼•" class="headerlink" title="å€’æ’ç´¢å¼•"></a>å€’æ’ç´¢å¼•</h4><ul><li><p>åˆ†è¯å™¨  </p></li><li><p>å€’æ’ç´¢å¼•æ˜¯ Elasticsearch å®ç°å…¨æ–‡æœç´¢çš„æ ¸å¿ƒæŠ€æœ¯ã€‚å®ƒç±»ä¼¼äºä¸€æœ¬ä¹¦çš„ç´¢å¼•ï¼Œé€šè¿‡å•è¯å¿«é€Ÿæ‰¾åˆ°åŒ…å«è¯¥å•è¯çš„æ–‡æ¡£ã€‚</p></li><li><p>å€’æ’ç´¢å¼•å°†æ–‡æ¡£å†…å®¹åˆ†è¯ï¼Œå¹¶å°†è¯é¡¹æ˜ å°„åˆ°åŒ…å«è¿™äº›è¯é¡¹çš„æ–‡æ¡£ ID åˆ—è¡¨</p></li></ul><h4 id="ES-åšä¼šèšæŸ¥è¯¢çš„æ—¶å€™ï¼Œå½“æ•°æ®è¶…è¿‡-10000-æ¡çš„è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¸€èˆ¬æ€ä¹ˆè§£å†³"><a href="#ES-åšä¼šèšæŸ¥è¯¢çš„æ—¶å€™ï¼Œå½“æ•°æ®è¶…è¿‡-10000-æ¡çš„è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¸€èˆ¬æ€ä¹ˆè§£å†³" class="headerlink" title="ES åšä¼šèšæŸ¥è¯¢çš„æ—¶å€™ï¼Œå½“æ•°æ®è¶…è¿‡ 10000 æ¡çš„è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¸€èˆ¬æ€ä¹ˆè§£å†³"></a>ES åšä¼šèšæŸ¥è¯¢çš„æ—¶å€™ï¼Œå½“æ•°æ®è¶…è¿‡ 10000 æ¡çš„è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¸€èˆ¬æ€ä¹ˆè§£å†³</h4><ul><li>å¯ä»¥é‡‡ç”¨åˆ†æ‰¹æ¬¡èšåˆçš„æ–¹å¼</li></ul>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç³»ç»Ÿè®¾è®¡_æ•°æ®å®‰å…¨</title>
    <link href="/2024/03/22/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1_%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8/"/>
    <url>/2024/03/22/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1_%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€å¸¸ç”¨åŠ å¯†ç®—æ³•"><a href="#1ã€å¸¸ç”¨åŠ å¯†ç®—æ³•" class="headerlink" title="1ã€å¸¸ç”¨åŠ å¯†ç®—æ³•"></a>1ã€å¸¸ç”¨åŠ å¯†ç®—æ³•</h3><p>åŠ å¯†ç®—æ³•æ˜¯ä¸€ç§ç”¨æ•°å­¦æ–¹æ³•å¯¹æ•°æ®è¿›è¡Œå˜æ¢çš„æŠ€æœ¯ï¼Œç›®çš„æ˜¯ä¿æŠ¤æ•°æ®çš„å®‰å…¨ï¼Œé˜²æ­¢è¢«æœªç»æˆæƒçš„äººè¯»å–æˆ–ä¿®æ”¹ã€‚åŠ å¯†ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼šå¯¹ç§°åŠ å¯†ç®—æ³•ã€éå¯¹ç§°åŠ å¯†ç®—æ³•å’Œå“ˆå¸Œç®—æ³•ï¼ˆä¹Ÿå«æ‘˜è¦ç®—æ³•ï¼‰ã€‚</p><p>æ—¥å¸¸å¼€å‘ä¸­å¸¸è§çš„éœ€è¦ç”¨åˆ°çš„åŠ å¯†ç®—æ³•çš„åœºæ™¯ï¼š</p><ol><li>ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„å¯†ç éœ€è¦åŠ ç›ä¹‹åä½¿ç”¨å“ˆå¸Œç®—æ³•ï¼ˆæ¯”å¦‚ BCryptï¼‰è¿›è¡ŒåŠ å¯†ã€‚</li><li>ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„é“¶è¡Œå¡å·ã€èº«ä»½å·è¿™ç±»æ•æ„Ÿæ•°æ®éœ€è¦ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆæ¯”å¦‚ AESï¼‰ä¿å­˜ã€‚</li><li>ç½‘ç»œä¼ è¾“çš„æ•æ„Ÿæ•°æ®æ¯”å¦‚é“¶è¡Œå¡å·ã€èº«ä»½å·éœ€è¦ç”¨ HTTPS + éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆå¦‚ RSAï¼‰æ¥ä¿è¯ä¼ è¾“æ•°æ®çš„å®‰å…¨æ€§ã€‚</li><li>â€¦â€¦</li></ol><p>å‚è€ƒï¼š <a href="https://javaguide.cn/system-design/security/encryption-algorithms.html">https://javaguide.cn/system-design/security/encryption-algorithms.html</a></p><ul><li>å“ˆå¸Œç®—æ³•</li><li>å¯¹ç§°ç®—æ³•</li><li>éå¯¹ç§°ç®—æ³•</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240322225241.png" alt="image.png"></p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ†å¸ƒå¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†å¸ƒå¼æˆæƒè®¿é—®</title>
    <link href="/2024/03/22/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/"/>
    <url>/2024/03/22/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/</url>
    
    <content type="html"><![CDATA[<ul><li><strong>è®¤è¯ (Authentication)ï¼š</strong>Â ä½ æ˜¯è°ã€‚</li><li><strong>æˆæƒ (Authorization)ï¼š</strong>Â ä½ æœ‰æƒé™å¹²ä»€ä¹ˆ</li></ul><p>å¼•å…¥åŸºç¡€æ¦‚å¿µ</p><ul><li>RBAC æ¨¡å‹<ul><li>RBAC å³åŸºäºè§’è‰²çš„æƒé™è®¿é—®æ§åˆ¶ï¼ˆRole-Based Access Controlï¼‰ã€‚è¿™æ˜¯ä¸€ç§é€šè¿‡è§’è‰²å…³è”æƒé™ï¼Œè§’è‰²åŒæ—¶åˆå…³è”ç”¨æˆ·çš„æˆæƒçš„æ–¹å¼</li></ul></li></ul><p>è®¤è¯æˆæƒ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240322201429.png" alt="image.png"></p><h3 id="1ã€Cookie-çš„ä½œç”¨"><a href="#1ã€Cookie-çš„ä½œç”¨" class="headerlink" title="1ã€Cookie çš„ä½œç”¨"></a>1ã€Cookie çš„ä½œç”¨</h3><p>Cookie æ˜¯ä¿å­˜åœ¨æµè§ˆå™¨çš„ä¸€ä¸ªä¿¡æ¯ï¼ŒSession æ˜¯ä¿å­˜åœ¨æœåŠ¡å™¨çš„ä¸€ä¸ªä¿¡æ¯</p><p>ä½¿ç”¨ cookie çš„ç™»é™†æµç¨‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240322184719.png" alt="image.png"></p><h3 id="2ã€åˆ†å¸ƒå¼-session"><a href="#2ã€åˆ†å¸ƒå¼-session" class="headerlink" title="2ã€åˆ†å¸ƒå¼ session"></a>2ã€åˆ†å¸ƒå¼ session</h3><p>åˆ†æ—¶å¼ session ä¼šé‡åˆ°çš„é—®é¢˜ï¼š</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚æˆ‘ä»¬éƒ¨ç½²äº†ä¸¤ä»½ç›¸åŒçš„æœåŠ¡ Aï¼ŒBï¼Œç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»é™†çš„æ—¶å€™ ï¼ŒNginx é€šè¿‡è´Ÿè½½å‡è¡¡æœºåˆ¶å°†ç”¨æˆ·è¯·æ±‚è½¬å‘åˆ° A æœåŠ¡å™¨ï¼Œæ­¤æ—¶ç”¨æˆ·çš„ Session ä¿¡æ¯ä¿å­˜åœ¨ A æœåŠ¡å™¨ã€‚ç»“æœï¼Œç”¨æˆ·ç¬¬äºŒæ¬¡è®¿é—®çš„æ—¶å€™ Nginx å°†è¯·æ±‚è·¯ç”±åˆ° B æœåŠ¡å™¨ï¼Œç”±äº B æœåŠ¡å™¨æ²¡æœ‰ä¿å­˜ ç”¨æˆ·çš„ Session ä¿¡æ¯ï¼Œå¯¼è‡´ç”¨æˆ·éœ€è¦é‡æ–°è¿›è¡Œç™»é™†ã€‚</p><p>è¿™é‡Œçš„é—®é¢˜å°±æ˜¯éœ€è¦å°† session èƒ½å¤ŸåŒæ­¥åˆ°æ‰€æœ‰å…³è”çš„æœåŠ¡å™¨ï¼Œå¹¶é€šè¿‡æµè§ˆå™¨çš„ cookie èƒ½å¤Ÿè¿›è¡Œæˆæƒè®¿é—®</p><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>æŸä¸ªç”¨æˆ·çš„æ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡ç‰¹æ€§çš„å“ˆå¸Œç­–ç•¥åˆ†é…ç»™åŒä¸€ä¸ªæœåŠ¡å™¨å¤„ç†ã€‚è¿™æ ·çš„è¯ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½ä¿å­˜äº†ä¸€éƒ¨åˆ†ç”¨æˆ·çš„ Session ä¿¡æ¯ã€‚æœåŠ¡å™¨å®•æœºï¼Œå…¶ä¿å­˜çš„æ‰€æœ‰ Session ä¿¡æ¯å°±å®Œå…¨ä¸¢å¤±äº†ã€‚</li><li>æ¯ä¸€ä¸ªæœåŠ¡å™¨ä¿å­˜çš„ Session ä¿¡æ¯éƒ½æ˜¯äº’ç›¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªæœåŠ¡å™¨éƒ½ä¿å­˜äº†å…¨é‡çš„ Session ä¿¡æ¯ã€‚æ¯å½“ä¸€ä¸ªæœåŠ¡å™¨çš„ Session ä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬å°±å°†å…¶åŒæ­¥åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚è¿™ç§æ–¹æ¡ˆæˆæœ¬å¤ªå¤§ï¼Œå¹¶ä¸”ï¼ŒèŠ‚ç‚¹è¶Šå¤šæ—¶ï¼ŒåŒæ­¥æˆæœ¬ä¹Ÿè¶Šé«˜ã€‚</li><li>å•ç‹¬ä½¿ç”¨ä¸€ä¸ªæ‰€æœ‰æœåŠ¡å™¨éƒ½èƒ½è®¿é—®åˆ°çš„æ•°æ®èŠ‚ç‚¹ï¼ˆæ¯”å¦‚ç¼“å­˜ï¼‰æ¥å­˜æ”¾ Session ä¿¡æ¯ã€‚ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œæ•°æ®èŠ‚ç‚¹å°½é‡è¦é¿å…æ˜¯å•ç‚¹ã€‚</li><li>Spring Session æ˜¯ä¸€ä¸ªç”¨äºåœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´ç®¡ç†ä¼šè¯çš„é¡¹ç›®ã€‚å®ƒå¯ä»¥ä¸å¤šç§åç«¯å­˜å‚¨ï¼ˆå¦‚ Redisã€MongoDB ç­‰ï¼‰é›†æˆï¼Œä»è€Œå®ç°åˆ†å¸ƒå¼ä¼šè¯ç®¡ç†ã€‚é€šè¿‡ Spring Sessionï¼Œå¯ä»¥å°†ä¼šè¯æ•°æ®å­˜å‚¨åœ¨å…±äº«çš„å¤–éƒ¨å­˜å‚¨ä¸­ï¼Œä»¥å®ç°è·¨æœåŠ¡å™¨çš„ä¼šè¯åŒæ­¥å’Œå…±äº«ã€‚</li></ol><p>ä½¿ç”¨ session è¿›è¡Œç™»é™†ä¼šé‡åˆ°çš„é—®é¢˜ï¼š</p><p>å½“åˆ«äººæ‹¿å–åˆ°ä½ æµè§ˆå™¨ä¸­çš„ cookie ä¿¡æ¯ï¼Œå¯ç”¨è¿›è¡Œéæ³•è¯·æ±‚è®¿é—®ï¼ˆè·å–åˆ°ä½  cookie ä¸­çš„ session IDä¿¡æ¯ï¼‰ï¼Œå¹¶ä¸èƒ½ç¦æ­¢ CSRF æ”»å‡»ã€‚ï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰</p><p>è€Œ token ä¸€èˆ¬ä¼šå­˜æ”¾åˆ° Local Storage ä¸­</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240322185741.png" alt="image.png"></p><p>çœ‹äº†ä¸€ä¸‹ä¸ºå•¥è·³è½¬é“¾æ¥ cookie ä¼šæœ‰é£é™©ï¼Œä¸€ä¸ªéœ€è¦æ˜¾å¼æºå¸¦ï¼Œä¸€ä¸ªæ˜¯æµè§ˆå™¨è‡ªåŠ¨é™„å¸¦ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240322190152.png" alt="image.png"></p><h3 id="3ã€JWT"><a href="#3ã€JWT" class="headerlink" title="3ã€JWT"></a>3ã€JWT</h3><p>JWT æœ¬èº«ä¹Ÿæ˜¯ Tokenï¼Œä¸€ç§è§„èŒƒåŒ–ä¹‹åçš„ JSON ç»“æ„çš„ Tokenã€‚</p><p>JWT è‡ªèº«åŒ…å«äº†èº«ä»½éªŒè¯æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ Session ä¿¡æ¯ã€‚è¿™æ˜¾ç„¶å¢åŠ äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¼¸ç¼©æ€§ï¼Œå¤§å¤§å‡è½»äº†æœåŠ¡ç«¯çš„å‹åŠ›ã€‚</p><p>ç»„æˆç»“æ„ï¼šå¤´éƒ¨ã€æœ‰æ•ˆè½½è·ã€ç­¾å</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240322190335.png" alt="image.png"></p><p>JWT æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç»„å­—ä¸²ï¼Œé€šè¿‡ï¼ˆ<code>.</code>ï¼‰åˆ‡åˆ†æˆä¸‰ä¸ªä¸º Base64 ç¼–ç çš„éƒ¨åˆ†ï¼š</p><ul><li><strong>Header</strong> : æè¿° JWT çš„å…ƒæ•°æ®ï¼Œå®šä¹‰äº†ç”Ÿæˆç­¾åçš„ç®—æ³•ä»¥åŠ <code>Token</code> çš„ç±»å‹ã€‚</li><li><strong>Payload</strong> : ç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®</li><li><strong>Signatureï¼ˆç­¾åï¼‰</strong>ï¼šæœåŠ¡å™¨é€šè¿‡ Payloadã€Header å’Œä¸€ä¸ªå¯†é’¥(Secret)ä½¿ç”¨ Header é‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰ç”Ÿæˆã€‚</li></ul><p>JWT é€šå¸¸æ˜¯è¿™æ ·çš„ï¼š<code>xxxxx.yyyyy.zzzzz</code>ã€‚</p><p>ä¸€èˆ¬æˆ‘ä»¬ä¼šå°† token å­˜æ”¾åˆ° redis ä¸­ï¼Œé€šè¿‡åˆ¤å®šå®ƒè¿‡æœŸæ—¶é—´ä»¥åŠ æ˜¯å¦å½“å‰ç”¨æˆ·åœ¨ redis ä¸­çš„ token å’Œ å‰ç«¯çš„ token è¿›è¡Œä¸€ä¸€åŒ¹é…ï¼Œè¿›è¡Œè®¤è¯ã€‚</p><h3 id="4ã€å•ç‚¹ç™»é™†-SSO"><a href="#4ã€å•ç‚¹ç™»é™†-SSO" class="headerlink" title="4ã€å•ç‚¹ç™»é™† SSO"></a>4ã€å•ç‚¹ç™»é™† SSO</h3><p>SSO è‹±æ–‡å…¨ç§° Single Sign Onï¼Œå•ç‚¹ç™»å½•ã€‚SSO æ˜¯åœ¨å¤šä¸ªåº”ç”¨ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·åªéœ€è¦ç™»å½•ä¸€æ¬¡å°±å¯ä»¥è®¿é—®æ‰€æœ‰ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚</p><p>ç”¨æˆ·åœ¨æµè§ˆéœ€è¦ç™»å½•çš„é¡µé¢æ—¶ï¼Œå®¢æˆ·ç«¯å°† AuthToken æäº¤ç»™ SSO æœåŠ¡æ ¡éªŒç™»å½•çŠ¶æ€&#x2F;è·å–ç”¨æˆ·ç™»å½•ä¿¡æ¯</p><p>å¯¹äºç™»å½•ä¿¡æ¯çš„å­˜å‚¨ï¼Œå»ºè®®é‡‡ç”¨ Redisï¼Œä½¿ç”¨ Redis é›†ç¾¤æ¥å­˜å‚¨ç™»å½•ä¿¡æ¯ï¼Œæ—¢å¯ä»¥ä¿è¯é«˜å¯ç”¨ï¼Œåˆå¯ä»¥çº¿æ€§æ‰©å……ã€‚åŒæ—¶ä¹Ÿå¯ä»¥è®© SSO æœåŠ¡æ»¡è¶³è´Ÿè½½å‡è¡¡&#x2F;å¯ä¼¸ç¼©çš„éœ€æ±‚ã€‚</p><p>ç™»é™†æ“ä½œç›¸å…³çš„æµç¨‹å›¾å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªï¼š <a href="https://javaguide.cn/system-design/security/sso-intro.html#%E8%B7%A8%E5%9F%9F%E7%99%BB%E5%BD%95%E3%80%81%E7%99%BB%E5%87%BA">https://javaguide.cn/system-design/security/sso-intro.html#%E8%B7%A8%E5%9F%9F%E7%99%BB%E5%BD%95%E3%80%81%E7%99%BB%E5%87%BA</a></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240322200959.png" alt="image.png"></p><h3 id="5ã€OAuth2"><a href="#5ã€OAuth2" class="headerlink" title="5ã€OAuth2"></a>5ã€OAuth2</h3><p>OAuth 2.0æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†çš„æˆæƒåè®®ï¼Œå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨è·å¾—æœ‰é™çš„è®¿é—®æƒé™ï¼Œä»¥ä»£è¡¨èµ„æºæ‰€æœ‰è€…ï¼ˆå¦‚ç”¨æˆ·ï¼‰è®¿é—®å…¶åœ¨èµ„æºæœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œè€Œæ— éœ€å°†ç”¨æˆ·åå’Œå¯†ç ç›´æ¥æš´éœ²ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚</p><p>ã€ç¬¬ä¸‰æ–¹æˆæƒã€‘</p><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/system-design/security/basis-of-authority-certification.html">https://javaguide.cn/system-design/security/basis-of-authority-certification.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springcloud</tag>
      
      <tag>åˆ†å¸ƒå¼</tag>
      
      <tag>ç³»ç»Ÿè®¾è®¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†å¸ƒå¼å­˜å‚¨</title>
    <link href="/2024/03/22/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/"/>
    <url>/2024/03/22/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€MinIO"><a href="#1ã€MinIO" class="headerlink" title="1ã€MinIO"></a>1ã€MinIO</h3><p>MinIOæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¼€æºçš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œç”¨äºå­˜å‚¨éç»“æ„åŒ–æ•°æ®ï¼Œå¦‚ç…§ç‰‡ã€è§†é¢‘ã€æ—¥å¿—æ–‡ä»¶ã€å¤‡ä»½å’Œå®¹å™¨&#x2F;è™šæ‹Ÿæœºæ˜ åƒã€‚</p><p>å‚è€ƒä¸€ä¸‹è¿™ä¸ªï¼š </p><ul><li><a href="https://juejin.cn/post/7016528308451934221">https://juejin.cn/post/7016528308451934221</a></li><li><a href="https://developer.aliyun.com/article/1002987">https://developer.aliyun.com/article/1002987</a></li></ul><p>å»ºè®®å…·ä½“ä½¿ç”¨ä¸€ä¸‹</p><p>ä¸€èˆ¬æ˜¯åœ¨æˆ‘ä»¬é¡¹ç›®ä¸­å¼•å…¥ä¾èµ–ï¼Œç„¶åè¿›è¡Œé…ç½®ï¼ˆå®¢æˆ·ç«¯é…ç½®ï¼‰ï¼Œé€šè¿‡è®¾ç½®è®¿é—®å¯†é’¥å’Œç§é’¥åï¼Œè¿›è¡Œè¿æ¥ï¼Œå¯ä»¥è¿›è¡Œä¸Šä¼ æ–‡ä»¶æ“ä½œï¼ŒMinio ä¼šæä¾›ä¸€äº›å…¬å…± API  æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå°è£…ä¸€ä¸ªå·¥å…·ç±»ï¼Œç„¶åå»ä½¿ç”¨ä»–ã€‚</p><p>æœåŠ¡å™¨çš„ä¸€ç§åˆ›å»ºæ–¹å¼æ˜¯é€šè¿‡dokcer å»æ‹‰å–ï¼Œç„¶ååˆ›å»ºå®¹å™¨å¯åŠ¨ï¼Œç®¡ç†æ§åˆ¶å°åè¿›è¡Œç›¸å…³çš„é…ç½®ã€‚</p><hr><h4 id="æœåŠ¡å™¨ç«¯é…ç½®"><a href="#æœåŠ¡å™¨ç«¯é…ç½®" class="headerlink" title="æœåŠ¡å™¨ç«¯é…ç½®"></a>æœåŠ¡å™¨ç«¯é…ç½®</h4><p>æ‹‰å–é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull minio/minio<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸‹æŒ‚è½½ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#åˆ›å»ºå­˜å‚¨ï¼Œé…ç½®æ–‡ä»¶ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /home/minio/&#123;data,config&#125;<br><span class="hljs-comment">#èµ‹äºˆç›®å½•æƒé™</span><br><span class="hljs-built_in">chmod</span> 777 /home/minio/&#123;data,config&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨å®¹å™¨</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">docker run -p 9000<span class="hljs-function">:9000</span> -p 9090<span class="hljs-function">:9090</span> <span class="hljs-params">--name</span> minio -d <span class="hljs-params">--restart=always</span> -e <span class="hljs-string">&quot;MINIO_ROOT_USER=minio&quot;</span> -e <span class="hljs-string">&quot;MINIO_ROOT_PASSWORD=minio123&quot;</span> -v <span class="hljs-string">/home/minio/data</span>:<span class="hljs-string">/data</span> -v <span class="hljs-string">/home/minio/config</span>:<span class="hljs-string">/root/.minio</span> minio/minio server <span class="hljs-string">/data</span> <span class="hljs-params">--console-address</span> <span class="hljs-string">&quot;:9090&quot;</span><br></code></pre></td></tr></table></figure><p>è§£æï¼š</p><ul><li>-p:å®¿ä¸»ç«¯å£ï¼šå®¹å™¨ç«¯å£</li><li>â€“nameï¼šå®¹å™¨åç§°</li><li>â€“restart&#x3D;always:è®¾ç½®dockerå¯åŠ¨æ—¶ï¼Œå®¹å™¨è·Ÿéšè‡ªå¯</li><li>-e â€œMINIO_ACCESS_KEY&#x3D;adminâ€:è®¾ç½®minioçš„ç”¨æˆ·å</li><li>-e â€œMINIO_SECRET_KEY&#x3D;minio123â€ï¼šè®¾ç½®minioçš„å¯†ç </li><li>-v &#x2F;home&#x2F;minio&#x2F;data:&#x2F;dataï¼šæŒ‚è½½å®¹å™¨çš„å­˜å‚¨ç›®å½•åˆ°å®¿ä¸»</li><li>-v &#x2F;home&#x2F;minio&#x2F;config:&#x2F;root&#x2F;.minioï¼šæŒ‚è½½å®¹å™¨é…ç½®æ–‡ä»¶åˆ°å®¿ä¸»</li><li>&#x2F;data â€“console-address â€œ:9090â€ï¼šå›ºå®š 9090 ç«¯å£è®¿é—®minioçš„webæ§åˆ¶å°</li></ul><hr><p>é€šè¿‡ IP + 9090 ç«¯å£ï¼Œçœ‹æ˜¯å¦èƒ½æ­£å¸¸è®¿é—®ã€‚</p><p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š <a href="https://www.minio.org.cn/docs/minio/container/index.html">https://www.minio.org.cn/docs/minio/container/index.html</a></p><p>åˆ›å»º minio æœåŠ¡åï¼Œå»ºè®®åˆ›å»ºç”¨æˆ·  â†’  åˆ›å»ºç”¨æˆ·ç»„  â†’   åˆ›å»ºå…¬é’¥å’Œç§é’¥</p><p>è¿™é‡Œæ‰¾ä¸€ä¸ª minio çš„ demo é¡¹ç›®çœ‹ä¸€ä¸‹ï¼Œä¸»è¦è¿˜æ˜¯æ€»ç»“ä¸€ä¸‹ç›¸å…³æµç¨‹ï¼Œå¹¶çŸ¥é“å¦‚ä½•é€šè¿‡ minio è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ“ä½œã€‚</p><p><a href="https://github.com/bm4578/SpringBoot/tree/main/SpringBoot-minio">https://github.com/bm4578/SpringBoot/tree/main/SpringBoot-minio</a></p><p>ï¼ˆæ¯”è¾ƒåŸºç¡€ï¼‰</p><p>ç¤ºä¾‹æ“ä½œï¼š</p><h3 id="2ã€FastDFS"><a href="#2ã€FastDFS" class="headerlink" title="2ã€FastDFS"></a>2ã€FastDFS</h3><p>FastDFSæ˜¯ä¸€ä¸ªå¼€æºçš„è½»é‡çº§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒå¯¹æ–‡ä»¶è¿›è¡Œç®¡ç†ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ–‡ä»¶å­˜å‚¨ã€æ–‡ä»¶åŒæ­¥ã€æ–‡ä»¶è®¿é—®ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶ä¸‹è½½ï¼‰ç­‰ï¼Œè§£å†³äº†å¤§å®¹é‡å­˜å‚¨å’Œè´Ÿè½½å‡è¡¡çš„é—®é¢˜ã€‚</p><ul><li><a href="https://cloud.tencent.com/developer/article/1466135">https://cloud.tencent.com/developer/article/1466135</a></li></ul><h3 id="3ã€OSS"><a href="#3ã€OSS" class="headerlink" title="3ã€OSS"></a>3ã€OSS</h3><p>ç•¥</p>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springcloud</tag>
      
      <tag>åˆ†å¸ƒå¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker ComposeåŸºç¡€ä½¿ç”¨</title>
    <link href="/2024/03/21/Docker%20Compose%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/03/21/Docker%20Compose%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©å­¦ä¹ ä¸€ä¸‹ Docker Compose çš„åŸºç¡€ä½¿ç”¨</p><p>ä»‹ç»ï¼š<code>Compose</code> é¡¹ç›®æ˜¯ Docker å®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œè´Ÿè´£å®ç°å¯¹ Docker å®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚</p><p>Compose å…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ <code>docker-compose.yml</code> æ¨¡æ¿æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆprojectï¼‰</p><p><code>Compose</code> ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p><ul><li>æœåŠ¡ (<code>service</code>)ï¼šä¸€ä¸ªåº”ç”¨çš„å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥åŒ…æ‹¬è‹¥å¹²è¿è¡Œç›¸åŒé•œåƒçš„å®¹å™¨å®ä¾‹ã€‚</li><li>é¡¹ç›® (<code>project</code>)ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­å®šä¹‰ã€‚</li></ul><h3 id="1ã€å®‰è£…ä¸å¸è½½"><a href="#1ã€å®‰è£…ä¸å¸è½½" class="headerlink" title="1ã€å®‰è£…ä¸å¸è½½"></a>1ã€å®‰è£…ä¸å¸è½½</h3><p>Linux</p><p>[[Dockerå…¥é—¨_Dockerçš„åŸºæœ¬ä½¿ç”¨#2ã€docker-composeå®‰è£…]]</p><p>docker compose æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œèƒ½å¤Ÿå®ç°å¿«é€Ÿç¼–æ’ã€‚</p><p>windows&#x2F;macOS</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240321230040.png" alt="image.png"></p><p>å¸è½½æ“ä½œï¼š</p><p>å¦‚æœæ˜¯ windows æˆ–è€… macOS ï¼Œéœ€è¦å¸è½½ä¸€ä¸‹ Docker Desktopã€‚</p><p>å¦‚æœ Docker Compose æ˜¯ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…çš„ï¼š</p><ol><li><p><strong>æ‰¾åˆ° Docker Compose çš„å®‰è£…ä½ç½®</strong>ã€‚å¦‚æœä½ ä¸ç¡®å®šå…¶å®‰è£…ä½ç½®ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œ <code>which docker-compose</code>ï¼ˆåœ¨ Linux æˆ– Mac ä¸Šï¼‰æˆ– <code>where docker-compose</code>ï¼ˆåœ¨ Windows ä¸Šï¼‰æ¥æ‰¾åˆ°å®ƒã€‚</p></li><li><p><strong>åˆ é™¤ Docker Compose äºŒè¿›åˆ¶æ–‡ä»¶</strong>ã€‚ä¸€æ—¦ä½ çŸ¥é“äº† Docker Compose çš„å®‰è£…ä½ç½®ï¼Œä½ å¯ä»¥æ‰‹åŠ¨åˆ é™¤è¯¥æ–‡ä»¶ã€‚åœ¨ Linux æˆ– Mac ä¸Šï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨ <code>sudo rm</code> å‘½ä»¤æ¥åˆ é™¤ï¼š</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">rm</span> `<span class="hljs-built_in">which</span> docker-compose`<br></code></pre></td></tr></table></figure><hr><h3 id="2ã€å¦‚ä½•ä½¿ç”¨"><a href="#2ã€å¦‚ä½•ä½¿ç”¨" class="headerlink" title="2ã€å¦‚ä½•ä½¿ç”¨"></a>2ã€å¦‚ä½•ä½¿ç”¨</h3><p>Compose ä½¿ç”¨çš„ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä½¿ç”¨ Dockerfile å®šä¹‰åº”ç”¨ç¨‹åºçš„ç¯å¢ƒã€‚</li><li>ä½¿ç”¨ docker-compose.yml å®šä¹‰æ„æˆåº”ç”¨ç¨‹åºçš„æœåŠ¡ï¼Œè¿™æ ·å®ƒä»¬å¯ä»¥åœ¨éš”ç¦»ç¯å¢ƒä¸­ä¸€èµ·è¿è¡Œã€‚</li><li>æœ€åï¼Œæ‰§è¡Œ docker-compose up å‘½ä»¤æ¥å¯åŠ¨å¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åºã€‚</li></ul><p>ç¤ºä¾‹ä½¿ç”¨ï¼š</p><p>å‡†å¤‡ä¸€ä¸ª SpringBoot çš„é¡¹ç›®ï¼Œå¹¶æ‰“åŒ…ä¸º Jar åŒ…</p><p>æ”¾ç½®åˆ° Linux çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹</p><p>åˆ›å»ºæ–‡ä»¶ï¼šDockerfile </p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># ä½¿ç”¨å®˜æ–¹ Java è¿è¡Œæ—¶ç¯å¢ƒä½œä¸ºåŸºç¡€é•œåƒ</span><br><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span><br><br><span class="hljs-comment"># å·¥ä½œç›®å½•è®¾ä¸º /app</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><br><span class="hljs-comment"># å°†æœ¬åœ°çš„ JAR æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­çš„ /app ç›®å½•</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./zfile-4.1.5.jar /app/myapp_zfile.jar</span><br><br><span class="hljs-comment"># æš´éœ²åº”ç”¨è¿è¡Œç«¯å£</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8091</span><br><br><span class="hljs-comment"># æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-jar&quot;</span>, <span class="hljs-string">&quot;myapp_zfile.jar&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºæ–‡ä»¶  docker-compose.yml</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">app</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">build</span><span class="hljs-punctuation">:</span> <span class="hljs-string">.</span><br>    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">myapp_zfile</span><br>    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8091:8091&quot;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ Docker Compose å¯åŠ¨åº”ç”¨</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">docker-compose up <span class="hljs-comment">--build</span><br></code></pre></td></tr></table></figure><p>æœ‰ä¸€ä¸ªæŠ¥é”™ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">failed <span class="hljs-keyword">to</span> solve: openjdk:<span class="hljs-number">8</span>-jre-slim: failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">do</span> request: Head &quot;https://7iwp6tq0.mirror.aliyuncs.com/v2/library/openjdk/manifests/8-jre-slim?ns=docker.io&quot;: dial tcp: lookup <span class="hljs-number">7</span>iwp6tq0.mirror.aliyuncs.com <span class="hljs-keyword">on</span> <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">53</span>: <span class="hljs-keyword">read</span> udp <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.21</span>:<span class="hljs-number">53861</span>-&gt;<span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">53</span>: <span class="hljs-keyword">read</span>: <span class="hljs-keyword">connection</span> refused<br></code></pre></td></tr></table></figure><p>æœ€åå®šä½åˆ°æ˜¯ DNS é…ç½®çš„åŸå› </p><p>å…ˆå°è¯•æ”¹äº† Docker é•œåƒæºçš„é…ç½®  é…ç½®æ–‡ä»¶  &#x2F;etc&#x2F;docker&#x2F;daemon.json</p><p>æ”¹ä¸ºäº† </p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://hub-mirror.c.163.com&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿˜æ˜¯æŠ¥é”™ï¼Œå°è¯•è®¿é—® <code>ping hub-mirror.c.163.com</code>; ç½‘ç»œæ˜¯æ­£å¸¸çš„</p><p>å°è¯•ä¿®æ”¹ DNS é…ç½®æ–‡ä»¶ &#x2F;etc&#x2F;resolv.confï¼›æ”¹ä¸ºäº†é˜¿é‡Œäº‘å…¬å…± DNSï¼Œ</p><p>å‚è€ƒé“¾æ¥ï¼š <a href="https://zhuanlan.zhihu.com/p/339495904">https://zhuanlan.zhihu.com/p/339495904</a></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># Generated by NetworkManager</span><br><span class="hljs-attribute">nameserver</span> <span class="hljs-number">223.6.6.6</span> <br></code></pre></td></tr></table></figure><p>å¯åŠ¨æ­£å¸¸</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta">#åå°æ‰§è¡Œ</span><br>docker-compose up -d<br><br><span class="hljs-meta">#åœæ­¢æœåŠ¡</span><br>docker-compose down<br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240322085150.png" alt="image.png"></p><p>å…¶ä»–çš„ä½¿ç”¨å‚è€ƒä¸€ä¸‹è¿™ä¸ªï¼š <a href="https://juejin.cn/post/7042663735156015140">https://juejin.cn/post/7042663735156015140</a></p><hr><p>å‚è€ƒ</p><ul><li><a href="https://yeasy.gitbook.io/docker_practice/compose/introduction">https://yeasy.gitbook.io/docker_practice/compose/introduction</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_é¡¹ç›®åœºæ™¯é¢˜</title>
    <link href="/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E9%A1%B9%E7%9B%AE%E5%9C%BA%E6%99%AF%E9%A2%98/"/>
    <url>/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E9%A1%B9%E7%9B%AE%E5%9C%BA%E6%99%AF%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="æå‰å‡†å¤‡"><a href="#æå‰å‡†å¤‡" class="headerlink" title="æå‰å‡†å¤‡"></a>æå‰å‡†å¤‡</h3><h4 id="é‡åˆ°äº†å“ªäº›æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Œæ€ä¹ˆè§£å†³çš„"><a href="#é‡åˆ°äº†å“ªäº›æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Œæ€ä¹ˆè§£å†³çš„" class="headerlink" title="é‡åˆ°äº†å“ªäº›æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Œæ€ä¹ˆè§£å†³çš„"></a>é‡åˆ°äº†å“ªäº›æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Œæ€ä¹ˆè§£å†³çš„</h4><p>ï¼ï¼ <strong>æå‰å‡†å¤‡</strong></p><p>éœ€è¦æå‰å‡†å¤‡ï¼Œé‡è¦åº¦åé«˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é—®èµ·é¡¹ç›®çš„æ—¶å€™ä¼šé—®ä½ æœ‰æ²¡æœ‰ä»€ä¹ˆå°è±¡æ·±åˆ»çš„åœ°æ–¹ï¼Œä½ éœ€è¦è¯´ä¸€ä¸‹ï¼š</p><ul><li>1ã€å½“æ—¶çš„ä¸šåŠ¡èƒŒæ™¯ï¼Œé‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼ˆæŠ€æœ¯é—®é¢˜ï¼‰ï¼›</li><li>2ã€è¿‡ç¨‹ï¼Œåœ¨é‡åˆ°è¿™ä¸ªé—®é¢˜ä½ çš„è§£å†³æ€è·¯å’Œè§£å†³æ–¹æ¡ˆè¯´ä¸€ä¸‹ï¼ˆè§£å†³é—®é¢˜çš„è¿‡ç¨‹ï¼‰ï¼›</li><li>3ã€æœ€ç»ˆè½åœ°æ–¹æ¡ˆã€‚ï¼ˆå½¢æˆä¸€ä¸ªå®Œæ•´é“¾è·¯ï¼Œå¹¶æ¸…æ™°è¡¨è¾¾å‡ºæ¥ï¼‰</li></ul><p>å»ºè®®å‡†å¤‡çš„ä¸€äº›ç‚¹ï¼š</p><ul><li>1ã€è®¾è®¡æ¨¡å¼<ul><li>ä¸€èˆ¬æ˜¯å·¥å‚ã€ç­–ç•¥ã€è´£ä»»é“¾â€¦ ç­‰</li><li>é˜è¿°å›ç­”å»ºè®®ï¼šå…ˆè¯´ä¸€ä¸‹æ”¹åŠ¨å’Œæ”¹åŠ¨ä¹‹åçš„ä¸€ä¸ªæ¯”å¯¹ï¼Œåœ¨æ²¡æœ‰ä½¿ç”¨åˆ°è®¾è®¡æ¨¡å¼ä¹‹å‰ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼ˆæ¯”å¦‚éœ€æ±‚ç»å¸¸å˜æ›´ï¼Œä»£ç å†—ä½™ç¨‹åº¦è¾ƒé«˜ï¼Œç»´æŠ¤ç¨‹åº¦å›°éš¾ç­‰ï¼‰ï¼›é€šè¿‡å®é™…è°ƒç ”ï¼Œå¯¹ä»£ç è¿›è¡Œäº†ä¼˜åŒ–ï¼Œåç»­çš„ä¸€ä¸ªæ•ˆæœã€‚</li></ul></li><li>2ã€çº¿ä¸Š Bug<ul><li>åœ¨çº¿ä¸Šå‡ºç°äº†ï¼šCPU é£™é«˜ã€å†…å­˜æ³„æ¼ã€çº¿ç¨‹æ­»é”â€¦ ç­‰</li><li>å¯èƒ½æƒ…å†µæ˜¯ï¼š<ul><li>æµ‹è¯•ç¯å¢ƒæ²¡é—®é¢˜ï¼Œç”Ÿäº§ä¸Šçº¿åå‡ºçš„é—®é¢˜ï¼Œä¸”é—®é¢˜ä¸å¥½åœ¨æµ‹è¯•ç¯å¢ƒå¤ç°</li><li>ç”Ÿäº§ä¸Šçº¿åˆæœŸæ²¡é—®é¢˜ï¼Œä¸Šçº¿ä¸€ä¸¤ä¸ªæœˆåå‡ºç°è¿™ç§é—®é¢˜</li></ul></li><li>è¿™ç§æƒ…å†µéœ€è¦çº¿ä¸Šè°ƒè¯•å’Œæ’æŸ¥ï¼ˆé€šè¿‡è¿™ç§é—®é¢˜åé¦ˆä½ çš„å®é™…å¤„ç†ç»éªŒå’Œå¤ç›˜ï¼Œå½“æ—¶æ˜¯å¦‚ä½•æ“ä½œçš„ï¼‰</li></ul></li><li>3ã€è°ƒä¼˜<ul><li>æ…¢æ¥å£ã€æ…¢SQLã€ç¼“å†²æ–¹æ¡ˆ â€¦ ç­‰</li><li>å¯ä»¥å°†ä½ çš„å®é™…æ“ä½œï¼ŒåŒ…æ‹¬å¦‚ä½•æ’æŸ¥å‡ºè¿™ä¸ªæ¥å£çš„å¤„ç†é€Ÿåº¦æ…¢ï¼Œä»å¤šå°‘ç§’è°ƒä¼˜åˆ°äº†å¤šå°‘ ms è¿™ç§ç¨‹åº¦ã€‚</li></ul></li><li>4ã€ç»„ä»¶å°è£…ï¼ˆä¸å»ºè®®ï¼Œä¸€èˆ¬æ˜¯é«˜çº§å·¥ç¨‹å¸ˆæ“ä½œï¼‰</li></ul><h3 id="ç³»ç»Ÿç™»å½•"><a href="#ç³»ç»Ÿç™»å½•" class="headerlink" title="ç³»ç»Ÿç™»å½•"></a>ç³»ç»Ÿç™»å½•</h3><h4 id="åˆ†å¸ƒå¼è®¤è¯æˆæƒ"><a href="#åˆ†å¸ƒå¼è®¤è¯æˆæƒ" class="headerlink" title="åˆ†å¸ƒå¼è®¤è¯æˆæƒ"></a>åˆ†å¸ƒå¼è®¤è¯æˆæƒ</h4><p>å‚è€ƒï¼š <a href="https://www.bilibili.com/video/BV1nG4y1d7mf">https://www.bilibili.com/video/BV1nG4y1d7mf</a></p><ul><li><a href="https://www.bilibili.com/video/BV17D4y1Y76o">https://www.bilibili.com/video/BV17D4y1Y76o</a></li></ul><h4 id="è®²ä¸€ä¸‹å•ç‚¹ç™»é™†çš„å®ç°"><a href="#è®²ä¸€ä¸‹å•ç‚¹ç™»é™†çš„å®ç°" class="headerlink" title="è®²ä¸€ä¸‹å•ç‚¹ç™»é™†çš„å®ç°"></a>è®²ä¸€ä¸‹å•ç‚¹ç™»é™†çš„å®ç°</h4><p>å•ç‚¹ç™»å½•çš„è‹±æ–‡åå«åšï¼šSingle Sign On(ç®€ç§°SSO),åªéœ€è¦ç™»å½•ä¸€æ¬¡ï¼Œå°±å¯ä»¥è®¿é—®æ‰€æœ‰ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿ</p><p>åœ¨å•ä¸ª tomcat ä¸­ï¼Œsession æ˜¯å…±äº«çš„ï¼Œä½†æ˜¯åœ¨å¤šä¸ª tomcat æœåŠ¡ä¸­ï¼Œsession æ˜¯ä¸å…±äº«çš„ï¼›</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆæœ‰ï¼šJWT (å¸¸è§)ã€OAuth2ã€CAS ï¼ˆæ¡†æ¶ï¼‰</p><p>ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯ JWT çš„æ–¹å¼ï¼š</p><p>ç™»é™†æµç¨‹åˆ†æï¼š</p><ul><li>ç”¨æˆ·ç™»é™†<ul><li>ç”¨æˆ·å‘è®¤è¯æœåŠ¡å™¨å‘é€ç™»å½•è¯·æ±‚ï¼Œé€šå¸¸åŒ…æ‹¬ç”¨æˆ·åå’Œå¯†ç ã€‚</li><li>è®¤è¯æœåŠ¡å™¨éªŒè¯ç”¨æˆ·çš„èº«ä»½ã€‚å¦‚æœè®¤è¯æˆåŠŸï¼ŒæœåŠ¡å™¨ä¼šä½¿ç”¨ä¸€ä¸ªå¯†é’¥ç”Ÿæˆä¸€ä¸ªåŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·IDã€è§’è‰²ç­‰ï¼‰å’Œå…¶ä»–å£°æ˜çš„JWTã€‚ç„¶åï¼Œå°†è¿™ä¸ªJWTè¿”å›ç»™ç”¨æˆ·ã€‚</li></ul></li><li>è®¿é—®èµ„æº<ul><li>ç”¨æˆ·å¸¦ç€JWTè®¿é—®åº”ç”¨ä¸­çš„å—ä¿æŠ¤èµ„æºã€‚JWTé€šå¸¸åœ¨HTTPè¯·æ±‚çš„ Authorization å¤´ä¸­ä»¥Bearer tokençš„å½¢å¼å‘é€ã€‚</li><li>åº”ç”¨æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæå–JWTå¹¶éªŒè¯å®ƒçš„æœ‰æ•ˆæ€§ã€‚éªŒè¯åŒ…æ‹¬æ£€æŸ¥ç­¾åæ˜¯å¦æœ‰æ•ˆã€ä»¤ç‰Œæ˜¯å¦è¿‡æœŸç­‰ã€‚</li><li>å¦‚æœJWTéªŒè¯æˆåŠŸï¼ŒæœåŠ¡å™¨å°±ä¼šæ ¹æ®ä»¤ç‰Œä¸­çš„å£°æ˜å¤„ç†è¯·æ±‚ï¼Œæ¯”å¦‚è¿”å›ç”¨æˆ·è¯·æ±‚çš„æ•°æ®ã€‚</li></ul></li><li>ä½¿ç”¨JWTè¿›è¡Œå•ç‚¹ç™»å½•<ul><li>åœ¨å•ç‚¹ç™»å½•ç³»ç»Ÿä¸­ï¼Œä¸€æ—¦ç”¨æˆ·åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ç™»å½•å¹¶è·å–äº†JWTï¼Œä»–ä»¬å°±å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªä»¤ç‰Œè®¿é—®ç³»ç»Ÿä¸­çš„å…¶ä»–åº”ç”¨ï¼Œè€Œæ— éœ€é‡æ–°ç™»å½•ã€‚ï¼ˆä¸€èˆ¬æ˜¯ç½‘å…³è¿›è¡ŒéªŒè¯ï¼Œé€šè¿‡åè®¿é—®å…·ä½“æœåŠ¡ï¼‰</li><li>å½“ç”¨æˆ·å°è¯•è®¿é—®å¦ä¸€ä¸ªåº”ç”¨æ—¶ï¼Œä»–ä»¬çš„æµè§ˆå™¨ä¼šå‘é€åŒ…å«åŒä¸€ä¸ªJWTçš„è¯·æ±‚ã€‚</li><li>ç¬¬äºŒä¸ªåº”ç”¨ä¹Ÿä¼šéªŒè¯JWTçš„æœ‰æ•ˆæ€§ã€‚å¦‚æœéªŒè¯é€šè¿‡ï¼Œç”¨æˆ·å°±å¯ä»¥è®¿é—®ç¬¬äºŒä¸ªåº”ç”¨çš„å—ä¿æŠ¤èµ„æºï¼Œå®ç°äº†å•ç‚¹ç™»å½•ã€‚</li></ul></li><li>JWT çš„åˆ·æ–°<ul><li>ä¸ºäº†å®‰å…¨èµ·è§ï¼ŒJWTé€šå¸¸ä¼šè®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ã€‚è®¤è¯æœåŠ¡å™¨å¯èƒ½ä¼šæä¾›ä¸€ä¸ªåˆ·æ–°ä»¤ç‰Œï¼ˆRefresh Tokenï¼‰æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨JWTè¿‡æœŸåï¼Œæ— éœ€é‡æ–°ç™»å½•å°±èƒ½è·å–ä¸€ä¸ªæ–°çš„JWTã€‚</li><li>ä¸€èˆ¬è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œéƒ½ä¼šå­˜æ”¾åœ¨å®¢æˆ·ç«¯çš„å†…å­˜ä¸­ï¼ˆä¸€ç§å¸¸è§çš„åšæ³•æ˜¯å°†åˆ·æ–°ä»¤ç‰Œå­˜å‚¨åœ¨HttpOnlyçš„Cookieä¸­ã€‚HttpOnly Cookieç”±äºæ— æ³•é€šè¿‡JavaScriptè®¿é—®ï¼‰</li><li>åœ¨å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šä»å­˜å‚¨ä¸­è·å–è®¿é—®ä»¤ç‰Œï¼Œå¹¶å°†å…¶æ”¾å…¥HTTPè¯·æ±‚çš„Authorizationå¤´ä¸­ï¼Œé€šå¸¸é‡‡ç”¨<code>Bearer &lt;token&gt;</code>çš„æ ¼å¼ã€‚</li></ul></li></ul><h4 id="è®²ä¸€ä¸‹-Jwt-çš„ç»„æˆï¼Œä½¿ç”¨-jwt-çš„ä¼˜åŠ¿æœ‰å“ªäº›"><a href="#è®²ä¸€ä¸‹-Jwt-çš„ç»„æˆï¼Œä½¿ç”¨-jwt-çš„ä¼˜åŠ¿æœ‰å“ªäº›" class="headerlink" title="è®²ä¸€ä¸‹ Jwt çš„ç»„æˆï¼Œä½¿ç”¨ jwt çš„ä¼˜åŠ¿æœ‰å“ªäº›"></a>è®²ä¸€ä¸‹ Jwt çš„ç»„æˆï¼Œä½¿ç”¨ jwt çš„ä¼˜åŠ¿æœ‰å“ªäº›</h4><h4 id="ç™»é™†æ³¨é”€æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œä¸ºä»€ä¹ˆä¸é€‚ç”¨-sesson-è€Œä½¿ç”¨-jwt"><a href="#ç™»é™†æ³¨é”€æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œä¸ºä»€ä¹ˆä¸é€‚ç”¨-sesson-è€Œä½¿ç”¨-jwt" class="headerlink" title="ç™»é™†æ³¨é”€æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œä¸ºä»€ä¹ˆä¸é€‚ç”¨ sesson è€Œä½¿ç”¨ jwt"></a>ç™»é™†æ³¨é”€æ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œä¸ºä»€ä¹ˆä¸é€‚ç”¨ sesson è€Œä½¿ç”¨ jwt</h4><h4 id="ä½¿ç”¨è´¦å·å¯†ç è®¿é—®æµç¨‹ï¼ˆJWT-æ–¹å¼ï¼‰"><a href="#ä½¿ç”¨è´¦å·å¯†ç è®¿é—®æµç¨‹ï¼ˆJWT-æ–¹å¼ï¼‰" class="headerlink" title="ä½¿ç”¨è´¦å·å¯†ç è®¿é—®æµç¨‹ï¼ˆJWT æ–¹å¼ï¼‰"></a>ä½¿ç”¨è´¦å·å¯†ç è®¿é—®æµç¨‹ï¼ˆJWT æ–¹å¼ï¼‰</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240330222111.png" alt="image.png"></p><h3 id="æƒé™æ§åˆ¶ï¼Œæ•°æ®å®‰å…¨"><a href="#æƒé™æ§åˆ¶ï¼Œæ•°æ®å®‰å…¨" class="headerlink" title="æƒé™æ§åˆ¶ï¼Œæ•°æ®å®‰å…¨"></a>æƒé™æ§åˆ¶ï¼Œæ•°æ®å®‰å…¨</h3><h4 id="ä½ ä»¬é¡¹ç›®ä¸­æƒé™è®¤è¯æ˜¯å¦‚ä½•å®ç°çš„"><a href="#ä½ ä»¬é¡¹ç›®ä¸­æƒé™è®¤è¯æ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="ä½ ä»¬é¡¹ç›®ä¸­æƒé™è®¤è¯æ˜¯å¦‚ä½•å®ç°çš„"></a>ä½ ä»¬é¡¹ç›®ä¸­æƒé™è®¤è¯æ˜¯å¦‚ä½•å®ç°çš„</h4><p>æœ€å¸¸è§çš„å°±æ˜¯ RBAC æ¨¡å‹æ¥æŒ‡å¯¼å®ç°æƒé™</p><p>RBAC(Role-Based Access Control)ï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œä¸€èˆ¬æ˜¯æœ‰3ä¸ªåŸºç¡€éƒ¨åˆ†ç»„æˆï¼šç”¨æˆ·ã€è§’è‰²ã€æƒé™ã€‚</p><p>å…·ä½“å®ç°</p><ul><li>5å¼ è¡¨ï¼ˆç”¨æˆ·è¡¨ã€è§’è‰²è¡¨ã€æƒé™è¡¨ã€ç”¨æˆ·è§’è‰²ä¸­é—´è¡¨ã€è§’è‰²æƒé™ä¸­é—´è¡¨ï¼‰</li><li>7å¼ è¡¨ï¼ˆç”¨æˆ·è¡¨ã€è§’è‰²è¡¨ã€æƒé™è¡¨ã€èœå•è¡¨ã€ç”¨æˆ·è§’è‰²ä¸­é—´è¡¨ã€è§’è‰²æƒé™ä¸­é—´è¡¨ã€æƒé™èœå•ä¸­é—´è¡¨ï¼‰</li></ul><p>å¸¸ç”¨çš„æƒé™æ§åˆ¶æ¡†æ¶ï¼šSpring security</p><h4 id="ä¸Šä¼ æ•°æ®çš„å®‰å…¨ä½ ä»¬æ˜¯å¦‚ä½•æ§åˆ¶çš„"><a href="#ä¸Šä¼ æ•°æ®çš„å®‰å…¨ä½ ä»¬æ˜¯å¦‚ä½•æ§åˆ¶çš„" class="headerlink" title="ä¸Šä¼ æ•°æ®çš„å®‰å…¨ä½ ä»¬æ˜¯å¦‚ä½•æ§åˆ¶çš„"></a>ä¸Šä¼ æ•°æ®çš„å®‰å…¨ä½ ä»¬æ˜¯å¦‚ä½•æ§åˆ¶çš„</h4><p>ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼ˆæˆ–å¯¹ç§°åŠ å¯†ï¼‰ï¼Œç»™å‰ç«¯ä¸€ä¸ªå…¬é’¥è®©ä»–æŠŠæ•°æ®åŠ å¯†åä¼ åˆ°åå°ï¼Œåå°è´Ÿè´£è§£å¯†åå¤„ç†æ•°æ®</p><ul><li>æ–‡ä»¶å¾ˆå¤§å»ºè®®ä½¿ç”¨å¯¹ç§°åŠ å¯†ï¼Œä¸è¿‡ä¸èƒ½ä¿å­˜æ•æ„Ÿä¿¡æ¯</li><li>æ–‡ä»¶è¾ƒå°ï¼Œè¦æ±‚å®‰å…¨æ€§é«˜ï¼Œå»ºè®®é‡‡ç”¨éå¯¹ç§°åŠ å¯†</li></ul><p>è€ƒè™‘æ•°æ®ä¼ è¾“çš„è¯ï¼Œå¯ä»¥ä»å¾ˆå¤šæ–¹é¢è€ƒè™‘ï¼Œä¸»è¦æ˜¯ä½ å½“åˆè€ƒè™‘çš„ç‚¹ï¼Œå½“æ—¶é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Œç„¶åé€šè¿‡ä»€ä¹ˆæ–¹å¼å»è§£å†³çš„ã€‚</p><ul><li>1ã€è€ƒè™‘æƒé™è®¤è¯</li><li>2ã€è€ƒè™‘æ–‡ä»¶ç±»å‹é™åˆ¶ï¼Œè€ƒè™‘å¤§å°é™åˆ¶</li><li>3ã€å†…å®¹æ£€æŸ¥ï¼ˆä¸å»ºè®®è¯´ï¼Œä¸å¤ªäº†è§£ï¼‰</li><li>4ã€ä½¿ç”¨å®‰å…¨è¿æ¥ <strong>HTTPS</strong> </li><li>5ã€ä¸Šé¢è¯´çš„æ•°æ®åŠ å¯†ï¼Œå¯ä»¥è°ˆä¸€ä¸‹å…³äºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„ä¸€äº›ç”¨æ³•ï¼Œå½“æ—¶æŠ€æœ¯é€‰å‹æ˜¯æ€ä¹ˆåšçš„ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©äº†ä½¿ç”¨è¿™ä¸€ç§åŠ å¯†ç®—æ³•ï¼ˆæå‰å‡†å¤‡ä¸€ä¸‹ï¼‰</li></ul><h3 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h3><h4 id="ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—æ˜¯æ€ä¹ˆé‡‡é›†çš„"><a href="#ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—æ˜¯æ€ä¹ˆé‡‡é›†çš„" class="headerlink" title="ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—æ˜¯æ€ä¹ˆé‡‡é›†çš„"></a>ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—æ˜¯æ€ä¹ˆé‡‡é›†çš„</h4><p>ä¸ºä»€ä¹ˆè¦é‡‡é›†æ—¥å¿—ï¼šæ—¥å¿—æ˜¯å®šä½ç³»ç»Ÿé—®é¢˜çš„é‡è¦æ‰‹æ®µï¼Œå¯ä»¥æ ¹æ®æ—¥å¿—ä¿¡æ¯å¿«é€Ÿå®šä½ç³»ç»Ÿä¸­çš„é—®é¢˜</p><p>ä¸€èˆ¬æ—¥å¿—çš„é‡‡é›†æ–¹æ¡ˆæœ‰ï¼š</p><ul><li>ELKï¼šå³Elasticsearchã€Logstash å’Œ Kibanaä¸‰ä¸ªè½¯ä»¶çš„é¦–å­—æ¯ï¼ˆä¸å»ºè®®å›ç­”è¿™ç§ï¼Œçœ‹ä½ é¡¹ç›®å®é™…ä½¿ç”¨æƒ…å†µï¼‰</li><li>å¸¸è§„é‡‡é›†ï¼šæŒ‰å¤©ä¿å­˜åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶</li></ul><h4 id="å¸¸è§æ—¥å¿—çš„å‘½ä»¤"><a href="#å¸¸è§æ—¥å¿—çš„å‘½ä»¤" class="headerlink" title="å¸¸è§æ—¥å¿—çš„å‘½ä»¤"></a>å¸¸è§æ—¥å¿—çš„å‘½ä»¤</h4><p>ä¸€èˆ¬æˆ‘ä»¬ä¼šåœ¨æ—¥å¿—é…ç½®æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚ logback é…ç½®ä¸­å®šä¹‰æ¯å¤©äº§ç”Ÿæ—¥å¿—å­˜æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­</p><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼š</p><ul><li>å®æ—¶ç›‘æ§æ—¥å¿—çš„å˜åŒ–<ul><li>å®æ—¶ç›‘æ§æŸä¸€ä¸ªæ—¥å¿—æ–‡ä»¶çš„å˜åŒ–ï¼š<code>tail -f xx.log</code></li><li>å®æ—¶ç›‘æ§æ—¥å¿—æœ€å100è¡Œæ—¥å¿—ï¼š<code>tail -n 100 -f xx.log</code><ul><li><ul><li><code>-n 100</code>ï¼šé¦–å…ˆæ˜¾ç¤º<code>xx.log</code>æ–‡ä»¶çš„æœ€å100è¡Œå†…å®¹ã€‚</li></ul></li><li><code>-f</code>ï¼šä¹‹åï¼Œéšç€<code>xx.log</code>æ–‡ä»¶çš„å¢é•¿ï¼Œæ–°æ·»åŠ çš„å†…å®¹ä¼šè¢«å®æ—¶æ˜¾ç¤ºã€‚</li></ul></li></ul></li><li>æŒ‰ç…§è¡Œå·å¥—è¯¢<ul><li>æŸ¥è¯¢æ—¥å¿—å°¾éƒ¨æœ€å100è¡Œæ—¥å¿—ï¼š<code>tail -n 100 xx.log</code></li><li>æŸ¥è¯¢æ—¥å¿—å¤´éƒ¨å¼€å§‹100è¡Œæ—¥å¿—ï¼š<code>head -n 100 xx.log</code></li><li>æŸ¥è¯¢æŸä¸€ä¸ªæ—¥å¿—è¡Œå·åŒºé—´ï¼š<ul><li>æŸ¥è¯¢100è¡Œè‡³200è¡Œçš„æ—¥å¿— <code>cat -n xx.log|tail -n +100|head -n 100</code></li></ul></li></ul></li><li>æŒ‰ç…§å…³é”®å­—æ‰¾æ—¥å¿—çš„ä¿¡æ¯<ul><li>æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä¸­åŒ…å«debugçš„æ—¥å¿—è¡Œå·ï¼š <code>cat -n xx.log|grep &quot;debug&quot; </code></li></ul></li><li>æŒ‰ç…§æ—¥æœŸæŸ¥è¯¢<ul><li><code>sed -n &#39;/2023-05-18 14:22:31.070/,/2023-05-18 14:27:14.158/p&#39; xx.log</code></li></ul></li><li>æ—¥å¿—å¤ªå¤šï¼Œå¤„ç†æ–¹å¼<ul><li>åˆ†é¡µæŸ¥è¯¢æ—¥å¿—ä¿¡æ¯ï¼š<code>cat -n xx.log|grep &quot;debug&quot; |more</code></li><li>ç­›é€‰è¿‡æ»¤ä»¥åï¼Œè¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ï¼š<code>cat -n xx.log|grep &quot;debug&quot; &gt; debg.txt </code></li></ul></li></ul><h4 id="æ­£å¸¸å¾®æœåŠ¡æ¥å£æŠ¥é”™å†™å…¥æ—¥å¿—æ˜¯æ€ä¹ˆæ“ä½œçš„"><a href="#æ­£å¸¸å¾®æœåŠ¡æ¥å£æŠ¥é”™å†™å…¥æ—¥å¿—æ˜¯æ€ä¹ˆæ“ä½œçš„" class="headerlink" title="æ­£å¸¸å¾®æœåŠ¡æ¥å£æŠ¥é”™å†™å…¥æ—¥å¿—æ˜¯æ€ä¹ˆæ“ä½œçš„"></a>æ­£å¸¸å¾®æœåŠ¡æ¥å£æŠ¥é”™å†™å…¥æ—¥å¿—æ˜¯æ€ä¹ˆæ“ä½œçš„</h4><h3 id="ç³»ç»Ÿè®¾è®¡"><a href="#ç³»ç»Ÿè®¾è®¡" class="headerlink" title="ç³»ç»Ÿè®¾è®¡"></a>ç³»ç»Ÿè®¾è®¡</h3><h4 id="æ¥å£å¹‚ç­‰"><a href="#æ¥å£å¹‚ç­‰" class="headerlink" title="æ¥å£å¹‚ç­‰"></a>æ¥å£å¹‚ç­‰</h4><ul><li><a href="https://www.bilibili.com/video/BV1Hg411n779">https://www.bilibili.com/video/BV1Hg411n779</a></li></ul><h4 id="å»ºè®®ä¸è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶"><a href="#å»ºè®®ä¸è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶" class="headerlink" title="å»ºè®®ä¸è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶"></a>å»ºè®®ä¸è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶</h4><p>å‚è€ƒï¼š <a href="https://www.bilibili.com/video/BV1g84y1s7DH">https://www.bilibili.com/video/BV1g84y1s7DH</a></p><h3 id="æ•°æ®åº“-ğŸš©"><a href="#æ•°æ®åº“-ğŸš©" class="headerlink" title="æ•°æ®åº“  ğŸš©"></a>æ•°æ®åº“  ğŸš©</h3><h4 id="ä¸€å¼ å·²ç»ç™¾ä¸‡çº§åˆ«æ•°æ®é‡çš„è¡¨ï¼Œéœ€è¦æ”¹ä¸€ä¸‹å­—æ®µç»“æ„æˆ–è€…ç´¢å¼•ï¼Œæœ‰ä»€ä¹ˆåˆé€‚çš„æ–¹å¼"><a href="#ä¸€å¼ å·²ç»ç™¾ä¸‡çº§åˆ«æ•°æ®é‡çš„è¡¨ï¼Œéœ€è¦æ”¹ä¸€ä¸‹å­—æ®µç»“æ„æˆ–è€…ç´¢å¼•ï¼Œæœ‰ä»€ä¹ˆåˆé€‚çš„æ–¹å¼" class="headerlink" title="ä¸€å¼ å·²ç»ç™¾ä¸‡çº§åˆ«æ•°æ®é‡çš„è¡¨ï¼Œéœ€è¦æ”¹ä¸€ä¸‹å­—æ®µç»“æ„æˆ–è€…ç´¢å¼•ï¼Œæœ‰ä»€ä¹ˆåˆé€‚çš„æ–¹å¼"></a>ä¸€å¼ å·²ç»ç™¾ä¸‡çº§åˆ«æ•°æ®é‡çš„è¡¨ï¼Œéœ€è¦æ”¹ä¸€ä¸‹å­—æ®µç»“æ„æˆ–è€…ç´¢å¼•ï¼Œæœ‰ä»€ä¹ˆåˆé€‚çš„æ–¹å¼</h4><h4 id="åˆ†è¡¨"><a href="#åˆ†è¡¨" class="headerlink" title="åˆ†è¡¨"></a>åˆ†è¡¨</h4><p>å‚è€ƒï¼š <a href="https://www.bilibili.com/video/BV1rg411x7zK">https://www.bilibili.com/video/BV1rg411x7zK</a></p><h4 id="è®²ä¸€ä¸‹ä½ å½“æ—¶æ°´å¹³åˆ†è¡¨é‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŠæ€ä¹ˆè§£å†³çš„"><a href="#è®²ä¸€ä¸‹ä½ å½“æ—¶æ°´å¹³åˆ†è¡¨é‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŠæ€ä¹ˆè§£å†³çš„" class="headerlink" title="è®²ä¸€ä¸‹ä½ å½“æ—¶æ°´å¹³åˆ†è¡¨é‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŠæ€ä¹ˆè§£å†³çš„"></a>è®²ä¸€ä¸‹ä½ å½“æ—¶æ°´å¹³åˆ†è¡¨é‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŠæ€ä¹ˆè§£å†³çš„</h4><h3 id="ç”Ÿäº§é—®é¢˜"><a href="#ç”Ÿäº§é—®é¢˜" class="headerlink" title="ç”Ÿäº§é—®é¢˜"></a>ç”Ÿäº§é—®é¢˜</h3><h4 id="ç”Ÿäº§é—®é¢˜æ€ä¹ˆæ’æŸ¥"><a href="#ç”Ÿäº§é—®é¢˜æ€ä¹ˆæ’æŸ¥" class="headerlink" title="ç”Ÿäº§é—®é¢˜æ€ä¹ˆæ’æŸ¥"></a>ç”Ÿäº§é—®é¢˜æ€ä¹ˆæ’æŸ¥</h4><p>å·²ç»ä¸Šçº¿çš„bugæ’æŸ¥çš„æ€è·¯ï¼š</p><ul><li>1,å…ˆåˆ†ææ—¥å¿—ï¼Œé€šå¸¸åœ¨ä¸šåŠ¡ä¸­éƒ½ä¼šæœ‰æ—¥å¿—çš„è®°å½•ï¼Œæˆ–è€…æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼Œæˆ–è€…æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åå®šä½é—®é¢˜</li><li>2, è¿œç¨‹debug(é€šå¸¸å…¬å¸çš„æ­£å¼ç¯å¢ƒï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰æ˜¯ä¸å…è®¸è¿œç¨‹debuglçš„ã€‚ä¸€èˆ¬è¿œç¨‹debugéƒ½æ˜¯å…¬å¸çš„æµ‹è¯•ç¯å¢ƒï¼Œæ–¹ä¾¿è°ƒè¯•ä»£ç )</li></ul><p>ä½¿ç”¨ IDEA è¿œç¨‹ Debug æœåŠ¡å™¨çš„ Jar åŒ…æ–¹æ³•å¯ä»¥çœ‹ä¸€ä¸‹ç›¸å…³æ•™ç¨‹ï¼ˆéœ€è¦æœ¬åœ°ä»£ç å’ŒæœåŠ¡å™¨æ‰“åŒ…Jarä»£ç ä¿æŒä¸€è‡´ï¼‰</p><p>å¯ä»¥å¤§æ¦‚è¯´ä¸€ä¸‹å…ˆæ—¥å¿—æ’æŸ¥ï¼Œç„¶åå†è¿›è¡Œæµ‹è¯•ç¯å¢ƒè¿œç¨‹ Debug è°ƒè¯•çœ‹å‡ºç°çš„é—®é¢˜ã€‚</p><h4 id="æ€ä¹ˆå¿«é€Ÿå®šä½ç³»ç»Ÿçš„ç“¶é¢ˆ"><a href="#æ€ä¹ˆå¿«é€Ÿå®šä½ç³»ç»Ÿçš„ç“¶é¢ˆ" class="headerlink" title="æ€ä¹ˆå¿«é€Ÿå®šä½ç³»ç»Ÿçš„ç“¶é¢ˆ"></a>æ€ä¹ˆå¿«é€Ÿå®šä½ç³»ç»Ÿçš„ç“¶é¢ˆ</h4><ul><li>å‹æµ‹ï¼ˆæ€§èƒ½æµ‹è¯•ï¼‰ï¼Œé¡¹ç›®ä¸Šçº¿ä¹‹å‰æµ‹è¯„ç³»ç»Ÿçš„å‹åŠ›<ul><li>å‹æµ‹ç›®çš„ï¼šç»™å‡ºç³»ç»Ÿå½“å‰çš„æ€§èƒ½çŠ¶å†µï¼›å®šä½ç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆæˆ–æ½œåœ¨æ€§èƒ½ç“¶é¢ˆ</li><li>æŒ‡æ ‡ï¼šå“åº”æ—¶é—´ã€QPSã€å¹¶å‘æ•°ã€ååé‡ã€CPUåˆ©ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€ç£ç›˜ IOã€é”™è¯¯ç‡</li><li>å‹æµ‹å·¥å…·ï¼šLoadRunnerã€Apache Jmeterâ€¦</li><li>åç«¯å·¥ç¨‹å¸ˆï¼šæ ¹æ®å‹æµ‹çš„ç»“æœè¿›è¡Œè§£å†³æˆ–è°ƒä¼˜ï¼ˆæ¥å£æ…¢ã€ä»£ç æŠ¥é”™ã€å¹¶å‘è¾¾ä¸åˆ°è¦æ±‚ï¼‰</li></ul></li><li>ç›‘æ§å·¥å…·ã€é“¾è·¯è¿½è¸ªå·¥å…·ï¼Œé¡¹ç›®ä¸Šçº¿ä¹‹åç›‘æ§<ul><li>ç›‘æ§å·¥å…·ï¼šPrometheus+Grafana</li><li>é“¾è·¯è¿½è¸ªå·¥å…·ï¼šskywalkingã€Zipkin</li></ul></li><li>çº¿ä¸Šè¯Šæ–­å·¥å…·Arthas (é˜¿å°”è¨æ–¯)ï¼Œé¡¹ç›®ä¸Šçº¿ä¹‹åç›‘æ§ã€æ’æŸ¥<ul><li>å®˜ç½‘ï¼š<a href="https://arthas.aliyun.com/">https://arthas.aliyun.com/</a></li><li>ä¸å»ºè®®è¯´ï¼Œä¸å¤ªäº†è§£çš„è¯ã€‚</li></ul></li></ul><p>ä¸€èˆ¬è¿˜æ˜¯å»ºè®®ä»å¦‚ä½•ç›‘æ§çº¿ä¸Šï¼Œæ’æŸ¥å‡ºå¯¹åº”çš„é—®é¢˜ï¼Œç„¶åå¦‚ä½•è§£å†³çš„å»å›ç­”ã€‚</p><h4 id="CPU-é£˜å‡å¦‚ä½•å®šä½åˆ°ä»£ç "><a href="#CPU-é£˜å‡å¦‚ä½•å®šä½åˆ°ä»£ç " class="headerlink" title="CPU é£˜å‡å¦‚ä½•å®šä½åˆ°ä»£ç "></a>CPU é£˜å‡å¦‚ä½•å®šä½åˆ°ä»£ç </h4><p>å‚è€ƒï¼š <a href="https://www.bilibili.com/video/BV1sP4y1F76s">https://www.bilibili.com/video/BV1sP4y1F76s</a></p><p>é¡¹ç›®ä¸Šçº¿ä¹‹åï¼ŒCpUé£™å‡ï¼Œå±…é«˜ä¸ä¸‹ã€‚è§¦å‘æŠ¥è­¦ã€‚æˆ‘ä»¬è¯¥å¦‚ä½•æ’æŸ¥é—®é¢˜æ‰€åœ¨ï¼Ÿ</p><p>ä¼ ç»Ÿçš„æŸ¥çœ‹æ—¥å¿—çš„æ–¹å¼</p><ul><li>1ã€top</li><li>2ã€ps -mp</li><li>3ã€tidè½¬æ¢</li><li>4ã€jstackæ‰“å°</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240511114041.png" alt="image.png"></p><p>æŸ¥çœ‹çº¿ç¨‹ä¸‹è¿›ç¨‹å ç”¨ CPU æƒ…å†µï¼ŒTID éœ€è¦è½¬æ¢ä¸º 16 è¿›åˆ¶ä¿¡æ¯</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240511114130.png" alt="image.png"></p><p>æ ¹æ® çº¿ç¨‹ PID å’Œè¿›ç¨‹ TID æŸ¥çœ‹åˆ°è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€æ—¥å¿—</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240511114249.png" alt="image.png"></p><p>æˆ–è€…ç«ç„°å›¾çš„æ–¹å¼</p><h4 id="çº¿ä¸ŠæœåŠ¡å†…å­˜æº¢å‡ºå¦‚ä½•æ’æŸ¥å®šä½"><a href="#çº¿ä¸ŠæœåŠ¡å†…å­˜æº¢å‡ºå¦‚ä½•æ’æŸ¥å®šä½" class="headerlink" title="çº¿ä¸ŠæœåŠ¡å†…å­˜æº¢å‡ºå¦‚ä½•æ’æŸ¥å®šä½"></a>çº¿ä¸ŠæœåŠ¡å†…å­˜æº¢å‡ºå¦‚ä½•æ’æŸ¥å®šä½</h4><ul><li>jmap (Memory Map for Java)å‘½ä»¤ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ã€‚å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„dumpæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤æ¥ç”Ÿæˆdumpæ–‡ä»¶ã€‚è¿˜å¯ä»¥ä½¿ç”¨JVMå‚æ•°æ¥é…ç½®è‡ªåŠ¨ç”Ÿæˆ</li><li>è‡ªåŠ¨ç”Ÿæˆ<ul><li>XX:+HeapDumpOnOutofMemoryError, å¯ä»¥è®©è™šæ‹Ÿæœºåœ¨OOMå¼‚å¸¸å‡ºç°ä¹‹åè‡ªåŠ¨ç”Ÿæˆdumpæ–‡ä»¶</li><li>-XX:HeapDumpPath&#x3D;pathè®¾ç½®dumpæ–‡ä»¶è·¯å¾„</li></ul></li><li>æ‰‹åŠ¨ç”Ÿæˆ<ul><li>jmap -dump:format&#x3D; b.file &#x3D; heap.hprof.pid</li></ul></li><li>jmap é™¤äº†ç”Ÿæˆdumpä¹Ÿå¯ä»¥çœ‹åˆ° jvmå †çš„æ•°æ®å ç”¨æƒ…å†µã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240511114445.png" alt="image.png"></p><p>æ ¹æ® è¿›ç¨‹ PID ç”Ÿæˆå¯¹åº”çš„ dump æ–‡ä»¶</p><p>ç”Ÿæˆçš„æ—¶å€™ï¼Œéœ€è¦å°†æµé‡å…³æ‰ï¼Œç”Ÿæˆ dump çš„è¿‡ç¨‹ä¸­æœåŠ¡ä¼šåœæ­¢ï¼Œä¸ä¼šå‘å¤–æä¾›æœåŠ¡</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240511115142.png" alt="image.png"></p><p>é€šè¿‡ MAT å·¥å…·è¿›è¡Œåˆ†æå¤„ç†</p><ul><li>è¿›å…¥ä¸‹è½½åçš„æ–‡ä»¶å¤¹ï¼ŒåŒå‡» MemoryAnalyer.exe å¯åŠ¨ï¼Œè¿›è¡Œæ‰“å¼€ dump æ–‡ä»¶ï¼Œé€‰æ‹©å¯¹åº” dump.dat æ–‡ä»¶ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª Leak Suspect Reportsï¼Œç”Ÿæˆä¸€ä¸ªæŠ¥å‘Šæ“ä½œ</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240511115454.png" alt="image.png"></p><ul><li>é€‰æ‹© Dominator Tree</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240511115738.png" alt="image.png"></p><ul><li><p>è¿›å…¥ï¼ŒæŸ¥çœ‹å ç”¨å†…å­˜æƒ…å†µ<br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240511115912.png" alt="image.png"></p></li><li><p>å³é”®æŸ¥çœ‹ â†’  Java Basics â†’ Thread Overview and Stacks  æŸ¥çœ‹çº¿ç¨‹ä»¥å†…çš„æƒ…å†µ</p></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240511120031.png" alt="image.png"></p><blockquote><p>VisualVM å·¥å…·</p></blockquote><p>ç”Ÿæˆ dump æ–‡ä»¶ï¼š</p><ul><li>ä¸€èˆ¬æ˜¯è®¾ç½® JVM å‚æ•°ï¼Œæœ‰æ—¶å€™ç¨‹åºæ˜¯ç›´æ¥é—ªé€€æŒ‚äº†ï¼Œä¸å¤ªå¯èƒ½è®©ä½ è¿è¡Œçš„æ—¶å€™ä½¿ç”¨  jmap å‘½ä»¤ï¼ˆä½¿ç”¨ vm å‚æ•°è·å– dump æ–‡ä»¶ï¼‰</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305184231.png" alt="image.png"></p><p>åˆ†æ dump æ–‡ä»¶</p><ul><li>1ã€æ‰“å¼€ VisualVM</li><li>2ã€é€‰æ‹©ï¼šæ–‡ä»¶ â†’  è£…å…¥  â†’  ï¼ˆé€‰æ‹©æ–‡ä»¶ï¼‰ â†’  æ‰“å¼€</li><li>3ã€æ¦‚è¦  â†’  å †è½¬å‚¨</li><li>4ã€é€šè¿‡æŸ¥çœ‹å †ä¿¡æ¯çš„æƒ…å†µï¼Œå¯ä»¥å¤§æ¦‚å®šä½å†…å­˜è°¥å‡ºæ˜¯å“ªè¡Œä»£ç å‡ºäº†é—®é¢˜</li></ul><h3 id="ä¸šåŠ¡é—®é¢˜"><a href="#ä¸šåŠ¡é—®é¢˜" class="headerlink" title="ä¸šåŠ¡é—®é¢˜"></a>ä¸šåŠ¡é—®é¢˜</h3><h4 id="åº“å­˜æ‰£å‡é—®é¢˜"><a href="#åº“å­˜æ‰£å‡é—®é¢˜" class="headerlink" title="åº“å­˜æ‰£å‡é—®é¢˜"></a>åº“å­˜æ‰£å‡é—®é¢˜</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312113836.png" alt="image.png"></p><h4 id="ä½¿ç”¨-websocket-è¿›è¡Œå‰åç«¯-http-é•¿è¿æ¥æ“ä½œ"><a href="#ä½¿ç”¨-websocket-è¿›è¡Œå‰åç«¯-http-é•¿è¿æ¥æ“ä½œ" class="headerlink" title="ä½¿ç”¨ websocket è¿›è¡Œå‰åç«¯ http é•¿è¿æ¥æ“ä½œ"></a>ä½¿ç”¨ websocket è¿›è¡Œå‰åç«¯ http é•¿è¿æ¥æ“ä½œ</h4><h4 id="socket-ç›‘å¬ï¼Œå®æ—¶æ¨é€ç«™ç‚¹è½¦è¾†ä¿¡æ¯åˆ°å‰ç«¯ç•Œé¢"><a href="#socket-ç›‘å¬ï¼Œå®æ—¶æ¨é€ç«™ç‚¹è½¦è¾†ä¿¡æ¯åˆ°å‰ç«¯ç•Œé¢" class="headerlink" title="socket ç›‘å¬ï¼Œå®æ—¶æ¨é€ç«™ç‚¹è½¦è¾†ä¿¡æ¯åˆ°å‰ç«¯ç•Œé¢"></a>socket ç›‘å¬ï¼Œå®æ—¶æ¨é€ç«™ç‚¹è½¦è¾†ä¿¡æ¯åˆ°å‰ç«¯ç•Œé¢</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240330230550.png" alt="image.png"></p><h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h3><h4 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h4><p>å‚è€ƒçœ‹ä¸€ä¸‹ï¼š <a href="https://blog.csdn.net/qq_40851232/article/details/134402593?spm=1001.2014.3001.5502">https://blog.csdn.net/qq_40851232/article/details/134402593?spm=1001.2014.3001.5502</a></p><p>[[é¢è¯•ç…ç†¬æˆè›‹_æ€§èƒ½ä¼˜åŒ–]]</p><p>é¡¹ç›®äº®ç‚¹</p>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_è®¾è®¡æ¨¡å¼</title>
    <link href="/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <url>/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>é—®æ³•ï¼šæ¡†æ¶ä¸­çš„è®¾è®¡æ¨¡å¼ã€é¡¹ç›®ä¸­çš„è®¾è®¡æ¨¡å¼</p><p>æœ‰ç©ºæ•´åˆä¸€ä¸‹ [[ç¼–ç¨‹_è®¾è®¡æ¨¡å¼]]</p><h4 id="å·¥å‚è®¾è®¡æ¨¡å¼"><a href="#å·¥å‚è®¾è®¡æ¨¡å¼" class="headerlink" title="å·¥å‚è®¾è®¡æ¨¡å¼"></a>å·¥å‚è®¾è®¡æ¨¡å¼</h4><p>è®²ä¸€ä¸‹å·¥å‚è®¾è®¡æ¨¡å¼ï¼Œä½ åœ¨é¡¹ç›®ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„</p><p>å·¥å‚è®¾è®¡æ¨¡å¼ä¸»è¦ç”¨äºåˆ›å»ºå¯¹è±¡ï¼Œå°¤å…¶æ˜¯åœ¨åˆ›å»ºå¯¹è±¡çš„é€»è¾‘æ¯”è¾ƒå¤æ‚æ—¶ï¼Œå¯ä»¥å°†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>å·¥å‚æ¨¡å¼ä¸»è¦æœ‰ä¸‰ç§å˜ä½“ï¼š</p><ul><li>ç®€å•å·¥å‚æ¨¡å¼</li><li>å·¥å‚æ–¹æ³•æ¨¡å¼</li><li>æŠ½è±¡å·¥å‚æ¨¡å¼</li></ul><hr><p>æœ‰ç©ºå¯ä»¥ç³»ç»ŸåŒ–å­¦ä¹ ä¸€ä¸‹è®¾è®¡æ¨¡å¼ç›¸å…³çš„å†…å®¹ï¼ŒåŒ…æ‹¬ç¬¦å·è¡¨ç¤ºå’Œåˆ›å»ºå‹ xxx ç­‰æ¦‚å¿µã€‚(è½¯ä»¶å·¥å‚ä½“ç³»å†…å®¹)</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240302202206.png" alt="image.png"></p><h5 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h5><p>ç®€å•å·¥å‚æ¨¡å¼åˆå«é™æ€å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå°±æ˜¯å»ºç«‹ä¸€ä¸ªå·¥å‚ç±»ï¼Œå¯¹å®ç°äº†åŒä¸€æ¥å£çš„ä¸€äº›ç±»è¿›è¡Œ å®ä¾‹çš„åˆ›å»º</p><p>æ¥å£ â†’ ä¸åŒå®ç°ç±»  â†’  åˆ›å»ºäº¤ç»™å·¥å‚ç±»</p><blockquote><ol><li>ç®€å•å·¥å‚æ¨¡å¼ï¼ˆSimple Factoryï¼‰</li></ol></blockquote><p>ç®€å•å·¥å‚æ¨¡å¼å¹¶ä¸æ˜¯GoFï¼ˆå››äººå¸®ï¼‰å®šä¹‰çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œä½†å®ƒæ˜¯å·¥å‚æ¨¡å¼çš„ä¸€ç§ç®€åŒ–ï¼Œä¸»è¦ç”¨äºåˆ›å»ºåŒä¸€ç±»å¯¹è±¡ã€‚</p><ul><li><strong>ç»“æ„</strong>ï¼šä¸€ä¸ªå·¥å‚ç±»æ ¹æ®ä¼ å…¥çš„å‚æ•°ï¼Œå†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šå°†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå·¥å‚ç±»çš„èŒè´£ç›¸å¯¹è¿‡é‡ï¼Œå¢åŠ æ–°çš„äº§å“æ—¶éœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„é€»è¾‘ï¼Œè¿åäº†å¼€é—­åŸåˆ™ã€‚</li></ul><p>ç¤ºä¾‹ï¼šè¿™é‡Œç»™å‡ºä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼çš„Javaä»£ç ç¤ºä¾‹ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªæ—¥å¸¸é¡¹ç›®ä¸­å¯èƒ½é‡åˆ°çš„åœºæ™¯ï¼šæ ¹æ®ä¸åŒçš„æ—¥å¿—ç±»å‹ï¼ˆå¦‚æ–‡ä»¶æ—¥å¿—ã€æ•°æ®åº“æ—¥å¿—ï¼‰åˆ›å»ºä¸åŒçš„æ—¥å¿—è®°å½•å™¨ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªæ—¥å¿—è®°å½•å™¨æ¥å£ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">Logger</span> &#123;<br>    <span class="hljs-built_in">void</span> log(String message);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œå®ç°å…·ä½“çš„æ—¥å¿—è®°å½•å™¨ç±»ï¼Œå¦‚æ–‡ä»¶æ—¥å¿—è®°å½•å™¨å’Œæ•°æ®åº“æ—¥å¿—è®°å½•å™¨ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileLogger</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Logger</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message</span>) &#123;<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">&quot;Logging to a file: &quot;</span> + message);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseLogger</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Logger</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message</span>) &#123;<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">&quot;Logging to a database: &quot;</span> + message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºç®€å•å·¥å‚ç±»ï¼Œç”¨äºæ ¹æ®æ—¥å¿—ç±»å‹åˆ›å»ºå…·ä½“çš„æ—¥å¿—è®°å½•å™¨å¯¹è±¡ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerFactory</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">Logger</span> <span class="hljs-title function_">getLogger</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> <span class="hljs-keyword">type</span></span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span>.<span class="hljs-title function_">equalsIgnoreCase</span>(<span class="hljs-string">&quot;FILE&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileLogger</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span>.<span class="hljs-title function_">equalsIgnoreCase</span>(<span class="hljs-string">&quot;DATABASE&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatabaseLogger</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è¿™ä¸ªç®€å•å·¥å‚æ¥åˆ›å»ºå¹¶ä½¿ç”¨ä¸åŒç±»å‹çš„æ—¥å¿—è®°å½•å™¨ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleFactoryDemo</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br>        Logger fileLogger = LoggerFactory.<span class="hljs-built_in">getLogger</span>(<span class="hljs-string">&quot;FILE&quot;</span>);<br>        fileLogger.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;This is a message to log in a file.&quot;</span>);<br><br>        Logger databaseLogger = LoggerFactory.<span class="hljs-built_in">getLogger</span>(<span class="hljs-string">&quot;DATABASE&quot;</span>);<br>        databaseLogger.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;This is a message to log in a database.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¤ºä¾‹ä»£ç çš„æ ¸å¿ƒï¼šå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨åˆ†ç¦»</p><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>LoggerFactory</code>ç±»æ ¹æ®ä¼ å…¥çš„æ—¥å¿—ç±»å‹å‚æ•°ï¼ˆâ€FILEâ€æˆ–â€DATABASEâ€ï¼‰å†³å®šåˆ›å»ºå¹¶è¿”å›å“ªç§ç±»å‹çš„<code>Logger</code>å®ä¾‹ã€‚<br>è¿™æ ·ï¼Œå½“éœ€è¦å¢åŠ æ–°çš„æ—¥å¿—ç±»å‹æ—¶ï¼Œåªéœ€æ·»åŠ æ–°çš„<code>Logger</code>å®ç°ç±»å¹¶ä¿®æ”¹<code>LoggerFactory</code>ç±»å³å¯ï¼Œè€Œä½¿ç”¨æ—¥å¿—è®°å½•å™¨çš„å®¢æˆ·ç«¯ä»£ç ä¸éœ€è¦ä»»ä½•æ”¹åŠ¨ã€‚</p><h5 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h5><blockquote><ol start="2"><li>å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰</li></ol></blockquote><p>å·¥å‚æ–¹æ³•æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„ç±»æ˜¯å“ªä¸€ä¸ªã€‚å·¥å‚æ–¹æ³•è®©ç±»çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ä¸­è¿›è¡Œã€‚</p><ul><li><strong>ç»“æ„</strong>ï¼šå®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±å®ç°è¿™ä¸ªæ¥å£çš„ç±»æ¥å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ–¹æ³•è®©ç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šåœ¨æ·»åŠ æ–°äº§å“æ—¶ä¸éœ€è¦ä¿®æ”¹å·²æœ‰çš„å·¥å‚ç±»ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ¯å¢åŠ ä¸€ä¸ªäº§å“ï¼Œå°±éœ€è¦å¢åŠ ä¸€ä¸ªå…·ä½“ç±»å’Œå¯¹è±¡å®ç°å·¥å‚ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚</li></ul><p>ç¤ºä¾‹ä½¿ç”¨ï¼š</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„æ–‡ä»¶ç±»å‹ï¼ˆå¦‚æ–‡æœ¬æ–‡ä»¶ã€å›¾åƒæ–‡ä»¶ï¼‰æ¥å¤„ç†æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ç§æ–‡ä»¶ç±»å‹å®šä¹‰ä¸€ä¸ªå¤„ç†å™¨ï¼Œå¹¶ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼æ¥åˆ›å»ºç›¸åº”çš„æ–‡ä»¶å¤„ç†å™¨ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ª<code>FileProcessor</code>æ¥å£å’Œå‡ ä¸ªå®ç°è¿™ä¸ªæ¥å£çš„ç±»ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// FileProcessoræ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FileProcessor</span> &#123;<br>    <span class="hljs-built_in">void</span> <span class="hljs-title function_">process</span>(<span class="hljs-title class_">String</span> fileName);<br>&#125;<br><br><span class="hljs-comment">// æ–‡æœ¬æ–‡ä»¶å¤„ç†å™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextFileProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FileProcessor</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">process</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> fileName</span>) &#123;<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">&quot;Processing text file: &quot;</span> + fileName);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å›¾åƒæ–‡ä»¶å¤„ç†å™¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageFileProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FileProcessor</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">process</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> fileName</span>) &#123;<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">&quot;Processing image file: &quot;</span> + fileName);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼Œå®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„å·¥å‚ç±»ï¼Œä»¥åŠå…·ä½“çš„å·¥å‚ç±»æ¥å®ç°è¿™ä¸ªæ¥å£ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// æŠ½è±¡å·¥å‚ç±»</span><br>public <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileProcessorFactory</span> </span>&#123;<br>    <span class="hljs-comment">// å·¥å‚æ–¹æ³•</span><br>    public <span class="hljs-keyword">abstract</span> <span class="hljs-type">FileProcessor</span> createProcessor();<br>&#125;<br><br><span class="hljs-comment">// æ–‡æœ¬æ–‡ä»¶å¤„ç†å™¨å·¥å‚</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextFileProcessorFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FileProcessorFactory</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    public <span class="hljs-type">FileProcessor</span> createProcessor() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">TextFileProcessor</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å›¾åƒæ–‡ä»¶å¤„ç†å™¨å·¥å‚</span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageFileProcessorFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FileProcessorFactory</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    public <span class="hljs-type">FileProcessor</span> createProcessor() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">ImageFileProcessor</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œä½¿ç”¨è¿™äº›å·¥å‚æ¥åˆ›å»ºå¹¶ä½¿ç”¨æ–‡ä»¶å¤„ç†å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FactoryMethodDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">FileProcessorFactory</span> <span class="hljs-variable">textFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextFileProcessorFactory</span>();<br>        <span class="hljs-type">FileProcessor</span> <span class="hljs-variable">textProcessor</span> <span class="hljs-operator">=</span> textFactory.createProcessor();<br>        textProcessor.process(<span class="hljs-string">&quot;document.txt&quot;</span>);<br><br>        <span class="hljs-type">FileProcessorFactory</span> <span class="hljs-variable">imageFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageFileProcessorFactory</span>();<br>        <span class="hljs-type">FileProcessor</span> <span class="hljs-variable">imageProcessor</span> <span class="hljs-operator">=</span> imageFactory.createProcessor();<br>        imageProcessor.process(<span class="hljs-string">&quot;image.png&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>FileProcessorFactory</code>æ˜¯ä¸€ä¸ªæŠ½è±¡çš„å·¥å‚ç±»ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡çš„<code>createProcessor</code>æ–¹æ³•ã€‚<code>TextFileProcessorFactory</code>å’Œ<code>ImageFileProcessorFactory</code>æ˜¯å…·ä½“çš„å·¥å‚ç±»ï¼Œå®ƒä»¬å®ç°äº†<code>createProcessor</code>æ–¹æ³•æ¥åˆ›å»ºå…·ä½“ç±»å‹çš„æ–‡ä»¶å¤„ç†å™¨ã€‚<br>è¿™æ ·ï¼Œå½“æˆ‘ä»¬éœ€è¦å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨ç›¸åº”ç±»å‹çš„å·¥å‚å®ä¾‹æ¥åˆ›å»ºå¤„ç†å™¨ï¼Œè€Œä¸éœ€è¦ç›´æ¥å®ä¾‹åŒ–å¤„ç†å™¨å¯¹è±¡ã€‚</p><p>ä½¿ç”¨æ–¹æ³•å’Œç®€å•å·¥å‚æ¨¡å¼ç±»ä¼¼ï¼Œä¸è¿‡åŒºåˆ«æ˜¯ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼æ¯å¢åŠ ä¸€ä¸ªäº§å“ï¼Œå°±éœ€è¦å¢åŠ ä¸€ä¸ªå…·ä½“ç±»å’Œå¯¹è±¡å®ç°å·¥å‚ã€‚</p><hr><h5 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h5><p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯åœ¨ç®€å•å·¥å‚çš„åŸºç¡€ä¸Šå°†æœªæ¥å¯èƒ½éœ€è¦ä¿®æ”¹çš„ä»£ç æŠ½è±¡å‡ºæ¥ï¼Œé€šè¿‡ç»§æ‰¿çš„æ–¹å¼è®© å­ç±»å»åšå†³å®šã€‚</p><p>æ¥å£ â†’ ä¸åŒå®ç°ç±» </p><p>æŠ½è±¡å·¥å‚ï¼ˆå®šä¹‰ç»Ÿä¸€è¡Œä¸ºï¼‰ â†’  å®ç°ç±»å·¥å‚ï¼ˆä¸åŒæ¥å£æ–¹æ³•ç»„åˆï¼‰ â†’ å­ç±»å†³å®šå®ä¾‹åŒ–å…·ä½“ç±»</p><p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„å¯¹è±¡ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚è¿™ç§æ¨¡å¼é€šè¿‡å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºä¸€ç»„å¯¹è±¡çš„æ¥å£ï¼ˆæŠ½è±¡å·¥å‚ï¼‰ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å…·ä½“ç±»ã€‚</p><blockquote><ol start="3"><li>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factoryï¼‰</li></ol></blockquote><p>æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºç›¸å…³çš„å¯¹è±¡å®¶æ—ï¼Œè€Œä¸éœ€è¦æ˜ç¡®æŒ‡å®šå…·ä½“ç±»ã€‚</p><ul><li><strong>ç»“æ„</strong>ï¼šå¤šä¸ªæŠ½è±¡äº§å“ç±»ï¼Œæ¯ä¸ªæŠ½è±¡äº§å“ç±»å¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“äº§å“ç±»ï¼›ä¸€ä¸ªæŠ½è±¡å·¥å‚ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºå¤šä¸ªå…·ä½“å·¥å‚ç±»ï¼Œæ¯ä¸ªå…·ä½“å·¥å‚ç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå…·ä½“äº§å“ç±»çš„å®ä¾‹ï¼Œä¸åŒçš„å·¥å‚ç±»äº’ä¸å½±å“ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½å¤Ÿç¡®ä¿å®¢æˆ·ç«¯ä½¿ç”¨çš„æ˜¯åŒä¸€å®¶æ—çš„äº§å“ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå½“äº§å“å®¶æ—ä¸­éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„äº§å“æ—¶ï¼Œæ‰€æœ‰çš„å·¥å‚ç±»éƒ½éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚</li></ul><p>ç¤ºä¾‹ï¼šå‡è®¾æˆ‘ä»¬éœ€è¦åˆ›å»ºè·¨å¹³å°çš„UIå…ƒç´ ï¼Œä¾‹å¦‚æŒ‰é’®å’Œå¤é€‰æ¡†ï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿï¼ˆå¦‚Windowså’ŒMacï¼‰æœ‰ä¸åŒé£æ ¼çš„UIå…ƒç´ å®ç°ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰æŠ½è±¡äº§å“æ¥å£åŠå…¶å…·ä½“å®ç°ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// æŠ½è±¡äº§å“ - æŒ‰é’®</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title">Button</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">paint</span>()</span>;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“äº§å“ - WindowsæŒ‰é’®</span><br><span class="hljs-keyword">class</span> <span class="hljs-title">WindowsButton</span> <span class="hljs-title">implements</span> <span class="hljs-title">Button</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">paint</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Render a button in a Windows style.&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“äº§å“ - MacæŒ‰é’®</span><br><span class="hljs-keyword">class</span> <span class="hljs-title">MacButton</span> <span class="hljs-title">implements</span> <span class="hljs-title">Button</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">paint</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Render a button in a Mac style.&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æŠ½è±¡äº§å“ - å¤é€‰æ¡†</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title">Checkbox</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">paint</span>()</span>;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“äº§å“ - Windowså¤é€‰æ¡†</span><br><span class="hljs-keyword">class</span> <span class="hljs-title">WindowsCheckbox</span> <span class="hljs-title">implements</span> <span class="hljs-title">Checkbox</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">paint</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Render a checkbox in a Windows style.&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“äº§å“ - Macå¤é€‰æ¡†</span><br><span class="hljs-keyword">class</span> <span class="hljs-title">MacCheckbox</span> <span class="hljs-title">implements</span> <span class="hljs-title">Checkbox</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">paint</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Render a checkbox in a Mac style.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰æŠ½è±¡å·¥å‚æ¥å£åŠå…¶å…·ä½“å®ç°ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// æŠ½è±¡å·¥å‚</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title">GUIFactory</span> &#123;<br>    <span class="hljs-function">Button <span class="hljs-title">createButton</span>()</span>;<br>    <span class="hljs-function">Checkbox <span class="hljs-title">createCheckbox</span>()</span>;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“å·¥å‚ - Windowså·¥å‚</span><br><span class="hljs-keyword">class</span> <span class="hljs-title">WindowsFactory</span> <span class="hljs-title">implements</span> <span class="hljs-title">GUIFactory</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Button <span class="hljs-title">createButton</span>()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WindowsButton();<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Checkbox <span class="hljs-title">createCheckbox</span>()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WindowsCheckbox();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“å·¥å‚ - Macå·¥å‚</span><br><span class="hljs-keyword">class</span> <span class="hljs-title">MacFactory</span> <span class="hljs-title">implements</span> <span class="hljs-title">GUIFactory</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Button <span class="hljs-title">createButton</span>()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MacButton();<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Checkbox <span class="hljs-title">createCheckbox</span>()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MacCheckbox();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œå®¢æˆ·ç«¯ä»£ç æ ¹æ®ä¸åŒçš„éœ€æ±‚åˆ›å»ºä¸åŒçš„UIå…ƒç´ ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractFactoryDemo</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">GUIFactory</span> factory;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">configure</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> osType</span>) &#123;<br>        <span class="hljs-keyword">if</span> (osType.<span class="hljs-title function_">equalsIgnoreCase</span>(<span class="hljs-string">&quot;Windows&quot;</span>)) &#123;<br>            factory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowsFactory</span>();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (osType.<span class="hljs-title function_">equalsIgnoreCase</span>(<span class="hljs-string">&quot;Mac&quot;</span>)) &#123;<br>            factory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MacFactory</span>();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Unknown operating system type.&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>        <span class="hljs-title function_">configure</span>(<span class="hljs-string">&quot;Windows&quot;</span>);<br><br>        <span class="hljs-title class_">Button</span> button = factory.<span class="hljs-title function_">createButton</span>();<br>        <span class="hljs-title class_">Checkbox</span> checkbox = factory.<span class="hljs-title function_">createCheckbox</span>();<br><br>        button.<span class="hljs-title function_">paint</span>();<br>        checkbox.<span class="hljs-title function_">paint</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæŠ½è±¡å·¥å‚<code>GUIFactory</code>æä¾›äº†åˆ›å»ºä¸€ç³»åˆ—äº§å“ï¼ˆæŒ‰é’®å’Œå¤é€‰æ¡†ï¼‰çš„æ¥å£ï¼Œè€Œ<code>WindowsFactory</code>å’Œ<code>MacFactory</code>å…·ä½“å®ç°äº†è¿™äº›æ¥å£ï¼Œåˆ†åˆ«åˆ›å»ºWindowsé£æ ¼å’ŒMacé£æ ¼çš„UIå…ƒç´ ã€‚</p><p>å®¢æˆ·ç«¯ä»£ç é€šè¿‡æŠ½è±¡å·¥å‚æ¥å£ä¸å…·ä½“å·¥å‚è§£è€¦ï¼Œä½¿å¾—åœ¨ä¸åŒç¯å¢ƒä¸‹å¯ä»¥çµæ´»åœ°æ›´æ¢å·¥å‚ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ã€‚</p><h4 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h4><blockquote><p>è®²ä¸€ä¸‹ç­–ç•¥æ¨¡å¼ï¼Œä½ åœ¨é¡¹ç›®ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„</p></blockquote><p>ç­–ç•¥æ¨¡å¼å®šä¹‰äº†ç®—æ³•æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚</p><ul><li><strong>ç»“æ„</strong>ï¼šä¸€ä¸ªç­–ç•¥æ¥å£ï¼Œå¤šä¸ªç­–ç•¥å®ç°ç±»ï¼›ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ç±»ï¼Œç”¨æ¥ç»´æŠ¤ä¸€ä¸ªç­–ç•¥å¯¹è±¡ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šç­–ç•¥æ¨¡å¼æä¾›äº†ç®¡ç†ç›¸å…³çš„ç®—æ³•æ—çš„æ–¹æ³•ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚</li></ul><p>ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰å…è®¸åœ¨è¿è¡Œæ—¶é€‰æ‹©ç®—æ³•çš„è¡Œä¸ºã€‚è¿™ç§æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸€ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–ã€‚</p><p>ä»¥ä¸‹æ˜¯ç­–ç•¥æ¨¡å¼çš„ä¸€ä¸ªå…·ä½“ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„æ”¯ä»˜ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿæ ¹æ®ä¸åŒçš„æ”¯ä»˜ç­–ç•¥ï¼ˆå¦‚ä¿¡ç”¨å¡æ”¯ä»˜ã€PayPalæ”¯ä»˜ï¼‰æ¥å¤„ç†æ”¯ä»˜ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰æ”¯ä»˜ç­–ç•¥æ¥å£å’Œå…·ä½“ç­–ç•¥ç±»ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// æ”¯ä»˜ç­–ç•¥æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PaymentStrategy</span> &#123;<br>    <span class="hljs-built_in">void</span> <span class="hljs-title function_">pay</span>(int amount);<br>&#125;<br><br><span class="hljs-comment">// ä¿¡ç”¨å¡æ”¯ä»˜ç­–ç•¥</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreditCardStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentStrategy</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> cardNumber;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">CreditCardStrategy</span>(<span class="hljs-title class_">String</span> name, <span class="hljs-title class_">String</span> cardNumber) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">cardNumber</span> = cardNumber;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">int amount</span>) &#123;<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(amount + <span class="hljs-string">&quot; paid with credit card.&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// PayPalæ”¯ä»˜ç­–ç•¥</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaypalStrategy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PaymentStrategy</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> emailId;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">PaypalStrategy</span>(<span class="hljs-title class_">String</span> email) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">emailId</span> = email;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">int amount</span>) &#123;<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(amount + <span class="hljs-string">&quot; paid using PayPal.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ç±»ï¼Œå®ƒå°†æ ¹æ®å®¢æˆ·é€‰æ‹©çš„æ”¯ä»˜ç­–ç•¥æ¥å¤„ç†æ”¯ä»˜ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ShoppingCart</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;Item&gt; items;<br>    <span class="hljs-keyword">private</span> PaymentStrategy paymentStrategy;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ShoppingCart</span>()</span> &#123;<br>        <span class="hljs-keyword">this</span>.items = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addItem</span>(<span class="hljs-params">Item item</span>)</span> &#123;<br>        <span class="hljs-keyword">this</span>.items.<span class="hljs-keyword">add</span>(item);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPaymentStrategy</span>(<span class="hljs-params">PaymentStrategy paymentStrategy</span>)</span> &#123;<br>        <span class="hljs-keyword">this</span>.paymentStrategy = paymentStrategy;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">calculateTotal</span>()</span> &#123;<br>        <span class="hljs-built_in">int</span> sum = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (Item item : items) &#123;<br>            sum += item.getPrice();<br>        &#125;<br>        <span class="hljs-keyword">return</span> sum;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">pay</span>()</span> &#123;<br>        <span class="hljs-built_in">int</span> amount = calculateTotal();<br>        paymentStrategy.pay(amount);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€åï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ä¸åŒçš„æ”¯ä»˜ç­–ç•¥æ¥å¤„ç†æ”¯ä»˜ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">StrategyPatternDemo</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) &#123;<br>        ShoppingCart cart = <span class="hljs-keyword">new</span> <span class="hljs-type">ShoppingCart</span>();<br>        cart.addItem(<span class="hljs-keyword">new</span> <span class="hljs-type">Item</span>(<span class="hljs-string">&quot;1234&quot;</span>, <span class="hljs-number">10</span>));<br>        cart.addItem(<span class="hljs-keyword">new</span> <span class="hljs-type">Item</span>(<span class="hljs-string">&quot;5678&quot;</span>, <span class="hljs-number">40</span>));<br><br>        <span class="hljs-comment">// ä½¿ç”¨ä¿¡ç”¨å¡æ”¯ä»˜</span><br>        cart.setPaymentStrategy(<span class="hljs-keyword">new</span> <span class="hljs-type">CreditCardStrategy</span>(<span class="hljs-string">&quot;John Doe&quot;</span>, <span class="hljs-string">&quot;1234567890123456&quot;</span>));<br>        cart.pay();<br><br>        <span class="hljs-comment">// æ”¹ç”¨PayPalæ”¯ä»˜</span><br>        cart.setPaymentStrategy(<span class="hljs-keyword">new</span> <span class="hljs-type">PaypalStrategy</span>(<span class="hljs-string">&quot;john.doe@example.com&quot;</span>));<br>        cart.pay();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>PaymentStrategy</code>æ¥å£å®šä¹‰äº†æ”¯ä»˜æ–¹æ³•ï¼Œ<code>CreditCardStrategy</code>å’Œ<code>PaypalStrategy</code>æ˜¯å…·ä½“çš„æ”¯ä»˜ç­–ç•¥å®ç°ã€‚<code>ShoppingCart</code>ç±»å…è®¸å®¢æˆ·æ·»åŠ å•†å“å¹¶è®¾ç½®æ”¯ä»˜ç­–ç•¥ã€‚åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è½»æ¾æ›´æ¢æ”¯ä»˜ç­–ç•¥ï¼Œæ— éœ€ä¿®æ”¹è´­ç‰©è½¦ä»£ç ã€‚è¿™æ ·ï¼Œç­–ç•¥æ¨¡å¼ä½¿å¾—ç®—æ³•å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯å˜åŒ–ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€åœ°åœ¨è¿è¡Œæ—¶æ”¹å˜ç®—æ³•ã€‚</p><hr><p>ä¸Šè¿°ç­–ç•¥æ¨¡å¼çš„åŸºç¡€ä½¿ç”¨æ˜¯é€šè¿‡å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç„¶åæ ¹æ®å®é™…çš„ä¸åŒè¡Œä¸ºæ¥è¿›è¡Œä¸åŒç­–ç•¥è¡Œä¸ºçš„å®ç°</p><p>ç­–ç•¥æ¥å£  â†’  ä¸åŒç­–ç•¥å®ç°ç±»ï¼ˆå¯¹åº”ä¸åŒè¡Œä¸ºå®ç°ï¼‰</p><p>ä¸€èˆ¬å¸¸ç”¨çš„æ“ä½œè¿˜å¯ä»¥ï¼š</p><ul><li>1ã€å®šä¹‰äº†ä¸€ä¸ªå…¬å…±æ¥å£ Aï¼Œé‡Œé¢å®šä¹‰äº†ä¸åŒçš„ç­–ç•¥æ¥å£ï¼ˆå…·ä½“æ˜¯å®ç°ä¼šäº¤ç»™æŠ½è±¡ç±»çš„å­ç±»ï¼‰</li><li>2ã€å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªæŠ½è±¡ç±»å®ç°äº†å…¬å…±æ¥å£ Aï¼Œå¹¶æä¾›ä¸€äº›å…¬å…±å‚æ•°å’Œæ–¹æ³•</li><li>3ã€å…·ä½“å®ç°ç±»ç»§æ‰¿æŠ½è±¡ç±»ï¼Œç„¶åå®ç°å…¬å…±æ¥å£ A ä¸­çš„æŸç§ç­–ç•¥ã€‚</li></ul><p>é€šè¿‡ä¸€ä¸ªä¸­è½¬çš„æŠ½è±¡ç±»ï¼Œå¯ç”¨åœ¨è¿™ä¸ªæŠ½è±¡ç±»ä¸­åŠ ä¸€äº›å…¬å…±çš„å†…å®¹ï¼Œå¯èƒ½å¯¹äºç­–ç•¥æ¨¡å¼çš„ä½¿ç”¨ä¹Ÿæ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„å€Ÿé‰´ã€‚</p><h4 id="æ¨¡æ¿æ¨¡å¼"><a href="#æ¨¡æ¿æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ¨¡å¼"></a>æ¨¡æ¿æ¨¡å¼</h4><p>æ¨¡æ¿æ¨¡å¼ä¸»è¦æ˜¯å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç„¶åè¿™ä¸ªæŠ½è±¡ç±»ä¸­çš„æ ¸å¿ƒæ–¹æ³•ä¸­ä¼šå®šä¹‰ä¸€ä¸ªæ—¢å®šçš„è¡Œä¸ºæ‰§è¡Œé¡ºåº</p><p>ç¤ºä¾‹ï¼š</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåˆ¶ä½œé¥®æ–™çš„è¿‡ç¨‹ï¼Œä¸åŒçš„é¥®æ–™ï¼ˆå¦‚å’–å•¡å’ŒèŒ¶ï¼‰åˆ¶ä½œè¿‡ç¨‹ä¸­çš„æŸäº›æ­¥éª¤ç›¸åŒï¼ˆæ¯”å¦‚ç…®æ²¸æ°´ï¼‰ï¼Œè€ŒæŸäº›æ­¥éª¤ä¸åŒï¼ˆå¦‚å†²æ³¡çš„åŸæ–™ä¸åŒï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ¥å®ç°ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// æŠ½è±¡ç±»</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Beverage</span> &#123;<br>    <span class="hljs-comment">// æ¨¡æ¿æ–¹æ³•ï¼Œåˆ¶ä½œé¥®æ–™çš„æ­¥éª¤</span><br>    <span class="hljs-function">final <span class="hljs-keyword">void</span> <span class="hljs-title">prepareRecipe</span>()</span> &#123;<br>        boilWater();<br>        brew();<br>        pourInCup();<br>        addCondiments();<br>    &#125;<br><br>    <span class="hljs-comment">// æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å®ç°</span><br>    <span class="hljs-function"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">brew</span>()</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCondiments</span>()</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">boilWater</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Boiling water&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pourInCup</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Pouring into cup&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“ç±»ï¼Œå’–å•¡</span><br><span class="hljs-keyword">class</span> <span class="hljs-title">Coffee</span> <span class="hljs-title">extends</span> <span class="hljs-title">Beverage</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">brew</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Dripping Coffee through filter&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addCondiments</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Adding Sugar and Milk&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å…·ä½“ç±»ï¼ŒèŒ¶</span><br><span class="hljs-keyword">class</span> <span class="hljs-title">Tea</span> <span class="hljs-title">extends</span> <span class="hljs-title">Beverage</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">brew</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Steeping the tea&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addCondiments</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Adding Lemon&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å®¢æˆ·ç«¯ä»£ç </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TemplateMethodDemo</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        Beverage tea = <span class="hljs-keyword">new</span> Tea();<br>        Beverage coffee = <span class="hljs-keyword">new</span> Coffee();<br><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Making tea...&quot;</span>);<br>        tea.prepareRecipe();<br><br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;\nMaking coffee...&quot;</span>);<br>        coffee.prepareRecipe();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç»„åˆæ¨¡å¼"><a href="#ç»„åˆæ¨¡å¼" class="headerlink" title="ç»„åˆæ¨¡å¼"></a>ç»„åˆæ¨¡å¼</h4><p>æ¯”è¾ƒé€‚åˆï¼šæ„å»ºæ ‘çŠ¶ç»“æ„çš„å¯¹è±¡ç»„åˆï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªç»„ä»¶æ¥å£ï¼Œç„¶ååœ¨ç»„åˆå¯¹è±¡ä¸­ä½¿ç”¨åˆ°äº†è¿™ä¸ªç»„ä»¶æ¥å£</p><p>ç¤ºä¾‹ï¼š</p><p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ ‘çŠ¶ç»“æ„ï¼Œå…¶ä¸­åŒ…å«æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚</p><p>å®šä¹‰ç»„ä»¶æ¥å£</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// ç»„ä»¶æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title">Component</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">showInfo</span>()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå¶å­å¯¹è±¡Â <code>File</code>ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// å¶å­å¯¹è±¡ - æ–‡ä»¶</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">File</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Component</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">File</span>(<span class="hljs-title class_">String</span> name) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">showInfo</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">&quot;File: &quot;</span> + name);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºç»„åˆå¯¹è±¡Â <code>Folder</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">// ç»„åˆå¯¹è±¡ - æ–‡ä»¶å¤¹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Folder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Component</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> List&lt;Component&gt; children = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Folder</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(Component component)</span> &#123;<br>        children.add(component);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(Component component)</span> &#123;<br>        children.remove(component);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showInfo</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Folder: &quot;</span> + name);<br>        <span class="hljs-keyword">for</span> (Component component : children) &#123;<br>            component.showInfo();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä»£ç ä½¿ç”¨</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs abnf">public class CompositePatternDemo &#123;<br>    public static void main(String[] args) &#123;<br>        File file1 <span class="hljs-operator">=</span> new File(<span class="hljs-string">&quot;file1.txt&quot;</span>)<span class="hljs-comment">;</span><br>        File file2 <span class="hljs-operator">=</span> new File(<span class="hljs-string">&quot;file2.txt&quot;</span>)<span class="hljs-comment">;</span><br>        Folder folder1 <span class="hljs-operator">=</span> new Folder(<span class="hljs-string">&quot;Folder 1&quot;</span>)<span class="hljs-comment">;</span><br>        folder1.add(file1)<span class="hljs-comment">;</span><br>        folder1.add(file2)<span class="hljs-comment">;</span><br><br>        File file3 <span class="hljs-operator">=</span> new File(<span class="hljs-string">&quot;file3.txt&quot;</span>)<span class="hljs-comment">;</span><br>        Folder folder2 <span class="hljs-operator">=</span> new Folder(<span class="hljs-string">&quot;Folder 2&quot;</span>)<span class="hljs-comment">;</span><br>        folder2.add(file3)<span class="hljs-comment">;</span><br><br>        Folder rootFolder <span class="hljs-operator">=</span> new Folder(<span class="hljs-string">&quot;Root&quot;</span>)<span class="hljs-comment">;</span><br>        rootFolder.add(folder1)<span class="hljs-comment">;</span><br>        rootFolder.add(folder2)<span class="hljs-comment">;</span><br><br>        rootFolder.showInfo()<span class="hljs-comment">;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†æ–‡ä»¶å’Œæ–‡ä»¶å¤¹çš„æ ‘çŠ¶ç»“æ„ï¼Œå…¶ä¸­åŒ…å«äº†å¶å­å¯¹è±¡å’Œç»„åˆå¯¹è±¡ã€‚å®¢æˆ·ç«¯å¯ä»¥é€’å½’åœ°è®¿é—®æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸éœ€è¦å…³å¿ƒå¯¹è±¡æ˜¯æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹ï¼Œä½“ç°äº†ç»„åˆæ¨¡å¼çš„ç»Ÿä¸€å¤„ç†ç‰¹æ€§ã€‚</p><h4 id="è´£ä»»é“¾æ¨¡å¼"><a href="#è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼"></a>è´£ä»»é“¾æ¨¡å¼</h4><blockquote><p>è®²ä¸€ä¸‹è´£ä»»é“¾æ¨¡å¼ï¼Œä½ åœ¨é¡¹ç›®ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„</p></blockquote><p>è´£ä»»é“¾æ¨¡å¼ä¸ºè¯·æ±‚åˆ›å»ºäº†ä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡çš„é“¾ã€‚è¿™ç§æ¨¡å¼ç»™äºˆè¯·æ±‚çš„ç±»å‹ï¼Œå¯¹è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è¿›è¡Œè§£è€¦ã€‚</p><ul><li><strong>ç»“æ„</strong>ï¼šæŠ½è±¡å¤„ç†è€…è§’è‰²ï¼ˆHandlerï¼‰å®šä¹‰äº†ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œä¸€ç³»åˆ—å…·ä½“å¤„ç†è€…ï¼ˆConcreteHandlerï¼‰å°è¯•å¤„ç†è¯·æ±‚ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ä¸èƒ½å¤„ç†è¯¥è¯·æ±‚ï¼Œå®ƒä¼šæŠŠç›¸åŒçš„è¯·æ±‚ä¼ ç»™ä¸‹ä¸€ä¸ªæ¥æ”¶è€…ï¼Œä¾æ­¤ç±»æ¨ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šé™ä½è€¦åˆåº¦ã€‚å®ƒå°†è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šåœ¨æ‰¾åˆ°æ­£ç¡®çš„å¤„ç†å¯¹è±¡ä¹‹å‰ï¼Œæ‰€æœ‰çš„æ¡ä»¶åˆ¤æ–­éƒ½è¦è¢«æ‰§è¡Œä¸€éï¼Œå½“è´£ä»»é“¾è¿‡é•¿æ—¶ï¼Œå¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨é€’å½’è°ƒç”¨çš„æ—¶å€™ã€‚</li></ul><p>å…³äºè´£ä»»é“¾å’Œç­–ç•¥æ¨¡å¼çš„å…·ä½“ä½¿ç”¨ï¼Œéœ€è¦å†çœ‹ä¸€ä¸‹ç›¸å…³è§†é¢‘ï¼š <a href="https://www.bilibili.com/list/watchlater">https://www.bilibili.com/list/watchlater</a></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317095803.png" alt="image.png"></p><p>ä¼˜ç¼ºç‚¹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317100107.png" alt="image.png"></p><p>å¸¸ç”¨åœºæ™¯</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317100219.png" alt="image.png"></p><hr><p>è´£ä»»é“¾æ¨¡å¼</p><p>è´£ä»»é“¾ï¼šé€šè¿‡å®¢æˆ·ç«¯å®šä¹‰æ‰§è¡Œé“¾æ¡ï¼Œå¹¶è®¾ç½®ä¸‹ä¸€é“¾æ¡æ‰§è¡Œæµç¨‹ï¼Œ</p><p>è´£ä»»é“¾æ¨¡å¼ï¼šä¸ºäº†é¿å…è¯·æ±‚å‘é€è€…ä¸å¤šä¸ªè¯·æ±‚å¤„ç†è€…è€¦åˆåœ¨ä¸€èµ·ï¼Œå°†æ‰€æœ‰è¯·æ±‚çš„å¤„ç†è€…é€šè¿‡å‰ä¸€å¯¹è±¡è®°ä½å…¶ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è€Œè¿æˆä¸€æ¡é“¾ï¼›å½“æœ‰è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œå¯å°†è¯·æ±‚æ²¿ç€è¿™æ¡é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p><p>å…¸å‹ä½¿ç”¨ï¼šSpringMVC ä¸­çš„æ‹¦æˆªå™¨</p><p>ç¤ºä¾‹ï¼š</p><p>è€ƒè™‘ä¸€ä¸ªç®€å•çš„æ—¥å¿—ç³»ç»Ÿï¼Œå®ƒå¯ä»¥æ ¹æ®æ¶ˆæ¯çš„ä¸¥é‡æ€§å°†æ¶ˆæ¯è¾“å‡ºåˆ°ä¸åŒçš„åœ°æ–¹ï¼ˆä¾‹å¦‚ï¼šæ§åˆ¶å°ã€æ–‡ä»¶ã€é‚®ä»¶ç­‰ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Logger</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">INFO</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">DEBUG</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> level;<br><br>    <span class="hljs-comment">//è´£ä»»é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>    <span class="hljs-keyword">protected</span> Logger nextLogger;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNextLogger</span><span class="hljs-params">(Logger nextLogger)</span> &#123;<br>        <span class="hljs-built_in">this</span>.nextLogger = nextLogger;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> level, String message)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.level &lt;= level) &#123;<br>            write(message);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (nextLogger != <span class="hljs-literal">null</span>) &#123;<br>            nextLogger.logMessage(level, message);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(String message)</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsoleLogger</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Logger</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ConsoleLogger</span><span class="hljs-params">(<span class="hljs-type">int</span> level)</span> &#123;<br>        <span class="hljs-built_in">this</span>.level = level;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(String message)</span> &#123;        <br>        System.out.println(<span class="hljs-string">&quot;Standard Console::Logger: &quot;</span> + message);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorLogger</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Logger</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ErrorLogger</span><span class="hljs-params">(<span class="hljs-type">int</span> level)</span> &#123;<br>        <span class="hljs-built_in">this</span>.level = level;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(String message)</span> &#123;        <br>        System.out.println(<span class="hljs-string">&quot;Error Console::Logger: &quot;</span> + message);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileLogger</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Logger</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FileLogger</span><span class="hljs-params">(<span class="hljs-type">int</span> level)</span> &#123;<br>        <span class="hljs-built_in">this</span>.level = level;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(String message)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;File::Logger: &quot;</span> + message);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChainPatternDemo</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Logger <span class="hljs-title function_">getChainOfLoggers</span><span class="hljs-params">()</span>&#123;<br><br>        <span class="hljs-type">Logger</span> <span class="hljs-variable">errorLogger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorLogger</span>(Logger.ERROR);<br>        <span class="hljs-type">Logger</span> <span class="hljs-variable">fileLogger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileLogger</span>(Logger.DEBUG);<br>        <span class="hljs-type">Logger</span> <span class="hljs-variable">consoleLogger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConsoleLogger</span>(Logger.INFO);<br><br>        errorLogger.setNextLogger(fileLogger);<br>        fileLogger.setNextLogger(consoleLogger);<br><br>        <span class="hljs-keyword">return</span> errorLogger;  <br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Logger</span> <span class="hljs-variable">loggerChain</span> <span class="hljs-operator">=</span> getChainOfLoggers();<br><br>        loggerChain.logMessage(Logger.INFO, <span class="hljs-string">&quot;This is an information.&quot;</span>);<br>        loggerChain.logMessage(Logger.DEBUG, <span class="hljs-string">&quot;This is a debug level information.&quot;</span>);<br>        loggerChain.logMessage(Logger.ERROR, <span class="hljs-string">&quot;This is an error information.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ—¥å¿—å¤„ç†çš„é“¾ã€‚æ¯ä¸ªå¤„ç†å™¨ï¼ˆ<code>ConsoleLogger</code>ã€<code>FileLogger</code>ã€<code>ErrorLogger</code>ï¼‰è´Ÿè´£å¤„ç†ç‰¹å®šç±»å‹çš„æ—¥å¿—æ¶ˆæ¯ã€‚<code>logMessage</code>æ–¹æ³•ä¼šæ ¹æ®æ¶ˆæ¯çš„çº§åˆ«å†³å®šæ˜¯å¦ç”±å½“å‰å¤„ç†å™¨å¤„ç†ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¼ é€’ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚</p><hr><p>è´£ä»»é“¾æ¨¡å¼ï¼šå®¢æˆ·ç«¯å®šä¹‰ä¸€ä¸ªå¤„ç†é“¾æ¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ï¼šå¦‚æœé“¾è·¯ä¸­å®ƒä¸­é—´æœ‰ä¸€ç¯èƒ½å¤Ÿå¤„ç†ï¼Œåˆ™è¿™ä¸ªé“¾è·¯è¿›è¡Œå¤„ç†ï¼Œä¸è¡Œå†åˆ°ä¸‹ä¸€ä¸ªé“¾è·¯</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317101818.png" alt="image.png"></p><h4 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h4><blockquote><p>ä½ å¹³å¸¸æœ‰äº†è§£è¿‡å•ä¾‹æ¨¡å¼å—ï¼Œä¸€èˆ¬æ€ä¹ˆå®ç°å•ä¾‹æ¨¡å¼</p></blockquote><p>å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œåœ¨åº”ç”¨è¿™ä¸ªæ¨¡å¼æ—¶ï¼Œå•ä¾‹å¯¹è±¡çš„ç±»å¿…é¡»ä¿è¯åªæœ‰ä¸€ä¸ªå® ä¾‹å­˜åœ¨ï¼Œæ•´ä¸ªç³»ç»Ÿåªèƒ½ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡å®ä¾‹</p><p>å•ä¾‹æ¨¡å¼æœ‰å¾ˆå¤šç§å†™æ³•ï¼Œæ‡’æ±‰æ¨¡å¼ï¼Œ é¥¿æ±‰æ¨¡å¼ï¼ŒåŒé‡æ£€æŸ¥æ¨¡å¼ç­‰ã€‚æ‡’æ±‰æ¨¡å¼å°±æ˜¯ç”¨çš„æ—¶å€™å†å»åˆ›å»ºå¯¹è±¡ï¼Œé¥¿æ±‰æ¨¡å¼å°±æ˜¯æå‰å°±å·²ç»åŠ è½½ å¥½çš„é™æ€staticå¯¹è±¡ï¼ŒåŒé‡æ£€æŸ¥æ¨¡å¼å°±æ˜¯ä¸¤æ¬¡æ£€æŸ¥é¿å…å¤šçº¿ç¨‹é€ æˆåˆ›å»ºäº†å¤šä¸ªå¯¹è±¡ã€‚</p><p>å•ä¾‹æ¨¡å¼æœ‰å¾ˆå¤šç§çš„å†™æ³•</p><ul><li>ï¼ˆ1ï¼‰é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„å†™æ³•ï¼šçº¿ç¨‹å®‰å…¨ </li><li>ï¼ˆ2ï¼‰æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼çš„å†™æ³•ï¼šéçº¿ç¨‹å®‰å…¨ </li><li>ï¼ˆ3ï¼‰åŒæ£€é”å•ä¾‹æ¨¡å¼çš„å†™æ³•ï¼šçº¿ç¨‹å®‰å…¨</li></ul><p>é¥¿æ±‰å¼  </p><p>é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼åœ¨ç±»åŠ è½½æ—¶å°±å®Œæˆäº†å®ä¾‹çš„åˆå§‹åŒ–ã€‚å®ƒé€šè¿‡ç¡®ä¿æ„é€ å‡½æ•°ä¸ºprivateï¼Œé¿å…äº†ç±»åœ¨å¤–éƒ¨è¢«å®ä¾‹åŒ–ï¼Œåœ¨è‡ªå·±å†…éƒ¨å®šä¹‰äº†è‡ªå·±çš„ä¸€ä¸ªå®ä¾‹ã€‚</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs smali">public class SingletonEager &#123;<br>    // åœ¨ç±»åŠ è½½æ—¶å°±å®Œæˆå®ä¾‹åŒ–<br>   <span class="hljs-keyword"> private</span><span class="hljs-keyword"> static</span><span class="hljs-keyword"> final</span> SingletonEager<span class="hljs-built_in"> instance </span>=<span class="hljs-built_in"> new </span>SingletonEager();<br><br>    // ç§æœ‰æ„é€ å‡½æ•°ï¼Œé˜²æ­¢è¢«å®ä¾‹åŒ–<br>   <span class="hljs-keyword"> private</span> SingletonEager() &#123;&#125;<br><br>    // è·å–å”¯ä¸€å¯ç”¨çš„å¯¹è±¡<br>   <span class="hljs-keyword"> public</span><span class="hljs-keyword"> static</span> SingletonEager getInstance() &#123;<br>       <span class="hljs-built_in"> return </span>instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‡’æ±‰å¼</p><p>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼åœ¨ç¬¬ä¸€æ¬¡è¢«å¼•ç”¨æ—¶ï¼Œæ‰ä¼šå°†è‡ªå·±å®ä¾‹åŒ–ã€‚å®ƒåŒæ ·ä¿è¯äº†æ„é€ å‡½æ•°ä¸ºprivateï¼Œç¡®ä¿ç±»ä¸èƒ½åœ¨å¤–éƒ¨è¢«å®ä¾‹åŒ–ã€‚</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs smali">public class SingletonLazy &#123;<br>   <span class="hljs-keyword"> private</span><span class="hljs-keyword"> static</span> Singleton<span class="hljs-class">Lazy instance;</span><br><br>   <span class="hljs-keyword"> private</span> SingletonLazy() &#123;&#125;<br><br>    // ä½¿ç”¨synchronizedå…³é”®å­—ä¿è¯çº¿ç¨‹å®‰å…¨<br>   <span class="hljs-keyword"> public</span><span class="hljs-keyword"> static</span> synchronized SingletonLazy getInstance() &#123;<br>       <span class="hljs-built_in"> if </span>(instance == null) &#123;<br>           <span class="hljs-built_in"> instance </span>=<span class="hljs-built_in"> new </span>SingletonLazy();<br>        &#125;<br>       <span class="hljs-built_in"> return </span>instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ£€é”å•ä¾‹æ¨¡å¼</p><p>åŒæ£€é”å•ä¾‹æ¨¡å¼ç»“åˆäº†æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼çš„æ‡’åŠ è½½ç‰¹æ€§å’Œé¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„çº¿ç¨‹å®‰å…¨ç‰¹æ€§ã€‚å®ƒåœ¨<code>getInstance()</code>æ–¹æ³•ä¸­ä¸¤æ¬¡æ£€æŸ¥å®ä¾‹æ˜¯å¦å·²ç»åˆ›å»ºï¼Œå¹¶ä½¿ç”¨åŒæ­¥å—ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»ºã€‚è¿™ç§æ–¹å¼æ—¢èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¹Ÿèƒ½å¤Ÿå‡å°‘åŒæ­¥å¸¦æ¥çš„æ€§èƒ½å½±å“ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SingletonDoubleCheckedLocking</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨volatileå…³é”®å­—ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> SingletonDoubleCheckedLocking instance;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">SingletonDoubleCheckedLocking</span>()</span> &#123;&#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SingletonDoubleCheckedLocking <span class="hljs-title">getInstance</span>()</span> &#123;<br>        <span class="hljs-comment">// ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼Œé¿å…ä¸å¿…è¦çš„åŒæ­¥</span><br>        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>            synchronized (SingletonDoubleCheckedLocking.<span class="hljs-keyword">class</span>) &#123;<br>                <span class="hljs-comment">// ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»º</span><br>                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) &#123;<br>                    instance = <span class="hljs-keyword">new</span> SingletonDoubleCheckedLocking();<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯ç§å•ä¾‹æ¨¡å¼å®ç°æ–¹å¼éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯ï¼š</p><ul><li><strong>é¥¿æ±‰å¼</strong>é€‚åˆäºå•ä¾‹å¯¹è±¡è¾ƒå°‘æ—¶ä½¿ç”¨ã€‚</li><li><strong>æ‡’æ±‰å¼</strong>é€‚åˆäºå•ä¾‹å¯¹è±¡è¾ƒå¤šæˆ–å•ä¾‹å¯¹è±¡åˆ›å»ºå¼€é”€å¤§æ—¶ä½¿ç”¨ï¼Œä½†éœ€æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li><li><strong>åŒæ£€é”</strong>åˆ™æ˜¯ä¸€ç§æ—¢ä¿è¯äº†æ‡’åŠ è½½ä¹Ÿä¿è¯äº†çº¿ç¨‹å®‰å…¨çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œä½†ä½¿ç”¨å¤æ‚ä¸”éœ€è¦æ³¨æ„<code>volatile</code>å…³é”®å­—çš„ä½¿ç”¨ã€‚</li></ul><h5 id="ä½ åœ¨é¡¹ç›®ä¸­æœ‰ä½¿ç”¨è¿‡å•ä¾‹æ¨¡å¼å—"><a href="#ä½ åœ¨é¡¹ç›®ä¸­æœ‰ä½¿ç”¨è¿‡å•ä¾‹æ¨¡å¼å—" class="headerlink" title="ä½ åœ¨é¡¹ç›®ä¸­æœ‰ä½¿ç”¨è¿‡å•ä¾‹æ¨¡å¼å—"></a>ä½ åœ¨é¡¹ç›®ä¸­æœ‰ä½¿ç”¨è¿‡å•ä¾‹æ¨¡å¼å—</h5><h4 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h4><p>ä»£ç†æ¨¡å¼æ˜¯ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ä»£ç†å¯¹è±¡åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹çš„ä½œç”¨ï¼Œå¯ä»¥åœ¨ä¸æ”¹å˜ç›®æ ‡å¯¹è±¡æ¥å£çš„å‰æä¸‹ï¼Œå¢å¼ºæˆ–æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ã€‚</p><p>å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œä¸€å®šé¢å¤–çš„æ“ä½œ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240316231329.png" alt="image.png"></p>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_SpringCloud</title>
    <link href="/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_SpringCloud/"/>
    <url>/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_SpringCloud/</url>
    
    <content type="html"><![CDATA[<h3 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h3><h4 id="ä»€ä¹ˆæ˜¯-SpringCloud"><a href="#ä»€ä¹ˆæ˜¯-SpringCloud" class="headerlink" title="ä»€ä¹ˆæ˜¯ SpringCloud"></a>ä»€ä¹ˆæ˜¯ SpringCloud</h4><p>SpringCloud ä½œä¸º Spring å®¶æ—é‡è¦çš„ä¸€ç¯ï¼Œå®ƒæ•´åˆäº†å¤šç§å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œä¸ºå¾®æœåŠ¡æ¶æ„æä¾›äº†å…¨é¢çš„æ”¯æŒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ›´åŠ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘è€ŒéåŸºç¡€è®¾æ–½ã€‚</p><p>SpringCloud é€šè¿‡Spring Booté£æ ¼è¿›è¡Œå°è£…ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥è½»æ¾åœ°æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„å„ç§ç»„ä»¶ã€‚</p><h4 id="SpringCloud-VS-SpringBoot"><a href="#SpringCloud-VS-SpringBoot" class="headerlink" title="SpringCloud VS  SpringBoot"></a>SpringCloud VS  SpringBoot</h4><ul><li>Spring Boot ï¼Œä¸“æ³¨äºå¿«é€Ÿï¼Œæ–¹ä¾¿çš„å¼€å‘å•ä¸ªå¾®æœåŠ¡ä¸ªä½“ã€‚</li><li>Spring Cloud ï¼Œå…³æ³¨å…¨å±€çš„æœåŠ¡æ²»ç†æ¡†æ¶ã€‚</li></ul><h4 id="è¯´ä¸€ä¸‹å¸¸ç”¨ç»„ä»¶-ğŸš©"><a href="#è¯´ä¸€ä¸‹å¸¸ç”¨ç»„ä»¶-ğŸš©" class="headerlink" title="è¯´ä¸€ä¸‹å¸¸ç”¨ç»„ä»¶  ğŸš©"></a>è¯´ä¸€ä¸‹å¸¸ç”¨ç»„ä»¶  ğŸš©</h4><p>Spring Cloud Netflix ç¬¬ä¸€ä»£</p><ul><li>Eureka   æ³¨å†Œä¸­å¿ƒ</li><li>Ribbon   è´Ÿè½½å‡è¡¡</li><li>Feign     è¿œç¨‹è°ƒç”¨</li><li>Hystrix  æœåŠ¡ç†”æ–­</li><li>Zuul  ç½‘å…³</li></ul><p>Spring Cloud Alibaba ç¬¬äºŒä»£</p><ul><li>Nacos   æ³¨å†Œä¸­å¿ƒã€é…ç½®ä¸­å¿ƒ</li><li>Ribbon   è´Ÿè½½å‡è¡¡</li><li>OpenFeign     è¿œç¨‹è°ƒç”¨</li><li>Sentinel   æœåŠ¡ä¿æŠ¤</li><li>Gateway  ç½‘å…³</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311221942122.png" alt="image.png"></p><h4 id="è®²ä¸€ä¸‹-CAP"><a href="#è®²ä¸€ä¸‹-CAP" class="headerlink" title="è®²ä¸€ä¸‹ CAP"></a>è®²ä¸€ä¸‹ CAP</h4><ul><li>ä¸€è‡´æ€§</li><li>å¯ç”¨æ€§</li><li>åˆ†åŒºå®¹é”™æ€§</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281656511.png" alt="image.png"></p><ul><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ï¼šæ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„æ•°æ®åœ¨åŒä¸€æ—¶é—´æ˜¯ç›¸åŒçš„ã€‚å³åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¯æ¬¡è¯»å–æ“ä½œéƒ½èƒ½å¾—åˆ°æœ€æ–°çš„å†™å…¥ç»“æœã€‚ä¸€è‡´æ€§ç¡®ä¿äº†ç³»ç»Ÿçš„æ•°æ®å‰¯æœ¬ä¹‹é—´èƒ½å¤Ÿè¾¾æˆä¸€è‡´çš„çŠ¶æ€ã€‚</li><li><strong>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰</strong>ï¼šæ¯ä¸ªè¯·æ±‚éƒ½èƒ½åœ¨æœ‰é™çš„æ—¶é—´å†…æ”¶åˆ°ä¸€ä¸ªæ˜ç¡®çš„å“åº”ï¼Œæ— è®ºå“åº”æ˜¯æˆåŠŸçš„è¿˜æ˜¯å¤±è´¥çš„ã€‚å¯ç”¨æ€§ä¿è¯äº†ç³»ç»Ÿèƒ½å¤ŸæŒç»­å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</li><li><strong>åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰</strong>ï¼šç³»ç»Ÿèƒ½å¤Ÿåœ¨ä»»æ„ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ç»§ç»­è¿è¡Œã€‚åˆ†åŒºå®¹é”™æ€§æŒ‡çš„æ˜¯ï¼Œå³ä½¿ç³»ç»Ÿå†…éƒ¨å‘ç”Ÿäº†ç½‘ç»œåˆ†å‰²ï¼Œä½¿å¾—æŸäº›èŠ‚ç‚¹ä¹‹é—´æ— æ³•é€šä¿¡ï¼Œç³»ç»Ÿä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§æˆ–å¯ç”¨æ€§çš„æœåŠ¡ã€‚</li></ul><p>å®é™…åº”ç”¨ï¼š</p><p>åœ¨å®é™…çš„åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­ï¼ŒCAPå®šç†æä¾›äº†ä¸€ä¸ªç†è®ºæ¡†æ¶æ¥æŒ‡å¯¼å¦‚ä½•åœ¨ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ä¹‹é—´åšå‡ºæƒè¡¡ã€‚ä¸åŒçš„ç³»ç»Ÿå¯èƒ½ä¼šæ ¹æ®è‡ªèº«çš„ä¸šåŠ¡éœ€æ±‚å’Œç‰¹ç‚¹ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„CAPå¹³è¡¡ç‚¹ï¼š</p><ul><li><strong>CAç³»ç»Ÿ</strong>ï¼šæ”¾å¼ƒåˆ†åŒºå®¹é”™æ€§ï¼Œé€šå¸¸é€‚ç”¨äºå•ä¸€æ•°æ®ä¸­å¿ƒçš„ä¼ ç»Ÿæ•°æ®åº“ç³»ç»Ÿã€‚</li><li><strong>CPç³»ç»Ÿ</strong>ï¼šæ”¾å¼ƒå¯ç”¨æ€§ï¼Œé€‚ç”¨äºå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜çš„ç³»ç»Ÿ</li><li><strong>APç³»ç»Ÿ</strong>ï¼šæ”¾å¼ƒä¸€è‡´æ€§ï¼Œé€‚ç”¨äºå¯¹å¯ç”¨æ€§è¦æ±‚æé«˜çš„ç³»ç»Ÿ</li></ul><p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç³»ç»ŸèŠ‚ç‚¹ä¹‹é—´è‚¯å®šçš„éœ€è¦æœ‰ç½‘ç»œè¿æ¥çš„ï¼Œå› æ­¤åˆ†åŒºï¼ˆP) æ˜¯å¿…ç„¶å­˜åœ¨çš„</p><hr><p>åœ¨ç°å®çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œåˆ†åŒºæ˜¯ä¸å¯é¿å…çš„ï¼Œå› æ­¤åˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼‰æ˜¯å¿…é¡»è¦æ»¡è¶³çš„ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬åªèƒ½åœ¨ä¸€è‡´æ€§ï¼ˆCï¼‰å’Œå¯ç”¨æ€§ï¼ˆAï¼‰ä¹‹é—´åšå‡ºé€‰æ‹©ã€‚</p><ul><li><strong>APç³»ç»Ÿ</strong>ï¼šåœ¨ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œé€‰æ‹©ä¿è¯å¯ç”¨æ€§ï¼Œä½†ç‰ºç‰²äº†ä¸€è‡´æ€§ã€‚è¿™æ„å‘³ç€åœ¨æŸäº›èŠ‚ç‚¹ä¸Šå¯èƒ½è¯»å–åˆ°çš„æ˜¯è¿‡æ—¶çš„æ•°æ®ï¼Œå› ä¸ºç³»ç»Ÿä¸ºäº†ä¿è¯å“åº”çš„å¯ç”¨æ€§ï¼Œå…è®¸åœ¨æ²¡æœ‰è·å–åˆ°æœ€æ–°æ•°æ®å‰¯æœ¬çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚</li><li><strong>CPç³»ç»Ÿ</strong>ï¼šåœ¨ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œé€‰æ‹©ä¿è¯ä¸€è‡´æ€§ï¼Œä½†å¯èƒ½ç‰ºç‰²å¯ç”¨æ€§ã€‚è¿™æ„å‘³ç€å¦‚æœæ•°æ®ä¸èƒ½åœ¨æ‰€æœ‰èŠ‚ç‚¹é—´åŒæ­¥ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæ‹’ç»å¤„ç†è¯»å†™è¯·æ±‚ï¼Œä»¥ä¿è¯ä¸ä¼šè¿”å›é”™è¯¯æˆ–è¿‡æ—¶çš„æ•°æ®ã€‚</li></ul><h4 id="è®²ä¸€ä¸‹-Base"><a href="#è®²ä¸€ä¸‹-Base" class="headerlink" title="è®²ä¸€ä¸‹ Base"></a>è®²ä¸€ä¸‹ Base</h4><p>BASEç†è®ºæ˜¯å¯¹CAPç†è®ºçš„ä¸€ç§è¡¥å……å’Œå»¶ä¼¸ï¼Œä¸»è¦é¢å‘å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåœ¨ç‰ºç‰²å¼ºä¸€è‡´æ€§çš„å‰æä¸‹ï¼Œè¿½æ±‚ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚</p><p>BASEæ˜¯ä¸‰ä¸ªè‹±æ–‡å•è¯çš„ç¼©å†™ï¼Œåˆ†åˆ«ä»£è¡¨ï¼š</p><ul><li><strong>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰</strong>ï¼šç³»ç»Ÿå…è®¸åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œä¿æŒæ ¸å¿ƒå¯ç”¨ï¼Œä½†æ˜¯å…è®¸éƒ¨åˆ†æš‚æ—¶ä¸å¯ç”¨ã€‚è¿™æ„å‘³ç€åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ˆå¦‚ç½‘ç»œåˆ†åŒºã€ç³»ç»Ÿæ•…éšœï¼‰ï¼Œç³»ç»Ÿä»ç„¶èƒ½æä¾›åŸºæœ¬çš„æœåŠ¡ï¼Œå³ä½¿è¿™äº›æœåŠ¡å¯èƒ½æ˜¯é™çº§çš„ã€‚</li><li><strong>è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰</strong>ï¼šç³»ç»Ÿçš„çŠ¶æ€ä¸éœ€è¦å®æ—¶ä¸€è‡´ï¼Œå…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¿™ç§çŠ¶æ€æ˜¯æ­£å¸¸çš„ã€‚ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ä¼ ç»Ÿæ•°æ®åº“ä¸­æ•°æ®çš„â€œç¡¬çŠ¶æ€â€ï¼Œå¿…é¡»ä¿è¯æ•°æ®åœ¨ä»»ä½•æ—¶åˆ»éƒ½æ˜¯ä¸€è‡´çš„ã€‚è½¯çŠ¶æ€å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹é—´æ•°æ®åŒæ­¥å­˜åœ¨å»¶è¿Ÿã€‚</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰</strong>ï¼šç³»ç»Ÿä¿è¯åœ¨æ²¡æœ‰æ–°çš„æ›´æ–°æ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ•°æ®æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ï¼Œæ‰€æœ‰çš„æ›´æ–°æ“ä½œæœ€ç»ˆå°†ä¼šä¼ æ’­åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œä½†å¹¶ä¸ä¿è¯æ›´æ–°æ“ä½œçš„å®æ—¶æ€§å’Œé¡ºåºæ€§ã€‚</li></ul><p>BASEç†è®ºæä¾›äº†ä¸€ç§é¢å‘å¯ç”¨æ€§å’Œæ€§èƒ½çš„ã€å¯¹ä¸€è‡´æ€§è¦æ±‚ç›¸å¯¹å®½æ¾çš„è®¾è®¡å’Œå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ–¹æ³•è®ºï¼Œå¼ºè°ƒé€šè¿‡ç‰ºç‰²ä¸€è‡´æ€§æ¥è·å¾—é«˜å¯ç”¨æ€§å’Œé«˜æ€§èƒ½çš„å¯èƒ½æ€§ã€‚</p><blockquote><p>ç¤ºä¾‹ï¼šåŸºäºBase ç†è®ºå®ç°åˆ†å¸ƒå¼äº‹åŠ¡</p></blockquote><blockquote><p>é¢è¯•é¢˜ï¼šè§£é‡Šä¸€ä¸‹  CAP  å’Œ   BASE</p></blockquote><ul><li>CAPå®šç†ï¼ˆä¸€è‡´æ€§.å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§ï¼‰<ul><li>1.åˆ†å¸ƒå¼ç³»ç»ŸèŠ‚ç‚¹é€šè¿‡ç½‘æ ¼è¿æ¥ã€‚ä¸€å®šä¼šå‡ºç°åˆ†åŒºé—®é¢˜(P)</li><li>2.å½“åˆ†åŒºå‡ºç°æ—¶ï¼Œç³»ç»Ÿçš„ä¸€è‡´æ€§(C)å’Œå¯ç”¨æ€§(A)å°±æ— æ³•åŒæ—¶æ»¡è¶³</li></ul></li><li>BASEç†è®º<ul><li>1,åŸºæœ¬å¯ç”¨</li><li>2.è½¯çŠ¶æ€</li><li>3.æœ€ç»ˆä¸€è‡´</li></ul></li><li>è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€æƒ³å’Œæ¨¡å‹ï¼š<ul><li>1,æœ€ç»ˆä¸€è‡´æ€æƒ³ï¼šå„åˆ†æ”¯äº‹åŠ¡åˆ†åˆ«æ‰§è¡Œå¹¶æäº¤ï¼Œå¦‚æœæœ‰ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå†æƒ³åŠæ³•æ¢å¤æ•°æ®(AP)</li><li>2.å¼ºä¸€è‡´æ€æƒ³ï¼šå„åˆ†æ”¯äº‹åŠ¡æ‰§è¡Œå®Œä¸šåŠ¡ä¸è¦æäº¤ã€‚ç­‰å¾…å½¼æ­¤ç»“æœï¼Œè€Œåç»Ÿä¸€æäº¤æˆ–å›æ»š(CP)</li></ul></li></ul><p>è¿™ä¸ªç†è§£æœ‰ç‚¹é—®é¢˜ï¼Œå¾…åç»­å›é¡¾ä¸€ä¸‹ to be continedâ€¦.</p><h3 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h3><h4 id="Nacos-å’Œ-Eureka-çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ"><a href="#Nacos-å’Œ-Eureka-çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Nacos å’Œ Eureka çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ"></a>Nacos å’Œ Eureka çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>Nacos å’Œ Eureka çš„å…±åŒç‚¹ï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰<ul><li>1ã€éƒ½æ”¯æŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ‹‰å–</li><li>2ã€éƒ½æ”¯æŒæœåŠ¡æä¾›è€…å¿ƒè·³æ–¹å¼åšå¥åº·æ£€æµ‹</li></ul></li><li>Nacosä¸Eurekaçš„åŒºåˆ«ï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰<ul><li>1ã€Nacos æ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€ï¼šä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼ï¼Œéä¸´æ—¶å®ä¾‹é‡‡ç”¨ä¸»åŠ¨æ£€æµ‹æ¨¡å¼</li><li>2ã€ä¸´æ—¶å®ä¾‹å¿ƒæ¡ƒä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼Œéä¸´æ—¶å®ä¾‹åˆ™ä¸ä¼šè¢«å‰”é™¤</li><li>3ã€Nacos æ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„æ¶ˆæ¯æ¨é€æ¨¡å¼ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°æ›´åŠæ—¶</li><li>4ã€Nacosé›†ç¾¤é»˜è®¤é‡‡ç”¨APæ–¹å¼ï¼Œå½“é›†ç¾¤ä¸­å­˜åœ¨éä¸´æ—¶å®ä¾‹æ—¶ï¼Œé‡‡ç”¨CPæ¨¡å¼ï¼›Eurekaé‡‡ç”¨APæ–¹å¼</li></ul></li><li>Nacosè¿˜æ”¯æŒäº†é…ç½®ä¸­å¿ƒï¼Œeurekaåˆ™åªæœ‰æ³¨å†Œä¸­å¿ƒï¼Œä¹Ÿæ˜¯é€‰æ‹©ä½¿ç”¨nacosçš„ä¸€ä¸ªé‡è¦åŸå› </li></ul><h4 id="è®²ä¸€ä¸‹-Nacos-çš„å·¥ä½œæµç¨‹"><a href="#è®²ä¸€ä¸‹-Nacos-çš„å·¥ä½œæµç¨‹" class="headerlink" title="è®²ä¸€ä¸‹ Nacos çš„å·¥ä½œæµç¨‹"></a>è®²ä¸€ä¸‹ Nacos çš„å·¥ä½œæµç¨‹</h4><ul><li>æœåŠ¡å‘ç°<ul><li>æœåŠ¡æ³¨å†Œï¼ŒæœåŠ¡å‘ç°ï¼Œå¥åº·æ£€æŸ¥ï¼ŒæœåŠ¡æ³¨é”€</li></ul></li><li>é…ç½®ç®¡ç†</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240315134919.png" alt="image.png"></p><h4 id="ä¸ºä»€ä¹ˆè¦ç”¨é…ç½®ä¸­å¿ƒ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨é…ç½®ä¸­å¿ƒ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨é…ç½®ä¸­å¿ƒ"></a>ä¸ºä»€ä¹ˆè¦ç”¨é…ç½®ä¸­å¿ƒ</h4><p>è¿›è¡ŒåŠ¨æ€é…ç½®å’Œç»Ÿä¸€ç®¡ç†</p><h4 id="å¸¸ç”¨çš„é…ç½®ä¸­å¿ƒæœ‰å“ªäº›"><a href="#å¸¸ç”¨çš„é…ç½®ä¸­å¿ƒæœ‰å“ªäº›" class="headerlink" title="å¸¸ç”¨çš„é…ç½®ä¸­å¿ƒæœ‰å“ªäº›"></a>å¸¸ç”¨çš„é…ç½®ä¸­å¿ƒæœ‰å“ªäº›</h4><p>Apolloå’ŒNacosä¸¤è€…éƒ½æ˜¯å›½å†…å…¬å¸å¼€æºçš„çŸ¥åé¡¹ç›®ï¼Œé¡¹ç›®ç¤¾åŒºéƒ½æ¯”è¾ƒæ´»è·ƒä¸”éƒ½è¿˜åœ¨ç»´æŠ¤ä¸­ã€‚</p><p>Nacosæ˜¯é˜¿é‡Œå¼€æºçš„ï¼ŒApolloæ˜¯æºç¨‹å¼€æºçš„ã€‚</p><p>Nacosä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ç›´æ¥ç”¨æ¥åšæœåŠ¡å‘ç°åŠç®¡ç†ã€‚</p><p>Apollo åªèƒ½ç”¨æ¥åšé…ç½®ç®¡ç†ï¼Œä½¿ç”¨ç›¸å¯¹å¤æ‚äº›ã€‚</p><p>å¦‚æœä½ çš„é¡¹ç›®ä»…ä»…éœ€è¦é…ç½®ä¸­å¿ƒçš„è¯ï¼Œå»ºè®®ä½¿ç”¨ Apolloã€‚å¦‚æœä½ çš„é¡¹ç›®éœ€è¦é…ç½®ä¸­å¿ƒçš„åŒæ—¶è¿˜éœ€è¦æœåŠ¡å‘ç°åŠç®¡ç†çš„è¯ï¼Œé‚£å°±æ›´å»ºè®®ä½¿ç”¨Nacosã€‚</p><p>å¤§æ¦‚è®²ä¸€ä¸‹ Nacos é…ç½®ä¸­å¿ƒæ˜¯æ€ä¹ˆç”¨çš„ï¼Œç„¶åå¸¦ä¸€ä¸‹ è¯´çŸ¥é“æœ‰ Apollo è¿™ä¸ªä¸œè¥¿ï¼Œä½†æ²¡æœ‰ç”¨è¿‡ã€‚</p><h4 id="Nacos-æ˜¯å»ä¸­å¿ƒçš„å—ï¼Œå¦‚æœæœåŠ¡æŒ‚äº†ï¼Œæ˜¯å¦å¯ä»¥ç»§ç»­è¿›è¡Œè®¿é—®æ“ä½œ"><a href="#Nacos-æ˜¯å»ä¸­å¿ƒçš„å—ï¼Œå¦‚æœæœåŠ¡æŒ‚äº†ï¼Œæ˜¯å¦å¯ä»¥ç»§ç»­è¿›è¡Œè®¿é—®æ“ä½œ" class="headerlink" title="Nacos æ˜¯å»ä¸­å¿ƒçš„å—ï¼Œå¦‚æœæœåŠ¡æŒ‚äº†ï¼Œæ˜¯å¦å¯ä»¥ç»§ç»­è¿›è¡Œè®¿é—®æ“ä½œ"></a>Nacos æ˜¯å»ä¸­å¿ƒçš„å—ï¼Œå¦‚æœæœåŠ¡æŒ‚äº†ï¼Œæ˜¯å¦å¯ä»¥ç»§ç»­è¿›è¡Œè®¿é—®æ“ä½œ</h4><p>å‚è€ƒï¼š <a href="https://wenku.csdn.net/answer/c5a9f976aa15481caf8ac84f2e036e46">https://wenku.csdn.net/answer/c5a9f976aa15481caf8ac84f2e036e46</a></p><p>Nacos ä¸€èˆ¬ä¼šæœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯é›†ç¾¤æ¨¡å¼ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯æŒä¹…åŒ–æ¨¡å¼</p><ul><li>é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œå…¶ä»–èŠ‚ç‚¹ä»ç„¶æ˜¯èƒ½æä¾›åç»­æœåŠ¡</li><li>æŒä¹…åŒ–æ¨¡å¼ä¸‹ï¼Œnacos æœåŠ¡å¦‚æœæŒ‚äº†ï¼ŒæœåŠ¡ä¹‹é—´ä»ç„¶å¯ä»¥é€šè¿‡æœ¬åœ°ä¿å­˜çš„æ³¨å†Œä¿¡æ¯è¿›è¡Œé€šä¿¡ã€‚</li></ul><p>nacosçš„æŒ‚æ‰å¯¹æœåŠ¡ä¹‹é—´çš„ç›¸äº’è®¿é—®æœ‰å½±å“ï¼Œä½†å¯ä»¥é€šè¿‡ nacos çš„é›†ç¾¤æ¨¡å¼å’ŒæŒä¹…åŒ–æ¨¡å¼æ¥é¿å…è¿™ç§å½±å“ã€‚</p><h3 id="OpenFeign"><a href="#OpenFeign" class="headerlink" title="OpenFeign"></a>OpenFeign</h3><h4 id="OpenFeign-çš„åŸç†ä½ äº†è§£å—-ğŸš©"><a href="#OpenFeign-çš„åŸç†ä½ äº†è§£å—-ğŸš©" class="headerlink" title="OpenFeign çš„åŸç†ä½ äº†è§£å— ğŸš©"></a>OpenFeign çš„åŸç†ä½ äº†è§£å— ğŸš©</h4><p>OpenFeign é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼å°è£…äº†ä¸€ç³»ç»Ÿæ“ä½œï¼Œæ¯”å¦‚ï¼šå»ºç«‹è¿æ¥ã€æ„é€ è¯·æ±‚ã€å‘èµ·é•æ±‚ã€è·å–å“åº”ã€è§£æå“åº”ç­‰</p><p>å¤§æ¦‚è®²ä¸€ä¸‹å®ç°åŸç†</p><ul><li><p>åœ¨é»˜è®¤é…ç½®ä¸‹ï¼ŒFeign å®¢æˆ·ç«¯ä¼šä¸ Ribbon å’Œ Hystrix é›†æˆï¼Œä»¥æä¾›è´Ÿè½½å‡è¡¡å’Œæ–­è·¯å™¨åŠŸèƒ½</p></li><li><p>é¦–å…ˆï¼Œå¦‚æœä½ å¯¹æŸä¸ªæ¥å£å®šä¹‰äº† @FeignClient æ³¨è§£ï¼ŒFeignå°±ä¼šé’ˆå¯¹è¿™ä¸ªæ¥å£åˆ›å»ºä¸€ä¸ªåŠ¨æ€ä»£ç†</p></li><li><p>ä½ è¦æ˜¯è°ƒç”¨é‚£ä¸ªæ¥å£ï¼Œæœ¬è´¨å°±æ˜¯ä¼šè°ƒç”¨ Feignåˆ›å»ºçš„åŠ¨æ€ä»£ç†ï¼Œè¿™æ˜¯æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ</p></li><li><p>Feignçš„åŠ¨æ€ä»£ç†ä¼šæ ¹æ®ä½ åœ¨æ¥å£ä¸Šçš„@RequestMappingç­‰æ³¨è§£ï¼Œæ¥åŠ¨æ€æ„é€ å‡ºä½ è¦è¯·æ±‚çš„æœåŠ¡çš„åœ°å€</p></li><li><p>æœ€åé’ˆå¯¹è¿™ä¸ªåœ°å€ï¼Œå‘èµ·è¯·æ±‚ã€è§£æå“åº”</p></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240515114251.png" alt="image.png"></p><p>ä¸€èˆ¬ä»£ç ä½¿ç”¨</p><ul><li>1ã€å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableFeignClients æ³¨è§£</li><li>2ã€ä½¿ç”¨ <code>@FeignClient</code> æ³¨è§£å®šä¹‰æ¥å£ï¼Œå¹¶æŒ‡å®šéœ€è¦è°ƒç”¨çš„æœåŠ¡åç§°</li><li>3ã€Controller å±‚æ­£å¸¸æä¾›å¯¹å¤–çš„ RestController æ¥å£</li></ul><h4 id="è¿œç¨‹è°ƒç”¨çš„æ—¶å€™ä½ é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Œæ€ä¹ˆè§£å†³çš„-ğŸš©"><a href="#è¿œç¨‹è°ƒç”¨çš„æ—¶å€™ä½ é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Œæ€ä¹ˆè§£å†³çš„-ğŸš©" class="headerlink" title="è¿œç¨‹è°ƒç”¨çš„æ—¶å€™ä½ é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Œæ€ä¹ˆè§£å†³çš„  ğŸš©"></a>è¿œç¨‹è°ƒç”¨çš„æ—¶å€™ä½ é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Œæ€ä¹ˆè§£å†³çš„  ğŸš©</h4><p>é‡åˆ°è¿‡ä¸€äº›é—®é¢˜</p><ul><li>ç½‘ç»œè¶…æ—¶ï¼Œæ¥å£è°ƒç”¨æ—¶é—´è¿‡é•¿<ul><li><strong>é…ç½®è¶…æ—¶æ—¶é—´</strong>ï¼šåœ¨è¿œç¨‹è°ƒç”¨æ—¶ï¼Œè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´çš„é˜»å¡ã€‚<ul><li>åœ¨ Spring Cloud Feign ä¸­å¯ä»¥é…ç½®è¶…æ—¶æ—¶é—´ï¼š</li></ul></li><li><strong>ä½¿ç”¨ç†”æ–­å™¨</strong>ï¼šé‡‡ç”¨ç†”æ–­æœºåˆ¶ï¼ˆå¦‚ Hystrix æˆ– Resilience4jï¼‰ï¼Œåœ¨å¤šæ¬¡è°ƒç”¨å¤±è´¥åæ–­å¼€è¿æ¥ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚<ul><li>fallback æ–¹æ³•</li></ul></li></ul></li><li>æœåŠ¡ä¸å¯ç”¨<ul><li><strong>æœåŠ¡é™çº§</strong>ï¼šé€šè¿‡ç†”æ–­å™¨æˆ–å…¶ä»–æ–¹å¼æä¾›é™çº§ç­–ç•¥ï¼Œåœ¨æœåŠ¡ä¸å¯ç”¨æ—¶è¿”å›é»˜è®¤å€¼æˆ–ç¼“å­˜æ•°æ®ã€‚</li><li><strong>é‡è¯•æœºåˆ¶</strong>ï¼šé…ç½®é‡è¯•ç­–ç•¥ï¼Œåœ¨è°ƒç”¨å¤±è´¥åé‡è¯•å‡ æ¬¡ï¼Œä»¥åº”å¯¹ä¸´æ—¶æ€§çš„é—®é¢˜ã€‚</li></ul></li><li>è´Ÿè½½ä¸å‡è¡¡</li><li>æ•°æ®ä¸€è‡´æ€§<ul><li>ç¡®ä¿è¿™ç§è°ƒç”¨ï¼Œæœ€åèƒ½å¤Ÿä¿è¯æœ€ç»ˆä¸€è‡´æ€§</li></ul></li><li>å®‰å…¨æ€§é—®é¢˜<ul><li>ä½¿ç”¨ OAuth2 æˆ– JWT å¯¹è¿œç¨‹è°ƒç”¨è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒ</li><li>ä½¿ç”¨ HTTPS æˆ–å…¶ä»–åŠ å¯†åè®®ä¿æŠ¤æ•°æ®ä¼ è¾“å®‰å…¨</li></ul></li><li>å®šä½é—®é¢˜<ul><li>è¿œç¨‹è°ƒç”¨å¤±è´¥æ—¶ï¼Œè°ƒè¯•å’Œç›‘æ§å›°éš¾ï¼Œéš¾ä»¥å¿«é€Ÿå®šä½é—®é¢˜ã€‚<ul><li>åœ¨è¿œç¨‹è°ƒç”¨å‰åè®°å½•è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ã€‚</li><li>ä½¿ç”¨åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿï¼ˆå¦‚ Zipkin æˆ– Jaegerï¼‰è·Ÿè¸ªè¿œç¨‹è°ƒç”¨é“¾è·¯ï¼Œåˆ†ææ€§èƒ½ç“¶é¢ˆ</li></ul></li></ul></li></ul><h4 id="è®²ä¸€ä¸‹-OpenFeign-çš„-Fallback-åŸç†"><a href="#è®²ä¸€ä¸‹-OpenFeign-çš„-Fallback-åŸç†" class="headerlink" title="è®²ä¸€ä¸‹ OpenFeign çš„ Fallback åŸç†"></a>è®²ä¸€ä¸‹ OpenFeign çš„ Fallback åŸç†</h4><h4 id="è¿œç¨‹è°ƒç”¨æ•´ä¸ªæ¶æ„æ€ä¹ˆè®¾è®¡çš„ï¼Œå°‘çš„è¯å‡ ä¸ªï¼Œå¤šçš„è¯å‡ ç™¾ä¸ªã€ä¸Šåƒä¸ªæ¥å£å¦‚ä½•ç®¡ç†ï¼Ÿ"><a href="#è¿œç¨‹è°ƒç”¨æ•´ä¸ªæ¶æ„æ€ä¹ˆè®¾è®¡çš„ï¼Œå°‘çš„è¯å‡ ä¸ªï¼Œå¤šçš„è¯å‡ ç™¾ä¸ªã€ä¸Šåƒä¸ªæ¥å£å¦‚ä½•ç®¡ç†ï¼Ÿ" class="headerlink" title="è¿œç¨‹è°ƒç”¨æ•´ä¸ªæ¶æ„æ€ä¹ˆè®¾è®¡çš„ï¼Œå°‘çš„è¯å‡ ä¸ªï¼Œå¤šçš„è¯å‡ ç™¾ä¸ªã€ä¸Šåƒä¸ªæ¥å£å¦‚ä½•ç®¡ç†ï¼Ÿ"></a>è¿œç¨‹è°ƒç”¨æ•´ä¸ªæ¶æ„æ€ä¹ˆè®¾è®¡çš„ï¼Œå°‘çš„è¯å‡ ä¸ªï¼Œå¤šçš„è¯å‡ ç™¾ä¸ªã€ä¸Šåƒä¸ªæ¥å£å¦‚ä½•ç®¡ç†ï¼Ÿ</h4><ul><li>æœåŠ¡æ³¨å†Œä¸å‘ç°</li><li>è´Ÿè½½å‡è¡¡</li><li>API ç®¡ç†å¹³å°</li></ul><p>æ‰©å±•</p><ul><li>ç¼“å­˜</li><li>é™æµä¸ç†”æ–­</li><li>å¼‚æ­¥é€šä¿¡</li><li>ç›‘æ§æ—¥å¿—</li></ul><h3 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h3><h4 id="è®²ä¸€ä¸‹-Ribbon-çš„ä½œç”¨"><a href="#è®²ä¸€ä¸‹-Ribbon-çš„ä½œç”¨" class="headerlink" title="è®²ä¸€ä¸‹ Ribbon çš„ä½œç”¨"></a>è®²ä¸€ä¸‹ Ribbon çš„ä½œç”¨</h4><ul><li>å‡åŒ€çš„æŠŠè¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœºå™¨ä¸Š</li></ul><p>å®ç°å·¥ä½œæµç¨‹</p><ul><li>1ã€<strong>æœåŠ¡åˆ—è¡¨ç»´æŠ¤</strong>ï¼šRibbon ä»æ³¨å†Œä¸­å¿ƒï¼ˆå¦‚ Eurekaã€Nacosï¼‰è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œå¹¶å®šæœŸæ›´æ–°ã€‚å®ƒç»´æŠ¤ä¸€ä»½æœ¬åœ°ç¼“å­˜ï¼ŒåŒ…å«æ‰€æœ‰å¯ç”¨æœåŠ¡å®ä¾‹çš„ä¿¡æ¯ã€‚</li><li>2ã€<strong>è´Ÿè½½å‡è¡¡ç­–ç•¥</strong>ï¼šRibbon æä¾›å¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ã€éšæœºã€åŠ æƒç­‰ï¼‰ï¼Œå¯ä»¥é€šè¿‡é…ç½®é€‰æ‹©åˆé€‚çš„ç­–ç•¥ã€‚é»˜è®¤ç­–ç•¥æ˜¯è½®è¯¢ã€‚</li><li>3ã€<strong>æœåŠ¡è°ƒç”¨</strong>ï¼šåœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ—¶ï¼ŒRibbon ä¼šæ ¹æ®é€‰å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä»æœåŠ¡å®ä¾‹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°è¯¥å®ä¾‹ã€‚</li></ul><h4 id="Ribbon-å¸¸è§çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›"><a href="#Ribbon-å¸¸è§çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›" class="headerlink" title="Ribbon å¸¸è§çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›"></a>Ribbon å¸¸è§çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›</h4><p>Ribbon å¸¸è§çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š</p><ul><li><strong>Round Robin Ruleï¼ˆè½®è¯¢è§„åˆ™ï¼‰</strong><ul><li>è¿™æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚å®ƒæŒ‰é¡ºåºå¾ªç¯åœ°é€‰æ‹©æœåŠ¡å®ä¾‹ï¼Œæ¯æ¬¡è¯·æ±‚è½®æµåˆ†é…ç»™ä¸‹ä¸€ä¸ªæœåŠ¡å®ä¾‹ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæ‰€æœ‰æœåŠ¡å®ä¾‹å¤„ç†èƒ½åŠ›ç›¸å½“çš„æƒ…å†µã€‚</li></ul></li><li><strong>Random Ruleï¼ˆéšæœºè§„åˆ™ï¼‰</strong><ul><li>éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ã€‚æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯éšæœºä»æœåŠ¡åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªæœåŠ¡å®ä¾‹è¿›è¡Œè°ƒç”¨ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæœåŠ¡å®ä¾‹ä¼—å¤šï¼Œéœ€è¦é¿å…è½®è¯¢å¸¦æ¥çš„å‡åŒ€æ€§ä¸è¶³é—®é¢˜çš„åœºæ™¯ã€‚</li></ul></li><li><strong>Response Time Weighted Rule</strong>ï¼ˆå“åº”æ—¶é—´åŠ æƒè§„åˆ™ï¼‰<ul><li>æ ¹æ®æœåŠ¡å®ä¾‹çš„å¹³å‡å“åº”æ—¶é—´æ¥è®¡ç®—æ‰€æœ‰æœåŠ¡å®ä¾‹çš„æƒé‡ï¼Œå“åº”æ—¶é—´çŸ­çš„æœåŠ¡å®ä¾‹å°†æœ‰æ›´é«˜çš„æƒé‡ï¼Œè¢«æ›´é¢‘ç¹åœ°é€‰æ‹©ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæœåŠ¡å®ä¾‹æ€§èƒ½å·®å¼‚è¾ƒå¤§ï¼Œå¸Œæœ›ä¼˜å…ˆè°ƒç”¨å“åº”æ—¶é—´çŸ­çš„æœåŠ¡å®ä¾‹çš„æƒ…å†µã€‚</li></ul></li><li>Retry Ruleï¼ˆé‡è¯•è§„åˆ™ï¼‰<ul><li>åœ¨ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´å†…ï¼Œå¦‚æœé€‰å®šçš„æœåŠ¡å®ä¾‹ä¸æˆåŠŸï¼Œåˆ™ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹è¿›è¡Œå°è¯•ï¼Œç›´åˆ°è·å–æˆåŠŸå“åº”æˆ–è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå¯¹æœåŠ¡è°ƒç”¨çš„å¯é æ€§è¦æ±‚è¾ƒé«˜çš„æƒ…å†µï¼Œå¯ä»¥å¢åŠ è°ƒç”¨æˆåŠŸçš„æœºä¼šã€‚</li></ul></li><li>Best Available Ruleï¼ˆæœ€ä½å¹¶å‘è§„åˆ™ï¼‰<ul><li>é€‰æ‹©å¹¶å‘è¯·æ±‚æœ€å°çš„æœåŠ¡å®ä¾‹ã€‚è¿™ä¸ªç­–ç•¥ä¼šè€ƒè™‘åˆ°æœåŠ¡å®ä¾‹çš„å¹¶å‘è¯·æ±‚é‡ï¼Œä¼˜å…ˆé€‰æ‹©å¹¶å‘é‡æœ€å°çš„å®ä¾‹ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºéœ€è¦å¹³è¡¡æœåŠ¡å®ä¾‹è´Ÿè½½ï¼Œé¿å…æŸäº›å®ä¾‹è¿‡è½½çš„åœºæ™¯ã€‚</li></ul></li><li>Availability Filtering Ruleï¼ˆå¯ç”¨æ€§è¿‡æ»¤è§„åˆ™ï¼‰<ul><li>å…ˆè¿‡æ»¤æ‰ä¸€ç›´è¿æ¥å¤±è´¥çš„è¢«æ ‡è®°ä¸ºcircuit trippedçš„æœåŠ¡å®ä¾‹ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„å®ä¾‹ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºéœ€è¦å‰”é™¤ä¸ç¨³å®šæœåŠ¡å®ä¾‹ï¼Œç¡®ä¿æœåŠ¡è°ƒç”¨çš„é«˜å¯ç”¨æ€§ã€‚</li></ul></li><li><strong>Zone Avoidance Rule</strong>ï¼ˆåŒºåŸŸæƒé‡è§„åˆ™ï¼‰<ul><li>ç»¼åˆåŒºåŸŸçš„æ€§èƒ½å’ŒæœåŠ¡å®ä¾‹çš„å¯ç”¨æ€§æ¥é€‰æ‹©æœåŠ¡å™¨ã€‚å°½å¯èƒ½åœ°é€‰æ‹©ä¸€ä¸ªè¾ƒå°‘è´Ÿè½½ä¸”å¯ç”¨æ€§è¾ƒé«˜çš„æœåŠ¡å®ä¾‹ã€‚</li><li>é€‚ç”¨äºè·¨å¤šä¸ªåŒºåŸŸï¼ˆå¦‚AWSåŒºåŸŸï¼‰éƒ¨ç½²çš„æœåŠ¡ï¼Œéœ€è¦è€ƒè™‘åŒºåŸŸæ€§èƒ½å’Œå¯ç”¨æ€§çš„åœºæ™¯ã€‚</li></ul></li></ul><p>ä¸€èˆ¬é—®åˆ°è´Ÿè½½å‡è¡¡å¸¸ç”¨çš„ç­–ç•¥ä¹Ÿå¯ä»¥ä»å¸¸è§çš„å‡ ä¸ªç­–ç•¥è°ˆä¸€ä¸‹ï¼šè½®è¯¢ã€éšæœºã€å“åº”æ—¶é—´æƒé‡ã€åŒºåŸŸæƒé‡ã€‚</p><p>å…·ä½“çš„è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½®æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼š</p><p>åœ¨Spring Cloudåº”ç”¨ä¸­ï¼Œå…·ä½“é…ç½®Ribbonçš„è´Ÿè½½å‡è¡¡ç­–ç•¥é€šå¸¸æ¶‰åŠåˆ°application.propertiesæˆ–application.ymlé…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼Œæˆ–è€…é€šè¿‡ç¼–ç çš„æ–¹å¼è‡ªå®šä¹‰é…ç½®ã€‚</p><p>ä¸‹é¢æ˜¯ä¸¤ç§å¸¸è§çš„é…ç½®æ–¹æ³•ï¼š</p><blockquote><p>é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®</p></blockquote><p>åœ¨<code>application.yml</code>æˆ–<code>application.properties</code>ä¸­ï¼Œå¯ä»¥ä¸ºæ‰€æœ‰æœåŠ¡æˆ–ç‰¹å®šæœåŠ¡è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥</p><p>application.ymlç¤ºä¾‹</p><p>ä¸ºæ‰€æœ‰æœåŠ¡è®¾ç½®è½®è¯¢ç­–ç•¥ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">ribbon:</span><br>  NFLoadBalancerRuleClassName: <span class="hljs-keyword">com</span>.netflix.loadbalancer.RoundRobinRule<br></code></pre></td></tr></table></figure><p>ä¸ºç‰¹å®šæœåŠ¡è®¾ç½®éšæœºç­–ç•¥ï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">user-service</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">ribbon</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">NFLoadBalancerRuleClassName</span><span class="hljs-punctuation">:</span> <span class="hljs-string">com.netflix.loadbalancer.RandomRule</span><br></code></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™Javaé…ç½®ç±»æ¥è‡ªå®šä¹‰Ribbonçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè¿™ç§æ–¹æ³•æ›´åŠ çµæ´»ï¼Œå…è®¸æ›´å¤æ‚çš„é…ç½®ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¸º<code>user-service</code>æœåŠ¡è‡ªå®šä¹‰éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥çš„ä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> com.netflix.loadbalancer.IRule;<br><span class="hljs-keyword">import</span> com.netflix.loadbalancer.RandomRule;<br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RibbonConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> IRule ribbonRule() &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥</span><br>        <span class="hljs-keyword">return</span> new RandomRule();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œä½ éœ€è¦åœ¨<code>application.properties</code>æˆ–<code>application.yml</code>ä¸­æŒ‡å®šè¿™ä¸ªé…ç½®ç±»åº”ç”¨äºå“ªä¸ªæœåŠ¡ï¼š</p><p>application.yml</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">user-service</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">ribbon</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">NFLoadBalancerClassName</span><span class="hljs-punctuation">:</span> <span class="hljs-string">com.example.demo.config.RibbonConfiguration</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ul><li>å½“é€šè¿‡ç¼–ç æ–¹å¼è‡ªå®šä¹‰Ribboné…ç½®æ—¶ï¼Œç¡®ä¿ä¸è¦å°†<code>@Configuration</code>é…ç½®ç±»æ”¾åœ¨ä¸»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„<code>@ComponentScan</code>ä¸­ï¼Œä»¥é¿å…è¯¥é…ç½®æˆä¸ºå…¨å±€é…ç½®ã€‚æ¨èçš„åšæ³•æ˜¯å°†Ribbonçš„é…ç½®ç±»æ”¾åœ¨ä¸»åº”ç”¨ç±»çš„åŒ…å¤–ï¼Œæˆ–è€…æ˜¾å¼æŒ‡å®š<code>@ComponentScan</code>çš„æ‰«æè·¯å¾„æ’é™¤è¿™äº›é…ç½®ã€‚</li><li>Spring Cloudä¸­ï¼ŒFeignå·²é»˜è®¤é›†æˆäº†Ribbonï¼Œæ‰€ä»¥é€šè¿‡Feignè°ƒç”¨æœåŠ¡æ—¶ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨è¿™äº›è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚</li></ul><p>é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥çµæ´»åœ°ä¸ºåº”ç”¨é…ç½®åˆé€‚çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä¼˜åŒ–æœåŠ¡è°ƒç”¨çš„æ€§èƒ½å’Œå¯é æ€§ã€‚</p><h4 id="è®²ä¸€ä¸‹è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è®²ä¸€ä¸‹è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è®²ä¸€ä¸‹è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è®²ä¸€ä¸‹è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</h4><ul><li>ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬å¯ä»¥å®šä¹‰å…¨å±€çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æˆ–è€…é’ˆå¯¹æŸä¸€ä¸ªæœåŠ¡è¿›è¡Œå•ç‹¬çš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰</li><li>æˆ–è€…æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼ŒæŒ‡å®šè‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</li></ul><hr><p>åœ¨ä¸Šæ–‡ä¸­å®é™…å·²ç»è®²è¿°äº†è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å®ç°ï¼š</p><ul><li>1ã€åˆ›å»ºç±»å®ç° IRule æ¥å£ï¼ŒæŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå…¨å±€ï¼‰</li><li>2ã€åœ¨å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®æŸä¸€ä¸ªæœåŠ¡æŒ‡å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå±€éƒ¨ï¼‰</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281439113.png" alt="image.png"></p><blockquote><p>å…³äºã€åˆ›å»ºç±»å®ç° IRule æ¥å£ï¼ŒæŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‘çš„è¿›ä¸€æ­¥è¯´æ˜</p></blockquote><p>é¦–å…ˆæ˜¯è¿™ç§æ–¹å¼å’Œã€åœ¨é…ç½®æ–‡ä»¶ä¸­ä¸ºæ‰€æœ‰æœåŠ¡ç»Ÿä¸€è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‘çš„åŒºåˆ«ï¼š</p><ul><li>1ã€å¯¹äºå¤§å¤šæ•°æ ‡å‡†ä½¿ç”¨åœºæ™¯ï¼Œ<strong>é€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥</strong>æ›´å®¹æ˜“ç®¡ç†å’Œè°ƒæ•´ã€‚å°¤å…¶æ˜¯åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå½“æœåŠ¡æ•°é‡è¾ƒå¤šæ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿç»Ÿä¸€è°ƒæ•´ç­–ç•¥ã€‚ï¼ˆåè€…çš„ä¸€ä¸ªä½œç”¨æ˜¯ç®€åŒ–é…ç½®ï¼‰</li><li>2ã€é€šè¿‡ç¼–ç æ–¹å¼å®ç°<code>IRule</code>æ¥å£ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè¿™ç§æ–¹æ³•æä¾›äº†æé«˜çš„çµæ´»æ€§å’Œæ§åˆ¶åŠ›ã€‚ä½ å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ç¼–å†™è´Ÿè½½å‡è¡¡é€»è¾‘ï¼Œå®ç°ä¸€äº›æ ‡å‡†ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ã€éšæœºï¼‰ä¹‹å¤–çš„ç‰¹æ®Šéœ€æ±‚ã€‚ï¼ˆå‰è€…å¯ä»¥å®šåˆ¶åŒ–ä¸€äº›ç­–ç•¥ï¼Œä¸è¿‡å¤æ‚æ€§ä¼šé«˜ä¸€äº›ï¼‰</li></ul><blockquote><p>é’ˆå¯¹ã€åˆ›å»ºç±»å®ç° IRule æ¥å£ï¼ŒæŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‘æ˜¯å…¨å±€ç”Ÿæ•ˆçš„è¿›ä¸€æ­¥è¯´æ˜</p></blockquote><p>çœ‹äº†ä¸€ç§è§£é‡Šï¼Œæ˜¯è¯´ï¼šå¹¶ä¸æ˜¯éƒ½æ˜¯å…¨å±€ï¼Œä¸€èˆ¬æ˜¯å…¨å±€ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é’ˆå¯¹ç‰¹å®šæœåŠ¡ã€‚</p><p>åˆ›å»ºç±»å®ç°<code>IRule</code>æ¥å£æ¥æŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œç„¶ååœ¨Springé…ç½®ä¸­å°†è¿™ä¸ªè‡ªå®šä¹‰çš„è§„åˆ™åº”ç”¨åˆ°Ribbonå®¢æˆ·ç«¯ä¸Šï¼Œè¿™ç§åšæ³•å¯ä»¥æ˜¯å…¨å±€çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯é’ˆå¯¹ç‰¹å®šæœåŠ¡çš„ï¼Œå…·ä½“å–å†³äºå¦‚ä½•é…ç½®è¿™ä¸ªè‡ªå®šä¹‰è§„åˆ™ã€‚</p><p>å…¨å±€é…ç½®</p><p>å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªå®ç°<code>IRule</code>æ¥å£çš„ç±»æ¥å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¹¶ä¸”åœ¨Springçš„ä¸»é…ç½®ç±»ï¼ˆ<code>@SpringBootApplication</code>æ‰€åœ¨çš„ç±»ï¼‰ä¸­é€šè¿‡<code>@Bean</code>æ³¨è§£æ³¨å†Œäº†è¿™ä¸ªè§„åˆ™ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«åº”ç”¨ä¸ºå…¨å±€çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚</p><p>è¿™æ„å‘³ç€æ‰€æœ‰ä½¿ç”¨Ribbonå®¢æˆ·ç«¯è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„åœ°æ–¹éƒ½ä¼šä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">RibbonConfiguration</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> IRule ribbonRule() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">MyCustomRule</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç‰¹å®šæœåŠ¡é…ç½®</p><p>å¦‚æœä½ æƒ³è¦å°†è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥åº”ç”¨åˆ°ç‰¹å®šçš„æœåŠ¡ä¸Šï¼Œè€Œä¸æ˜¯å…¨å±€åº”ç”¨ï¼Œä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªRibbonçš„é…ç½®ç±»å¹¶ä½¿ç”¨<code>@RibbonClient</code>æ³¨è§£æ¥æŒ‡å®šè¿™ä¸ªé…ç½®ç±»åº”ç”¨åˆ°å“ªä¸ªæœåŠ¡ä¸Šã€‚è¿™ä¸ªé…ç½®ç±»ä¸åº”è¯¥è¢«ä¸»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„<code>@ComponentScan</code>æ‰€æ‰«æï¼Œä»¥é¿å…å®ƒæˆä¸ºå…¨å±€é…ç½®ã€‚é€šå¸¸ï¼Œè¿™æ„å‘³ç€å°†è¿™ä¸ªé…ç½®ç±»æ”¾åœ¨ä¸»åº”ç”¨ç¨‹åºç±»æ‰€åœ¨åŒ…çš„å¤–é¢ï¼Œæˆ–è€…åœ¨<code>@ComponentScan</code>æ³¨è§£ä¸­æ˜¾å¼æ’é™¤å®ƒã€‚</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRibbonConfiguration</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> IRule ribbonRule() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">MyCustomRuleForUserService</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@RibbonClient</span>(name = <span class="hljs-string">&quot;user-service&quot;</span>, configuration = UserRibbonConfiguration.class)<br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">ServiceConfig</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyCustomRuleForUserService</code>åªä¼šåº”ç”¨åˆ°<code>user-service</code>æœåŠ¡ä¸Šï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–æœåŠ¡ã€‚</p><p>åŒºåˆ«</p><ul><li><strong>å…¨å±€é…ç½®</strong>ï¼šé€šè¿‡åœ¨Springä¸»é…ç½®ä¸­æ³¨å†Œè‡ªå®šä¹‰<code>IRule</code>å®ç°ï¼Œå®ƒä¼šè¢«åº”ç”¨åˆ°æ‰€æœ‰é€šè¿‡Ribbonè°ƒç”¨çš„æœåŠ¡ä¸Šã€‚è¿™ç§æ–¹å¼ç®€å•ï¼Œä½†ç¼ºä¹é’ˆå¯¹æ€§ã€‚</li><li><strong>ç‰¹å®šæœåŠ¡é…ç½®</strong>ï¼šé€šè¿‡ä¸ºç‰¹å®šæœåŠ¡åˆ›å»ºç‹¬ç«‹çš„Ribboné…ç½®ç±»å¹¶ä½¿ç”¨<code>@RibbonClient</code>æ³¨è§£æ¥æŒ‡å®šï¼Œå¯ä»¥å®ç°å¯¹ä¸åŒæœåŠ¡ä½¿ç”¨ä¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚è¿™ç§æ–¹å¼æä¾›äº†æ›´é«˜çš„çµæ´»æ€§å’Œé’ˆå¯¹æ€§ã€‚</li></ul><h4 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h4><p>è·å– URLè·¯å¾„</p><h4 id="Ribbon-çš„åº•å±‚åŸç†-ğŸš©"><a href="#Ribbon-çš„åº•å±‚åŸç†-ğŸš©" class="headerlink" title="Ribbon çš„åº•å±‚åŸç†  ğŸš©"></a>Ribbon çš„åº•å±‚åŸç†  ğŸš©</h4><p>Ribbon çš„åº•å±‚åŸç†åŒ…æ‹¬<strong>è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ã€åº”ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©æœåŠ¡å®ä¾‹</strong>ã€æä¾›é‡è¯•æœºåˆ¶ä»¥åŠä¸æœåŠ¡å‘ç°ç»„ä»¶çš„é›†æˆã€‚</p><p>é€šè¿‡è¿™äº›æœºåˆ¶ï¼ŒRibbon å¯ä»¥åœ¨å®¢æˆ·ç«¯å®ç°é«˜æ•ˆçš„è´Ÿè½½å‡è¡¡ï¼Œä½¿å¾—åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡è°ƒç”¨æ›´åŠ ç¨³å®šå’Œé«˜æ•ˆã€‚</p><h3 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h3><h4 id="è®²ä¸€ä¸‹-hystrix-çš„ä½œç”¨"><a href="#è®²ä¸€ä¸‹-hystrix-çš„ä½œç”¨" class="headerlink" title="è®²ä¸€ä¸‹ hystrix çš„ä½œç”¨"></a>è®²ä¸€ä¸‹ hystrix çš„ä½œç”¨</h4><ul><li>Hystrixéš”ç¦»ã€ç†”æ–­å’Œé™çº§</li></ul><blockquote><p>ä¸€èˆ¬å¦‚ä½•ä½¿ç”¨çš„</p></blockquote><p>ä½¿ç”¨ç¤ºä¾‹</p><p>åœ¨ Spring Boot åº”ç”¨çš„ä¸»ç±»ä¸Šæ·»åŠ  <code>@EnableFeignClients</code> å’Œ <code>@EnableHystrix</code> æ³¨è§£ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootApplication</span><br><span class="hljs-variable">@EnableFeignClients</span><br><span class="hljs-variable">@EnableHystrix</span><br>public class Application &#123;<br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) &#123;<br>        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(Application.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>@FeignClient</code> æ³¨è§£å®šä¹‰ Feign å®¢æˆ·ç«¯æ¥å£ï¼Œå¹¶æŒ‡å®šé™çº§å¤„ç†ç±»</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestMapping;<br><br><span class="hljs-meta">@FeignClient(name = <span class="hljs-string">&quot;service-provider&quot;</span>, fallback = HelloClientFallback.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HelloClient</span> &#123;<br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/hello&quot;</span>)</span><br>    String sayHello();<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªå®ç° <code>HelloClient</code> æ¥å£çš„é™çº§å¤„ç†ç±»ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloClientFallback</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">HelloClient</span></span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> sayHello() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Fallback response&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨ Feign å®¢æˆ·ç«¯ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> HelloClient helloClient;<br><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/hello&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> String hello() &#123;<br>        <span class="hljs-keyword">return</span> helloClient.sayHello();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æœåŠ¡é›ªå´©æ˜¯ä»€ä¹ˆ"><a href="#æœåŠ¡é›ªå´©æ˜¯ä»€ä¹ˆ" class="headerlink" title="æœåŠ¡é›ªå´©æ˜¯ä»€ä¹ˆ"></a>æœåŠ¡é›ªå´©æ˜¯ä»€ä¹ˆ</h4><p>æœåŠ¡é›ªå´©æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸€ä¸ªå¸¸è§çš„é—®é¢˜ï¼ŒæŒ‡çš„æ˜¯å½“æŸä¸ªï¼ˆæˆ–æŸäº›ï¼‰å¾®æœåŠ¡ä¸å¯ç”¨æˆ–å“åº”æ—¶é—´è¿‡é•¿æ—¶ï¼Œä¼šå¯¼è‡´è°ƒç”¨è¯¥æœåŠ¡çš„å…¶ä»–æœåŠ¡ä¹Ÿè·Ÿç€å˜æ…¢æˆ–ä¸å¯ç”¨ï¼Œè¿™ç§æƒ…å†µä¼šåƒé›ªå´©ä¸€æ ·å‘æ•´ä¸ªç³»ç»Ÿè”“å»¶ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚</p><ul><li>æœåŠ¡é›ªå´©ï¼šä¸€ä¸ªæœåŠ¡å¤±è´¥ï¼Œå·è‡´æ•´æ¡çº¿è·¯çš„æœåŠ¡éƒ½å¤±è´¥çš„æƒ…å½¢</li><li>è§£å†³æ–¹æ¡ˆ<ul><li>æœåŠ¡é™çº§ï¼šæœåŠ¡è‡ªæˆ‘ä¿æŠ¤çš„ä¸€ç§æ–¹å¼ï¼Œæˆ–è€…ä¿æŠ¤ä¸‹æ¸¸æœåŠ¡çš„ä¸€ç§æ–¹å¼ï¼Œç”¨äºç¡®ä¿æœåŠ¡ä¸ä¼šå—è¯·æ±‚çªå¢å½±å“å˜å¾—ä¸å¯ç”¨ï¼Œç¡®ä¿æœåŠ¡ä¸ä¼šå´©æºƒï¼Œ<strong>ä¸€èˆ¬åœ¨å®æ ‡å¼€å‘ä¸­ä¸ feign æ¥å£æ•´åˆï¼Œç¼–å†™é™çº§é€»è¾‘</strong></li><li>æœåŠ¡ç†”æ–­ï¼šé»˜è®¤å…³é—­ã€‚éœ€è¦æ‰‹åŠ¨æ‰“å¼€ï¼Œå¦‚æœæ£€æµ‹åˆ°10ç§’å†…è¯·æ±‚çš„å¤±è´¥ç‡è¶…è¿‡50%ï¼Œå°±è§¦å‘ç†”æ–­æœºåˆ«ã€‚ä¹‹å<strong>æ¯éš” 5ç§’é‡æ–°å°è¯•è¯·æ±‚</strong>å¾®æœåŠ¡ï¼Œå¦‚æœå¾®æœåŠ¡ä¸èƒ½å“åº”ï¼Œç»§ç»­èµ°ç†”æ–­æœºåˆ¶ï¼Œå¦‚æœå¾®æœåŠ¡å¯è¾¾ï¼Œåˆ™å…³é—­ç†”æ–­æœºåˆ¶ï¼Œæ¢å¤æ­£å¸¸è¯·æ±‚</li></ul></li></ul><p>æœåŠ¡é›ªå´©</p><ul><li>å¦‚æœæŸä¸ªæœåŠ¡ä¸å¯ç”¨ï¼Œä¾èµ–è¯¥æœåŠ¡çš„å…¶ä»–æœåŠ¡ä¹Ÿæ— æ³•æ­£å¸¸å·¥ä½œï¼Œä»è€Œå¯¼è‡´æ•´ä¸ªä¾èµ–é“¾ä¸­çš„æœåŠ¡éƒ½ä¸å¯ç”¨</li><li>å¯èƒ½é€ æˆç°è±¡çš„åŸæœ‰<ul><li>1ã€èµ„æºè€—å°½ï¼Œè¯·æ±‚é‡å¤ªå¤§äº†ï¼ŒæœåŠ¡å¤„ç†ä¸è¿‡æ¥ï¼ˆæ²¡æœ‰è¿›è¡Œé™æµï¼‰</li><li>2ã€æœåŠ¡æŒ‚äº†</li><li>3ã€é…ç½®é—®é¢˜</li></ul></li></ul><h3 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h3><h4 id="è®²ä¸€ä¸‹-ç½‘å…³çš„ä½œç”¨"><a href="#è®²ä¸€ä¸‹-ç½‘å…³çš„ä½œç”¨" class="headerlink" title="è®²ä¸€ä¸‹ ç½‘å…³çš„ä½œç”¨"></a>è®²ä¸€ä¸‹ ç½‘å…³çš„ä½œç”¨</h4><ul><li>ç½‘å…³ï¼šå¦‚æœå‰ç«¯ã€ç§»åŠ¨ç«¯è¦è°ƒç”¨åç«¯ç³»ç»Ÿï¼Œç»Ÿä¸€ä»ç½‘å…³è¿›å…¥ï¼Œç”±ç½‘å…³è½¬å‘è¯·æ±‚ç»™å¯¹åº”çš„æœåŠ¡</li></ul><p>Eureka é‚£ä¸€å¥—çš„æµç¨‹ï¼Œæ€è·¯å¯ä»¥å€Ÿé‰´ä¸€ä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240515122004.png" alt="image.png"></p><p>Spring Cloud Gateway æ˜¯ä¸€ä¸ªåŸºäº Spring WebFlux æ¡†æ¶çš„API ç½‘å…³ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•ä¸”æœ‰æ•ˆçš„æ–¹å¼æ¥è·¯ç”±è¯·æ±‚ã€å¤„ç†è®¤è¯ä¸æˆæƒã€è¿›è¡Œè´Ÿè½½å‡è¡¡ã€ç›‘æ§å’Œé™æµç­‰æ“ä½œ.</p><p>æ ¸å¿ƒç»„ä»¶</p><ul><li>Route è·¯ç”±<ul><li><strong>Route</strong> æ˜¯ Gateway ä¸­çš„åŸºæœ¬æ„å»ºå—ã€‚æ¯ä¸ª Route éƒ½å®šä¹‰äº†ä¸€ä¸ªåŒ¹é…çš„æ¡ä»¶ï¼ˆPredicateï¼‰å’Œä¸€ä¸ªå¤„ç†è¯·æ±‚çš„é€»è¾‘ï¼ˆFilterï¼‰</li><li>Route åŒ…å«ï¼š<ul><li><strong>ID</strong>ï¼šå”¯ä¸€æ ‡è¯†è·¯ç”±çš„å­—ç¬¦ä¸²ã€‚</li><li><strong>URI</strong>ï¼šç›®æ ‡æœåŠ¡çš„åœ°å€ã€‚</li><li><strong>Predicates</strong>ï¼šä¸€ç»„æ¡ä»¶ï¼Œç”¨äºåŒ¹é…è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œæ ¹æ®è¯·æ±‚è·¯å¾„ã€æ–¹æ³•ã€å¤´éƒ¨ç­‰è¿›è¡ŒåŒ¹é…ã€‚</li><li><strong>Filters</strong>ï¼šä¸€ç»„è¿‡æ»¤å™¨ï¼Œç”¨äºå¯¹è¯·æ±‚æˆ–å“åº”è¿›è¡Œå¤„ç†</li></ul></li></ul></li><li>Predicate  è°“è¯<ul><li>Predicate ç”¨äºåŒ¹é…è¿›å…¥çš„ HTTP è¯·æ±‚ã€‚å¦‚æœè¯·æ±‚åŒ¹é…ï¼Œåˆ™è¯¥è¯·æ±‚ä¼šè¢«è·¯ç”±åˆ°æŒ‡å®šçš„ URIã€‚</li><li>å¸¸è§çš„è°“è¯æœ‰ï¼šè·¯å¾„åŒ¹é…ã€å¤´éƒ¨åŒ¹é…ã€æ–¹æ³•åŒ¹é…ç­‰ã€‚</li></ul></li><li>Filter è¿‡æ»¤å™¨<ul><li>Filter ç”¨äºå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œå¤„ç†ã€‚å¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œå„ç§æ“ä½œï¼Œä¾‹å¦‚ä¿®æ”¹è¯·æ±‚å¤´ã€é™æµã€æ—¥å¿—è®°å½•ç­‰ã€‚</li><li>è¿‡æ»¤å™¨åˆ†ä¸ºä¸¤ç±»ï¼š<ul><li><strong>Global Filters</strong>ï¼šå…¨å±€è¿‡æ»¤å™¨ï¼Œä½œç”¨äºæ‰€æœ‰è·¯ç”±ã€‚</li><li><strong>Route-Specific Filters</strong>ï¼šç‰¹å®šè·¯ç”±çš„è¿‡æ»¤å™¨ï¼Œåªä½œç”¨äºæŒ‡å®šçš„è·¯ç”±ã€‚</li></ul></li></ul></li></ul><p>å·¥ä½œæµç¨‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240515141756.png" alt="image.png"></p><p>ç¤ºä¾‹</p><p>åœ¨ <code>application.yml</code> ä¸­é…ç½®è·¯ç”±ç¤ºä¾‹ï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">spring</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">cloud</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">gateway</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">routes</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">id: example_route</span><br>          <span class="hljs-attribute">uri</span><span class="hljs-punctuation">:</span> <span class="hljs-string">http://example.com</span><br>          <span class="hljs-attribute">predicates</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/example/**</span><br>          <span class="hljs-attribute">filters</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=Example, HeaderValue</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼š</p><ul><li>å®šä¹‰äº†ä¸€ä¸ª ID ä¸º <code>example_route</code> çš„è·¯ç”±ã€‚</li><li>å½“è¯·æ±‚è·¯å¾„åŒ¹é… <code>/example/**</code> æ—¶ï¼Œè¯·æ±‚ä¼šè¢«è½¬å‘åˆ° <code>http://example.com</code>ã€‚</li><li>åœ¨è¯·æ±‚è¢«è½¬å‘ä¹‹å‰ï¼Œä¼šæ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ <code>Example: HeaderValue</code></li></ul><p>æ ¸å¿ƒåŠŸèƒ½</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240515141953.png" alt="image.png"></p><ul><li>æ—¥å¿—è®°å½•<ul><li>ä¸€èˆ¬ä¼šå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ GlobalFilterï¼ˆç»§æ‰¿ï¼‰ï¼Œç„¶åé‡å†™ filter æ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­è®°å½•è¯·æ±‚å’Œå“åº”æ—¥å¿—</li></ul></li><li>åŠ¨æ€è·¯ç”±<ul><li>ä¸€èˆ¬ç»“åˆ nacos ä½¿ç”¨</li></ul></li><li>è´Ÿè½½å‡è¡¡<ul><li>ç»“åˆ Openfeign ä½¿ç”¨ï¼Œå¸¸è§çš„ä¸€ç§ç”¨æ³•</li></ul></li></ul><blockquote><p>åŠ¨æ€è·¯ç”±</p></blockquote><p>åœ¨ <code>application.yml</code> ä¸­é…ç½® Nacosã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">locator:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>åœ¨ Nacos æ§åˆ¶å°ä¸­ï¼Œåˆ›å»ºæˆ–ä¿®æ”¹è·¯ç”±é…ç½®ï¼Œæ ¼å¼ä¸ <code>application.yml</code> ç±»ä¼¼ã€‚</p><blockquote><p>è´Ÿè½½å‡è¡¡</p></blockquote><p>Spring Cloud Gateway é»˜è®¤ä½¿ç”¨ Spring Cloud LoadBalancer è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é…ç½®å’Œä½¿ç”¨ç¤ºä¾‹</p><p>åœ¨ <code>application.yml</code> ä¸­é…ç½®è´Ÿè½½å‡è¡¡ã€‚</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">spring</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">cloud</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">gateway</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">routes</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">id: loadbalancer_route</span><br>          <span class="hljs-attribute">uri</span><span class="hljs-punctuation">:</span> <span class="hljs-string">lb://service-provider</span><br>          <span class="hljs-attribute">predicates</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/loadbalancer/**</span><br>          <span class="hljs-attribute">filters</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=LoadBalancer, HeaderValue</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œ <code>lb://service-provider</code> è¡¨ç¤ºå°†è¯·æ±‚è´Ÿè½½å‡è¡¡åˆ° <code>service-provider</code> æœåŠ¡å®ä¾‹ä¸Š</p><h4 id="Gateway-åŸç†å¤§æ¦‚è®²ä¸€ä¸‹"><a href="#Gateway-åŸç†å¤§æ¦‚è®²ä¸€ä¸‹" class="headerlink" title="Gateway åŸç†å¤§æ¦‚è®²ä¸€ä¸‹"></a>Gateway åŸç†å¤§æ¦‚è®²ä¸€ä¸‹</h4><ol><li>è¯·æ±‚åŒ¹é…</li></ol><p>å½“å®¢æˆ·ç«¯å‘å‡º HTTP è¯·æ±‚æ—¶ï¼ŒGateway ä¼šæ ¹æ®é…ç½®çš„ Route å’Œ Predicate å¯¹è¯·æ±‚è¿›è¡ŒåŒ¹é…ã€‚åŒ¹é…è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p><strong>Predicate Matching</strong>ï¼šGateway ä¼šéå†æ‰€æœ‰çš„è·¯ç”±ï¼Œæ ¹æ® Predicate å¯¹è¯·æ±‚è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è·¯ç”±ã€‚</p></li><li><p><strong>Filter Execution</strong>ï¼šå¯¹äºåŒ¹é…çš„è·¯ç”±ï¼Œæ‰§è¡Œå…¶é…ç½®çš„ Filter ä»¥åŠå…¨å±€ Filterã€‚</p></li><li><p><strong>Request Forwarding</strong>ï¼šå¤„ç†å®Œè¿‡æ»¤å™¨åï¼Œå°†è¯·æ±‚è½¬å‘åˆ° Route å®šä¹‰çš„ç›®æ ‡ URIï¼ˆç›®æ ‡æœåŠ¡ï¼‰ã€‚</p></li><li><p>è¯·æ±‚å¤„ç†æµç¨‹</p></li><li><p><strong>å®¢æˆ·ç«¯è¯·æ±‚</strong>ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ª HTTP è¯·æ±‚åˆ° Gatewayã€‚</p></li><li><p><strong>è¯·æ±‚åŒ¹é…</strong>ï¼šGateway æ ¹æ®å®šä¹‰çš„ Route å’Œ Predicate å¯¹è¯·æ±‚è¿›è¡ŒåŒ¹é…ã€‚</p></li><li><p><strong>è¿‡æ»¤å™¨é“¾</strong>ï¼šå¦‚æœè¯·æ±‚åŒ¹é…æŸä¸ª Routeï¼ŒGateway ä¼šæ‰§è¡Œè¯¥ Route ä¸Šå®šä¹‰çš„ Filter ä»¥åŠå…¨å±€ Filterã€‚</p></li><li><p><strong>è¯·æ±‚è½¬å‘</strong>ï¼šç»è¿‡è¿‡æ»¤å™¨é“¾å¤„ç†åï¼Œè¯·æ±‚ä¼šè¢«è½¬å‘åˆ° Route å®šä¹‰çš„ URIï¼ˆç›®æ ‡æœåŠ¡ï¼‰ã€‚</p></li><li><p><strong>å“åº”å¤„ç†</strong>ï¼šç›®æ ‡æœåŠ¡è¿”å›å“åº”ï¼ŒGateway ä¼šå†ç»è¿‡è¿‡æ»¤å™¨é“¾å¤„ç†å“åº”ï¼Œç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p></li></ol><h4 id="Gateway-çš„ç‰ˆæœ¬åŒºåˆ†"><a href="#Gateway-çš„ç‰ˆæœ¬åŒºåˆ†" class="headerlink" title="Gateway çš„ç‰ˆæœ¬åŒºåˆ†"></a>Gateway çš„ç‰ˆæœ¬åŒºåˆ†</h4><blockquote><p>ç‰ˆæœ¬å·®å¼‚</p></blockquote><ul><li><strong>2.0.x ç‰ˆæœ¬</strong>ï¼šå¼•å…¥äº†åŸºäºWebFluxçš„ååº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œä¸å†ä½¿ç”¨ä¼ ç»Ÿçš„Servlet APIã€‚æä¾›äº†åŸºæœ¬çš„è·¯ç”±ã€è¿‡æ»¤åŠŸèƒ½ã€‚</li><li><strong>2.1.x ç‰ˆæœ¬</strong>ï¼šå¢åŠ äº†å¯¹WebSocketçš„æ”¯æŒï¼Œæ”¹è¿›äº†è·¯ç”±æ–­è¨€å’Œè¿‡æ»¤å™¨çš„åŠŸèƒ½ã€‚</li><li><strong>2.2.x ç‰ˆæœ¬</strong>ï¼šå¼•å…¥äº†æ›´å¤šçš„è·¯ç”±æ–­è¨€å’Œè¿‡æ»¤å™¨ï¼Œå¢å¼ºäº†å®‰å…¨æ€§å’Œå¯ç®¡ç†æ€§ã€‚</li><li><strong>3.0.x ç‰ˆæœ¬</strong>ï¼šæ›´æ–°äº†åº•å±‚çš„Spring Bootå’ŒSpring Frameworkçš„ç‰ˆæœ¬ï¼Œæ”¯æŒæœ€æ–°çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</li></ul><p>ä¸€èˆ¬è¯´æˆ‘ä»¬å¸¸è§çš„æ˜¯2.2 ç‰ˆæœ¬å°±è¡Œ</p><h3 id="Sentinel"><a href="#Sentinel" class="headerlink" title="Sentinel"></a>Sentinel</h3><h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>Sentinel çš„é™æµä¸»è¦æ˜¯é€šè¿‡åœ¨æ–¹æ³•æˆ–æ¥å£å‰åå¢åŠ æ‹¦æˆªé€»è¾‘æ¥å®ç°çš„ã€‚å½“è¯·æ±‚è¾¾åˆ°æŸä¸ªæ¥å£æˆ–æ–¹æ³•æ—¶ï¼ŒSentinel ä¼šæ£€æŸ¥å½“å‰çš„è¯·æ±‚æµé‡æ˜¯å¦è¶…è¿‡äº†é¢„è®¾çš„é™æµè§„åˆ™ï¼Œå¦‚æœè¶…è¿‡åˆ™è¿›è¡Œé™æµå¤„ç†ï¼ˆå¦‚æ‹’ç»è¯·æ±‚ã€æ’é˜Ÿç­‰ï¼‰</p><p>ä¸»è¦çš„é™æµæ–¹å¼</p><ol><li><strong>QPSï¼ˆQueries Per Secondï¼‰é™æµ</strong>ï¼šåŸºäºæ¯ç§’è¯·æ±‚æ¬¡æ•°çš„é™æµã€‚</li><li><strong>çº¿ç¨‹æ•°é™æµ</strong>ï¼šåŸºäºå¹¶å‘çº¿ç¨‹æ•°çš„é™æµã€‚</li><li><strong>æµæ§æ’é˜Ÿæ¨¡å¼</strong>ï¼šåŸºäºæ’é˜Ÿç­‰å¾…æ—¶é—´çš„é™æµ</li></ol><p>Sentinel æ§åˆ¶å°æä¾›äº†å¯è§†åŒ–çš„é™æµè§„åˆ™é…ç½®ç•Œé¢ï¼Œå¯ä»¥åŠ¨æ€è°ƒæ•´é™æµè§„åˆ™ã€‚</p><ul><li>1ã€æ§åˆ¶å°</li><li>2ã€ä»£ç é…ç½®</li><li>3ã€é…ç½®ç±»</li></ul><h3 id="Zipkin"><a href="#Zipkin" class="headerlink" title="Zipkin"></a>Zipkin</h3><ul><li>æŸ¥è¯¢æœåŠ¡é“¾è·¯ï¼Œå¹¶æ’æŸ¥é—®é¢˜</li><li>ç›‘å¬æœåŠ¡é—®é¢˜ï¼Œå¹¶åŠæ—¶åé¦ˆ</li></ul><h3 id="Xxl-job"><a href="#Xxl-job" class="headerlink" title="Xxl-job"></a>Xxl-job</h3><h4 id="ä½ ä»¬é¡¹ç›®ä¸­ä½¿ç”¨äº†ä»€ä¹ˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦"><a href="#ä½ ä»¬é¡¹ç›®ä¸­ä½¿ç”¨äº†ä»€ä¹ˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦" class="headerlink" title="ä½ ä»¬é¡¹ç›®ä¸­ä½¿ç”¨äº†ä»€ä¹ˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦"></a>ä½ ä»¬é¡¹ç›®ä¸­ä½¿ç”¨äº†ä»€ä¹ˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234452.png" alt="image.png"></p><h4 id="xxl-job-è·¯ç”±ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"><a href="#xxl-job-è·¯ç”±ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="xxl-job è·¯ç”±ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ"></a>xxl-job è·¯ç”±ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>è½®è¯¢ã€æ•…éšœè½¬ç§»ã€åˆ†ç‰‡å¹¿æ’­</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234546.png" alt="image.png"></p><h4 id="xxl-job-ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#xxl-job-ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="xxl-job ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ€ä¹ˆè§£å†³ï¼Ÿ"></a>xxl-job ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ€ä¹ˆè§£å†³ï¼Ÿ</h4><p>é‡è¯• + å‘Šè­¦</p><p>è®¾ç½®æ•…éšœè½¬ç§» + å¤±è´¥é‡è¯•ï¼ŒæŸ¥çœ‹æ—¥å¿—åˆ†æ   â†’   é‚®ä»¶å‘Šè­¦</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234701.png" alt="image.png"></p><h4 id="å¦‚æœæœ‰å¤§æ•°æ®é‡çš„ä»»åŠ¡åŒæ—¶éƒ½éœ€è¦æ‰§è¡Œï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#å¦‚æœæœ‰å¤§æ•°æ®é‡çš„ä»»åŠ¡åŒæ—¶éƒ½éœ€è¦æ‰§è¡Œï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="å¦‚æœæœ‰å¤§æ•°æ®é‡çš„ä»»åŠ¡åŒæ—¶éƒ½éœ€è¦æ‰§è¡Œï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ"></a>å¦‚æœæœ‰å¤§æ•°æ®é‡çš„ä»»åŠ¡åŒæ—¶éƒ½éœ€è¦æ‰§è¡Œï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ</h4><p>åˆ†ç‰‡å¹¿æ’­ç­–ç•¥</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234936.png" alt="image.png"></p><p>é¢è¯•é¢˜å›ç­”ï¼›</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228235033.png" alt="image.png"></p><h3 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h3><h4 id="è®²ä¸€ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹æ¡ˆæœ‰å“ªäº›ï¼Œä½ ä»¬é¡¹ç›®ä¸­æ€ä¹ˆå¤„ç†çš„"><a href="#è®²ä¸€ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹æ¡ˆæœ‰å“ªäº›ï¼Œä½ ä»¬é¡¹ç›®ä¸­æ€ä¹ˆå¤„ç†çš„" class="headerlink" title="è®²ä¸€ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹æ¡ˆæœ‰å“ªäº›ï¼Œä½ ä»¬é¡¹ç›®ä¸­æ€ä¹ˆå¤„ç†çš„"></a>è®²ä¸€ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹æ¡ˆæœ‰å“ªäº›ï¼Œä½ ä»¬é¡¹ç›®ä¸­æ€ä¹ˆå¤„ç†çš„</h4><p>å‚è€ƒè¿™ç¯‡æ–‡ç« æ•´åˆä¸€ä¸‹ç›¸å…³å†…å®¹ï¼š <a href="https://www.yuque.com/snailclimb/mf2z3k/ng9vmg">https://www.yuque.com/snailclimb/mf2z3k/ng9vmg</a></p><ul><li>ç®€å†ä¸Šå†™çš„å¾®æœåŠ¡ï¼Œåªè¦æ˜¯å‘ç”Ÿäº†å¤šä¸ªæœåŠ¡ä¹‹é—´çš„<strong>å†™æ“ä½œ</strong>ï¼Œéƒ½éœ€è¦è¿›è¡Œåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶</li><li>æè¿°é¡¹ç›®ä¸­é‡‡ç”¨çš„é‚£ç§æ–¹æ¡ˆ(seata|MQ)<ul><li>1.seataçš„XAæ¨¡å¼ï¼ŒCP,éœ€è¦äº’ç›¸ç­‰å¾…å„ä¸ªåˆ†æ”¯äº‹åŠ¡æäº¤ï¼Œå¯ä»¥ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œæ€§èƒ½å·®      é“¶è¡Œä¸šåŠ¡</li><li>2.seataçš„ATæ¨¡å¼ï¼ŒAP,åº•å±‚ä½¿ç”¨undo logå®ç°ï¼Œæ€§èƒ½å¥½                          äº’è”ç½‘ä¸šåŠ¡</li><li><ol start="3"><li>seataçš„TCCæ¨¡å¼ï¼ŒAP,æ€§èƒ½è¾ƒå¥½ï¼Œä¸è¿‡éœ€è¦äººå·¥ç¼–ç å®ç°                   é“¶è¡Œä¸šåŠ¡</li></ol></li></ul></li><li>4.MQæ¨¡å¼å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œåœ¨AæœåŠ¡å†™æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…å‘é€æ¶ˆæ¯åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡ï¼Œå¼‚æ­¥ï¼Œæ€§èƒ½æœ€å¥½                                                äº’è”ç½‘ä¸šåŠ¡</li></ul><hr><p>å¾®æœåŠ¡é¡¹ç›®</p><ul><li>Seata æ¡†æ¶ï¼ˆXAã€ATã€TCCï¼‰</li><li>MQ</li></ul><blockquote><p>Seata   ğŸ“•</p></blockquote><p>Seataæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨æä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚</p><p>åœ¨Seataä¸­ï¼Œä¸»è¦æä¾›äº†ä¸‰ç§äº‹åŠ¡æ¨¡å¼ï¼šXAã€ATå’ŒTCCï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡éœ€æ±‚ã€‚</p><hr><blockquote><p>Seata æ¶æ„</p></blockquote><p>Seataäº‹åŠ¡ç®¡ç†ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„è§’è‰²ï¼š</p><ul><li>TC(Transaction Coordinator)-äº‹åŠ¡åè°ƒè€…ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œåè°ƒå…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</li><li>TM(Transaction Manager)-äº‹åŠ¡ç®¡ç†å™¨ï¼šå®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ã€å¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</li><li>RM(Resource Manager)-èµ„æºç®¡ç†å™¨ï¼šç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228213922.png" alt="image.png"></p><p>Seata ä¸­æœ‰ä¸‰ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ XAã€AT å’Œ TCC</p><ul><li>XA  æ¨¡å¼</li><li>AT  æ¨¡å¼</li><li>TCC æ¨¡å¼</li></ul><p><strong>XA æ¨¡å¼</strong></p><p>XAæ¨¡å¼åŸºäºXAåè®®å®ç°ï¼Œæ˜¯ä¸€ç§ä¸¤é˜¶æ®µæäº¤çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚XAæ¨¡å¼æ¶‰åŠåˆ°äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼‰ã€èµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰å’Œäº‹åŠ¡åè°ƒè€…ï¼ˆTCï¼‰ä¸‰ä¸ªè§’è‰²ã€‚</p><ul><li><strong>ç¬¬ä¸€é˜¶æ®µï¼ˆå‡†å¤‡é˜¶æ®µï¼‰</strong>ï¼šäº‹åŠ¡ç®¡ç†å™¨æŒ‡ç¤ºæ‰€æœ‰å‚ä¸å½“å‰äº‹åŠ¡çš„èµ„æºç®¡ç†å™¨å‡†å¤‡æäº¤äº‹åŠ¡ã€‚</li><li><strong>ç¬¬äºŒé˜¶æ®µï¼ˆæäº¤&#x2F;å›æ»šé˜¶æ®µï¼‰</strong>ï¼šå¦‚æœæ‰€æœ‰èµ„æºç®¡ç†å™¨éƒ½å‡†å¤‡å°±ç»ªï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¼šæŒ‡ç¤ºå®ƒä»¬æäº¤äº‹åŠ¡ï¼›å¦‚æœä»»ä½•èµ„æºç®¡ç†å™¨ä¸èƒ½å‡†å¤‡å°±ç»ªï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¼šæŒ‡ç¤ºæ‰€æœ‰èµ„æºç®¡ç†å™¨å›æ»šäº‹åŠ¡ã€‚</li></ul><p>XAæ¨¡å¼ä¿è¯äº†è·¨æ•°æ®åº“å’Œç³»ç»Ÿçš„äº‹åŠ¡ä¸€è‡´æ€§ï¼Œä½†å®ç°å¤æ‚ï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228214142.png" alt="image.png"></p><p>AT æ¨¡å¼</p><p>ATæ¨¡å¼æ˜¯Seataè‡ªä¸»åˆ›æ–°çš„ä¸€ç§äº‹åŠ¡æ¨¡å¼ï¼Œå…¨ç§°ä¸ºAutomatic Transactionï¼Œå³è‡ªåŠ¨åŒ–äº‹åŠ¡æ¨¡å¼ã€‚å®ƒé€šè¿‡å¯¹æ•°æ®è¿›è¡Œå‰åé•œåƒè®°å½•æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><ul><li><strong>æäº¤äº‹åŠ¡</strong>ï¼šåœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œå¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œåˆ™ç›´æ¥æäº¤äº‹åŠ¡ï¼›å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œåˆ©ç”¨é•œåƒè®°å½•è¿›è¡Œå›æ»šã€‚</li><li><strong>å›æ»šäº‹åŠ¡</strong>ï¼šåœ¨å›æ»šæ—¶ï¼Œåˆ©ç”¨ä¹‹å‰è®°å½•çš„å‰é•œåƒå’Œåé•œåƒè¿›è¡Œæ•°æ®çš„æ¢å¤ã€‚</li></ul><p>ATæ¨¡å¼ä¸ä¾èµ–XAåè®®ï¼Œå…·æœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼Œæ˜“äºç†è§£å’Œä½¿ç”¨ï¼Œæ˜¯Seataä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„æ¨¡å¼ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228214546.png" alt="image.png"></p><p>TCC æ¨¡å¼</p><p>TCCæ¨¡å¼å³Try-Confirm-Cancelæ¨¡å¼ï¼Œæ˜¯ä¸€ç§è¡¥å¿æ€§çš„äº‹åŠ¡æ¨¡å¼ã€‚å®ƒå°†ä¸šåŠ¡æ“ä½œæ‹†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šå°è¯•ï¼ˆTryï¼‰ã€ç¡®è®¤ï¼ˆConfirmï¼‰å’Œå–æ¶ˆï¼ˆCancelï¼‰ã€‚</p><ul><li><strong>Tryé˜¶æ®µ</strong>ï¼šæ£€æŸ¥å¹¶é¢„ç•™ä¸šåŠ¡èµ„æºã€‚</li><li><strong>Confirmé˜¶æ®µ</strong>ï¼šå¦‚æœæ‰€æœ‰æœåŠ¡çš„Tryé˜¶æ®µéƒ½æˆåŠŸï¼Œé‚£ä¹ˆæ‰§è¡Œä¸šåŠ¡æ“ä½œã€‚</li><li><strong>Cancelé˜¶æ®µ</strong>ï¼šå¦‚æœä»»ä½•æœåŠ¡çš„Tryé˜¶æ®µå¤±è´¥ï¼Œé‚£ä¹ˆæ‰§è¡Œæ’¤é”€æ“ä½œï¼Œé‡Šæ”¾åœ¨Tryé˜¶æ®µé¢„ç•™çš„èµ„æºã€‚</li></ul><p>TCCæ¨¡å¼æä¾›äº†è¾ƒä¸ºçµæ´»çš„äº‹åŠ¡æ§åˆ¶èƒ½åŠ›ï¼Œé€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚é«˜çš„ä¸šåŠ¡åœºæ™¯ã€‚ä½†æ˜¯ï¼Œå¼€å‘æˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®ç°Tryã€Confirmå’ŒCancelä¸‰ä¸ªæ“ä½œã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228214636.png" alt="image.png"></p><p>æ€»ç»“ï¼›</p><ul><li><strong>XAæ¨¡å¼</strong>ï¼šåŸºäºXAåè®®çš„ä¸¤é˜¶æ®µæäº¤ï¼Œä¿è¯äº‹åŠ¡çš„ACIDç‰¹æ€§ï¼Œå®ç°å¤æ‚ï¼Œæ€§èƒ½å¼€é”€å¤§ã€‚</li><li><strong>ATæ¨¡å¼</strong>ï¼šé€šè¿‡æ•°æ®é•œåƒè®°å½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç®€å•æ˜“ç”¨ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œæ˜¯Seataçš„é»˜è®¤äº‹åŠ¡æ¨¡å¼ã€‚</li><li><strong>TCCæ¨¡å¼</strong>ï¼šé€šè¿‡æ˜¾å¼çš„Try-Confirm-Cancelæ“ä½œæ¥æ§åˆ¶äº‹åŠ¡ï¼Œçµæ´»æ€§é«˜ï¼Œé€‚åˆå¯¹ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œä½†å®ç°æˆæœ¬è¾ƒé«˜ã€‚</li></ul><p>æš‚æ—¶è¿˜ä¸å¤ªç†è§£ï¼Œåˆ°æ—¶å€™å°±è¯´ä¸€ä¸‹å…³äºåˆ†å¸ƒå¼äº‹åŠ¡</p><p>å…¶ä¸­ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ Seata è¿›è¡Œä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„ç®¡ç†ï¼Œé»˜è®¤é‡‡ç”¨çš„æ˜¯ AT æ¨¡å¼ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ä¼šä¿ç•™ä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œå¦‚æœæ•´ä¸ªäº‹åŠ¡æœ‰æ‰§è¡Œå¤±è´¥çš„è¯ï¼Œåˆ™æ‰§è¡Œå›æ»šæ“ä½œã€‚ï¼ˆå¤§è‡´ Get ä¸€ä¸‹ï¼Œè¯¦ç»†çš„åé¢å†äº†è§£ä¸€ä¸‹ï¼‰</p><p>å…³äºå…¶ä»–çš„ ACã€XAã€TCC æ˜¯çŸ¥é“æœ‰è¿™ä¸ªï¼Œä½†å…·ä½“ä¸å¤ªæ¸…æ¥šã€‚ç„¶åè§’è‰²è®°ä¸€ä¸‹ï¼šTM äº‹åŠ¡ç®¡ç†å™¨ï¼ŒRM èµ„æºç®¡ç†å™¨ï¼ŒTC äº‹åŠ¡åè°ƒè€…ã€‚</p><hr><blockquote><p>MQ   ğŸš©  ğŸ’£</p></blockquote><p>éœ€è¦çœ‹ä¸€ä¸‹è¿™ä¸ªå•¥ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡MQ æ€ä¹ˆè¯•ä¸‹éš¾ç‚¹</p><p>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰å®ç°åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¸€ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ç§æ–¹æ³•é€šå¸¸è¢«ç§°ä¸ºæœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆæˆ–å¼‚æ­¥ç¡®ä¿å‹æ–¹æ¡ˆã€‚å®ƒåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„å¯é æ€§æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œä¸»è¦åº”ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚ä¸æ˜¯éå¸¸é«˜ï¼Œä½†å¯¹ç³»ç»Ÿå¯ç”¨æ€§å’Œä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚</p><p>é€šè¿‡MQå®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„åŸºæœ¬æ€è·¯æ˜¯å°†äº‹åŠ¡çš„æ‰§è¡Œåˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>æœ¬åœ°äº‹åŠ¡æ‰§è¡Œ</strong>ï¼šé¦–å…ˆåœ¨å‘é€æ–¹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¹¶å°†è¦æ‰§è¡Œçš„è·¨æœåŠ¡æ“ä½œå°è£…æˆæ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚æ­¤æ—¶ï¼Œæ¶ˆæ¯å¤„äºä¸å¯è¢«æ¶ˆè´¹çŠ¶æ€ã€‚</li><li><strong>æ¶ˆæ¯ç¡®è®¤ä¸æ¶ˆè´¹</strong>ï¼šå½“æœ¬åœ°äº‹åŠ¡æˆåŠŸæäº¤åï¼Œæ¶ˆæ¯å˜ä¸ºå¯æ¶ˆè´¹çŠ¶æ€ï¼Œæ¥æ”¶æ–¹ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ‹‰å–æ¶ˆæ¯å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œå®Œæˆæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼›å¦‚æœæ“ä½œå¤±è´¥ï¼Œå¯ä»¥é€šè¿‡é‡è¯•æœºåˆ¶å†æ¬¡å°è¯•ï¼Œæˆ–è€…æ‰§è¡Œè¡¥å¿æ“ä½œä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</li></ol><p>å®ç°MQåˆ†å¸ƒå¼äº‹åŠ¡é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p><strong>åŠæ¶ˆæ¯æœºåˆ¶</strong>ï¼šè¿™æ˜¯ä¸€ç§è¾ƒä¸ºå¤æ‚çš„å®ç°æ–¹å¼ï¼Œå‘é€æ–¹é¦–å…ˆå‘é€ä¸€æ¡â€œåŠæ¶ˆæ¯â€ï¼ˆå³é¢„å¤‡æ¶ˆæ¯ï¼‰åˆ°MQï¼Œè¿™æ¡æ¶ˆæ¯æš‚æ—¶ä¸ä¼šè¢«æ¶ˆè´¹ç«¯æ¶ˆè´¹ã€‚å‘é€æ–¹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œæœ¬åœ°äº‹åŠ¡æˆåŠŸåå†å‘é€å¦ä¸€æ¡ç¡®è®¤æ¶ˆæ¯ç»™MQï¼ŒMQæ”¶åˆ°ç¡®è®¤æ¶ˆæ¯åï¼Œå°†åŠæ¶ˆæ¯æ ‡è®°ä¸ºå¯æ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…æ­¤æ—¶å¯ä»¥æ­£å¸¸æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯ã€‚</p></li><li><p><strong>äº‹åŠ¡æ¶ˆæ¯</strong>ï¼šæŸäº›MQæ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„ç‰¹æ€§ï¼Œä¾‹å¦‚Apache RocketMQã€‚äº‹åŠ¡æ¶ˆæ¯å…è®¸å‘é€æ–¹åœ¨å‘é€æ¶ˆæ¯çš„åŒæ—¶æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¦‚æœæœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œåˆ™æäº¤æ¶ˆæ¯ä½¿å…¶å¯è¢«æ¶ˆè´¹ï¼›å¦‚æœæœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œåˆ™å›æ»šæ¶ˆæ¯ï¼Œä½¿å…¶ä¸ä¼šè¢«æ¶ˆè´¹ã€‚</p></li></ol><h4 id="è®²ä¸€ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡-ğŸš©"><a href="#è®²ä¸€ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡-ğŸš©" class="headerlink" title="è®²ä¸€ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡ ğŸš©"></a>è®²ä¸€ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡ ğŸš©</h4><ul><li>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜<ul><li>æ— æ³•ä½¿ç”¨æœ¬åœ°äº‹åŠ¡æ¥è¿›è¡Œç®¡ç†ï¼Œéœ€è¦å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†ï¼š <a href="https://blog.csdn.net/weapon_7/article/details/107008628">https://blog.csdn.net/weapon_7/article/details/107008628</a></li></ul></li></ul><p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¸€ä¸ªå¤æ‚ä½†é‡è¦çš„é—®é¢˜ã€‚åˆ†å¸ƒå¼äº‹åŠ¡æŒ‡çš„æ˜¯è·¨å¤šä¸ªç‹¬ç«‹çš„æœåŠ¡æˆ–æ•°æ®åº“å®ä¾‹çš„äº‹åŠ¡æ“ä½œã€‚</p><p>è¿™äº›æ“ä½œéœ€è¦åœ¨ä¸åŒçš„æœåŠ¡ä¸­ä¿æŒæ•°æ®ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</p><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆ</p><ul><li>äºŒé˜¶æ®µæäº¤ 2PC<ul><li>å‡†å¤‡é˜¶æ®µ<ul><li>åè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€å‡†å¤‡è¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æäº¤äº‹åŠ¡ã€‚</li><li>æ¯ä¸ªå‚ä¸è€…æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œä½†ä¸æäº¤ï¼Œå¹¶å°†æ“ä½œç»“æœå‘ŠçŸ¥åè°ƒè€…ã€‚</li></ul></li><li>æäº¤é˜¶æ®µ<ul><li>å¦‚æœæ‰€æœ‰å‚ä¸è€…éƒ½åŒæ„æäº¤ï¼Œåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€æäº¤è¯·æ±‚ï¼Œå‚ä¸è€…æäº¤äº‹åŠ¡ã€‚</li><li>å¦‚æœæœ‰ä»»ä¸€å‚ä¸è€…ä¸åŒæ„æäº¤æˆ–è¶…æ—¶æœªå“åº”ï¼Œåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€å›æ»šè¯·æ±‚ï¼Œå‚ä¸è€…å›æ»šäº‹åŠ¡ã€‚</li></ul></li></ul></li><li>ä¸‰é˜¶æ®µæäº¤ 3PC<ul><li>å‡†å¤‡é˜¶æ®µ<ul><li>åè°ƒè€…è¯¢é—®å‚ä¸è€…æ˜¯å¦å¯ä»¥æäº¤äº‹åŠ¡ã€‚</li></ul></li><li>é¢„å‡†å¤‡é˜¶æ®µ<ul><li>å¦‚æœæ‰€æœ‰å‚ä¸è€…éƒ½å“åº”å¯ä»¥æäº¤ï¼Œåè°ƒè€…è¿›å…¥é¢„æäº¤é˜¶æ®µï¼Œå‚ä¸è€…æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œä½†ä¸æäº¤ã€‚</li></ul></li><li>æäº¤é˜¶æ®µ<ul><li>å¦‚æœæ‰€æœ‰å‚ä¸è€…éƒ½é¢„æäº¤æˆåŠŸï¼Œåè°ƒè€…å‘é€æäº¤è¯·æ±‚ï¼Œå‚ä¸è€…æäº¤äº‹åŠ¡ã€‚å¦‚æœæœ‰å‚ä¸è€…é¢„æäº¤å¤±è´¥ï¼Œåè°ƒè€…å‘é€å›æ»šè¯·æ±‚ï¼Œå‚ä¸è€…å›æ»šäº‹åŠ¡ã€‚</li></ul></li></ul></li><li>æœ¬åœ°äº‹åŠ¡å’Œäº‹ä»¶é©±åŠ¨ï¼ˆåŸºäºæ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§ï¼‰<ul><li>æœ¬åœ°äº‹åŠ¡<ul><li>æ¯ä¸ªæœåŠ¡åªç®¡ç†è‡ªå·±çš„æœ¬åœ°äº‹åŠ¡ï¼Œç¡®ä¿æ“ä½œè¦ä¹ˆå®Œå…¨æˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨å¤±è´¥ã€‚</li></ul></li><li>äº‹ä»¶é©±åŠ¨<ul><li>æœåŠ¡ä¹‹é—´é€šè¿‡äº‹ä»¶æ€»çº¿ï¼ˆå¦‚ Kafkaã€RabbitMQï¼‰å‘é€å’Œæ¥æ”¶äº‹ä»¶ã€‚ä¸€ä¸ªæœåŠ¡å®Œæˆæœ¬åœ°äº‹åŠ¡åï¼Œå‘é€äº‹ä»¶é€šçŸ¥å…¶ä»–æœåŠ¡ã€‚</li><li>æ¥æ”¶æœåŠ¡å¤„ç†äº‹ä»¶å¹¶æ‰§è¡Œç›¸åº”çš„æœ¬åœ°äº‹åŠ¡æ“ä½œã€‚</li></ul></li></ul></li><li>TCCï¼ˆTry-Confirm&#x2F;Cancelï¼‰æ¨¡å¼<ul><li><strong>Try</strong>ï¼š<ul><li>å°è¯•æ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Œé¢„ç•™èµ„æºï¼Œä½†ä¸æäº¤ã€‚</li></ul></li><li><strong>Confirm</strong>ï¼š<ul><li>ç¡®è®¤æ“ä½œï¼Œæ­£å¼æäº¤äº‹åŠ¡ï¼Œåªæœ‰åœ¨ Try é˜¶æ®µæˆåŠŸæ—¶æ‰§è¡Œã€‚</li></ul></li><li><strong>Cancel</strong>ï¼š<ul><li>å–æ¶ˆæ“ä½œï¼Œé‡Šæ”¾é¢„ç•™èµ„æºï¼Œåªæœ‰åœ¨ Try é˜¶æ®µå¤±è´¥æˆ–è¶…æ—¶æ—¶æ‰§è¡Œ</li></ul></li></ul></li></ul><p>2PC çš„ç¼ºç‚¹æ˜¯åè°ƒè€…æ˜¯ä¸€ä¸ªå•ç‚¹æ•…éšœï¼Œå¹¶ä¸”ç½‘ç»œåˆ†åŒºæˆ–å‚ä¸è€…çš„å´©æºƒä¼šå¯¼è‡´äº‹åŠ¡æŒ‚èµ·ã€‚</p><p>ä¸‰é˜¶æ®µæäº¤åè®®ï¼ˆ3PCï¼‰æ˜¯å¯¹ 2PC çš„æ”¹è¿›ï¼Œé€šè¿‡å¼•å…¥é¢„æäº¤é˜¶æ®µé™ä½äº†åè°ƒè€…å•ç‚¹æ•…éšœå¸¦æ¥çš„å½±å“</p><p>3PC è¿›ä¸€æ­¥é™ä½äº†äº‹åŠ¡æŒ‚èµ·çš„é£é™©ï¼Œä½†å®ç°è¾ƒä¸ºå¤æ‚ã€‚</p><h4 id="Seata"><a href="#Seata" class="headerlink" title="Seata"></a>Seata</h4><p>Seata çš„ä¸‰ä¸ªè§’è‰²</p><ul><li><strong>TC</strong>Â (Transaction Coordinator) - äº‹åŠ¡åè°ƒè€…ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œé©±åŠ¨<strong>å…¨å±€äº‹åŠ¡</strong>æäº¤æˆ–å›æ»šã€‚</li><li><strong>TM</strong>Â (Transaction Manager) - äº‹åŠ¡ç®¡ç†å™¨ï¼šå®šä¹‰<strong>å…¨å±€äº‹åŠ¡</strong>çš„èŒƒå›´ï¼Œå¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</li><li><strong>RM</strong>Â ( Resource Manager ) - èµ„æºç®¡ç†å™¨ï¼šç®¡ç†<strong>åˆ†æ”¯äº‹åŠ¡</strong>å¤„ç†çš„èµ„æº( Resource )ï¼Œä¸ TC äº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨<strong>åˆ†æ”¯äº‹åŠ¡</strong>æäº¤æˆ–å›æ»šã€‚</li></ul><p>å…¶ä¸­ï¼ŒTC ä¸ºå•ç‹¬éƒ¨ç½²çš„Â <strong>Server</strong>Â æœåŠ¡ç«¯ï¼ŒTM å’Œ RM ä¸ºåµŒå…¥åˆ°åº”ç”¨ä¸­çš„Â <strong>Client</strong>Â å®¢æˆ·ç«¯</p><p>Seata ä¸­æœ‰ä¸‰ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ XAã€AT å’Œ TCC</p><ul><li>XA  æ¨¡å¼</li><li>AT  æ¨¡å¼</li><li>TCC æ¨¡å¼</li></ul><p><strong>XA æ¨¡å¼</strong></p><p>XAæ¨¡å¼åŸºäºXAåè®®å®ç°ï¼Œæ˜¯ä¸€ç§ä¸¤é˜¶æ®µæäº¤çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚XAæ¨¡å¼æ¶‰åŠåˆ°äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼‰ã€èµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰å’Œäº‹åŠ¡åè°ƒè€…ï¼ˆTCï¼‰ä¸‰ä¸ªè§’è‰²ã€‚</p><ul><li><strong>ç¬¬ä¸€é˜¶æ®µï¼ˆå‡†å¤‡é˜¶æ®µï¼‰</strong>ï¼šäº‹åŠ¡ç®¡ç†å™¨æŒ‡ç¤ºæ‰€æœ‰å‚ä¸å½“å‰äº‹åŠ¡çš„èµ„æºç®¡ç†å™¨å‡†å¤‡æäº¤äº‹åŠ¡ã€‚</li><li><strong>ç¬¬äºŒé˜¶æ®µï¼ˆæäº¤&#x2F;å›æ»šé˜¶æ®µï¼‰</strong>ï¼šå¦‚æœæ‰€æœ‰èµ„æºç®¡ç†å™¨éƒ½å‡†å¤‡å°±ç»ªï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¼šæŒ‡ç¤ºå®ƒä»¬æäº¤äº‹åŠ¡ï¼›å¦‚æœä»»ä½•èµ„æºç®¡ç†å™¨ä¸èƒ½å‡†å¤‡å°±ç»ªï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¼šæŒ‡ç¤ºæ‰€æœ‰èµ„æºç®¡ç†å™¨å›æ»šäº‹åŠ¡ã€‚</li></ul><p>XAæ¨¡å¼ä¿è¯äº†è·¨æ•°æ®åº“å’Œç³»ç»Ÿçš„äº‹åŠ¡ä¸€è‡´æ€§ï¼Œä½†å®ç°å¤æ‚ï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228214142.png" alt="image.png"></p><p>AT æ¨¡å¼</p><p>ATæ¨¡å¼æ˜¯Seataè‡ªä¸»åˆ›æ–°çš„ä¸€ç§äº‹åŠ¡æ¨¡å¼ï¼Œå…¨ç§°ä¸ºAutomatic Transactionï¼Œå³è‡ªåŠ¨åŒ–äº‹åŠ¡æ¨¡å¼ã€‚å®ƒé€šè¿‡å¯¹æ•°æ®è¿›è¡Œå‰åé•œåƒè®°å½•æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><ul><li><strong>æäº¤äº‹åŠ¡</strong>ï¼šåœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œå¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œåˆ™ç›´æ¥æäº¤äº‹åŠ¡ï¼›å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œåˆ©ç”¨é•œåƒè®°å½•è¿›è¡Œå›æ»šã€‚</li><li><strong>å›æ»šäº‹åŠ¡</strong>ï¼šåœ¨å›æ»šæ—¶ï¼Œåˆ©ç”¨ä¹‹å‰è®°å½•çš„å‰é•œåƒå’Œåé•œåƒè¿›è¡Œæ•°æ®çš„æ¢å¤ã€‚</li></ul><p>ATæ¨¡å¼ä¸ä¾èµ–XAåè®®ï¼Œå…·æœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼Œæ˜“äºç†è§£å’Œä½¿ç”¨ï¼Œæ˜¯Seataä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„æ¨¡å¼ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228214546.png" alt="image.png"></p><p>TCC æ¨¡å¼</p><p>TCCæ¨¡å¼å³Try-Confirm-Cancelæ¨¡å¼ï¼Œæ˜¯ä¸€ç§è¡¥å¿æ€§çš„äº‹åŠ¡æ¨¡å¼ã€‚å®ƒå°†ä¸šåŠ¡æ“ä½œæ‹†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šå°è¯•ï¼ˆTryï¼‰ã€ç¡®è®¤ï¼ˆConfirmï¼‰å’Œå–æ¶ˆï¼ˆCancelï¼‰ã€‚</p><ul><li><strong>Tryé˜¶æ®µ</strong>ï¼šæ£€æŸ¥å¹¶é¢„ç•™ä¸šåŠ¡èµ„æºã€‚</li><li><strong>Confirmé˜¶æ®µ</strong>ï¼šå¦‚æœæ‰€æœ‰æœåŠ¡çš„Tryé˜¶æ®µéƒ½æˆåŠŸï¼Œé‚£ä¹ˆæ‰§è¡Œä¸šåŠ¡æ“ä½œã€‚</li><li><strong>Cancelé˜¶æ®µ</strong>ï¼šå¦‚æœä»»ä½•æœåŠ¡çš„Tryé˜¶æ®µå¤±è´¥ï¼Œé‚£ä¹ˆæ‰§è¡Œæ’¤é”€æ“ä½œï¼Œé‡Šæ”¾åœ¨Tryé˜¶æ®µé¢„ç•™çš„èµ„æºã€‚</li></ul><p>TCCæ¨¡å¼æä¾›äº†è¾ƒä¸ºçµæ´»çš„äº‹åŠ¡æ§åˆ¶èƒ½åŠ›ï¼Œé€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚é«˜çš„ä¸šåŠ¡åœºæ™¯ã€‚ä½†æ˜¯ï¼Œå¼€å‘æˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®ç°Tryã€Confirmå’ŒCancelä¸‰ä¸ªæ“ä½œã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228214636.png" alt="image.png"></p><p>æ€»ç»“ï¼›</p><ul><li><strong>XAæ¨¡å¼</strong>ï¼šåŸºäºXAåè®®çš„ä¸¤é˜¶æ®µæäº¤ï¼Œä¿è¯äº‹åŠ¡çš„ACIDç‰¹æ€§ï¼Œå®ç°å¤æ‚ï¼Œæ€§èƒ½å¼€é”€å¤§ã€‚</li><li><strong>ATæ¨¡å¼</strong>ï¼šé€šè¿‡æ•°æ®é•œåƒè®°å½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç®€å•æ˜“ç”¨ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œæ˜¯Seataçš„é»˜è®¤äº‹åŠ¡æ¨¡å¼ã€‚</li><li><strong>TCCæ¨¡å¼</strong>ï¼šé€šè¿‡æ˜¾å¼çš„Try-Confirm-Cancelæ“ä½œæ¥æ§åˆ¶äº‹åŠ¡ï¼Œçµæ´»æ€§é«˜ï¼Œé€‚åˆå¯¹ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œä½†å®ç°æˆæœ¬è¾ƒé«˜ã€‚</li></ul><h4 id="åŠæ¶ˆæ¯-RocketMQ-äºŒé˜¶æ®µæäº¤"><a href="#åŠæ¶ˆæ¯-RocketMQ-äºŒé˜¶æ®µæäº¤" class="headerlink" title="åŠæ¶ˆæ¯ RocketMQ äºŒé˜¶æ®µæäº¤"></a>åŠæ¶ˆæ¯ RocketMQ äºŒé˜¶æ®µæäº¤</h4><p>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰å®ç°åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¸€ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ç§æ–¹æ³•é€šå¸¸è¢«ç§°ä¸ºæœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆæˆ–å¼‚æ­¥ç¡®ä¿å‹æ–¹æ¡ˆã€‚å®ƒåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„å¯é æ€§æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œä¸»è¦åº”ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚ä¸æ˜¯éå¸¸é«˜ï¼Œä½†å¯¹ç³»ç»Ÿå¯ç”¨æ€§å’Œä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚</p><p>é€šè¿‡MQå®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„åŸºæœ¬æ€è·¯æ˜¯å°†äº‹åŠ¡çš„æ‰§è¡Œåˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>æœ¬åœ°äº‹åŠ¡æ‰§è¡Œ</strong>ï¼šé¦–å…ˆåœ¨å‘é€æ–¹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¹¶å°†è¦æ‰§è¡Œçš„è·¨æœåŠ¡æ“ä½œå°è£…æˆæ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚æ­¤æ—¶ï¼Œæ¶ˆæ¯å¤„äºä¸å¯è¢«æ¶ˆè´¹çŠ¶æ€ã€‚</li><li><strong>æ¶ˆæ¯ç¡®è®¤ä¸æ¶ˆè´¹</strong>ï¼šå½“æœ¬åœ°äº‹åŠ¡æˆåŠŸæäº¤åï¼Œæ¶ˆæ¯å˜ä¸ºå¯æ¶ˆè´¹çŠ¶æ€ï¼Œæ¥æ”¶æ–¹ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ‹‰å–æ¶ˆæ¯å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œå®Œæˆæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼›å¦‚æœæ“ä½œå¤±è´¥ï¼Œå¯ä»¥é€šè¿‡é‡è¯•æœºåˆ¶å†æ¬¡å°è¯•ï¼Œæˆ–è€…æ‰§è¡Œè¡¥å¿æ“ä½œä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</li></ol><p>å®ç°MQåˆ†å¸ƒå¼äº‹åŠ¡é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p><strong>åŠæ¶ˆæ¯æœºåˆ¶</strong>ï¼šè¿™æ˜¯ä¸€ç§è¾ƒä¸ºå¤æ‚çš„å®ç°æ–¹å¼ï¼Œå‘é€æ–¹é¦–å…ˆå‘é€ä¸€æ¡â€œåŠæ¶ˆæ¯â€ï¼ˆå³é¢„å¤‡æ¶ˆæ¯ï¼‰åˆ°MQï¼Œè¿™æ¡æ¶ˆæ¯æš‚æ—¶ä¸ä¼šè¢«æ¶ˆè´¹ç«¯æ¶ˆè´¹ã€‚å‘é€æ–¹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œæœ¬åœ°äº‹åŠ¡æˆåŠŸåå†å‘é€å¦ä¸€æ¡ç¡®è®¤æ¶ˆæ¯ç»™MQï¼ŒMQæ”¶åˆ°ç¡®è®¤æ¶ˆæ¯åï¼Œå°†åŠæ¶ˆæ¯æ ‡è®°ä¸ºå¯æ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…æ­¤æ—¶å¯ä»¥æ­£å¸¸æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯ã€‚</p></li><li><p><strong>äº‹åŠ¡æ¶ˆæ¯</strong>ï¼šæŸäº›MQæ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„ç‰¹æ€§ï¼Œä¾‹å¦‚Apache RocketMQã€‚äº‹åŠ¡æ¶ˆæ¯å…è®¸å‘é€æ–¹åœ¨å‘é€æ¶ˆæ¯çš„åŒæ—¶æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¦‚æœæœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œåˆ™æäº¤æ¶ˆæ¯ä½¿å…¶å¯è¢«æ¶ˆè´¹ï¼›å¦‚æœæœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œåˆ™å›æ»šæ¶ˆæ¯ï¼Œä½¿å…¶ä¸ä¼šè¢«æ¶ˆè´¹ã€‚</p></li></ol><h3 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h3><h4 id="åˆ†å¸ƒå¼æœåŠ¡çš„æ¥å£å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼Ÿ"><a href="#åˆ†å¸ƒå¼æœåŠ¡çš„æ¥å£å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼Ÿ" class="headerlink" title="åˆ†å¸ƒå¼æœåŠ¡çš„æ¥å£å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼Ÿ"></a>åˆ†å¸ƒå¼æœåŠ¡çš„æ¥å£å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼Ÿ</h4><p>å¹‚ç­‰ï¼šå¤šæ¬¡è°ƒç”¨æ–¹æ³•æˆ–è€…æ¥å£ä¸ä¼šæ”¹å˜ä¸šåŠ¡çŠ¶æ€ï¼Œå¯ä»¥ä¿è¯é‡å¤è°ƒç”¨çš„ç»“æœå’Œå•æ¬¡è°ƒç”¨çš„ç»“æœä¸€è‡´ã€‚</p><p>éœ€è¦å¹‚ç­‰åœºæ™¯ï¼š</p><ul><li>1ã€ç”¨æˆ·é‡å¤ç‚¹å‡»ï¼ˆç½‘ç»œæ³¢åŠ¨ï¼‰ã€</li><li>2ã€MQ æ¶ˆæ¯é‡å¤</li><li>3ã€åº”ç”¨ä½¿ç”¨å¤±è´¥æˆ–è€…è¶…æ—¶é‡è¯•æœºåˆ¶</li></ul><p>åœ¨ Restful  API çš„è§’åº¦ï¼Œçœ‹å¸¸è§ç±»å‹è¯·æ±‚çš„å¹‚ç­‰æ€§åˆ†æï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228233944.png" alt="image.png"></p><p>token + redis</p><blockquote><p>åˆ†å¸ƒå¼é”</p></blockquote><p>setnx + redission</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234242.png" alt="image.png"></p><hr><p>é—®é¢˜ï¼šåˆ†å¸ƒå¼æœåŠ¡çš„æ¥å£å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼Ÿ</p><ul><li>å¹‚ç­‰ï¼šå¤šæ¬¡è°ƒç”¨æ–¹æ³•æˆ–è€…æ¥å£ä¸ä¼šæ”¹å˜ä¸šåŠ¡çŠ¶æ€ï¼Œå¯ä»¥ä¿è¯<strong>é‡å¤è°ƒç”¨çš„ç»“æœå’Œå•æ¬¡è°ƒç”¨çš„ç»“æœä¸€è‡´</strong></li><li>å¦‚æœæ˜¯æ–°å¢æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æ•°æ¢åº“çš„éš¾ä¸€ç´ å¼•</li><li>å¦‚æœæ˜¯æ–°å¢æˆ–ä¿®æ”¹æ•°æ®<ul><li>åˆ†å¸ƒå¼é”ï¼Œæ€§èƒ½è¾ƒä½</li><li>ä½¿ç”¨token + redisæ¥å®ç°ï¼Œæ€§èƒ½è¾ƒå¥½<ul><li>ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ token å­˜å…¥ redis ,è¿”å›ç»™å‰ç«¯</li><li>ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œä¸šåŠ¡å¤„ç†ï¼Œæºå¸¦ä¹‹å‰çš„ token,åˆ° redis è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœå­˜åœ¨ï¼Œå¯ä»¥æ‰§è¡Œä¸šåŠ¡ï¼Œåˆ é™¤ tokenï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸å¤„ç†ä¸šåŠ¡</li></ul></li></ul></li></ul><h4 id="è®²ä¸€ä¸‹åˆ†å¸ƒå¼é”-ğŸš©"><a href="#è®²ä¸€ä¸‹åˆ†å¸ƒå¼é”-ğŸš©" class="headerlink" title="è®²ä¸€ä¸‹åˆ†å¸ƒå¼é” ğŸš©"></a>è®²ä¸€ä¸‹åˆ†å¸ƒå¼é” ğŸš©</h4><h4 id="Redisson-çš„å¯é‡å…¥é”ç»“æ„"><a href="#Redisson-çš„å¯é‡å…¥é”ç»“æ„" class="headerlink" title="Redisson çš„å¯é‡å…¥é”ç»“æ„"></a>Redisson çš„å¯é‡å…¥é”ç»“æ„</h4><p>Redisson çš„å¯é‡å…¥ç»“æ„æ˜¯åŸºäº Hash ç»“æ„çš„ï¼Œå…·ä½“çš„ç»“æ„ä¸º</p><ul><li>keyï¼šé”çš„åè¯</li><li>valueï¼šæŒæœ‰é”çš„äººï¼Œçº¿ç¨‹ID  ï¼š é‡å…¥æ¬¡æ•°</li></ul><h4 id="è®²ä¸€ä¸‹-Redisson-çš„-çœ‹é—¨ç‹—æœºåˆ¶"><a href="#è®²ä¸€ä¸‹-Redisson-çš„-çœ‹é—¨ç‹—æœºåˆ¶" class="headerlink" title="è®²ä¸€ä¸‹ Redisson çš„ çœ‹é—¨ç‹—æœºåˆ¶"></a>è®²ä¸€ä¸‹ Redisson çš„ çœ‹é—¨ç‹—æœºåˆ¶</h4><ul><li><p>1ã€åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼Œå¯¹äºå…±äº«èµ„æºçš„è®¿é—®å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œè¿™é‡Œä¸€èˆ¬ä¼šè€ƒè™‘å¼•å…¥ç»„ä»¶ redis ï¼Œç„¶åä½¿ç”¨ redis ä¸­çš„ setnx å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ å¦‚æœä¸å­˜åœ¨åˆ™è¿›è¡Œæ·»åŠ ï¼Œå¦‚æœå­˜åœ¨åˆ™æ·»åŠ å¤±è´¥  setnx name value</p></li><li><p>2ã€ä¸€èˆ¬è¿™ç§æƒ…å†µä¸‹å°±å¯ä»¥å®ç°ä¸€ä¸ªç®€æ˜“çš„åˆ†å¸ƒå¼é”ï¼Œä½†æ˜¯å‘¢ï¼Œæœ‰å¯èƒ½å‡ºç° redis å®•æœºçš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†é˜²æ­¢è¿™ä¸ª é”®å€¼ ä¸€ç›´å­˜åœ¨ redis ä¸­ï¼ˆé”ï¼‰ï¼Œä¸€èˆ¬ä¼šè¿›è¡Œæ·»åŠ ä¸€ä¸ªæœ‰æ•ˆæ—¶é—´ï¼Œä»è€Œé¿å…é”ä¸€ç›´æœªé‡Šæ”¾çš„æ“ä½œ setnx name value ex100ï¼›åŒæ—¶ï¼Œè¿™é‡Œå¦‚æœæ˜¯åœ¨è¿‡æœŸæ—¶é—´å†…è¿›è¡Œé‡Šæ”¾é”ï¼Œä¼šè¿›è¡Œ åˆ é™¤æ“ä½œï¼Œè¿™é‡Œä¸€èˆ¬å»ºè®®ä½¿ç”¨ Lua å‘½ä»¤è¿›è¡Œæ“ä½œï¼ˆé˜²æ­¢è¯¯åˆ åˆ°å…¶ä»–çš„é”ï¼‰</p></li><li><p>3ã€ä¸Šé¢è¿˜å¯èƒ½å‡ºç°ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯åœ¨è¿‡æœŸæ—¶é—´åè‡ªåŠ¨é‡Šæ”¾äº†é”ï¼Œä¸šåŠ¡æµç¨‹å´æœªæ‰§è¡Œå®Œï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå»ºè®®å¼•å…¥ redission</p></li><li><p>å½“ä½¿ç”¨ Redisson çš„é”æœºåˆ¶ï¼ˆå¦‚ <code>RLock</code>ï¼‰é”å®šæŸä¸ªèµ„æºæ—¶ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼åœ°è®¾ç½®é”çš„ç§ŸæœŸï¼ˆlease timeï¼‰ï¼ŒRedisson ä¼šå¯ç”¨â€œçœ‹é—¨ç‹—â€æœºåˆ¶ã€‚è¿™ä¸ªæœºåˆ¶çš„æ ¸å¿ƒæ˜¯è‡ªåŠ¨ç»­ç§Ÿï¼Œç¡®ä¿åœ¨æŒæœ‰é”çš„æœåŠ¡å®ä¾‹æ­£å¸¸è¿è¡Œæ—¶ï¼Œé”ä¸ä¼šå› ä¸ºè¶…æ—¶è€Œè¢«è‡ªåŠ¨é‡Šæ”¾</p><ul><li><strong>é»˜è®¤ç§ŸæœŸè®¾ç½®</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œé”çš„ç§ŸæœŸè®¾ç½®ä¸º 30 ç§’ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰æ“ä½œå®Œæˆï¼Œé”å°±ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”ã€‚</li><li><strong>è‡ªåŠ¨ç»­ç§Ÿ</strong>ï¼šâ€œçœ‹é—¨ç‹—â€æœºåˆ¶ä¼šåœ¨é”å¿«åˆ°æœŸæ—¶ï¼ˆé»˜è®¤æƒ…å†µä¸‹æ˜¯ç§ŸæœŸçš„ 1&#x2F;3ï¼Œå³10ç§’åï¼‰ï¼Œè‡ªåŠ¨å‘é€ä¸€ä¸ªå‘½ä»¤ç»™ Redisï¼Œå°†é”çš„ç§ŸæœŸé‡æ–°å»¶é•¿åˆ° 30 ç§’ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´æŒç»­ï¼Œç›´åˆ°é”è¢«æ˜¾å¼é‡Šæ”¾ã€‚</li><li><strong>æ•…éšœè½¬ç§»</strong>ï¼šå¦‚æœæŒæœ‰é”çš„æœåŠ¡å®ä¾‹å› ä¸ºæŸäº›åŸå› å®•æœºæˆ–æ— æ³•ä¸ Redis é€šä¿¡ï¼Œé”å°†ä¸ä¼šè¢«ç»­ç§Ÿï¼Œæœ€ç»ˆä¼šåœ¨é»˜è®¤çš„ç§ŸæœŸç»“æŸåè‡ªåŠ¨é‡Šæ”¾ã€‚è¿™æ ·ï¼Œå…¶ä»–æœåŠ¡å®ä¾‹å¯ä»¥è·å–é”ï¼Œç»§ç»­å¤„ç†ä»»åŠ¡ï¼Œä¿è¯äº†ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å’Œä¸€è‡´æ€§ã€‚</li></ul></li><li><p>waitTimeï¼šå®šä¹‰äº†å°è¯•è·å–é”çš„æœ€å¤§ç­‰å¾…æ—¶é—´ã€‚åœ¨ç­‰å¾…æ—¶é—´å†…ï¼Œå¦‚æœé”é‡Šæ”¾äº†ï¼Œå½“å‰çº¿ç¨‹å¯ä»¥æˆåŠŸè·å–é”ï¼›å¦åˆ™ï¼Œè·å–é”å¤±è´¥ã€‚</p></li><li><p>leaseTimeï¼šå®šä¹‰äº†é”çš„æŒæœ‰æ—¶é—´ã€‚å½“æŒæœ‰æ—¶é—´åˆ°æœŸåï¼Œé”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”ã€‚å¦‚æœè®¾ç½®ä¸º <code>-1</code>ï¼Œçœ‹é—¨ç‹—æœºåˆ¶ä¼šå¯åŠ¨ï¼Œå®šæœŸå»¶é•¿é”çš„æœ‰æ•ˆæœŸï¼Œç›´åˆ°æ˜¾å¼é‡Šæ”¾é”ã€‚</p></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240407094353.png" alt="image.png"></p><h3 id="é™æµä¸ç›‘æ§"><a href="#é™æµä¸ç›‘æ§" class="headerlink" title="é™æµä¸ç›‘æ§"></a>é™æµä¸ç›‘æ§</h3><h4 id="ä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰åšè¿‡é™æµï¼Œæ€ä¹ˆåšçš„"><a href="#ä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰åšè¿‡é™æµï¼Œæ€ä¹ˆåšçš„" class="headerlink" title="ä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰åšè¿‡é™æµï¼Œæ€ä¹ˆåšçš„"></a>ä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰åšè¿‡é™æµï¼Œæ€ä¹ˆåšçš„</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281528174.png" alt="image.png"></p><p>é™æµçš„å¸¸è§å®ç°æ–¹å¼ï¼š</p><ul><li>1ã€Tomcat: å¯ä»¥è®¾ç½®æœ€å¤§è¿æ¥æ•°<ul><li>ä¸è¿‡è¿™ç§æ–¹å¼é€‚åˆå•ä½“é¡¹ç›®ï¼Œåˆ†å¸ƒå¼é¡¹ç›®ä¸å¤ªé€‚åˆ</li></ul></li><li>2ã€Nginxï¼Œæ¼æ¡¶ç®—æ³•</li><li>3ã€ç½‘å…³ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•</li><li>4ã€è‡ªå®šä¹‰æ‹¦æˆªå™¨</li></ul><p>å…ˆæŒæ¡äº†è§£ä¸€ä¸‹ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æ–¹å¼</p><blockquote><p>é¢è¯•é¢˜ï¼šä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰åšè¿‡é™æµï¼Œæ€ä¹ˆåšçš„ã€‚</p></blockquote><ul><li>1ã€å…ˆæ¥ä»‹ç»ä¸šåŠ¡ï¼Œä»€ä¹ˆæƒ…å†µä¸‹å»åšé™æµï¼Œéœ€è¦è¯´æ˜QPSå…·ä½“å¤šå°‘<ul><li>æˆ‘ä»¬å½“æ—¶æœ‰ä¸€ä¸ªæ´»åŠ¨ï¼Œåˆ°äº†å‡æœŸå°±ä¼šæŠ¢è´­ä¼˜æƒ åˆ¸ï¼ŒQPS æœ€é«˜å¯ä»¥è¾¾åˆ°2000ï¼Œå¹³æ—¶10-50ä¹‹é—´ï¼Œä¸ºäº†åº”å¯¹çªå‘æµé‡ï¼Œéœ€è¦åšé™æµ</li><li>å¸¸è§„é™æµï¼Œä¸ºäº†é˜²æ­¢æ¶æ„æ”»å‡»ï¼Œä¿æŠ¤ç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼Œæˆ‘ä»¬å½“æ—¶ç³»ç»Ÿèƒ½å¤Ÿæ‰¿å—æœ€å¤§çš„QPSæ˜¯å¤šå°‘ï¼ˆå‹æµ‹ç»“æœï¼‰</li></ul></li><li>2ã€nginxé™æµ<ul><li>æ§åˆ¶é€Ÿç‡ï¼ˆçªå‘æµé‡ï¼‰ï¼Œä½¿ç”¨çš„æ¼æ¡¶ç®—æ³•æ¥å®ç°è¿‡æ»¤ï¼Œè®©è¯·æ±‚ä»¥å›ºå®šçš„é€Ÿç‡å¤„ç†è¯·æ±‚ï¼Œå¯ä»¥åº”å¯¹çªå‘æµé‡</li><li>æ§åˆ¶å¹¶å‘æ•°ï¼Œé™åˆ¶å•ä¸ªip çš„é“¾æ¥æ•°å’Œå¹¶å‘é“¾æ¥çš„æ€»æ•°</li></ul></li><li>3ã€ç½‘å…³é™æµ<ul><li>åœ¨spring cloud gatewayä¸­æ”¯æŒå±€éƒ¨è¿‡æ»¤å™¨RequestRateLimiteræ¥åšé™æµï¼Œä½¿ç”¨çš„æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå¯ä»¥æ ¹æ®æˆ–è·¯å¾„è¿›è¡Œé™æµï¼Œå¯ä»¥è®¾ç½®æ¯ç§’å¡«å……å¹³å‡é€Ÿç‡ï¼Œå’Œä»¤ç‰Œæ¡¶æ€»å®¹é‡ã€‚</li></ul></li></ul><blockquote><p>é™æµå¸¸è§çš„ç®—æ³•æœ‰å“ªäº›å‘¢</p></blockquote><p>å¯ä»¥è®²ä¸€ä¸‹ä»¤ç‰Œæ¡¶ç®—æ³•å’Œæ¼æ¡¶ç®—æ³•ã€‚</p><blockquote><p>è®²ä¸€äº›æ‰©å±•å†…å®¹</p></blockquote><p>1ã€ä¸€èˆ¬é€šè¿‡ä»€ä¹ˆåšå‹æµ‹çš„</p><p>å°±è®²ä½¿ç”¨ JMeter å³å¯</p><p>å…·ä½“éœ€è¦çœ‹å®é™…ä½¿ç”¨ to be continedâ€¦.</p><blockquote><p>Nginx é™æµ</p></blockquote><ul><li>æ§åˆ¶è®¿é—®è¯·æ±‚é€Ÿç‡</li><li>æ§åˆ¶å¹¶å‘è¿æ¥æ•°ï¼ˆæŸä¸ªç”¨æˆ·å»ºç«‹çš„è¿æ¥æ•°ï¼‰</li></ul><p>Nginxæä¾›äº†å†…ç½®çš„æ¨¡å—æ¥æ”¯æŒé™æµï¼Œå¦‚<code>limit_req_module</code>å’Œ<code>limit_conn_module</code>ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ æ ¹æ®è¯·æ±‚é€Ÿç‡æˆ–å¹¶å‘è¿æ¥æ•°æ¥é™åˆ¶æµé‡ã€‚</p><p>åœ¨å®è·µä¸­ï¼Œé€šå¸¸ä¼šç»“åˆä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•æ¥æ›´å…¨é¢åœ°æ§åˆ¶æµé‡ï¼Œç¡®ä¿æœåŠ¡æ—¢ä¸ä¼šå› ä¸ºç¬æ—¶è¯·æ±‚è¿‡å¤šè€Œå´©æºƒï¼Œä¹Ÿä¸ä¼šå› ä¸ºè¿‡å¤šå¹¶å‘è¿æ¥è€Œè€—å°½èµ„æºã€‚</p><p>ä½¿ç”¨Nginxè¿›è¡Œé™æµåªæ˜¯åº”å¯¹æµé‡è¿‡è½½çš„ä¸€ç§æ‰‹æ®µï¼Œè¿˜éœ€è¦ç»“åˆåº”ç”¨å±‚çš„é™æµã€æœåŠ¡é™çº§ã€ç†”æ–­ç­‰ç­–ç•¥æ¥ç»¼åˆä¿éšœç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</p><blockquote><p>æ§åˆ¶é€Ÿç‡  limit_req_module</p></blockquote><p>å¯ä»¥ç†è§£Nginx è¿›è¡Œæ§åˆ¶è¯·æ±‚é€Ÿç‡é™åˆ¶æ˜¯ç±»ä¼¼æ¼æ¡¶ç®—æ³•çš„ä¸€ç§å®ç°ï¼ˆåº”ç”¨äº†æ¼æ¡¶ç®—æ³•çš„æ€æƒ³ï¼‰ï¼›</p><ol><li><strong>æ¡¶å®¹é‡</strong>ï¼šç®—æ³•ä¸­çš„â€œæ¡¶â€æœ‰ä¸€ä¸ªå›ºå®šçš„å®¹é‡ï¼Œè¿™ä¸ªå®¹é‡å¯ä»¥ç†è§£ä¸ºç³»ç»Ÿèƒ½å¤Ÿæ‰¿å—çš„æœ€å¤§æµé‡æˆ–è¯·æ±‚é€Ÿç‡çš„ä¸Šé™ã€‚</li><li><strong>å…¥æ°´é€Ÿç‡</strong>ï¼šæ•°æ®ï¼ˆæˆ–è¯·æ±‚ï¼‰ä»¥ä»»æ„é€Ÿç‡æµå…¥æ¡¶ä¸­ã€‚å¦‚æœæµå…¥é€Ÿç‡ä¸å®šï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®ä¼šæš‚æ—¶å­˜å‚¨åœ¨æ¡¶ä¸­ï¼Œç›´åˆ°è¢«å¤„ç†ã€‚</li><li><strong>å‡ºæ°´é€Ÿç‡</strong>ï¼šæ•°æ®ä»¥å›ºå®šçš„é€Ÿç‡ä»æ¡¶ä¸­â€œæ¼å‡ºâ€ï¼ˆå³è¢«å¤„ç†ï¼‰ã€‚å‡ºæ°´é€Ÿç‡æ˜¯é¢„å…ˆè®¾å®šçš„ï¼Œä¸å®é™…æµå…¥é€Ÿç‡æ— å…³ã€‚</li><li><strong>æº¢å‡ºå¤„ç†</strong>ï¼šå¦‚æœæµå…¥çš„æ•°æ®é‡è¶…è¿‡äº†æ¡¶çš„å®¹é‡ï¼Œå³æ¡¶å·²æ»¡ï¼Œé‚£ä¹ˆè¶…å‡ºçš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒï¼ˆæˆ–è€…è§¦å‘å…¶ä»–çš„é™æµæªæ–½ï¼‰ï¼Œè¿™å¯ä»¥é˜²æ­¢ç³»ç»Ÿè¿‡è½½</li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼çš„é™æµï¼Œè¯·æ±‚æµé‡ä¼šä»¥å›ºå®šçš„é€Ÿç‡ä»æ¡¶ä¸­â€œæ¼å‡ºâ€ï¼ˆå³è¢«å¤„ç†ï¼‰ï¼›å¦‚æœæµå…¥çš„æ•°æ®é‡è¶…è¿‡äº†æ¡¶çš„å®¹é‡ï¼Œå³æ¡¶å·²æ»¡ï¼Œé‚£ä¹ˆè¶…å‡ºçš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281533917.png" alt="image.png"></p><p>ä½¿ç”¨<code>limit_req_module</code>è¿›è¡Œè¯·æ±‚é€Ÿç‡é™åˆ¶</p><p><code>limit_req_module</code>æ¨¡å—å…è®¸ä½ é™åˆ¶å¤„ç†è¯·æ±‚çš„é€Ÿç‡ï¼Œé˜²æ­¢è¯·æ±‚è¿‡å¤šå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚è¿™ä¸ªæ¨¡å—é€šå¸¸ç”¨äºé™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚é€Ÿç‡ã€‚</p><ol><li><strong>å®šä¹‰é™æµè§„åˆ™</strong>ï¼šé¦–å…ˆï¼Œéœ€è¦åœ¨Nginxé…ç½®ä¸­å®šä¹‰ä¸€ä¸ªé™æµè§„åˆ™ï¼ˆ<code>limit_req_zone</code>ï¼‰ï¼ŒæŒ‡å®šé™æµçš„é”®ï¼ˆå¦‚å®¢æˆ·ç«¯IPï¼‰ã€é€Ÿç‡å’Œå­˜å‚¨åŒºåŸŸå¤§å°ã€‚</li></ol><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">http &#123;<br>    limit_req_zone <span class="hljs-variable">$binary_remote_addr</span> <span class="hljs-attribute">zone</span>=mylimit:10m <span class="hljs-attribute">rate</span>=1r/s;<br>    <span class="hljs-built_in">..</span>.<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code>mylimit</code>çš„åŒºåŸŸï¼Œå¤§å°ä¸º10MBï¼Œé™åˆ¶æ¯ä¸ªIPåœ°å€æ¯ç§’æœ€å¤šåªèƒ½å¤„ç†1ä¸ªè¯·æ±‚ã€‚</p><p><strong>åº”ç”¨é™æµè§„åˆ™</strong>ï¼šç„¶åï¼Œåœ¨éœ€è¦é™æµçš„locationæˆ–serverä¸Šåº”ç”¨è¿™ä¸ªè§„åˆ™ï¼ˆ<code>limit_req</code>ï¼‰ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">server &#123;<br>    location / &#123;<br>        limit_req <span class="hljs-attribute">zone</span>=mylimit <span class="hljs-attribute">burst</span>=5;<br>        <span class="hljs-built_in">..</span>.<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨<code>/</code>ä½ç½®åº”ç”¨äº†<code>mylimit</code>è§„åˆ™ï¼Œå¹¶è®¾ç½®äº†<code>burst</code>å‚æ•°ä¸º5ï¼Œæ„å‘³ç€å…è®¸åœ¨çŸ­æ—¶é—´å†…è¶…è¿‡é™åˆ¶çš„è¯·æ±‚è¢«ç¼“å­˜èµ·æ¥ï¼Œç›´åˆ°è¾¾åˆ°5ä¸ªè¯·æ±‚çš„é™åˆ¶ã€‚</p><blockquote><p>æ§åˆ¶å¹¶å‘è¿æ¥æ•°</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281535314.png" alt="image.png"></p><p>ä½¿ç”¨<code>limit_conn_module</code>è¿›è¡Œå¹¶å‘è¿æ¥æ•°é™åˆ¶</p><p><code>limit_conn_module</code>æ¨¡å—å…è®¸ä½ é™åˆ¶å¹¶å‘è¿æ¥æ•°ï¼Œè¿™é€‚ç”¨äºé™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶å»ºç«‹çš„è¿æ¥æ•°ã€‚</p><ol><li><strong>å®šä¹‰è¿æ¥æ•°é™åˆ¶</strong>ï¼šåŒæ ·ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªé™åˆ¶åŒºåŸŸï¼ˆ<code>limit_conn_zone</code>ï¼‰ã€‚</li></ol><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">http &#123;<br>    limit_conn_zone <span class="hljs-variable">$binary_remote_addr</span> <span class="hljs-attribute">zone</span>=connlimit:10m;<br>    <span class="hljs-built_in">..</span>.<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code>connlimit</code>çš„åŒºåŸŸï¼Œå¤§å°ä¸º10MBï¼Œç”¨äºå­˜å‚¨å¹¶å‘è¿æ¥æ•°çš„çŠ¶æ€ã€‚</p><ol start="2"><li><strong>åº”ç”¨è¿æ¥æ•°é™åˆ¶</strong>ï¼šåœ¨éœ€è¦é™åˆ¶çš„locationæˆ–serverä¸Šåº”ç”¨è¿™ä¸ªè§„åˆ™ï¼ˆ<code>limit_conn</code>ï¼‰ã€‚</li></ol><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">server &#123;<br>    <span class="hljs-keyword">location</span> <span class="hljs-title">/ &#123;</span><br><span class="hljs-title">        limit_conn</span> connlimit <span class="hljs-number">10</span>;<br>        ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨<code>/</code>ä½ç½®åº”ç”¨äº†<code>connlimit</code>è§„åˆ™ï¼Œé™åˆ¶æ¯ä¸ªIPæœ€å¤šå¯ä»¥åŒæ—¶å»ºç«‹10ä¸ªè¿æ¥ã€‚</p><hr><blockquote><p>ç½‘å…³é™æµ  ğŸš©</p></blockquote><p>ç½‘å…³é™æµä¸€èˆ¬æ˜¯ä½¿ç”¨ Spring Cloud Gateway æ¥å®ç°ç½‘å…³å±‚é¢çš„æµé‡æ§åˆ¶ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281639179.png" alt="image.png"></p><p>å›´ç»•ç½‘å…³é™æµå¯ç”¨å…ˆå›ç­”ä¸€ä¸‹é¡¹ç›®æ˜¯å¦‚ä½•åšçš„ï¼šæ¯”å¦‚è¯´æ˜¯ï¼šåˆ©ç”¨<code>RequestRateLimiter</code>è¿‡æ»¤å™¨ï¼Œç»“åˆRedisæ¥å­˜å‚¨å’Œç®¡ç†é™æµæ•°æ®ã€‚</p><p>ç„¶åè¯´ä¸€ä¸‹é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°ä¸­æ˜¯åº”ç”¨äº†ä»¤ç‰Œæ¡¶ç®—æ³•çš„æ€æƒ³</p><p>è¿˜å¯ä»¥ç»“åˆ Gateway + Sentinel å®ç°æµæ§ï¼ˆå¸¦è¿‡ï¼‰</p><blockquote><p>ä»¤ç‰Œæ¡¶ç®—æ³•</p></blockquote><p>ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆToken Bucket Algorithmï¼‰æ˜¯ä¸€ç§æµé‡æ§åˆ¶ç®—æ³•ï¼Œå¹¿æ³›åº”ç”¨äºç½‘ç»œæµé‡æ•´å½¢ï¼ˆTraffic Shapingï¼‰å’Œé€Ÿç‡é™åˆ¶ï¼ˆRate Limitingï¼‰ä¸­ã€‚è¯¥ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»¥æ’å®šçš„é€Ÿç‡å‘æ¡¶ä¸­æ·»åŠ ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œè¯·æ±‚æ¶ˆè€—ä»¤ç‰Œæ‰èƒ½è¢«å¤„ç†ï¼Œå¦‚æœæ¡¶ä¸­æ²¡æœ‰ä»¤ç‰Œï¼Œåˆ™è¯·æ±‚è¢«é™åˆ¶ã€‚</p><p>åŸºæœ¬åŸç†</p><ol><li><strong>ä»¤ç‰Œæ¡¶</strong>ï¼šæœ‰ä¸€ä¸ªå›ºå®šå®¹é‡çš„æ¡¶ï¼Œç³»ç»Ÿä»¥å›ºå®šé€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œã€‚å¦‚æœæ¡¶æ»¡äº†ï¼Œåˆ™æ–°æ·»åŠ çš„ä»¤ç‰Œä¼šè¢«ä¸¢å¼ƒã€‚</li><li><strong>è¯·æ±‚å¤„ç†</strong>ï¼šæ¯ä¸ªä¼ å…¥çš„è¯·æ±‚éœ€è¦ä»æ¡¶ä¸­å–å‡ºä¸€å®šæ•°é‡çš„ä»¤ç‰Œã€‚å¦‚æœæ¡¶ä¸­çš„ä»¤ç‰Œè¶³å¤Ÿï¼Œè¯·æ±‚è¢«å¤„ç†ï¼ŒåŒæ—¶ä»æ¡¶ä¸­ç§»é™¤å¯¹åº”æ•°é‡çš„ä»¤ç‰Œï¼›å¦‚æœæ¡¶ä¸­ä»¤ç‰Œä¸è¶³ï¼Œè¯·æ±‚åˆ™æ ¹æ®ç­–ç•¥ï¼ˆå¦‚æ’é˜Ÿã€ç«‹å³æ‹’ç»ç­‰ï¼‰å¤„ç†ã€‚</li><li><strong>æ’å®šé€Ÿç‡</strong>ï¼šä»¤ç‰Œä»¥æ’å®šçš„é€Ÿç‡rè¢«æ·»åŠ åˆ°æ¡¶ä¸­ã€‚è¿™ä¸ªé€Ÿç‡rå†³å®šäº†è¯·æ±‚è¢«å…è®¸çš„æœ€å¤§å¹³å‡é€Ÿç‡ã€‚</li><li><strong>çªå‘æµé‡</strong>ï¼šæ¡¶çš„å®¹é‡å…è®¸åœ¨çŸ­æ—¶é—´å†…å¤„ç†çªå‘æµé‡ã€‚å¦‚æœæ¡¶ä¸­æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œï¼Œè¶…è¿‡å¹³å‡é€Ÿç‡rçš„è¯·æ±‚å¯ä»¥ç«‹å³è¢«å¤„ç†ï¼Œç›´åˆ°æ¡¶ä¸­çš„ä»¤ç‰Œè¢«è€—å°½ã€‚</li></ol><p>åœ¨Spring Cloud Gatewayä¸­ä½¿ç”¨Redis RateLimiterå®ç°é™æµæ—¶ï¼Œå…¶èƒŒåçš„åŸç†å°±å€Ÿé‰´äº†ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚</p><p>é€šè¿‡å®šä¹‰<code>replenishRate</code>å’Œ<code>burstCapacity</code>å‚æ•°ï¼Œåˆ†åˆ«å¯¹åº”ä»¤ç‰Œæ·»åŠ çš„é€Ÿç‡å’Œæ¡¶çš„å®¹é‡ï¼Œä»è€Œå®ç°å¯¹ç½‘å…³æµé‡çš„ç»†ç²’åº¦æ§åˆ¶ã€‚å½“è¯·æ±‚åˆ°è¾¾ç½‘å…³æ—¶ï¼Œä¼šå°è¯•ä»Redisä¸­çš„ä»¤ç‰Œæ¡¶è·å–ä»¤ç‰Œï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¯·æ±‚è¢«å…è®¸é€šè¿‡ï¼›å¦‚æœä»¤ç‰Œä¸è¶³ï¼Œåˆ™è¯·æ±‚è¢«é™æµã€‚</p><ul><li>ä»¤ç‰Œæ·»åŠ é€Ÿç‡</li><li>æ¡¶å®¹é‡</li></ul><hr><p>å…·ä½“ä½¿ç”¨ç¤ºä¾‹ï¼š</p><blockquote><p>Gateway ç½‘å…³é™æµ</p></blockquote><ul><li>1ã€åœ¨Spring Cloud Gatewayä¸­å®ç°ç½‘å…³é™æµï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåˆ©ç”¨<code>RequestRateLimiter</code>è¿‡æ»¤å™¨ï¼Œç»“åˆRedisæ¥å­˜å‚¨å’Œç®¡ç†é™æµæ•°æ®ã€‚</li><li>2ã€è¿˜æœ‰ä¸€ç§æ˜¯ Gateway + Sentinel ç»“åˆå®ç°æµé‡æ§åˆ¶</li></ul><p>è¿™é‡Œè¯´ä¸€ä¸‹ç¬¬ä¸€ç§ï¼Œç¬¬äºŒç§æ„Ÿè§‰å¼•å…¥ç»„ä»¶é€ æˆç³»ç»Ÿå¤æ‚åº¦æå‡ï¼Œå¹¶æ²¡æœ‰é‡‡ç”¨ï¼ˆä»è¿™ä¸ªè§’åº¦å›ç­”ï¼‰</p><p>ç¬¬ä¸€ç§æ–¹å¼</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäºSpring Cloud Gatewayä¸Rediså®ç°ç½‘å…³é™æµçš„ç¤ºä¾‹ã€‚</p><ul><li>1ã€æ·»åŠ Spring Cloud Gatewayå’ŒSpring Boot Redisçš„ä¾èµ–</li><li>2ã€é…ç½® Redis</li><li>3ã€å®šä¹‰é™æµè§„åˆ™</li></ul><p>åœ¨Spring Cloud Gatewayä¸­é€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰è·¯ç”±å’Œé™æµè§„åˆ™ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸º<code>/api/myService/**</code>è·¯å¾„é…ç½®äº†é™æµè§„åˆ™ã€‚</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">spring</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">cloud</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">gateway</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">routes</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">id: myservice_route</span><br>          <span class="hljs-attribute">uri</span><span class="hljs-punctuation">:</span> <span class="hljs-string">lb://MY-SERVICE # å‡è®¾MY-SERVICEæ˜¯ä½ çš„å¾®æœåŠ¡åç§°</span><br>          <span class="hljs-attribute">predicates</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/api/myService/**</span><br>          <span class="hljs-attribute">filters</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">name: RequestRateLimiter</span><br>              <span class="hljs-attribute">args</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-comment"># æ¯ç§’é’Ÿå…è®¸é€šè¿‡çš„è¯·æ±‚æ•°</span><br>                <span class="hljs-attribute">redis-rate-limiter.replenishRate</span><span class="hljs-punctuation">:</span> <span class="hljs-string">10</span><br>                <span class="hljs-comment"># ç”¨æˆ·åœ¨ä¸€ç§’é’Ÿå†…å¯ä»¥çªå‘çš„è¯·æ±‚æ•°é‡</span><br>                <span class="hljs-attribute">redis-rate-limiter.burstCapacity</span><span class="hljs-punctuation">:</span> <span class="hljs-string">20</span><br>                <span class="hljs-comment"># ä½¿ç”¨SpELè¡¨è¾¾å¼æ¥ç¡®å®šé™æµçš„key</span><br>                <span class="hljs-attribute">key-resolver</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#&#123;@ipKeyResolver&#125;&quot;</span><br></code></pre></td></tr></table></figure><ol start="4"><li>å®ç°KeyResolver</li></ol><p><code>key-resolver</code>ç”¨äºç¡®å®šé™æµçš„ç»´åº¦ï¼Œä¾‹å¦‚å¯ä»¥æŒ‰IPåœ°å€é™æµã€‚ä¸‹é¢æ˜¯æŒ‰IPåœ°å€é™æµçš„<code>KeyResolver</code>å®ç°ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">cloud</span>.<span class="hljs-property">gateway</span>.<span class="hljs-property">filter</span>.<span class="hljs-property">ratelimit</span>.<span class="hljs-property">KeyResolver</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Bean</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Configuration</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">server</span>.<span class="hljs-property">ServerWebExchange</span>;<br><span class="hljs-keyword">import</span> reactor.<span class="hljs-property">core</span>.<span class="hljs-property">publisher</span>.<span class="hljs-property">Mono</span>;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RateLimiterConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-title class_">KeyResolver</span> <span class="hljs-title function_">ipKeyResolver</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyResolver</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-title class_">Mono</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">resolve</span>(<span class="hljs-params">ServerWebExchange exchange</span>) &#123;<br>                <span class="hljs-comment">// ä»è¯·æ±‚ä¸­è·å–IPåœ°å€ï¼Œä½œä¸ºé™æµçš„key</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-title class_">Mono</span>.<span class="hljs-title function_">just</span>(exchange.<span class="hljs-title function_">getRequest</span>().<span class="hljs-title function_">getRemoteAddress</span>().<span class="hljs-title function_">getAddress</span>().<span class="hljs-title function_">getHostAddress</span>());<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="5"><li>å¯åŠ¨å¹¶æµ‹è¯•</li></ol><p>å¯åŠ¨Spring Cloud Gatewayåº”ç”¨ï¼Œå¹¶å‘<code>/api/myService/**</code>è·¯å¾„å‘é€è¯·æ±‚æ¥æµ‹è¯•é™æµæ•ˆæœã€‚</p><p>å¦‚æœè¯·æ±‚é€Ÿç‡è¶…è¿‡äº†å®šä¹‰çš„<code>replenishRate</code>å’Œ<code>burstCapacity</code>ï¼Œè¶…å‡ºé™æµæ¡ä»¶çš„è¯·æ±‚å°†ä¼šæ”¶åˆ°429 Too Many Requestså“åº”ã€‚</p><p>æ³¨æ„äº‹é¡¹</p><ul><li>å®é™…éƒ¨ç½²æ—¶ï¼ŒRedisçš„é…ç½®åº”æ ¹æ®ä½ çš„ç¯å¢ƒè¿›è¡Œè°ƒæ•´ï¼ŒåŒ…æ‹¬è€ƒè™‘Redisé›†ç¾¤ç­‰é«˜å¯ç”¨é…ç½®ã€‚</li><li>é™æµå‚æ•°<code>replenishRate</code>å’Œ<code>burstCapacity</code>åº”æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯åˆç†è®¾ç½®ï¼Œé¿å…è¿‡åº¦é™æµå½±å“ç”¨æˆ·ä½“éªŒã€‚</li><li><code>key-resolver</code>çš„å®ç°å¯ä»¥æ ¹æ®å®é™…éœ€è¦é€‰æ‹©ä¸åŒçš„é™æµç»´åº¦ï¼Œé™¤äº†IPåœ°å€å¤–ï¼Œè¿˜å¯ä»¥æŒ‰ç”¨æˆ·IDã€APIè·¯å¾„ç­‰ç»´åº¦è¿›è¡Œé™æµã€‚</li></ul><h4 id="ä½ ä»¬é¡¹ç›®æœåŠ¡ç›‘æ§æ€ä¹ˆåšçš„"><a href="#ä½ ä»¬é¡¹ç›®æœåŠ¡ç›‘æ§æ€ä¹ˆåšçš„" class="headerlink" title="ä½ ä»¬é¡¹ç›®æœåŠ¡ç›‘æ§æ€ä¹ˆåšçš„"></a>ä½ ä»¬é¡¹ç›®æœåŠ¡ç›‘æ§æ€ä¹ˆåšçš„</h4><p>ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§</p><p>ä¸€èˆ¬ç›®çš„æ˜¯ä¸ºäº†ï¼š</p><ul><li>é—®é¢˜å®šä½</li><li>æ€§èƒ½åˆ†æ</li><li>æœåŠ¡å…³ç³»</li><li>æœåŠ¡å‘Šè­¦</li></ul><p>ç›‘æ§å·¥å…·</p><ul><li>Springboot-admin</li><li>prometheus+Grafana</li><li>é“¾è·¯å·¥å…·<ul><li>zipkin</li><li>skywalking</li></ul></li></ul><blockquote><p>å¤§æ¦‚çœ‹ä¸€ä¸‹è¿™ä¸ªç”¨æ³•ï¼šprometheus+Grafana</p></blockquote><p>å¦‚æœå®é™…é—®åˆ°ï¼Œå°±å›ç­”è‡ªå·±å›ç­”æœ‰è¿™ä¸ªç›‘æ§æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨çš„ã€‚</p><p>Prometheuså’ŒGrafanaæ˜¯ä¸€å¯¹å¼ºå¤§çš„ç›‘æ§å’Œå¯è§†åŒ–å·¥å…·ç»„åˆï¼Œå¹¿æ³›ç”¨äºç›‘æ§å¾®æœåŠ¡æ¶æ„ä¸­çš„åº”ç”¨å’ŒåŸºç¡€è®¾æ–½çš„å¥åº·çŠ¶å†µã€æ€§èƒ½æŒ‡æ ‡ç­‰ã€‚è¿™ç§ç»„åˆçš„ç”¨æ³•ä¸»è¦æ¶‰åŠåˆ°ä¸‰ä¸ªæ­¥éª¤ï¼šæ•°æ®æ”¶é›†ï¼ˆPrometheusï¼‰ï¼Œæ•°æ®å­˜å‚¨ï¼ˆPrometheusï¼‰ï¼Œä»¥åŠæ•°æ®å¯è§†åŒ–ï¼ˆGrafanaï¼‰ã€‚</p><blockquote><p>æ­¥éª¤1: æ•°æ®æ”¶é›†</p></blockquote><p>Prometheusé€šè¿‡æ‹‰æ¨¡å¼ï¼ˆpullï¼‰æˆ–æ¨æ¨¡å¼ï¼ˆpushï¼Œéœ€è¦ä½¿ç”¨Pushgatewayï¼‰ä»åº”ç”¨ç¨‹åºå’ŒåŸºç¡€è®¾æ–½ä¸­æ”¶é›†æŒ‡æ ‡æ•°æ®ã€‚é€šå¸¸ï¼Œåº”ç”¨ç¨‹åºå’ŒæœåŠ¡ä¼šæš´éœ²ä¸€ä¸ªHTTPç«¯ç‚¹ï¼ˆé€šå¸¸æ˜¯<code>/metrics</code>ï¼‰ï¼ŒPrometheuså®šæ—¶ä»è¿™äº›ç«¯ç‚¹æŠ“å–ï¼ˆscrapeï¼‰æ•°æ®ã€‚</p><p>ä¸ºäº†è®©Prometheusèƒ½å¤Ÿæ”¶é›†æ•°æ®ï¼Œä½ éœ€è¦åœ¨Prometheusçš„é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯<code>prometheus.yml</code>ï¼‰ä¸­å®šä¹‰æŠ“å–ç›®æ ‡å’Œé¢‘ç‡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">scrape_configs</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">job_name: &#x27;spring-application&#x27;</span><br>    <span class="hljs-attribute">scrape_interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">15s</span><br>    <span class="hljs-attribute">metrics_path</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;/actuator/prometheus&#x27;</span><br>    <span class="hljs-attribute">static_configs</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">targets: [&#x27;localhost:8080&#x27;]</span><br></code></pre></td></tr></table></figure><p>æ•°æ®é‡‡é›†è¿™é‡Œè¦æ±‚ SpringBoot åº”ç”¨å¯¹å¤–å¼€å‘ <code>/metrics</code> æ¥å£ï¼Œå®é™…æ“ä½œé€šå¸¸æ˜¯é€šè¿‡<strong>é›†æˆSpring Boot Actuatorå’ŒMicrometeræ¥å®ç°çš„</strong>ã€‚  ğŸš©</p><p>Spring Boot Actuatoræä¾›äº†ä¸€ç³»åˆ—å†…ç½®çš„ç«¯ç‚¹ï¼ŒåŒ…æ‹¬<code>/metrics</code>ï¼Œç”¨äºç›‘æ§å’Œç®¡ç†åº”ç”¨ã€‚Micrometeråˆ™ä½œä¸ºSpring Bootçš„ç»´åº¦åŒ–æŒ‡æ ‡åº“ï¼Œå……å½“äº†åº”ç”¨å’Œç›‘æ§ç³»ç»Ÿä¹‹é—´çš„æ¡¥æ¢ã€‚</p><ul><li>å¼•å…¥ä¾èµ–ï¼šç¡®ä¿åœ¨Spring Booté¡¹ç›®çš„<code>pom.xml</code>æ–‡ä»¶ä¸­å¼•å…¥äº†Spring Boot Actuatorå’ŒMicrometer Prometheusçš„ä¾èµ–ã€‚</li><li>é…ç½®åº”ç”¨ï¼šç¡®ä¿<code>application.properties</code>æˆ–<code>application.yml</code>é…ç½®æ–‡ä»¶ä¸­å¯ç”¨äº†<code>/metrics</code>ç«¯ç‚¹ã€‚Spring Boot 2.xé»˜è®¤å¯ç”¨äº†å¤§éƒ¨åˆ†Actuatorç«¯ç‚¹ï¼ŒåŒ…æ‹¬<code>/metrics</code>ã€‚</li><li>æš´éœ²&#x2F;metricsç«¯ç‚¹</li><li>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æŒ‡æ ‡</li></ul><blockquote><p>æ­¥éª¤2: æ•°æ®å­˜å‚¨</p></blockquote><p>Prometheusä¼šå°†æ”¶é›†åˆ°çš„æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°çš„æ—¶é—´åºåˆ—æ•°æ®åº“ä¸­ã€‚Prometheusçš„å­˜å‚¨å¼•æ“ä¸“ä¸ºæ—¶é—´åºåˆ—æ•°æ®ä¼˜åŒ–ï¼Œæ”¯æŒé«˜æ•ˆçš„æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢å’Œç®¡ç†ã€‚</p><blockquote><p>æ­¥éª¤3: æ•°æ®å¯è§†åŒ–</p></blockquote><p>Grafanaæ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®å¯è§†åŒ–å·¥å…·ï¼Œæ”¯æŒä»å¤šç§æ•°æ®æºï¼ˆåŒ…æ‹¬Prometheusï¼‰æŸ¥è¯¢å’Œå±•ç¤ºæ•°æ®ã€‚è¦ä½¿ç”¨Grafanaå±•ç¤ºPrometheusçš„æ•°æ®ï¼Œä½ éœ€è¦ï¼š</p><ol><li><strong>å®‰è£…å¹¶å¯åŠ¨Grafana</strong>ï¼šä¸‹è½½å¹¶å®‰è£…Grafanaï¼Œç„¶åå¯åŠ¨GrafanaæœåŠ¡ã€‚</li><li><strong>é…ç½®æ•°æ®æº</strong>ï¼šç™»å½•Grafanaçš„Webç•Œé¢ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„æ•°æ®æºï¼Œé€‰æ‹©Prometheusä½œä¸ºç±»å‹ï¼Œå¹¶é…ç½®PrometheusæœåŠ¡å™¨çš„URLã€‚</li><li><strong>åˆ›å»ºä»ªè¡¨æ¿</strong>ï¼šåœ¨Grafanaä¸­åˆ›å»ºæ–°çš„ä»ªè¡¨æ¿ï¼Œå¯ä»¥æ·»åŠ å¤šç§ç±»å‹çš„é¢æ¿ï¼ˆå¦‚å›¾è¡¨ã€è¡¨æ ¼ã€å•å€¼æŒ‡æ ‡ç­‰ï¼‰æ¥å±•ç¤ºPrometheusæ”¶é›†çš„æŒ‡æ ‡æ•°æ®ã€‚</li><li><strong>æŸ¥è¯¢å’Œå±•ç¤ºæ•°æ®</strong>ï¼šåœ¨ä»ªè¡¨æ¿çš„é¢æ¿ä¸­ï¼Œä½¿ç”¨PromQLï¼ˆPrometheusæŸ¥è¯¢è¯­è¨€ï¼‰ç¼–å†™æŸ¥è¯¢ï¼Œä»Prometheusä¸­æ£€ç´¢æ•°æ®ï¼Œå¹¶æ ¹æ®éœ€æ±‚é…ç½®é¢æ¿çš„æ˜¾ç¤ºæ–¹å¼ã€‚</li></ol><hr><h3 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h3><h4 id="ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—ç®¡ç†æ€ä¹ˆåšçš„"><a href="#ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—ç®¡ç†æ€ä¹ˆåšçš„" class="headerlink" title="ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—ç®¡ç†æ€ä¹ˆåšçš„"></a>ä½ ä»¬é¡¹ç›®ä¸­æ—¥å¿—ç®¡ç†æ€ä¹ˆåšçš„</h4><p>è¿™éƒ¨åˆ†å…ˆä¸ç®¡ï¼Œå¤§æ¦‚è¯´ä¸€ä¸‹ï¼Œå®é™…é¡¹ç›®ä¸­çš„ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯æ€ä¹ˆåšçš„å°±è¡Œ</p><p>to be continedâ€¦.</p><p>åç»­æ‰“ç®—ä¼˜åŒ–å¯ç”¨çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š  <a href="https://www.yuque.com/snailclimb/mf2z3k/ma1byh">https://www.yuque.com/snailclimb/mf2z3k/ma1byh</a></p>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_MQ</title>
    <link href="/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_MQ/"/>
    <url>/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_MQ/</url>
    
    <content type="html"><![CDATA[<h2 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a>MQ</h2><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"></a>ä¸ºä»€ä¹ˆä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h4><p>MQ ä½¿ç”¨çš„åœºæ™¯æœ‰å¾ˆå¤šï¼Œæ ¸å¿ƒçš„åœºæ™¯æ˜¯ï¼šè§£è€¦ã€å¼‚æ­¥ã€å‰Šå³°ï¼›</p><h4 id="æŠ€æœ¯é€‰å‹ï¼Ÿ"><a href="#æŠ€æœ¯é€‰å‹ï¼Ÿ" class="headerlink" title="æŠ€æœ¯é€‰å‹ï¼Ÿ"></a>æŠ€æœ¯é€‰å‹ï¼Ÿ</h4><ul><li>Kafkaï¼šç›´æ¥è¯´ä¸å¤ªäº†è§£</li><li>RocketMQï¼šé«˜æ€§èƒ½ï¼Œä½å»¶è¿Ÿï¼Œä¸»è¦è¿˜æ˜¯å›´ç»•å¯é æ€§å’ŒæŒä¹…æ€§ï¼Œè¯´å½“æ—¶è€ƒè™‘åˆ°æ¶ˆæ¯ä¿è¯ä¸ä¸¢å¤±ï¼Œé€‰ç”¨äº† RocketMQ </li><li>RabbitMQï¼šå¹¶å‘é‡ä¹Ÿä¸ä½ï¼Œç¤¾åŒºå¾ˆæ´»è·ƒ</li></ul><h4 id="å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—"><a href="#å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—"></a>å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—</h4><ul><li>1ã€MQï¼šå­˜å‚¨æ€ä¹ˆè®¾è®¡ã€‚<ul><li>ä½¿ç”¨é«˜å¯ç”¨â€“ç£ç›˜å­˜å‚¨ï¼šé¡ºåºè¯»å†™ã€é›¶æ‹·è´æŠ€æœ¯</li></ul></li><li>2ã€å¯ä¼¸ç¼©ï¼šåˆ†å¸ƒå¼<ul><li>å‚è€ƒï¼šKafka  Broker\topic\partition</li></ul></li><li>3ã€æ¶ˆæ¯ä¸¢å¤±ï¼šæ­å»ºå¤šä¸»å¤šä»ï¼ˆèŠ‚ç‚¹çš„ä¸»ä»æ¶æ„ï¼‰ã€å¤šå‰¯æœ¬ã€Raft åè®®   ä¸€å°ä¸»æœåŠ¡å™¨å®•æœºï¼Œé€‰ä¸¾æœºåˆ¶</li><li>4ã€æ¶ˆæ¯é‡å¤è®¾è®¡</li><li>5ã€ç½‘ç»œæ¡†æ¶ï¼šNetty ï¼ˆæ¨èï¼Œé«˜æ•ˆçš„NIOæ¡†æ¶ï¼‰</li></ul><h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><ul><li>1ã€RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯å¯é æ€§ä¼ è¾“</li><li>2ã€RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</li><li>3ã€RabbitMQå¦‚ä½•å¤„ç†æ¶ˆæ¯å †ç§¯</li><li>4ã€RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯æœ‰åº</li><li>5ã€RabbitMQå¦‚ä½•é¿å…æ¶ˆæ¯é‡å¤æ¶ˆè´¹</li><li>6ã€RabbitMQçš„æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—</li><li>7ã€RabbitMQçš„â¼¯ä½œé˜Ÿåˆ—æ¨¡å¼</li><li>8ã€RabbitMQçš„é«˜å¯ç”¨</li></ul><h4 id="è®²ä¸€ä¸‹RabbitMQçš„ç»„æˆéƒ¨åˆ†"><a href="#è®²ä¸€ä¸‹RabbitMQçš„ç»„æˆéƒ¨åˆ†" class="headerlink" title="è®²ä¸€ä¸‹RabbitMQçš„ç»„æˆéƒ¨åˆ†"></a>è®²ä¸€ä¸‹RabbitMQçš„ç»„æˆéƒ¨åˆ†</h4><p>æ ¸å¿ƒæ¦‚å¿µ</p><ul><li>Brokerï¼šæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡è¿›ç¨‹ã€‚æ­¤è¿›ç¨‹åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šExchangeå’ŒQueueã€‚<ul><li>Exchangeï¼šæ¶ˆæ¯é˜Ÿåˆ—äº¤æ¢æœºã€‚<strong>æŒ‰ä¸€å®šçš„è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±è½¬å‘åˆ°æŸä¸ªé˜Ÿåˆ—</strong>ã€‚</li><li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚</li></ul></li><li>Producerï¼šæ¶ˆæ¯ç”Ÿäº§è€…ã€‚ç”Ÿäº§æ–¹å®¢æˆ·ç«¯å°†æ¶ˆæ¯åŒäº¤æ¢æœºè·¯ç”±å‘é€åˆ°é˜Ÿåˆ—ä¸­ã€‚</li><li>Consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ã€‚æ¶ˆè´¹é˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ¶ˆæ¯ã€‚</li></ul><h4 id="è¯´ä¸€ä¸‹-RabbitMQ-çš„å·¥ä½œæµç¨‹"><a href="#è¯´ä¸€ä¸‹-RabbitMQ-çš„å·¥ä½œæµç¨‹" class="headerlink" title="è¯´ä¸€ä¸‹ RabbitMQ çš„å·¥ä½œæµç¨‹"></a>è¯´ä¸€ä¸‹ RabbitMQ çš„å·¥ä½œæµç¨‹</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240311230336.png" alt="image.png"></p><ul><li>å»ºç«‹è¿æ¥</li><li>ç”Ÿäº§è€…<ul><li>å£°æ˜äº¤æ¢æœºç±»å‹ã€åç§°ã€æ˜¯å¦æŒä¹…åŒ–ç­‰</li><li>å‘é€æ¶ˆæ¯</li></ul></li><li>äº¤æ¢æœº<ul><li>äº¤æ¢æœºæ¥æ”¶æ¶ˆæ¯ï¼Œè¿›è¡Œæ¶ˆæ¯è·¯ç”±</li></ul></li><li>æ¶ˆè´¹è€…<ul><li>è®¢é˜…æ¶ˆæ¯ï¼ˆç›‘å¬é˜Ÿåˆ—ï¼‰</li><li>æ¥æ”¶æ¶ˆæ¯ï¼Œä¸šåŠ¡å¤„ç†</li></ul></li></ul><h4 id="è®²ä¸€ä¸‹-RabbitMQ-ä¸­å¸¸ç”¨çš„äº¤æ¢æœºç±»å‹"><a href="#è®²ä¸€ä¸‹-RabbitMQ-ä¸­å¸¸ç”¨çš„äº¤æ¢æœºç±»å‹" class="headerlink" title="è®²ä¸€ä¸‹ RabbitMQ ä¸­å¸¸ç”¨çš„äº¤æ¢æœºç±»å‹"></a>è®²ä¸€ä¸‹ RabbitMQ ä¸­å¸¸ç”¨çš„äº¤æ¢æœºç±»å‹</h4><p>ï¼ˆäº¤æ¢æœº â†’  é˜Ÿåˆ—ï¼‰</p><ul><li>Direct Exchange<ul><li><code>binding key</code> ä¸æ¶ˆæ¯çš„ <code>routing key</code> å®Œå…¨åŒ¹é…é˜Ÿåˆ—</li></ul></li><li>Topic Exchange<ul><li>æ¨¡ç³ŠåŒ¹é…</li></ul></li><li>Fanout Exchange<ul><li>å¹¿æ’­ï¼ˆå¿½ç•¥ <code>routing key</code> ï¼‰</li></ul></li><li>Headers Exchange<ul><li>ä¸ä¾èµ– <code>routing key</code>ï¼Œå¤´éƒ¨å±æ€§åŒ¹é…</li></ul></li></ul><h4 id="RabbitMQçš„æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—"><a href="#RabbitMQçš„æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="RabbitMQçš„æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—"></a>RabbitMQçš„æ­»ä¿¡é˜Ÿåˆ—å’Œå»¶è¿Ÿé˜Ÿåˆ—</h4><ul><li>æ­»ä¿¡äº¤æ¢æœº<ul><li>æ­»ä¿¡äº¤æ¢æœºï¼ˆDead-Letter Exchange, DLXï¼‰æ˜¯RabbitMQä¸­ç”¨äºå¤„ç†æ— æ³•æ­£å¸¸æŠ•é€’çš„æ¶ˆæ¯çš„ä¸€ç§æœºåˆ¶ã€‚</li><li>å½“æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­å˜æˆæ­»ä¿¡ï¼ˆDead Letterï¼‰åï¼Œå¯ä»¥è¢«è‡ªåŠ¨é‡æ–°è·¯ç”±åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºï¼Œè¿™ä¸ªäº¤æ¢æœºå°±æ˜¯æ‰€è°“çš„æ­»ä¿¡äº¤æ¢æœºã€‚</li><li>æ¶ˆæ¯å˜æˆæ­»ä¿¡çš„æƒ…å†µé€šå¸¸åŒ…æ‹¬ï¼š<ul><li><ol><li>æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆBasic.Reject&#x2F;Basic.Nackï¼‰å¹¶ä¸”è®¾ç½®äº†requeueå‚æ•°ä¸ºfalseï¼Œä¸é‡æ–°å…¥é˜Ÿã€‚</li></ol></li><li><ol start="2"><li>æ¶ˆæ¯TTLè¿‡æœŸï¼ˆæ¶ˆæ¯è®¾ç½®äº†ç”Ÿå­˜æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æœªè¢«æ¶ˆè´¹ï¼‰ï¼Œè¶…æ—¶æ— äººæ¶ˆè´¹</li></ol></li><li><ol start="3"><li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ï¼ˆé˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ›´å¤šæ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼‰ï¼Œæœ€æ—©çš„æ¶ˆæ¯å¯èƒ½æˆä¸ºæ­»ä¿¡</li></ol></li></ul></li></ul></li><li>å»¶è¿Ÿé˜Ÿåˆ—<ul><li>RabbitMQæœ¬èº«å¹¶ä¸ç›´æ¥æ”¯æŒå»¶è¿Ÿé˜Ÿåˆ—ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼é—´æ¥å®ç°ï¼š<ul><li>ä¸€ç§æ–¹å¼æ˜¯ï¼šRabbitMQ çš„å»¶è¿Ÿé˜Ÿåˆ—é€šè¿‡æ­»ä¿¡äº¤æ¢æœº + TTL ï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰æ¥å®ç°çš„ï¼›</li><li>è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ RabbitMQ çš„å»¶è¿Ÿé˜Ÿåˆ—ç›¸å…³çš„ä¸€ä¸ªæ’ä»¶ï¼Œå«åšï¼šDelayExchangeï¼Œé€šè¿‡è¿™ç§æ–¹å¼çš„è¯åªéœ€è¦åœ¨å£°æ˜äº¤äº’æœºçš„æ—¶å€™ï¼ŒæŒ‡å®šè¿™ä¸ªå°±æ˜¯æ­»ä¿¡äº¤æ¢æœºï¼Œç„¶ååœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ç›´æ¥æŒ‡å®šè¶…æ—¶æ—¶é—´å°±è¡Œã€‚</li></ul></li></ul></li></ul><hr><p>å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶ä½¿ç”¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228060325.png" alt="image.png"></p><h4 id="æ€ä¹ˆä¿è¯é«˜å¯ç”¨-ğŸ"><a href="#æ€ä¹ˆä¿è¯é«˜å¯ç”¨-ğŸ" class="headerlink" title="æ€ä¹ˆä¿è¯é«˜å¯ç”¨ ğŸ"></a>æ€ä¹ˆä¿è¯é«˜å¯ç”¨ ğŸ</h4><p>ä¸€èˆ¬ä¼šä½¿ç”¨é›†ç¾¤æ¨¡å¼ï¼Œåœ¨ RabbitMQ ä¸­ï¼Œåˆ†ä¸ºäº†æ™®é€šé›†ç¾¤æ¨¡å¼ã€é•œåƒé›†ç¾¤æ¨¡å¼ã€ä»²è£é˜Ÿåˆ—æ¨¡å¼</p><p>æ™®é€šé›†ç¾¤æ¨¡å¼ï¼ˆæ ‡å‡†é›†ç¾¤ï¼‰</p><ul><li>1ã€åœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹å…±äº«éƒ¨åˆ†æ•°æ®</li><li>2ã€å½“è®¿é—®é›†ç¾¤æŸä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœé˜Ÿåˆ—ä¸åœ¨è¯¥èŠ‚ç‚¹ï¼Œä¼šä»æ•°æ®æ‰€åœ¨èŠ‚ç‚¹ä¼ é€’åˆ°å½“å‰èŠ‚ç‚¹å¹¶è¿”å›</li><li>3ã€é˜Ÿåˆ—æ‰€åœ¨èŠ‚ç‚¹å®•æœºï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±<ul><li>è¿™ç§æ¨¡å¼å¹¶ä¸èƒ½åŒ…æ‹¬é«˜å¯ç”¨</li><li>å®é™…ä¸Šè¿˜æ˜¯ä¸ºäº†æé«˜ååé‡çš„</li></ul></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240311190046.png" alt="image.png"></p><p>é•œåƒé›†ç¾¤ï¼š</p><ul><li>æœ¬è´¨ä¸Šæ˜¯ä¸»ä»æ¨¡å¼<ul><li>äº¤æ¢æœºã€é˜Ÿåˆ—ã€é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šåœ¨å„ä¸ª mq çš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥å¤‡ä»½ã€‚</li><li>åˆ›å»ºé˜Ÿåˆ—çš„èŠ‚ç‚¹è¢«ç§°ä¸ºè¯¥é˜Ÿåˆ—çš„<strong>ä¸»èŠ‚ç‚¹</strong>ï¼Œå¤‡ä»½åˆ°çš„å…¶å®ƒèŠ‚ç‚¹å«åšè¯¥é˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹ã€‚</li><li>ä¸€ä¸ªé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ªé˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹</li><li>æ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹</li><li>ä¸»å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»</li></ul></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240311190304.png" alt="image.png"></p><p>ä»²è£é˜Ÿåˆ—</p><ul><li>å’Œé•œåƒæ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œä»–æ·»åŠ äº†ä¸€ä¸ªä¸»ä»åŸºäº Raft åè®®çš„æ–¹å¼ï¼Œä½¿å¾—æ¶ˆæ¯åŒæ­¥å˜ä¸ºäº†å¼ºä¸€è‡´æ€§ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240311190500.png" alt="image.png"></p><hr><p>å‚è€ƒæ¨¡æ‹Ÿé—®ç­”ï¼š</p><blockquote><p>é¢è¯•å®˜ï¼šRabbitMQçš„é«˜å¯ç”¨æœºåˆ¶æœ‰äº†è§£è¿‡å˜›</p></blockquote><p>å€™é€‰äººï¼šå—¯ï¼Œç†Ÿæ‚‰çš„ï¼›æˆ‘ä»¬å½“æ—¶é¡¹ç›®åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨çš„é›†ç¾¤ï¼Œå½“æ—¶æ­å»ºæ˜¯é•œåƒæ¨¡å¼é›†ç¾¤ï¼Œä½¿ç”¨äº†3å°æœºå™¨ã€‚<br>é•œåƒé˜Ÿåˆ—ç»“æ„æ˜¯ä¸€ä¸»å¤šä»ï¼Œæ‰€æœ‰æ“ä½œæ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹ï¼Œå¦‚æœä¸»èŠ‚ç‚¹å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œä¸è¿‡åœ¨ä¸»ä»åŒæ­¥å®Œæˆå‰ï¼Œä¸»èŠ‚ç‚¹å°±å·±ç»å®•æœºï¼Œå¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±ã€‚</p><blockquote><p>é¢è¯•å®˜ï¼šé‚£å‡ºç°ä¸¢æ•°æ®æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p></blockquote><p>å€™é€‰äººï¼šæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä»²è£é˜Ÿåˆ—ï¼Œä¸é•œåƒé˜Ÿåˆ—ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸»ä»æ¨¡å¼ï¼Œæ”¯æŒä¸»ä»æ•°æ®åŒæ­¥ï¼Œä¸»ä»åŒæ­¥åŸºäº Raft å<br>è®®ï¼Œå¼ºä¸€è‡´ã€‚å¹¶ä¸”ä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸ç®€å•ï¼Œä¸éœ€è¦é¢å¤–çš„é…ç½®ï¼Œåœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™åªè¦æŒ‡å®šè¿™ä¸ªæ˜¯ä»²è£é˜Ÿåˆ—å³å¯</p><h3 id="ç”Ÿäº§é—®é¢˜"><a href="#ç”Ÿäº§é—®é¢˜" class="headerlink" title="ç”Ÿäº§é—®é¢˜"></a>ç”Ÿäº§é—®é¢˜</h3><h4 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"><a href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" class="headerlink" title="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"></a>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</h4><ul><li>å‘é€æ¶ˆæ¯è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼šæ¶ˆæ¯ â†’  é˜Ÿåˆ—ï¼›é˜Ÿåˆ—æœ¬èº«ï¼Œé˜Ÿåˆ— â†’  æ¶ˆè´¹è€…<ul><li>å¼€å¯ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ï¼Œç¡®ä¿ç”Ÿäº§è€…çš„æ¶ˆæ¯èƒ½åˆ°è¾¾é˜Ÿåˆ—</li><li>å¼€å¯æŒä¹…åŒ–åŠŸèƒ½ï¼Œç¡®ä¿æ¶ˆæ¯æœ«æ¶ˆè´¹å‰åœ¨é˜Ÿåˆ—ä¸­ä¸ä¼šä¸¢å¤±</li><li>å¼€å¯æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ä¸ºauto,ç”±springç¡®è®¤æ¶ˆæ¯å¤„ç†æˆåŠŸåå®Œæˆack</li><li>å¼€å¯æ¶ˆè´¹è€…å¤±æ•°é‡è¯•æœºåˆ«ï¼ˆé‡è¯•æ¬¡æ•°ä¸€èˆ¬è®¾ç½®ä¸º3ï¼‰ï¼Œå¤šæ¬¡é‡è¯•å¤±æ•°åå°†æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸äº¤æ¢æœºï¼Œäº¤ç”±äººå·¥å¤„ç†</li></ul></li></ul><hr><p>å‚è€ƒæ¨¡æ‹Ÿé—®ç­”ï¼š</p><blockquote><p>é¢è¯•å®˜ï¼šRabbitMQ-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</p></blockquote><p>å€™é€‰äººï¼šæˆ‘ä»¬å½“æ—¶ MySQL å’Œ Redis çš„æ•°æ®åŒå†™ä¸€è‡´æ€§æ˜¯é‡‡ç”¨çš„ RabbitMQ å®ç°åŒæ­¥ï¼Œè¿™é‡Œé¢æ˜¯è¦æ±‚äº†æ¶ˆæ¯çš„é«˜å¯ç”¨æ€§ï¼Œå› æ­¤éœ€è¦ä¿è¯æ¶ˆæ¯ä¸è¿›è¡Œä¸¢å¤±ã€‚</p><p>å½“æ—¶ä¸»è¦æ˜¯ä»ä¸‰ä¸ªå±‚é¢è€ƒè™‘ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªæ˜¯å¼€å¯ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ï¼Œç¡®ä¿ç”Ÿäº§è€…çš„é…’æ¯èƒ½åˆ—è¾¾é˜Ÿåˆ—ï¼Œå¦‚æœæŠ¥é”™å¯ä»¥å…ˆè®°å½•åˆ—æ—¥å¿—ä¸­ï¼Œå†å»ä¿®å¤æ•°æ®</li><li>ç¬¬äºŒä¸ªæ˜¯å¼€å¯æŒä¹…åŒ–åŠŸèƒ½ï¼Œç¡®ä¿æ¶ˆæ¯æœªæ¶ˆè´¹å‰åœ¨é˜Ÿåˆ—ä¸­ä¸ä¼šä¸¢å¤±ï¼Œå…¶ä¸­çš„äº¤æ¢æœºã€é˜Ÿåˆ—ã€å’Œæ¶ˆæ¯éƒ½è¦åšæŒä¹…åŒ–</li><li>ç¬¬ä¸‰ä¸ªæ˜¯å¼€å¯æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ä¸ºauto, ç”± spring ç¡®è®¤æ¶ˆæ¯å¤„ç†æˆåŠŸåå®Œæˆ ackï¼›å½“ç„¶ä¹Ÿéœ€è¦è®¾ç½®ä¸€å®šçš„é‡è¯•æ¬¡æ•°ï¼Œæˆ‘ä»¬å½“æ—¶æ˜¯è®¾ç½®äº† 3 æ¬¡ï¼Œå¦‚æœé‡è¯• 3 æ¬¡è¿˜æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œå°±å°†å¤±è´¥åçš„æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸äº¤æ¢æœºï¼Œäº¤ç»™äººå·¥å¤„ç†ã€‚</li></ul><h4 id="æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜æ€ä¹ˆè§£å†³"><a href="#æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜æ€ä¹ˆè§£å†³" class="headerlink" title="æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜æ€ä¹ˆè§£å†³"></a>æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜æ€ä¹ˆè§£å†³</h4><p>å‡ºç°æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„é—®é¢˜ä¸€èˆ¬æ˜¯åœ¨ç½‘ç»œæŠ–åŠ¨æˆ–è€…æ¶ˆæ¯è€…æŒ‚æ‰ï¼Œç”±äºå¼€å¯äº†æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ï¼Œå¯¼è‡´æ¶ˆæ¯é‡å‘</p><p>ä¸€èˆ¬è§£å†³æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ul><li>ä¸€ç§æ˜¯æ¯æ¡æ¶ˆæ¯è®¾ç½®ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯† ID ä»è€Œé¿å…é‡å‘æ¶ˆè´¹</li><li>ä¹Ÿå¯ä»¥è€ƒè™‘å¹‚ç­‰æ€§è®¾è®¡é—®é¢˜ï¼Œè€ƒè™‘ä½¿ç”¨åˆ†å¸ƒå¼é”ã€æ•°æ®åº“é”ï¼ˆæ‚²è§‚é”ã€ä¹è§‚é”ï¼‰ç­‰ï¼Œä½†é”ä¼šå¯¹æ€§èƒ½æœ‰å½±å“ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦è€ƒè™‘ä½¿ç”¨</li></ul><p>ä¸€èˆ¬å›ç­”å¯ä»¥å€¾å‘å›ç­”ç¬¬ä¸€ç§å›ç­”ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402271532774.png" alt="image.png"></p><hr><p>å‚è€ƒæ¨¡æ‹Ÿé—®ç­”ï¼š</p><blockquote><p>é¢è¯•å®˜ï¼ŒRabbitMQ æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜ä½ ä»¬æ˜¯å¦‚ä½•è§£å†³çš„</p></blockquote><p>å€™é€‰äººï¼šè¿™ä¸ªæˆ‘è¿˜çœŸé‡åˆ°è¿‡ã€‚æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬å½“æ—¶æ¶ˆè´¹è€…æ˜¯è®¾ç½®äº†è‡ªè¯—ç¡®è®¤æœºåˆ¶ï¼Œå½“ä¸šåŠ¡è¿˜æ²¡æ¥å¾—åŠç»™ MQ ç¡®è®¤çš„æ—¶å€™ã€‚æœåŠ¡å²©æœºäº†ã€‚å¯¼æ•°æœåŠ¡é‡å¯ä¹‹åï¼Œåˆè¿›è¡Œäº†ä¸€æ¬¡æ¶ˆè´¹æ¶ˆæ¯ã€‚è¿™æ ·å°±é‡å¤æ¶ˆè´µäº†ã€‚</p><p>å› ä¸ºæˆ‘ä»¬å½“æ—¶å¤„ç†çš„æ”¯ä»˜ï¼ˆè®¢å•|ä¸šåŠ¡å”¯ä¸€æ ‡è¯†ï¼‰ï¼Œå®ƒæœ‰ä¸€ä¸ªä¸šåŠ¡çš„å”¯ä¸€æ ‡è¯†ã€‚æˆ‘ä»¬å†å¤„ç†æ¶ˆæ¯æ—¶ï¼Œå…ˆåˆ°æ•°æ®åº“æŸ¥è¯¢ä¸€ä¸‹ï¼Œè¿™ä¸ªæ•°æ®æ˜¯å¦åœ¨ï¼Œå¦‚æ˜¯ä¸å­˜åœ¨ï¼Œè¯´æ˜è®¾æœ‰å¤„ç†è¿‡ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥æ­£å¸¸å¤„ç†è¿™ä¸ªæ¶ˆæ¯äº†ï¼Œå¦‚æœå·±ç»å­˜åœ¨è¿™ä¸ªæ•°æ®äº†ï¼Œåˆ™è¯´æ˜æ¶ˆæ¯é‡å¤æ¶ˆè´¹äº†ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ¶ˆè´¹äº†ã€‚</p><blockquote><p>é¢è¯•å®˜ï¼šä½ è¿˜çŸ¥é“å…¶ä»–çš„è§£å†³æ–¹æ¡ˆå—</p></blockquote><p>å€™é€‰äººï¼šæˆ‘æƒ³ä¸€ä¸‹ï¼Œå…¶å®è¿™ä¸ªå…¶æ˜¯å…¸å‹çš„å¹‚ç­‰çš„é—®é¢˜ï¼Œæ¯”çŸ¥ï¼Œredis åˆ†å¸ƒå¼é”ã€æ•°æ®åº“çš„é”éƒ½æ˜¯å¯ä»¥çš„ã€‚</p><h4 id="æ¶ˆæ¯å †ç§¯é—®é¢˜æ€ä¹ˆè§£å†³"><a href="#æ¶ˆæ¯å †ç§¯é—®é¢˜æ€ä¹ˆè§£å†³" class="headerlink" title="æ¶ˆæ¯å †ç§¯é—®é¢˜æ€ä¹ˆè§£å†³"></a>æ¶ˆæ¯å †ç§¯é—®é¢˜æ€ä¹ˆè§£å†³</h4><p>RabbitMQ å¦‚æœæœ‰100ä¸‡æ¶ˆæ¯å †ç§¯åœ¨MQï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</p><p>å½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦è¶…è¿‡äº†æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå°±ä¼šå¯¼è‡´é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å †ç§¯ï¼Œç›´åˆ°é˜Ÿåˆ—å­˜å‚¨æ¶ˆæ¯è¾¾åˆ°ä¸Šé™ã€‚ä¹‹åå‘é€çš„æ¶ˆæ¯å°±ä¼šæˆä¸ºæ­»ä¿¡ï¼Œå¯èƒ½ä¼šè¢«ä¸¢å¼ƒï¼Œè¿™å°±æ˜¯æ¶ˆæ¯å †ç§¯é—®é¢˜ã€‚</p><p>è§£å†³æ¶ˆæ¯å †ç§¯æœ‰ä¸‰ç§ç§æ€è·¯ï¼š</p><ul><li>å¢åŠ æ›´å¤šæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</li><li>åœ¨æ¶ˆè´¹è€…å†…å¼€å¯çº¿ç¨‹æ± åŠ å¿«æ¶ˆæ¯å¤„ç†é€Ÿåº¦</li><li>æ‰©å¤§é˜Ÿåˆ—å®¹ç§¯ï¼Œæé«˜å †ç§¯ä¸Šé™ï¼Œé‡‡ç”¨æƒ°æ€§é˜Ÿåˆ—<ul><li>åœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™å¯ä»¥è®¾ç½®å±æ€§x-queue-modeä¸ºlazy,å³ä¸ºæƒ°æ€§é˜Ÿåˆ—</li><li>åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯ä¸Šé™é«˜</li><li>æ€§èƒ½æ¯”è¾ƒç¨³å®šï¼Œä½†åŸºäºç£ç›˜å­˜å‚¨ï¼Œå—é™äºç£ç›˜ IO,æ—¶æ•ˆæ€§ä¼šé™ä½</li></ul></li></ul><p>æƒ°æ€§é˜Ÿåˆ—ï¼šæƒ°æ€§é˜Ÿåˆ—é€šè¿‡æ”¹å˜æ¶ˆæ¯å­˜å‚¨çš„ç­–ç•¥ï¼Œå°†æ¶ˆæ¯å°½å¯èƒ½åœ°å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œè€Œä¸æ˜¯ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œä»è€Œå‡è½»å¯¹å†…å­˜çš„å‹åŠ›ã€‚</p><hr><p>å‚è€ƒæ¨¡æ‹Ÿé—®ç­”ï¼š</p><blockquote><p>é¢è¯•å®˜ï¼šå¦‚æœæœ‰100ä¸‡æ¶ˆæ¯å †ç§¯åœ¨MQ,å¦‚ä½•è§£å†³ï¼Ÿ</p></blockquote><p>å€™é€‰äººï¼š</p><ul><li>æˆ‘åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œæ²¡é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼Œä¸è¿‡ï¼Œå¦‚æœå‘ç”Ÿäº†å †ç§¯çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆä¹Ÿæ‰€æœ‰å¾ˆå¤šçš„</li><li>ç¬¬ä¸€ï¼šæé«˜æ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›ï¼Œå¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹æ¶ˆè´¹ä»»åŠ¡</li><li>ç¬¬äºŒï¼šå¢åŠ æ›´å¤šæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦ï¼›ä½¿ç”¨å·¥ä½œé˜Ÿåˆ—æ¨¡å¼è®¾ç½®å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</li><li>ç¬¬ä¸‰ï¼šæ‰©å¤§é˜Ÿåˆ—å®¹ç§¯ï¼Œæé«˜å †ç§¯ä¸Šé™<ul><li>å¯ä»¥ä½¿ç”¨RabbitMOæƒ°æ€§é˜Ÿåˆ—ï¼Œæƒ…æ€§é˜Ÿåˆ—çš„å¥½å¤„ä¸»è¦æ˜¯<ul><li>â‘ æ¥æ”¶åˆ°æ¶ˆæ¯åç›´æ¥å­˜å…¥ç£ç›˜è€Œéå†…å­˜</li><li>â‘¡æ¶ˆè´¹è€…è¦æ¶ˆè´¹æ¶ˆæ¯æ—¶æ‰ä¼šä»ç£ç›˜ä¸­è¯»å–å¹¶åŠ è½½åˆ°å†…å­˜</li><li>â‘¢æ”¯æŒæ•°ç™¾ä¸‡æ¡çš„æ¶ˆæ¯å­˜å‚¨</li></ul></li></ul></li></ul><h2 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h2><p>RocketMQ çš„è¿‡ä¸€ä¸‹è¿™ä¸ªï¼š <a href="https://www.bilibili.com/video/BV1d5411y7UW">https://www.bilibili.com/video/BV1d5411y7UW</a></p><ul><li>1ã€è®²ä¸€ä¸‹ RocketMQ çš„æ¶ˆæ¯æ¨¡å‹ï¼Ÿ</li><li>2ã€è®²ä¸€ä¸‹ RocketMQ çš„åŸºæœ¬æ¶æ„ã€‚</li><li>3ã€æ¶ˆæ¯çš„æ¶ˆè´¹æ¨¡å¼äº†è§£å—ï¼Ÿ</li><li>4ã€å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯ç”¨æ€§&#x2F;å¯é æ€§&#x2F;ä¸ä¸¢å¤±å‘¢</li><li>5ã€æ¶ˆæ¯é‡å¤é—®é¢˜å¦‚ä½•å¤„ç†ã€‚</li><li>6ã€æ¶ˆæ¯å †å‹é—®é¢˜å¦‚ä½•è§£å†³</li><li>7ã€é¡ºåºæ¶ˆæ¯å¦‚ä½•å®ç°</li><li>8ã€å¦‚ä½•å®ç°æ¶ˆæ¯è¿‡æ»¤</li><li>9ã€RocketMQ æ˜¯å¦‚ä½•å®ç°å»¶æ—¶æ¶ˆæ¯çš„</li><li>10ã€æ€ä¹ˆå®ç°æ¶ˆæ¯çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„ï¼ŒåŠæ¶ˆæ¯ï¼Ÿ</li><li>11ã€æ­»ä¿¡é˜Ÿåˆ—äº†è§£å—</li><li>12ã€å¦‚ä½•ä¿è¯RocketMQçš„é«˜å¯ç”¨ï¼Ÿ</li><li>13ã€è¯´ä¸€ä¸‹RocketMQçš„æ•´ä½“å·¥ä½œæµç¨‹ï¼Ÿ</li><li>14ã€æ¶ˆæ¯åˆ·ç›˜æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240311232709.png" alt="image.png"></p><h4 id="Rocketmqä¸­Brokerçš„éƒ¨ç½²æ–¹å¼"><a href="#Rocketmqä¸­Brokerçš„éƒ¨ç½²æ–¹å¼" class="headerlink" title="Rocketmqä¸­Brokerçš„éƒ¨ç½²æ–¹å¼"></a>Rocketmqä¸­Brokerçš„éƒ¨ç½²æ–¹å¼</h4><ul><li>å•æœº Broker</li><li>å¤š Master </li><li>å¤š Master å¤š Slave ï¼ˆç”Ÿäº§å¸¸è§æ¨¡å¼ï¼‰ã€å¤šä¸»å¤šä»ã€‘</li></ul><h4 id="RocketMQ-çš„-ä¸»è¦ç»„ä»¶"><a href="#RocketMQ-çš„-ä¸»è¦ç»„ä»¶" class="headerlink" title="RocketMQ çš„ ä¸»è¦ç»„ä»¶"></a>RocketMQ çš„ ä¸»è¦ç»„ä»¶</h4><p>åŸºç¡€ç»„ä»¶æœ‰ï¼šNameServer æ³¨å†Œä¸­å¿ƒã€Broker æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ã€Producerã€Consumer</p><ul><li>NameServer<ul><li>ä¸»è¦æ˜¯â½¤äºæœåŠ¡æ³¨å†Œä»¥åŠBrokerè·¯ç”±</li></ul></li><li>Broker<ul><li>å®é™…å¤„ç†æ¶ˆæ¯å­˜å‚¨ã€è½¬å‘çš„æœåŠ¡</li></ul></li><li>Producer<ul><li>å‘é€æ¶ˆæ¯åˆ°Brokerç«¯</li></ul></li><li>Consumer<ul><li>æ¥æ”¶Brokerç«¯æ¨é€çš„æ¶ˆæ¯æˆ–ä¸»åŠ¨ä»Brokerç«¯æ‹‰å–æ¶ˆæ¯</li></ul></li><li>Topic<ul><li>RocketMQæ ¹æ®ä¸»é¢˜è¿›â¾æ¶ˆæ¯åˆ†ç±»ï¼Œâ½£äº§ç«¯å‘é€æ¶ˆæ¯æ—¶éœ€è¦æŒ‡ å®šä¸»é¢˜</li></ul></li><li>MessageQueue<ul><li>ç›¸å½“äºTopicçš„åˆ†åŒºï¼Œâ¼€ä¸ªTopicé»˜è®¤4ä¸ªMessageQueue</li></ul></li></ul><h4 id="RocketMQ-çš„å·¥ä½œæµç¨‹"><a href="#RocketMQ-çš„å·¥ä½œæµç¨‹" class="headerlink" title="RocketMQ çš„å·¥ä½œæµç¨‹"></a>RocketMQ çš„å·¥ä½œæµç¨‹</h4><p>RocketMQç”±NameServeré›†ç¾¤ã€Produceré›†ç¾¤ã€Consumeré›†ç¾¤ã€Brokeré›†ç¾¤ç»„æˆï¼Œæ¶ˆæ¯ç”Ÿäº§å’Œæ¶ˆè´¹çš„å¤§è‡´åŸç†å¦‚ä¸‹ï¼š</p><ul><li>1ã€Brokeråœ¨å¯åŠ¨çš„æ—¶å€™å‘æ‰€æœ‰çš„NameServeriæ³¨å†Œï¼Œå¹¶ä¿æŒé•¿è¿æ¥ï¼Œæ¯30så‘é€ä¸€æ¬¡å¿ƒè·³</li><li>2ã€Produceråœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ä»NameServerè·å–BrokeræœåŠ¡å™¨åœ°å€ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©ä¸€å°æœåŠ¡å™¨æ¥å‘é€æ¶ˆæ¯</li><li>3ã€Conusmeriæ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™åŒæ ·ä»NameServerè·å–Brokeråœ°å€ï¼Œç„¶åä¸»åŠ¨æ‹‰å–æ¶ˆæ¯æ¥æ¶ˆè´¹</li></ul><h4 id="è·¯ç”±æ³¨å†Œ"><a href="#è·¯ç”±æ³¨å†Œ" class="headerlink" title="è·¯ç”±æ³¨å†Œ"></a>è·¯ç”±æ³¨å†Œ</h4><ul><li>NameServeræ¯éš”1Osæ‰«æbrokerLiveTable,æ£€æŸ¥ä¸Šæ¬¡å¿ƒè·³æ—¶é—´ä¸å½“å‰æ—¶é—´çš„æ—¶å·®ï¼Œå¦‚æœè¶…è¿‡120s,è®¤ä¸ºbrokerä¸å¯ä»¥ç”¨ï¼Œç§»é™¤è·¯ç”±è¡¨ä¸­brokerç›¸å…³æ‰€æœ‰ä¿¡æ¯</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307140637.png" alt="image.png"></p><h4 id="è·¯ç”±å‰”é™¤"><a href="#è·¯ç”±å‰”é™¤" class="headerlink" title="è·¯ç”±å‰”é™¤"></a>è·¯ç”±å‰”é™¤</h4><ul><li>å®šæ—¶æ‰«æåˆ¤æ–­è¯¥è·¯ç”±èŠ‚ç‚¹æ˜¯å¦å¯ç”¨</li></ul><h4 id="RocketMQä¸ºä»€ä¹ˆè¦æ”¾å¼ƒZookeeper"><a href="#RocketMQä¸ºä»€ä¹ˆè¦æ”¾å¼ƒZookeeper" class="headerlink" title="RocketMQä¸ºä»€ä¹ˆè¦æ”¾å¼ƒZookeeper"></a>RocketMQä¸ºä»€ä¹ˆè¦æ”¾å¼ƒZookeeper</h4><p>RocketMQä¸»è¦æ˜¯ä¿éšœæœ€ç»ˆâ¼€è‡´æ€§ï¼Œå®ƒåªéœ€è¦â¼€ä¸ªè½»é‡çº§çš„å…ƒæ•°æ®æœ åŠ¡å°±â¾äº†ï¼Œâ½½Zookeeperæ˜¯å¼ºâ¼€è‡´æ€§çš„è§£å†³â½…æ¡ˆï¼Œå¹¶ä¸”å°‘ä½¿â½¤â¼€ä¸ªä¸­ é—´ä»¶å¯ä»¥å‡å°‘ç»´æŠ¤æˆæœ¬</p><p>è¿˜æœ‰ä¸€æ–¹é¢RocketMQ æ˜¯è®¾è®¡æ˜¯è®©æ³¨å†Œä¸­å¿ƒå°½é‡è½»é‡åŒ–ï¼Œä½¿å¾—æ¶ˆæ¯å‘é€å¼±ä¾èµ–æ³¨å†Œä¸­å¿ƒã€‚</p><h4 id="è®²ä¸€ä¸‹-RocketMQ-çš„æ¶ˆæ¯æ¨¡å‹ï¼Ÿ"><a href="#è®²ä¸€ä¸‹-RocketMQ-çš„æ¶ˆæ¯æ¨¡å‹ï¼Ÿ" class="headerlink" title="è®²ä¸€ä¸‹ RocketMQ çš„æ¶ˆæ¯æ¨¡å‹ï¼Ÿ"></a>è®²ä¸€ä¸‹ RocketMQ çš„æ¶ˆæ¯æ¨¡å‹ï¼Ÿ</h4><p>æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä¸¤ç§æ¨¡å‹ï¼š<strong>é˜Ÿåˆ—æ¨¡å‹</strong>å’Œ<strong>å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹</strong>ã€‚RocketMQ æ˜¯åè€…ã€‚</p><h4 id="è®²ä¸€ä¸‹-RocketMQ-æ¶ˆæ¯çš„å¸¸ç”¨ç±»å‹"><a href="#è®²ä¸€ä¸‹-RocketMQ-æ¶ˆæ¯çš„å¸¸ç”¨ç±»å‹" class="headerlink" title="è®²ä¸€ä¸‹ RocketMQ æ¶ˆæ¯çš„å¸¸ç”¨ç±»å‹"></a>è®²ä¸€ä¸‹ RocketMQ æ¶ˆæ¯çš„å¸¸ç”¨ç±»å‹</h4><ul><li>é¡ºåºæ¶ˆæ¯<ul><li>é¡ºåºæ¶ˆæ¯åªèƒ½ä¿è¯å±€éƒ¨æ¶ˆæ¯æœ‰åºï¼Œä¸èƒ½ä¿è¯å…¨å±€æœ‰åºï¼Œ<ul><li>å®ç°å…¨å±€ æœ‰åº å¯ä»¥ â½£äº§ç«¯å°†â¼€æ‰¹æ¶ˆæ¯æœ‰åºå‘å¾€MessageQueueï¼Œæ¶ˆè´¹ç«¯é€š è¿‡é”é˜Ÿåˆ—çš„â½…å¼ï¼Œæ¯æ¬¡åªæ‹¿â¼€ä¸ªMessageQueueâ¾¥çš„æ¶ˆæ¯</li></ul></li></ul></li><li>å¹¿æ’­æ¶ˆæ¯<ul><li>â¼´æ’­æ¶ˆæ¯å¹¶æ²¡æœ‰ç‰¹å®šçš„æ¶ˆè´¹è€…ï¼Œå› ä¸ºè¿™æ¶‰åŠåˆ°æ¶ˆè´¹è€…çš„é›†ç¾¤æ¶ˆè´¹ æ¨¡å¼ï¼Œé»˜è®¤æ˜¯é›†ç¾¤æ¨¡å¼<ul><li>é›†ç¾¤æ¨¡å¼<ul><li>â¼€ä¸ªæ¶ˆæ¯åªä¼šè¢«â¼€ä¸ªæ¶ˆè´¹ç»„ä¸­çš„â¼€ä¸ªæ¶ˆè´¹è€…å¤„ç†â¼€æ¬¡<ul><li>Brokerç«¯ä¼šç»™æ¯ä¸ªæ¶ˆè´¹è€…ç»„ç»´æŠ¤â¼€ä¸ªç»Ÿâ¼€çš„offsetæ¥ä¿ è¯åŒâ¼€ä¸ªæ¶ˆè´¹ç»„å†…åªä¼šè¢«æ¶ˆè´¹â¼€æ¬¡</li></ul></li></ul></li><li>å¹¿æ’­æ¨¡å¼<ul><li>â¼€ä¸ªæ¶ˆæ¯ä¼šè¢«æ¨é€ç»™æ‰€æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä¸å†å…³â¼¼æ¶ˆè´¹ç»„<ul><li>Brokerç«¯åªç®¡æ¨æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯â¾ƒâ¼°ç»´æŠ¤offset</li></ul></li></ul></li></ul></li></ul></li><li>å»¶è¿Ÿæ¶ˆæ¯<ul><li>é»˜è®¤æä¾›äº†18ä¸ªå»¶è¿Ÿçº§åˆ«ï¼Œå»¶è¿Ÿæ¶ˆæ¯çš„éš¾ç‚¹å…¶å®æ˜¯æ€§èƒ½ï¼Œéœ€è¦ä¸ æ–­è¿›â¾å®šæ—¶è½®è¯¢ï¼Œå…¨éƒ¨æ‰«ææ‰€æœ‰æ¶ˆæ¯æ˜¯ä¸å¯èƒ½çš„</li></ul></li><li>æ‰¹é‡æ¶ˆæ¯<ul><li>åªèƒ½å¯¹åŒâ¼€topicä¸‹çš„æ¶ˆæ¯è¿›â¾æ‰¹é‡å‘é€ï¼Œä¸â½€æŒå»¶è¿Ÿæ¶ˆæ¯ï¼Œä»¥åŠ æ‰¹é‡æ¶ˆæ¯çš„â¼¤â¼©ä¸è¶…è¿‡1MBï¼Œè¶…è¿‡äº†éœ€è¦â¾ƒâ¾æ‹†åˆ†</li></ul></li><li>è¿‡æ»¤æ¶ˆæ¯<ul><li>æ¶ˆè´¹ç«¯å¯ä»¥é€šè¿‡â¼€å®šè§„åˆ™åŒ¹é…topicä¸‹éœ€è¦çš„æ¶ˆæ¯ï¼Œâ½€æŒç®€å•è¿‡æ»¤ ä»¥åŠSQLè¿‡æ»¤ </li><li>æ¶ˆæ¯è¿‡æ»¤åœ¨æ¶ˆè´¹è€…ç«¯å’ŒBrokerç«¯éƒ½å¯ä»¥åšï¼Œæ¶ˆè´¹è€…ç«¯è¿›â¾è¿‡æ»¤å¯ ä»¥ä¿éšœæ¶ˆæ¯è¿‡æ»¤çš„å¯æ§æ€§ï¼Œâ½½Brokerç«¯è¿‡æ»¤å¯ä»¥å‡å°‘ä¸å¿…è¦æ•°æ® çš„â½¹ç»œIO(åªæŠŠæ¶ˆè´¹è€…ç«¯éœ€è¦çš„æ¶ˆæ¯å‘é€å‡ºå»å°±â¾)</li></ul></li><li>äº‹åŠ¡æ¶ˆæ¯<ul><li>é€šè¿‡äº‹åŠ¡æ¶ˆæ¯å¯ä»¥ç¡®ä¿ä¸Šä¸‹æ¸¸çš„æ•°æ®â¼€è‡´æ€§</li><li>å®ç°æ€è·¯<ul><li>â½£äº§è€…ç«¯å°†æ¶ˆæ¯å‘å¾€MQæœåŠ¡ï¼ŒMQæœåŠ¡å°†æ¶ˆæ¯æŒä¹…åŒ–åï¼Œå‘â½£ äº§ç«¯åé¦ˆå·²æ”¶åˆ°ï¼Œæ­¤æ—¶æ¶ˆæ¯ä¸ºåŠæ¶ˆæ¯(åŠäº‹åŠ¡æ¶ˆæ¯çŠ¶æ€)</li><li>â½£äº§ç«¯æ‰§â¾å®Œæœ¬åœ°äº‹åŠ¡åï¼Œä¼šå°†æ‰§â¾ç»“æœå‘MQæœåŠ¡è¿›â¾â¼†æ¬¡ ç¡®è®¤ï¼Œåˆ¤æ–­æ˜¯å¦æäº¤æˆ–å›æ»š<ul><li>å¦‚æœæäº¤ï¼ŒMQæœåŠ¡å°†åŠæ¶ˆæ¯æ ‡è®°ä¸ºå¯æŠ•é€’ï¼Œç„¶åè½¬å‘ç»™æ¶ˆ è´¹ç«¯ </li><li>å¦‚æœå›æ»šï¼ŒMQæœåŠ¡ä¼šå°†åŠæ¶ˆæ¯åˆ é™¤</li></ul></li><li>å¦‚æœMQæœåŠ¡æ²¡æœ‰æ”¶åˆ°â¼†æ¬¡ç¡®è®¤ï¼Œä¼šå¯¹â½£äº§ç«¯è¿›â¾æ¶ˆæ¯å›æŸ¥ï¼Œ æŸ¥çœ‹äº‹åŠ¡æ‰§â¾ç»“æœç»§ç»­è¿›â¾â¼†æ¬¡ç¡®è®¤</li></ul></li></ul></li></ul><h4 id="é¡ºåºæ¶ˆæ¯"><a href="#é¡ºåºæ¶ˆæ¯" class="headerlink" title="é¡ºåºæ¶ˆæ¯"></a>é¡ºåºæ¶ˆæ¯</h4><ul><li>å…¨å±€é¡ºåºï¼šå…¨éƒ¨äº‹ä»¶çš„é¡ºåºå¤„ç†</li><li>åˆ†åŒºé¡ºåºï¼šå•ä¸ªäº‹ä»¶çš„é€»è¾‘é“¾é¡ºåº</li></ul><h4 id="å»¶è¿Ÿæ¶ˆæ¯-å»¶æ—¶é˜Ÿåˆ—ï¼‰"><a href="#å»¶è¿Ÿæ¶ˆæ¯-å»¶æ—¶é˜Ÿåˆ—ï¼‰" class="headerlink" title="å»¶è¿Ÿæ¶ˆæ¯(å»¶æ—¶é˜Ÿåˆ—ï¼‰"></a>å»¶è¿Ÿæ¶ˆæ¯(å»¶æ—¶é˜Ÿåˆ—ï¼‰</h4><p>RocketMQ æä¾›äº†èƒ½å¤Ÿå»¶æ—¶å‘é€çš„è¿™ç§æœºåˆ¶ï¼Œä¼šç»™å®šä¸€ä¸ªèŒƒå›´çš„æ—¶é—´ï¼Œç„¶åå…ˆæš‚å­˜åˆ° SCHEDULE_TOPIC_xxxx çš„ Topic ä¸­ï¼Œæ—¶é—´åˆ°äº†å†å‘é€åˆ°éœ€è¦å‘é€çš„é˜Ÿåˆ—ä¸­ã€‚</p><h4 id="è®²ä¸€ä¸‹ä½¿ç”¨-RocketMQ-å¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#è®²ä¸€ä¸‹ä½¿ç”¨-RocketMQ-å¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="è®²ä¸€ä¸‹ä½¿ç”¨ RocketMQ å¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡"></a>è®²ä¸€ä¸‹ä½¿ç”¨ RocketMQ å¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡</h4><p>å®ç°æ­¥éª¤</p><p>é—®è¿™é“é¢˜ç›®ä¸€èˆ¬æ˜¯è¦å›ç­”ä¸€ä¸‹RocketMQ å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æœºåˆ¶ï¼šäº‹åŠ¡æ¶ˆæ¯åŠ ä¸Šäº‹åŠ¡åæŸ¥æœºåˆ¶ã€‚</p><ul><li>1ã€ç³»ç»Ÿ A ä¼šå‘é€ä¸€æ¡æ¶ˆæ¯åˆ° MQ ç¡®è®¤é€šä¿¡æ²¡é—®é¢˜</li><li>2ã€äº‹åŠ¡æ­£å¸¸æ‰§è¡Œåä¼šå‘é€ä¸€æ¡ commit æ¶ˆæ¯ç»™ MQï¼Œå¦‚æœæ²¡å‘ç¡®è®¤çš„è¯ï¼ŒRocketMQ ä¼šé€šè¿‡äº‹åŠ¡å›æŸ¥æœºåˆ¶ç¡®è®¤äº‹åŠ¡æ˜¯å¦æ­£å¸¸æ‰§è¡Œ</li><li>3ã€åˆ¤æ–­æ­£å¸¸æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå‘é€ç¡®è®¤æ¶ˆæ¯ç»™ç³»ç»ŸBã€‚</li></ul><p>å»ºè®®å¤ä¹ åˆ†å¸ƒå¼äº‹åŠ¡çš„æ—¶å€™ä¹Ÿä¸€èµ·å’Œå…¶ä»–å®ç°æ–¹å¼ä¸€èµ·å¤ä¹ ä¸‹ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307141544.png" alt="image.png"></p><p><strong>äº‹åŠ¡å›æŸ¥æœºåˆ¶</strong></p><p>ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªå®šæ—¶æœºåˆ¶ï¼Œç„¶åå¦‚æœé•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°äºŒæ¬¡ç¡®è®¤ï¼Œä¼šè¿›è¡Œäº‹åŠ¡å›æŸ¥</p><ul><li>è¿™ä¸ªæ˜¯ç”Ÿäº§è€…åè€Œæ˜¯æ¶ˆè´¹è€…ï¼Œæ”¶åˆ°è¿™æ¡æ¶ˆæ¯åï¼Œé€šè¿‡æœ¬åœ°å®ç°çš„ checker æ¥å£çš„ checkLocalTransaction æ–¹æ³•è¿›è¡Œæ£€æŸ¥æœ¬åœ°äº‹åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œå¹¶å°†ç»“æœå‘ŠçŸ¥ MQ æœåŠ¡å™¨ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307155659.png" alt="image.png"></p><h4 id="RocketMQâ½£äº§ç«¯çš„å‘é€æ¨¡å¼"><a href="#RocketMQâ½£äº§ç«¯çš„å‘é€æ¨¡å¼" class="headerlink" title="RocketMQâ½£äº§ç«¯çš„å‘é€æ¨¡å¼"></a>RocketMQâ½£äº§ç«¯çš„å‘é€æ¨¡å¼</h4><ul><li>RocketMQç”Ÿäº§ç«¯æœ‰3ç§å‘é€æ¨¡å¼<ul><li>åŒæ­¥å‘é€<ul><li>å¿…é¡»ç­‰åˆ°Brokeråé¦ˆä¹‹åæ‰èƒ½ç»§ç»­å‘ï¼Œå®‰å…¨æ€§æœ€é«˜ä½†å‘æ¶ˆæ¯æœ€æ…¢</li></ul></li><li>å•å‘å‘é€<ul><li>ä¸ç®¡æ¶ˆæ¯æ˜¯å¦å‘æˆåŠŸéƒ½èƒ½ç»§ç»­å‘ï¼Œæ‰€ä»¥ååé‡æœ€é«˜ï¼Œä½†æ˜¯å®‰å…¨æ€§ä½ï¼Œå®¹æ˜“ä¸¢æ¶ˆæ¯</li></ul></li><li>å¼‚æ­¥å‘é€<ul><li>å‘é€æ¶ˆæ¯çš„åŒæ—¶å›æ³¨å†Œä¸€ä¸ªå›è°ƒå»å¤„ç†å“åº”ï¼Œå®‰å…¨æ€§ä½ï¼Œå®¹æ˜“ä¸¢æ¶ˆæ¯</li></ul></li></ul></li></ul><h4 id="RocketMQæ¶ˆè´¹ç«¯çš„æ¶ˆè´¹æ¨¡å¼"><a href="#RocketMQæ¶ˆè´¹ç«¯çš„æ¶ˆè´¹æ¨¡å¼" class="headerlink" title="RocketMQæ¶ˆè´¹ç«¯çš„æ¶ˆè´¹æ¨¡å¼"></a>RocketMQæ¶ˆè´¹ç«¯çš„æ¶ˆè´¹æ¨¡å¼</h4><ul><li>RocketMQæ¶ˆè´¹æ¨¡å¼â½€æŒ æ¨æ¨¡å¼ å’Œ æ‹‰æ¨¡å¼<ul><li>æ¨æ¨¡å¼æ¨¡å¼ç®€å•æ˜“â½¤ï¼Œæœ‰è¾ƒå¥½çš„å®æ—¶æ€§ï¼Œä½†Brokerå‹â¼’è¾ƒâ¼¤ </li><li>æ‹‰æ¨¡å¼å¯¹äºæ¶ˆè´¹ç«¯å¯ä»¥æ›´å¥½çš„æŠŠæ§ï¼ŒBrokerå‹â¼’è¾ƒâ¼©ï¼Œéœ€è¦â¼¿åŠ¨ æŒ‡å®šoffset</li></ul></li></ul><h3 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h3><h4 id="æ€ä¹ˆä¿è¯é«˜å¯ç”¨-ğŸ-1"><a href="#æ€ä¹ˆä¿è¯é«˜å¯ç”¨-ğŸ-1" class="headerlink" title="æ€ä¹ˆä¿è¯é«˜å¯ç”¨ ğŸ"></a>æ€ä¹ˆä¿è¯é«˜å¯ç”¨ ğŸ</h4><ul><li>1ã€ä¸»ä»ï¼ŒåŒæ­¥å¤åˆ¶ï¼Œå¼‚æ­¥åˆ·ç›˜ï¼Œé›†ç¾¤</li></ul><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é›†ç¾¤æœºæ„ï¼Œå…¶ä¸­ Broker æ˜¯ä¸»ä»ï¼Œé‡‡ç”¨åŒæ­¥å¤åˆ¶æ–¹å¼ï¼ŒåŒæ—¶é‡‡ç”¨å¼‚æ­¥åˆ·ç›˜ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307052103.png" alt="image.png"></p><h4 id="RocketMQçš„ä¸»ä»å¤åˆ¶åŸç†"><a href="#RocketMQçš„ä¸»ä»å¤åˆ¶åŸç†" class="headerlink" title="RocketMQçš„ä¸»ä»å¤åˆ¶åŸç†"></a>RocketMQçš„ä¸»ä»å¤åˆ¶åŸç†</h4><ul><li>åŒæ­¥å¤åˆ¶ <ul><li>masterå’Œslaveçš„æ•°æ®éƒ½å†™â¼ŠæˆåŠŸä¹‹åæ‰è¿›â¾åé¦ˆï¼Œå¦‚æœmasteræ•… éšœï¼Œslaveä»æœ‰æ•°æ®å¤‡ä»½ï¼Œâ½…ä¾¿æ•°æ®æ¢å¤ï¼Œä½†æ˜¯å¯èƒ½å› ä¸ºæ•°æ®å†™â¼Š å»¶è¿Ÿé™ä½äº†ååé‡</li></ul></li><li>å¼‚æ­¥å¤åˆ¶<ul><li>ä¿è¯masterå†™â¼ŠæˆåŠŸå°±è¿›â¾åé¦ˆï¼Œå†é€šè¿‡å¼‚æ­¥åŒæ­¥æ•°æ®åˆ°slaveï¼Œ å¦‚æœmasterå‡ºç°æ•…éšœä¼šå¯¼è‡´slaveâ½†æ³•åŒæ­¥æ•°æ®å¯¼è‡´æ•°æ®ä¸¢å¤±</li></ul></li></ul><h3 id="å­˜å‚¨ï¼Œè¯»å†™"><a href="#å­˜å‚¨ï¼Œè¯»å†™" class="headerlink" title="å­˜å‚¨ï¼Œè¯»å†™"></a>å­˜å‚¨ï¼Œè¯»å†™</h3><h4 id="é«˜æ€§èƒ½"><a href="#é«˜æ€§èƒ½" class="headerlink" title="é«˜æ€§èƒ½"></a>é«˜æ€§èƒ½</h4><p>é«˜æ€§èƒ½ä¸»è¦çš„å‡ ä¸ªç‚¹ï¼š</p><ul><li>1ã€Netty é«˜æ•ˆçš„ NIO æ¡†æ¶</li><li>2ã€RocketMQ å¤§é‡ä½¿ç”¨å¤šçº¿ç¨‹ã€å¼‚æ­¥</li><li>3ã€é‡‡ç”¨é›¶æ‹·è´æŠ€æœ¯ä¼˜åŒ–ï¼ˆMMAPï¼‰  æ€§èƒ½æé«˜50%</li><li>4ã€é‡‡ç”¨æ–‡ä»¶å­˜å‚¨ï¼Œé¡ºåºè¯»å†™</li><li>5ã€é”ä¼˜åŒ–ï¼ˆCAS æœºåˆ¶ï¼Œæ— é”åŒ–ï¼‰</li><li>6ã€å­˜å‚¨è®¾è®¡ï¼šè¯»å†™åˆ†ç¦»</li></ul><h4 id="RocketMQ-çš„å­˜å‚¨æœºåˆ¶-ğŸ’£"><a href="#RocketMQ-çš„å­˜å‚¨æœºåˆ¶-ğŸ’£" class="headerlink" title="RocketMQ çš„å­˜å‚¨æœºåˆ¶  ğŸ’£"></a>RocketMQ çš„å­˜å‚¨æœºåˆ¶  ğŸ’£</h4><p>RocketMQ ä¼šå°†æ‰€æœ‰çš„æ¶ˆæ¯å‘é€æ”¾åˆ° CommitLog çš„ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ŒåŒæ—¶ä¼šæœ‰ä¸€ä¸ªç›‘å¬ï¼Œå°†ç›¸å…³ä¸€ä¸ªè®°å½•ï¼ˆåŒ…æ‹¬ä¸»é¢˜ï¼Œåç§»é‡ï¼Œå¤§å°ç­‰ä¿¡æ¯) æ”¾åˆ° ComsumerQueue ä¸­ï¼ˆCommitLog çš„é€»è¾‘ç´¢å¼•ï¼‰</p><p>è¿™ä¸ªç†è§£æœ‰ç‚¹é—®é¢˜</p><hr><p>æ¶ˆæ¯å­˜å‚¨ç»“æ„ï¼š</p><p>RocketMQä½¿ç”¨CommitLogæ–‡ä»¶æ¥ç»Ÿä¸€å­˜å‚¨æ‰€æœ‰Brokerä¸Šçš„æ¶ˆæ¯ã€‚æ­¤å¤–ï¼Œä¸ºäº†æ”¯æŒå¿«é€Ÿçš„æ¶ˆæ¯æŸ¥è¯¢å’Œæ¶ˆè´¹ï¼Œå®ƒè¿˜ä½¿ç”¨äº†ConsumeQueueå’ŒIndexFileã€‚</p><ul><li><strong>CommitLog</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¤§å‹çš„æ–‡ä»¶ï¼Œæ‰€æœ‰å‘é€åˆ°Brokerçš„æ¶ˆæ¯éƒ½ä¼šè¢«è¿½åŠ åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚å®ƒä¸åŒºåˆ†Topicæˆ–Queueï¼Œæ‰€æœ‰æ¶ˆæ¯æŒ‰ç…§åˆ°è¾¾çš„é¡ºåºä¾æ¬¡å­˜å‚¨ã€‚</li><li><strong>ConsumeQueue</strong>ï¼šä¸ºäº†æé«˜æ¶ˆæ¯æ¶ˆè´¹çš„æ•ˆç‡ï¼ŒRocketMQä¸ºæ¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆQueueï¼‰åˆ›å»ºäº†ä¸€ä¸ªConsumeQueueæ–‡ä»¶ã€‚ConsumeQueueæ˜¯CommitLogçš„é€»è¾‘ç´¢å¼•ï¼ŒåŒ…å«äº†æŒ‡å‘CommitLogä¸­æ¶ˆæ¯çš„æŒ‡é’ˆï¼Œä»¥åŠä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚æ¶ˆæ¯å¤§å°ã€æ¶ˆæ¯ä½ç½®ç­‰ã€‚</li><li><strong>IndexFile</strong>ï¼šRocketMQæä¾›äº†ä¸€ç§ç´¢å¼•æœºåˆ¶ï¼Œé€šè¿‡IndexFileæ¥æ”¯æŒæ ¹æ®æ¶ˆæ¯çš„Keyæˆ–æ—¶é—´æ¥æŸ¥è¯¢æ¶ˆæ¯ã€‚è¿™ä½¿å¾—æ ¹æ®æ¶ˆæ¯å±æ€§è¿›è¡Œé«˜æ•ˆæŸ¥è¯¢æˆä¸ºå¯èƒ½ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307052424.png" alt="image.png"></p><ul><li>1ã€ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</li><li>2ã€å‘é€çš„æ¶ˆæ¯ä¼šé¡ºåºè®°å½•åˆ° Commit Log ä¸­</li><li>3ã€RocketMQ ä¼š é€šè¿‡ ReputMessageService ThreadLoop è¿›è¡Œç›‘å¬ï¼Œå¹¶å°†ä¸»é¢˜ç­‰ä¿¡æ¯ï¼ˆcommit log offsetã€sizeã€hashcode of tag ï¼‰é€šè¿‡å“ˆå¸Œè®°å½•åˆ° Comsume Queue æ–‡ä»¶ï¼ˆé»˜è®¤æ˜¯æœ‰ 4 ä¸ªæ–‡ä»¶ï¼‰</li><li>4ã€é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥å¾ˆå¥½å¤„ç†å¤šä¸»é¢˜çš„æƒ…å†µï¼ˆåªæœ‰ä¸€ä¸ªå†™å…¥æ–‡ä»¶ Commit Logï¼‰</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307054839.png" alt="image.png"></p><p>è¿™ä¸ªè§£é‡Šä¹Ÿå¯ä»¥å‚è€ƒä¸€ä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307055349.png" alt="image.png"></p><h4 id="RocketMQçš„è¿‡æœŸâ½‚ä»¶åˆ é™¤æœºåˆ¶"><a href="#RocketMQçš„è¿‡æœŸâ½‚ä»¶åˆ é™¤æœºåˆ¶" class="headerlink" title="RocketMQçš„è¿‡æœŸâ½‚ä»¶åˆ é™¤æœºåˆ¶"></a>RocketMQçš„è¿‡æœŸâ½‚ä»¶åˆ é™¤æœºåˆ¶</h4><h4 id="è®²ä¸€ä¸‹æ¶ˆæ¯åˆ·ç›˜"><a href="#è®²ä¸€ä¸‹æ¶ˆæ¯åˆ·ç›˜" class="headerlink" title="è®²ä¸€ä¸‹æ¶ˆæ¯åˆ·ç›˜"></a>è®²ä¸€ä¸‹æ¶ˆæ¯åˆ·ç›˜</h4><ul><li>åŒæ­¥åˆ·ç›˜</li><li>å¼‚æ­¥åˆ·ç›˜<ul><li>ä¸€èˆ¬ä¼šé‡‡ç”¨å¼‚æ­¥åˆ·ç›˜ + åŒæ­¥å¤åˆ¶çš„æ–¹å¼</li><li>åˆ·ç›˜æ˜¯æŒ‡ä»å†…å­˜åˆ°ç£ç›˜ï¼Œå ç”¨çš„IOæ˜¯æ¯”è¾ƒå¤§çš„ï¼Œè€ŒåŒæ­¥å¤åˆ¶æ˜¯å†…å­˜åˆ°å†…å­˜ï¼Œå› æ­¤è€—æ—¶ä¼šæ¯”è¾ƒå°‘</li></ul></li></ul><h4 id="é›¶æ‹·è´-ğŸš©"><a href="#é›¶æ‹·è´-ğŸš©" class="headerlink" title="é›¶æ‹·è´  ğŸš©"></a>é›¶æ‹·è´  ğŸš©</h4><p>é€šè¿‡äº†é›¶æ‹·è´æŠ€æœ¯æé«˜äº†â½‚ä»¶ä¼ è¾“é€Ÿåº¦ï¼Œå®ç°æ–¹å¼æ˜¯ mmap</p><ul><li>mmap å°±æ˜¯é€šè¿‡â½‚ä»¶ä½ç½®ä¸è¿›ç¨‹åœ°å€ç©ºé—´å»ºâ½´æ˜ å°„å…³ç³»ï¼Œç¨‹åºå¯ ä»¥ç›´æ¥è®¿é—®â½‚ä»¶å†…å®¹</li><li>è¿™ç§æœºåˆ¶åœ¨Javaä¸­æ˜¯é€šè¿‡MappedByteBufferå®ç°çš„</li></ul><hr><p>ä¼ ç»Ÿæ–¹å¼ï¼š</p><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼ï¼Œæ•°æ®éœ€è¦ç»å†å‡ æ¬¡æ‹·è´ï¼Œè¿˜è¦ç»å†ç”¨æˆ·æ€&#x2F;å†…æ ¸æ€åˆ‡æ¢</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308184631.png" alt="image.png"></p><ol><li>ä»ç£ç›˜å¤åˆ¶æ•°æ®åˆ°å†…æ ¸æ€å†…å­˜ï¼›</li><li>ä»å†…æ ¸æ€å†…å­˜å¤åˆ¶åˆ°ç”¨æˆ·æ€å†…å­˜ï¼›</li><li>ç„¶åä»ç”¨æˆ·æ€å†…å­˜å¤åˆ¶åˆ°ç½‘ç»œé©±åŠ¨çš„å†…æ ¸æ€å†…å­˜ï¼›</li><li>æœ€åæ˜¯ä»ç½‘ç»œé©±åŠ¨çš„å†…æ ¸æ€å†…å­˜å¤åˆ¶åˆ°ç½‘å¡ä¸­è¿›è¡Œä¼ è¾“</li></ol><p>é›¶æ‹·è´æ–¹å¼ï¼š</p><p>å¯ä»¥é€šè¿‡é›¶æ‹·è´çš„æ–¹å¼ï¼Œ<strong>å‡å°‘ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>å’Œ<strong>å†…å­˜æ‹·è´çš„æ¬¡æ•°</strong>ï¼Œç”¨æ¥æå‡I&#x2F;Oçš„æ€§èƒ½ã€‚é›¶æ‹·è´æ¯”è¾ƒå¸¸è§çš„å®ç°æ–¹å¼æ˜¯<strong>mmap</strong>ï¼Œè¿™ç§æœºåˆ¶åœ¨Javaä¸­æ˜¯é€šè¿‡MappedByteBufferå®ç°çš„ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308190931.png" alt="image.png"></p><p>é›¶æ‹·è´çš„å¥½å¤„ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308185040.png" alt="image.png"></p><p>çœ‹ä¸€ä¸‹è¿™ä¸ªå¯¹æ¯”ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308190654.png" alt="image.png"></p><p>æ‰©å±•ï¼š</p><p>RocketMQä¸»è¦é€šè¿‡MappedByteBufferå¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚</p><p>å…¶ä¸­ï¼Œåˆ©ç”¨äº†NIOä¸­çš„FileChannelæ¨¡å‹å°†ç£ç›˜ä¸Šçš„ç‰©ç†æ–‡ä»¶ç›´æ¥æ˜ å°„åˆ°ç”¨æˆ·æ€çš„å†…å­˜åœ°å€ä¸­ï¼ˆè¿™ç§Mmapçš„æ–¹å¼å‡å°‘äº†ä¼ ç»ŸIOï¼Œå°†ç£ç›˜æ–‡ä»¶æ•°æ®åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸åœ°å€ç©ºé—´çš„ç¼“å†²åŒºï¼Œå’Œç”¨æˆ·åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´çš„ç¼“å†²åŒºä¹‹é—´æ¥å›è¿›è¡Œæ‹·è´çš„æ€§èƒ½å¼€é”€ï¼‰ï¼Œå°†å¯¹æ–‡ä»¶çš„æ“ä½œè½¬åŒ–ä¸ºç›´æ¥å¯¹å†…å­˜åœ°å€è¿›è¡Œæ“ä½œï¼Œä»è€Œæå¤§åœ°æé«˜äº†æ–‡ä»¶çš„è¯»å†™æ•ˆç‡ï¼ˆæ­£å› ä¸ºéœ€è¦ä½¿ç”¨å†…å­˜æ˜ å°„æœºåˆ¶ï¼Œæ•…RocketMQçš„æ–‡ä»¶å­˜å‚¨éƒ½ä½¿ç”¨å®šé•¿ç»“æ„æ¥å­˜å‚¨ï¼Œæ–¹ä¾¿ä¸€æ¬¡å°†æ•´ä¸ªæ–‡ä»¶æ˜ å°„è‡³å†…å­˜ï¼‰</p><hr><p>é›¶æ‹·è´Zero-CopyæŠ€æœ¯</p><p>å‚è€ƒï¼š <a href="https://github.com/0voice/linux_kernel_wiki/blob/main/%E6%96%87%E7%AB%A0/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/%E4%B8%80%E6%96%87%E5%B8%A6%E4%BD%A0%EF%BC%8C%E5%BD%BB%E5%BA%95%E4%BA%86%E8%A7%A3%EF%BC%8C%E9%9B%B6%E6%8B%B7%E8%B4%9DZero-Copy%E6%8A%80%E6%9C%AF.md">https://github.com/0voice/linux_kernel_wiki/blob/main/%E6%96%87%E7%AB%A0/%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/%E4%B8%80%E6%96%87%E5%B8%A6%E4%BD%A0%EF%BC%8C%E5%BD%BB%E5%BA%95%E4%BA%86%E8%A7%A3%EF%BC%8C%E9%9B%B6%E6%8B%B7%E8%B4%9DZero-Copy%E6%8A%80%E6%9C%AF.md</a></p><p>å¦‚æœåº”ç”¨ç¨‹åºä¸å¯¹æ•°æ®åšä¿®æ”¹ï¼Œä»å†…æ ¸ç¼“å†²åŒºåˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œå†ä»ç”¨æˆ·ç¼“å†²åŒºåˆ°å†…æ ¸ç¼“å†²åŒºã€‚ä¸¤æ¬¡æ•°æ®æ‹·è´éƒ½éœ€è¦CPUçš„å‚ä¸ï¼Œå¹¶ä¸”æ¶‰åŠç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„å¤šæ¬¡åˆ‡æ¢ï¼ŒåŠ é‡äº†CPUè´Ÿæ‹…ã€‚ éœ€è¦é™ä½å†—ä½™æ•°æ®æ‹·è´ã€è§£æ”¾CPUï¼Œè¿™ä¹Ÿå°±æ˜¯é›¶æ‹·è´Zero-CopyæŠ€æœ¯</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240529215235.png" alt="image.png"></p><p>mmap æ–¹å¼</p><p>mmapæ˜¯Linuxæä¾›çš„ä¸€ç§å†…å­˜æ˜ å°„æ–‡ä»¶çš„æœºåˆ¶ï¼Œå®ƒå®ç°äº†å°†å†…æ ¸ä¸­è¯»ç¼“å†²åŒºåœ°å€ä¸ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºåœ°å€è¿›è¡Œæ˜ å°„ï¼Œä»è€Œå®ç°å†…æ ¸ç¼“å†²åŒºä¸ç”¨æˆ·ç¼“å†²åŒºçš„å…±äº«ã€‚</p><p>è¿™æ ·å°±å‡å°‘äº†ä¸€æ¬¡ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„CPUæ‹·è´ï¼Œä½†æ˜¯åœ¨å†…æ ¸ç©ºé—´å†…ä»ç„¶æœ‰ä¸€æ¬¡CPUæ‹·è´ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240529215347.png" alt="image.png"></p><p>mmapå¯¹å¤§æ–‡ä»¶ä¼ è¾“æœ‰ä¸€å®šä¼˜åŠ¿ï¼Œä½†æ˜¯å°æ–‡ä»¶å¯èƒ½å‡ºç°ç¢ç‰‡ï¼Œå¹¶ä¸”åœ¨å¤šä¸ªè¿›ç¨‹åŒæ—¶æ“ä½œæ–‡ä»¶æ—¶å¯èƒ½äº§ç”Ÿå¼•å‘coredumpçš„signalã€‚</p><h3 id="ç”Ÿäº§é—®é¢˜-1"><a href="#ç”Ÿäº§é—®é¢˜-1" class="headerlink" title="ç”Ÿäº§é—®é¢˜"></a>ç”Ÿäº§é—®é¢˜</h3><h4 id="æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜æ€ä¹ˆè§£å†³-1"><a href="#æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜æ€ä¹ˆè§£å†³-1" class="headerlink" title="æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜æ€ä¹ˆè§£å†³"></a>æ¶ˆæ¯é‡å¤æ¶ˆè´¹é—®é¢˜æ€ä¹ˆè§£å†³</h4><h4 id="æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“"><a href="#æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“" class="headerlink" title="æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“"></a>æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„å¯é æ€§ä¼ è¾“</h4><p>æ¶ˆæ¯é˜Ÿåˆ—å¦‚ä½•ä¿è¯æ¶ˆæ¯å¯é ä¼ è¾“</p><ul><li>æ¶ˆæ¯å¯é ä¼ è¾“ä»£è¡¨äº†ä¸¤å±‚æ„æ€ï¼Œæ—¢ä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ã€‚</li><li>1,ä¸ºäº†ä¿è¯æ¶ˆæ¯ä¸å¤šï¼Œä¹Ÿå°±æ˜¯æ¶ˆæ¯ä¸èƒ½é‡å¤ï¼Œä¹Ÿå°±æ˜¯ç”Ÿäº§è€…ä¸èƒ½é‡å¤ç”Ÿäº§æ¶ˆæ¯ï¼Œæˆ–è€…æ¶ˆè´¹è€…ä¸èƒ½é‡å¤æ¶ˆè´¹æ¶ˆæ¯</li><li>2,é¦–å…ˆè¦ç¡®ä¿æ¶ˆæ¯ä¸å¤šå‘ï¼Œè¿™ä¸ªä¸å¸¸å‡ºç°ï¼Œä¹Ÿæ¯”è¾ƒéš¾æ§åˆ¶ï¼Œå› ä¸ºå¦‚æœå‡ºç°äº†å¤šå‘ï¼Œå¾ˆå¤§çš„åŸå› æ˜¯ç”Ÿäº§è€…è‡ªå·±çš„åŸå› ï¼Œå¦‚æœè¦é¿å…å‡ºç°é—®é¢˜ï¼Œå°±éœ€è¦åœ¨æ¶ˆè´¹ç«¯åšæ§åˆ¶</li><li>3.,è¦é¿å…ä¸é‡å¤æ¶ˆè´¹ï¼Œæœ€ä¿é™©çš„æœºåˆ¶å°±æ˜¯æ¶ˆè´¹è€…å®ç°å¹‚ç­‰æ€§ï¼Œä¿è¯å°±ç®—é‡å¤æ¶ˆè´¹ï¼Œä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œé€šè¿‡å¹‚ç­‰æ€§ï¼Œä¹Ÿèƒ½è§£å†³ç”Ÿäº§è€…é‡å¤å‘é€æ¶ˆæ¯çš„é—®é¢˜</li><li>4,æ¶ˆæ¯ä¸èƒ½å°‘ï¼Œæ„æ€å°±æ˜¯æ¶ˆæ¯ä¸èƒ½ä¸¢å¤±ï¼Œç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä¸€å®šè¦èƒ½æ¶ˆè´¹åˆ°ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå°±è¦è€ƒè™‘ä¸¤ä¸ªæ–¹é¢</li><li>5,ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶ï¼Œè¦ç¡®è®¤brokertç¡®å®æ”¶åˆ°å¹¶æŒä¹…åŒ–äº†è¿™æ¡æ¶ˆæ¯ï¼Œæ¯”å¦‚RabbitMQçš„confirmiæœºåˆ¶ï¼ŒKafkaçš„ackæœºåˆ¶éƒ½å¯ä»¥ä¿è¯ç”Ÿäº§è€…èƒ½æ­£ç¡®çš„å°†æ¶ˆæ¯å‘é€ç»™broker</li><li>6.broke è¦ç­‰å¾…æ¶ˆè´¹è€…çœŸæ­£ç¡®è®¤æ¶ˆè´¹åˆ°äº†æ¶ˆæ¯æ—¶æ‰åˆ é™¤æ‰æ¶ˆæ¯ï¼Œè¿™é‡Œé€šå¸¸å°±æ˜¯æ¶ˆè´¹ç«¯ackæœºåˆ¶ï¼Œæ¶ˆè´¹è€…æ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯åï¼Œå¦‚æœç¡®è®¤æ²¡é—®é¢˜äº†ï¼Œå°±å¯ä»¥ç»™brokerå‘é€ä¸€ä¸ªack,brokeræ¥æ”¶åˆ°ackåæ‰ä¼šåˆ é™¤æ¶ˆæ¯</li></ul><h4 id="æ¶ˆæ¯å †ç§¯é—®é¢˜æ€ä¹ˆè§£å†³-1"><a href="#æ¶ˆæ¯å †ç§¯é—®é¢˜æ€ä¹ˆè§£å†³-1" class="headerlink" title="æ¶ˆæ¯å †ç§¯é—®é¢˜æ€ä¹ˆè§£å†³"></a>æ¶ˆæ¯å †ç§¯é—®é¢˜æ€ä¹ˆè§£å†³</h4><p>å‚è€ƒï¼š <a href="https://www.bilibili.com/video/BV1ua4y1N7P2/?p=21&spm_id_from=pageDriver&vd_source=6a019ecccfe7d8f62b9a3fe99c723bd0">https://www.bilibili.com/video/BV1ua4y1N7P2/?p=21&amp;spm_id_from=pageDriver&amp;vd_source=6a019ecccfe7d8f62b9a3fe99c723bd0</a></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307135759.png" alt="image.png"></p><p>ä¸€èˆ¬æ˜¯é‡‡ç”¨å¢åŠ æ¶ˆè´¹è€…å®ä¾‹çš„æ–¹å¼</p><p>ä¸ªäººç†è§£ï¼šå¦‚æœæ˜¯åº”å¯¹ç”Ÿäº§å¿«çš„ï¼Œä¸€æ–¹é¢æ˜¯éœ€è¦éœ€è¦è¿™ä¸ªé˜Ÿåˆ—æ•°é‡å’Œæ¶ˆè´¹è€…æ•°é‡ï¼Œç„¶ååº”å¯¹å †ç§¯çš„æƒ…å†µï¼Œå°±è¦åŠ ä¸€ä¸ªä¸­è½¬çš„ï¼ŒæŠŠè¿™ä¸ªå †ç§¯çš„æ¶ˆæ¯åˆ†æ•£åˆ°å¤šä¸ªQueuï¼Œç„¶åå¤šä¸ªComsumeræ¶ˆè´¹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307135814.png" alt="image.png"></p><h4 id="NameServeræŒ‚äº†å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"><a href="#NameServeræŒ‚äº†å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±" class="headerlink" title="NameServeræŒ‚äº†å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"></a>NameServeræŒ‚äº†å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</h4><h2 id="Kafak"><a href="#Kafak" class="headerlink" title="Kafak"></a>Kafak</h2>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_Redis</title>
    <link href="/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_Redis/"/>
    <url>/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_Redis/</url>
    
    <content type="html"><![CDATA[<p>å¸¸è§é¢è¯•é¢˜ï¼š</p><ul><li>Redis çš„æ•°æ®ç±»å‹</li><li>è°ˆä¸€ä¸‹å¸ƒéš†è¿‡æ»¤å™¨</li><li>Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</li><li>Redis ä¸ºä»€ä¹ˆè¦å¼•å…¥å¤šçº¿ç¨‹</li><li>ä»€ä¹ˆæ˜¯ IO å¤šè·¯å¤ç”¨</li><li>è®²ä¸€ä¸‹ Redis çš„ Reactor æ¨¡å‹</li><li>Redis å¦‚ä½•è·å–æ‰€æœ‰ key</li><li>è®²ä¸€ä¸‹ Redis æŒä¹…åŒ–</li><li>Redis æ€ä¹ˆå®ç°é«˜å¯ç”¨çš„</li><li>Redisiä¸»ä»å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰åŸç†</li><li>å“¨å…µé€‰ä¸»è¿‡ç¨‹</li><li>Redis Clusterä¸»ä»é€‰ä¸¾è¿‡ç¨‹</li><li>ä¸»ä»é€‰ä¸¾çš„è„‘è£‚é—®é¢˜</li><li>ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€</li><li>çƒ­ç‚¹ç¼“å­˜å¹¶å‘é‡å»º</li><li>æ•°æ®åº“å’Œç¼“å­˜åŒå†™ä¸ä¸€è‡´</li><li>Redisåˆ†å¸ƒå¼é”å®ç°</li><li>è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥</li><li>å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›</li></ul><h4 id="Redis-åœ¨ä½ é¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä½¿ç”¨çš„"><a href="#Redis-åœ¨ä½ é¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä½¿ç”¨çš„" class="headerlink" title="Redis åœ¨ä½ é¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä½¿ç”¨çš„"></a>Redis åœ¨ä½ é¡¹ç›®ä¸­æ˜¯æ€ä¹ˆä½¿ç”¨çš„</h4><p>è®²ä¸€ä¸‹ Redis çš„ç”¨æ³•</p><p>ç¼“å†²ã€åˆ†å¸ƒå¼é”</p><p>ç¼“å†²  â†’  Jwt </p><h4 id="å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥"><a href="#å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥" class="headerlink" title="å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥"></a>å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥</h4><p>ç¼“å­˜å¸¸ç”¨çš„ä¸‰ç§è¯»å†™ç­–ç•¥ï¼šCache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰ã€Read&#x2F;Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰ã€Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰</p><h4 id="è®²ä¸€ä¸‹-Redis-äº‹åŠ¡"><a href="#è®²ä¸€ä¸‹-Redis-äº‹åŠ¡" class="headerlink" title="è®²ä¸€ä¸‹ Redis äº‹åŠ¡"></a>è®²ä¸€ä¸‹ Redis äº‹åŠ¡</h4><p>ä¸æ˜¯å¾ˆæ¨èä½¿ç”¨Redisäº‹åŠ¡ï¼Œè·Ÿæˆ‘ä»¬å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“äº‹åŠ¡ä¸åŒï¼š</p><ul><li>1ã€Redis äº‹åŠ¡æ˜¯ä¸æ”¯æŒå›æ»šï¼ˆroll backï¼‰æ“ä½œçš„ï¼ŒRedis äº‹åŠ¡ä¸æ»¡è¶³åŸå­æ€§ã€‚</li><li>2ã€Redis äº‹åŠ¡çš„æŒä¹…æ€§æ˜¯æ²¡åŠæ³•ä¿è¯çš„</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402261559889.png" alt="image.png"></p><blockquote><p>Lua è„šæœ¬</p></blockquote><p>ä¸äº‹åŠ¡ç›¸å¯¹çš„è¯ï¼Œæ›´æ¨èä½¿ç”¨ Lua è„šæœ¬æ‰§è¡Œæ‰¹é‡ä»»åŠ¡ï¼›</p><ul><li>ä¸€æ®µ Lua è„šæœ¬å¯ä»¥è§†ä½œä¸€æ¡å‘½ä»¤æ‰§è¡Œï¼Œä¸€æ®µ Lua è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šæœ‰å…¶ä»–è„šæœ¬æˆ– Redis å‘½ä»¤åŒæ—¶æ‰§è¡Œï¼Œä¿è¯äº†æ“ä½œä¸ä¼šè¢«å…¶ä»–æŒ‡ä»¤æ’å…¥æˆ–æ‰“æ‰°ã€‚</li></ul><p>ä¸è¿‡ï¼Œå¦‚æœ Lua è„šæœ¬è¿è¡Œæ—¶å‡ºé”™å¹¶ä¸­é€”ç»“æŸï¼Œå‡ºé”™ä¹‹åçš„å‘½ä»¤æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚å¹¶ä¸”ï¼Œå‡ºé”™ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤æ˜¯æ— æ³•è¢«æ’¤é”€çš„ï¼Œæ— æ³•å®ç°ç±»ä¼¼å…³ç³»å‹æ•°æ®åº“æ‰§è¡Œå¤±è´¥å¯ä»¥å›æ»šçš„é‚£ç§åŸå­æ€§æ•ˆæœã€‚å› æ­¤ï¼Œ <strong>ä¸¥æ ¼æ¥è¯´çš„è¯ï¼Œé€šè¿‡ Lua è„šæœ¬æ¥æ‰¹é‡æ‰§è¡Œ Redis å‘½ä»¤å®é™…ä¹Ÿæ˜¯ä¸å®Œå…¨æ»¡è¶³åŸå­æ€§çš„ã€‚</strong></p><hr><p>Redisçš„Luaè„šæœ¬åŠŸèƒ½æ˜¯å…¶å¼ºå¤§ç‰¹æ€§ä¹‹ä¸€ï¼Œæä¾›äº†åœ¨RedisæœåŠ¡å™¨ç«¯æ‰§è¡Œè„šæœ¬çš„èƒ½åŠ›ã€‚è¿™å…è®¸æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œï¼Œè¿™äº›æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“åŸå­åœ°æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç”±å®¢æˆ·ç«¯é€ä¸€å‘é€å‘½ä»¤ç„¶åç”±æœåŠ¡å™¨é€ä¸€æ‰§è¡Œã€‚</p><p>Luaæ˜¯ä¸€ç§è½»é‡çº§çš„ç¼–ç¨‹è¯­è¨€ï¼Œè¢«åµŒå…¥åˆ°Redisä¸­ç”¨äºæ‰§è¡Œå¤æ‚çš„é€»è¾‘ï¼Œè¿™åœ¨å¤šä¸ªå‘½ä»¤éœ€è¦ä½œä¸ºå•ä¸ªåŸå­æ“ä½œæ‰§è¡Œæ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><blockquote><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p></blockquote><p>å‡è®¾æˆ‘ä»¬éœ€è¦æ›´æ–°ä¸€ä¸ªè®¡æ•°å™¨ï¼Œä½†åªæœ‰åœ¨å¦ä¸€ä¸ªé”®å­˜åœ¨æ—¶æ‰è¿›è¡Œæ›´æ–°ã€‚ä¸ä½¿ç”¨Luaè„šæœ¬ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å…ˆæ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨ï¼Œç„¶åå†æ›´æ–°è®¡æ•°å™¨ï¼Œè¿™ä¸¤æ­¥æ“ä½œä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</p><p>ä½¿ç”¨Luaè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">if</span> redis.<span class="hljs-keyword">call</span>(&quot;EXISTS&quot;, KEYS[<span class="hljs-number">1</span>]) == <span class="hljs-number">1</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">return</span> redis.<span class="hljs-keyword">call</span>(&quot;INCR&quot;, KEYS[<span class="hljs-number">2</span>])<br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><ul><li>è¿™ä¸ªè„šæœ¬æ¥å—ä¸¤ä¸ªé”®ä½œä¸ºè¾“å…¥ï¼š<code>KEYS[1]</code>ç”¨äºæ£€æŸ¥å­˜åœ¨æ€§ï¼Œ<code>KEYS[2]</code>æ˜¯éœ€è¦å¢åŠ çš„è®¡æ•°å™¨ã€‚å¦‚æœ<code>KEYS[1]</code>å­˜åœ¨ï¼Œè„šæœ¬å°†å¢åŠ <code>KEYS[2]</code>çš„å€¼å¹¶è¿”å›æ–°å€¼ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›0ã€‚</li></ul><p>æ‰§è¡Œè„šæœ¬æ“ä½œ(ä½¿ç”¨<code>EVAL</code>å‘½ä»¤æ‰§è¡ŒLuaè„šæœ¬)ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">EVAL <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">numkeys</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span> [<span class="hljs-tag">&lt;<span class="hljs-name">key2</span>&gt;</span> ...] [<span class="hljs-tag">&lt;<span class="hljs-name">arg</span>&gt;</span> [<span class="hljs-tag">&lt;<span class="hljs-name">arg2</span>&gt;</span> ...]]</span></span><br></code></pre></td></tr></table></figure><ul><li><code>&lt;script&gt;</code>ï¼šLuaè„šæœ¬æ–‡æœ¬ã€‚</li><li><code>&lt;numkeys&gt;</code>ï¼šè„šæœ¬ä¸­å°†è¦å¤„ç†çš„é”®çš„æ•°é‡ã€‚</li><li><code>&lt;key&gt;</code>ï¼šè„šæœ¬ä¸­ç”¨åˆ°çš„Redisé”®ã€‚</li><li><code>&lt;arg&gt;</code>ï¼šä¼ é€’ç»™è„šæœ¬çš„å…¶ä»–å‚æ•°ã€‚</li></ul><h4 id="Redis-çš„å¸¸ç”¨å‘½ä»¤"><a href="#Redis-çš„å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Redis çš„å¸¸ç”¨å‘½ä»¤"></a>Redis çš„å¸¸ç”¨å‘½ä»¤</h4><h4 id="é…ç½®é¡¹"><a href="#é…ç½®é¡¹" class="headerlink" title="é…ç½®é¡¹"></a>é…ç½®é¡¹</h4><ul><li><strong><code>maxmemory</code></strong>: è®¾ç½® Redis ä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡ã€‚</li><li><strong><code>maxmemory-policy</code></strong>: å®šä¹‰å½“å†…å­˜è¾¾åˆ°ä¸Šé™æ—¶ Redis çš„è¡Œä¸ºç­–ç•¥ï¼ˆæ·˜æ±°ç­–ç•¥ï¼‰</li><li><strong><code>appendonly</code></strong>: æ˜¯å¦å¯ç”¨ AOFï¼ˆAppend Only Fileï¼‰æŒä¹…åŒ–ã€‚</li><li><strong><code>appendfsync</code></strong>: è®¾ç½® AOF æŒä¹…åŒ–çš„åŒæ­¥ç­–ç•¥ã€‚</li><li><strong><code>save</code></strong>: è®¾ç½® RDB å¿«ç…§çš„è§¦å‘æ¡ä»¶ï¼Œæ ¼å¼ä¸º <code>seconds_to_elapsed changes_to_record</code>ã€‚</li><li><strong><code>cluster-enabled</code></strong>: æ˜¯å¦å¯ç”¨ Redis é›†ç¾¤æ¨¡å¼ã€‚</li></ul><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><h4 id="Redis-å¸¸è§çš„æ•°æ®ç»“æ„"><a href="#Redis-å¸¸è§çš„æ•°æ®ç»“æ„" class="headerlink" title="Redis å¸¸è§çš„æ•°æ®ç»“æ„"></a>Redis å¸¸è§çš„æ•°æ®ç»“æ„</h4><ul><li>String<ul><li>string ä¸»è¦æ˜¯â½¤æ¥å­˜å‚¨å­—ç¬¦ä¸²ï¼Œåº•å±‚æ˜¯åŸºäº åŠ¨æ€å­—ç¬¦ä¸²sds å® ç°çš„ï¼Œsds é€šè¿‡åŠ¨æ€è°ƒæ•´â»“åº¦æ¥èŠ‚çœå†…å­˜</li><li>åº”â½¤åœºæ™¯ <ul><li>åˆ†å¸ƒå¼session </li><li>åˆ†å¸ƒå¼é”</li></ul></li><li>å¸¸ç”¨æŒ‡ä»¤ï¼š<ul><li>setã€getã€setnxã€setex ..</li></ul></li></ul></li><li>hash<ul><li>hash ç±»ä¼¼äº Mapï¼Œåº•å±‚é‡‡â½¤ä¸¤ç§â½…å¼æ¥å®ç°ï¼Œå½“æ•°æ®é‡è¾ƒå°‘ å¹¶ä¸”å…ƒç´ å â½¤å†…å­˜å°‘(â¼©æ•´æ•°æˆ–çŸ­å­—ç¬¦ä¸²)æ—¶ï¼Œé‡‡â½¤ ziplist(å‹ç¼© åˆ—è¡¨)ï¼Œåä¹‹é‡‡â½¤ hashtable(å“ˆå¸Œè¡¨)ï¼Œä¸¤ç§â½…å¼éƒ½æ˜¯ä¸ºäº†èŠ‚çœ å†…å­˜<ul><li>ziplist æ˜¯â¼€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œé€šè¿‡ç´§å‡‘çš„å­˜å‚¨æ¥èŠ‚çœç©º é—´</li><li>hashtable æ˜¯åŸºäºdict(å­—å…¸)å®ç°ï¼Œé‡‡â½¤æ‹‰é“¾æ³•è§£å†³hashå†² çª</li></ul></li><li>åº”ç”¨åœºæ™¯<ul><li>å®ç°è´­ç‰©â»‹</li></ul></li><li>å¸¸ç”¨æŒ‡ä»¤<ul><li>hsetã€hgetã€hgetallã€hdelã€hincrby ..</li></ul></li></ul></li><li>list<ul><li>list æ˜¯â¼€ä¸ªæœ‰åºå¯é‡å¤é›†åˆï¼Œåº•å±‚é‡‡â½¤ä¸¤ç§â½…å¼å®ç°ï¼Œå½“æ•°æ® é‡è¾ƒå°‘å¹¶ä¸”å…ƒç´ å â½¤å†…å­˜å°‘(â¼©æ•´æ•°æˆ–çŸ­å­—ç¬¦ä¸²)æ—¶ï¼Œé‡‡â½¤ ziplist(å‹ç¼©åˆ—è¡¨)ï¼Œåä¹‹é‡‡â½¤ quicklist(å¿«é€Ÿåˆ—è¡¨)ï¼Œä¸¤ç§â½…å¼éƒ½ æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜<ul><li>ziplist æ˜¯â¼€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œé€šè¿‡ç´§å‡‘çš„å­˜å‚¨æ¥èŠ‚çœç©º é—´</li><li>quicklist æ˜¯åŸºäº ziplist å’Œ åŒå‘é“¾è¡¨ å®ç°çš„ï¼Œå¯ä»¥åœ¨èŠ‚çœç©º é—´çš„åŒæ—¶ä¿è¯â¾¼æ•ˆå¢åˆ </li></ul></li><li>åº”ç”¨åœºæ™¯<ul><li>æ ˆ(lpush + lpop) </li><li>é˜Ÿåˆ—(lpush + rpop) </li><li>é˜»å¡é˜Ÿåˆ—(lpush + brpop) </li><li>å‘å¸ƒè®¢é˜…</li></ul></li><li>å¸¸ç”¨æŒ‡ä»¤<ul><li>lpushã€lpopã€rpushã€rpopã€blpopã€brpopã€lrange ..</li></ul></li></ul></li><li>set<ul><li>set æ˜¯â¼€ä¸ªâ½†åºä¸å¯é‡å¤é›†åˆï¼Œåº•å±‚é‡‡â½¤ä¸¤ç§â½…å¼å®ç°ï¼Œå½“æ•° æ®é‡è¾ƒå°‘ä¸”å…ƒç´ ä¸ºæ•´æ•°æ—¶ï¼Œé‡‡â½¤ intset(æ•´æ•°é›†åˆ)ï¼Œåä¹‹é‡‡â½¤ hashtable(å“ˆå¸Œè¡¨)ï¼Œä¸¤ç§â½…å¼éƒ½æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜<ul><li>intset æ˜¯â¼€ä¸ªæœ‰åºçš„æ•´æ•°æ•°ç»„ï¼Œé€šè¿‡ç´§å‡‘çš„å­˜å‚¨æ¥èŠ‚çœç©º é—´</li><li>hashtable æ˜¯åŸºäºdict(å­—å…¸)å®ç°ï¼Œé‡‡â½¤æ‹‰é“¾æ³•è§£å†³hashå†² çª</li></ul></li><li>åº”ç”¨åœºæ™¯<ul><li>æŠ½å¥–(srandmember) </li><li>ç‚¹èµæ”¶è—å…³æ³¨(sadd) </li><li>å…±åŒå…³æ³¨(sinter) </li><li>å¯èƒ½è®¤è¯†çš„â¼ˆ(sdiff)</li></ul></li><li>å¸¸ç”¨æŒ‡ä»¤<ul><li>saddã€sremã€smembersã€scardã€srandmemberã€ sismemberã€spopã€sinterã€sunionã€sdiffã€sinterstoreã€ sdiffstore</li></ul></li></ul></li><li>zset(sorted set)<ul><li>zset æ˜¯â¼€ä¸ªæœ‰åºä¸å¯é‡å¤é›†åˆï¼Œåº•å±‚é‡‡â½¤ä¸¤ç§â½…å¼å®ç°ï¼Œå½“æ•° æ®é‡è¾ƒå°‘å¹¶ä¸”å…ƒç´ å â½¤å†…å­˜å°‘(â¼©æ•´æ•°æˆ–çŸ­å­—ç¬¦ä¸²)ï¼Œé‡‡â½¤ ziplist(å‹ç¼©åˆ—è¡¨)ï¼Œåä¹‹é‡‡â½¤skiplist(è·³è¡¨) + dict(å­—å…¸)ï¼Œä¸¤ç§ â½…å¼éƒ½æ˜¯ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œå¦å¤–skiplistä¸»è¦æ˜¯ä¸ºäº†æå‡scoreæŸ¥ è¯¢æ•ˆç‡<ul><li>ziplist æ˜¯â¼€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œé€šè¿‡ç´§å‡‘çš„å­˜å‚¨æ¥èŠ‚çœç©º é—´</li><li>skiplist æ˜¯â¼€ä¸ªæœ‰åºé“¾è¡¨é…ä¸Šå¤šçº§ç´¢å¼•ï¼Œé€šè¿‡å¤šçº§ç´¢å¼•ä½ç½® çš„è·³è½¬æ¥å®ç°å¿«é€ŸæŸ¥æ‰¾å…ƒç´ ï¼Œä¸»è¦â½¤äºæŒ‰ç…§åˆ†å€¼å¯¹å…ƒç´ è¿› â¾æ’åºï¼ŒåŒæ ·ä¹Ÿâ½€æŒèŒƒå›´æŸ¥è¯¢<ul><li>è·³è¡¨å¦‚ä½•å®šä½å…ƒç´ <ul><li>æ¯éš”â¼€ä¸ªå…ƒç´ å»ºâ½´â¼€ä¸ªç´¢å¼•ï¼Œé€šè¿‡å»ºâ½´å¤šä¸ªç´¢å¼•ï¼Œ åˆ©â½¤â¼€æ¬¡ç´¢å¼•å®šä½åˆ°éœ€è¦æŸ¥è¯¢çš„å…ƒç´ ï¼Œå¦‚æœè§‰å¾— æ…¢ï¼Œå¯ä»¥åœ¨â¼€çº§ç´¢å¼•çš„åŸºç¡€ä¸Šå»ºâ½´â¼†çº§ç´¢å¼•ï¼Œä¾æ¬¡ ç±»æ¨ï¼Œåœ¨å¤šçº§ç´¢å¼•ä¹‹é—´æ¥å›è½¬è·³å®ç°å¿«é€Ÿå®šä½ï¼Œå½“ æ•°æ®é‡ç‰¹åˆ«â¼¤çš„æ—¶å€™ï¼ŒæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸ºO(logN)ï¼Œ å› ä¸ºå®ƒæœ¬èº«çš„æ€æƒ³å°±ç±»ä¼¼â¼†åˆ†æŸ¥æ‰¾</li></ul></li></ul></li></ul></li><li>åº”ç”¨åœºæ™¯<ul><li>æ’â¾æ¦œ(zrange&#x2F;zreverange&#x2F;zunionscore)</li></ul></li><li>å¸¸ç”¨æŒ‡ä»¤<ul><li>zaddã€zremã€zsoreã€zincrbyã€zrangeã€zreverangeã€ zrangebyscoreã€zreverangescoreã€zunionscoreã€ zinterscore</li></ul></li></ul></li><li>bitmap<ul><li>bitmapæ˜¯â¼€ä¸ªä½å›¾</li><li>åº”â½¤åœºæ™¯ <ul><li>â½‰æ‰“å¡ã€â½‰æ´»è·ƒ <ul><li>â½‰æ‰“å¡å¯ä»¥é€šè¿‡å°† å½“å‰ç¬¬â¼å¤© ä½œä¸º åç§»é‡ï¼Œå¦‚æœæ‰“å¡ å¯¹åº”çš„ä½ç½®ä¸º1ï¼Œåä¹‹ä¸º0</li></ul></li><li>å¸ƒéš†è¿‡æ»¤å™¨</li></ul></li></ul></li><li>stream<ul><li>stream æ˜¯å‚è€ƒkafkaè®¾è®¡çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œâ½€æŒæŒä¹…åŒ–ï¼Œé€‚åˆâ¼©åŸº æ•°çš„æ¶ˆæ¯é˜Ÿåˆ—åœºæ™¯</li></ul></li></ul><h4 id="String-æ•°æ®ç±»å‹åœ¨é¡¹ç›®ä¸­çš„å®é™…ä½¿ç”¨"><a href="#String-æ•°æ®ç±»å‹åœ¨é¡¹ç›®ä¸­çš„å®é™…ä½¿ç”¨" class="headerlink" title="String æ•°æ®ç±»å‹åœ¨é¡¹ç›®ä¸­çš„å®é™…ä½¿ç”¨"></a>String æ•°æ®ç±»å‹åœ¨é¡¹ç›®ä¸­çš„å®é™…ä½¿ç”¨</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240311220409.png" alt="image.png"></p><h4 id="ZSet-ä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨"><a href="#ZSet-ä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨" class="headerlink" title="ZSet ä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨"></a>ZSet ä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨</h4><h4 id="è°ˆä¸€ä¸‹å¸ƒéš†è¿‡æ»¤å™¨"><a href="#è°ˆä¸€ä¸‹å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="è°ˆä¸€ä¸‹å¸ƒéš†è¿‡æ»¤å™¨"></a>è°ˆä¸€ä¸‹å¸ƒéš†è¿‡æ»¤å™¨</h4><p>å¸ƒéš†è¿‡æ»¤å™¨ æ˜¯åŸºäºbitmapå®ç°çš„ï¼Œä¸»è¦â½¤äºç²—ç•¥çš„æ•°æ®è¿‡æ»¤ </p><ul><li>æ·»åŠ æ•°æ®æ—¶ï¼Œç»è¿‡hashè¿ç®—å¾—åˆ°å¯¹åº”çš„ bitä½ï¼Œå°†è¯¥ bitä½ ç½®ä¸º1 <ul><li>bitä½ä¸º1 è¡¨ç¤ºå¯èƒ½å­˜åœ¨ </li><li>bitä½ä¸º0 è¡¨ç¤ºâ¼€å®šä¸å­˜åœ¨</li></ul></li></ul><h4 id="Redis-å­—ç¬¦ä¸²æœ€å¤§ä¸èƒ½è¶…è¿‡å¤šå°‘"><a href="#Redis-å­—ç¬¦ä¸²æœ€å¤§ä¸èƒ½è¶…è¿‡å¤šå°‘" class="headerlink" title="Redis å­—ç¬¦ä¸²æœ€å¤§ä¸èƒ½è¶…è¿‡å¤šå°‘"></a>Redis å­—ç¬¦ä¸²æœ€å¤§ä¸èƒ½è¶…è¿‡å¤šå°‘</h4><p>512 MB</p><h3 id="å†…å­˜ã€è¯»å†™"><a href="#å†…å­˜ã€è¯»å†™" class="headerlink" title="å†…å­˜ã€è¯»å†™"></a>å†…å­˜ã€è¯»å†™</h3><h4 id="è®²ä¸€ä¸‹-Redis-æŒä¹…åŒ–-ğŸš©"><a href="#è®²ä¸€ä¸‹-Redis-æŒä¹…åŒ–-ğŸš©" class="headerlink" title="è®²ä¸€ä¸‹ Redis æŒä¹…åŒ–  ğŸš©"></a>è®²ä¸€ä¸‹ Redis æŒä¹…åŒ–  ğŸš©</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312171845.png" alt="image.png"></p><h4 id="Redis-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«-ğŸš©"><a href="#Redis-ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«-ğŸš©" class="headerlink" title="Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«  ğŸš©"></a>Redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«  ğŸš©</h4><ul><li>1ã€ä¸»è¦è¿˜æ˜¯åŸºäºå†…å­˜æ“ä½œ</li><li>2ã€æ˜¯å•çº¿ç¨‹çš„ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯ç«äº‰æ¡ä»¶ï¼Œå¤šçº¿ç¨‹éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</li><li>3ã€ä½¿ç”¨ IO å¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡ IO</li><li>4ã€Redis çš„æ¯ç§æ•°æ®ç»“æ„è¿›è¡Œäº†ä¼˜åŒ–å¤„ç†</li></ul><h4 id="ä»€ä¹ˆæ˜¯-IO-å¤šè·¯å¤ç”¨"><a href="#ä»€ä¹ˆæ˜¯-IO-å¤šè·¯å¤ç”¨" class="headerlink" title="ä»€ä¹ˆæ˜¯ IO å¤šè·¯å¤ç”¨"></a>ä»€ä¹ˆæ˜¯ IO å¤šè·¯å¤ç”¨</h4><p>Rdisæ˜¯çº¯å†…å­˜æ“ä½œï¼Œæ‰§è¡Œé€Ÿåº¦éå¸¸å¿«ï¼Œå®ƒçš„æ€§èƒ½ç“¶é¢ˆæ˜¯ç½‘ç»œå»¶è¿Ÿè€Œä¸æ˜¯æ‰§è¡Œé€Ÿåº¦ï¼Œ</p><p>I&#x2F;Oå¤šè·¯å¤ç”¨æ¨¡å‹ä¸»è¦å°±æ˜¯å®ç°äº†é«˜æ•ˆçš„ç½‘ç»œè¯·æ±‚</p><ul><li>ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´</li><li>å¸¸è§çš„  IO æ¨¡å‹<ul><li>é˜»å¡IO(Blocking IO)</li><li>éé˜»å¡IO(Nonblocking IO)</li><li>IOå¤šè·¯å¤ç”¨(IO Multiplexing)</li></ul></li><li>Redisç½‘ç»œæ¨¡å‹</li></ul><p>é˜»å¡IO æ˜¯å¸¸è§ çš„IO æ“ä½œæ¨¡å‹ï¼Œä½†æ˜¯å®ƒå®é™…çš„æ•ˆç‡å¹¶ä¸æ˜¯å¾ˆé«˜ï¼›ç”¨æˆ·æ€åœ¨å†…æ ¸è¯»å–æ•°æ®å’Œä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºçš„ä¸¤ä¸ªé˜¶æ®µéƒ½éœ€è¦ç­‰å¾…é˜»å¡è¿è¡Œã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317144125.png" alt="image.png"></p><p>éé˜»å¡IOï¼Œåœ¨å†…æ ¸æ€è¯»å–è¿™ä¸€é˜¶æ®µï¼Œç”¨æˆ·é˜¶æ®µå¹¶ä¸ä¼šæŒç»­é˜»å¡ç­‰å¾…ï¼Œè€Œæ˜¯è‡ªæ—‹è¯¢é—®æ˜¯å¦æ•°æ®å‡†å¤‡å°±ç»ªï¼Œå¦‚æœæœªå°±ç»ªï¼Œå°±å¾ªç¯å°è¯•è¯»å–ã€‚</p><p>é˜¶æ®µäºŒä»ç„¶ä¼šè¢«é˜»å¡ï¼Œä½†ç”±äºå¿™ç­‰æœºåˆ¶å®é™…æ•ˆç‡å¹¶æ²¡æœ‰æé«˜å¾ˆå¤šã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317144427.png" alt="image.png"></p><p>IO å¤šè·¯å¤ç”¨</p><p>ç›‘å¬äº†å¤šä¸ª sockerï¼Œå¹¶ä¸”å…¶ä¸­åªè¦æœ‰ä¸€ä¸ª socket å°±ç»ªï¼Œå°±å¯ä»¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨ recvfrom</p><p>å’Œå‰è€…æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼šéé˜»å¡ iO æˆ–è€… é˜»å¡ IO  éœ€è¦ç­‰å¾…å®ƒç›®å‰åœ¨è¯»å–çš„ socket æ•°æ®å‡†å¤‡å°±ç»ªæ‰å¯ä»¥ä¸‹ä¸€æ­¥æ“ä½œï¼ˆè€Œå®é™…ä¸Šå¯èƒ½å®ƒåé¢çš„ socket æ˜¯å·²ç»å‡†å¤‡å°±ç»ªäº†ï¼‰</p><p>é€šè¿‡è¿™ä¸ªç›‘å¬æœºåˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆæé«˜æ•ˆç‡</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317145015.png" alt="image.png"></p><p>å¸¸è§ çš„ IO  å¤šè·¯å¤ç”¨æ¨¡å¼æœ‰ï¼š selectã€pollã€epollï¼›</p><p>ç„¶åå‰ä¸¤ä¸ªçš„æœºåˆ¶ï¼šselect å’Œ poll ä¼šæœ‰ä¸€ä¸ªç›‘å¬ï¼Œç„¶ååªæ˜¯ç›‘å¬é‡Œé¢æœ‰æ²¡æœ‰å°±ç»ªçš„ï¼Œå¦‚æœæœ‰ï¼Œéå†é€ä¸ªæ¥åˆ¤æ–­ï¼›<br>è€Œ epoll æœºåˆ¶èƒ½å¤Ÿç²¾ç¡®å®šä½åˆ°å…·ä½“æ˜¯å“ªä¸€ä¸ªï¼Œè€Œä¸ç”¨éå†ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317145752.png" alt="image.png"></p><p>Reids ç½‘ç»œæ¨¡å‹ï¼šIOå¤šè·¯å¤ç”¨ + äº‹ä»¶æ´¾å‘æœºåˆ¶</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317150021.png" alt="image.png"></p><h4 id="Redis-ä¸ºä»€ä¹ˆè¦å¼•å…¥å¤šçº¿ç¨‹"><a href="#Redis-ä¸ºä»€ä¹ˆè¦å¼•å…¥å¤šçº¿ç¨‹" class="headerlink" title="Redis ä¸ºä»€ä¹ˆè¦å¼•å…¥å¤šçº¿ç¨‹"></a>Redis ä¸ºä»€ä¹ˆè¦å¼•å…¥å¤šçº¿ç¨‹</h4><p>å½±å“æ•ˆç‡æœ€å¤§çš„æ˜¯ ç½‘ç»œ IO</p><p>Redis å¤šçº¿ç¨‹ åœ¨å‘½ä»¤å›å¤å¤„ç†å™¨å’Œ æ¥å—å‚æ•°æ•°æ®ï¼Œè½¬æ¢Redis å‘½ä»¤ ï¼ˆç½‘ç»œIO æ–¹é¢çš„å†…å®¹ï¼‰è¿›è¡Œäº†ä¼˜åŒ–ï¼ˆåŠ å…¥äº†å¤šçº¿ç¨‹ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317150227.png" alt="image.png"></p><ul><li>Rediså¼•â¼Šå¤šçº¿ç¨‹ä¸»è¦æƒ³å‘æŒ¥å¤šæ ¸å¤„ç†å™¨çš„èƒ½â¼’ï¼Œå¤„ç†åœ¨â¼¤æ•°æ®é‡ä¸‹ â½¹ç»œIOè¯»å†™é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œä½†æ˜¯æŒ‡ä»¤çš„æ‰§â¾ä¾æ—§é‡‡â½¤çš„æ˜¯å•çº¿ç¨‹</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317150349.png" alt="image.png"></p><p>é¢è¯•å®˜ï¼šRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿˜é‚£ä¹ˆå¿«ï¼Ÿ</p><p>å€™é€‰äººï¼š</p><p>å—¯ï¼Œè¿™ä¸ªæœ‰å‡ ä¸ªåŸå› å§~~~<br>1ã€å®Œå…¨åŸºäºå†…å­˜çš„ï¼ŒCè¯­è¨€ç¼–å†™<br>2ã€é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯ç«äº‰æ¡ä»¶<br>3ã€ä½¿ç”¨å¤šè·¯1&#x2F;0å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡I0</p><p>ä¾‹å¦‚ï¼šbgsaveå’Œbgrewriteaoféƒ½æ˜¯åœ¨åå°æ‰§è¡Œæ“ä½œï¼Œä¸å½±å“ä¸»çº¿ç¨‹çš„æ­£å¸¸ä½¿ç”¨ï¼Œä¸ä¼šäº§ç”Ÿé˜»å¡</p><p>é¢è¯•å®˜ï¼šèƒ½è§£é‡Šä¸€ä¸‹1&#x2F;Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Ÿ</p><p>å€™é€‰äººï¼šå—¯~ï¼ŒI&#x2F;Oå¤šè·¯å¤ç”¨æ˜¯æŒ‡åˆ©ç”¨å•ä¸ªçº¿ç¨‹æ¥åŒæ—¶ç›‘å¬å¤šä¸ªSocket,å¹¶åœ¨æŸä¸ªSocketiå¯è¯»ã€å¯å†™æ—¶<br>å¾—åˆ°é€šçŸ¥ï¼Œä»è€Œé¿å…æ— æ•ˆçš„ç­‰å¾…ï¼Œå……åˆ†åˆ©ç”¨CPUèµ„æºã€‚ç›®å‰çš„1&#x2F;Oå¤šè·¯å¤ç”¨éƒ½æ˜¯é‡‡ç”¨çš„epoæ¨¡å¼å®ç°ï¼Œ<br>å®ƒä¼šåœ¨é€šçŸ¥ç”¨æˆ·è¿›ç¨‹Socketå°±ç»ªçš„åŒæ—¶ï¼ŒæŠŠå·±å°±ç»ªçš„Socketå†™å…¥ç”¨æˆ·ç©ºé—´ï¼Œä¸éœ€è¦æŒ¨ä¸ªéå†Socketæ¥åˆ¤<br>æ–­æ˜¯å¦å°±ç»ªï¼Œæå‡äº†æ€§èƒ½ã€‚<br>å…¶ä¸­Redisçš„ç½‘ç»œæ¨¡å‹å°±æ˜¯ä½¿ç”¨I&#x2F;Oå¤šè·¯å¤ç”¨ç»“åˆäº‹ä»¶çš„å¤„ç†å™¨æ¥åº”å¯¹å¤šä¸ªSocketiè¯·æ±‚ï¼Œæ¯”å¦‚ï¼Œæä¾›äº†è¿<br>æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼Œå‘½ä»¤è¯·æ±‚å¤„ç†å™¨ï¼š<br>åœ¨Redis6.0ä¹‹åï¼Œä¸ºäº†æå‡æ›´å¥½çš„æ€§èƒ½ï¼Œåœ¨å‘½ä»¤å›å¤å¤„ç†å™¨ä½¿ç”¨äº†å¤šçº¿ç¨‹æ¥å¤„ç†å›å¤äº‹ä»¶ï¼Œåœ¨å‘½ä»¤è¯·æ±‚<br>å¤„ç†å™¨ä¸­ï¼Œå°†å‘½ä»¤çš„è½¬æ¢ä½¿ç”¨äº†å¤šçº¿ç¨‹ï¼Œå¢åŠ å‘½ä»¤è½¬æ¢é€Ÿåº¦ï¼Œåœ¨å‘½ä»¤æ‰§è¡Œçš„æ—¶å€™ï¼Œä¾ç„¶æ˜¯å•çº¿ç¨‹</p><h4 id="è®²ä¸€ä¸‹-Redis-çš„-Reactor-æ¨¡å‹"><a href="#è®²ä¸€ä¸‹-Redis-çš„-Reactor-æ¨¡å‹" class="headerlink" title="è®²ä¸€ä¸‹ Redis çš„ Reactor æ¨¡å‹"></a>è®²ä¸€ä¸‹ Redis çš„ Reactor æ¨¡å‹</h4><h4 id="Redis-çš„è¿‡æœŸç­–ç•¥"><a href="#Redis-çš„è¿‡æœŸç­–ç•¥" class="headerlink" title="Redis çš„è¿‡æœŸç­–ç•¥"></a>Redis çš„è¿‡æœŸç­–ç•¥</h4><ul><li>å®šæ—¶è¿‡æœŸï¼šæ¯ä¸ªè®¾ç½®è¿‡æœŸæ—¶é—´çš„ key éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œ åˆ°è¿‡æœŸæ—¶é—´å°±ä¼šç«‹å³å¯¹ key è¿›è¡Œæ¸…é™¤</li><li>æƒ°æ€§è¿‡æœŸï¼šåªæœ‰å½“è®¿é—®ä¸€ä¸ª key æ—¶ï¼Œæ‰ä¼šåˆ¤æ–­è¯¥ key æ˜¯å¦å·²è¿‡ æœŸï¼Œè¿‡æœŸåˆ™æ¸…é™¤</li><li>å®šæœŸè¿‡æœŸï¼šæ¯éš”ä¸€å®šçš„æ—¶é—´ï¼Œä¼šæ‰«æä¸€å®šæ•°é‡çš„æ•°æ®åº“çš„ expires å­—å…¸ä¸­ä¸€å®šæ•°é‡çš„ keyï¼Œå¹¶æ¸…é™¤å…¶ä¸­å·²è¿‡æœŸçš„ ke</li></ul><h4 id="è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥-ğŸš©"><a href="#è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥-ğŸš©" class="headerlink" title="è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥  ğŸš©"></a>è¿‡æœŸé”®çš„åˆ é™¤ç­–ç•¥  ğŸš©</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312184918.png" alt="image.png"></p><p>å‡å¦‚redisçš„ key è¿‡æœŸä¹‹åï¼Œä¼šç«‹å³åˆ é™¤å—ï¼Ÿ  set name heima 10</p><ul><li>Redis å¯¹æ•°æ®è®¾ç½®æ•°æ®çš„æœ‰æ•ˆæ—¶é—´ï¼Œæ•°æ®è¿‡æœŸä»¥åï¼Œå°±éœ€è¦å°†æ•°æ®ä»å†…å­˜ä¸­åˆ é™¤æ‰ã€‚</li><li>å¯ä»¥æŒ‰ç…§ä¸åŒçš„è§„åˆ™è¿›è¡Œåˆ é™¤ï¼Œè¿™ç§åˆ é™¤è§„åˆ™å°±è¢«ç§°ä¹‹ä¸ºæ•°æ®çš„åˆ é™¤ç­–ç•¥ï¼ˆæ•°æ®è¿‡æœŸç­–ç•¥ï¼‰ã€‚</li></ul><p>å¸¸è§çš„è¿‡æœŸç­–ç•¥</p><ul><li>æƒ°æ€§åˆ é™¤<ul><li>åªæœ‰å½“è®¿é—®ä¸€ä¸ªkeyçš„æ—¶å€™ï¼Œæ‰ä¼šåˆ¤æ–­çš„å½“å‰keyæ˜¯å¦å·²è¿‡æœŸï¼Œå·²è¿‡æœŸå°±ä¼šåˆ é™¤</li><li>è¿™ä¸ªç­–ç•¥å¯ä»¥èŠ‚çœCPUèµ„æºï¼Œä½†æ˜¯å ç”¨å†…å­˜ï¼Œå¯èƒ½å› ä¸ºå¤§é‡çš„keyä¸è¢«å†æ¬¡è®¿é—®ï¼Œå¯¼è‡´ä¸€ç›´ä¸æ¸…é™¤ä»è€Œå ç”¨å†…å­˜</li></ul></li><li>å®šæœŸåˆ é™¤<ul><li>æ¯éš”ä¸€æ®µæ—¶é—´ä¼šæ‰«æä¸€å®šæ•°é‡çš„è¿‡æœŸkey,å¹¶ä¸”æ¸…é™¤å·²è¿‡æœŸçš„keyã€‚</li><li>è¿™ä¸ªç­–ç•¥å±äºæŠ˜ä¸­æ–¹æ¡ˆï¼Œå¯ä»¥æœ‰æ•ˆçš„å¹³è¡¡CPUèµ„æºä»¥åŠå†…å­˜èµ„æº</li><li>å®šæœŸæ¸…ç†æœ‰ä¸¤ç§æ¨¡å¼ï¼š<ul><li>SLOW æ¨¡å¼æ˜¯å®šæ—¶ä»»åŠ¡ï¼Œæ‰§è¡Œé¢‘ç‡é»˜è®¤ä¸º10hz,æ¯æ¬¡ä¸è¶…è¿‡25ms,ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶redis.confçš„hzé€‰é¡¹æ¥è°ƒæ•´è¿™ä¸ªæ¬¡æ•°</li><li>FAST æ¨¡å¼æ‰§è¡Œé¢‘ç‡ä¸å›ºå®šï¼Œä½†ä¸¤æ¬¡é—´éš”ä¸ä½äº2ms,æ¯æ¬¡è€—æ—¶ä¸è¶…è¿‡1ms</li></ul></li></ul></li><li>å¼ºåˆ¶åˆ é™¤<ul><li>å½“å·²ä½¿ç”¨å†…å­˜è¶…è¿‡Redis:æœ€å¤§å…è®¸å†…å­˜ï¼Œä¼šè§¦å‘å†…å­˜æ·˜æ±°ç­–ç•¥</li></ul></li><li>Redisä¸­<strong>åŒæ—¶ä½¿ç”¨äº†æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤</strong></li></ul><h4 id="å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›"><a href="#å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›" class="headerlink" title="å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›"></a>å†…å­˜æ·˜æ±°ç­–ç•¥æœ‰å“ªäº›</h4><p>æ•°æ®çš„æ·˜æ±°ç­–ç•¥ï¼šå½“Redisä¸­çš„å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œæ­¤æ—¶åœ¨å‘Redisrä¸­æ·»åŠ æ–°çš„key,é‚£ä¹ˆRedis å°±ä¼šæŒ‰ç…§æŸä¸€ç§è§„åˆ™å°†å†…å­˜ä¸­çš„æ•°æ®åˆ é™¤æ‰ï¼Œè¿™ç§æ•°æ®çš„åˆ é™¤è§„åˆ™è¢«ç§°ä¹‹ä¸ºå†…å­˜çš„æ·˜æ±°ç­–ç•¥ã€‚</p><ul><li>é»˜è®¤ç­–ç•¥noevictionï¼Œå½“å†…å­˜ä¸â¾œä»¥å®¹çº³æ–°å†™â¼Šæ•°æ®æ—¶ï¼Œæ–°å†™â¼Šæ“ä½œ ä¼šæŠ¥é”™</li><li>é’ˆå¯¹è®¾ç½®è¿‡æœŸæ—¶é—´çš„key<ul><li>volatile-lruï¼ŒæŒ‰ç…§LRUç®—æ³•åˆ é™¤ </li><li>volatile-lfuï¼ŒæŒ‰ç…§LFUç®—æ³•åˆ é™¤ </li><li>volatile-radomï¼Œéšæœºåˆ é™¤ </li><li>volatile-ttlï¼ŒæŒ‰è¿‡æœŸæ—¶é—´é¡ºåºåˆ é™¤</li></ul></li><li>é’ˆå¯¹æ‰€æœ‰key<ul><li>allkeys-randomï¼Œéšæœºåˆ é™¤ </li><li>allkeys-lruï¼ŒæŒ‰ç…§LRUç®—æ³•åˆ é™¤ </li><li>allkeys-lfuï¼ŒæŒ‰ç…§LFUç®—æ³•åˆ é™¤</li></ul></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312171303.png" alt="image.png"></p><p>å…³äºæ•°æ®æ·˜æ±°ç­–ç•¥å…¶ä»–çš„é¢è¯•é—®é¢˜</p><ul><li>1.æ•°æ®åº“æœ‰1000ä¸‡æ•°æ®ï¼ŒRedisåªèƒ½ç¼“å­˜20wæ•°æ®ï¼Œå¦‚ä½•ä¿è¯Redis ä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿ<ul><li>ä½¿ç”¨allkeys-lru(æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°)æ·˜æ±°ç­–ç•¥ï¼Œç•™ä¸‹æ¥çš„éƒ½æ˜¯ç»å¸¸è®¿é—®çš„çƒ­ç‚¹æ•°æ®</li></ul></li><li>2.Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<ul><li>ä¸»è¦çœ‹æ•°æ®æ·˜æ±°ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœæ˜¯é»˜è®¤çš„é…ç½®(noeviction),ä¼šç›´æ¥æŠ¥é”™</li></ul></li></ul><p>è®°å¿†ç‚¹ï¼š</p><p>æ•°æ®æ·˜æ±°ç­–ç•¥</p><ul><li>1.Redisæä¾›äº†8ç§ä¸åŒçš„æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Œé»˜è®¤æ˜¯ noeviction ä¸åˆ é™¤ä»»ä½•æ•°æ®ï¼Œå†…å­˜ä¸è¶³ç›´æ¥æŠ¥é”™</li><li>2.LRU: æœ€å°‘æœ€è¿‘ä½¿ç”¨ã€‚ç”¨å½“å‰æ—¶é—´å‡å»æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ï¼Œè¿™ä¸ªå€¼è¶Šå¤§åˆ™æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li><li>3.LFU:æœ€å°‘é¢‘ç‡ä½¿ç”¨ã€‚ä¼šç»Ÿè®¡æ¯ä¸ªkeyçš„è®¿é—®é¢‘ç‡ï¼Œå€¼è¶Šå°æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜</li></ul><p>å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ç”¨çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯allkeys-lru(ç»“åˆè‡ªå·±çš„ä¸šåŠ¡åœºæ™¯)</p><h3 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h3><h4 id="Redis-æ€ä¹ˆå®ç°é«˜å¯ç”¨çš„"><a href="#Redis-æ€ä¹ˆå®ç°é«˜å¯ç”¨çš„" class="headerlink" title="Redis æ€ä¹ˆå®ç°é«˜å¯ç”¨çš„"></a>Redis æ€ä¹ˆå®ç°é«˜å¯ç”¨çš„</h4><h4 id="Redisiä¸»ä»å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰åŸç†"><a href="#Redisiä¸»ä»å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰åŸç†" class="headerlink" title="Redisiä¸»ä»å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰åŸç†"></a>Redisiä¸»ä»å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰åŸç†</h4><ul><li>é€šè¿‡ RDB æ—¥å¿—æ–‡ä»¶å’Œåç§»é‡æ“ä½œ</li></ul><p>å…¨é‡åŒæ­¥æ“ä½œ</p><ul><li>1ã€ä»èŠ‚ç‚¹å‘èµ·åŒæ­¥è¯·æ±‚</li><li>2ã€ä¸»èŠ‚ç‚¹åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ï¼Œè¿›è¡Œå…¨é‡åŒæ­¥ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ¤æ–­ æ•°æ®é›† replid æ˜¯å¦ä¸€è‡´<ul><li>æ˜¯ï¼Œç¬¬ä¸€æ¬¡ï¼Œä¼šè¿”å› master çš„æ•°æ®ç‰ˆæœ¬ä¿¡æ¯ replidã€offset</li></ul></li><li>3ã€ä»èŠ‚ç‚¹ä¼šä¿å­˜ç‰ˆæœ¬ä¿¡æ¯</li><li>4ã€ä¸»èŠ‚ç‚¹ä¼šç”Ÿæˆ RDB æ–‡ä»¶è¿›è¡Œå‘é€æ“ä½œ</li><li>5ã€ä»èŠ‚ç‚¹ä¼šæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼ŒåŠ è½½ RDB æ–‡ä»¶</li><li>6ã€ä»èŠ‚ç‚¹åŠ è½½è¿‡ç¨‹ä¼šä¸»èŠ‚ç‚¹ä¼šç”Ÿæˆä¸€ä¸ª repl_baklog çš„æ–‡ä»¶ï¼ˆä¸­é—´æ‰§è¡Œæ“ä½œï¼‰ï¼Œå¹¶å‘é€åˆ°ä»èŠ‚ç‚¹</li><li>7ã€ä»èŠ‚ç‚¹å†è¿›è¡ŒåŠ è½½è¿›è¡ŒåŒæ­¥</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317151632.png" alt="image.png"></p><p>å¢é‡åŒæ­¥æ“ä½œ</p><ul><li>ä» reol_baklog è·å–æ•°æ®å‘é€åˆ°ä»èŠ‚ç‚¹</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317152226.png" alt="image.png"></p><p>å‚è€ƒ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317152304.png" alt="image.png"></p><h4 id="è®²ä¸€ä¸‹-å“¨å…µé€‰ä¸»è¿‡ç¨‹"><a href="#è®²ä¸€ä¸‹-å“¨å…µé€‰ä¸»è¿‡ç¨‹" class="headerlink" title="è®²ä¸€ä¸‹ å“¨å…µé€‰ä¸»è¿‡ç¨‹"></a>è®²ä¸€ä¸‹ å“¨å…µé€‰ä¸»è¿‡ç¨‹</h4><p>å“¨å…µï¼šé«˜å¯ç”¨ï¼Œæä¾›ç›‘æ§èŒƒå›´å’Œè‡ªåŠ¨æ•…éšœæ¢å¤ä¸é€šçŸ¥</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317152413.png" alt="image.png"></p><ul><li>é€‰å–æ“ä½œ</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317152506.png" alt="image.png"></p><p>å“¨å…µæ¨¡å¼ä¸­ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼šè„‘è£‚é—®é¢˜</p><h4 id="è®²ä¸€ä¸‹-ä¸»ä»é€‰ä¸¾çš„è„‘è£‚é—®é¢˜"><a href="#è®²ä¸€ä¸‹-ä¸»ä»é€‰ä¸¾çš„è„‘è£‚é—®é¢˜" class="headerlink" title="è®²ä¸€ä¸‹ ä¸»ä»é€‰ä¸¾çš„è„‘è£‚é—®é¢˜"></a>è®²ä¸€ä¸‹ ä¸»ä»é€‰ä¸¾çš„è„‘è£‚é—®é¢˜</h4><p>é›†ç¾¤è„‘è£‚æ˜¯ç”±äºä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å’Œsentinelå¤„äºä¸åŒçš„ç½‘ç»œåˆ†åŒºï¼Œä½¿å¾—sentinelæ²¡æœ‰èƒ½å¤Ÿå¿ƒè·³æ„ŸçŸ¥åˆ°ä¸»èŠ‚ç‚¹ï¼Œæ‰€ä»¥é€šè¿‡é€‰ä¸¾çš„æ–¹å¼æå‡äº†ä¸€ä¸ªä»èŠ‚ç‚¹ä¸ºä¸»ï¼Œè¿™æ ·å°±å­˜åœ¨äº†ä¸¤ä¸ªmaster,å°±åƒå¤§è„‘åˆ†è£‚äº†ä¸€æ ·ï¼Œè¿™æ ·ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¿˜åœ¨è€çš„ä¸»èŠ‚ç‚¹é‚£é‡Œå†™å…¥æ•°æ®ï¼Œæ–°èŠ‚ç‚¹æ— æ³•åŒæ­¥æ•°æ®ï¼Œå½“ç½‘ç»œæ¢å¤åï¼Œsentinelä¼šå°†è€çš„ä¸»èŠ‚ç‚¹é™ä¸ºä»èŠ‚ç‚¹ï¼Œè¿™æ—¶å†ä»æ–°master åŒæ­¥æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±</p><p>è§£å†³ï¼šæˆ‘ä»¬å¯ä»¥ä¿®æ”¹rdsçš„é…ç½®ï¼Œå¯ä»¥è®¾ç½®æœ€å°‘çš„ä»èŠ‚ç‚¹æ•°é‡ä»¥åŠç¼©çŸ­ä¸»ä»æ•°æ®åŒæ­¥çš„å»¶è¿Ÿæ—¶é—´ï¼Œè¾¾ä¸åˆ°è¦æ±‚å°±æ‹’ç»è¯·æ±‚å°±å¯ä»¥é¿å…å¤§é‡çš„æ•°æ®ä¸¢å¤±ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317152818.png" alt="image.png"></p><p>å‚è€ƒ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317152938.png" alt="image.png"></p><h4 id="åˆ†ç‰‡é›†ç¾¤"><a href="#åˆ†ç‰‡é›†ç¾¤" class="headerlink" title="åˆ†ç‰‡é›†ç¾¤"></a>åˆ†ç‰‡é›†ç¾¤</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317153141.png" alt="image.png"></p><p>å‚è€ƒ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317153308.png" alt="image.png"></p><h4 id="è®²ä¸€ä¸‹Redis-Clusterä¸»ä»é€‰ä¸¾è¿‡ç¨‹"><a href="#è®²ä¸€ä¸‹Redis-Clusterä¸»ä»é€‰ä¸¾è¿‡ç¨‹" class="headerlink" title="è®²ä¸€ä¸‹Redis Clusterä¸»ä»é€‰ä¸¾è¿‡ç¨‹"></a>è®²ä¸€ä¸‹Redis Clusterä¸»ä»é€‰ä¸¾è¿‡ç¨‹</h4><h3 id="ç”Ÿäº§é—®é¢˜"><a href="#ç”Ÿäº§é—®é¢˜" class="headerlink" title="ç”Ÿäº§é—®é¢˜"></a>ç”Ÿäº§é—®é¢˜</h3><h4 id="æ•°æ®ä¸€è‡´æ€§"><a href="#æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§"></a>æ•°æ®ä¸€è‡´æ€§</h4><ul><li>æŸ¥è¯¢<ul><li>å½“éœ€è¦è·å–æ•°æ®æ—¶ï¼Œé¦–å…ˆæŸ¥è¯¢ç¼“å­˜ã€‚</li><li>å¦‚æœç¼“å­˜ä¸­æœ‰æ•°æ®ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„æ•°æ®ã€‚</li><li>å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå°†æŸ¥è¯¢ç»“æœå­˜å…¥ç¼“å­˜ï¼Œå¹¶è¿”å›æ•°æ®ã€‚</li><li>è®¾ç½®åˆç†çš„ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œä»¥ä¿è¯æ•°æ®çš„æ—¶æ•ˆæ€§ã€‚</li></ul></li><li>æ›´æ–°<ul><li>é‡åˆ°å†™è¯·æ±‚çš„æ—¶å€™æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ cache</li></ul></li><li>åˆ é™¤<ul><li>å½“æ•°æ®éœ€è¦è¢«åˆ é™¤æ—¶ï¼Œé¦–å…ˆåˆ é™¤æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</li><li>ç„¶ååˆ é™¤ç¼“å­˜ä¸­å¯¹åº”çš„æ•°æ®ï¼Œä¿æŒæ•°æ®åº“å’Œç¼“å­˜çš„ä¸€è‡´æ€§ã€‚</li></ul></li></ul><p>ç¼“å­˜è¯»å†™ç­–ç•¥ä¸€èˆ¬é€‰æ‹©ä½¿ç”¨æ—è·¯ç¼“å­˜æ¨¡å¼</p><p>å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥</p><ul><li>Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰<ul><li>è¯»<ul><li>ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å›</li><li>cache ä¸­è¯»å–ä¸åˆ°çš„è¯ï¼Œå°±ä» db ä¸­è¯»å–æ•°æ®è¿”å›</li><li>å†æŠŠæ•°æ®æ”¾åˆ° cache ä¸­ã€‚</li></ul></li><li>å†™<ul><li>å…ˆæ›´æ–° dbï¼Œç„¶åç›´æ¥åˆ é™¤ cache</li></ul></li></ul></li><li>Read&#x2F;Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰<ul><li>è¯»<ul><li>ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å› ã€‚</li><li>è¯»å–ä¸åˆ°çš„è¯ï¼Œå…ˆä» db åŠ è½½ï¼Œå†™å…¥åˆ° cache åè¿”å›å“åº”ã€‚</li></ul></li><li>å†™<ul><li>å…ˆæŸ¥ cacheï¼Œcache ä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥æ›´æ–° dbã€‚</li><li>cache ä¸­å­˜åœ¨ï¼Œåˆ™å…ˆæ›´æ–° cacheï¼Œç„¶å cache æœåŠ¡è‡ªå·±æ›´æ–° dbï¼ˆ<strong>åŒæ­¥æ›´æ–° cache å’Œ db</strong>ï¼‰ã€‚</li></ul></li></ul></li><li>Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰<ul><li>è¯»</li><li>å†™<ul><li>**Read&#x2F;Write Through æ˜¯åŒæ­¥æ›´æ–° cache å’Œ dbï¼Œ</li><li>Write Behind åˆ™æ˜¯åªæ›´æ–°ç¼“å­˜ï¼Œä¸ç›´æ¥æ›´æ–° dbï¼Œè€Œæ˜¯æ”¹ä¸ºå¼‚æ­¥æ‰¹é‡çš„æ–¹å¼æ¥æ›´æ–° db</li></ul></li></ul></li></ul><p>ä¿æŒæ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¸€è‡´æ€§</p><ul><li>1ã€æ•°æ®åº“ä¸­æ•°æ®ä¸­å…¨é‡åˆ·å†™åˆ°ç¼“å­˜ä¸­ï¼Œä¸è®¾ç½®å¤±æ•ˆæ—¶é—´ + å®šæ—¶ä»»åŠ¡</li><li>2ã€ä¿ç•™çƒ­æ•°æ®ï¼ˆéƒ½è®¾ç½®ä¸€ä¸ªåˆç†çš„è¿‡æœŸæ—¶é—´ï¼‰</li><li>3ã€æ—è·¯ç¼“å­˜æ¨¡å¼ + ä¿è¯åˆ é™¤æ“ä½œéå¼‚å¸¸æ‰§è¡Œï¼ˆMQå¼‚æ­¥ + è®¢é˜…æ—¥å¿—æœºåˆ¶ï¼‰</li></ul><h4 id="æ€ä¹ˆä¿å­˜ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸€è‡´ï¼ˆæ•°æ®ä¸€è‡´æ€§æ€ä¹ˆä¿è¯ï¼‰"><a href="#æ€ä¹ˆä¿å­˜ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸€è‡´ï¼ˆæ•°æ®ä¸€è‡´æ€§æ€ä¹ˆä¿è¯ï¼‰" class="headerlink" title="æ€ä¹ˆä¿å­˜ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸€è‡´ï¼ˆæ•°æ®ä¸€è‡´æ€§æ€ä¹ˆä¿è¯ï¼‰"></a>æ€ä¹ˆä¿å­˜ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸€è‡´ï¼ˆæ•°æ®ä¸€è‡´æ€§æ€ä¹ˆä¿è¯ï¼‰</h4><p>å»¶è¿ŸåŒåˆ  + å®šæ—¶åˆ·æ–°</p><p>ç­–ç•¥</p><ul><li>1ã€æ•°æ®åº“ä¸­æ•°æ®ä¸­å…¨é‡åˆ·å†™åˆ°ç¼“å­˜ä¸­ï¼Œä¸è®¾ç½®å¤±æ•ˆæ—¶é—´ + å®šæ—¶ä»»åŠ¡</li><li>2ã€ä¿ç•™çƒ­æ•°æ®</li></ul><p>æ—è·¯ç¼“å­˜æ¨¡å¼ + ä¿è¯åˆ é™¤æ“ä½œéå¼‚å¸¸æ‰§è¡Œï¼ˆMQå¼‚æ­¥ + è®¢é˜…æ—¥å¿—æœºåˆ¶ï¼‰</p><p>æ€è€ƒï¼š</p><ul><li>ä¸€æ—¦æˆ‘ä»¬å†³å®šä½¿ç”¨ç¼“å­˜ï¼Œé‚£å¿…ç„¶è¦é¢ä¸´ä¸€è‡´æ€§é—®é¢˜ã€‚æ€§èƒ½å’Œä¸€è‡´æ€§å°±åƒå¤©å¹³çš„ä¸¤ç«¯ï¼Œæ— æ³•åšåˆ°éƒ½æ»¡è¶³è¦æ±‚ã€‚</li><li>æ—¢ç„¶å†³å®šä½¿ç”¨ç¼“å­˜ï¼Œå°±å¿…é¡»å®¹å¿ã€Œä¸€è‡´æ€§ã€é—®é¢˜ï¼Œæˆ‘ä»¬åªèƒ½å°½å¯èƒ½åœ°å»é™ä½é—®é¢˜å‡ºç°çš„æ¦‚ç‡ã€‚</li></ul><blockquote><p>ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´</p></blockquote><p>ä¸€èˆ¬æ˜¯é‡‡ç”¨ï¼šCache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰: é‡åˆ°å†™è¯·æ±‚çš„æ—¶å€™æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ cache</p><p>è¿™ç§æƒ…å†µä¸‹å‘ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µæ¯”è¾ƒå°ï¼Œ</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨æ•°æ®åº“æ›´æ–°å’Œç¼“å­˜åˆ é™¤ä¹‹é—´æœ‰è¯»å–è¯·æ±‚ï¼Œå®ƒä¹Ÿåªä¼šè¯»åˆ°æ—§çš„æ•°æ®ï¼Œä¸€æ—¦ç¼“å­˜è¢«åˆ é™¤ï¼Œä¸‹ä¸€ä¸ªè¯»å–è¯·æ±‚å°†ä»æ•°æ®åº“ä¸­è·å–æœ€æ–°çš„æ•°æ®ï¼Œå¹¶æ›´æ–°ç¼“å­˜ï¼Œä»è€Œä¿æŒäº†ä¸€è‡´æ€§ã€‚</p><p>éœ€è¦é¿å…ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´éœ€è¦è€ƒè™‘çš„ç‚¹ï¼šé¿å…ç¬¬äºŒæ­¥æ“ä½œã€åˆ é™¤ cacheã€‘å¤±è´¥</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ç¼“å­˜å¤±æ•ˆæ—¶é—´å˜çŸ­ï¼ˆä¸æ¨èï¼Œæ²»æ ‡ä¸æ²»æœ¬ï¼‰<ol><li>æˆ‘ä»¬è®©ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´å˜çŸ­ï¼Œè¿™æ ·çš„è¯ç¼“å­˜å°±ä¼šä»æ•°æ®åº“ä¸­åŠ è½½æ•°æ®ã€‚</li></ol></li><li>å¢åŠ  cache æ›´æ–°é‡è¯•æœºåˆ¶ï¼ˆå¸¸ç”¨ï¼‰<ol><li>å¦‚æœ cache æœåŠ¡å½“å‰ä¸å¯ç”¨å¯¼è‡´ç¼“å­˜åˆ é™¤å¤±è´¥çš„è¯ï¼Œæˆ‘ä»¬å°±éš”ä¸€æ®µæ—¶é—´è¿›è¡Œé‡è¯•ï¼Œ</li><li>é‡è¯•æ¬¡æ•°å¯ä»¥è‡ªå·±å®šã€‚å¦‚æœå¤šæ¬¡é‡è¯•è¿˜æ˜¯å¤±è´¥çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå½“å‰æ›´æ–°å¤±è´¥çš„ key å­˜å…¥é˜Ÿåˆ—ä¸­ï¼Œç­‰ç¼“å­˜æœåŠ¡å¯ç”¨ä¹‹åï¼Œå†å°†ç¼“å­˜ä¸­å¯¹åº”çš„ key åˆ é™¤å³å¯ã€‚</li></ol></li></ol><blockquote><p>ç¬¬äºŒç§æ–¹å¼é‡‡ç”¨æ–¹æ¡ˆï¼š</p></blockquote><ol><li>å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—æ¥è¿›è¡Œå¼‚æ­¥é‡è¯•æ“ä½œï¼ˆå°†åˆ é™¤ cache æ“ä½œæ”¾åœ¨æ¶ˆè´¹è€…è¿™æ­¥æ“ä½œï¼‰ </li><li>è®¢é˜…æ•°æ®åº“å˜æ›´æ—¥å¿—ï¼Œå†æ“ä½œç¼“å­˜</li></ol><hr><p>å½“ç¼“å­˜æ“ä½œå¤±è´¥æ—¶ï¼Œé€šè¿‡è®¾ç½®é‡è¯•æœºåˆ¶æ¥ç¡®ä¿ç¼“å­˜æœ€ç»ˆèƒ½å¤Ÿä¸æ•°æ®åº“æ•°æ®ä¿æŒä¸€è‡´ã€‚å…·ä½“æ­¥éª¤åŒ…æ‹¬ï¼š</p><p>A. <strong>ç›´æ¥é‡è¯•</strong></p><p>åœ¨ç¼“å­˜æ“ä½œï¼ˆå¦‚åˆ é™¤ã€æ›´æ–°ï¼‰å¤±è´¥æ—¶ï¼Œç«‹å³è¿›è¡Œé‡è¯•ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé¿å…æ— é™é‡è¯•ã€‚</p><p>B. <strong>å»¶æ—¶é‡è¯•</strong></p><p>å¦‚æœç›´æ¥é‡è¯•ä»ç„¶å¤±è´¥ï¼Œå¯ä»¥å°†å¤±è´¥çš„æ“ä½œå»¶æ—¶ä¸€æ®µæ—¶é—´åå†é‡è¯•ï¼Œå»¶æ—¶é‡è¯•å¯ä»¥é€šè¿‡å®šæ—¶ä»»åŠ¡æˆ–å»¶æ—¶é˜Ÿåˆ—å®ç°ã€‚</p><p>C. <strong>å¤±è´¥é˜Ÿåˆ—</strong></p><p>å¦‚æœé‡è¯•å¤šæ¬¡åä»ç„¶å¤±è´¥ï¼Œå°†æ›´æ–°å¤±è´¥çš„keyå­˜å…¥ä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—ä¸­ã€‚ç­‰åˆ°ç¼“å­˜æœåŠ¡æ¢å¤æ­£å¸¸åï¼Œå†ç»Ÿä¸€å¤„ç†è¿™äº›å¤±è´¥çš„æ“ä½œã€‚</p><blockquote><p>å…·ä½“å®æ–½æ–¹æ¡ˆ</p></blockquote><p>å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¼‚æ­¥é‡è¯•ï¼‰</p><ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯å¯é æ€§</strong>ï¼šå†™åˆ°é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼ŒæˆåŠŸæ¶ˆè´¹ä¹‹å‰ä¸ä¼šä¸¢å¤±ï¼ˆé‡å¯é¡¹ç›®ä¹Ÿä¸æ‹…å¿ƒï¼‰</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯æ¶ˆæ¯æˆåŠŸæŠ•é€’</strong>ï¼šä¸‹æ¸¸ä»é˜Ÿåˆ—æ‹‰å–æ¶ˆæ¯ï¼ŒæˆåŠŸæ¶ˆè´¹åæ‰ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œå¦åˆ™è¿˜ä¼šç»§ç»­æŠ•é€’æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼ˆç¬¦åˆæˆ‘ä»¬é‡è¯•çš„åœºæ™¯ï¼‰</li></ul><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºå¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œ<strong>å°†éœ€è¦æ›´æ–°æˆ–åˆ é™¤çš„ç¼“å­˜æ“ä½œ</strong>ä½œä¸ºæ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œç”±æ¶ˆè´¹è€…è´Ÿè´£æ‰§è¡Œå®é™…çš„ç¼“å­˜æ›´æ–°ä»»åŠ¡ã€‚è¿™æ ·å³ä½¿ç¼“å­˜æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œä¹Ÿä¸ä¼šå½±å“ä¸»ä¸šåŠ¡æµç¨‹ï¼Œå¾…ç¼“å­˜æœåŠ¡æ¢å¤åå†é€šè¿‡æ¶ˆè´¹æ¶ˆæ¯æ¥åŒæ­¥ç¼“å­˜ã€‚</p><p>è®¢é˜…æ•°æ®åº“å˜æ›´æ—¥å¿—</p><p>å¦ä¸€ä¸ªé«˜çº§çš„æ–¹æ¡ˆæ˜¯ç›´æ¥è®¢é˜…æ•°æ®åº“çš„å˜æ›´æ—¥å¿—ï¼ˆå¦‚æœæ•°æ®åº“æ”¯æŒï¼‰ï¼Œå¦‚MySQLçš„binlogã€‚é€šè¿‡è§£æå˜æ›´æ—¥å¿—ï¼Œå¯¹ç›¸å…³ç¼“å­˜è¿›è¡Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œã€‚è¿™ç§æ–¹æ³•å¯ä»¥ç¡®ä¿ç¼“å­˜æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä½†å®ç°å¤æ‚ï¼Œå¯¹æ•°æ®åº“å’Œç¼“å­˜ç³»ç»Ÿçš„è¦æ±‚è¾ƒé«˜ã€‚</p><h4 id="æ•°æ®åŒå†™ä¸ä¸€è‡´ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰"><a href="#æ•°æ®åŒå†™ä¸ä¸€è‡´ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰" class="headerlink" title="æ•°æ®åŒå†™ä¸ä¸€è‡´ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰"></a>æ•°æ®åŒå†™ä¸ä¸€è‡´ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317223928.png" alt="image.png"></p><h4 id="è®²ä¸€ä¸‹å»¶è¿ŸåŒåˆ "><a href="#è®²ä¸€ä¸‹å»¶è¿ŸåŒåˆ " class="headerlink" title="è®²ä¸€ä¸‹å»¶è¿ŸåŒåˆ "></a>è®²ä¸€ä¸‹å»¶è¿ŸåŒåˆ </h4><ul><li>å»¶è¿ŸåŒåˆ <ul><li>æ›´æ–°æ•°æ®åº“æ™ºæ…§ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå†æ¬¡åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®</li></ul></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240317223544.png" alt="image.png"></p><h4 id="ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€"></a>ç¼“å­˜é›ªå´©ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜ç©¿é€</h4><ul><li>ç¼“å­˜ç©¿é€<ul><li>ç¼“å­˜ç©¿é€æ˜¯æŒ‡å½“è¯·æ±‚çš„æ•°æ®æ—¢ä¸åœ¨ç¼“å­˜ä¸­ä¹Ÿä¸å­˜åœ¨äºæ•°æ®åº“ä¸­æ—¶ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥åˆ°è¾¾æ•°æ®åº“å±‚çš„ç°è±¡ã€‚</li><li>æˆå› ï¼šé¢‘ç¹æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼ˆå¯èƒ½æ˜¯ç”±äºé”™è¯¯çš„è¾“å…¥æˆ–æ¶æ„æ”»å‡»ï¼‰</li><li>è§£å†³æ–¹æ¡ˆ<ul><li><strong>ç©ºå¯¹è±¡ç¼“å­˜</strong>ï¼ˆç¼“å­˜ç©ºç»“æœï¼‰<ul><li>å³ä½¿æŸä¸ªå€¼åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥åœ¨ç¼“å­˜ä¸­å­˜å‚¨ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå¯¹è±¡æˆ–ç©ºå€¼ï¼Œå¹¶è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ã€‚</li><li>è¿™æ ·ï¼Œç›¸åŒçš„æ— æ•ˆè¯·æ±‚åœ¨è¿™ä¸ªè¿‡æœŸæ—¶é—´å†…ä¼šç›´æ¥å¾—åˆ°ç¼“å­˜ä¸­çš„ç©ºç»“æœï¼Œè€Œä¸ä¼šå†æ¬¡æŸ¥è¯¢æ•°æ®åº“ã€‚</li><li>ç¼ºç‚¹ï¼šå¯èƒ½ä¼šå¯¼è‡´æœŸé—´ä½¿ç”¨å†…å­˜è¾ƒé«˜ï¼Œç¼“å­˜èµ„æºæµªè´¹</li></ul></li></ul></li><li><strong>å¸ƒéš†è¿‡æ»¤å™¨</strong><ul><li>åœ¨æŸ¥è¯¢ä¹‹å‰ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­æ•°æ®æ˜¯å¦å¯èƒ½å­˜åœ¨ã€‚å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ç©ºé—´æ•ˆç‡é«˜ä½†å¯èƒ½æœ‰ä¸€å®šè¯¯åˆ¤ç‡çš„æ•°æ®ç»“æ„ã€‚</li></ul></li></ul></li><li>ç¼“å­˜å‡»ç©¿<ul><li>ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡ç¼“å­˜ä¸­æŸä¸ªçƒ­ç‚¹keyçªç„¶å¤±æ•ˆï¼ˆè¿‡æœŸï¼‰ï¼Œå¯¼è‡´å¤§é‡å¹¶å‘è¯·æ±‚ç›´æ¥è½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…å‹åŠ›å‰§å¢çš„ç°è±¡ã€‚</li><li>ä¸ç¼“å­˜ç©¿é€ä¸åŒï¼Œç¼“å­˜å‡»ç©¿æ˜¯é’ˆå¯¹åŸæœ¬å°±å­˜åœ¨äºç¼“å­˜ä¸­çš„çƒ­ç‚¹æ•°æ®ã€‚</li><li>æˆå› ï¼šçƒ­ç‚¹æ•°æ®åœ¨ç¼“å­˜ä¸­çªç„¶è¿‡æœŸï¼Œè€Œæ­¤æ—¶æ­£æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿™äº›æ•°æ®ã€‚</li><li>è§£å†³æ–¹æ¡ˆ<ul><li><ul><li><strong>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</strong><ul><li>å¯¹äºä¸€äº›çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥è®¾ç½®å…¶ç¼“å­˜æ°¸ä¸è¿‡æœŸï¼Œæˆ–è€…è®¾ç½®ä¸€ä¸ªéå¸¸é•¿çš„è¿‡æœŸæ—¶é—´ï¼Œä»è€Œé¿å…ç¼“å­˜å‡»ç©¿é—®é¢˜ã€‚</li><li>ä½†è¿™ç§æ–¹æ³•éœ€è¦å®šæœŸæ‰‹åŠ¨æˆ–é€šè¿‡ç¨‹åºæ›´æ–°ç¼“å­˜ï¼Œä»¥ä¿è¯æ•°æ®çš„æ–°é²œåº¦</li></ul></li></ul></li><li><strong>äº’æ–¥é”</strong><ul><li>åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œä½¿ç”¨äº’æ–¥é”æˆ–åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªè¯·æ±‚å»æ•°æ®åº“æŸ¥è¯¢æ•°æ®å¹¶é‡æ–°ç¼“å­˜ã€‚</li><li>å…¶ä»–è¯·æ±‚ç­‰å¾…ç¼“å­˜åŠ è½½å®Œæˆåå†è®¿é—®ç¼“å­˜</li></ul></li><li>æå‰é¢„çƒ­<ul><li>åœ¨ç¼“å­˜å³å°†è¿‡æœŸå‰ï¼Œåå°å¼‚æ­¥ç¨‹åºæå‰æ›´æ–°ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿çƒ­ç‚¹æ•°æ®åœ¨ç¼“å­˜ä¸­å§‹ç»ˆæ˜¯å¯ç”¨çš„</li></ul></li><li><strong>äºŒçº§ç¼“å­˜ç­–ç•¥</strong><ul><li>ä¸ºçƒ­ç‚¹æ•°æ®è®¾ç½®ä¸¤çº§ç¼“å­˜ï¼Œç¬¬ä¸€çº§ç¼“å­˜æ­£å¸¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼›ç¬¬äºŒçº§ç¼“å­˜è®¾ç½®è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ã€‚å½“ç¬¬ä¸€çº§ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œè¯·æ±‚å¯ä»¥è®¿é—®ç¬¬äºŒçº§ç¼“å­˜ï¼ŒåŒæ—¶å¼‚æ­¥æ›´æ–°ç¬¬ä¸€çº§ç¼“å­˜å’Œç¬¬äºŒçº§ç¼“å­˜æ•°æ®ã€‚</li></ul></li></ul></li></ul></li><li>ç¼“å­˜é›ªå´©<ul><li>ç¼“å­˜é›ªå´©æ˜¯æŒ‡ç¼“å­˜ä¸­<strong>å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸ</strong>ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯èƒ½ä¼šä½¿æ•°æ®åº“å‹åŠ›è¿‡å¤§ç”šè‡³å´©æºƒã€‚</li><li>æˆå› <ul><li>ç¼“å­˜è®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸã€‚</li><li>ç¼“å­˜æœåŠ¡å´©æºƒï¼Œæ‰€æœ‰æ•°æ®ä¸¢å¤±ã€‚</li></ul></li><li>è§£å†³æ–¹æ¡ˆ<ul><li><strong>ä¸åŒçš„è¿‡æœŸæ—¶é—´</strong>ï¼šä¸ºç¼“å­˜æ•°æ®è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…åŒæ—¶è¿‡æœŸã€‚ï¼ˆå¯ä»¥åœ¨è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´æ—¶åŠ å…¥éšæœºå€¼ï¼‰</li><li><strong>ç¼“å­˜æ•°æ®é¢„çƒ­</strong>ï¼šç³»ç»Ÿå¯åŠ¨æ—¶é¢„å…ˆåŠ è½½çƒ­ç‚¹æ•°æ®åˆ°ç¼“å­˜ä¸­ã€‚</li><li>é™æµé™çº§ï¼šåœ¨ç³»ç»Ÿå…¥å£å¤„ä½¿ç”¨é™æµé™çº§ç­–ç•¥ï¼Œé¿å…åœ¨ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œçªå‘æµé‡ç›´æ¥æ‰“åˆ°æ•°æ®åº“ã€‚</li><li>ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥</li><li><strong>ä½¿ç”¨é«˜å¯ç”¨çš„ç¼“å­˜æ¶æ„</strong>ï¼šæ¯”å¦‚ä½¿ç”¨Redisé›†ç¾¤ï¼Œæé«˜ç¼“å­˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®¹é”™èƒ½åŠ›ã€‚</li></ul></li></ul></li></ul><p>æ€»ç»“ä¸€ä¸‹ä¸Šé¢çš„ä¸‰ä¸ªå¸¸è§çš„ç”Ÿäº§é—®é¢˜ï¼šç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©ï¼›</p><ul><li>1ã€ç¼“å­˜ç©¿é€æŒ‡çš„ä¸å­˜åœ¨çš„æ•°æ®è¿›è¡Œè®¿é—®ç¼“å­˜ï¼Œå¹¶æ‰“åˆ°æ•°æ®åº“ä¸­ï¼Œè§£å†³æ–¹æ¡ˆä¸€èˆ¬æœ‰ï¼šç©ºå¯¹è±¡ç¼“å­˜ã€å¸ƒéš†è¿‡æ»¤å™¨</li><li>2ã€ç¼“å­˜å‡»ç©¿å’Œç¼“å­˜é›ªå´©æœ‰ç‚¹åƒï¼Œéƒ½æ˜¯ç¼“å­˜å¤±æ•ˆï¼Œä½†å‰è€…ä¸€èˆ¬æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œåè€…æ˜¯å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸï¼›<ul><li>çƒ­ç‚¹æ•°æ®å»ºè®®åšä¸€ä¸‹é¢„çƒ­å¤„ç†ï¼Œåœ¨å¿«è¦è¿‡æœŸçš„æ—¶å€™è¿›è¡Œå¤„ç†ä¸€ä¸‹ï¼›æˆ–è€…è¯´å¸¸ç”¨çš„ä¸¤ç§å¤„ç†æ–¹æ¡ˆï¼š<ul><li>è®¾ç½®çƒ­ç‚¹æ•°æ®ä¸è¿‡æœŸï¼Œä¸è¿‡åç»­éœ€è¦æ‰‹åŠ¨è¿›è¡Œæ›´æ–°ç¼“å­˜æˆ–è€…ç¨‹åºæ›´æ–°</li><li>è®¾ç½®äº’æ–¥é”ï¼Œä¿è¯åŒä¸€æ—¶åˆ»è®¿é—®ç¼“å­˜çš„æ•°æ®ï¼ˆç¼“å­˜ä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼‰ï¼Œæ­¤æ—¶åªæœ‰ä¸€ä¸ª</li></ul></li><li>å¤§é‡æ•°æ®è¿‡æœŸå»ºè®®ä½¿ç”¨éšæœºè¿‡æœŸæ—¶é—´ï¼ŒåŒæ—¶å¯ä»¥è®¾ç½®ä¸€ä¸‹é™æµï¼Œé˜²æ­¢å¤§é‡æ•°æ®åŒæ—¶è¯·æ±‚ï¼›ä¹Ÿå¯ä»¥è®¾ç½®å¤šçº§çš„ä¸€ä¸ªç¼“å­˜ç­–ç•¥æ“ä½œã€‚</li></ul></li></ul><h4 id="Redisåˆ†å¸ƒå¼é”å®ç°-ğŸš©"><a href="#Redisåˆ†å¸ƒå¼é”å®ç°-ğŸš©" class="headerlink" title="Redisåˆ†å¸ƒå¼é”å®ç° ğŸš©"></a>Redisåˆ†å¸ƒå¼é”å®ç° ğŸš©</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312113112.png" alt="image.png"></p><p>ä½¿ç”¨ Redis å¯ä»¥å®ç°åˆ†å¸ƒå¼æƒ…å†µä¸‹å¯¹è®¿é—®èµ„æºè¿›è¡ŒåŠ é”</p><ul><li>1ã€é€šè¿‡ setnx å‘½ä»¤è¿›è¡ŒåŠ é”</li><li>2ã€æ˜¯å¦é”é€šè¿‡ del å‘½ä»¤åˆ é™¤å¯¹åº”çš„key<ul><li>ä¸ºäº†é˜²æ­¢è¯¯åˆ åˆ°å…¶ä»–çš„é”ï¼Œè¿™é‡Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ Lua è„šæœ¬é€šè¿‡ key å¯¹åº”çš„ valueï¼ˆå”¯ä¸€å€¼ï¼‰æ¥åˆ¤æ–­ã€‚</li><li>é€‰ç”¨ Lua è„šæœ¬æ˜¯ä¸ºäº†ä¿è¯è§£é”æ“ä½œçš„åŸå­æ€§ã€‚å› ä¸º Redis åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼Œå¯ä»¥ä»¥åŸå­æ€§çš„æ–¹å¼æ‰§è¡Œï¼Œä»è€Œä¿è¯äº†é”é‡Šæ”¾æ“ä½œçš„åŸå­æ€§</li></ul></li><li>3ã€ä¼˜åŒ–é¡¹<ul><li>è€ƒè™‘ä¸ºäº†é¿å…é”æ— æ³•é‡Šæ”¾ï¼Œä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯ï¼šç»™è¿™ä¸ªé”åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´</li><li><strong>ä¸€å®šè¦ä¿è¯è®¾ç½®æŒ‡å®š key çš„å€¼å’Œè¿‡æœŸæ—¶é—´æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼ï¼ï¼</strong>Â ä¸ç„¶çš„è¯ï¼Œä¾ç„¶å¯èƒ½ä¼šå‡ºç°é”æ— æ³•è¢«é‡Šæ”¾çš„é—®é¢˜ã€‚</li><li>å› ä¸ºè¿™ä¸ªå¼•å…¥äº†ç°æˆçš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šRedission</li></ul></li><li>4ã€Redission<ul><li>Redisson ä¸­çš„åˆ†å¸ƒå¼é”è‡ªå¸¦è‡ªåŠ¨ç»­æœŸæœºåˆ¶ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼ŒåŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå…¶æä¾›äº†ä¸€ä¸ªä¸“é—¨ç”¨æ¥ç›‘æ§å’Œç»­æœŸé”çš„ <strong>Watch Dogï¼ˆ çœ‹é—¨ç‹—ï¼‰</strong>ï¼Œå¦‚æœæ“ä½œå…±äº«èµ„æºçš„çº¿ç¨‹è¿˜æœªæ‰§è¡Œå®Œæˆçš„è¯ï¼ŒWatch Dog ä¼šä¸æ–­åœ°å»¶é•¿é”çš„è¿‡æœŸæ—¶é—´ï¼Œè¿›è€Œä¿è¯é”ä¸ä¼šå› ä¸ºè¶…æ—¶è€Œè¢«é‡Šæ”¾ã€‚</li></ul></li><li>5ã€å¦‚ä½•å®ç°å¯é‡å…¥é”ï¼ˆé”é‡Œé¢åˆéœ€è¦è·å–åˆ°å¦å¤–ä¸€ä¸ªéœ€è¦é”çš„æ–¹æ³•ï¼‰<ul><li><strong>ä¸å¯é‡å…¥çš„åˆ†å¸ƒå¼é”åŸºæœ¬å¯ä»¥æ»¡è¶³ç»å¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯äº†ï¼Œä¸€äº›ç‰¹æ®Šçš„åœºæ™¯å¯èƒ½ä¼šéœ€è¦ä½¿ç”¨å¯é‡å…¥çš„åˆ†å¸ƒå¼é”</strong></li><li>å®é™…å®ç°ä¸­ï¼ŒRedission æ˜¯æä¾›äº†å®ç°æ–¹æ¡ˆçš„<ul><li><strong>Redisson</strong> ï¼Œå†…ç½®äº†å¤šç§ç±»å‹çš„é”æ¯”å¦‚å¯é‡å…¥é”ï¼ˆReentrant Lockï¼‰ã€è‡ªæ—‹é”ï¼ˆSpin Lockï¼‰ã€å…¬å¹³é”ï¼ˆFair Lockï¼‰ã€å¤šé‡é”ï¼ˆMultiLockï¼‰ã€ çº¢é”ï¼ˆRedLockï¼‰ã€ è¯»å†™é”ï¼ˆReadWriteLockï¼‰ã€‚</li></ul></li></ul></li></ul><p>åœ¨é¢å¯¹é«˜å¹¶å‘çš„åº“å­˜æ‰£å‡é—®é¢˜æ—¶ï¼Œé™¤äº†ä½¿ç”¨Redisåˆ†å¸ƒå¼é”å¤–ï¼Œè¿˜å¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸€äº›ç­–ç•¥ï¼š</p><ol><li><strong>ä¹è§‚é”</strong>ï¼šåœ¨æ•°æ®è¡¨ä¸­ä½¿ç”¨ç‰ˆæœ¬å·ï¼ˆæˆ–æ—¶é—´æˆ³ï¼‰å­—æ®µï¼Œæ¯æ¬¡æ›´æ–°æ—¶æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™æ›´æ–°å¹¶å¢åŠ ç‰ˆæœ¬å·ã€‚è¿™ç§æ–¹å¼å‡å°‘äº†é”çš„ä½¿ç”¨ï¼Œä½†åœ¨é«˜å†²çªç¯å¢ƒä¸‹å¯èƒ½å¯¼è‡´å¤§é‡çš„é‡è¯•ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼šå°†åº“å­˜æ‰£å‡æ“ä½œå¼‚æ­¥åŒ–ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ¥æ§åˆ¶å¯¹åº“å­˜çš„æ“ä½œåºåˆ—ã€‚è¿™æ ·å¯ä»¥å¹³æ»‘é«˜å³°æœŸçš„è¯·æ±‚ï¼Œä½†éœ€è¦å¤„ç†å¥½æ¶ˆæ¯çš„å¯é æ€§å’Œæ¶ˆè´¹é¡ºåºã€‚</li><li><strong>ä»¤ç‰Œæ¡¶æˆ–æ¼æ–—ç®—æ³•</strong>ï¼šé€šè¿‡é™æµç®—æ³•æ§åˆ¶å¯¹åº“å­˜æ“ä½œçš„å¹¶å‘é‡ï¼Œä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</li><li><strong>åˆ†æ®µé”</strong>ï¼šå¦‚æœåº“å­˜æ•°æ®å¯ä»¥åˆ†æ®µï¼ˆä¾‹å¦‚ä¸åŒçš„å•†å“æˆ–ä»“åº“ï¼‰ï¼Œå¯ä»¥å¯¹æ¯ä¸€æ®µä½¿ç”¨ç‹¬ç«‹çš„é”æˆ–Redis keyï¼Œä»è€Œå‡å°‘é”çš„ç«äº‰ã€‚</li><li><strong>é¢„æ‰£å‡ä¸è¡¥å¿æœºåˆ¶</strong>ï¼šåœ¨ç”¨æˆ·ä¸‹å•æ—¶å…ˆè¿›è¡Œåº“å­˜é¢„æ‰£å‡ï¼Œç„¶åå¼‚æ­¥å¤„ç†è®¢å•ï¼Œå¦‚æœè®¢å•å¤„ç†å¤±è´¥åˆ™è¿›è¡Œåº“å­˜è¡¥å¿ã€‚è¿™ç§æ–¹å¼å¯ä»¥å¿«é€Ÿå“åº”ç”¨æˆ·è¯·æ±‚ï¼Œä½†éœ€è¦å¤„ç†å¥½è¡¥å¿é€»è¾‘ã€‚</li></ol><h4 id="å¤§-Key-é—®é¢˜"><a href="#å¤§-Key-é—®é¢˜" class="headerlink" title="å¤§ Key é—®é¢˜"></a>å¤§ Key é—®é¢˜</h4><blockquote><p>é‡åˆ°è¿‡å¤§ Key é—®é¢˜å—ï¼Œè¯´ä¸€ä¸‹å½“æ—¶é‡åˆ°çš„åœºæ™¯ï¼Œä»¥åŠå½“æ—¶æ˜¯æ€ä¹ˆå¤„ç†çš„</p></blockquote><p>å‚è€ƒï¼š <a href="https://www.bilibili.com/video/BV1iu411v7fp">https://www.bilibili.com/video/BV1iu411v7fp</a></p><p>ä»€ä¹ˆæ˜¯å¤§ Keyï¼š</p><p>string ç±»å‹çš„å€¼å¤§äº 10 kb</p><p>hashã€Iistã€setã€Zsetå…ƒç´ ä¸ªæ•°è¶…è¿‡ 5000 ä¸ª</p><p>å¦‚ä½•æ‰¾åˆ° å¤§ Key</p><ul><li>redis -cli -h 127.0.0.1  -p6379 -a â€œpasswordâ€ â€“ bigkeys</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240511112841.png" alt="image.png"></p><p>å¦‚ä½•åˆ é™¤ å¤§ Key</p><ul><li>ç›´æ¥åˆ é™¤å¤§keyä¼šé€ æˆé˜»å¡ï¼Œå› ä¸ºredisæ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œé˜»å¡æœŸé—´ï¼Œå…¶ä»–æ‰€æœ‰è¯·æ±‚å¯èƒ½éƒ½ä¼šè¶…æ—¶ã€‚è¶…æ—¶è¶Šæ¥è¶Šå¤šï¼Œä¼šé€ æˆ redis è¿æ¥ä¼šè€—å°½ï¼Œäº§ç”Ÿå„ç§å¼‚å¸¸</li><li>ä½å³°æœŸåˆ é™¤ï¼šå‡Œæ™¨ï¼Œè§‚å¯Ÿ qps ,é€‰æ‹©ä½çš„æ—¶å€™ï¼Œæ— æ³•å½»åº•è§£å†³é˜»å¡</li><li>åˆ†æ‰¹æ¬¡åˆ é™¤ï¼šå¯¹äºhash,ä½¿ç”¨ hscan æ‰«ææ³•ï¼Œå¯¹äºé›†åˆé‡‡ç”¨ srandmember  æ¯æ¬¡éšæœºå–æ•°æ®è¿›è¡Œåˆ é™¤ã€‚å¯¹äºæœ‰åºé›†å°å¯ä»¥ä½¿ç”¨ zremrangebyrank ç›´æ¥åˆ é™¤ï¼Œå¯¹äºåˆ—è¡¨ç›´æ¥popå³å¯ã€‚</li><li>å¼‚æ­¥åˆ é™¤æ³•ï¼šç”¨ unlink ä»£æ›¿delæ¥åˆ é™¤ï¼Œè¿™æ ·redisä¼šå°†è¿™ä¸ªkey æ”¾å…¥åˆ°ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹ä¸­ï¼Œè¿›è¡Œåˆ é™¤ï¼Œè¿™æ ·ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</li></ul><hr><p>å‚è€ƒï¼š <a href="https://www.bilibili.com/video/BV1m54y1f74X">https://www.bilibili.com/video/BV1m54y1f74X</a></p><p>å¤§ Key ä¸€èˆ¬ä¼šé€ æˆå®¢æˆ·ç«¯é˜»å¡ï¼Œé€ æˆæŸ¥è¯¢å¤±è´¥ã€ç½‘ç»œé˜»å¡ç­‰ç°è±¡ï¼›</p><p>ä¸€èˆ¬è¯´è¿™ä¸ªé€šè¿‡  é—®é¢˜åé¦ˆ â†’  é—®é¢˜æ’æŸ¥  â†’  é—®é¢˜è§£å†³</p><p>å‘ç°äº† å¤§ key é—®é¢˜ï¼Œä¸€èˆ¬éœ€è¦é€æ­¥è¿›è¡Œåˆ é™¤æ“ä½œï¼Œé¿å…å½±å“å…¶ä»–ä¸šåŠ¡æœåŠ¡</p><p>åˆ é™¤åï¼Œè€ƒè™‘å¦‚ä½•å¯¹ redis çš„å¤§ key è¿›è¡Œè®¾è®¡å’Œä¼˜åŒ–</p><h3 id="å¸¸è§é¢è¯•é¢˜"><a href="#å¸¸è§é¢è¯•é¢˜" class="headerlink" title="å¸¸è§é¢è¯•é¢˜"></a>å¸¸è§é¢è¯•é¢˜</h3><h4 id="Redis-é»˜è®¤åˆ†å¤šå°‘ä¸ªæ•°æ®åº“"><a href="#Redis-é»˜è®¤åˆ†å¤šå°‘ä¸ªæ•°æ®åº“" class="headerlink" title="Redis é»˜è®¤åˆ†å¤šå°‘ä¸ªæ•°æ®åº“"></a>Redis é»˜è®¤åˆ†å¤šå°‘ä¸ªæ•°æ®åº“</h4><p>16 ä¸ª</p><h4 id="è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ—è·¯ç¼“å­˜ï¼Œä½¿ç”¨å…¶ä»–çš„ç¼“å­˜è¯»å†™ç­–ç•¥æœ‰ä»€ä¹ˆé—®é¢˜"><a href="#è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ—è·¯ç¼“å­˜ï¼Œä½¿ç”¨å…¶ä»–çš„ç¼“å­˜è¯»å†™ç­–ç•¥æœ‰ä»€ä¹ˆé—®é¢˜" class="headerlink" title="è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ—è·¯ç¼“å­˜ï¼Œä½¿ç”¨å…¶ä»–çš„ç¼“å­˜è¯»å†™ç­–ç•¥æœ‰ä»€ä¹ˆé—®é¢˜"></a>è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ—è·¯ç¼“å­˜ï¼Œä½¿ç”¨å…¶ä»–çš„ç¼“å­˜è¯»å†™ç­–ç•¥æœ‰ä»€ä¹ˆé—®é¢˜</h4>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_MySQL</title>
    <link href="/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_MySQL/"/>
    <url>/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_MySQL/</url>
    
    <content type="html"><![CDATA[<h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313172759.png" alt="image.png"></p><h3 id="ä¼˜åŒ–-ç´¢å¼•"><a href="#ä¼˜åŒ–-ç´¢å¼•" class="headerlink" title="ä¼˜åŒ–&#x2F;ç´¢å¼•"></a>ä¼˜åŒ–&#x2F;ç´¢å¼•</h3><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313164115.png" alt="image.png"></p><h4 id="åœ¨-MySQL-ä¸­ï¼Œå¦‚ä½•å®šä½æ…¢æŸ¥è¯¢ï¼Ÿ"><a href="#åœ¨-MySQL-ä¸­ï¼Œå¦‚ä½•å®šä½æ…¢æŸ¥è¯¢ï¼Ÿ" class="headerlink" title="åœ¨ MySQL ä¸­ï¼Œå¦‚ä½•å®šä½æ…¢æŸ¥è¯¢ï¼Ÿ"></a>åœ¨ MySQL ä¸­ï¼Œå¦‚ä½•å®šä½æ…¢æŸ¥è¯¢ï¼Ÿ</h4><ul><li>èšåˆæŸ¥è¯¢</li><li>å¤šè¡¨æŸ¥è¯¢</li><li>è¡¨æ•°æ®é‡è¿‡å¤§æŸ¥è¯¢</li><li>æ·±åº¦åˆ†é¡µæŸ¥è¯¢</li></ul><p>è¡¨è±¡ï¼šé¡µé¢åŠ è½½è¿‡æ…¢ã€æ¥å£å‹æµ‹å“åº”æ—¶é—´è¿‡é•¿ï¼ˆè¶…è¿‡ 1s ï¼‰</p><p>æ–¹æ¡ˆä¸€ã€å¼€æºå·¥å…·</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204256.png" alt="image.png"></p><p>æ–¹æ¡ˆäºŒï¼š MySQL è‡ªå¸¦æ…¢æ—¥å¿—</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204349.png" alt="image.png"></p><p>æ€»ç»“ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204413.png" alt="image.png"></p><p>ï¼ˆç”Ÿäº§é˜¶æ®µä¸€èˆ¬ä¸å¼€å¯æ…¢æ—¥å¿—æŸ¥è¯¢ï¼‰</p><p>å¼€æºé‡‡ç”¨ EXPLAIN æˆ–è€… DESC å‘½ä»¤è·å– MySQL å¦‚ä½•æ‰§è¡Œ SELECT è¯­å¥çš„ä¿¡æ¯</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305205010.png" alt="image.png"></p><p>å‚æ•°ä½¿ç”¨</p><ul><li>possible_key      å½“å‰ sql å¯èƒ½ä¼šä½¿ç”¨åˆ°çš„ç´¢å¼•</li><li>key           å½“å‰ sql å®é™…å‘½ä¸­çš„ç´¢å¼•</li><li>key_len     ç´¢å¼•å ç”¨çš„å¤§å°</li><li>Extra    é¢å¤–çš„ä¼˜åŒ–å»ºè®®</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204719.png" alt="image.png"></p><ul><li>type</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204847.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204938.png" alt="image.png"></p><h4 id="ä»€ä¹ˆæ˜¯ç´¢å¼•-ğŸš©"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•-ğŸš©" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•  ğŸš©"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•  ğŸš©</h4><p>è¿™é‡Œå…ˆè®²ä¸€ä¸‹ MySQL çš„çš„åŸºç¡€ç»“æ„ï¼Œè®²ä¸€ä¸‹ä¼˜åŒ–å™¨çš„é€‰æ‹©ï¼Œå†è®²ä¸€ä¸‹é€‰æ‹©ç´¢å¼•é€‰æ‹©ï¼ˆä¸»é”®ç´¢å¼•å’Œä»è¡¨ç´¢å¼•ï¼‰</p><p>æé«˜è®¿é—®æ•ˆç‡ï¼Œç´¢å¼•æ˜¯æŸç§æ•°æ®ç»“æ„ç»„æˆ</p><p>ç´¢å¼•(index)æ˜¯å¸®åŠ© MySQL é«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ (æœ‰åº) ã€‚</p><p>åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„(B+æ ‘)ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚</p><h4 id="è®²ä¸€ä¸‹ç´¢å¼•çš„åº•å±‚ç»“æ„"><a href="#è®²ä¸€ä¸‹ç´¢å¼•çš„åº•å±‚ç»“æ„" class="headerlink" title="è®²ä¸€ä¸‹ç´¢å¼•çš„åº•å±‚ç»“æ„"></a>è®²ä¸€ä¸‹ç´¢å¼•çš„åº•å±‚ç»“æ„</h4><ul><li>ç›®å‰ç´¢å¼•é‡‡ç”¨çš„åº•å±‚ç»“æ„æ˜¯ B+ æ ‘</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305211546.png" alt="image.png"></p><h4 id="ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼•"><a href="#ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼•" class="headerlink" title="ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼•"></a>ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼•</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305212233.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305212341.png" alt="image.png"></p><p>è®²ä¸€ä¸‹å›è¡¨æŸ¥è¯¢</p><p>å›è¡¨æŸ¥è¯¢ï¼šé€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„ä¸»é”®å€¼</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305212500.png" alt="image.png"></p><blockquote><p>çŸ¥é“ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•å—</p></blockquote><p>å¯¹æŸ¥è¯¢åˆ—æœ‰è¦æ±‚ï¼Œä¸€èˆ¬æ˜¯æŸ¥è¯¢çš„å­—æ®µå’Œç´¢å¼•å­—æ®µç›¸åŒï¼Œä¸åŒèµ°ä¸»é”®æŸ¥è¯¢é‚£æ­¥ï¼Œç›´æ¥ä»ç´¢å¼•æ ‘ä¸ŠæŸ¥è¯¢å‡ºäº†æ•°æ®</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305212622.png" alt="image.png"></p><p>ä½ çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼Œä¸»é”®ç´¢å¼•ä¸­æŸ¥è¯¢æ¡ä»¶æ˜¯ä¸»é”®çš„è¯ï¼Œç›´æ¥æŸ¥è¯¢æ‰€æœ‰æ•°æ®æ˜¯è¯ç®—æ˜¯è¦†ç›–ç´¢å¼•ï¼Œç„¶åå¦‚æœæ˜¯äºŒçº§ç´¢å¼•ï¼ŒæŸ¥è¯¢ ä¸»é”®+ ç´¢å¼• æ˜¯ç®—è¦†ç›–ç´¢å¼•æŸ¥è¯¢(ç´¢å¼•æ ‘ä¸Šç›´æ¥æŸ¥è¯¢)</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305212749.png" alt="image.png"></p><p>è¦†ç›–ç´¢å¼•çš„åŸºæœ¬ä»‹ç»</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305213542.png" alt="image.png"></p><h4 id="MySQL-è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†"><a href="#MySQL-è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†" class="headerlink" title="MySQL è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†"></a>MySQL è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305213731.png" alt="image.png"></p><p>æä¾›ä¸€ç§è§£å†³æ€è·¯ï¼šé€šè¿‡è¦†ç›–ç´¢å¼• + å­æŸ¥è¯¢ å½¢å¼è¿›è¡Œä¼˜åŒ–<br>ã€</p><ul><li>å…ˆé€šè¿‡è¦†ç›–ç´¢å¼•æŸ¥è¯¢å‡ºå¯¹åº”çš„IDï¼Œç„¶åé€šè¿‡å…³è”æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å‡ºåˆ†é¡µæ•°æ®</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305214250.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305214458.png" alt="image.png"></p><h4 id="ç´¢å¼•åˆ›å»ºåŸåˆ™"><a href="#ç´¢å¼•åˆ›å»ºåŸåˆ™" class="headerlink" title="ç´¢å¼•åˆ›å»ºåŸåˆ™"></a>ç´¢å¼•åˆ›å»ºåŸåˆ™</h4><p>å›ç­”æ€è·¯ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305214539.png" alt="image.png"></p><p>ä¸»è¦çš„ä¸€äº›åŸåˆ™ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305214712.png" alt="image.png"></p><p>ç´¢å¼•åˆ›å»ºåŸåˆ™æœ‰å“ªäº›ï¼Ÿ</p><ul><li><ol><li>æ•°æ®é‡è¾ƒå¤§ï¼Œä¸”æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„è¡¨             <strong>é‡è¦</strong></li></ol></li><li>2).å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€æ’åºã€åˆ†ç»„çš„å­—æ®µ         <strong>é‡è¦</strong></li><li>3).å­—æ®µå†…å®¹åŒºåˆ†åº¦é«˜</li><li>4).å†…å®¹è¾ƒé•¿ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•</li><li>5).å°½é‡è”åˆç´¢å¼•                                              <strong>é‡è¦</strong></li><li>6).è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡                                       <strong>é‡è¦</strong></li><li>7).å¦‚æœç´¢å¼•åˆ—ä¸èƒ½å­˜å‚¨NULL å€¼ï¼Œè¯·åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨NOT NULL çº¦æŸå®ƒ</li></ul><h4 id="ç´¢å¼•å¤±æ•ˆ"><a href="#ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆ"></a>ç´¢å¼•å¤±æ•ˆ</h4><p>å¦‚ä½•åˆ¤æ–­ç´¢å¼•æ˜¯å¦å¤±æ•ˆï¼šé€šè¿‡ æ‰§è¡Œè®¡åˆ’ explain</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305222045.png" alt="image.png"></p><p>ç´¢å¼•å¤±æ•ˆçš„ä¸€äº›æƒ…å†µï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305222317.png" alt="image.png"></p><p>ç†è§£å»è®°å¿†ä¸€ä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305222354.png" alt="image.png"></p><h4 id="è°ˆè°ˆä½ å¯¹-SQL-ä¼˜åŒ–çš„ç»éªŒ"><a href="#è°ˆè°ˆä½ å¯¹-SQL-ä¼˜åŒ–çš„ç»éªŒ" class="headerlink" title="è°ˆè°ˆä½ å¯¹ SQL ä¼˜åŒ–çš„ç»éªŒ"></a>è°ˆè°ˆä½ å¯¹ SQL ä¼˜åŒ–çš„ç»éªŒ</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305222506.png" alt="image.png"></p><ul><li>ä¸»ä»å¤åˆ¶ã€è¯»å†™åˆ†ç¦»</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305222712.png" alt="image.png"></p><p>æ€»ç»“ï¼š</p><ul><li>1ã€è¡¨çš„è®¾è®¡ä¼˜åŒ–ï¼Œæ•°æ®ç±»å‹çš„é€‰æ‹©</li><li>2ã€ç´¢å¼•ä¼˜åŒ–ï¼Œç´¢å¼•åˆ›å»ºåŸåˆ™ã€</li><li>3ã€sqlè¯­å¥ä¼˜åŒ–ï¼Œé¿å…ç´¢å¼•å¤±æ•ˆï¼Œé¿å…ä½¿ç”¨select * â€¦.</li><li>4ã€ä¸»ä»å¤åˆ¶ã€è¯»å†™åˆ†ç¦»ï¼Œä¸è®©æ•°æ®çš„å†™å…¥ï¼Œå½±å“è¯»æ“ä½œ</li><li>5ã€åˆ†åº“åˆ†è¡¨</li></ul><h4 id="æœ€å·¦åŒ¹é…åŸåˆ™"><a href="#æœ€å·¦åŒ¹é…åŸåˆ™" class="headerlink" title="æœ€å·¦åŒ¹é…åŸåˆ™"></a>æœ€å·¦åŒ¹é…åŸåˆ™</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313161701.png" alt="image.png"></p><h4 id="ç´¢å¼•ä¸‹æ¨"><a href="#ç´¢å¼•ä¸‹æ¨" class="headerlink" title="ç´¢å¼•ä¸‹æ¨"></a>ç´¢å¼•ä¸‹æ¨</h4><h3 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h3><ul><li>æ‚²è§‚é”</li><li>ä¹è§‚é”   </li><li>è¡¨é”</li><li>è¡Œé”ï¼ˆInnodb å­˜å‚¨å¼•æ“ï¼‰</li></ul><p>æ‚²è§‚é”å®ç°</p><p>å¯ä»¥é€šè¿‡SQLè¯­å¥æ˜¾å¼åœ°å¯¹é€‰å®šçš„è¡Œè¿›è¡Œé”å®šï¼Œç›´åˆ°å½“å‰äº‹åŠ¡ç»“æŸã€‚</p><ul><li><strong>SELECT â€¦ FOR UPDATE</strong>: å¯¹è¯»å–çš„è¡ŒåŠ ä¸Šæ’ä»–é”ï¼ˆXé”ï¼‰ã€‚å…¶ä»–äº‹åŠ¡å°†ä¸èƒ½è¯»å–æˆ–ä¿®æ”¹è¿™äº›è¡Œã€‚</li><li><strong>SELECT â€¦ LOCK IN SHARE MODE</strong>: å¯¹è¯»å–çš„è¡ŒåŠ ä¸Šå…±äº«é”ï¼ˆSé”ï¼‰ã€‚å…¶ä»–äº‹åŠ¡å¯ä»¥è¯»å–ä½†ä¸èƒ½ä¿®æ”¹è¿™äº›è¡Œã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/6b0487b3cd1209dc0a3ee87a09fe6f9.png" alt="6b0487b3cd1209dc0a3ee87a09fe6f9.png"></p><ul><li><p>update æ²¡åŠ ç´¢å¼•ä¼šé”å…¨è¡¨ï¼Ÿ</p></li><li><p><a href="https://xiaolincoding.com/mysql/lock/update_index.html">https://xiaolincoding.com/mysql/lock/update_index.html</a></p></li></ul><h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313164140.png" alt="image.png"></p><h4 id="äº‹åŠ¡çš„ç‰¹æ€§"><a href="#äº‹åŠ¡çš„ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡çš„ç‰¹æ€§"></a>äº‹åŠ¡çš„ç‰¹æ€§</h4><p>äº‹åŠ¡ï¼šäº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»<br>ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><p>ACIDæ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥è¯¦ç»†è¯´ä¸€ä¸‹å—ï¼Ÿ</p><ul><li>åŸå­æ€§(Atomicity):äº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li><li>ä¸€è‡´æ€§(Consistency):äº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚</li><li>éš”ç¦»æ€§(Isolation)ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚</li><li>æŒä¹…æ€§(Durability)ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚</li></ul><p>è®²è¿°è¿™ç§é¢˜ç›®çš„é€‚åˆæœ€å¥½ç»“åˆä¸€ä¸‹å®é™…æ¡ˆä¾‹æ¥è®²è¿°ä¸€ä¸‹ï¼Œè®©é¢è¯•å®˜è§‰å¾—ä½ è®²çš„å’Œå…¶ä»–äººæœ‰æ‰€ä¸åŒ</p><p>ç¤ºä¾‹ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305223200.png" alt="image.png"></p><hr><h4 id="å¹¶å‘äº‹åŠ¡å¸¦æ¥å“ªäº›é—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜å‘¢ï¼ŸMySQL-çš„éš”ç¦»çº§åˆ«æ˜¯ï¼Ÿ"><a href="#å¹¶å‘äº‹åŠ¡å¸¦æ¥å“ªäº›é—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜å‘¢ï¼ŸMySQL-çš„éš”ç¦»çº§åˆ«æ˜¯ï¼Ÿ" class="headerlink" title="å¹¶å‘äº‹åŠ¡å¸¦æ¥å“ªäº›é—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜å‘¢ï¼ŸMySQL çš„éš”ç¦»çº§åˆ«æ˜¯ï¼Ÿ"></a>å¹¶å‘äº‹åŠ¡å¸¦æ¥å“ªäº›é—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜å‘¢ï¼ŸMySQL çš„éš”ç¦»çº§åˆ«æ˜¯ï¼Ÿ</h4><ul><li>å¹¶å‘äº‹åŠ¡é—®é¢˜ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</li><li>éš”ç¦»çº§åˆ«ï¼šè¯»æœªæäº¤ã€è¯»å·²æäº¤ã€å¯é‡å¤è¯»ã€ä¸²è¡ŒåŒ–</li></ul><p>å¹¶å‘äº‹åŠ¡é—®é¢˜</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305223338.png" alt="image.png"></p><p>æ€ä¹ˆè§£å†³å¹¶å‘äº‹åŠ¡çš„é—®é¢˜ï¼Ÿ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305223402.png" alt="image.png"></p><p>æ³¨æ„ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®è¶Šå®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½è¶Šä½ã€‚</p><p>æ€»ç»“ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305223512.png" alt="image.png"></p><h4 id="è§£é‡Šä¸€ä¸‹-MVCC"><a href="#è§£é‡Šä¸€ä¸‹-MVCC" class="headerlink" title="è§£é‡Šä¸€ä¸‹ MVCC"></a>è§£é‡Šä¸€ä¸‹ MVCC</h4><h3 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h3><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313165349.png" alt="image.png"></p><h4 id="undo-log-å’Œ-redo-log-çš„åŒºåˆ«ï¼Ÿ"><a href="#undo-log-å’Œ-redo-log-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="undo log  å’Œ redo log çš„åŒºåˆ«ï¼Ÿ"></a>undo log  å’Œ redo log çš„åŒºåˆ«ï¼Ÿ</h4><p>å…ˆå¼•å…¥ä¸€ä¸ªæ¦‚å¿µï¼šå³ç¼“å­˜æ± å’Œæ•°æ®é¡µï¼Œæ•°æ®é¡µæ˜¯ç£ç›˜ä¸­å®é™…å­˜å‚¨çš„æ•°æ®ï¼Œä½†ä¸€èˆ¬æ•°æ®åŠ è½½çš„æ—¶å€™ä¼šå…ˆä»å†…å­˜ä¸­åˆ°ç£ç›˜ï¼Œè¿™ä¸ªå†…å­˜çš„åŒºåŸŸå«åšç¼“å†²æ± ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305223637.png" alt="image.png"></p><p>æœåŠ¡å®•æœºçš„æ—¶å€™ï¼Œæ•°æ®å¦‚ä½•ä¿è¯ä¸ä¸¢å¤±ï¼Œæ˜¯ç”±äºæ—¥å¿—çš„å­˜åœ¨ã€‚</p><ul><li>redo logï¼š</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305231922.png" alt="image.png"></p><ul><li>undo log</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305232004.png" alt="image.png"></p><p>æ€»ç»“ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305232037.png" alt="image.png"></p><h3 id="é«˜çº§åŠŸèƒ½"><a href="#é«˜çº§åŠŸèƒ½" class="headerlink" title="é«˜çº§åŠŸèƒ½"></a>é«˜çº§åŠŸèƒ½</h3><h4 id="è®²ä¸€ä¸‹-ä¸»ä»åŒæ­¥åŸç†"><a href="#è®²ä¸€ä¸‹-ä¸»ä»åŒæ­¥åŸç†" class="headerlink" title="è®²ä¸€ä¸‹ ä¸»ä»åŒæ­¥åŸç†"></a>è®²ä¸€ä¸‹ ä¸»ä»åŒæ­¥åŸç†</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313171348.png" alt="image.png"></p><h4 id="è®²ä¸€ä¸‹-åˆ†åº“åˆ†è¡¨"><a href="#è®²ä¸€ä¸‹-åˆ†åº“åˆ†è¡¨" class="headerlink" title="è®²ä¸€ä¸‹ åˆ†åº“åˆ†è¡¨"></a>è®²ä¸€ä¸‹ åˆ†åº“åˆ†è¡¨</h4><p>åˆ†è¡¨æ˜¯æŒ‡å°†ä¸€ä¸ªå¤§è¡¨æ‹†åˆ†æˆå¤šä¸ªå°è¡¨çš„è¿‡ç¨‹ã€‚</p><p>è¿™äº›å°è¡¨å¯ä»¥åˆ†å¸ƒåœ¨åŒä¸€ä¸ªæ•°æ®åº“æˆ–å¤šä¸ªæ•°æ®åº“ä¸­ã€‚åˆ†è¡¨é€šå¸¸åŸºäºæŸäº›å…³é”®å­—æ®µè¿›è¡Œï¼Œæ¯”å¦‚æ—¶é—´ã€ç”¨æˆ·IDç­‰ã€‚</p><ul><li><strong>å‚ç›´åˆ†è¡¨</strong>ï¼šå°†è¡¨ä¸­ä¸åŒçš„åˆ—åˆ†åˆ°ä¸åŒçš„è¡¨ä¸­ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·è¡¨å¯ä»¥è¢«åˆ†æˆç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨å’Œç”¨æˆ·è¯¦ç»†ä¿¡æ¯è¡¨ã€‚</li><li><strong>æ°´å¹³åˆ†è¡¨</strong>ï¼šæ ¹æ®è¡Œæ•°æ®å°†è¡¨åˆ†æˆå¤šä¸ªè¡¨ï¼Œæ¯ä¸ªè¡¨åŒ…å«ç›¸åŒçš„åˆ—ï¼Œä½†åªåŒ…å«éƒ¨åˆ†è¡Œã€‚ä¾‹å¦‚ï¼ŒåŸºäºç”¨æˆ·IDèŒƒå›´æˆ–åˆ›å»ºæ—¶é—´è¿›è¡Œåˆ‡åˆ†ã€‚</li></ul><p>åˆ†åº“æ¶‰åŠå°†æ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸Šã€‚æ¯ä¸ªæ•°æ®åº“å®ä¾‹å¯ä»¥æ‰˜ç®¡åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä»è€Œåˆ†æ•£è´Ÿè½½å’Œæé«˜å®¹é”™èƒ½åŠ›ã€‚</p><ul><li><strong>åˆ†å¸ƒå¼æ•°æ®åº“</strong>ï¼šæ•°æ®è¢«åˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªç‰©ç†ä½ç½®ï¼Œæ¯ä¸ªæ•°æ®åº“å®ä¾‹å¯ä»¥ç‹¬ç«‹å¤„ç†æŸ¥è¯¢å’Œäº‹åŠ¡ã€‚</li><li><strong>è¯»å†™åˆ†ç¦»</strong>ï¼šå¸¸ä¸åˆ†åº“ç»“åˆä½¿ç”¨ï¼Œè¯»æ“ä½œå’Œå†™æ“ä½œåˆ†åˆ«åœ¨ä¸åŒçš„æ•°æ®åº“å®ä¾‹ä¸Šè¿›è¡Œã€‚</li></ul><h4 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h4><p>è¯»å†™åˆ†ç¦»æ¶‰åŠå°†æ•°æ®åº“çš„è¯»å–æ“ä½œï¼ˆSELECTæŸ¥è¯¢ï¼‰å’Œå†™å…¥æ“ä½œï¼ˆINSERTã€UPDATEã€DELETEï¼‰åˆ†ç¦»åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313170248.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313170226.png" alt="image.png"></p>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_Javaé›†åˆ</title>
    <link href="/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_Java%E9%9B%86%E5%90%88/"/>
    <url>/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_Java%E9%9B%86%E5%90%88/</url>
    
    <content type="html"><![CDATA[<ul><li>1ã€è®²ä¸€ä¸‹ArrayList çš„åº•å±‚åŸç†</li><li>2ã€æ•°ç»„å’Œé›†åˆä¹‹é—´å¦‚ä½•è½¬æ¢</li><li>3ã€ArrayList å’Œ LinkedList ä¹‹é—´çš„åŒºåˆ«</li><li>4ã€è¯´ä¸€ä¸‹ HashMap çš„åº•å±‚å®ç°åŸç†</li><li>5ã€è®²è¿°ä¸€ä¸‹ HashMap çš„ put æ–¹æ³•çš„å…·ä½“æµç¨‹</li><li>6ã€è®²ä¸€è®² HashMap çš„æ‰©å®¹æœºåˆ¶</li><li>7ã€HashMap çš„å¯»å€ç®—æ³•å’Œæ•°ç»„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2 çš„ n æ¬¡å¹‚</li><li>8ã€HashMap åœ¨ 1.7 æƒ…å†µä¸‹çš„å¤šçº¿ç¨‹æ­»å¾ªç¯é—®é¢˜å¦‚ä½•è§£å†³ï¼ˆäº†è§£ï¼‰</li></ul><h3 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h3><h4 id="é›†åˆå¼•â¼Š"><a href="#é›†åˆå¼•â¼Š" class="headerlink" title="é›†åˆå¼•â¼Š"></a>é›†åˆå¼•â¼Š</h4><ul><li>æ¦‚å¿µå‰æ<ul><li>ArrayListçš„æ•°ç»„é»˜è®¤â»“åº¦10ï¼Œ1.5å€æ•°ç»„æ‰©å®¹ï¼Œæ‰©å®¹é€šè¿‡å¼€è¾Ÿæ–°æ•° ç»„è¿›â¾è½¬ç§»â½¼æ•°ç»„å…ƒç´ </li><li>HashMapã€ConcurrentHashMapçš„æ•°ç»„é»˜è®¤â»“åº¦16ï¼Œ2å€æ•°ç»„æ‰© å®¹ï¼Œæ‰©å®¹é€šè¿‡å¼€è¾Ÿæ–°æ•°ç»„è¿›â¾è½¬ç§»â½¼æ•°ç»„å…ƒç´ </li></ul></li><li>æ ¸â¼¼æ€æƒ³<ul><li>è¯»å†™åˆ†ç¦»<ul><li>CopyOnWriteArrayListåº•å±‚å®ç°ã€å¤„ç†å¿«é€Ÿå¤±è´¥</li></ul></li><li>åˆ†æ•£çƒ­ç‚¹<ul><li>ConcurrentHashMapåº•å±‚addCountè®¡ç®—</li></ul></li><li>ç´¢å¼•ä¼˜åŒ–<ul><li>HashMap&#x2F;ConcurrentHashMap ä»æ•°ç»„-&gt;é“¾è¡¨-&gt;çº¢â¿Šæ ‘</li></ul></li></ul></li><li>è€ƒå¯Ÿé‡ç‚¹<ul><li>é›†åˆåº•å±‚å®ç°ä»¥åŠè®¾è®¡æ€æƒ³</li></ul></li><li>æ³¨æ„ç‚¹<ul><li>å¯¹äºå­˜æ”¾â¼¤é‡å…ƒç´ åˆ°ArrayList æˆ– HashMapä¸­æ—¶ï¼Œå»ºè®®æå‰åˆå§‹åŒ– å¥½å®¹é‡é¿å…æ‰©å®¹å¯¼è‡´æ€§èƒ½æŸè€—</li></ul></li></ul><h4 id="å¿«é€Ÿå¤±è´¥-fast-fail"><a href="#å¿«é€Ÿå¤±è´¥-fast-fail" class="headerlink" title="å¿«é€Ÿå¤±è´¥(fast fail)"></a>å¿«é€Ÿå¤±è´¥(fast fail)</h4><ul><li>å¿«é€Ÿå¤±è´¥æ˜¯JavaåŸºäºå¤šçº¿ç¨‹æ“ä½œåŒâ¼€é›†åˆçš„ä¿æŠ¤æœºåˆ¶</li><li>è§£å†³åŠæ³•<ul><li>å¯ä»¥ä½¿â½¤ Colletions.synchronizedList â½…æ³•å¤„ç†é›†åˆ æˆ– åœ¨ä¿®æ”¹é›†åˆ çš„åœ°â½…â½¤ synchronized è¿›â¾ä¿®é¥°ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒä½</li><li>ä½¿â½¤ CopyOnWriteArrayList ä»£æ›¿ Listï¼Œé‡‡â½¤è¯»å†™åˆ†ç¦»çš„â½…å¼ï¼Œå†™æ—¶ ä¼šæ–°æ‹·â»‰â¼€ä»½æ•°ç»„ï¼Œå¯¹æ–°æ•°ç»„è¿›â¾æ“ä½œï¼Œæ“ä½œå®Œä¹‹åï¼Œå†å°†å¼•â½¤ æŒ‡å‘æ–°æ•°ç»„</li></ul></li></ul><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><h4 id="ArrayList-å’Œ-Array-æ•°ç»„-çš„çš„åŒºåˆ«ã€‚"><a href="#ArrayList-å’Œ-Array-æ•°ç»„-çš„çš„åŒºåˆ«ã€‚" class="headerlink" title="ArrayList å’Œ Array æ•°ç»„  çš„çš„åŒºåˆ«ã€‚"></a>ArrayList å’Œ Array æ•°ç»„  çš„çš„åŒºåˆ«ã€‚</h4><p>ArrayList çš„åº•å±‚å®ç°æ˜¯åŠ¨æ€æ•°ç»„ï¼Œæ”¯æŒè‡ªåŠ¨æ‰©å®¹ï¼Œæ”¯æŒæ³›å‹ç¡®ä¿ç±»å‹å®‰å…¨ã€‚</p><p>è€Œ Array æ•°ç»„æ˜¯å›ºå®šçš„å®¹é‡å¤§å°ï¼Œéœ€è¦åœ¨å£°æ˜çš„æ—¶å€™å°±æŒ‡å®šå›ºå®šæ•°æ®ç±»å‹å’ŒæŒ‡å®šå¤§å°ï¼Œæ”¯æŒåŸºæœ¬ç±»å‹å’Œå¯¹è±¡ã€‚</p><h4 id="ArrayList-å’Œ-Vector-çš„åŒºåˆ«ã€‚"><a href="#ArrayList-å’Œ-Vector-çš„åŒºåˆ«ã€‚" class="headerlink" title="ArrayList å’Œ Vector çš„åŒºåˆ«ã€‚"></a>ArrayList å’Œ Vector çš„åŒºåˆ«ã€‚</h4><p>ArrayList å’Œ Vector éƒ½æ˜¯ List æ¥å£ä¸‹çš„å®ç°ç±»ï¼Œä½†æ˜¯ ArrayList æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œæ€§èƒ½è¾ƒé«˜ï¼›</p><p>Vector æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ˜¯ List æ¥å£çš„å¤è€å®ç°ï¼Œä½†ä¸å»ºè®®ç›®å‰ä½¿ç”¨ï¼ˆåŒæ­¥æ“ä½œå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼‰ï¼Œå¦‚æœæ˜¯å¹¶å‘æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨ <code>CopyOnWriteArrayList</code> ç­‰.</p><p>å¦å¤–ä¸¤è€…çš„æ‰©å®¹æœºåˆ¶ä¸ä¸€æ ·ï¼ŒArrayList æ‰©å®¹å¢é•¿ä¸ºåŸæ¥çš„ 1.5 å€ï¼ŒVector é»˜è®¤å¢é•¿ä¸ºåŸæ¥çš„ 2 å€ã€‚</p><h4 id="Vector-å’Œ-Stack-çš„åŒºåˆ«ã€‚"><a href="#Vector-å’Œ-Stack-çš„åŒºåˆ«ã€‚" class="headerlink" title="Vector å’Œ Stack çš„åŒºåˆ«ã€‚"></a>Vector å’Œ Stack çš„åŒºåˆ«ã€‚</h4><p>Vector æ˜¯ List æ¥å£çš„å¤è€å®ç°ç±»ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„æœ‰åºé›†åˆã€‚</p><p>Stack ç»§æ‰¿äº Vector ï¼Œæ˜¯ä¸€ä¸ªæ ˆç»“æ„ï¼ˆåè¿›å…ˆå‡º LIFOï¼‰ã€‚å®ƒæä¾›äº†æ ˆç»“æ„çš„ä¸€äº›æ ‡å‡†æ“ä½œæ–¹æ³•ï¼Œå®ç°äº†æ ˆçš„åŸºæœ¬åŠŸèƒ½ã€‚</p><p>ä½†æ˜¯ç”±äºåŒæ­¥æ“ä½œå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œä¸æ¨èç›®å‰ä½¿ç”¨ï¼›æ ˆç›®å‰ä¸€èˆ¬æ˜¯ä½¿ç”¨ <code>Deque</code> æ¥å£çš„å®ç°ç±» <code>ArrayDequeu</code> æ›¿ä»£ Stack ã€‚</p><h4 id="ArrayList-æ˜¯å¦å¯ä»¥æ·»åŠ -null-å€¼ã€‚"><a href="#ArrayList-æ˜¯å¦å¯ä»¥æ·»åŠ -null-å€¼ã€‚" class="headerlink" title="ArrayList æ˜¯å¦å¯ä»¥æ·»åŠ  null å€¼ã€‚"></a>ArrayList æ˜¯å¦å¯ä»¥æ·»åŠ  null å€¼ã€‚</h4><p>ArrayList æ˜¯å¯ä»¥æ·»åŠ  null å€¼çš„ï¼Œä½†æ˜¯ä¸å»ºè®®ï¼›</p><p>å°½ç®¡ ArryayList æ”¯æŒæ·»åŠ  null ï¼Œå¹¶ä¸”å…è®¸ é‡å¤æ·»åŠ ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ä»£ç å¯èƒ½ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><p>è§ä¸‹ğŸ‘‡ï¼š</p><p>åœ¨ä½¿ç”¨åŒ…å«<code>null</code>å€¼çš„<code>ArrayList</code>æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œå› ä¸ºå¯¹<code>null</code>çš„æ“ä½œå¯èƒ½ä¼šå¯¼è‡´<code>NullPointerException</code>ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ å°è¯•è°ƒç”¨<code>null</code>å¯¹è±¡çš„æ–¹æ³•æˆ–è®¿é—®å…¶å±æ€§ï¼Œå°±ä¼šé‡åˆ°è¿™ç§å¼‚å¸¸ã€‚å› æ­¤ï¼Œåœ¨å¤„ç†å¯èƒ½åŒ…å«<code>null</code>å€¼çš„<code>ArrayList</code>æ—¶ï¼Œæ€»æ˜¯å¥½çš„åšæ³•æ˜¯è¿›è¡Œ<code>null</code>æ£€æŸ¥ã€‚</p><h4 id="ArrayList-æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦ã€‚"><a href="#ArrayList-æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦ã€‚" class="headerlink" title="ArrayList æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦ã€‚"></a>ArrayList æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦ã€‚</h4><p><code>ArrayList</code>çš„æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å–å†³äºæ“ä½œçš„ä½ç½®ï¼š</p><p>æ’å…¥æ“ä½œï¼š</p><p>åœ¨ ArrayList ä¸­ï¼Œæœ«å°¾æ·»åŠ æˆ–è€…ç§»é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ <code>O(1)</code>æ“ä½œï¼Œå› ä¸ºä¸éœ€è¦ç§»åŠ¨å·²æœ‰çš„å…ƒç´ </p><p>ä½†æ˜¯è€ƒè™‘ä¸€ä¸ªæƒ…å†µï¼Œå°±æ˜¯å½“æ’å…¥å…ƒç´ çš„æ—¶å€™ï¼Œæ­¤æ—¶å¦‚æœæ•°ç»„éœ€è¦æ‰©å®¹ï¼ˆå³å½“å‰å…ƒç´ æ•°é‡å·²è¾¾åˆ°æ•°ç»„çš„å®¹é‡ï¼‰ï¼Œåˆ™æ’å…¥çš„æ—¶é—´å¤æ‚åº¦ä¼šä¸Šå‡åˆ°<code>O(n)</code>ï¼Œå› ä¸ºéœ€è¦å¤åˆ¶ç°æœ‰çš„æ•°ç»„åˆ°ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ã€‚</p><p>åœ¨<code>ArrayList</code>çš„ç‰¹å®šä½ç½®æ’å…¥å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(n)</code>ï¼Œå› ä¸ºéœ€è¦å°†æ’å…¥ç‚¹ä¹‹åçš„æ‰€æœ‰å…ƒç´ å‘åç§»åŠ¨ä¸€ä½ä»¥è…¾å‡ºç©ºé—´ã€‚è¿™é‡Œçš„<code>n</code>æ˜¯ä»æ’å…¥ç‚¹åˆ°æ•°ç»„æœ«å°¾çš„å…ƒç´ æ•°é‡ã€‚</p><p>åˆ é™¤æ“ä½œï¼š</p><p>ä»<code>ArrayList</code>çš„æœ«å°¾ç§»é™¤å…ƒç´ é€šå¸¸æ˜¯<code>O(1)</code>æ“ä½œï¼Œç›´æ¥åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ ä¸éœ€è¦ç§»åŠ¨å…¶ä»–å…ƒç´ ã€‚</p><p>ä»<code>ArrayList</code>çš„ç‰¹å®šä½ç½®åˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(n)</code>ï¼Œ</p><h4 id="ArrayList-çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ArrayList-çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ArrayList çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ArrayList çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h4><ul><li>ArrayList åº•å±‚æ˜¯ç”¨åŠ¨æ€çš„æ•°ç»„å®ç°çš„</li><li>ArrayList åˆå§‹å®¹é‡ä¸º 0ï¼Œå½“ç¬¬ä¸€æ¬¡æ·»åŠ æ•°æ®çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–å®¹é‡ä¸º 10</li><li>ArrayListåœ¨è¿›è¡Œæ‰©å®¹çš„æ—¶å€™æ˜¯åŸæ¥å®¹é‡çš„1.5å€ï¼Œæ¯æ¬¡æ‰©å®¹éƒ½éœ€è¦æ‹·è´æ•°ç»„</li><li>ArrayListåœ¨æ·»åŠ æ•°æ®çš„æ—¶å€™<ul><li>ç¡®ä¿æ•°ç»„å·²ä½¿ç”¨é•¿åº¦(size) åŠ 1 ä¹‹åè¶³å¤Ÿå­˜ä¸‹ä¸‹ä¸€ä¸ªæ•°æ®</li><li>è®¡ç®—æ•°ç»„çš„å®¹é‡ï¼Œå¦‚æœå½“å‰æ•°ç»„å·²ä½¿ç”¨é•¿åº¦+1åçš„å¤§äºå½“å‰çš„æ•°ç»„é•¿åº¦ï¼Œåˆ™è°ƒç”¨ grow æ–¹æ³•æ‰©å®¹ï¼ˆåŸæ¥çš„1.5å€ï¼‰</li><li>ç¡®ä¿æ–°å¢çš„æ•°æ®æœ‰åœ°æ–¹å­˜å‚¨ä¹‹åï¼Œåˆ™å°†æ–°å…ƒç´ æ·»åŠ åˆ°ä½äº size çš„ä½ç½®ä¸Šã€‚</li><li>è¿”å›æ·»åŠ æˆåŠŸå¸ƒå°”å€¼ã€‚</li></ul></li></ul><h4 id="ArrayList-list-new-ArrayList-10-ä¸­çš„-list-æ‰©å®¹å‡ æ¬¡ï¼Ÿ"><a href="#ArrayList-list-new-ArrayList-10-ä¸­çš„-list-æ‰©å®¹å‡ æ¬¡ï¼Ÿ" class="headerlink" title="ArrayList list &#x3D; new ArrayList(10)  ä¸­çš„ list æ‰©å®¹å‡ æ¬¡ï¼Ÿ"></a>ArrayList list &#x3D; new ArrayList(10)  ä¸­çš„ list æ‰©å®¹å‡ æ¬¡ï¼Ÿ</h4><p>æœªæ‰©å®¹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240301154733.png" alt="image.png"></p><h4 id="å¦‚ä½•å®ç°-æ•°ç»„å’ŒList-ä¹‹é—´çš„è½¬æ¢"><a href="#å¦‚ä½•å®ç°-æ•°ç»„å’ŒList-ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="å¦‚ä½•å®ç° æ•°ç»„å’ŒList ä¹‹é—´çš„è½¬æ¢"></a>å¦‚ä½•å®ç° æ•°ç»„å’ŒList ä¹‹é—´çš„è½¬æ¢</h4><p>å‚è€ƒå›ç­”ï¼š</p><ul><li>æ•°ç»„è½¬ Listï¼Œ ä½¿ç”¨ JDK ä¸­ java.util.Arrays å·¥å…·ç±»çš„ asList æ–¹æ³•</li><li>List è½¬æ•°ç»„ï¼Œä½¿ç”¨ List çš„ toArray æ–¹æ³•ï¼Œ<ul><li>æ— å‚ toArray æ–¹æ³•è¿”å› Object æ•°ç»„ï¼Œ</li><li>ä¼ å…¥åˆå§‹åŒ– é•¿åº¦çš„æ•°ç»„å¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡æ•°ç»„</li></ul></li></ul><p>å†é—®ï¼š</p><ul><li>ç”¨  Arrays.asList è½¬ List åï¼Œå¦‚æœä¿®æ”¹äº†æ•°ç»„å†…å®¹ï¼Œ list å—å½±å“å—</li><li>List ç”¨ toArray è½¬æ•°ç»„åï¼Œå¦‚æœä¿®æ”¹äº† List å†…å®¹ï¼Œæ•°ç»„å—å½±å“å—</li></ul><p>asList æ–¹æ³•çš„å…ƒç´ æŒ‡å‘åœ°å€å¹¶æ²¡æœ‰æ”¹ï¼Œå¦‚æœä¿®æ”¹äº†æ•°ç»„å†…å®¹ï¼Œ list å†…å®¹ä¹Ÿä¼š å—å½±å“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240301170109.png" alt="image.png"></p><p>toArray æ–¹æ³•æ˜¯å°†æ•°æ®èµ‹å€¼åˆ°äº†ä¸€ä¸ªæ–°çš„æ•°ç»„ä¸­,  å¦‚æœä¿®æ”¹äº† List å†…å®¹ï¼Œæ•°ç»„ä¸å—å½±å“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240301170302.png" alt="image.png"></p><h4 id="ArrayList-å’Œ-LinkedList-ä¹‹é—´çš„åŒºåˆ«-ğŸš©"><a href="#ArrayList-å’Œ-LinkedList-ä¹‹é—´çš„åŒºåˆ«-ğŸš©" class="headerlink" title="ArrayList å’Œ LinkedList ä¹‹é—´çš„åŒºåˆ« ğŸš©"></a>ArrayList å’Œ LinkedList ä¹‹é—´çš„åŒºåˆ« ğŸš©</h4><ul><li>1ã€åº•å±‚æ•°æ®ç»“æ„<ul><li>ArrayListæ˜¯åŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„å®ç°</li><li>LinkedListæ˜¯åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„å®ç°</li></ul></li><li>2ã€æ•ˆç‡<ul><li>ArrayListæŒ‰ç…§ä¸‹æ ‡æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦O(1)ã€å†…å­˜æ˜¯è¿ç»­çš„ï¼Œæ ¹æ®å¯»å€å…¬å¼ã€‘ï¼ŒLinkedListä¸æ”¯æŒä¸‹æ ‡æŸ¥è¯¢</li><li>æŸ¥æ‰¾ï¼ˆæœªçŸ¥ç´¢å¼•ï¼‰ï¼šArrayListéœ€è¦éå†ï¼Œé“¾è¡¨ä¹Ÿéœ€è¦é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n)</li><li>æ–°å¢å’Œåˆ é™¤<ul><li>ArrayList)å°¾éƒ¨æ’å…¥å’Œåˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(1):å…¶ä»–éƒ¨åˆ†å¢éœ€è¦å“ªåŠ¨æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(nã€‘</li><li>LinkedListå¤´å°¾èŠ‚ç‚¹å¢åˆ æ—¶é—´å¤æ‚åº¦æ˜¯O(I),å…¶ä»–éƒ½éœ€è¦éå†é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(n)</li></ul></li></ul></li><li>3ã€ç©ºé—´<ul><li>ArrayList åº•å±‚æ˜¯æ•°ç»„ï¼Œå†…å­˜è¿ç»­ï¼ŒèŠ‚çœå†…å­˜</li><li>LinkedListæ˜¯åŒå‘é“¾è¡¨éœ€è¦å­˜å‚¨æ•°æ®ï¼Œå’Œä¸¤ä¸ªæŒ‡é’ˆï¼Œæ›´å ç”¨å†…å­˜</li></ul></li><li>4ã€çº¿ç¨‹æ˜¯å¦å®‰å…¨<ul><li>ArrayListi å’Œ LinkedListéƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>å¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š<ul><li>åœ¨æ–¹æ³•å†…ä½¿ç”¨ï¼Œå±€éƒ¨å˜é‡åˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ArrayList å’Œ LinkedList<ul><li>æ¯”å¦‚ä½¿ç”¨ Collections.synchronizedList æ–¹æ³•</li></ul></li></ul></li></ul></li><li>ArrayList å’Œ LinkedList éƒ½æ˜¯åŸºäº List æ¥â¼ å®ç°çš„ï¼ŒLinkedList è¿˜å®ç°äº†  Deque æ¥â¼ï¼Œå¯ä»¥å½“åšé˜Ÿåˆ—ä½¿â½¤</li></ul><h4 id="è®²ä¸€ä¸‹-ArrayList-çš„æ·»åŠ å…ƒç´ æ“ä½œ"><a href="#è®²ä¸€ä¸‹-ArrayList-çš„æ·»åŠ å…ƒç´ æ“ä½œ" class="headerlink" title="è®²ä¸€ä¸‹ ArrayList çš„æ·»åŠ å…ƒç´ æ“ä½œ"></a>è®²ä¸€ä¸‹ ArrayList çš„æ·»åŠ å…ƒç´ æ“ä½œ</h4><p>ç¬¬ä¸€æ¬¡æ·»åŠ æ•°æ®</p><ul><li>ç¬¬ä¸€æ¬¡æ·»åŠ æ•°æ®çš„æ—¶å€™ä¼šå…ˆè®¡ç®—å®¹é‡ï¼Œè¿”å›  minCapacity</li><li>åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œç¬¬ä¸€æ¬¡çš„æ—¶å€™ä¼šè¿›è¡Œä¸€ä¸‹æ‰©å®¹</li><li>10 &gt; 0 ï¼Œè¿›è¡Œæ‰©å®¹æ“ä½œ</li><li>ç„¶åä¼šè·å–åˆ°ç¬¬ä¸€æ¬¡åˆå§‹åŒ–æ•°ç»„é•¿åº¦ 10 (newCapacity - minCapacity &lt; 0)</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240301153139.png" alt="image.png"></p><p>ç¬¬äºŒæ¬¡è‡³åæ¬¡æ·»åŠ å…ƒç´ </p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240301153847.png" alt="image.png"></p><p>ç¬¬åä¸€æ¬¡æ·»åŠ å…ƒç´ </p><p>æ­¤æ—¶ä¼šè¿›è¡Œä¸€æ¬¡æ‰©å®¹ï¼Œæ‰©å®¹å®¹é‡ä¸ºé»˜è®¤å®¹é‡çš„ 1.5 å€ï¼Œæ•°æ®è¿›è¡Œæ•°ç»„æ‹·è´åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„ä¸­ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240301154017.png" alt="image.png"></p><h4 id="CopyOnWriteArrayListåº•å±‚å®ç°åŸç†"><a href="#CopyOnWriteArrayListåº•å±‚å®ç°åŸç†" class="headerlink" title="CopyOnWriteArrayListåº•å±‚å®ç°åŸç†"></a>CopyOnWriteArrayListåº•å±‚å®ç°åŸç†</h4><ul><li>CopyOnWriteArrayListæ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œé‡‡â½¤å¤šå†™åˆ†ç¦»çš„â½…å¼æ¥åº” å¯¹å¤šçº¿ç¨‹çš„è¯»å†™æ“ä½œï¼Œå½“å¯¹å†…éƒ¨æ•°ç»„è¿›â¾æ“ä½œæ—¶ï¼Œä¼šæ‹·â»‰â¼€ä»½å‡ºæ¥â½¤ äºå†™ï¼Œå†™æ“ä½œæ—¶ä¼šè¿›â¾åŠ é”é¿å…å¹¶å‘å†™â¼Šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œâ½½è¯»ä¾æ—§åœ¨ æ—§æ•°ç»„è¿›â¾ï¼Œå½“æ“ä½œå®Œä¹‹åï¼Œå†å°†å¼•â½¤é‡æ–°æŒ‡å‘æ–°æ•°ç»„å®Œæˆæ•´ä¸ªæ“ä½œ </li><li>CopyOnWriteArrayListé€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œä½†æ˜¯â½è¾ƒåƒå†…å­˜ï¼Œå¹¶ä¸” å¯¹äºå®æ—¶æ€§è¦æ±‚å¾ˆâ¾¼åœºæ™¯ä¸å¤ªé€‚â½¤å› ä¸ºå¯èƒ½è¯»åˆ°æ—§æ•°æ®</li></ul><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><h4 id="è®²ä¸€ä¸‹-HashMap-ğŸš©"><a href="#è®²ä¸€ä¸‹-HashMap-ğŸš©" class="headerlink" title="è®²ä¸€ä¸‹ HashMap ğŸš©"></a>è®²ä¸€ä¸‹ HashMap ğŸš©</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240311195612.png" alt="image.png"></p><h4 id="HashMaplçš„putæ–¹æ³•çš„å…·ä½“æµç¨‹"><a href="#HashMaplçš„putæ–¹æ³•çš„å…·ä½“æµç¨‹" class="headerlink" title="HashMaplçš„putæ–¹æ³•çš„å…·ä½“æµç¨‹"></a>HashMaplçš„putæ–¹æ³•çš„å…·ä½“æµç¨‹</h4><ul><li>1.åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„tableæ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnull,å¦åˆ™æ‰§è¡Œresize0è¿›è¡Œæ‰©å®¹ï¼ˆåˆå§‹åŒ–ï¼‰</li><li>2.æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ•°ç»„ç´¢å¼•</li><li>3.åˆ¤æ–­table[i]&#x3D;&#x3D; null,æ¡ä»¶æˆç«‹ï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ </li><li>4.å¦‚æœtable[0]&#x3D;&#x3D; null,ä¸æˆç«‹<ul><li>4.1   åˆ¤æ–­table[i] çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œ keyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–value</li><li>4.2  åˆ¤æ–­ table[i] æ˜¯å¦ä¸º treeNode,å³ table[i]   æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹</li><li>4.3  éå†  table[i] ï¼Œé“¾è¡¨çš„å°¾éƒ¨æ’å…¥æ•°æ®ï¼Œç„¶ååˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œéå†è¿‡ç¨‹ä¸­è‹¥å‘ç° key å·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value</li></ul></li><li>5.æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡threshold(æ•°ç»„é•¿åº¦ * 0.75)ï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚</li></ul><h4 id="è®²ä¸€è®²-HashMap-çš„æ‰©å®¹æœºåˆ¶"><a href="#è®²ä¸€è®²-HashMap-çš„æ‰©å®¹æœºåˆ¶" class="headerlink" title="è®²ä¸€è®² HashMap çš„æ‰©å®¹æœºåˆ¶"></a>è®²ä¸€è®² HashMap çš„æ‰©å®¹æœºåˆ¶</h4><ul><li>1ã€åœ¨æ·»åŠ å…ƒç´ æˆ–åˆå§‹åŒ–çš„æ—¶å€™éœ€è¦è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œç¬¬ä¸€æ¬¡æ·»åŠ æ•°æ®åˆå§‹åŒ–æ•°ç»„é•¿åº¦ä¸º16ï¼Œä»¥åæ¯æ¬¡æ¯æ¬¡æ‰©å®¹éƒ½æ˜¯è¾¾åˆ°äº†æ‰©å®¹é˜ˆå€¼ï¼ˆæ•°ç»„é•¿åº¦ * 0.75ï¼‰</li><li>2ã€æ¯æ¬¡æ‰©å®¹çš„æ—¶å€™ï¼Œéƒ½æ˜¯æ‰©å®¹ä¹‹å‰å®¹é‡çš„2å€</li><li>3ã€æ‰©å®¹ä¹‹åï¼Œä¼šæ–°åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œéœ€è¦æŠŠè€æ•°ç»„ä¸­çš„æ•°æ®æŒªåŠ¨åˆ°æ–°çš„æ•°ç»„ä¸­<ul><li>æ²¡æœ‰hashå†²çªçš„èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥ä½¿ç”¨e.hash&amp;(newCap-1)è®¡ç®—æ–°æ•°ç»„çš„ç´¢å¼•ä½ç½®</li><li>å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œèµ°çº¢é»‘æ ‘çš„æ·»åŠ </li><li>å¦‚æœæ˜¯é“¾è¡¨ï¼Œåˆ™éœ€è¦éå†é“¾è¡¨ï¼Œå¯èƒ½éœ€è¦æ‹†åˆ†é“¾è¡¨ï¼Œåˆ¤æ–­(e.hash&amp;oldCap)æ˜¯å¦ä¸º0ï¼Œè¯¥å…ƒç´ çš„ä½ç½®è¦ä¹ˆåœç•™åœ¨åŸå§‹ä½ç½®ï¼Œè¦ä¹ˆç§»åŠ¨åˆ°åŸå§‹ä½ç½®+å¢åŠ çš„æ•°ç»„å¤§å°è¿™ä¸ªä½ç½®ä¸Š</li></ul></li></ul><h4 id="è¯´ä¸€ä¸‹HashMapçš„å®ç°åŸç†ï¼Ÿ"><a href="#è¯´ä¸€ä¸‹HashMapçš„å®ç°åŸç†ï¼Ÿ" class="headerlink" title="è¯´ä¸€ä¸‹HashMapçš„å®ç°åŸç†ï¼Ÿ"></a>è¯´ä¸€ä¸‹HashMapçš„å®ç°åŸç†ï¼Ÿ</h4><ul><li>1ã€åº•å±‚ä½¿ç”¨hashè¡¨æ•°æ®ç»“æ„ï¼Œå³æ•°ç»„+ï¼ˆé“¾è¡¨|çº¢é»‘æ ‘ï¼‰</li><li>2ã€æ·»åŠ æ•°æ®æ—¶ï¼Œè®¡ç®— key çš„å€¼ç¡®å®šå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä¸‹æ ‡<ul><li>keyç›¸åŒåˆ™æ›¿æ¢</li><li>ä¸åŒåˆ™å­˜å…¥é“¾è¡¨æˆ–çº¢é»‘æ ‘ä¸­</li></ul></li><li>è·å–æ•°æ®é€šè¿‡keyçš„hashè®¡ç®—æ•°ç»„ä¸‹æ ‡è·å–å…ƒç´ </li></ul><h4 id="HashMapçš„-jdk1-7å’Œ-jdk1-8æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#HashMapçš„-jdk1-7å’Œ-jdk1-8æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="HashMapçš„ jdk1.7å’Œ jdk1.8æœ‰ä»€ä¹ˆåŒºåˆ«"></a>HashMapçš„ jdk1.7å’Œ jdk1.8æœ‰ä»€ä¹ˆåŒºåˆ«</h4><ul><li>JDK1.8ä¹‹å‰é‡‡ç”¨çš„æ‹‰é“¾æ³•ï¼Œæ•°ç»„+é“¾è¡¨<ul><li>HashMapåœ¨JDK 7é‡‡â½¤çš„æ˜¯ æ•°ç»„ + é“¾è¡¨ çš„â½…å¼ï¼Œ</li><li>ç”±äºHashMapçš„key æ˜¯åŸºäºhashå€¼è®¡ç®—åæ”¾åˆ°å¯¹åº”çš„æ•°ç»„æ§½ä½çš„ï¼Œå¯èƒ½ä¼šå‡ºç°hashç¢° æ’ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªæ§½ä½é‡‡â½¤é“¾è¡¨å¤´æ’æ³•è¿›â¾å­˜æ”¾å…ƒç´ ï¼Œå¦‚æœå®¹é‡ä¸â¾œä¼š å…ˆæ‰©å®¹</li></ul></li><li>JDK1.8ä¹‹åé‡‡ç”¨æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼Œé“¾è¡¨é•¿åº¦å¤§äº8ä¸”æ•°ç»„é•¿åº¦å¤§äº64åˆ™ä¼šä»é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘<ul><li>HashMapåœ¨JDK 8é‡‡â½¤çš„æ˜¯ æ•°ç»„ + é“¾è¡¨&#x2F;çº¢â¿Šæ ‘ çš„â½…å¼ï¼ŒåŸºäºJDK 7çš„ åŸºç¡€ä¸Šä¸ºäº†è§£å†³é“¾è¡¨è¿‡â»“å¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ä»¥åŠå¤´æ’æ³•å¯¼è‡´å¾ªç¯é“¾è¡¨ ä»â½½æ­»å¾ªç¯é€ æˆCPUæ»¡è½½çš„é—®é¢˜ï¼Œæ‰€ä»¥JDK 8é‡‡â½¤äº†å°¾æ’æ³•</li></ul></li></ul><p>å¤´æ’æ³•å’Œå°¾æ’æ³•</p><ul><li>1.7  å¤´æ’æ³•<ul><li>åœ¨ Java 1.7 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå½“ä¸€ä¸ªæ–°çš„å…ƒç´ è¢«åŠ å…¥åˆ° HashMap ä¸­ï¼Œä¸”å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼ŒHashMap ä¼šé‡‡ç”¨å¤´æ’æ³•å°†è¿™ä¸ªæ–°å…ƒç´ æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ã€‚å¤´æ’æ³•çš„ä¸»è¦ç‰¹ç‚¹æ˜¯æ–°åŠ å…¥çš„å…ƒç´ æ€»æ˜¯è¢«æ”¾åœ¨é“¾è¡¨çš„æœ€å‰é¢ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>ç®€å•å¿«é€Ÿï¼šåœ¨é“¾è¡¨çš„å¤´éƒ¨æ’å…¥å…ƒç´ æ˜¯ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º O(1) çš„æ“ä½œã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¤´æ’æ³•å¯èƒ½ä¼šå¼•èµ·å¾ªç¯é“¾è¡¨ï¼Œå¯¼è‡´ <code>get</code> æ–¹æ³•å½¢æˆæ­»å¾ªç¯ã€‚</li><li>ç”±äºæ¯æ¬¡æ’å…¥éƒ½ä¼šæ”¹å˜é“¾è¡¨çš„é¡ºåºï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é•¿æ—¶é—´çš„æ€§èƒ½ä¸‹é™</li></ul></li></ul></li><li>1.8  å°¾æ’æ³•<ul><li>Java 1.8 å¯¹ HashMap è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ”¹ç”¨äº†å°¾æ’æ³•æ¥å¤„ç†å“ˆå¸Œå†²çªä¸‹çš„é“¾è¡¨æ’å…¥ã€‚å°¾æ’æ³•æ„å‘³ç€æ–°å…ƒç´ æ€»æ˜¯è¢«æ·»åŠ åˆ°é“¾è¡¨çš„å°¾éƒ¨ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼š<ul><li>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ›´å®‰å…¨ï¼šå°½ç®¡ HashMap æœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å°¾æ’æ³•ç›¸æ¯”äºå¤´æ’æ³•ï¼Œåœ¨å¹¶å‘ä¿®æ”¹æ—¶å‡å°‘äº†å¾ªç¯é“¾è¡¨å‡ºç°çš„é£é™©ã€‚</li><li>ç»´æŒäº†å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œè¿™å¯¹äºä¸€äº›ç‰¹å®šçš„åœºæ™¯å¯èƒ½æ˜¯æœ‰ç›Šçš„ã€‚</li></ul></li><li><strong>ç¼ºç‚¹</strong>ï¼š<ul><li>æ’å…¥æ“ä½œå¯èƒ½ä¼šç¨å¾®æ…¢ä¸€äº›ï¼Œå› ä¸ºéœ€è¦éå†åˆ°é“¾è¡¨çš„æœ«å°¾ã€‚</li></ul></li></ul></li></ul><h4 id="è®²ä¸€ä¸‹-HashMap-ä¸­çš„å¯»å€ç®—æ³•"><a href="#è®²ä¸€ä¸‹-HashMap-ä¸­çš„å¯»å€ç®—æ³•" class="headerlink" title="è®²ä¸€ä¸‹ HashMap ä¸­çš„å¯»å€ç®—æ³•"></a>è®²ä¸€ä¸‹ HashMap ä¸­çš„å¯»å€ç®—æ³•</h4><ul><li>1ã€è®¡ç®—å¯¹è±¡çš„hashCode()</li><li>2ã€å†è¿›è¡Œè°ƒç”¨ hash()æ–¹æ³• è¿›è¡ŒäºŒæ¬¡å“ˆå¸Œï¼Œhashcodeå€¼å³ç§»16ä½å†å¼‚æˆ–è¿ç®—ï¼Œè®©å“ˆå¸Œåˆ†å¸ƒæ›´ä¸ºå‡åŒ€</li><li>3ã€æœ€å(capacity-1)&amp;hashå¾—åˆ°ç´¢å¼•</li></ul><h4 id="HashMap-çš„å¯»å€ç®—æ³•å’Œæ•°ç»„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2-çš„-n-æ¬¡å¹‚"><a href="#HashMap-çš„å¯»å€ç®—æ³•å’Œæ•°ç»„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2-çš„-n-æ¬¡å¹‚" class="headerlink" title="HashMap çš„å¯»å€ç®—æ³•å’Œæ•°ç»„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2 çš„ n æ¬¡å¹‚"></a>HashMap çš„å¯»å€ç®—æ³•å’Œæ•°ç»„é•¿åº¦ä¸ºä»€ä¹ˆæ˜¯2 çš„ n æ¬¡å¹‚</h4><h4 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a>ConcurrentHashMap</h4><p>ConcurrentHashMapæ˜¯ä¸€ç§çº¿ç¨‹å®‰å…¨çš„é«˜æ•ˆMapé›†åˆ</p><ul><li>ConcurrentHashMap<ul><li>åº•å±‚æ•°æ®ç»“æ„<ul><li>1.7ï¼šåº•å±‚é‡‡ç”¨åˆ†æ®µçš„æ•°ç»„ + é“¾è¡¨å®ç°</li><li>1.8ï¼šé‡‡ç”¨çš„æ•°æ®ç»“æ„è·Ÿ HashMap 1.8 çš„ç»“æ„ä¸€æ ·ï¼Œæ•°ç»„ + é“¾è¡¨&#x2F;çº¢é»‘äºŒå‰æ ‘</li></ul></li><li>åŠ é”çš„æ–¹å¼<ul><li>1.7ï¼šé‡‡ç”¨ Segment åˆ†æ®µé”ï¼Œåº•å±‚ä½¿ç”¨çš„æ˜¯ ReentrantLock</li><li>1.8ï¼šé‡‡ç”¨ CAS æ·»åŠ æ–°èŠ‚ç‚¹ï¼Œé‡‡ç”¨ synchronized é”å®šé“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œç›¸å¯¹ Segment åˆ†æ®µé”ç²’åº¦æ›´ç»†ï¼Œæ€§èƒ½æ›´å¥½</li></ul></li><li>æ–°å¢å…ƒç´ ï¼ˆ1.8ï¼‰<ul><li>hash(key)  â†’ åœ¨è¯¥æ•°ç»„èŠ‚ç‚¹ä¸‹é€šè¿‡ CAS æ“ä½œæ–°å¢å…ƒç´ æ“ä½œ</li><li>é‡‡ç”¨ synchronized é”å®šé“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹</li></ul></li></ul></li></ul><p>JDK 1.7</p><p>ç»„æˆï¼šä¸€ä¸ª Segment æ•°ç»„ï¼ˆä¸å¯æ‰©å®¹ï¼Œé»˜è®¤å€¼ 16ï¼‰ï¼Œæ¯ä¸€ä¸ªæ•°ç»„èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ª HashEntry æ•°ç»„ï¼ˆæ•°ç»„ + é“¾è¡¨ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312215201.png" alt="image.png"></p><p>æ·»åŠ å…ƒç´ ï¼šè®¡ç®— key çš„ hash å€¼ å®šä½åˆ° Segment æ•°ç»„çš„ä¸‹æ ‡ï¼Œæ­¤æ—¶é€šè¿‡ ReentrantLock è·å–åˆ°é”è¿›è¡Œè¯¥ä¸‹æ ‡ä¸‹ HashEntry æ•°ç»„æ–°å¢æ“ä½œ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312215223.png" alt="image.png"></p><p>JDK1.8 ConcurrentHashMap</p><p>åœ¨JDK1.8ä¸­ï¼Œæ”¾å¼ƒäº†Segment è‡ƒè‚¿çš„è®¾è®¡ï¼Œæ•°æ®ç»“æ„è·ŸHashMaplçš„æ•°æ®ç»“æ„æ˜¯ä¸€æ ·çš„ï¼šæ•°ç»„ï¼ˆåŠ¨æ€æ‰©å®¹ï¼‰+ é“¾è¡¨ +çº¢é»‘æ ‘</p><p>é‡‡ç”¨ CAS+Synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨è¿›è¡Œå®ç°</p><ul><li>CAS æ§åˆ¶æ•°ç»„èŠ‚ç‚¹çš„æ·»åŠ </li><li>synchronized åªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„é¦–èŠ‚ç‚¹ï¼Œåªè¦ hash ä¸å†²çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘çš„é—®é¢˜ï¼Œæ•ˆç‡å¾—åˆ°æå‡ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312215346.png" alt="image.png"></p><p>æ–°å¢å…ƒç´ çš„æ“ä½œï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312232104.png" alt="image.png"></p><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_æ¡†æ¶</title>
    <link href="/2024/03/09/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E6%A1%86%E6%9E%B6/"/>
    <url>/2024/03/09/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E6%A1%86%E6%9E%B6/</url>
    
    <content type="html"><![CDATA[<h3 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h3><h4 id="Beançº¿ç¨‹å®‰å…¨"><a href="#Beançº¿ç¨‹å®‰å…¨" class="headerlink" title="Beançº¿ç¨‹å®‰å…¨"></a>Beançº¿ç¨‹å®‰å…¨</h4><blockquote><p>Spring æ¡†æ¶ä¸­çš„å•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„å—</p></blockquote><p>å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒSpringæ¡†æ¶ä¸­çš„å•ä¾‹Beanæœ¬èº«å¯¹äºçº¿ç¨‹å®‰å…¨æ€§å¹¶æ²¡æœ‰æä¾›ä¿è¯ã€‚</p><p>å•ä¾‹Beanæ„å‘³ç€åœ¨Springçš„åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œæ¯ä¸ªå®šä¹‰çš„Beanåªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚ä½†æ˜¯ï¼ŒBeançš„çº¿ç¨‹å®‰å…¨æ€§å–å†³äºBeançš„å®ç°å’Œä½¿ç”¨æ–¹å¼ã€‚</p><ul><li><strong>çŠ¶æ€æ— å…³çš„Bean</strong>ï¼šå¦‚æœBeanæ˜¯æ— çŠ¶æ€çš„ï¼ˆå³ï¼Œå®ƒä»¬ä¸ç»´æŠ¤ä»»ä½•å­—æ®µæˆ–çŠ¶æ€ä¿¡æ¯ï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬é€šå¸¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåªæœ‰æ–¹æ³•ï¼Œæ²¡æœ‰æˆå‘˜å˜é‡çš„æœåŠ¡ç±»ï¼Œæˆ–è€…æˆå‘˜å˜é‡éƒ½æ˜¯ä¸å¯å˜çš„æˆ–çº¿ç¨‹å®‰å…¨çš„ã€‚</li><li><strong>çŠ¶æ€ç›¸å…³çš„Bean</strong>ï¼šå¦‚æœBeanåŒ…å«æœ‰çŠ¶æ€ï¼ˆå³ï¼Œå®ƒä»¬ç»´æŠ¤äº†ä¿®æ”¹çš„å­—æ®µæˆ–çŠ¶æ€ä¿¡æ¯ï¼‰ï¼Œé‚£ä¹ˆå®ƒä»¬å¯èƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨å¹¶å‘è®¿é—®ä¸‹ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹è¿™äº›çŠ¶æ€ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–å…¶ä»–å¹¶å‘é—®é¢˜ã€‚</li></ul><p>æœåŠ¡å™¨ä¸­çš„ä»£ç ç‰‡æ®µ</p><p>Spring Bean å¹¶æ²¡æœ‰å¯å˜çš„çŠ¶æ€ï¼ˆæ¯”å¦‚ Service ç±»å’Œ Dao ç±»ï¼‰ï¼Œæ‰€ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šè¯´ Spring çš„å•ä¾‹ bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>ä½†å¦‚æœ Bean ä¸­åŒ…å«äº†ä¿®æ”¹çš„å­—æ®µæˆ–è€…çŠ¶æ€ä¿¡æ¯, å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs axapta">@Component<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterBean</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">count</span> = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> increment() &#123;<br>        <span class="hljs-keyword">count</span>++;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> getCount() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">count</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šçš„<code>CounterBean</code>å°±æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„Beanï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹<code>increment</code>æ–¹æ³•çš„è°ƒç”¨å°±ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><p>é¢è¯•é¢˜å›ç­”</p><blockquote><p>Spring æ¡†æ¶ä¸­çš„å•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„å—</p></blockquote><ul><li>ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>Spring çš„ Bean é»˜è®¤æ˜¯å•ä¾‹çš„ï¼Œæ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨æœ‰ä¸¤ç§æƒ…å†µ<ul><li>åœ¨springçš„beançš„ä¸­éƒ½æ˜¯æ³¨å…¥æ— çŠ¶æ€çš„å¯¹è±¡ï¼Œæ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</li><li>å¦‚æœåœ¨beanä¸­å®šä¹‰äº†å¯ä¿®æ”¹çš„æˆå‘˜å˜é‡ï¼Œæ˜¯è¦è€ƒçº¿ç¨‹å®‰å…¨é—®é¢˜çš„<ul><li>å¯ä»¥ä½¿ç”¨å¤šä¾‹æˆ–è€…åŠ é”æ¥è§£å†³</li></ul></li></ul></li></ul><hr><h4 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h4><blockquote><p>ä»€ä¹ˆæ˜¯ AOPï¼Œä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰ä½¿ç”¨åˆ° AOP </p></blockquote><p>å›ç­”è¿™é“é¢˜ç›®ï¼Œä¸€èˆ¬å»ºè®®å›´ç»•é¦–å…ˆè‡ªå·±å¯¹äº AOPçš„ç†è§£æ¦‚å¿µï¼Œç„¶åç»“åˆå®é™…åœºæ™¯é¢˜ï¼ŒåŒ…æ‹¬è‡ªå·±é¡¹ç›®ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨åˆ° AOP ï¼Œç„¶åè®²è¿°è‡ªå·±å¯¹äºå®ƒçš„ç†è§£ã€‚</p><p>AOPç§°ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç”¨äºå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œä½†å´å¯¹å¤šä¸ªå¯¹è±¡äº§ç”Ÿå½±å“çš„å…¬å…±è¡Œä¸ºå’Œé€»è¾‘ï¼ŒæŠ½å–å¹¶å°è£…ä¸ºä¸€ä¸ª<br>å¯é‡ç”¨çš„æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—è¢«å‘½åä¸ºâ€œåˆ‡é¢â€(Aspect),å‡å°‘ç³»ç»Ÿä¸­çš„é‡å¤ä»£ç ï¼Œé™ä½äº†æ¨¡å—é—´çš„è°ƒåˆåº¦ï¼ŒåŒæ—¶æé«˜äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ï¼Œ</p><p>å¸¸è§çš„AOP ä½¿ç”¨åœºæ™¯æ˜¯ï¼š</p><ul><li>è®°å½•æ“ä½œæ—¥å¿—</li><li>ç¼“å­˜å¤„ç†</li><li>Springä¸­å†…ç½®çš„äº‹åŠ¡å¤„ç†</li></ul><h5 id="æ—¥å¿—è®°å½•"><a href="#æ—¥å¿—è®°å½•" class="headerlink" title="æ—¥å¿—è®°å½•"></a>æ—¥å¿—è®°å½•</h5><p>è®°å½•æ“ä½œæ—¥å¿—æ€è·¯</p><ul><li>è·å–è¯·æ±‚çš„ç”¨æˆ·åã€è¯·æ±‚æ–¹å¼ã€è®¿é—®åœ°å€ã€æ¨¡å—åç§°ã€ç™»é™†IPã€æ“ä½œæ—¶é—´ï¼Œè®°å½•åˆ°æ•°æ®åº“çš„æ—¥å¿—è¡¨ä¸­ã€‚</li></ul><p>æ—¥å¿—çš„å®é™…è®°å…¥æ–¹å¼å¯ç”¨è¯´ä¸€ä¸‹ï¼Œç„¶åæ—¥å¿—åœ¨é¡¹ç›®ä¸­æ˜¯å¦‚ä½•ç”¨åˆ°çš„ï¼ˆå»ºè®®è¯´ä¸€ä¸‹è˜‘è‡åšå®¢ä¸Šé¢è®°å½•æ—¥å¿—çš„æ–¹å¼ï¼‰</p><h5 id="äº‹åŠ¡å®ç°"><a href="#äº‹åŠ¡å®ç°" class="headerlink" title="äº‹åŠ¡å®ç°"></a>äº‹åŠ¡å®ç°</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240229001802.png" alt="image.png"></p><p>æ„Ÿè§‰AOP è¿™é‡Œçš„å›ç­”å»ºè®®è¿˜æ˜¯è¦å’Œåå‘ä»£ç†ä¸€èµ·è¯´ä¸€ä¸‹ï¼Œå…·ä½“å®ç°æ–¹å¼å½“ç„¶ä¹Ÿå¯ç”¨è¯´ï¼Œåˆ°æ—¶å€™éšæœºåº”å˜äº†ã€‚</p><blockquote><p>é¢è¯•é¢˜å›ç­”</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240229001857.png" alt="image.png"></p><h4 id="äº‹åŠ¡å¤±æ•ˆ"><a href="#äº‹åŠ¡å¤±æ•ˆ" class="headerlink" title="äº‹åŠ¡å¤±æ•ˆ"></a>äº‹åŠ¡å¤±æ•ˆ</h4><p>äº‹åŠ¡ç®¡ç†é€šè¿‡å£°æ˜å¼äº‹åŠ¡å’Œç¼–ç¨‹å¼äº‹åŠ¡æ¥æä¾›å¯¹äº‹åŠ¡çš„æ”¯æŒã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒSpringäº‹åŠ¡å¯èƒ½ä¼šå¤±æ•ˆï¼Œå¯¼è‡´äº‹åŠ¡ä¸æŒ‰é¢„æœŸæ‰§è¡Œã€‚</p><p>è¿™äº›åœºæ™¯ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><ol><li>æ–¹æ³•éå…¬å¼€ï¼ˆNon-public Methodï¼‰</li></ol><ul><li>Springçš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°çš„ã€‚</li><li>å¦‚æœä¸€ä¸ªç±»ä¸­è¢«<code>@Transactional</code>æ ‡æ³¨çš„æ–¹æ³•ä¸æ˜¯publicçš„ï¼Œé‚£ä¹ˆSpring AOPå°†æ— æ³•åˆ›å»ºæœ‰æ•ˆçš„ä»£ç†å¯¹è±¡ï¼Œå¯¼è‡´äº‹åŠ¡ç®¡ç†ä¸ç”Ÿæ•ˆã€‚</li></ul></li><li><ol start="2"><li>è‡ªè°ƒç”¨ï¼ˆSelf-invocationï¼‰</li></ol><ul><li>å½“åœ¨åŒä¸€ä¸ªç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ç›´æ¥è°ƒç”¨å¦ä¸€ä¸ªå¸¦æœ‰<code>@Transactional</code>æ³¨è§£çš„æ–¹æ³•æ—¶ï¼Œäº‹åŠ¡æ˜¯ä¸ä¼šè¢«è§¦å‘çš„ã€‚</li><li>è¿™æ˜¯å› ä¸ºåŠ¨æ€ä»£ç†çš„é™åˆ¶ï¼Œäº‹åŠ¡çš„åº”ç”¨éœ€è¦é€šè¿‡ä»£ç†å¯¹è±¡æ¥è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚è‡ªè°ƒç”¨åœºæ™¯ç»•è¿‡äº†ä»£ç†å¯¹è±¡ï¼Œç›´æ¥åœ¨ç›®æ ‡å¯¹è±¡å†…éƒ¨è°ƒç”¨ï¼Œå› æ­¤äº‹åŠ¡ä¸ç”Ÿæ•ˆã€‚</li></ul></li><li><ol start="3"><li>å¼‚å¸¸å¤„ç†ä¸å½“</li></ol><ul><li>Springäº‹åŠ¡é»˜è®¤åªå¯¹<code>RuntimeException</code>ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰å’Œ<code>Error</code>è¿›è¡Œå›æ»šï¼Œå¯¹äºæ£€æŸ¥å‹å¼‚å¸¸ï¼ˆ<code>Exception</code>çš„å…¶ä»–å­ç±»ï¼‰ä¸ä¼šå›æ»šã€‚</li><li>å¦‚æœéœ€è¦å¯¹æ£€æŸ¥å‹å¼‚å¸¸è¿›è¡Œå›æ»šï¼Œéœ€è¦åœ¨<code>@Transactional</code>æ³¨è§£çš„<code>rollbackFor</code>å±æ€§ä¸­æ˜¾å¼å£°æ˜ã€‚</li></ul></li><li><ol start="4"><li>æ•°æ®æºæœªé…ç½®äº‹åŠ¡ç®¡ç†å™¨</li></ol></li><li><ol start="5"><li>é”™è¯¯çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºé…ç½®</li></ol></li><li><ol start="6"><li>äº‹åŠ¡æ–¹æ³•è¢«å†…è”ç¼–è¯‘ä¼˜åŒ–</li></ol></li><li><ol start="7"><li>ä¸æ°å½“çš„éš”ç¦»çº§åˆ«æˆ–è¶…æ—¶è®¾ç½®</li></ol></li></ul><p>å»ºè®®å›ç­”ä¸€ä¸‹å‰ä¸‰ç‚¹ã€‚</p><blockquote><p>è§†é¢‘è®²è§£éƒ¨åˆ†å†…å®¹ï¼š</p></blockquote><p>å¼‚å¸¸æ•è·å¤„ç†</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240229002244.png" alt="image.png"></p><p>æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸<br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240229002325.png" alt="image.png"><br>é public æ–¹æ³•å¯¼è‡´çš„äº‹åŠ¡å¤±æ•ˆ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240229002350.png" alt="image.png"></p><blockquote><p>é¢è¯•é¢˜</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240229002419.png" alt="image.png"></p><h4 id="Beançš„ç”Ÿå‘½å‘¨æœŸ-ğŸš©"><a href="#Beançš„ç”Ÿå‘½å‘¨æœŸ-ğŸš©" class="headerlink" title="Beançš„ç”Ÿå‘½å‘¨æœŸ  ğŸš©"></a>Beançš„ç”Ÿå‘½å‘¨æœŸ  ğŸš©</h4><blockquote><p>Spring å®¹å™¨æ˜¯å¦‚ä½•ç®¡ç†å’Œåˆ›å»º bean å®ä¾‹</p></blockquote><blockquote><p>æ–¹ä¾¿è°ƒè¯•å’Œè§£å†³é—®é¢˜</p></blockquote><p>Bean çš„æµç¨‹ â†’   ä»£ç éªŒè¯</p><p>BeanDefinition</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240229081346.png" alt="image.png"></p><p>ç”Ÿå‘½å‘¨æœŸ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240229081603.png" alt="image.png"></p><p>å¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ä¸ª: <a href="https://www.bilibili.com/video/BV1yT411H7YK/?p=39&spm_id_from=pageDriver&vd_source=6a019ecccfe7d8f62b9a3fe99c723bd0">https://www.bilibili.com/video/BV1yT411H7YK/?p=39&amp;spm_id_from=pageDriver&amp;vd_source=6a019ecccfe7d8f62b9a3fe99c723bd0</a></p><p>è‡ªå®šä¹‰äº†ä¸€ä¸ªç±»ï¼Œç„¶åçœ‹ Bean åœ¨ Spring ä¸­çš„ä¸€ä¸ªæ‰§è¡Œæµç¨‹ï¼ˆçœ‹è¾“å‡ºçš„ä¸€ä¸ªé¡ºåºï¼‰</p><blockquote><p>é¢è¯•é¢˜å›ç­”</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240229082037.png" alt="image.png"></p><h4 id="å¾ªç¯ä¾èµ–-ğŸš©"><a href="#å¾ªç¯ä¾èµ–-ğŸš©" class="headerlink" title="å¾ªç¯ä¾èµ–   ğŸš©"></a>å¾ªç¯ä¾èµ–   ğŸš©</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240315154746.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240315153729.png" alt="image.png"></p><p>çœ‹ä¸€ä¸‹ç›¸å…³çš„è§£æï¼š</p><p>å…³äºä¸‰çº§ç¼“å­˜è§£å†³å¾ªç¯å¼•ç”¨çš„æè¿°ï¼ŒåŸºæœ¬æ€è·¯æ˜¯å¯¹çš„ï¼Œä½†æè¿°è¿‡ç¨‹ä¸­çš„ä¸€äº›ç»†èŠ‚éœ€è¦æ›´å‡†ç¡®åœ°è¡¨è¾¾ï¼š</p><ol><li><strong>å¼€å§‹å®ä¾‹åŒ–å¯¹è±¡A</strong>ï¼šå½“Springå®¹å™¨å¼€å§‹åˆ›å»ºBean Aæ—¶ï¼Œå¦‚æœå‘ç°Aä¾èµ–äºBï¼Œå®ƒä¼šæš‚åœAçš„åˆ›å»ºè¿‡ç¨‹ï¼Œå¹¶å¼€å§‹åˆ›å»ºBã€‚</li><li><strong>æ”¾å…¥ä¸‰çº§ç¼“å­˜</strong>ï¼šåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒSpringå®¹å™¨å®é™…ä¸Šä¼šå°†åˆ›å»ºAçš„éƒ¨åˆ†å®Œæˆçš„å®ä¾‹ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå®ä¾‹å·²ç»åˆ†é…äº†å†…å­˜ï¼Œä½†å®ƒçš„ä¾èµ–è¿˜æ²¡æœ‰å®Œå…¨è§£å†³ï¼‰çš„å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜ä¸­ã€‚è¿™ä¸ªå·¥å‚è´Ÿè´£ç”ŸæˆAçš„å¼•ç”¨ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶å¯ä»¥æå‰æš´éœ²å‡ºæ¥ã€‚</li><li><strong>åˆ›å»ºå¯¹è±¡B</strong>ï¼šåœ¨åˆ›å»ºBçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœBéœ€è¦ä¾èµ–äºAï¼ŒSpringå®¹å™¨ä¼šå°è¯•ä»ç¼“å­˜ä¸­è·å–Açš„å®ä¾‹ã€‚æ­¤æ—¶ï¼Œå®ƒä¼šä»ä¸‰çº§ç¼“å­˜ä¸­è·å–Açš„å·¥å‚ï¼Œä½¿ç”¨è¿™ä¸ªå·¥å‚åˆ›å»ºAçš„æ—©æœŸå¼•ç”¨ï¼Œå¹¶å°†è¿™ä¸ªå¼•ç”¨æå‡åˆ°äºŒçº§ç¼“å­˜ä¸­ã€‚</li><li><strong>å®Œæˆå¯¹è±¡Bçš„åˆ›å»º</strong>ï¼šæœ‰äº†Açš„å¼•ç”¨åï¼ŒSpringå®¹å™¨å¯ä»¥ç»§ç»­Bçš„åˆ›å»ºè¿‡ç¨‹ï¼Œå¹¶è§£å†³å…¶å¯¹Açš„ä¾èµ–ã€‚</li><li><strong>å®Œæˆå¯¹è±¡Açš„åˆ›å»º</strong>ï¼šä¸€æ—¦Bè¢«æˆåŠŸåˆ›å»ºå¹¶è®¾ç½®åˆ°Aä¸­ï¼ŒSpringå®¹å™¨å›åˆ°Açš„åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œå®ŒæˆAçš„åˆ›å»ºå¹¶è§£å†³å…¶ä»–å¯èƒ½çš„ä¾èµ–ã€‚</li></ol><p>é€šè¿‡ä¸‰çº§ç¼“å­˜æœºåˆ¶ï¼ŒSpringèƒ½å¤Ÿå¤„ç†å¾ªç¯ä¾èµ–çš„æƒ…å†µï¼Œå…è®¸Aå’ŒBäº’ç›¸å¼•ç”¨è€Œä¸å¯¼è‡´æ­»é”æˆ–Beanåˆ›å»ºå¤±è´¥ã€‚</p><p>ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSpringçš„è¿™ç§ä¸‰çº§ç¼“å­˜æœºåˆ¶åªèƒ½è§£å†³å•ä¾‹ä½œç”¨åŸŸBeançš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå¹¶ä¸”ä¸»è¦è§£å†³çš„æ˜¯Setteræ³¨å…¥æˆ–å­—æ®µæ³¨å…¥é€ æˆçš„å¾ªç¯ä¾èµ–ã€‚å¯¹äºæ„é€ å™¨æ³¨å…¥å¯¼è‡´çš„å¾ªç¯ä¾èµ–ï¼ŒSpringæ˜¯æ— æ³•è§£å†³çš„ã€‚</p><p>ğŸ‘‡</p><p>æ„é€ æ–¹æ³•å‡ºç°äº†å¾ªç¯ä¾èµ–çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ @Lazy è¿›è¡Œæ‡’åŠ è½½</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240315153845.png" alt="image.png"></p><h4 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h4><p>Springæ¡†æ¶å¸¸è§æ³¨è§£(Springã€Springbootã€Springmvc)</p><h5 id="Spring-1"><a href="#Spring-1" class="headerlink" title="Spring"></a>Spring</h5><ul><li>@Componetnã€@Controllerã€@Serviceã€@Repository</li><li>@Autowired</li><li>@Qualifier</li><li>@Scope</li><li>@Configuration</li><li>@ComponentScan</li><li>@Bean</li><li>@Import</li><li>@Aspectã€@Beforeã€@Afterã€@Aroundã€@Pointcut</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290951343.png" alt="image.png"></p><h5 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h5><ul><li>@RequestMapping</li><li>@RequestBody</li><li>@RequestParam</li><li>@PathViriable</li><li>@ResponseBody</li><li>@RequestHeader</li><li>@RestController</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290956678.png" alt="image.png"></p><h5 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h5><ul><li>@SpringBootConfiguration</li><li>@EnableAutoConfiguration</li><li>@CompnentScan</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290957400.png" alt="image.png"></p><h4 id="ä½ ä»¬é¡¹ç›®ä¸­æœ‰ç”¨è¿‡-SPI-å—ï¼Œæ˜¯å¦è‡ªå·±å°è£…è¿‡ç»„ä»¶-ğŸš©"><a href="#ä½ ä»¬é¡¹ç›®ä¸­æœ‰ç”¨è¿‡-SPI-å—ï¼Œæ˜¯å¦è‡ªå·±å°è£…è¿‡ç»„ä»¶-ğŸš©" class="headerlink" title="ä½ ä»¬é¡¹ç›®ä¸­æœ‰ç”¨è¿‡ SPI å—ï¼Œæ˜¯å¦è‡ªå·±å°è£…è¿‡ç»„ä»¶  ğŸš©"></a>ä½ ä»¬é¡¹ç›®ä¸­æœ‰ç”¨è¿‡ SPI å—ï¼Œæ˜¯å¦è‡ªå·±å°è£…è¿‡ç»„ä»¶  ğŸš©</h4><h4 id="æœ‰æ²¡æœ‰è‡ªå®šä¹‰è¿‡-BeanPost-xxx-ï¼Œå…·ä½“æ€ä¹ˆä½¿ç”¨çš„-ğŸš©"><a href="#æœ‰æ²¡æœ‰è‡ªå®šä¹‰è¿‡-BeanPost-xxx-ï¼Œå…·ä½“æ€ä¹ˆä½¿ç”¨çš„-ğŸš©" class="headerlink" title="æœ‰æ²¡æœ‰è‡ªå®šä¹‰è¿‡ BeanPost xxx ï¼Œå…·ä½“æ€ä¹ˆä½¿ç”¨çš„  ğŸš©"></a>æœ‰æ²¡æœ‰è‡ªå®šä¹‰è¿‡ BeanPost xxx ï¼Œå…·ä½“æ€ä¹ˆä½¿ç”¨çš„  ğŸš©</h4><h3 id="SpringMVC-1"><a href="#SpringMVC-1" class="headerlink" title="SpringMVC"></a>SpringMVC</h3><h4 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h4><p>Springmvcçš„æ‰§è¡Œæµç¨‹æ˜¯è¿™ä¸ªæ¡†æ¶æœ€æ ¸å¿ƒçš„å†…å®¹</p><ul><li>1ã€è§†å›¾é˜¶æ®µï¼ˆè€æ—§JSPç­‰ ï¼‰</li><li>2ã€å‰åç«¯åˆ†ç¦»é˜¶æ®µï¼ˆæ¥å£å¼€å‘ï¼Œå¼‚æ­¥ï¼‰</li></ul><blockquote><p>è§†å›¾é˜¶æ®µ</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290943468.png" alt="image.png"></p><blockquote><p>å‰åç«¯åˆ†ç¦»</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290944546.png" alt="image.png"></p><p>é¢è¯•é¢˜ï¼š</p><ul><li>1ã€æµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼Œå‰ç«¯æ§åˆ¶å™¨è¿›è¡Œå¤„ç†ï¼ˆè°ƒç”¨å¤„ç†å™¨æ˜ å°„å™¨ï¼‰ï¼›</li><li>2ã€å‰ç«¯æ§åˆ¶å™¨é€šè¿‡å¤„ç†å™¨æ˜ å°„å™¨ä¼šæ‰¾åˆ°å…·ä½“çš„å¤„ç†å™¨ Handlerï¼Œç”Ÿæˆå¤„ç†å™¨å¯¹è±¡ä»¥åŠå¤„ç†å™¨æ‹¦æˆªå™¨ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œä¸€èµ·è¿”å›ç»™ DispatcherServletã€‚</li><li>3ã€å‰ç«¯æ§åˆ¶å™¨è°ƒç”¨å¤„ç†å™¨é€‚é…å™¨ï¼Œé€‚é…å™¨è°ƒç”¨å¯¹åº”çš„ å¤„ç†å™¨ è¿›è¡Œå¤„ç†ç”¨æˆ·è¯·æ±‚</li><li>4ã€å¤„ç†å®Œæˆåè¿”å› ModelAndView å¯¹è±¡ï¼Œç»è¿‡è§†å›¾è§£æå™¨å¤„ç†è¿”å›è§†å›¾ï¼Œè¿›è¡Œæ¸²æŸ“åå¡«å……å‰ç«¯ï¼Œè¿›è¡Œå“åº”</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290945750.png" alt="image.png"></p><p>ç‰ˆæœ¬2ï¼š</p><ul><li>1ã€æµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼Œå‰ç«¯æ§åˆ¶å™¨è¿›è¡Œå¤„ç†ï¼ˆè°ƒç”¨å¤„ç†å™¨æ˜ å°„å™¨ï¼‰ï¼›</li><li>2ã€å‰ç«¯æ§åˆ¶å™¨é€šè¿‡å¤„ç†å™¨æ˜ å°„å™¨ä¼šæ‰¾åˆ°å…·ä½“çš„å¤„ç†å™¨ Handlerï¼Œç”Ÿæˆå¤„ç†å™¨å¯¹è±¡ä»¥åŠå¤„ç†å™¨æ‹¦æˆªå™¨ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œä¸€èµ·è¿”å›ç»™ DispatcherServletã€‚</li><li>3ã€å‰ç«¯æ§åˆ¶å™¨è°ƒç”¨å¤„ç†å™¨é€‚é…å™¨ï¼Œé€‚é…å™¨è°ƒç”¨å¯¹åº”çš„ å¤„ç†å™¨ è¿›è¡Œå¤„ç†ç”¨æˆ·è¯·æ±‚</li><li>4ã€ä¸€èˆ¬æ­¤æ—¶ Controller æ–¹æ³•ä¸Šä¼šæ·»åŠ  @ResponseBody æ³¨è§£ï¼Œä¼šè¿›è¡Œå°†è¿”å›ç»“æ„è½¬æ¢ä¸º Json å¹¶å“åº”å‰ç«¯</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290946621.png" alt="image.png"></p><h3 id="SpringBoot-1"><a href="#SpringBoot-1" class="headerlink" title="SpringBoot"></a>SpringBoot</h3><h4 id="è‡ªåŠ¨é…ç½®åŸç†-ğŸš©"><a href="#è‡ªåŠ¨é…ç½®åŸç†-ğŸš©" class="headerlink" title="è‡ªåŠ¨é…ç½®åŸç†  ğŸš©"></a>è‡ªåŠ¨é…ç½®åŸç†  ğŸš©</h4><p>è¿™é“é¢˜ç›®å¾…å¤ä¹ ä¸€ä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290947817.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290948762.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290949754.png" alt="image.png"></p><p>2,å…¶ä¸­@EnableAutoConfigurationæ˜¯å®ç°è‡ªåŠ¨åŒ–é…ç½®çš„æ ¸å¿ƒæ³¨è§£ã€‚</p><ul><li>è¯¥æ³¨è§£é€šè¿‡@Importiæ³¨è§£å¯¼å…¥å¯¹åº”çš„é…ç½®é€‰æ‹©å™¨ã€‚</li><li>å†…éƒ¨å°±æ˜¯è¯»å–äº†è¯¥é¡¹ç›®å’Œè¯¥é¡¹ç›®å¼•ç”¨çš„aråŒ…çš„çš„classpathè·¯å¾„ä¸‹META-NF&#x2F;spring.factoriesæ–‡ä»¶ä¸­çš„æ‰€é…ç½®çš„ç±»çš„å…¨ç±»åã€‚</li><li>åœ¨è¿™äº›é…ç½®ç±»ä¸­æ‰€å®šä¹‰çš„Beanä¼šæ ¹æ®æ¡ä»¶æ³¨è§£æ‰€æŒ‡å®šçš„æ¡ä»¶æ¥å†³å®šæ˜¯å¦éœ€è¦å°†å…¶å¯¼å…¥åˆ°Springå®¹å™¨ä¸­ã€‚</li><li>3,æ¡ä»¶åˆ¤æ–­ä¼šæœ‰åƒ @ConditionalOnClassiè¿™æ ·çš„æ³¨è§£ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å¯¹åº”çš„classæ–‡ä»¶ï¼Œå¦‚æœæœ‰åˆ™åŠ è½½è¯¥ç±»ï¼ŒæŠŠè¿™ä¸ªé…ç½®ç±»çš„æ‰€æœ‰çš„ Beanæ”¾å…¥ springå®¹å™¨ä¸­ä½¿ç”¨.</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402290950693.png" alt="image.png"></p><h3 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h3><h4 id="å’Œ-æ›¿æ¢"><a href="#å’Œ-æ›¿æ¢" class="headerlink" title="# å’Œ { } æ›¿æ¢"></a># å’Œ { } æ›¿æ¢</h4><h4 id="åŠ¨æ€æ ‡ç­¾"><a href="#åŠ¨æ€æ ‡ç­¾" class="headerlink" title="åŠ¨æ€æ ‡ç­¾"></a>åŠ¨æ€æ ‡ç­¾</h4><p>ifã€whereã€set</p><p>selectã€foreachï¼Œ</p><h4 id="æ‰§è¡Œæµç¨‹-ğŸš©"><a href="#æ‰§è¡Œæµç¨‹-ğŸš©" class="headerlink" title="æ‰§è¡Œæµç¨‹  ğŸš©"></a>æ‰§è¡Œæµç¨‹  ğŸš©</h4><hr><p>Mybatis æ‰§è¡Œæµç¨‹</p><ul><li>1ã€ç†è§£å„ä¸ªç»„ä»¶çš„å…³ç³»</li><li>2ã€Sql çš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆå‚æ•°æ˜ å°„ã€sql è§£æã€æ‰§è¡Œå’Œç»“æœå¤„ç†ï¼‰</li></ul><blockquote><p>è®²ä¸€ä¸‹ mybatis çš„é…ç½®æ–‡ä»¶çš„ xml æ–‡ä»¶çš„ä½œç”¨æœ‰å“ªäº›ï¼Ÿ</p></blockquote><ul><li>åŠ è½½æ ¸å¿ƒé…ç½®</li><li>åŠ è½½æ˜ å°„æ–‡ä»¶</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402291030799.png" alt="image.png"></p><p>æ‰§è¡Œæµç¨‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402291131905.png" alt="image.png"></p><p>é¢è¯•é¢˜</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402291132269.png" alt="image.png"></p><h4 id="å»¶è¿ŸåŠ è½½-ğŸš©"><a href="#å»¶è¿ŸåŠ è½½-ğŸš©" class="headerlink" title="å»¶è¿ŸåŠ è½½   ğŸš©"></a>å»¶è¿ŸåŠ è½½   ğŸš©</h4><p>å»¶è¿ŸåŠ è½½æ“ä½œï¼šéœ€è¦é…ç½®æ–‡ä»¶ä¸­å¼€å¯ï¼ˆå…³è”å¯¹è±¡é›†åˆçš„å»¶è¿ŸåŠ è½½ï¼‰</p><p>å®ç°åŸç†ï¼šåŠ¨æ€ä»£ç†ï¼ŒCGLIB</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402291133046.png" alt="image.png"></p><ul><li>1ã€è®¾ç½®å±€éƒ¨çš„å»¶è¿ŸåŠ è½½</li><li>2ã€è®¾ç½®å…¨éƒ¨çš„å»¶è¿ŸåŠ è½½</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402291137882.png" alt="image.png"></p><p>ä¸»è¦çœ‹ä¸€ä¸‹è¿™ä¸ªï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402291138401.png" alt="image.png"></p><h4 id="ä¸€äºŒçº§ç¼“å­˜-ğŸš©"><a href="#ä¸€äºŒçº§ç¼“å­˜-ğŸš©" class="headerlink" title="ä¸€äºŒçº§ç¼“å­˜  ğŸš©"></a>ä¸€äºŒçº§ç¼“å­˜  ğŸš©</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402291142061.png" alt="image.png"><br>äºŒçº§ç¼“å­˜</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402291144414.png" alt="image.png"></p><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>1ã€å¯¹äºç¼“å­˜æ•°æ®æ›´æ–°æœºåˆ¶ï¼Œå½“æŸä¸€ä¸ªä½œç”¨åŸŸï¼ˆä¸€çº§ç¼“å­˜Session&#x2F;,äºŒçº§ç¼“å­˜Namespaces)çš„è¿›è¡Œäº†æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤æ“ä½œåï¼Œé»˜è®¤è¯¥ä½œç”¨åŸŸä¸‹æ‰€æœ‰ select ä¸­çš„ç¼“å­˜å°†è¢«clear</li><li>2,äºŒçº§ç¼“å­˜éœ€è¦ç¼“å­˜çš„æ•°æ®å®ç° Serializable æ¥å£</li><li>3,åªæœ‰ä¼šè¯æäº¤æˆ–è€…å…³é—­ä»¥åï¼Œä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®æ‰ä¼šè½¬ç§»åˆ°äºŒçº§ç¼“å­˜ä¸­</li></ul><p>é¢è¯•é¢˜ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402291146216.png" alt="image.png"></p><ul><li><p>ç¼“å­˜  </p><ul><li>ä¸€çº§ç¼“å­˜ï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰  <ul><li>ä¸€çº§ç¼“å­˜æ˜¯ SqlSession çº§åˆ«çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åœ¨åŒä¸€ä¸ª SqlSession ä¸­çš„æ“ä½œæ‰èƒ½å…±äº«è¿™ä¸ªç¼“å­˜ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€çº§ç¼“å­˜æ˜¯å¼€å¯çš„</li></ul></li><li>äºŒçº§ç¼“å­˜ï¼ˆå…¨å±€ç¼“å­˜ï¼‰  <ul><li>äºŒçº§ç¼“å­˜æ˜¯è·¨ SqlSession çš„ï¼Œå®ƒæ˜¯åŸºäº namespace çº§åˆ«çš„ï¼Œå³åŒä¸€ä¸ª namespace çš„ä¸åŒ SqlSession å¯ä»¥å…±äº«è¯¥ç¼“å­˜  </li><li>éœ€è¦æ˜¾å¼å¼€å¯ã€‚å¯ä»¥åœ¨ MyBatis é…ç½®æ–‡ä»¶ä¸­å…¨å±€å¼€å¯ï¼Œä¹Ÿå¯ä»¥åœ¨ mapper æ˜ å°„æ–‡ä»¶ä¸­å•ç‹¬é…ç½®ä½¿ç”¨äºŒçº§ç¼“å­˜          </li><li>å½“ä¸€ä¸ª SqlSession æŸ¥è¯¢å®Œæ•°æ®å¹¶æäº¤æˆ–å…³é—­æ—¶ï¼Œæ•°æ®ä¼šä»ä¸€çº§ç¼“å­˜è½¬ç§»åˆ°äºŒçº§ç¼“å­˜ä¸­ã€‚å½“å¦ä¸€ä¸ª SqlSession æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œä¼šå…ˆæŸ¥çœ‹äºŒçº§ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼›å¦‚æœæ²¡æœ‰ï¼Œæ‰ä¼šè®¿é—®æ•°æ®åº“ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœæ”¾å…¥äºŒçº§ç¼“å­˜</li></ul></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_JavaåŸºç¡€</title>
    <link href="/2024/03/09/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_Java%E5%9F%BA%E7%A1%80/"/>
    <url>/2024/03/09/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_Java%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><h4 id="Java-è¯­è¨€çš„ç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ"><a href="#Java-è¯­è¨€çš„ç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Java è¯­è¨€çš„ç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ"></a>Java è¯­è¨€çš„ç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ</h4><ul><li>Java ç”Ÿæ€ä¸°å¯Œ</li><li>å¹³å°æ— å…³æ€§</li><li>é¢å‘å¯¹è±¡ï¼šç»§æ‰¿ã€å°è£…ã€å¤šæ€</li></ul><h4 id="é¢å‘å¯¹è±¡ä¸é¢å‘è¿‡ç¨‹"><a href="#é¢å‘å¯¹è±¡ä¸é¢å‘è¿‡ç¨‹" class="headerlink" title="é¢å‘å¯¹è±¡ä¸é¢å‘è¿‡ç¨‹"></a>é¢å‘å¯¹è±¡ä¸é¢å‘è¿‡ç¨‹</h4><ul><li>é¢å‘å¯¹è±¡<ul><li>å°†å…·ä½“çš„äº‹åŠ¡æŠ½è±¡ï¼Œå°è£…å…¶ä¸­çš„è¡Œä¸ºæ–¹æ³•ï¼Œè¿›è¡Œå®ç°çš„ä¸€ç§æ–¹å¼</li></ul></li><li>é¢å‘è¿‡ç¨‹<ul><li>é¡ºåºæ‰§è¡Œï¼ŒæŒ‰ç…§æ­¥éª¤å¤„ç†</li></ul></li></ul><h4 id="Java-çš„åŸºæœ¬æ•°æ®ç±»å‹"><a href="#Java-çš„åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="Java çš„åŸºæœ¬æ•°æ®ç±»å‹"></a>Java çš„åŸºæœ¬æ•°æ®ç±»å‹</h4><ul><li>åŸºæœ¬æ•°æ®ç±»å‹   é»˜è®¤å ç”¨ç©ºé—´  é»˜è®¤å€¼   åŒ…è£…ç±»å‹   å–å€¼èŒƒå›´</li><li>byte    1å­—èŠ‚    0     Byte    -128-127</li><li>char     2å­—èŠ‚   â€˜\u0000â€™    Character</li><li>short   2å­—èŠ‚   0     Short</li><li>int        4å­—èŠ‚   0     Integer</li><li>long     8å­—èŠ‚   0L   Long</li><li>float     4å­—èŠ‚   0.0f     Float</li><li>double   8 å­—èŠ‚    0.0d   Double</li><li>boolean   1å­—èŠ‚     false    Boolean</li></ul><h4 id="ä»€ä¹ˆä¸‹ä¼šä½¿ç”¨åŒ…è£…ç±»ï¼Œè‡ªåŠ¨æ‹†è£…ç®±äº†è§£å—ï¼Œå¸¸é‡æ± æŠ€æœ¯æ˜¯å¦æ¸…æ¥šã€‚"><a href="#ä»€ä¹ˆä¸‹ä¼šä½¿ç”¨åŒ…è£…ç±»ï¼Œè‡ªåŠ¨æ‹†è£…ç®±äº†è§£å—ï¼Œå¸¸é‡æ± æŠ€æœ¯æ˜¯å¦æ¸…æ¥šã€‚" class="headerlink" title="ä»€ä¹ˆä¸‹ä¼šä½¿ç”¨åŒ…è£…ç±»ï¼Œè‡ªåŠ¨æ‹†è£…ç®±äº†è§£å—ï¼Œå¸¸é‡æ± æŠ€æœ¯æ˜¯å¦æ¸…æ¥šã€‚"></a>ä»€ä¹ˆä¸‹ä¼šä½¿ç”¨åŒ…è£…ç±»ï¼Œè‡ªåŠ¨æ‹†è£…ç®±äº†è§£å—ï¼Œå¸¸é‡æ± æŠ€æœ¯æ˜¯å¦æ¸…æ¥šã€‚</h4><h4 id="å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’"><a href="#å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’" class="headerlink" title="å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’"></a>å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’</h4><ul><li>å€¼ä¼ é€’<ul><li>æ˜¯å¯¹åŸºæœ¬æ•°æ®ç±»å‹â½½â¾”ï¼Œåªè¿›â¾å€¼çš„æ‹·â»‰ï¼Œä¸ä¼šå½±å“åŸå˜é‡</li></ul></li><li>å¼•ç”¨ä¼ é€’<ul><li>å¯¹å¯¹è±¡â½½â¾”ï¼Œä¸æ˜¯ä¼ é€’å¯¹è±¡çš„å€¼ï¼Œâ½½æ˜¯ä¼ é€’å¯¹è±¡çš„åœ°å€ï¼Œ å¦‚æœå‰¯æœ¬æ”¹å˜ä¼šå½±å“åˆ°åŸå¯¹è±¡</li></ul></li></ul><h4 id="String-ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„"><a href="#String-ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„" class="headerlink" title="String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„"></a>String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„</h4><h4 id="finalã€finallyã€finalize-çš„åŒºåˆ«"><a href="#finalã€finallyã€finalize-çš„åŒºåˆ«" class="headerlink" title="finalã€finallyã€finalize çš„åŒºåˆ«"></a>finalã€finallyã€finalize çš„åŒºåˆ«</h4><h4 id="Stringã€StringBufferã€StringBuilder-çš„åŒºåˆ«"><a href="#Stringã€StringBufferã€StringBuilder-çš„åŒºåˆ«" class="headerlink" title="Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«"></a>Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«</h4><h4 id="åŒ…è£…ç±»å‹çš„å¸¸é‡æ± æŠ€æœ¯äº†è§£å—ã€‚"><a href="#åŒ…è£…ç±»å‹çš„å¸¸é‡æ± æŠ€æœ¯äº†è§£å—ã€‚" class="headerlink" title="åŒ…è£…ç±»å‹çš„å¸¸é‡æ± æŠ€æœ¯äº†è§£å—ã€‚"></a>åŒ…è£…ç±»å‹çš„å¸¸é‡æ± æŠ€æœ¯äº†è§£å—ã€‚</h4><ul><li>å¸¸é‡æ± æŠ€æœ¯æ˜¯åŒ…è£…ç±»å‹çš„ä¸€ç§ç¼“å­˜æŠ€æœ¯ï¼Œèƒ½å¤Ÿå‡å°‘å¯¹è±¡çš„åˆ›å»ºå’Œå†…å­˜ä½¿ç”¨ï¼Œå½“æ•°æ®çš„å€¼åœ¨ä¸€ä¸ªèŒƒå›´ä¸­ï¼Œæ¯”å¦‚ Integer å¯¹åº”çš„åˆ›å»ºå€¼åœ¨ -128 - 127ï¼›é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ Java ä¼šä»å¸¸é‡æ± ä¸­è¿”å›å·²å­˜åœ¨çš„å¯¹è±¡è€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li></ul><h4 id="åŒ…è£…ç±»å‹å’ŒåŸºç¡€æ•°æ®ç±»å‹çš„åŒºåˆ«"><a href="#åŒ…è£…ç±»å‹å’ŒåŸºç¡€æ•°æ®ç±»å‹çš„åŒºåˆ«" class="headerlink" title="åŒ…è£…ç±»å‹å’ŒåŸºç¡€æ•°æ®ç±»å‹çš„åŒºåˆ«"></a>åŒ…è£…ç±»å‹å’ŒåŸºç¡€æ•°æ®ç±»å‹çš„åŒºåˆ«</h4><ul><li>ä¸ºä»€ä¹ˆè¦æœ‰åŒ…è£…ç±»å‹<ul><li>åŒ…è£…ç±»å‹æ˜¯å¯¹è±¡ç±»å‹ï¼Œèƒ½å¤Ÿåœ¨Java ä½¿ç”¨ä¸€äº›å¯¹è±¡ç‰¹æ€§ï¼Œæ¯”å¦‚å‚ä¸åˆ°é›†åˆç±»ã€æ³›å‹ã€åºåˆ—åŒ–ç­‰</li><li>å¦å¤–åŒ…è£…ç±»å‹æ˜¯å…è®¸ç©ºå€¼çš„ï¼Œä»–åœ¨ä¸€äº›åœºæ™¯ä¸‹ç”¨äºåŒºåˆ†â€œæ— æ•°æ®â€å’Œâ€œé›¶å€¼â€æ—¶ æ˜¯éå¸¸æœ‰ç”¨çš„ï¼›</li></ul></li><li>åŒºåˆ«<ul><li>å†…å­˜åˆ†é…ä¸åŒï¼šåŸºç¡€æ•°æ®ç±»å‹ â†’  æ ˆï¼›åŒ…è£…ç±»å‹  â†’  å †ï¼›</li><li>é»˜è®¤å€¼ä¸åŒï¼šæ¯”å¦‚ int â†’  0ï¼› Integer â†’  null</li><li>å†…å­˜å ç”¨ã€ä½¿ç”¨åœºæ™¯ã€æ€§èƒ½ä¼šæœ‰ä¸€äº›å·®åˆ«ã€‚</li></ul></li></ul><h4 id="è‡ªåŠ¨æ‹†è£…ç®±çš„åŸç†"><a href="#è‡ªåŠ¨æ‹†è£…ç®±çš„åŸç†" class="headerlink" title="è‡ªåŠ¨æ‹†è£…ç®±çš„åŸç†"></a>è‡ªåŠ¨æ‹†è£…ç®±çš„åŸç†</h4><ul><li>è‡ªåŠ¨æ‹†è£…ç®±<ul><li>è‡ªåŠ¨æ‹†ç®±ï¼šå°† åŒ…è£…ç±» è‡ªåŠ¨è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹</li><li>è‡ªåŠ¨è£…ç®±ï¼šå°† åŸºæœ¬æ•°æ®ç±»å‹ è½¬æ¢ä¸º åŒ…è£…ç±»</li></ul></li><li>åŸç†<ul><li>è£…ç®±ï¼šé€šè¿‡è°ƒç”¨åŒ…è£…ç±»çš„ valueOf æ–¹æ³•</li><li>æ‹†ç®±ï¼šé€šè¿‡è°ƒç”¨åŒ…è£…ç±»çš„ xxxValue æ–¹æ³•</li></ul></li></ul><h4 id="é‡åˆ°è¿‡è‡ªåŠ¨æ‹†ç®±å¼•å‘çš„-NPE-é—®é¢˜å—"><a href="#é‡åˆ°è¿‡è‡ªåŠ¨æ‹†ç®±å¼•å‘çš„-NPE-é—®é¢˜å—" class="headerlink" title="é‡åˆ°è¿‡è‡ªåŠ¨æ‹†ç®±å¼•å‘çš„ NPE é—®é¢˜å—"></a>é‡åˆ°è¿‡è‡ªåŠ¨æ‹†ç®±å¼•å‘çš„ NPE é—®é¢˜å—</h4><ul><li>ä»€ä¹ˆæƒ…å†µä¸‹é‡åˆ°ï¼šå½“ åŒ…è£…ç±»å‹çš„å¼•ç”¨ä¸º<code>null</code>ï¼Œè‡ªåŠ¨æ‹†ç®±ä¼šè§¦å‘ NPE</li><li>è§£å†³ï¼šå°½é‡ä½¿ç”¨ç©ºå€¼æˆ–è€…é»˜è®¤å€¼çš„æ–¹å¼é¿å…</li></ul><h4 id="switch-case-æ”¯æŒå“ªå‡ ç§æ•°æ®ç±»å‹"><a href="#switch-case-æ”¯æŒå“ªå‡ ç§æ•°æ®ç±»å‹" class="headerlink" title="switch case æ”¯æŒå“ªå‡ ç§æ•°æ®ç±»å‹"></a>switch case æ”¯æŒå“ªå‡ ç§æ•°æ®ç±»å‹</h4><ul><li><strong>æ•´æ•°ç±»å‹</strong>ã€æšä¸¾ç±»å‹ã€å­—ç¬¦ä¸²</li></ul><h4 id="ä»€ä¹ˆæ˜¯å€¼ä¼ é€’å’Œå¼•â½¤ä¼ é€’"><a href="#ä»€ä¹ˆæ˜¯å€¼ä¼ é€’å’Œå¼•â½¤ä¼ é€’" class="headerlink" title="ä»€ä¹ˆæ˜¯å€¼ä¼ é€’å’Œå¼•â½¤ä¼ é€’"></a>ä»€ä¹ˆæ˜¯å€¼ä¼ é€’å’Œå¼•â½¤ä¼ é€’</h4><ul><li>å€¼ä¼ é€’æ˜¯å¯¹åŸºæœ¬æ•°æ®ç±»å‹â½½â¾”ï¼Œ<strong>åªè¿›â¾å€¼çš„æ‹·â»‰</strong>ï¼Œä¸ä¼šå½±å“åŸå˜é‡</li><li>å¼•â½¤ä¼ é€’æ˜¯å¯¹å¯¹è±¡â½½â¾”ï¼Œä¸æ˜¯ä¼ é€’å¯¹è±¡çš„å€¼ï¼Œ<strong>â½½æ˜¯ä¼ é€’å¯¹è±¡çš„åœ°å€</strong>ï¼Œ å¦‚æœå‰¯æœ¬æ”¹å˜ä¼šå½±å“åˆ°åŸå¯¹è±¡</li></ul><h4 id="finalã€finallyã€finalizeçš„åŒºåˆ«"><a href="#finalã€finallyã€finalizeçš„åŒºåˆ«" class="headerlink" title="finalã€finallyã€finalizeçš„åŒºåˆ«"></a>finalã€finallyã€finalizeçš„åŒºåˆ«</h4><ul><li>finalä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€å±æ€§æ˜¯å¸¸é‡â½½ä¸”å¿…é¡»åˆå§‹åŒ–ã€ä¿®é¥°çš„â½…æ³• ä¸èƒ½è¢«é‡å†™</li><li>finallyâ½¤äºå¼‚å¸¸å¤„ç†ï¼Œfinallyä»£ç å—ä¸­çš„å†…å®¹â¼€å®šä¼šæ‰§â¾</li><li>finalizeæ˜¯Objectç±»çš„â¼€ä¸ªâ½…æ³•ï¼Œå½“æˆ‘ä»¬è°ƒâ½¤system.gc()æ—¶ä¼šè°ƒâ½¤ï¼Œä¹Ÿ å¯ä»¥ä½¿â½¤å®ƒåœ¨GCæ—¶â¾ƒæ•‘â¼€æ¬¡<ul><li>é‡å†™finalizeâ½…æ³•çš„å¯¹è±¡ä¼šè¢«åŠ â¼Šåˆ°â¼€ä¸ª unfinalized é“¾è¡¨ä¸­ï¼Œâ¾¸æ¬¡ GCæ—¶ä¸ä¼šå›æ”¶è¯¥å¯¹è±¡ï¼Œè°ƒâ½¤å®Œfinalizeåï¼Œç„¶åä»unfinalizedé“¾è¡¨ å‰”é™¤ï¼Œæ­¤æ—¶å¯¹è±¡å¯ä»¥è¿›â¾â¾ƒæ•‘ï¼Œå°†â¾ƒâ¼°é‡æ–°åŠ â¼Šåˆ°å¼•â½¤é“¾ä¸Šï¼Œä¸‹ â¼€æ¬¡GCæ—¶ä¼šè¿›â¾å›æ”¶</li></ul></li></ul><hr><blockquote><p>å…³äºå¯¹ finialize çš„è§£é‡Šï¼š</p></blockquote><p>Javaä¸­<code>finalize()</code>æ–¹æ³•çš„å·¥ä½œåŸç†ä»¥åŠ finalize æ–¹æ³• ä¸åƒåœ¾å›æ”¶ï¼ˆGCï¼‰è¿‡ç¨‹çš„å…³ç³»</p><ul><li><code>finalize()</code>æ–¹æ³•æ˜¯<code>java.lang.Object</code>ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼ŒJavaå…è®¸å­ç±»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œä»¥å®ç°èµ„æºçš„æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶å¥æŸ„æˆ–è€…é‡Šæ”¾ç½‘ç»œèµ„æºç­‰ã€‚</li><li>ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»Java 9å¼€å§‹ï¼Œ<code>finalize()</code>æ–¹æ³•å·²è¢«æ ‡è®°ä¸ºåºŸå¼ƒï¼ˆdeprecatedï¼‰ï¼Œå› ä¸ºå®ƒçš„ä½¿ç”¨æ˜¯ä¸æ¨èçš„ï¼Œä¸»è¦å› ä¸ºå®ƒçš„ä¸ç¡®å®šæ€§ã€ä½æ•ˆç‡å’Œå¯èƒ½å¯¼è‡´çš„å†…å­˜æ³„éœ²é—®é¢˜ã€‚</li></ul><p>ä»¥ä¸‹æ˜¯<code>finalize()</code>æ–¹æ³•å·¥ä½œæœºåˆ¶çš„è¯¦ç»†è§£é‡Šï¼š</p><ol><li><strong>é‡å†™<code>finalize()</code>æ–¹æ³•çš„å¯¹è±¡è¢«åŠ å…¥åˆ°ä¸€ä¸ª<code>unfinalized</code>é“¾è¡¨ä¸­</strong>ï¼šå½“ä¸€ä¸ªå¯¹è±¡é‡å†™äº†<code>finalize()</code>æ–¹æ³•ï¼Œä¸”è¯¥å¯¹è±¡å˜æˆäº†åƒåœ¾ï¼ˆå³æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘å®ƒï¼‰ï¼ŒJVMå°±ä¼šå°†è¿™ä¸ªå¯¹è±¡åŠ å…¥åˆ°ä¸€ä¸ªä¸“é—¨çš„åˆ—è¡¨ï¼ˆç§°ä¸º<code>unfinalized</code>é“¾è¡¨ï¼‰ä¸­ã€‚è¿™æ„å‘³ç€ï¼Œå°½ç®¡è¿™ä¸ªå¯¹è±¡å·²ç»æ²¡æœ‰è¢«ä»»ä½•å¼ºå¼•ç”¨æŒ‡å‘ï¼Œä½†å› ä¸ºé‡å†™äº†<code>finalize()</code>æ–¹æ³•ï¼Œå®ƒåœ¨ç¬¬ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ä¸ä¼šç«‹å³è¢«æ¸…ç†ã€‚</li><li><strong>é¦–æ¬¡GCæ—¶ä¸ä¼šå›æ”¶è¯¥å¯¹è±¡</strong>ï¼šå½“åƒåœ¾å›æ”¶å™¨è¿è¡Œæ—¶ï¼Œå®ƒä¼šæ£€æµ‹åˆ°<code>unfinalized</code>é“¾è¡¨ä¸­çš„å¯¹è±¡ã€‚å¯¹äºè¿™äº›å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶å™¨ä¸ä¼šç›´æ¥å›æ”¶å®ƒä»¬ï¼Œè€Œæ˜¯å…ˆè°ƒç”¨å®ƒä»¬çš„<code>finalize()</code>æ–¹æ³•ï¼Œç›®çš„æ˜¯ç»™è¿™äº›å¯¹è±¡ä¸€ä¸ªæ¸…ç†èµ„æºçš„æœºä¼šã€‚</li><li><strong>è°ƒç”¨å®Œ<code>finalize()</code>åï¼Œä»<code>unfinalized</code>é“¾è¡¨å‰”é™¤</strong>ï¼šä¸€æ—¦å¯¹è±¡çš„<code>finalize()</code>æ–¹æ³•è¢«è°ƒç”¨ï¼Œä¸è®ºè¿™ä¸ªæ–¹æ³•å†…éƒ¨åšäº†ä»€ä¹ˆï¼ˆå³ä½¿æ˜¯ç©ºæ“ä½œï¼‰ï¼Œè¯¥å¯¹è±¡ä¼šè¢«ä»<code>unfinalized</code>é“¾è¡¨ä¸­ç§»é™¤ã€‚æ­¤æ—¶ï¼Œå¦‚æœå¯¹è±¡æ²¡æœ‰åœ¨å…¶<code>finalize()</code>æ–¹æ³•ä¸­é‡æ–°è¢«å¼•ç”¨ï¼ˆå³æ‰€è°“çš„â€œè‡ªæ•‘â€ï¼‰ï¼Œå®ƒå°±ä¼šåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶è¢«æ¸…ç†ã€‚</li><li><strong>å¯¹è±¡å¯ä»¥è¿›è¡Œè‡ªæ•‘</strong>ï¼šåœ¨<code>finalize()</code>æ–¹æ³•æ‰§è¡ŒæœŸé—´ï¼Œå¯¹è±¡æœ‰æœºä¼šå°†è‡ªå·±â€œè‡ªæ•‘â€ï¼Œå³åœ¨æ–¹æ³•å†…éƒ¨ä½¿è‡ªå·±é‡æ–°è¢«å¼•ç”¨ï¼ˆæ¯”å¦‚ï¼Œå°†è‡ªå·±èµ‹å€¼ç»™æŸä¸ªç±»å˜é‡æˆ–è€…å¯¹è±¡çš„é™æ€å˜é‡ï¼‰ã€‚è¿™æ ·åšå¯ä»¥é˜»æ­¢å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨åœ¨å½“å‰å›æ”¶å‘¨æœŸå†…æ¸…ç†ã€‚</li><li><strong>ä¸‹ä¸€æ¬¡GCæ—¶ä¼šè¿›è¡Œå›æ”¶</strong>ï¼šå¦‚æœå¯¹è±¡åœ¨æ‰§è¡Œ<code>finalize()</code>æ–¹æ³•åæ²¡æœ‰è¿›è¡Œè‡ªæ•‘ï¼Œæˆ–è€…å·²ç»æ˜¯ç¬¬äºŒæ¬¡è§¦å‘åƒåœ¾å›æ”¶ï¼ˆå³å·²ç»è°ƒç”¨è¿‡<code>finalize()</code>æ–¹æ³•ï¼‰ï¼Œåˆ™åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å°†è¢«å½»åº•å›æ”¶ã€‚</li></ol><p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œè™½ç„¶<code>finalize()</code>æ–¹æ³•æä¾›äº†ä¸€ç§æœºåˆ¶è®©å¯¹è±¡åœ¨è¢«å›æ”¶å‰æœ‰æœºä¼šæ¸…ç†èµ„æºï¼Œä½†ç”±äºå®ƒçš„ä¸ç¡®å®šæ€§å’Œæ‰§è¡Œæˆæœ¬ï¼Œä»¥åŠå¯èƒ½å¯¼è‡´çš„é—®é¢˜ï¼ˆå¦‚å¯¹è±¡è‡ªæ•‘å¯¼è‡´çš„å†…å­˜æ³„éœ²ï¼‰ï¼Œåœ¨å®é™…ç¼–ç¨‹ä¸­åº”é¿å…ä½¿ç”¨ã€‚</p><p>Javaæä¾›äº†å…¶ä»–èµ„æºç®¡ç†æœºåˆ¶ï¼Œå¦‚<code>try-with-resources</code>è¯­å¥å’Œ<code>AutoCloseable</code>æ¥å£ï¼Œè¿™äº›æœºåˆ¶åº”è¯¥è¢«ä¼˜å…ˆè€ƒè™‘ç”¨äºèµ„æºçš„æ¸…ç†ã€‚</p><p>ä¸€ä¸ªç®€å•çš„è‡ªæ•‘ç¤ºä¾‹ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SelfRescueDemo</span> &#123;<br><br>    <span class="hljs-comment">// ç”¨äºä¿å­˜å¯¹è±¡çš„å¼•ç”¨ï¼Œä»¥å®ç°&quot;è‡ªæ•‘&quot;</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SelfRescueDemo rescueInstance = <span class="hljs-literal">null</span>;<br><br>    @Override<br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">finalize</span>() throws Throwable</span> &#123;<br>        super.finalize();<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;finalize method executed!&quot;</span>);<br>        <span class="hljs-comment">// è‡ªæ•‘æ“ä½œï¼šå°†thisèµ‹å€¼ç»™rescueInstance</span><br>        SelfRescueDemo.rescueInstance = <span class="hljs-keyword">this</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>) throws InterruptedException</span> &#123;<br>        rescueInstance = <span class="hljs-keyword">new</span> SelfRescueDemo();<br><br>        <span class="hljs-comment">// ç¬¬ä¸€æ¬¡å°è¯•è‡ªæ•‘</span><br>        rescueInstance = <span class="hljs-literal">null</span>; <span class="hljs-comment">// å–æ¶ˆå¼•ç”¨</span><br>        System.gc(); <span class="hljs-comment">// æç¤ºJVMè¿›è¡Œåƒåœ¾å›æ”¶</span><br>        Thread.sleep(<span class="hljs-number">500</span>); <span class="hljs-comment">// ç•™å‡ºæ—¶é—´ç»™åƒåœ¾å›æ”¶å™¨æ‰§è¡Œ</span><br><br>        <span class="hljs-keyword">if</span> (rescueInstance != <span class="hljs-literal">null</span>) &#123;<br>            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;First rescue successful!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;First rescue failed.&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// ç¬¬äºŒæ¬¡å°è¯•è‡ªæ•‘</span><br>        rescueInstance = <span class="hljs-literal">null</span>; <span class="hljs-comment">// å†æ¬¡å–æ¶ˆå¼•ç”¨</span><br>        System.gc(); <span class="hljs-comment">// å†æ¬¡æç¤ºJVMè¿›è¡Œåƒåœ¾å›æ”¶</span><br>        Thread.sleep(<span class="hljs-number">500</span>); <span class="hljs-comment">// å†æ¬¡ç•™å‡ºæ—¶é—´ç»™åƒåœ¾å›æ”¶å™¨æ‰§è¡Œ</span><br><br>        <span class="hljs-keyword">if</span> (rescueInstance != <span class="hljs-literal">null</span>) &#123;<br>            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Second rescue successful!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Second rescue failed. Object has been collected.&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>SelfRescueDemo</code>ç±»é‡å†™äº†<code>finalize()</code>æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­å®ç°äº†è‡ªæ•‘é€»è¾‘ã€‚å½“<code>rescueInstance</code>å¯¹è±¡ç¬¬ä¸€æ¬¡å˜ä¸ºåƒåœ¾æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šè°ƒç”¨å®ƒçš„<code>finalize()</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå¯¹è±¡æŠŠè‡ªå·±çš„å¼•ç”¨èµ‹ç»™äº†é™æ€å˜é‡<code>rescueInstance</code>ï¼Œä»è€Œè¾¾åˆ°äº†è‡ªæ•‘çš„ç›®çš„ã€‚åœ¨ç¬¬ä¸€è½®åƒåœ¾å›æ”¶åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰“å°å‡ºäº†â€finalize method executed!â€å’Œâ€First rescue successful!â€ï¼Œè¯´æ˜å¯¹è±¡æˆåŠŸè‡ªæ•‘ã€‚</p><p>ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»»ä½•å¯¹è±¡çš„<code>finalize()</code>æ–¹æ³•åªä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡ã€‚å¦‚æœå¯¹è±¡åœ¨å®Œæˆé¦–æ¬¡è‡ªæ•‘åå†æ¬¡å˜æˆæ— å¼•ç”¨çŠ¶æ€ï¼Œåƒåœ¾å›æ”¶å™¨åœ¨ä¸‹ä¸€æ¬¡å›æ”¶æ—¶ä¸ä¼šå†æ¬¡è°ƒç”¨å®ƒçš„<code>finalize()</code>æ–¹æ³•ï¼Œè¿™æ¬¡å¯¹è±¡å°†è¢«ç›´æ¥å›æ”¶ã€‚å› æ­¤ï¼Œåœ¨ç¬¬äºŒæ¬¡è®¾ç½®<code>rescueInstance</code>ä¸º<code>null</code>å¹¶è§¦å‘åƒåœ¾å›æ”¶åï¼Œä¼šæ‰“å°å‡ºâ€Second rescue failed. Object has been collected.â€ï¼Œè¡¨ç¤ºå¯¹è±¡æ²¡æœ‰è¢«å†æ¬¡è‡ªæ•‘ï¼Œå·²ç»è¢«å›æ”¶ã€‚</p><p>è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¯¹è±¡è‡ªæ•‘çš„æ¦‚å¿µå’Œå±€é™æ€§ã€‚ç„¶è€Œï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œä¾èµ–<code>finalize()</code>æ–¹æ³•è¿›è¡Œèµ„æºæ¸…ç†æˆ–è‡ªæ•‘æ˜¯ä¸æ¨èçš„åšæ³•ï¼Œå› ä¸ºå®ƒçš„æ‰§è¡Œæ—¶é—´æ˜¯ä¸ç¡®å®šçš„ï¼Œè€Œä¸”å¯èƒ½å¯¼è‡´èµ„æºé‡Šæ”¾ä¸åŠæ—¶æˆ–è€…å…¶ä»–é—®é¢˜ã€‚ä½¿ç”¨Javaæä¾›çš„å…¶ä»–èµ„æºç®¡ç†æœºåˆ¶ï¼Œå¦‚<code>try-with-resources</code>è¯­å¥ï¼Œæ˜¯ä¸€ç§æ›´å¥½çš„åšæ³•ã€‚</p><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><h4 id="Stringä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„"><a href="#Stringä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„" class="headerlink" title="Stringä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„"></a>Stringä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„</h4><ul><li>Stringå†…éƒ¨ç»´æŠ¤çš„æ˜¯private final char&#x2F;byteæ•°ç»„ï¼Œ<strong>ä¸å¯å˜çº¿ç¨‹å®‰å…¨</strong></li><li>å¥½å¤„<ul><li>é˜²â½Œè¢«æ¶æ„ç¯¡æ”¹</li><li>ä½œä¸ºHashMapçš„keyå¯ä»¥ä¿è¯ä¸å¯å˜æ€§</li><li>å¯ä»¥å®ç°å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œåœ¨Javaä¸­ï¼Œåˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡çš„â½…å¼<ul><li>é€šè¿‡å­—ç¬¦ä¸²å¸¸é‡è¿›â¾åˆ›å»º<ul><li>åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±è¿”å›ï¼Œä¸å­˜ åœ¨å°±åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± åˆ›å»ºåè¿”å›</li></ul></li><li>é€šè¿‡newå­—ç¬¦ä¸²å¯¹è±¡è¿›â¾åˆ›å»º<ul><li>åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œ<strong>å¦‚æœä¸å­˜åœ¨å°±åˆ›å»º</strong>ï¼Œ å†åˆ¤æ–­å †ä¸­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»ºï¼Œç„¶åè¿”å›è¯¥ å¯¹è±¡ï¼Œæ€»ä¹‹è¦<strong>ä¿è¯å­—ç¬¦ä¸²å¸¸é‡æ± å’Œå †ä¸­éƒ½æœ‰è¯¥å¯¹è±¡</strong></li></ul></li></ul></li></ul></li></ul><p>å¯ä»¥è®²ä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„ï¼Œç„¶åè®²ä¸€ä¸‹è¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„ã€‚</p><h4 id="Stringã€StringBufferã€StringBuilder-çš„åŒºåˆ«-1"><a href="#Stringã€StringBufferã€StringBuilder-çš„åŒºåˆ«-1" class="headerlink" title="Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«"></a>Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«</h4><ul><li>String:  ä¸å¯å˜ï¼Œçº¿ç¨‹å®‰å…¨<ul><li>å†…éƒ¨ç»´æŠ¤çš„æ˜¯private final char&#x2F;byteæ•°ç»„ï¼ˆä¸å¯å˜ï¼‰</li></ul></li><li>StringBuilderï¼šå¯å˜å­—ç¬¦ä¸²ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼›å¯ä»¥ä½¿â½¤appendè¿›â¾æ‹¼æ¥å­—ç¬¦ä¸²</li><li>StringBufferï¼šå¯å˜å­—ç¬¦ä¸²ï¼Œçº¿ç¨‹å®‰å…¨ï¼›é€šè¿‡synchronizedæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ“ä½œå’Œ StringBuilderâ¼€æ ·<ul><li>synchronizedå¯¹äºå‡ºç°åœ¨å¾ªç¯ä¸­ä¼šè¿›â¾<strong>é”ç²—åŒ–</strong>ï¼Œä¼šå°†é”çš„èŒƒå›´æ‰© å±•åˆ°æ•´ä¸ªæ“ä½œï¼Œä»â½½é¿å…é¢‘ç¹è¿›â¾é”æ“ä½œé€ æˆæ€§èƒ½å¼€é”€</li></ul></li></ul><p>String â†’  StringBuffer  â†’ Synchronized â†’  é”ç²—åŒ–</p><h4 id="StringBufferã€StringBuilder-é»˜è®¤å®¹é‡å¤§å°ã€‚"><a href="#StringBufferã€StringBuilder-é»˜è®¤å®¹é‡å¤§å°ã€‚" class="headerlink" title="StringBufferã€StringBuilder é»˜è®¤å®¹é‡å¤§å°ã€‚"></a>StringBufferã€StringBuilder é»˜è®¤å®¹é‡å¤§å°ã€‚</h4><p>ä¸¤ä¸ªçš„é»˜è®¤å®¹é‡å¤§å°éƒ½æ˜¯ 16 å­—ç¬¦ã€‚</p><h4 id="String-å­—ç¬¦ä¸²å¦‚ä½•å®ç°ç¼–ç è½¬æ¢ã€‚"><a href="#String-å­—ç¬¦ä¸²å¦‚ä½•å®ç°ç¼–ç è½¬æ¢ã€‚" class="headerlink" title="String å­—ç¬¦ä¸²å¦‚ä½•å®ç°ç¼–ç è½¬æ¢ã€‚"></a>String å­—ç¬¦ä¸²å¦‚ä½•å®ç°ç¼–ç è½¬æ¢ã€‚</h4><p>ä¸€èˆ¬æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼š1. å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º byte å­—èŠ‚æ•°ç»„ï¼›2. ç„¶åå†å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p><h3 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h3><h4 id="é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«"><a href="#é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«" class="headerlink" title="é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«"></a>é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«</h4><ul><li>â¾¯å‘è¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºæŒ‰æ­¥éª¤å¤„ç†é—®é¢˜ </li><li>â¾¯å‘å¯¹è±¡å¯ä»¥ç†è§£ä¸ºå°†å…·ä½“äº‹åŠ¡å­˜åœ¨çš„å±æ€§ã€â¾ä¸ºæŠ½è±¡å‡ºæ¥ï¼Œç„¶åå» è¿›â¾å®ç°</li></ul><h4 id="å°è£…ã€ç»§æ‰¿å’Œå¤šæ€"><a href="#å°è£…ã€ç»§æ‰¿å’Œå¤šæ€" class="headerlink" title="å°è£…ã€ç»§æ‰¿å’Œå¤šæ€"></a>å°è£…ã€ç»§æ‰¿å’Œå¤šæ€</h4><ul><li><strong>å°è£…</strong>ï¼šéšè—å¯¹è±¡çš„ç»†èŠ‚å’Œå¤æ‚æ€§ï¼ŒåŒæ—¶æä¾›å…¬å…±çš„è®¿é—®æ–¹æ³•ã€‚å°è£…é€šè¿‡è®¿é—®æ§åˆ¶ä¿æŠ¤äº†å¯¹è±¡çš„çŠ¶æ€ã€‚</li><li><strong>ç»§æ‰¿</strong>ï¼šå…è®¸æ–°çš„ç±»ç»§æ‰¿ç°æœ‰ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚æ”¯æŒä»£ç å¤ç”¨ï¼Œå¹¶å»ºç«‹äº†ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ã€‚</li><li><strong>å¤šæ€</strong>ï¼šå…è®¸ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£æ¥è¡¨ç¤ºä¸åŒçš„åŸºç¡€å½¢æ€ã€‚åŒä¸€ä¸ªæ“ä½œå¯åº”ç”¨äºä¸åŒçš„å¯¹è±¡ï¼Œå¯¹è±¡åœ¨è¿è¡Œæ—¶ç¡®å®šæ‰§è¡Œå“ªä¸ªæ–¹æ³•ã€‚</li></ul><h4 id="å­—ç¬¦ä¸²å·¥å…·ç±»-isEmpty-å’Œ-isBlank-çš„åŒºåˆ«"><a href="#å­—ç¬¦ä¸²å·¥å…·ç±»-isEmpty-å’Œ-isBlank-çš„åŒºåˆ«" class="headerlink" title="å­—ç¬¦ä¸²å·¥å…·ç±» isEmpty å’Œ isBlank çš„åŒºåˆ«"></a>å­—ç¬¦ä¸²å·¥å…·ç±» isEmpty å’Œ isBlank çš„åŒºåˆ«</h4><ul><li>isEmpty æ–¹æ³•ä¼šæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸º null ä»¥åŠé•¿åº¦ä¸º 0 ;isEmpty(â€œ â€œ)  â†’  false</li><li>isBlank æ–¹æ³•ä¼šæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸º null ä»¥åŠæ˜¯å¦æ˜¯ç©ºå­—ç¬¦ä¸²; isBlank(â€œ â€œ)  â†’  true</li></ul><h4 id="Object-æœ‰å“ªäº›å¸¸ç”¨æ–¹æ³•"><a href="#Object-æœ‰å“ªäº›å¸¸ç”¨æ–¹æ³•" class="headerlink" title="Object æœ‰å“ªäº›å¸¸ç”¨æ–¹æ³•"></a>Object æœ‰å“ªäº›å¸¸ç”¨æ–¹æ³•</h4><ul><li>equalsã€hashCodeã€toStringã€cloneã€finalizeã€waitã€notifyã€notifyall</li><li>getClass()</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240320153706.png" alt="image.png"></p><h4 id="equalsæ–¹æ³•å’Œ-æ“ä½œç¬¦çš„åŒºåˆ«"><a href="#equalsæ–¹æ³•å’Œ-æ“ä½œç¬¦çš„åŒºåˆ«" class="headerlink" title="equalsæ–¹æ³•å’Œ&#x3D;&#x3D; æ“ä½œç¬¦çš„åŒºåˆ«"></a>equalsæ–¹æ³•å’Œ&#x3D;&#x3D; æ“ä½œç¬¦çš„åŒºåˆ«</h4><ul><li>&#x3D;&#x3D; æ“ä½œç¬¦ï¼š<ul><li>åŸºæœ¬æ•°æ®ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å€¼æ˜¯å¦ç›¸ç­‰ã€‚</li><li>å¯¹è±¡ç±»å‹ï¼šæ¯”è¾ƒçš„æ˜¯å¼•ç”¨æ˜¯å¦ç›¸åŒï¼Œå³ä¸¤ä¸ªå¼•ç”¨æ˜¯å¦æŒ‡å‘å †å†…å­˜ä¸­çš„åŒä¸€ä¸ªä½ç½®ã€‚</li></ul></li><li><strong>equalsæ–¹æ³•</strong>ï¼š<ul><li>é»˜è®¤è¡Œä¸ºæ˜¯æ¯”è¾ƒå¯¹è±¡åœ¨å †å†…å­˜ä¸­çš„åœ°å€ï¼ˆä¸ &#x3D;&#x3D; ç›¸åŒï¼‰ã€‚</li><li>è®¸å¤šç±»ï¼ˆå¦‚Stringã€Integerï¼‰é‡å†™äº†<code>.equals()</code>æ–¹æ³•ï¼Œä½¿å…¶ç”¨äºæ¯”è¾ƒå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚</li></ul></li></ul><h4 id="equals-å’Œ-hashCode-çš„åŒºåˆ«å’Œè”ç³»ã€‚"><a href="#equals-å’Œ-hashCode-çš„åŒºåˆ«å’Œè”ç³»ã€‚" class="headerlink" title="equals å’Œ hashCode çš„åŒºåˆ«å’Œè”ç³»ã€‚"></a>equals å’Œ hashCode çš„åŒºåˆ«å’Œè”ç³»ã€‚</h4><ul><li>equals ä¸€èˆ¬ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æˆ–çŠ¶æ€æ˜¯å¦ç›¸ç­‰ï¼Œä»–é»˜è®¤çš„ç”¨æ³•å’Œ &#x3D;&#x3D; ç›¸åŒï¼Œå¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œä¼šæ¯”è¾ƒå¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼›å¤šæ•°ç±»ä¼šé‡å†™è¯¥æ–¹æ³•ï¼Œä»è€Œæ¯”è¾ƒå¯¹è±¡çš„å†…å®¹è€Œä¸æ˜¯å†…å­˜åœ°å€ã€‚</li><li>hashCode()Â çš„ä½œç”¨æ˜¯è·å–å“ˆå¸Œç ï¼Œå³è¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½®ã€‚å“ˆå¸Œå€¼åœ¨ä¸€äº›é›†åˆå¦‚HashMapã€HashSetç­‰éå¸¸å…³é”®</li><li>ä¸€èˆ¬æ˜¯å»ºè®®é‡å†™ equals() æ—¶å¿…é¡»é‡å†™ hashCode() æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰é‡å†™å“ˆå¸Œå‡½æ•°çš„è¯ï¼Œä¸¤ä¸ªé”®è·å–å“ˆå¸Œè¡¨ä½ç½®ç´¢å¼•å¯èƒ½ä¼šä¸å¯¹ï¼Œå¯¼è‡´æ•°æ®è®¿é—®ä¸Šçš„é—®é¢˜</li></ul><h4 id="ä¸¤ä¸ªå¯¹è±¡çš„hashcodeç›¸åŒï¼Œequalsâ¼€å®šç›¸åŒå—"><a href="#ä¸¤ä¸ªå¯¹è±¡çš„hashcodeç›¸åŒï¼Œequalsâ¼€å®šç›¸åŒå—" class="headerlink" title="ä¸¤ä¸ªå¯¹è±¡çš„hashcodeç›¸åŒï¼Œequalsâ¼€å®šç›¸åŒå—"></a>ä¸¤ä¸ªå¯¹è±¡çš„hashcodeç›¸åŒï¼Œequalsâ¼€å®šç›¸åŒå—</h4><ul><li>â¼€èˆ¬æ¨èé‡å†™equalsâ½…æ³•çš„åŒæ—¶ä¹Ÿè¦é‡å†™hashcodeâ½…æ³• <ul><li>ä¸¤ä¸ªå¯¹è±¡çš„hashcodeç›¸åŒï¼Œequalså¯èƒ½ç›¸åŒ </li><li>ä¸¤ä¸ªå¯¹è±¡equalsç›¸åŒï¼Œhashcodeâ¼€å®šç›¸åŒ</li></ul></li></ul><h4 id="Hashcodeçš„ä½œç”¨"><a href="#Hashcodeçš„ä½œç”¨" class="headerlink" title="Hashcodeçš„ä½œç”¨"></a>Hashcodeçš„ä½œç”¨</h4><p>javaçš„é›†åˆæœ‰ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯Listï¼Œè¿˜æœ‰ä¸€ç±»æ˜¯Setã€‚</p><p>å‰è€…æœ‰åºå¯é‡å¤ï¼Œåè€…æ— åºä¸é‡å¤ã€‚å½“æˆ‘ä»¬åœ¨set ä¸­æ’å…¥çš„æ—¶å€™æ€ä¹ˆåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨è¯¥å…ƒç´ å‘¢ï¼Œå¯ä»¥é€šè¿‡equalsæ–¹æ³•ã€‚ä½†æ˜¯å¦‚æœå…ƒç´ å¤ªå¤šï¼Œç”¨è¿™æ · çš„æ–¹æ³•å°±ä¼šæ¯”è¾ƒæ…¢ã€‚ äºæ˜¯æœ‰äººå‘æ˜äº†å“ˆå¸Œç®—æ³•æ¥æé«˜é›†åˆä¸­æŸ¥æ‰¾å…ƒç´ çš„æ•ˆç‡ã€‚ è¿™ç§æ–¹å¼å°†é›†åˆåˆ†æˆè‹¥å¹²ä¸ªå­˜å‚¨åŒºåŸŸï¼Œæ¯ ä¸ªå¯¹è±¡å¯ä»¥è®¡ç®—å‡ºä¸€ä¸ªå“ˆå¸Œç ï¼Œå¯ä»¥å°†å“ˆå¸Œç åˆ†ç»„ï¼Œæ¯ç»„åˆ†åˆ«å¯¹åº”æŸä¸ªå­˜å‚¨åŒºåŸŸï¼Œæ ¹æ®ä¸€ä¸ªå¯¹è±¡çš„ å“ˆå¸Œç å°±å¯ä»¥ç¡®å®šè¯¥å¯¹è±¡åº”è¯¥å­˜å‚¨çš„é‚£ä¸ªåŒºåŸŸã€‚ </p><p>hashCode æ–¹æ³•å¯ä»¥è¿™æ ·ç†è§£ï¼šå®ƒè¿”å›çš„å°±æ˜¯æ ¹æ®å¯¹è±¡çš„å†…å­˜åœ°å€æ¢ç®—å‡ºçš„ä¸€ä¸ªå€¼ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“ é›†åˆè¦æ·»åŠ æ–°çš„å…ƒç´ æ—¶ï¼Œå…ˆè°ƒç”¨è¿™ä¸ªå…ƒç´ çš„hashCodeæ–¹æ³•ï¼Œå°±ä¸€ä¸‹å­èƒ½å®šä½åˆ°å®ƒåº”è¯¥æ”¾ç½®çš„ç‰©ç† ä½ç½®ä¸Šã€‚å¦‚æœè¿™ä¸ªä½ç½®ä¸Šæ²¡æœ‰å…ƒç´ ï¼Œå®ƒå°±å¯ä»¥ç›´æ¥å­˜å‚¨åœ¨è¿™ä¸ªä½ç½®ä¸Šï¼Œä¸ç”¨å†è¿›è¡Œä»»ä½•æ¯”è¾ƒäº†ï¼›å¦‚ æœè¿™ä¸ªä½ç½®ä¸Šå·²ç»æœ‰å…ƒç´ äº†ï¼Œå°±è°ƒç”¨å®ƒçš„equalsæ–¹æ³•ä¸æ–°å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œç›¸åŒçš„è¯å°±ä¸å­˜äº†ï¼Œä¸ç›¸ åŒå°±æ•£åˆ—å…¶å®ƒçš„åœ°å€ã€‚è¿™æ ·ä¸€æ¥å®é™…è°ƒç”¨equalsæ–¹æ³•çš„æ¬¡æ•°å°±å¤§å¤§é™ä½äº†ï¼Œå‡ ä¹åªéœ€è¦ä¸€ä¸¤æ¬¡</p><p>ã€hashcode() å“ˆå¸Œå€¼  â†’  equal æ¯”è¾ƒå€¼ ï¼ˆæé«˜ç´¢å¼•æ•ˆç‡ï¼‰ã€‘</p><h4 id="é‡è½½å’Œé‡å†™çš„åŒºåˆ«"><a href="#é‡è½½å’Œé‡å†™çš„åŒºåˆ«" class="headerlink" title="é‡è½½å’Œé‡å†™çš„åŒºåˆ«"></a>é‡è½½å’Œé‡å†™çš„åŒºåˆ«</h4><ul><li>é‡å†™ï¼š<strong>å­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³•</strong>ï¼Œè¿”å›ç±»å‹ã€å‚æ•°åˆ—è¡¨ã€æ–¹æ³•åç§°ç›¸åŒ<ul><li>1.å‘ç”Ÿ<strong>åœ¨çˆ¶ç±»ä¸å­ç±»ä¹‹é—´</strong> </li><li>2.æ–¹æ³•åï¼Œå‚æ•°åˆ—è¡¨ï¼Œè¿”å›ç±»å‹ï¼ˆé™¤è¿‡å­ç±»ä¸­æ–¹æ³•çš„è¿”å›ç±»å‹ æ˜¯çˆ¶ç±»ä¸­è¿”å›ç±»å‹çš„å­ç±»ï¼‰å¿…é¡»ç›¸åŒ </li><li>3.è®¿é—®ä¿®é¥°ç¬¦çš„é™åˆ¶ä¸€å®šè¦å¤§äºè¢«é‡å†™æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦ ï¼ˆpublic&gt;protected&gt;default&gt;private) </li><li>4.é‡å†™æ–¹æ³•ä¸€å®šä¸èƒ½æŠ›å‡ºæ–°çš„æ£€æŸ¥å¼‚å¸¸æˆ–è€…æ¯”è¢«é‡å†™æ–¹æ³•ç”³ æ˜æ›´åŠ å®½æ³›çš„æ£€æŸ¥å‹å¼‚å¸¸</li></ul></li><li>é‡è½½ï¼š<strong>åŒä¸€ä¸ªç±»ä¸‹</strong>ï¼Œå¤šä¸ªåŒåæ–¹æ³•ï¼Œå‚æ•°åˆ—è¡¨ä¸åŒ; æ–¹æ³•è¿”å›å€¼å’Œè®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä¸åŒ<ul><li>1.é‡è½½Overloadæ˜¯ä¸€ä¸ªç±»ä¸­å¤šæ€æ€§çš„ä¸€ç§è¡¨ç° </li><li>2.é‡è½½è¦æ±‚åŒåæ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸åŒ(å‚ æ•°ç±»å‹ï¼Œå‚æ•°ä¸ªæ•°ç”šè‡³æ˜¯å‚æ•°é¡ºåº) </li><li>3.é‡è½½çš„æ—¶å€™ï¼Œè¿”å›å€¼ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸ç›¸åŒã€‚æ— æ³•ä»¥è¿”å› å‹åˆ«ä½œä¸ºé‡è½½å‡½æ•°çš„åŒºåˆ†æ ‡å‡†</li></ul></li></ul><h3 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h3><h4 id="è®²ä¸€ä¸‹å†…éƒ¨ç±»ï¼ŒåŒ¿åå†…éƒ¨ç±»æ€ä¹ˆä½¿ç”¨çš„"><a href="#è®²ä¸€ä¸‹å†…éƒ¨ç±»ï¼ŒåŒ¿åå†…éƒ¨ç±»æ€ä¹ˆä½¿ç”¨çš„" class="headerlink" title="è®²ä¸€ä¸‹å†…éƒ¨ç±»ï¼ŒåŒ¿åå†…éƒ¨ç±»æ€ä¹ˆä½¿ç”¨çš„"></a>è®²ä¸€ä¸‹å†…éƒ¨ç±»ï¼ŒåŒ¿åå†…éƒ¨ç±»æ€ä¹ˆä½¿ç”¨çš„</h4><ul><li>åœ¨Java ä¸­ï¼Œå†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨ä¸€ä¸ªç±»å†…éƒ¨çš„ç±»ï¼Œå¸¸ç”¨çš„å†…éƒ¨ç±»æœ‰ï¼šå±€éƒ¨å†…éƒ¨ç±»ã€åŒ¿åå†…éƒ¨ç±»ã€é™æ€å†…éƒ¨ç±»ã€æˆå‘˜å†…éƒ¨ç±»</li><li>åŒ¿åå†…éƒ¨ç±»çš„ä½¿ç”¨ï¼šç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»æˆ–å®ç°ä¸€ä¸ªæ¥å£ï¼Œå®ç°å…¶æ–¹æ³•ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼›ä¸€èˆ¬ä½¿ç”¨çš„å¸¸è§åœºæ™¯æœ‰Threadç±»çš„åŒ¿åå†…éƒ¨ç±»å®ç°å’ŒRunable æ¥å£çš„åŒ¿åå†…éƒ¨ç±»å®ç°ã€‚</li></ul><h4 id="è®²ä¸€ä¸‹æ·±æ‹·è´ã€æµ…æ‹·è´å’Œå¼•ç”¨æ‹·è´"><a href="#è®²ä¸€ä¸‹æ·±æ‹·è´ã€æµ…æ‹·è´å’Œå¼•ç”¨æ‹·è´" class="headerlink" title="è®²ä¸€ä¸‹æ·±æ‹·è´ã€æµ…æ‹·è´å’Œå¼•ç”¨æ‹·è´"></a>è®²ä¸€ä¸‹æ·±æ‹·è´ã€æµ…æ‹·è´å’Œå¼•ç”¨æ‹·è´</h4><ul><li>æµ…æ‹·è´ï¼šåªå¤åˆ¶å¯¹è±¡çš„åŸºæœ¬ç±»å‹å­—æ®µå’Œå¼•ç”¨ç±»å‹å­—æ®µçš„å¼•ç”¨ï¼Œä¸å¤åˆ¶å¼•ç”¨å¯¹è±¡æœ¬èº«ã€‚<ul><li>å‰¯æœ¬å¯¹è±¡å’ŒåŸå¯¹è±¡éƒ½æŒ‡å‘åŒâ¼€å—å†…å­˜ç©ºé—´ï¼Œå‰¯æœ¬å¯¹è±¡çš„æ”¹ å˜ä¼šå½±å“åˆ°åŸå¯¹è±¡</li></ul></li><li>æ·±æ‹·è´ï¼šå¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹å­—æ®µï¼Œå¼•ç”¨ç±»å‹çš„å¯¹è±¡ä¹Ÿä¼šè¢«å¤åˆ¶ã€‚<ul><li>å‰¯æœ¬å¯¹è±¡å’ŒåŸå¯¹è±¡ä¸æŒ‡å‘é€šâ¼€å—å†…å­˜ç©ºé—´ï¼Œä¼šé‡æ–°å¼€è¾Ÿâ¼€ å—å†…å­˜ç©ºé—´ç»™å‰¯æœ¬å¯¹è±¡è¿›â¾æŒ‡å‘</li></ul></li><li>å¼•ç”¨æ‹·è´ï¼šåªå¤åˆ¶å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸å¤åˆ¶å¯¹è±¡æœ¬èº«ã€‚</li></ul><h4 id="æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«"><a href="#æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«" class="headerlink" title="æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«"></a>æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«</h4><ul><li>é¦–å…ˆæ˜¯ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Œæ¥å£å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œç±»åªèƒ½ç»§æ‰¿å•ä¸ªï¼›</li><li>ç„¶åæ›´å¤šçš„æ˜¯ç”¨æ³•ä¸Šé¢çš„åŒºåˆ«ï¼šæ¥å£æ˜¯ä¸€ä¸ªåè®®ï¼Œå¼ºè°ƒåŠŸèƒ½çš„ç›¸ä¼¼æ€§ï¼ˆç›¸åŒçš„è¡Œä¸ºï¼‰ï¼›æŠ½é—²ç±»å¼ºè°ƒçš„æ˜¯ç±»ä¹‹é—´çš„å…±æ€§ï¼ˆå…¬å…±ç±»ç»“æ„ï¼‰ã€‚</li></ul><h3 id="å¼‚å¸¸ã€åå°„ã€æ³¨è§£ã€æ³›å‹"><a href="#å¼‚å¸¸ã€åå°„ã€æ³¨è§£ã€æ³›å‹" class="headerlink" title="å¼‚å¸¸ã€åå°„ã€æ³¨è§£ã€æ³›å‹"></a>å¼‚å¸¸ã€åå°„ã€æ³¨è§£ã€æ³›å‹</h3><h4 id="è®²ä¸€ä¸‹ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå¦‚ä½•é¿å…"><a href="#è®²ä¸€ä¸‹ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå¦‚ä½•é¿å…" class="headerlink" title="è®²ä¸€ä¸‹ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå¦‚ä½•é¿å…"></a>è®²ä¸€ä¸‹ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå¦‚ä½•é¿å…</h4><ul><li>å½“æˆ‘ä»¬åœ¨å°è¯•ä½¿ç”¨ null å¼•ç”¨çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿ NPE</li><li>é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸<ul><li><ol><li>åœ¨ä½¿ç”¨ä¹‹å‰å…ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦ä¸º null</li></ol></li><li><ol start="2"><li>è°ƒç”¨æ–¹æ³•çš„æ—¶å€™è¿›è¡Œå‚æ•°æ£€æŸ¥</li></ol></li><li><ol start="3"><li>åœ¨è®¾è®¡æ–¹æ³•æˆ–è€…API çš„æ—¶å€™ï¼Œå°½é‡ä¸è¦è¿”å› null å€¼ï¼Œè€Œä¸”è¿”å›ä¸€ä¸ªç©ºé›†åˆæˆ–è€…é»˜è®¤å€¼ï¼›</li></ol></li><li><ol start="4"><li>åˆå§‹åŒ–ä½¿ç”¨å­—æ®µï¼Œä¿è¯ä¸ä¸º null</li></ol></li><li><ol start="5"><li>ä½¿ç”¨ Optional</li></ol></li><li><ol start="6"><li>ä½¿ç”¨æ–­è¨€ï¼ˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒï¼‰</li></ol></li></ul></li></ul><h4 id="try-catch-finally-ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥ã€‚"><a href="#try-catch-finally-ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥ã€‚" class="headerlink" title="try-catch-finally ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥ã€‚"></a>try-catch-finally ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥ã€‚</h4><ul><li>å¯ä»¥çœç•¥<code>catch</code>å—æˆ–<code>finally</code>å—ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œä½†ä¸èƒ½ä¸¤ä¸ªéƒ½çœç•¥</li></ul><h4 id="è®²ä¸€ä¸‹Java-åå°„"><a href="#è®²ä¸€ä¸‹Java-åå°„" class="headerlink" title="è®²ä¸€ä¸‹Java åå°„"></a>è®²ä¸€ä¸‹Java åå°„</h4><ul><li>åå°„ï¼šå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶æ£€æŸ¥æˆ–ä¿®æ”¹Javaè™šæ‹Ÿæœºä¸­çš„ç±»</li><li>æ¯”å¦‚åœ¨æ¡†æ¶ä¸­å°±å¤§é‡ä½¿ç”¨åŠ¨æ€ä»£ç†è·å–åˆ°ç±»çš„å±æ€§ï¼Œä»è€Œå®ç°ä¸€äº›å¤æ‚çš„åŠŸèƒ½ã€‚</li></ul><h4 id="è®²ä¸€ä¸‹-Java-æ³›å‹"><a href="#è®²ä¸€ä¸‹-Java-æ³›å‹" class="headerlink" title="è®²ä¸€ä¸‹ Java æ³›å‹"></a>è®²ä¸€ä¸‹ Java æ³›å‹</h4><p>æ³›å‹æ¯”è¾ƒå¤§çš„ä½œç”¨æ˜¯èƒ½å¤Ÿæé«˜ä»£ç é‡ç”¨æ€§å’Œçµæ´»æ€§ï¼›å®ƒå…è®¸åœ¨ç±»ã€æ¥å£ã€æ–¹æ³•ä¸Šä½¿ç”¨ç±»å‹å‚æ•°</p><h4 id="Java-æ³›å‹ä¸­çš„-Tã€Rã€Kã€Vã€E-æ˜¯ä»€ä¹ˆã€‚"><a href="#Java-æ³›å‹ä¸­çš„-Tã€Rã€Kã€Vã€E-æ˜¯ä»€ä¹ˆã€‚" class="headerlink" title="Java æ³›å‹ä¸­çš„ Tã€Rã€Kã€Vã€E æ˜¯ä»€ä¹ˆã€‚"></a>Java æ³›å‹ä¸­çš„ Tã€Rã€Kã€Vã€E æ˜¯ä»€ä¹ˆã€‚</h4><ul><li><code>T</code> - Type</li><li><code>R</code> - Return</li><li><code>K</code> - Key</li><li><code>V</code> - Value</li><li><code>E</code> - Element</li></ul><h3 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h3><h4 id="ä»€ä¹ˆæ˜¯-SPIï¼Œæœ‰ä»€ä¹ˆç”¨ã€‚"><a href="#ä»€ä¹ˆæ˜¯-SPIï¼Œæœ‰ä»€ä¹ˆç”¨ã€‚" class="headerlink" title="ä»€ä¹ˆæ˜¯ SPIï¼Œæœ‰ä»€ä¹ˆç”¨ã€‚"></a>ä»€ä¹ˆæ˜¯ SPIï¼Œæœ‰ä»€ä¹ˆç”¨ã€‚</h4><p>Java é€šè¿‡ SPI æœºåˆ¶ä¸ºæœåŠ¡æ ‡å‡†æ¥å£æ‰¾åˆ°å…¶å®ç°æœåŠ¡ã€‚</p><h4 id="Java-SPI-å®ç°åŸç†äº†è§£å—ã€‚"><a href="#Java-SPI-å®ç°åŸç†äº†è§£å—ã€‚" class="headerlink" title="Java SPI å®ç°åŸç†äº†è§£å—ã€‚"></a>Java SPI å®ç°åŸç†äº†è§£å—ã€‚</h4><ul><li>Java SPIçš„å®ç°åŸºäº<code>ServiceLoader</code>ç±»ã€‚</li><li>æœåŠ¡æä¾›è€…åœ¨<code>META-INF/services</code>ç›®å½•ä¸‹æä¾›é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­æŒ‡å®šæ¥å£çš„å®ç°ç±»ã€‚</li><li><code>ServiceLoader</code>å¯ä»¥åŠ è½½è¿™äº›å®ç°ã€‚</li></ul><h3 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h3><h4 id="I-O-æµä¸ºä»€ä¹ˆè¦åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµå‘¢ï¼Ÿ"><a href="#I-O-æµä¸ºä»€ä¹ˆè¦åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµå‘¢ï¼Ÿ" class="headerlink" title="I&#x2F;O æµä¸ºä»€ä¹ˆè¦åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµå‘¢ï¼Ÿ"></a>I&#x2F;O æµä¸ºä»€ä¹ˆè¦åˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµå‘¢ï¼Ÿ</h4><ul><li>å­—èŠ‚æµï¼šå¤„ç†åŸå§‹äºŒè¿›åˆ¶æ•°æ®</li><li>å­—ç¬¦æµï¼šå¤„ç†å­—ç¬¦æ•°æ®ï¼Œè‡ªåŠ¨å¤„ç†å­—ç¬¦ç¼–ç é—®é¢˜</li></ul><h4 id="Java-IO-ä¸­çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ã€‚"><a href="#Java-IO-ä¸­çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ã€‚" class="headerlink" title="Java IO ä¸­çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ã€‚"></a>Java IO ä¸­çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ã€‚</h4><ul><li>è£…é€‚å™¨ã€é€‚é…å™¨</li></ul><h4 id="å¸¸è§çš„-IO-æ¨¡å‹æœ‰å“ªäº›"><a href="#å¸¸è§çš„-IO-æ¨¡å‹æœ‰å“ªäº›" class="headerlink" title="å¸¸è§çš„ IO æ¨¡å‹æœ‰å“ªäº›"></a>å¸¸è§çš„ IO æ¨¡å‹æœ‰å“ªäº›</h4><ul><li>BIOï¼ˆBlocking IOï¼‰ï¼šåŒæ­¥é˜»å¡IO</li><li>NIOï¼ˆNon-blocking IOï¼‰ï¼šåŒæ­¥éé˜»å¡IO</li><li>AIOï¼ˆAsynchronous IOï¼‰ï¼šå¼‚æ­¥éé˜»å¡IO</li></ul><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><h4 id="Java-æ€ä¹ˆè·å–å½“å‰çš„ç³»ç»Ÿæ—¶é—´æˆ³"><a href="#Java-æ€ä¹ˆè·å–å½“å‰çš„ç³»ç»Ÿæ—¶é—´æˆ³" class="headerlink" title="Java æ€ä¹ˆè·å–å½“å‰çš„ç³»ç»Ÿæ—¶é—´æˆ³"></a>Java æ€ä¹ˆè·å–å½“å‰çš„ç³»ç»Ÿæ—¶é—´æˆ³</h4><ul><li>è·å–å½“å‰ç³»ç»Ÿæ—¶é—´æˆ³ï¼š<code>System.currentTimeMillis()</code></li></ul><p>å¦‚æœéœ€è¦ ç»Ÿè®¡ä¸€æ®µä»£ç çš„è€—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹æ³•è·å–æ‰§è¡Œæ–¹æ³•å‰åçš„æ—¶é—´å·®ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é¢è¯•ç…ç†¬æˆè›‹_Javaå¹¶å‘</title>
    <link href="/2024/03/09/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_Java%E5%B9%B6%E5%8F%91/"/>
    <url>/2024/03/09/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_Java%E5%B9%B6%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡ç« ï¼Œä¸€æ–¹é¢æ˜¯çº¿ç¨‹çš„åŸºç¡€å†…å®¹ï¼Œä¸€æ–¹é¢æ˜¯é”æœºåˆ¶ï¼ŒåŒ…æ‹¬JMMã€volatileã€JUCã€AQS ç­‰ï¼›</p><p>è¿˜æœ‰ä¸€æ–¹é¢æ˜¯çº¿ç¨‹æ± ç›¸å…³çš„å†…å®¹ï¼Œä¼šéƒ¨åˆ†ç»“åˆä¸€ä¸‹å¸¸è§çš„é¢è¯•é¢˜ä½œä¸ºå¤ä¹ çš„ä¸€éƒ¨åˆ†ã€‚</p><p>å¯¹äºçº¿ç¨‹ç›¸å…³çš„ä¸€äº›å¤ä¹ ï¼Œä¸»è¦å‚è€ƒæ˜¯ï¼š <a href="https://www.bilibili.com/video/BV1yT411H7YK">https://www.bilibili.com/video/BV1yT411H7YK</a></p><p>ä¸‹é¢æ˜¯è¯¥é¢è¯•è§†é¢‘å…³äºJava å¹¶å‘çš„ä¸€äº›ç¬”è®°ï¼Œå¹¶ç»“åˆ Gpt4  å’Œ è°·æ­Œæœç´¢å†…å®¹è¿›è¡Œè¡¥å……å®Œå–„ã€‚</p><h3 id="çº¿ç¨‹åŸºç¡€å†…å®¹"><a href="#çº¿ç¨‹åŸºç¡€å†…å®¹" class="headerlink" title="çº¿ç¨‹åŸºç¡€å†…å®¹"></a>çº¿ç¨‹åŸºç¡€å†…å®¹</h3><ul><li>1ã€çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ</li><li>2ã€å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ</li><li>3ã€è®²ä¸€ä¸‹çº¿ç¨‹åˆ›å»ºçš„æ–¹å¼ï¼ŸRunable å’Œ Callable çš„åŒºåˆ«ï¼›strat å’Œ run çš„åŒºåˆ«ã€‚</li><li>4ã€çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„</li><li>5ã€çº¿ç¨‹æŒ‰é¡ºåºæ‰§è¡Œ joinã€notify å’Œ notifyall çš„åŒºåˆ«ã€‚</li><li>6ã€Java ä¸­ wait å’Œ sleep çš„åŒºåˆ«ã€‚</li><li>7ã€å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚</li><li>8ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ­»é”ï¼Œå¦‚ä½•é¢„é˜²å’Œé¿å…çº¿ç¨‹æ­»é”ã€‚</li></ul><h4 id="çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ"><a href="#çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ"></a>çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ</h4><ul><li>è¿›ç¨‹ï¼šèµ„æºåˆ†é…å’Œè°ƒåº¦çš„æœ€å°å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹</li><li>çº¿ç¨‹ï¼šè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œå…±äº«è¿›ç¨‹çš„èµ„æºï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬è¾ƒä½ã€‚</li></ul><h4 id="å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ"><a href="#å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ"></a>å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ</h4><ul><li>å¹¶å‘ï¼šåŒä¸€ä¸ªæ—¶é—´æ®µåŒæ—¶è¿›è¡Œçš„æ“ä½œ</li><li>å¹¶è¡Œï¼šåŒä¸€ä¸ªæ—¶åˆ»ä¸­åŒæ—¶è¿›è¡Œçš„æ“ä½œ</li></ul><p>æœ€å…³é”®çš„ç‚¹æ˜¯ï¼šæ˜¯å¦æ˜¯Â <strong>åŒæ—¶</strong>Â æ‰§è¡Œ</p><h4 id="åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«"><a href="#åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«" class="headerlink" title="åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«"></a>åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«</h4><ul><li><strong>åŒæ­¥</strong>ï¼šå‘å‡ºä¸€ä¸ªè°ƒç”¨ä¹‹åï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œ è¯¥è°ƒç”¨å°±ä¸å¯ä»¥è¿”å›ï¼Œä¸€ç›´ç­‰å¾…ã€‚</li><li><strong>å¼‚æ­¥</strong>ï¼šè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œä¸ç”¨ç­‰å¾…è¿”å›ç»“æœï¼Œè¯¥è°ƒç”¨ç›´æ¥è¿”å›ã€‚</li></ul><h4 id="çº¿ç¨‹åˆ›å»ºçš„æ–¹å¼ï¼Ÿ"><a href="#çº¿ç¨‹åˆ›å»ºçš„æ–¹å¼ï¼Ÿ" class="headerlink" title="çº¿ç¨‹åˆ›å»ºçš„æ–¹å¼ï¼Ÿ"></a>çº¿ç¨‹åˆ›å»ºçš„æ–¹å¼ï¼Ÿ</h4><p>åœ¨Javaä¸­ï¼Œæœ‰ä¸‰ç§å¸¸è§çš„çº¿ç¨‹åˆ›å»ºæ–¹å¼ï¼šä½¿ç”¨Threadç±»ã€å®ç°Runnableæ¥å£å’Œå®ç°Callableæ¥å£ã€‚</p><ul><li><strong>ç»§æ‰¿<code>Thread</code>ç±»</strong>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ç»§æ‰¿<code>Thread</code>ç±»ï¼Œå¹¶é‡å†™<code>run()</code>æ–¹æ³•ã€‚</li><li><strong>å®ç°<code>Runnable</code>æ¥å£</strong>ï¼šåˆ›å»ºä¸€ä¸ªå®ç°<code>Runnable</code>æ¥å£çš„ç±»ï¼Œç„¶åå°†å®ƒå®ä¾‹åŒ–ä¼ é€’ç»™<code>Thread</code>å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚</li><li><strong>å®ç°<code>Callable</code>æ¥å£</strong>ï¼šåˆ›å»ºä¸€ä¸ªå®ç°<code>Callable</code>æ¥å£çš„ç±»ï¼Œä½¿ç”¨<code>FutureTask</code>åŒ…è£…å™¨æ¥åˆ›å»º<code>Thread</code>å¯¹è±¡ã€‚<code>Callable</code>å¯ä»¥è¿”å›ç»“æœå’ŒæŠ›å‡ºè¢«æ£€æŸ¥çš„å¼‚å¸¸ã€‚</li></ul><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span> <span class="hljs-type">Thread</span></span> </span>&#123;<br>    <span class="hljs-keyword">public</span> void run() &#123;<br>        <span class="hljs-comment">// ä»»åŠ¡ä»£ç </span><br>    &#125;<br>&#125;<br>MyThread t = <span class="hljs-keyword">new</span> <span class="hljs-type">MyThread</span>();<br>t.start(); <span class="hljs-comment">// å¯åŠ¨æ–°çº¿ç¨‹</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRunnable</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">Runnable</span></span> </span>&#123;<br>    <span class="hljs-keyword">public</span> void run() &#123;<br>        <span class="hljs-comment">// ä»»åŠ¡ä»£ç </span><br>    &#125;<br>&#125;<br>Thread t = <span class="hljs-keyword">new</span> <span class="hljs-type">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">MyRunnable</span>());<br>t.start(); <span class="hljs-comment">// å¯åŠ¨æ–°çº¿ç¨‹</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCallable</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">Callable</span></span>&lt;<span class="hljs-title">Integer</span>&gt; </span>&#123;<br>    <span class="hljs-keyword">public</span> Integer call() throws Exception &#123;<br>        <span class="hljs-comment">// ä»»åŠ¡ä»£ç </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">123</span>;<br>    &#125;<br>&#125;<br>FutureTask&lt;Integer&gt; futureTask = <span class="hljs-keyword">new</span> <span class="hljs-type">FutureTask</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-type">MyCallable</span>());<br>Thread t = <span class="hljs-keyword">new</span> <span class="hljs-type">Thread</span>(futureTask);<br>t.start(); <span class="hljs-comment">// å¯åŠ¨æ–°çº¿ç¨‹</span><br></code></pre></td></tr></table></figure><h4 id="Runable-å’Œ-Callable-çš„åŒºåˆ«ï¼›strat-å’Œ-run-çš„åŒºåˆ«ã€‚"><a href="#Runable-å’Œ-Callable-çš„åŒºåˆ«ï¼›strat-å’Œ-run-çš„åŒºåˆ«ã€‚" class="headerlink" title="Runable å’Œ Callable çš„åŒºåˆ«ï¼›strat å’Œ run çš„åŒºåˆ«ã€‚"></a>Runable å’Œ Callable çš„åŒºåˆ«ï¼›strat å’Œ run çš„åŒºåˆ«ã€‚</h4><p>ä½¿ç”¨ Runable æ¥å£å’Œå®ç° Callable æœ€å¤§çš„åŒºåˆ«æ˜¯åè€…èƒ½è¿”å›ä¸€ä¸ªç»“æœï¼Œè¿˜æœ‰ä¸€ä¸ªåŒºåˆ«æ˜¯ call() æ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œ Runable æ¥å£ä¸‹çš„ run() æ–¹æ³•ä¸å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚</p><ul><li>start æ–¹æ³•æ˜¯å¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œæ–°çº¿ç¨‹ä¼šæ‰§è¡Œç›¸åº”å¯¹è±¡çš„<code>run()</code>æ–¹æ³•ã€‚</li><li>run æ–¹æ³•åªæ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•ï¼Œå¦‚æœè°ƒç”¨ run æ–¹æ³•ï¼Œä¹Ÿåªæ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸‹è°ƒç”¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚</li></ul><h4 id="çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„"><a href="#çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„" class="headerlink" title="çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„"></a>çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„</h4><p>åœ¨æˆ‘ä»¬çš„ Thread ç±»ä¸‹ï¼Œæœ‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œé‡Œé¢çš„çŠ¶æ€æœ‰ï¼šæ–°å»º(NEW)ã€å¯è¿è¡Œ(RUNNABLE)ã€é˜»å¡(BLOCKED)ã€ç­‰å¾…(WAITING)ã€æ—¶é—´ç­‰å¾…(TIMED_WALTING)ã€ç»ˆæ­¢(TERMINATED)</p><p>åˆ†ææµç¨‹å›¾</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240304154734.png" alt="image.png"></p><blockquote><p>.çº¿ç¨‹çŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„</p></blockquote><p>çŠ¶æ€åˆ‡æ¢çš„ä¸€äº›æƒ…å†µï¼š</p><ul><li>åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ˜¯æ–°å»ºçŠ¶æ€</li><li>è°ƒç”¨äº†stat()æ–¹æ³•è½¬å˜ä¸º<strong>å¯æ‰§è¡ŒçŠ¶æ€</strong></li><li>çº¿ç¨‹è·å–åˆ°äº†CPUçš„æ‰§è¡Œæƒï¼Œæ‰§è¡Œç»“æŸæ˜¯<strong>ç»ˆæ­¢çŠ¶æ€</strong></li><li>åœ¨å¯æ‰§è¡ŒçŠ¶æ€çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰è·å– CPU çš„æ‰§è¡Œæƒï¼Œå¯èƒ½ä¼šåˆ‡æ¢å…¶ä»–çŠ¶æ€<ul><li>å¦‚æœæ²¡æœ‰è·å–é”(synchronized æˆ–Iock)è¿›å…¥<strong>é˜»å¡çŠ¶æ€</strong>ï¼Œè·å¾—é”å†åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€</li><li>å¦‚æœçº¿ç¨‹è°ƒç”¨äº†wait()æ–¹æ³•è¿›å…¥<strong>ç­‰å¾…çŠ¶æ€</strong>ï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨notify()å”¤é†’åå¯åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€</li><li>å¦‚æœçº¿ç¨‹è°ƒç”¨äº†sleep(50)æ–¹æ³•ï¼Œè¿›å…¥<strong>è®¡æ—¶ç­‰å¾…çŠ¶æ€</strong>ï¼Œåˆ°æ—¶é—´åå¯åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€</li></ul></li></ul><h4 id="ä½ è§‰å¾—é˜»å¡çº¿ç¨‹å’Œç­‰å¾…çº¿ç¨‹çš„åŒºåˆ«"><a href="#ä½ è§‰å¾—é˜»å¡çº¿ç¨‹å’Œç­‰å¾…çº¿ç¨‹çš„åŒºåˆ«" class="headerlink" title="ä½ è§‰å¾—é˜»å¡çº¿ç¨‹å’Œç­‰å¾…çº¿ç¨‹çš„åŒºåˆ«"></a>ä½ è§‰å¾—é˜»å¡çº¿ç¨‹å’Œç­‰å¾…çº¿ç¨‹çš„åŒºåˆ«</h4><p>å†è®²ä¸€ä¸‹å…³äºçº¿ç¨‹çŠ¶æ€ç›¸å…³çš„å†…å®¹</p><ul><li>æ–°å»º</li><li>å°±ç»ª<ul><li>start()  ä» æ–°å»ºå˜ä¸ºå°±ç»ª</li></ul></li><li>è¿è¡Œ<ul><li>çº¿ç¨‹è·å–åˆ°äº†CPUæ‰§è¡Œæƒ</li></ul></li><li>è®¡æ—¶ç­‰å¾…<ul><li>wait(50)    åˆ°æ—¶é—´åä¼šè¿›å…¥åˆ°å°±ç»ª</li></ul></li><li>ç­‰å¾…<ul><li>wait()   éœ€è¦å”¤é†’æ“ä½œ</li></ul></li><li>é˜»å¡<ul><li>å¦‚æœæ²¡æœ‰è·å–é”(synchronized æˆ–Iock)è¿›å…¥<strong>é˜»å¡çŠ¶æ€</strong>ï¼Œè·å¾—é”å†åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€</li></ul></li><li>æ­»äº¡<ul><li>çº¿ç¨‹æ­»äº¡</li></ul></li></ul><h4 id="æ–°å»ºT1ã€T2ã€T3ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ"><a href="#æ–°å»ºT1ã€T2ã€T3ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ" class="headerlink" title="æ–°å»ºT1ã€T2ã€T3ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ"></a>æ–°å»ºT1ã€T2ã€T3ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ</h4><p>è¦ä¿è¯ä¸‰ä¸ªçº¿ç¨‹T1ã€T2ã€T3æŒ‰é¡ºåºæ‰§è¡Œï¼Œå³å…ˆæ‰§è¡ŒT1ï¼ŒT1æ‰§è¡Œå®Œæ¯•åæ‰§è¡ŒT2ï¼ŒT2æ‰§è¡Œå®Œæ¯•åæ‰§è¡ŒT3ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§æ–¹æ³•æ¥å®ç°ã€‚</p><p>è¿™é‡Œè®²ä¸€ä¸‹å¸¸è§çš„ä¸¤ç§æ–¹æ³•ï¼š</p><p>æ–¹æ³•1ï¼šä½¿ç”¨<code>join()</code>æ–¹æ³•</p><p><code>join()</code>æ–¹æ³•å¯ä»¥ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å®Œæˆåå†ç»§ç»­æ‰§è¡Œã€‚</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs livescript">public <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadOrder</span> &#123;<br>    public <span class="hljs-keyword">static</span> <span class="hljs-literal">void</span> main(<span class="hljs-built_in">String</span>[] args) &#123;<br>        Thread t1 = <span class="hljs-keyword">new</span> Thread<span class="hljs-function"><span class="hljs-params">(() -&gt; System.out.println(<span class="hljs-string">&quot;T1 is running&quot;</span>))</span>;</span><br><span class="hljs-function">        <span class="hljs-title">Thread</span> <span class="hljs-title">t2</span> = <span class="hljs-title">new</span> <span class="hljs-title">Thread</span><span class="hljs-params">(() -&gt; System.out.println(<span class="hljs-string">&quot;T2 is running&quot;</span>))</span>;</span><br><span class="hljs-function">        <span class="hljs-title">Thread</span> <span class="hljs-title">t3</span> = <span class="hljs-title">new</span> <span class="hljs-title">Thread</span><span class="hljs-params">(() -&gt; System.out.println(<span class="hljs-string">&quot;T3 is running&quot;</span>))</span>;</span><br><span class="hljs-function">        </span><br><span class="hljs-function">        <span class="hljs-title">try</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">t1</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">            <span class="hljs-title">t1</span>.<span class="hljs-title">join</span><span class="hljs-params">()</span>; // ç­‰å¾…<span class="hljs-title">t1</span>æ‰§è¡Œå®Œæ¯•</span><br><span class="hljs-function">            </span><br><span class="hljs-function">            <span class="hljs-title">t2</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">            <span class="hljs-title">t2</span>.<span class="hljs-title">join</span><span class="hljs-params">()</span>; // ç­‰å¾…<span class="hljs-title">t2</span>æ‰§è¡Œå®Œæ¯•</span><br><span class="hljs-function">            </span><br><span class="hljs-function">            <span class="hljs-title">t3</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">            <span class="hljs-title">t3</span>.<span class="hljs-title">join</span><span class="hljs-params">()</span>; // ç­‰å¾…<span class="hljs-title">t3</span>æ‰§è¡Œå®Œæ¯•</span><br><span class="hljs-function">        &#125; <span class="hljs-title">catch</span> <span class="hljs-params">(InterruptedException e)</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">e</span>.<span class="hljs-title">printStackTrace</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">        &#125;</span><br><span class="hljs-function">    &#125;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><p>æ–¹æ³•2ï¼šä½¿ç”¨<code>wait()</code>å’Œ<code>notify()/notifyAll()</code>æ–¹æ³•</p><p>é€šè¿‡å¯¹è±¡ç›‘è§†å™¨çš„<code>wait()</code>å’Œ<code>notify()</code>æ–¹æ³•æ¥æ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚è¿™ç§æ–¹æ³•ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç¡®ä¿<code>wait()</code>å’Œ<code>notify()</code>è°ƒç”¨åœ¨åŒæ­¥å—ä¸­ã€‚</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs livescript">public <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadOrder</span> &#123;<br>    public <span class="hljs-keyword">static</span> <span class="hljs-literal">void</span> main(<span class="hljs-built_in">String</span>[] args) &#123;<br>        final <span class="hljs-built_in">Object</span> lock = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>();<br>        Thread t1 = <span class="hljs-keyword">new</span> Thread<span class="hljs-function"><span class="hljs-params">(() -&gt; &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">            synchronized (lock) &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">                System.out.println(<span class="hljs-string">&quot;T1 is running&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">                lock.notify(); <span class="hljs-regexp">// å”¤é†’ç­‰å¾…lockå¯¹è±¡çš„ä¸€ä¸ªçº¿ç¨‹</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">            &#125;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        &#125;);</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        </span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        Thread t2 = new Thread(() -&gt; &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">            synchronized (lock) &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                try &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                    lock.wait(); //</span> ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°lockå¯¹è±¡è¢«å”¤é†’</span></span><br><span class="hljs-params"><span class="hljs-function">                    System.out.println(<span class="hljs-string">&quot;T2 is running&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">                    lock.notify(); <span class="hljs-regexp">// å”¤é†’ç­‰å¾…lockå¯¹è±¡çš„ä¸€ä¸ªçº¿ç¨‹</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                &#125; catch (InterruptedException e) &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                    e.printStackTrace();</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                &#125;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">            &#125;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        &#125;);</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        </span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        Thread t3 = new Thread(() -&gt; &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">            synchronized (lock) &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                try &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                    lock.wait(); //</span> ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°lockå¯¹è±¡è¢«å”¤é†’</span></span><br><span class="hljs-params"><span class="hljs-function">                    System.out.println(<span class="hljs-string">&quot;T3 is running&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">                    e.printStackTrace();</span></span><br><span class="hljs-params"><span class="hljs-function">                &#125;</span></span><br><span class="hljs-params"><span class="hljs-function">            &#125;</span></span><br><span class="hljs-params"><span class="hljs-function">        &#125;)</span>;</span><br><span class="hljs-function"></span><br><span class="hljs-function">        <span class="hljs-title">try</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">t2</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">            <span class="hljs-title">t3</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">            <span class="hljs-title">Thread</span>.<span class="hljs-title">sleep</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span>; // ç¡®ä¿<span class="hljs-title">t2</span>å’Œ<span class="hljs-title">t3</span>å¯åŠ¨å¹¶è¿›å…¥<span class="hljs-title">wait</span>çŠ¶æ€</span><br><span class="hljs-function">            <span class="hljs-title">t1</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">        &#125; <span class="hljs-title">catch</span> <span class="hljs-params">(InterruptedException e)</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">e</span>.<span class="hljs-title">printStackTrace</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">        &#125;</span><br><span class="hljs-function">    &#125;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="notify-å’Œ-notifyall-çš„åŒºåˆ«"><a href="#notify-å’Œ-notifyall-çš„åŒºåˆ«" class="headerlink" title="notify å’Œ notifyall çš„åŒºåˆ«"></a>notify å’Œ notifyall çš„åŒºåˆ«</h4><ul><li>notifyAll:å”¤é†’æ‰€æœ‰waitçš„çº¿ç¨‹</li><li>notify:åªéšæœºå”¤é†’ä¸€ä¸ªwaitçº¿ç¨‹</li></ul><h4 id="Java-ä¸­-wait-å’Œ-sleep-çš„åŒºåˆ«ã€‚"><a href="#Java-ä¸­-wait-å’Œ-sleep-çš„åŒºåˆ«ã€‚" class="headerlink" title="Java ä¸­ wait å’Œ sleep çš„åŒºåˆ«ã€‚"></a>Java ä¸­ wait å’Œ sleep çš„åŒºåˆ«ã€‚</h4><ul><li>å…±åŒç‚¹<ul><li>wait(),wait(long)å’Œsleep(long)çš„æ•ˆæœéƒ½æ˜¯è®©å½“å‰çº¿ç¨‹æš‚æ—¶æ”¾å¼ƒCPUçš„ä½¿ç”¨æƒï¼Œè¿›å…¥é˜»å¡çŠ¶æ€</li></ul></li><li>ä¸åŒç‚¹<ul><li>1.æ–¹æ³•å½’å±ä¸åŒ<ul><li>sleep(long)æ˜¯Threadçš„é™æ€æ–¹æ³•</li><li>è€Œwait(),wait(long)éƒ½æ˜¯Objectçš„æˆå‘˜æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰</li></ul></li><li>2ã€é†’æ¥æ—¶æœºä¸åŒ<ul><li>æ‰§è¡Œsleep(long)å’Œwait(long)çš„çº¿ç¨‹éƒ½ä¼šåœ¨ç­‰å¾…ç›¸åº”æ¯«ç§’åé†’æ¥</li><li>wait(long)å’Œwait0è¿˜å¯ä»¥è¢«notifyå”¤é†’ï¼Œwait()å¦‚æœä¸å”¤é†’å°±ä¸€ç›´ç­‰ä¸‹å»</li><li>å®ƒä»¬éƒ½å¯ä»¥è¢«æ‰“æ–­å”¤é†’</li></ul></li><li>3.é”ç‰¹æ€§ä¸åŒï¼ˆé‡ç‚¹ï¼‰<ul><li>waitæ–¹æ³•çš„è°ƒç”¨å¿…é¡»å…ˆè·å–waitå¯¹è±¡çš„é”ï¼Œè€Œsleepåˆ™æ— æ­¤é™åˆ¶</li><li>waitæ–¹æ³•æ‰§è¡Œåä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹è·å¾—è¯¥å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒcpu,ä½†ä½ ä»¬è¿˜å¯ä»¥ç”¨ï¼‰</li><li>è€Œsleepå¦‚æœåœ¨synchronizedä»£ç å—ä¸­æ‰§è¡Œï¼Œå¹¶ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒcpu,ä½ ä»¬ä¹Ÿç”¨ä¸äº†ï¼‰</li></ul></li></ul></li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WaitSleepExample</span> &#123;<br>    private <span class="hljs-keyword">static</span> final <span class="hljs-built_in">Object</span> LOCK = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>();<br><br>    public <span class="hljs-keyword">static</span> <span class="hljs-literal">void</span> main(<span class="hljs-built_in">String</span>[] args) &#123;<br>        <span class="hljs-regexp">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç­‰å¾…æ“ä½œ</span><br><span class="hljs-regexp">        Thread waitThread = new Thread(() -&gt; &#123;</span><br><span class="hljs-regexp">            synchronized (LOCK) &#123; //</span> å¿…é¡»åœ¨åŒæ­¥å—å†…è°ƒç”¨waitï¼Œè¿™è¡¨ç¤ºå¿…é¡»æŒæœ‰å¯¹è±¡çš„é”<br>                <span class="hljs-keyword">try</span> &#123;<br>                    System.out.println(<span class="hljs-string">&quot;Wait Thread: Holding lock, now wait&quot;</span>);<br>                    LOCK.wait(); <span class="hljs-regexp">// è°ƒç”¨waitæ–¹æ³•åï¼Œå½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾LOCKå¯¹è±¡ä¸Šçš„é”ï¼Œå¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€</span><br><span class="hljs-regexp">                    System.out.println(&quot;Wait Thread: Exited wait&quot;);</span><br><span class="hljs-regexp">                &#125; catch (InterruptedException e) &#123;</span><br><span class="hljs-regexp">                    e.printStackTrace();</span><br><span class="hljs-regexp">                &#125;</span><br><span class="hljs-regexp">            &#125;</span><br><span class="hljs-regexp">        &#125;);</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">        //</span> åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç¡çœ æ“ä½œ<br>        Thread sleepThread = <span class="hljs-keyword">new</span> Thread<span class="hljs-function"><span class="hljs-params">(() -&gt; &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">            synchronized (LOCK) &#123; <span class="hljs-regexp">// è¿›å…¥åŒæ­¥å—ï¼ŒæŒæœ‰LOCKå¯¹è±¡çš„é”</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                try &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                    System.out.println(&quot;Sleep Thread: Holding lock, now sleep&quot;);</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                    Thread.sleep(1000); //</span> è°ƒç”¨sleepæ–¹æ³•ï¼Œä½†ä¸ä¼šé‡Šæ”¾LOCKå¯¹è±¡ä¸Šçš„é”</span></span><br><span class="hljs-params"><span class="hljs-function">                    System.out.println(<span class="hljs-string">&quot;Sleep Thread: Exited sleep&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">                    e.printStackTrace();</span></span><br><span class="hljs-params"><span class="hljs-function">                &#125;</span></span><br><span class="hljs-params"><span class="hljs-function">            &#125;</span></span><br><span class="hljs-params"><span class="hljs-function">        &#125;)</span>;</span><br><span class="hljs-function"></span><br><span class="hljs-function">        // åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œé€šçŸ¥æ“ä½œ</span><br><span class="hljs-function">        <span class="hljs-title">Thread</span> <span class="hljs-title">notifyThread</span> = <span class="hljs-title">new</span> <span class="hljs-title">Thread</span><span class="hljs-params">(() -&gt; &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">            synchronized (LOCK) &#123; <span class="hljs-regexp">// è¿›å…¥åŒæ­¥å—ï¼ŒæŒæœ‰LOCKå¯¹è±¡çš„é”</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                //</span> å‘é€é€šçŸ¥ï¼Œå‘Šè¯‰ç­‰å¾…åœ¨LOCKå¯¹è±¡ä¸Šçš„çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œ</span></span><br><span class="hljs-params"><span class="hljs-function">                LOCK.notifyAll();</span></span><br><span class="hljs-params"><span class="hljs-function">                System.out.println(<span class="hljs-string">&quot;Notify Thread: Sent notification&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">            &#125;</span></span><br><span class="hljs-params"><span class="hljs-function">        &#125;)</span>;</span><br><span class="hljs-function"></span><br><span class="hljs-function">        <span class="hljs-title">waitThread</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>; // å¯åŠ¨ç­‰å¾…çº¿ç¨‹</span><br><span class="hljs-function">        <span class="hljs-title">try</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">Thread</span>.<span class="hljs-title">sleep</span><span class="hljs-params">(<span class="hljs-number">500</span>)</span>; // ç¡®ä¿<span class="hljs-title">waitThread</span>å…ˆæ‰§è¡Œ</span><br><span class="hljs-function">        &#125; <span class="hljs-title">catch</span> <span class="hljs-params">(InterruptedException e)</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">e</span>.<span class="hljs-title">printStackTrace</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">        &#125;</span><br><span class="hljs-function">        <span class="hljs-title">sleepThread</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>; // å¯åŠ¨ç¡çœ çº¿ç¨‹</span><br><span class="hljs-function">        <span class="hljs-title">try</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">Thread</span>.<span class="hljs-title">sleep</span><span class="hljs-params">(<span class="hljs-number">500</span>)</span>; // ç¡®ä¿<span class="hljs-title">sleepThread</span>æœ‰æœºä¼šæ‰§è¡Œ</span><br><span class="hljs-function">        &#125; <span class="hljs-title">catch</span> <span class="hljs-params">(InterruptedException e)</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">e</span>.<span class="hljs-title">printStackTrace</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">        &#125;</span><br><span class="hljs-function">        <span class="hljs-title">notifyThread</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>; // å¯åŠ¨é€šçŸ¥çº¿ç¨‹</span><br><span class="hljs-function">    &#125;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><ul><li><strong>å…³äºé”çš„ä¸åŒå¤„ç†</strong>ï¼š<ul><li><strong><code>wait()</code>æ–¹æ³•</strong>ï¼šè°ƒç”¨<code>wait()</code>æ—¶ï¼Œçº¿ç¨‹å¿…é¡»æŒæœ‰å¯¹è±¡çš„é”ï¼ˆè¿™æ˜¯é€šè¿‡åœ¨<code>synchronized</code>å—å†…è°ƒç”¨<code>wait()</code>æ¥ä¿è¯çš„ï¼‰ã€‚ä¸€æ—¦<code>wait()</code>è¢«è°ƒç”¨ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾è¿™ä¸ªå¯¹è±¡ä¸Šçš„é”ï¼Œå…è®¸å…¶ä»–çº¿ç¨‹è·å–è¿™ä¸ªé”ã€‚å½“å…¶ä»–çº¿ç¨‹åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨<code>notify()</code>æˆ–<code>notifyAll()</code>æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹æ‰æœ‰æœºä¼šé‡æ–°è·å–é”å¹¶ç»§ç»­æ‰§è¡Œã€‚</li><li><strong><code>sleep()</code>æ–¹æ³•</strong>ï¼šä¸<code>wait()</code>ä¸åŒï¼Œè°ƒç”¨<code>sleep()</code>æ—¶çº¿ç¨‹ä¸ä¼šé‡Šæ”¾ä»»ä½•æŒæœ‰çš„é”ã€‚å³ä½¿æ˜¯åœ¨<code>synchronized</code>å—å†…è°ƒç”¨<code>sleep()</code>ï¼Œå½“å‰çº¿ç¨‹ä»ç„¶ä¼šä¿æŒå¯¹é”çš„æŒæœ‰ï¼Œç›´åˆ°<code>sleep()</code>å®Œæˆã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰æŸä¸ªå¯¹è±¡é”çš„åŒæ—¶è°ƒç”¨äº†<code>sleep()</code>ï¼Œå…¶ä»–æƒ³è¦è®¿é—®è¿™ä¸ªåŒæ­¥å—çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°ç¡çœ çº¿ç¨‹é†’æ¥å¹¶é€€å‡ºåŒæ­¥å—ï¼Œé‡Šæ”¾é”ã€‚</li></ul></li></ul><p>â†’  ä½¿ç”¨ sleep çš„æ—¶å€™åŒæ­¥å—ä»£ç çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚</p><h4 id="å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚"><a href="#å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚" class="headerlink" title="å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚"></a>å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚</h4><p>æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥åœæ­¢çº¿ç¨‹</p><ul><li>ä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“ run æ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢</li><li>ä½¿ç”¨stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢ï¼ˆä¸æ¨èï¼Œæ–¹æ³•å·²ä½œåºŸï¼‰</li><li>ä½¿ç”¨interruptæ–¹æ³•ä¸­æ–­çº¿ç¨‹<ul><li>æ‰“æ–­é˜»å¡çš„çº¿ç¨‹(sleep,wait,join) çš„çº¿ç¨‹ï¼Œçº¿ç¨‹ä¼šæŠ›å‡º InterruptedException å¼‚å¸¸</li><li>æ‰“æ–­æ­£å¸¸çš„çº¿ç¨‹ï¼Œå¯ä»¥æ ¹æ®æ‰“æ–­çŠ¶æ€æ¥æ ‡è®°æ˜¯å¦é€€å‡ºçº¿ç¨‹</li></ul></li></ul><h4 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹æ­»é”ï¼Œå¦‚ä½•é¢„é˜²å’Œé¿å…çº¿ç¨‹æ­»é”ã€‚"><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹æ­»é”ï¼Œå¦‚ä½•é¢„é˜²å’Œé¿å…çº¿ç¨‹æ­»é”ã€‚" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹æ­»é”ï¼Œå¦‚ä½•é¢„é˜²å’Œé¿å…çº¿ç¨‹æ­»é”ã€‚"></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ­»é”ï¼Œå¦‚ä½•é¢„é˜²å’Œé¿å…çº¿ç¨‹æ­»é”ã€‚</h4><p>çº¿ç¨‹æ­»é”ï¼šä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§ç›¸äº’ç­‰å¾…çš„ç°è±¡ï¼Œå¯¼è‡´å®ƒä»¬éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œã€‚</p><p>æ­»é”åªæœ‰<strong>åŒæ—¶æ»¡è¶³</strong>ä»¥ä¸‹å››ä¸ªæ¡ä»¶æ‰ä¼šå‘ç”Ÿï¼š</p><ul><li>äº’æ–¥æ¡ä»¶ï¼›</li><li>æŒæœ‰å¹¶ç­‰å¾…æ¡ä»¶ï¼›</li><li>ä¸å¯å‰¥å¤ºæ¡ä»¶ï¼›</li><li>ç¯è·¯ç­‰å¾…æ¡ä»¶</li></ul><p><strong>é¢„é˜²å’Œé¿å…æ–¹æ³•</strong>ï¼šæœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨èµ„æºæœ‰åºåˆ†é…æ³•æ¥ç ´åç¯è·¯ç­‰å¾…æ¡ä»¶ã€‚</p><p>ä½¿ç”¨è¶…æ—¶å°è¯•è·å–é”: åœ¨å°è¯•è·å–é”æ—¶ä½¿ç”¨è¶…æ—¶æœºåˆ¶ï¼Œä½¿å¾—çº¿ç¨‹åœ¨ç­‰å¾…è¶…è¿‡ä¸€å®šæ—¶é—´åè‡ªåŠ¨æ”¾å¼ƒï¼Œä»è€Œé¿å…æ°¸ä¹…ç­‰å¾…ã€‚</p><p>å‚è€ƒ: <a href="https://www.xiaolincoding.com/os/4_process/deadlock.html">https://www.xiaolincoding.com/os/4_process/deadlock.html</a></p><h3 id="é”æœºåˆ¶"><a href="#é”æœºåˆ¶" class="headerlink" title="é”æœºåˆ¶"></a>é”æœºåˆ¶</h3><ul><li>1ã€synchronized å…³é”®å­—çš„åº•å±‚åŸç†ã€‚<ul><li>åŸºç¡€å›ç­”</li><li>è¿›é˜¶å›ç­”</li></ul></li><li>2ã€è°ˆè°ˆ JMM (Java å†…å­˜æ¨¡å‹)</li><li>3ã€ä½ è°ˆè°ˆå¯¹ CAS çš„ç†è§£</li><li>4ã€è¯·è°ˆè°ˆä½ å¯¹ volatile çš„ç†è§£ï¼ˆå¯è§æ€§ï¼Œç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼‰</li><li>5ã€ä»€ä¹ˆæ˜¯ AQS</li><li>6ã€ReentantLock çš„å®ç°åŸç†</li><li>7ã€synchronized å’Œ Lock æœ‰ä»€ä¹ˆåŒºåˆ«</li><li>8ã€æ­»é”äº§ç”Ÿçš„æ¡ä»¶ä»¥åŠæ­»é”æ’æŸ¥æ–¹æ¡ˆ</li><li>9ã€èŠä¸€ä¸‹ ConcurrentHashMap</li><li>10ã€å¯¼è‡´å¹¶å‘ç¼–ç¨‹å‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ</li></ul><h4 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312224915.png" alt="image.png"></p><h4 id="synchronized-å…³é”®å­—çš„åº•å±‚åŸç†"><a href="#synchronized-å…³é”®å­—çš„åº•å±‚åŸç†" class="headerlink" title="synchronized å…³é”®å­—çš„åº•å±‚åŸç†"></a>synchronized å…³é”®å­—çš„åº•å±‚åŸç†</h4><p>å»ºè®®è§‚çœ‹è§†é¢‘ï¼š <a href="https://www.bilibili.com/list/watchlater?oid=485022417&bvid=BV1yT411H7YK&spm_id_from=333.1245.top_right_bar_window_view_later.content.click&p=95">https://www.bilibili.com/list/watchlater?oid=485022417&amp;bvid=BV1yT411H7YK&amp;spm_id_from=333.1245.top_right_bar_window_view_later.content.click&amp;p=95</a></p><p>synchronizedï¼šå¯¹è±¡é”</p><p>ä½œç”¨ï¼šé‡‡ç”¨äº’æ–¥çš„æ–¹å¼è®©åŒä¸€æ—¶åˆ»è‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰å¯¹è±¡é”ï¼Œå…¶ä»–çº¿ç¨‹å†æƒ³è·å–è¿™ä¸ªå¯¹è±¡é”æ—¶å°±ä¼šé˜»å¡</p><p>åº•å±‚åŸç†ï¼š</p><p>Javaå¯¹è±¡å¤´å’Œ<code>monitor</code>æ˜¯<code>synchronized</code>å®ç°åŒæ­¥çš„åŸºç¡€ã€‚é€šè¿‡ monitor å®ç°äº†å¯¹äºå¯¹è±¡çš„é‡é‡çº§é”æ“ä½œï¼Œè€ŒJava å¯¹è±¡å¤´æ˜¯é”å‡çº§æœºåˆ¶çš„å…³é”®ã€‚</p><h4 id="è®²ä¸€ä¸‹-Monitor"><a href="#è®²ä¸€ä¸‹-Monitor" class="headerlink" title="è®²ä¸€ä¸‹ Monitor"></a>è®²ä¸€ä¸‹ Monitor</h4><p>åœ¨ äº’æ–¥é” synchronized åŠ é”çš„è¿‡ç¨‹ä¸­ï¼Œé‡é‡çº§é”çš„å®ç°æ˜¯é€šè¿‡ monitor æ¥å®ç°çš„ã€‚ï¼ˆè®°ä½è¿™ä¸€å¥ï¼‰</p><p>Monitoå®ç°çš„é”<strong>å±äºé‡é‡çº§é”</strong>ï¼Œé‡Œé¢æ¶‰åŠåˆ°äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæˆæœ¬è¾ƒé«˜ï¼Œæ€§èƒ½æ¯”è¾ƒä½ã€‚</p><p>monitor æ˜¯ jvm çº§åˆ«çš„å¯¹è±¡ï¼ˆC++å®ç°)ï¼Œçº¿ç¨‹è·å¾—é”<strong>éœ€è¦ä½¿ç”¨å¯¹è±¡ï¼ˆé”ï¼‰å…³è”monitor</strong></p><p>Monitor ï¼š</p><p>Monitor è¢«ç¿»è¯‘ä¸ºç›‘è§†å™¨ï¼Œæ˜¯ç”± jvm æä¾›ï¼Œc ++ è¯­è¨€å®ç°</p><p>Monitor ç»“æ„</p><ul><li>Ownerï¼šå­˜å‚¨å½“å‰è·å–é”çš„çº¿ç¨‹çš„ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–</li><li>EntryListï¼šå…³è”æ²¡æœ‰æŠ¢åˆ°é”çš„çº¿ç¨‹ï¼Œå¤„äº Blocked çŠ¶æ€çš„çº¿ç¨‹</li><li>WaitSetï¼šå…³è”è°ƒç”¨äº† wait æ–¹æ³•çš„çº¿ç¨‹ï¼Œå¤„äº Waiting çŠ¶æ€çš„çº¿ç¨‹</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240304210121.png" alt="image.png"></p><p>synchronized æ–¹æ³•ä½¿ç”¨ï¼š</p><p>åœ¨æˆ‘ä»¬çš„æµ‹è¯•ç±»ï¼Œè¿›è¡Œåç¼–è¯‘åå¯ä»¥çœ‹åˆ°ä¼šæœ‰ monitor å¯¹é”ç›¸å…³çš„æ“ä½œ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240304205918.png" alt="image.png"></p><h4 id="è®²ä¸€ä¸‹-Java-å¯¹è±¡å¤´ï¼Œä»¥åŠå’Œ-synchronized-çš„å…³è”"><a href="#è®²ä¸€ä¸‹-Java-å¯¹è±¡å¤´ï¼Œä»¥åŠå’Œ-synchronized-çš„å…³è”" class="headerlink" title="è®²ä¸€ä¸‹ Java å¯¹è±¡å¤´ï¼Œä»¥åŠå’Œ synchronized çš„å…³è”"></a>è®²ä¸€ä¸‹ Java å¯¹è±¡å¤´ï¼Œä»¥åŠå’Œ synchronized çš„å…³è”</h4><p>åœ¨ JDK1.6 å¼•å…¥äº†ä¸¤ç§æ–°å‹é”æœºåˆ¶ï¼š<strong>åå‘é”å’Œè½»é‡çº§é”</strong>ï¼Œå®ƒä»¬çš„å¼•å…¥æ˜¯ä¸ºäº†è§£å†³åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰æˆ–åŸºæœ¬æ²¡æœ‰ç«äº‰çš„åœºæ™¯ä¸‹å› ä½¿ç”¨ä¼ ç»Ÿé”æœºåˆ¶å¸¦æ¥çš„æ€§èƒ½å¼€é”€é—®é¢˜ã€‚</p><p>è€Œåå‘é”å’Œè½»é‡çº§é”çš„ä½¿ç”¨æ˜¯è·Ÿ Java å¯¹è±¡å¤´çš„ç»“æ„è®¾è®¡æœ‰å…³ã€‚</p><p>å¯¹è±¡çš„å†…å­˜ç»“æ„</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240304211931.png" alt="image.png"></p><p>MardWord</p><p>åœ¨å¯¹è±¡å¤´ä¸­çš„ MarkWord ä¸­ï¼Œå…¶ç»“æ„è®¾è®¡ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240304212102.png" alt="image.png"></p><p><strong>é‡é‡çº§é”</strong></p><p>é‡é‡çº§é”ï¼ˆå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ ptr_to_heavyweight_monitor ï¼Œé‡é‡çº§é”çŠ¶æ€çš„æ—¶å€™ä¼šé€šè¿‡è¿™ä¸ªæŒ‡å‘ç›‘è§†å™¨  Monitor ï¼‰</p><ul><li>æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥å…³è”ä¸€ä¸ª Monitor å¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨ synchronized ç»™å¯¹è±¡ä¸Šé”ï¼ˆé‡é‡çº§ï¼‰ä¹‹åï¼Œè¯¥å¯¹è±¡å¤´çš„ Mard Word ä¸­å°±è¢«è®¾ç½®æŒ‡å‘ Monitor å¯¹è±¡çš„æŒ‡é’ˆã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240304212150.png" alt="image.png"></p><p>åœ¨å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œåœ¨ Java ç¨‹åºè¿è¡Œæ—¶ï¼ŒåŒæ­¥å—ä¸­çš„ä»£ç éƒ½æ˜¯ä¸å­˜åœ¨ç«äº‰çš„ï¼Œä¸åŒçš„çº¿ç¨‹äº¤æ›¿çš„æ‰§è¡ŒåŒæ­¥å—ä¸­çš„ä»£ç ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨é‡é‡çº§é”æ˜¯æ²¡å¿…è¦çš„ã€‚å› æ­¤ JVMå¼•å…¥äº†è½»é‡çº§é”çš„æ¦‚å¿µã€‚</p><p><strong>è½»é‡çº§é”</strong></p><p>åœ¨è½»é‡çº§é”çŠ¶æ€ä¸‹ï¼Œé”è®°å½•ä¼šå’Œ Object çš„å¯¹è±¡å¤´ä¸­çš„ MarkWord è¿›è¡Œ CAS äº¤äº’</p><p>æ¯è¿›æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½ä¼šè¿›è¡Œä¸€æ¬¡ CAS æ“ä½œ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240309224654.png" alt="image.png"></p><p>è½»é‡çº§é”</p><p>å¦‚æœä¸€ä¸ªé”æ˜¯è½»é‡çº§ç«äº‰ï¼Œå³è¢«é”å®šçš„ä»£ç å—å¿«é€Ÿæ‰§è¡Œå®Œæ¯•ä¸”æ²¡æœ‰å…¶ä»–çº¿ç¨‹ç«äº‰è¯¥é”ï¼Œé‚£ä¹ˆå¯ä»¥é¿å…é‡é‡çº§é”çš„å¼€é”€ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ï¼ˆäº¤å‰æ‰§è¡Œï¼‰</p><p>åŠ é”æµç¨‹</p><ul><li>1.åœ¨çº¿ç¨‹æ ˆä¸­åˆ›å»ºä¸€ä¸ªLock Recordï¼Œå°†å…¶objå­—æ®µæŒ‡å‘é”å¯¹è±¡ã€‚<ul><li><strong>é”æ ‡è®°</strong>ï¼šå½“ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆå³ï¼Œè¯¥å¯¹è±¡å¤´çš„Mark Wordæœªè¢«é”å®šï¼‰ï¼ŒJVMé¦–å…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ã€‚</li></ul></li><li>2.é€šè¿‡CASæŒ‡ä»¤å°†Lock Recordçš„åœ°å€å­˜å‚¨åœ¨å¯¹è±¡å¤´çš„mark wordä¸­ï¼Œå¦‚æœå¯¹è±¡å¤„äºæ— é”çŠ¶æ€åˆ™ä¿®æ”¹æˆåŠŸï¼Œä»£è¡¨è¯¥çº¿ç¨‹è·å¾—äº†è½»é‡çº§é”ã€‚<ul><li><strong>å°è¯•åŠ é”</strong>ï¼šJVMä¼šå°è¯•ä½¿ç”¨CASï¼ˆCompare-And-Swapï¼‰æ“ä½œå°†å¯¹è±¡å¤´çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚æ­¤æ—¶ï¼Œé”è®°å½•ä¹Ÿä¼šæŒ‡å›å¯¹è±¡å¤´çš„Mark Wordï¼Œè¿™æ ·å°±å»ºç«‹äº†ä¸€ç§åŒå‘å…³ç³»ã€‚</li></ul></li><li>3.å¦‚æœæ˜¯å½“å‰çº¿ç¨‹å·²ç»æŒæœ‰è¯¥é”äº†ï¼Œä»£è¡¨è¿™æ˜¯ä¸€æ¬¡é”é‡å…¥ã€‚è®¾ç½®Lock Recordç¬¬ä¸€éƒ¨åˆ†ä¸ºnull,èµ·åˆ°äº†ä¸€ä¸ªé‡å…¥è®¡æ•°å™¨çš„ä½œç”¨ã€‚</li><li>4.å¦‚æœCASä¿®æ”¹å¤±è´¥ï¼Œè¯´æ˜å‘ç”Ÿäº†ç«äº‰ï¼Œéœ€è¦è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚<ul><li><strong>é”å‡çº§</strong>ï¼šå¦‚æœè¿™ä¸ªCASæ“ä½œæˆåŠŸï¼Œå½“å‰çº¿ç¨‹å°±æŒæœ‰äº†è¿™ä¸ªå¯¹è±¡çš„è½»é‡çº§é”ã€‚å¦‚æœCASæ“ä½œå¤±è´¥ï¼Œè¡¨ç¤ºæœ‰å…¶ä»–çº¿ç¨‹ç«äº‰è¿™ä¸ªé”ã€‚JVMä¼šæ£€æŸ¥è¿™ä¸ªé”æ˜¯å¦å·²ç»è¢«å½“å‰çº¿ç¨‹æŒæœ‰ï¼š<ul><li>å¦‚æœæ˜¯ï¼Œçº¿ç¨‹å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ï¼Œå®ç°äº†é”çš„é‡å…¥ã€‚</li><li>å¦‚æœä¸æ˜¯ï¼Œè¡¨ç¤ºå­˜åœ¨é”ç«äº‰ã€‚JVMé¦–å…ˆä¼šå°è¯•è¿›è¡Œè‡ªæ—‹ç­‰å¾…ï¼ˆspin-waitingï¼‰ï¼Œä»¥æœŸå¾…å¾ˆå¿«è·å–é”ã€‚å¦‚æœè‡ªæ—‹å¤±è´¥å¹¶ä¸”ç«äº‰æŒç»­å­˜åœ¨ï¼Œè½»é‡çº§é”å°±ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚</li></ul></li></ul></li></ul><p>è§£é”è¿‡ç¨‹</p><ul><li>1.éå†çº¿ç¨‹æ ˆï¼Œæ‰¾åˆ°æ‰€æœ‰objå­—æ®µç­‰äºå½“å‰é”å¯¹è±¡çš„ Lock Recordã€‚</li><li>2.å¦‚æœ Lock Record çš„ Mark Word ä¸º null ,ä»£è¡¨è¿™æ˜¯ä¸€æ¬¡é‡å…¥ï¼Œå°†objè®¾ç½®ä¸ºnullåcontinueã€‚</li><li>3.å¦‚æœLock Record çš„Mark Wordä¸ä¸º null,  åˆ™åˆ©ç”¨CASæŒ‡ä»¤å°†å¯¹è±¡å¤´çš„ mark word æ¢å¤æˆä¸ºæ— é”çŠ¶æ€ã€‚å¦‚æœå¤±è´¥åˆ™è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</li></ul><p><strong>åå‘é”</strong></p><p>è½»é‡çº§é”åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼ˆå°±è‡ªå·±è¿™ä¸ªçº¿ç¨‹ï¼‰ï¼Œæ¯æ¬¡é‡å…¥ä»ç„¶éœ€è¦æ‰§è¡ŒCASæ“ä½œã€‚</p><p>Java6ä¸­å¼•å…¥äº†åå‘é”æ¥åšè¿›ä¸€æ­¥ä¼˜åŒ–ï¼šåªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨CASå°†çº¿ç¨‹IDè®¾ç½®åˆ°å¯¹è±¡çš„Mark Wordå¤´ï¼Œä¹‹åå‘ç°è¿™ä¸ª<strong>çº¿ç¨‹ IDæ˜¯è‡ªå·±çš„å°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰</strong>ï¼Œä¸ç”¨é‡æ–°CASã€‚ä»¥ååªè¦ä¸å‘ç”Ÿç«äº‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å½’è¯¥çº¿ç¨‹æ‰€æœ‰ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240309225727.png" alt="image.png"></p><h4 id="é”å‡çº§"><a href="#é”å‡çº§" class="headerlink" title="é”å‡çº§"></a>é”å‡çº§</h4><p>Monito å®ç°çš„é”å±äºé‡é‡çº§é”ï¼Œä½ äº†è§£è¿‡é”å‡çº§å— ï¼Ÿ</p><p>Javaä¸­çš„synchronizedæœ‰åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ä¸‰ç§å½¢å¼ï¼Œåˆ†åˆ«å¯¹åº”äº†é”åªè¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€ä¸åŒçº¿ç¨‹äº¤æ›¿æŒæœ‰é”ã€å¤šçº¿ç¨‹ç«äº‰é”ä¸‰ç§æƒ…å†µã€‚</p><table><thead><tr><th></th><th>æè¿°</th></tr></thead><tbody><tr><td>é‡é‡çº§é”</td><td>åº•å±‚ä½¿ç”¨çš„ Monitor å®ç°ï¼Œé‡Œé¢æ¶‰åŠåˆ°äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢ã€è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæˆæœ¬è¾ƒé«˜ï¼Œæ€§èƒ½æ¯”è¾ƒä½ã€‚</td></tr><tr><td>è½»é‡çº§é”</td><td>çº¿ç¨‹åŠ é”çš„æ—¶é—´æ˜¯é”™å¼€çš„ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰ç«äº‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨è½»é‡çº§é”æ¥ä¼˜åŒ–ã€‚è½»é‡çº§ä¿®æ”¹äº†å¯¹è±¡å¤´çš„é”æ ‡å¿—ï¼Œç›¸å¯¹é‡é‡çº§é”æ€§èƒ½æå‡å¾ˆå¤šã€‚æ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯ CAS æ“ä½œï¼Œä¿è¯åŸå­æ€§</td></tr><tr><td>åå‘é”</td><td>ä¸€æ®µå¾ˆé•¿çš„æ—¶é—´å†…éƒ½åªè¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨é”ï¼Œå¯ä»¥ä½¿ç”¨äº†åå‘é”ï¼Œåœ¨ç¬¬ä¸€æ¬¡è·å¾—é”æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ª CAS æ“ä½œï¼Œä¹‹åè¯¥çº¿ç¨‹å†è·å–é”ï¼Œåªéœ€è¦åˆ¤æ–­ mark wordä¸­æ˜¯å¦æ˜¯è‡ªå·±çš„çº¿ç¨‹idå³å¯ï¼Œè€Œä¸æ˜¯å¼€é”€ç›¸å¯¹è¾ƒå¤§çš„ CAS å‘½ä»¤</td></tr></tbody></table><p>ä¸€æ—¦é”å‘ç”Ÿäº†ç«äº‰ï¼Œéƒ½ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚</p><h4 id="èŠä¸€ä¸‹-synchronized"><a href="#èŠä¸€ä¸‹-synchronized" class="headerlink" title="èŠä¸€ä¸‹  synchronized"></a>èŠä¸€ä¸‹  synchronized</h4><p>synchronized æ˜¯Javaçš„å†…ç½®é”ï¼Œå±äºæ‚²è§‚é”ï¼Œæ‚²è§‚é”å°±æ˜¯æ¯æ¬¡è¯»å†™çš„ æ—¶å€™éƒ½ä¼šåŠ é”ï¼Œæƒ³è¦â½¤å¿…é¡»ç­‰å¾…å‰â¾¯çš„çº¿ç¨‹è§£é”ã€‚</p><ul><li>åœ¨JDK 6ä¹‹å‰æ˜¯åŸºäºMonitoræœºåˆ¶å®ç°çš„ï¼Œä¾èµ–äºåº•å±‚äº’æ–¥åŸè¯­ Mutexï¼Œå±äºé‡é‡çº§é”ï¼Œæ€§èƒ½è¾ƒä½ </li><li>åœ¨JDK 6ä¹‹åè¿«äºJUCåŒ…çš„å‹â¼’ï¼Œå¯¹synchronziedè¿›â¾äº†ä¼˜åŒ–ï¼Œå¼• â¼Šäº†åå‘é”ã€è½»é‡çº§é”ç­‰æœºåˆ¶ï¼Œ<ul><li>synchronizedä¸ºäº†é¿å…ç›´æ¥ä»â½¤ æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€parkçº¿ç¨‹ï¼Œæ‰€ä»¥åœ¨å•â¼€çº¿ç¨‹çš„æƒ…å†µä¸‹é»˜è®¤å¼€å¯ åå‘é”ï¼Œ</li><li>åœ¨çº¿ç¨‹äº¤æ›¿æ‰§â¾çš„æ—¶å€™ä¼šä½¿â½¤è½»é‡çº§é”ï¼Œåå‘é”å’Œè½»é‡ çº§é”æ“ä½œéƒ½æ˜¯åŸºäºâ½¤æˆ·æ€çš„å¯¹è±¡MarkWordï¼Œä¹Ÿå°±è¡¨ç¤ºè¿™ä¸¤ç§æƒ…å†µ ä¸‹åŠ è§£é”ä¸éœ€è¦åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œæ€§èƒ½â¼ä¹â½†æŸè€—ï¼Œ</li><li>å¦‚æœç«äº‰ç›¸å¯¹ æ¿€çƒˆï¼Œè½»é‡çº§é”ä¼˜å…ˆé‡‡â½¤â¾ƒé€‚åº”â¾ƒæ—‹æ¥é¿å…parkï¼Œ</li><li>å¦‚æœå®åœ¨ä¸ â¾ï¼Œæ‰ä¼šå¯åŠ¨é‡é‡çº§é”ï¼Œparkè®©Mutexäº’æ–¥é‡æ¥è¿›â¾ï¼Œå¦‚ä»Šæ€§èƒ½åŸº æœ¬ä¸JUCæŒå¹³</li></ul></li></ul><p>synchronizedçš„â½¤æ³• </p><ul><li>å¯¹ç±»å¯¹è±¡åŠ é” <ul><li>synchronized(A.class) </li><li>synchronized static a()</li></ul></li><li>å¯¹ç±»å®ä¾‹å¯¹è±¡åŠ é” <ul><li>synchronized(this) </li><li>synchronized(obj) </li><li>synchornized a()</li></ul></li></ul><p>synchonirzdå¦‚ä½•ä¿è¯å¹¶å‘çš„ä¸‰â¼¤ç‰¹æ€§çš„</p><ul><li>åŸâ¼¦æ€§ <ul><li>åŸâ¼¦æ€§æ˜¯é€šè¿‡åŠ é”å’Œé‡Šæ”¾é”ä¿è¯çš„</li></ul></li><li>æœ‰åºæ€§ã€å¯â»…æ€§ <ul><li>é€šè¿‡åœ¨åŠ é”å’Œè§£é”è¿‡ç¨‹ä¸­ä½¿â½¤å†…å­˜å±éšœæ¥ç¡®ä¿å…±äº«å˜é‡çš„å˜åŒ–    å¯¹æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å¯â»…çš„ä»¥åŠé˜²â½ŒæŒ‡ä»¤é‡æ’åº <ul><li>åŠ é” <ul><li>loadå±éšœ + acquireå±éšœ</li></ul></li><li>è§£é” <ul><li>storeå±éšœ + releaseå±éšœ</li></ul></li></ul></li></ul></li></ul><p>ä»å­—èŠ‚ç å±‚â¾¯çœ‹synchronized </p><ul><li>åŒæ­¥ä»£ç å— <ul><li>é€šè¿‡monitorenterå’Œä¸¤ä¸ªmonitorexitå®ç°çš„ï¼Œå¯¹äºç¬¬â¼€ä¸ª monitorexitå¤„ç†æ­£å¸¸è¿”å›ï¼Œç¬¬â¼†ä¸ªmonitorexitå¤„ç†å¼‚å¸¸æƒ…å†µ â¾ƒåŠ¨é‡Šæ”¾é”ï¼Œæ‰€ä»¥synchronizedä¸åƒLocké‚£æ ·éœ€è¦â¾ƒâ¼°é‡Šæ”¾ é”ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥é€šè¿‡Unsafeç±»å»â¼¿åŠ¨æ§åˆ¶synchronizedï¼Œä½†æ˜¯ ä¸æ¨è </li><li>synchronizedçš„å¯é‡â¼Šçš„å®ç° <ul><li>synchronizedä¼šç»´æŠ¤â¼€ä¸ªè®¡æ•°å™¨ï¼Œå½“monitorenteræ—¶è®¡æ•°å™¨ +1ï¼Œmonitorexitæ—¶è®¡æ•°å™¨ -1</li></ul></li></ul></li><li>åŒæ­¥â½…æ³• <ul><li>é€šè¿‡ acc_synchronized è®¿é—®æ ‡å¿—å®ç°</li></ul></li></ul><hr><p>è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ synchronizedçš„â½¤æ³• </p><blockquote><p>ç±»å¯¹è±¡åŠ é”</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">someMethod</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-title function_">synchronized</span>(<span class="hljs-params">MyClass.<span class="hljs-keyword">class</span></span>) &#123;<br>            <span class="hljs-comment">// ä»£ç å—ï¼Œå¯¹MyClassç±»å¯¹è±¡åŠ é”</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡é™æ€æ–¹æ³•</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">someStaticMethod</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// é™æ€æ–¹æ³•ä½“ï¼Œå¯¹MyClassç±»å¯¹è±¡åŠ é”</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å¯¹ç±»å®ä¾‹å¯¹è±¡åŠ é”</p></blockquote><p>é€šè¿‡ä»£ç å—ï¼ˆä½¿ç”¨thisï¼‰ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">instanceMethod1</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-title function_">synchronized</span>(<span class="hljs-params"><span class="hljs-variable language_">this</span></span>) &#123;<br>            <span class="hljs-comment">// ä»£ç å—ï¼Œå¯¹å½“å‰å®ä¾‹å¯¹è±¡thisåŠ é”</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä»£ç å—ï¼ˆä½¿ç”¨ç‰¹å®šå¯¹è±¡ï¼‰ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Object</span> lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">instanceMethod2</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-title function_">synchronized</span>(<span class="hljs-params">lock</span>) &#123;<br>            <span class="hljs-comment">// ä»£ç å—ï¼Œå¯¹ç‰¹å®šå¯¹è±¡lockåŠ é”</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡å®ä¾‹æ–¹æ³•</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">void</span> <span class="hljs-title">instanceMethod3</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// å®ä¾‹æ–¹æ³•ä½“ï¼Œå¯¹å½“å‰å®ä¾‹å¯¹è±¡thisåŠ é”</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å»ºè®®ï¼šå°½é‡é¿å…å°†<code>synchronized</code>ç”¨åœ¨æ–¹æ³•å£°æ˜ä¸Šï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜åº¦ç«äº‰çš„ç¯å¢ƒä¸‹ï¼Œå¯ä»¥é€šè¿‡å‡å°é”çš„ç²’åº¦æ¥æé«˜æ•ˆç‡ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨åŒæ­¥ä»£ç å—ã€‚</p><hr><p>å¯¹äºå†…å­˜å±éšœçš„è§£é‡Šï¼š</p><p>å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºå’Œç¡®ä¿å†…å­˜æ“ä½œçš„å¯è§æ€§ã€‚å®ƒæ˜¯å¹¶å‘ç¼–ç¨‹ä¸­è§£å†³CPUæŒ‡ä»¤é‡æ’åºå’Œå†…å­˜å¯è§æ€§é—®é¢˜çš„å…³é”®æŠ€æœ¯ã€‚å†…å­˜å±éšœå¯ä»¥ç¡®ä¿åœ¨å±éšœä¹‹å‰çš„æ‰€æœ‰æ“ä½œåœ¨å±éšœä¹‹åçš„æ“ä½œå¼€å§‹å‰å®Œæˆã€‚åœ¨å¤šæ ¸å¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œè¿™å¯¹äºç»´æŠ¤æ•°æ®çš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§è‡³å…³é‡è¦ã€‚</p><p>å†…å­˜å±éšœä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li>Loadå±éšœï¼ˆLoad Barrierï¼‰<ul><li><strong>ç›®çš„</strong>ï¼šç¡®ä¿Loadå±éšœä¹‹å‰çš„æ‰€æœ‰è¯»æ“ä½œåœ¨å±éšœä¹‹åçš„è¯»æ“ä½œä¹‹å‰å®Œæˆã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šä¸»è¦ç”¨äºç¡®ä¿å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å½“å‰çº¿ç¨‹ç«‹å³å¯è§ã€‚å®ƒé˜²æ­¢äº†åç»­çš„è¯»æ“ä½œè¢«é‡æ’åºåˆ°å±éšœä¹‹å‰ã€‚</li></ul></li><li>Storeå±éšœï¼ˆStore Barrierï¼‰<ul><li><strong>ç›®çš„</strong>ï¼šç¡®ä¿Storeå±éšœä¹‹å‰çš„æ‰€æœ‰å†™æ“ä½œåœ¨å±éšœä¹‹åçš„å†™æ“ä½œä¹‹å‰å®Œæˆã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šç”¨äºç¡®ä¿å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹ç«‹å³å¯è§ã€‚å®ƒé˜»æ­¢äº†ä¹‹å‰çš„å†™æ“ä½œè¢«é‡æ’åºåˆ°å±éšœä¹‹åã€‚</li></ul></li><li>Acquireå±éšœï¼ˆAcquire Barrierï¼‰<ul><li><strong>ç›®çš„</strong>ï¼šé˜²æ­¢å±éšœä¹‹åçš„è¯»å†™æ“ä½œè¢«é‡æ’åºåˆ°å±éšœä¹‹å‰ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€šå¸¸ä¸é”è·å–æ“ä½œç›¸å…³è”ã€‚å®ƒç¡®ä¿è·å–é”ä¹‹åçš„æ“ä½œä¸ä¼šä¸ä¹‹å‰çš„æ“ä½œå‘ç”Ÿé‡æ’åºã€‚</li></ul></li><li>Releaseå±éšœï¼ˆRelease Barrierï¼‰<ul><li><strong>ç›®çš„</strong>ï¼šé˜²æ­¢å±éšœä¹‹å‰çš„è¯»å†™æ“ä½œè¢«é‡æ’åºåˆ°å±éšœä¹‹åã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šä¸é”é‡Šæ”¾æ“ä½œç›¸å…³è”ã€‚å®ƒç¡®ä¿é‡Šæ”¾é”ä¹‹å‰çš„æ“ä½œä¸ä¼šä¸ä¹‹åçš„æ“ä½œå‘ç”Ÿé‡æ’åºã€‚</li></ul></li></ul><p>åœ¨<code>synchronized</code>ä¸­çš„åº”ç”¨</p><p>å½“è¿›å…¥<code>synchronized</code>å—æ—¶ï¼Œä¼šæ’å…¥ä¸€ä¸ªAcquireå±éšœï¼Œå®ƒç¡®ä¿è¿›å…¥<code>synchronized</code>å—åçš„æ‰€æœ‰è¯»å†™æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°å±éšœä¹‹å‰ã€‚è¿™ä¿è¯äº†è¿›å…¥åŒæ­¥å—æ—¶ï¼Œå¯¹å…±äº«å˜é‡çš„æ‰€æœ‰ä¿®æ”¹éƒ½å¯¹å½“å‰çº¿ç¨‹å¯è§ã€‚</p><p>å½“é€€å‡º<code>synchronized</code>å—æ—¶ï¼Œä¼šæ’å…¥ä¸€ä¸ªReleaseå±éšœï¼Œå®ƒç¡®ä¿é€€å‡º<code>synchronized</code>å—å‰çš„æ‰€æœ‰è¯»å†™æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°å±éšœä¹‹åã€‚è¿™ç¡®ä¿äº†é€€å‡ºåŒæ­¥å—æ—¶ï¼Œå¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹ç«‹å³å¯è§ã€‚</p><p>é€šè¿‡ä½¿ç”¨è¿™äº›å†…å­˜å±éšœï¼Œ<code>synchronized</code>èƒ½å¤Ÿä¸ºJavaç¨‹åºæä¾›åŸå­æ€§ã€æœ‰åºæ€§å’Œå¯è§æ€§ä¿è¯ã€‚åŸå­æ€§æ˜¯é€šè¿‡åŠ é”å’Œé‡Šæ”¾é”æ¥å®ç°çš„ï¼Œè€Œæœ‰åºæ€§å’Œå¯è§æ€§åˆ™æ˜¯é€šè¿‡åœ¨åŠ é”å’Œè§£é”è¿‡ç¨‹ä¸­ä½¿ç”¨å†…å­˜å±éšœæ¥ç¡®ä¿çš„ã€‚</p><hr><h4 id="synchronizedçš„é”å˜åŒ–"><a href="#synchronizedçš„é”å˜åŒ–" class="headerlink" title="synchronizedçš„é”å˜åŒ–"></a>synchronizedçš„é”å˜åŒ–</h4><ul><li>â¾¸å…ˆæˆ‘ä»¬å…ˆåˆ¤æ–­æœ‰æ²¡æœ‰ç¦â½¤åå‘é”æˆ–è€…ä¸æ»¡â¾œå»¶è¿Ÿåå‘æ¡ä»¶ï¼Œå¦‚æœæ²¡ æœ‰ç¦â½¤åå‘é”ä»¥åŠæ»¡â¾œå»¶è¿Ÿåå‘æ¡ä»¶ï¼Œé‚£ä¹ˆå°±å¼€å§‹å»¶è¿Ÿåå‘4sï¼Œç„¶å åˆ›å»ºé”å¯¹è±¡ï¼Œå¯¹äºæ­¤æ—¶å¤„äº<strong>åŒ¿ååå‘çŠ¶æ€</strong>ï¼Œå½“åœ¨åŒæ­¥ä»£ç å—ä¸­æ—¶ï¼Œä¼š é€šè¿‡CASå°†å½“å‰çº¿ç¨‹IDè®¾ç½®åˆ°é”å¯¹è±¡çš„MarkWordä¸­å» <ul><li>å½“å¤„äºåå‘é”æ—¶ï¼Œè°ƒâ½¤hashCodeâ½…æ³•ä¼šæ’¤é”€ä¸ºâ½†é”çŠ¶æ€ï¼Œå› ä¸ºå å‘é”æ²¡æœ‰å­˜æ”¾hashcodeçš„ä½ç½®ï¼Œâ½†é”çŠ¶æ€å¯ä»¥å­˜æ”¾ </li><li>å½“å¤„äºåå‘é”æ—¶ï¼Œåœ¨åŒæ­¥ä»£ç å—ä¸­è°ƒâ½¤notifyâ½…æ³•ä¼šæ’¤é”€ä¸ºè½»é‡çº§ é” </li><li>å½“å¤„äºåå‘é”æ—¶ï¼Œåœ¨åŒæ­¥ä»£ç å—ä¸­è°ƒâ½¤hashCodeâ½…æ³•ä»¥åŠwaitâ½… æ³•ä¼šæ’¤é”€ä¸ºé‡é‡çº§é” </li><li>å½“å¤„äºåå‘é”æ—¶ï¼Œåå‘é”å¯èƒ½ä¼šé‡åå‘ä¸ºåŒ¿ååå‘çŠ¶æ€</li></ul></li><li>å½“æˆ‘ä»¬ç¦â½¤åå‘é”æˆ–è€…ä¸æ»¡â¾œå»¶è¿Ÿåå‘æ¡ä»¶æ—¶ï¼Œå…ˆåˆ›å»ºé”çŠ¶æ€æ­¤æ—¶ä¸º â½†é”çŠ¶æ€ <ul><li>å½“å‘â½£è½»å¾®ç«äº‰æ—¶ï¼Œâ½†é”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼ŒCASä¿®æ”¹é”å¯¹è±¡ä¸­ çš„MarkWordå¹¶ä¸”æ‹·â»‰â¼€ä»½MarkWordåˆ°æ ˆä¸­çš„é”è®°å½•â¾¥ </li><li>å½“å¤„äºè½»é‡çº§é”æ—¶ï¼Œå¦‚æœå‘â½£æ¿€çƒˆç«äº‰ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”,åˆ›å»º Monitorå¯¹è±¡ï¼ŒCASä¿®æ”¹MarkWord å½“å¤„äºâ½†é”çŠ¶æ€æ—¶,å¦‚æœç¢°åˆ°æ¿€çƒˆç«äº‰ï¼Œä¼šåˆ›å»ºMonitorå¯¹è±¡ï¼ŒCAS ä¿®æ”¹MarkWord </li><li>é‡é‡çº§é”å¯ä»¥è§£é”åˆ°â½†é”çŠ¶æ€ </li><li>è½»é‡çº§é”ä¹Ÿå¯ä»¥è§£é”åˆ°â½†é”çŠ¶æ€</li></ul></li></ul><h4 id="synchronized-é”ç²—åŒ–ã€é”æ¶ˆé™¤"><a href="#synchronized-é”ç²—åŒ–ã€é”æ¶ˆé™¤" class="headerlink" title="synchronized é”ç²—åŒ–ã€é”æ¶ˆé™¤"></a>synchronized é”ç²—åŒ–ã€é”æ¶ˆé™¤</h4><ul><li>é”ç²—åŒ– <ul><li>â½å¦‚é”å¯¹è±¡å‡ºç°åœ¨å¾ªç¯ä½“ä¸­ï¼Œåå¤åŠ é”é‡Šæ”¾é”ï¼Œå³ä½¿æ²¡æœ‰å‡ºç°çº¿ ç¨‹ç«äº‰ä¹Ÿä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå½“JVMæ£€æµ‹åˆ°è¿™ç§æ“ä½œï¼Œä¼šå°†é”çš„èŒƒ å›´æ‰©â¼¤åˆ°å¾ªç¯ä½“å¤– <ul><li>é”ç²—åŒ–æ˜¯æŒ‡å°†å¤šä¸ªè¿ç»­çš„é”æ‰©å±•ï¼ˆæˆ–åˆå¹¶ï¼‰ä¸ºä¸€ä¸ªèŒƒå›´æ›´å¤§çš„é”ï¼Œä»¥å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœåœ¨ä¸€ç³»åˆ—çš„æ“ä½œä¸­åå¤å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”å’Œè§£é”ï¼Œå³ä½¿æ²¡æœ‰çº¿ç¨‹ç«äº‰ï¼Œé¢‘ç¹çš„é”æ“ä½œä¹Ÿä¼šæ¶ˆè€—å¤§é‡èµ„æºã€‚</li><li>å¦‚æœè¿™ä¸ªå¾ªç¯æ‰§è¡Œçš„æ¬¡æ•°éå¸¸å¤šï¼Œé‚£ä¹ˆåŠ é”è§£é”çš„å¼€é”€å°±ä¼šå˜å¾—å¾ˆå¤§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJVMä¼šé‡‡å–é”ç²—åŒ–ç­–ç•¥ï¼Œå°†æ•´ä¸ªå¾ªç¯å—å¤–å›´ç”¨ä¸€ä¸ªè¾ƒå¤§èŒƒå›´çš„é”æ›¿ä»£ï¼Œä»è€Œå‡å°‘é”çš„å¼€é”€ã€‚</li></ul></li></ul></li><li>é”æ¶ˆé™¤ <ul><li>â½å¦‚åœ¨å•çº¿ç¨‹æƒ…å†µåŠ é”ï¼Œä¸å­˜åœ¨ç«äº‰ï¼ŒJVMä¼šæ¸…é™¤é”<ul><li>é”æ¶ˆé™¤æ˜¯æŒ‡JVMåœ¨JITç¼–è¯‘é˜¶æ®µé€šè¿‡è¿è¡Œæ—¶ä»£ç åˆ†æï¼Œå»é™¤é‚£äº›ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰çš„é”ã€‚è¿™æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œç›®çš„æ˜¯å‡å°‘ä¸å¿…è¦çš„é”æ“ä½œï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚</li></ul></li></ul></li></ul><p>é”æ¸…é™¤ï¼š è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"><span class="hljs-keyword">public</span> void <span class="hljs-keyword">method</span><span class="hljs-params">()</span> <span class="hljs-comment">&#123;</span><br><span class="hljs-comment">    Object lock = new Object();</span><br><span class="hljs-comment">    synchronized(lock) &#123;</span><br><span class="hljs-comment">        // æ“ä½œéå…±äº«èµ„æº</span><br><span class="hljs-comment">    &#125;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>lock</code>æ˜¯ä¸€ä¸ªæ–¹æ³•å†…çš„å±€éƒ¨å˜é‡ï¼Œå®ƒä¸å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ã€‚</p><p>å› æ­¤ï¼Œå¯¹è¿™ä¸ªå¯¹è±¡çš„åŠ é”å®é™…ä¸Šæ˜¯ä¸å¿…è¦çš„ã€‚JVMçš„é”æ¶ˆé™¤æœºåˆ¶å¯ä»¥æ£€æµ‹åˆ°è¿™ç§æƒ…å†µï¼Œå¹¶å®Œå…¨å»é™¤è¿™ä¸ªé”ï¼Œå‡å°‘è¿è¡Œæ—¶çš„å¼€é”€ã€‚</p><h4 id="è°ˆä¸€ä¸‹-JMM"><a href="#è°ˆä¸€ä¸‹-JMM" class="headerlink" title="è°ˆä¸€ä¸‹ JMM"></a>è°ˆä¸€ä¸‹ JMM</h4><p>è°ˆè°ˆJMM(Javaå†…å­˜æ¨¡å‹)</p><ul><li>JMM(ava Memory Model)Javaå†…å­˜æ¨¡å‹ï¼Œå®šä¹‰äº†<strong>å…±äº«å†…å­˜</strong>ä¸­<strong>å¤šçº¿ç¨‹ç¨‹åºè¯»å†™</strong>æ“ä½œçš„è¡Œä¸ºè§„èŒƒï¼Œé€šè¿‡è¿™äº›è§„åˆ™æ¥è§„èŒƒå¯¹å†…å­˜çš„è¯»å†™æ“ä½œä»è€Œä¿è¯æŒ‡ä»¤çš„æ­£ç¡®æ€§</li><li>JMMæŠŠå†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œä¸€å—æ˜¯ç§æœ‰çº¿ç¨‹çš„å·¥ä½œåŒºåŸŸï¼ˆå·¥ä½œå†…å­˜ï¼‰ï¼Œä¸€å—æ˜¯æ‰€æœ‰çº¿ç¨‹çš„å…±äº«åŒºåŸŸï¼ˆä¸»å†…å­˜ï¼‰</li><li>çº¿ç¨‹è·Ÿçº¿ç¨‹ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»ï¼Œçº¿ç¨‹è·Ÿçº¿ç¨‹äº¤äº’éœ€è¦é€šè¿‡ä¸»å†…å­˜</li></ul><h4 id="è°ˆä¸€ä¸‹-volatile"><a href="#è°ˆä¸€ä¸‹-volatile" class="headerlink" title="è°ˆä¸€ä¸‹ volatile"></a>è°ˆä¸€ä¸‹ volatile</h4><p>volatile çš„ä¸¤ä¸ªä½œç”¨ï¼š</p><ul><li><p>å¯è§æ€§</p><ul><li>ç”¨volatileä¿®é¥°å…±äº«å˜é‡ï¼Œèƒ½å¤Ÿé˜²æ­¢ç¼–è¯‘å™¨ç­‰ä¼˜åŒ–å‘ç”Ÿï¼Œè®©ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§<ul><li>JIT(å³æ—¶ç¼–è¯‘å™¨)</li></ul></li></ul></li><li><p>ç¦æ­¢æŒ‡ä»¤é‡æ’åº</p><ul><li>ç”¨volatileä¿®é¥°å…±äº«å˜é‡ä¼šåœ¨è¯»ã€å†™å…±äº«å˜é‡æ—¶åŠ å…¥ä¸åŒçš„å±éšœï¼Œé˜»æ­¢å…¶ä»–è¯»å†™æ“ä½œè¶Šè¿‡å±éšœï¼Œä»è€Œè¾¾åˆ°é˜»æ­¢é‡æ’åºçš„æ•ˆæœ<ul><li>å†™å˜é‡è®©volatileä¿®é¥°çš„å˜é‡çš„åœ¨ä»£ç æœ€åä½ç½®</li><li>è¯»å˜é‡è®©volatileä¿®é¥°çš„å˜é‡çš„åœ¨ä»£ç æœ€å¼€å§‹ä½ç½®</li></ul></li></ul></li><li><p>1ã€äº†è§£ä¸€ä¸‹åœ¨ Java ä»£ç å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä¼šå‡ºç°æŒ‡ä»¤é‡æ’åºçš„æƒ…å†µ</p></li><li><p>2ã€é€šè¿‡ volatile ä¿®é¥°å˜é‡èƒ½å¤Ÿè¿›è¡Œé˜»æ­¢æŒ‡ä»¤é‡æ’åºçš„æ“ä½œ</p></li></ul><p>é‡æ’åºçš„æƒ…å†µ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312210622.png" alt="image.png"></p><p>volatileä½¿ç”¨æŠ€å·§ï¼š</p><ul><li>å†™å˜é‡è®©volatileä¿®é¥°çš„å˜é‡çš„åœ¨ä»£ç æœ€åä½ç½®</li><li>è¯»å˜é‡è®©volatileä¿®é¥°çš„å˜é‡çš„åœ¨ä»£ç æœ€å¼€å§‹ä½ç½®</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312205100.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240311225430.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312210901.png" alt="image.png"></p><h4 id="CAS-ğŸš©"><a href="#CAS-ğŸš©" class="headerlink" title="CAS  ğŸš©"></a>CAS  ğŸš©</h4><p>CAS ä¸ç®¡æ˜¯åœ¨ AQS æ¡†æ¶ä¸­ï¼Œè¿˜æ˜¯åœ¨ä¸Šé¢æåˆ°çš„ synchronized éƒ½ä½¿ç”¨åˆ°äº†ï¼›</p><p>å…¶ä¸­çš„æ ¸å¿ƒæ€æƒ³æ˜¯  â†’  æ¯”è¾ƒå†äº¤äº’</p><p>å¦‚æœå·¥ä½œåŒºåŸŸçš„æœ€åˆå€¼å’Œä¸»å†…å­˜çš„å€¼æ¯”è¾ƒä¸ç›¸ç­‰ï¼Œåˆ™è‡ªæ—‹ç­‰å¾…ã€‚ï¼ˆè‡ªæ—‹éœ€è¦ç¡®è®¤ä¸€ä¸‹ ğŸš©)</p><p>CAS æ–¹æ³•æ˜¯ unsafe ä¿®é¥°çš„ï¼Œè°ƒç”¨æ˜¯æ“ä½œç³»ç»Ÿçš„æ¥å£ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240304213848.png" alt="image.png"></p><h4 id="ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«"><a href="#ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«" class="headerlink" title="ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«"></a>ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«</h4><p>ä¹è§‚é”ï¼šä¹è§‚çš„çœ‹å¾…å¹¶å‘ä¿®æ”¹é—®é¢˜ï¼Œå…¶ä»–çº¿ç¨‹ä¸ä¼šä¿®æ”¹å…±äº«å˜é‡ï¼Œå¦‚æœæ”¹äº†ï¼Œå°±è‡ªæ—‹ç­‰å¾…ã€‚</p><p>æ‚²è§‚é”ï¼šæ‚²è§‚çš„è®¤ä¸ºåˆ«äººçš„çº¿ç¨‹éƒ½ä¸æ˜¯å¥½äººï¼Œæˆ‘è·å–è¿™æŠŠé”åï¼Œä½ ä»¬éƒ½ä¸èƒ½è®¿é—®äº†ã€‚</p><h4 id="ä½ æœ‰ç”¨è¿‡-Java-é‡Œé¢çš„é”å—"><a href="#ä½ æœ‰ç”¨è¿‡-Java-é‡Œé¢çš„é”å—" class="headerlink" title="ä½ æœ‰ç”¨è¿‡ Java é‡Œé¢çš„é”å—"></a>ä½ æœ‰ç”¨è¿‡ Java é‡Œé¢çš„é”å—</h4><p>synchronized å’Œ ReentantLock çš„ç”¨æ³•è®²ä¸€ä¸‹</p><h4 id="å®ç°å±‚é¢ï¼šsynchronized-å’Œ-ReentantLock-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#å®ç°å±‚é¢ï¼šsynchronized-å’Œ-ReentantLock-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="å®ç°å±‚é¢ï¼šsynchronized å’Œ  ReentantLock æœ‰ä»€ä¹ˆåŒºåˆ«"></a>å®ç°å±‚é¢ï¼šsynchronized å’Œ  ReentantLock æœ‰ä»€ä¹ˆåŒºåˆ«</h4><h4 id="synchronized-ä¿®é¥°æ™®é€šæ–¹æ³•å’Œä¿®é¥°é™æ€æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#synchronized-ä¿®é¥°æ™®é€šæ–¹æ³•å’Œä¿®é¥°é™æ€æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="synchronized ä¿®é¥°æ™®é€šæ–¹æ³•å’Œä¿®é¥°é™æ€æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«"></a>synchronized ä¿®é¥°æ™®é€šæ–¹æ³•å’Œä¿®é¥°é™æ€æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«</h4><h4 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h4><ul><li>AQS<ul><li>æ‚²è§‚é”ï¼Œæ‰‹åŠ¨å¼€å¯å’Œå…³é—­ï¼Œé”å’Œä¸€äº›åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶</li></ul></li><li>åŸºæœ¬å·¥ä½œæœºåˆ¶<ul><li>ç»´æŠ¤äº†ä¸€ä¸ª int åŒæ­¥çŠ¶æ€å˜é‡ state ï¼ˆé»˜è®¤æ˜¯ 0 æ— é”ï¼‰å’Œ ä¸€ä¸ª FIFO å…ˆè¿›å…ˆå‡ºçš„åŒå‘é˜Ÿåˆ—</li><li>å¦‚æœæŸä¸ªçº¿ç¨‹æˆåŠŸè·å–äº†åŒæ­¥çŠ¶æ€ï¼ˆæˆ–é”ï¼‰ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥æ‰§è¡Œç›¸åº”çš„ä¸´ç•ŒåŒºä»£ç ã€‚å¦‚æœè·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œè¯¥çº¿ç¨‹å°†ä¼šè¢«åŠ å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™è¢«é‡æ–°å”¤é†’ï¼ˆæ¯”å¦‚ï¼Œå½“å‰æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼‰ã€‚</li></ul></li><li>åŸå­æ€§<ul><li>é€šè¿‡ cas æ“ä½œå¯¹äº state çŠ¶æ€çš„ä¿®æ”¹</li></ul></li><li>å…¬å¹³é”å’Œéå…¬å¹³é”ï¼ˆä¸¤ç§å®ç°æ–¹å¼ï¼‰<ul><li>éå…¬å¹³é”<ul><li>æ–°çš„çº¿ç¨‹ä¸é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å…±åŒæ¥æŠ¢èµ„æºï¼Œæ˜¯éå…¬å¹³é”</li></ul></li><li>å…¬å¹³é”<ul><li>æ–°çš„çº¿ç¨‹åˆ°é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œåªè®©é˜Ÿåˆ—ä¸­çš„headçº¿ç¨‹è·å–é”ï¼Œæ˜¯å…¬å¹³é”</li></ul></li></ul></li></ul><p>å…¨ç§°æ˜¯AbstractQueuedSynchronizer,å³æŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ã€‚</p><p>å®ƒæ˜¯æ„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶</p><p>AQSä¸Synchronizedlçš„åŒºåˆ«</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312211303.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312211442.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312211640.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312211722.png" alt="image.png"></p><h4 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h4><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ReentrantLock</code>æ˜¯<strong>éå…¬å¹³é”</strong></li><li>å®ç°åŸç†<ul><li>ReentrantLockä¸»è¦åˆ©ç”¨ CAS+AQS é˜Ÿåˆ—æ¥å®ç°ã€‚</li><li>å®ƒæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œä¸¤è€…çš„å®ç°ç±»ä»¥æ„é€ æ–¹æ³•æ¥å—ä¸€ä¸ªå¯é€‰çš„å…¬å¹³å‚æ•°ï¼ˆé»˜è®¤éå…¬å¹³é”ï¼‰ï¼Œå½“è®¾ç½®ä¸º true æ—¶ï¼Œè¡¨ç¤ºå…¬å¹³é”ï¼Œå¦åˆ™ä¸ºéå…¬å¹³é”ã€‚</li><li>å…¬å¹³é”çš„æ•ˆç‡å¾€å¾€æ²¡æœ‰éå…¬å¹³é”çš„æ•ˆç‡é«˜ï¼Œåœ¨è®¸å¤šçº¿ç¨‹è®¿é—®çš„æƒ…å†µä¸‹ï¼Œå…¬å¹³é”è¡¨ç°å‡ºè¾ƒä½çš„ååé‡ã€‚</li></ul></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312213944.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312214108.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312214151.png" alt="image.png"></p><h4 id="synchronized-ä¸-Lock-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#synchronized-ä¸-Lock-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="synchronized ä¸ Lock æœ‰ä»€ä¹ˆåŒºåˆ«"></a>synchronized ä¸ Lock æœ‰ä»€ä¹ˆåŒºåˆ«</h4><p>synchronizedå’ŒLockæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><ul><li>è¯­æ³•å±‚é¢<ul><li>synchronizedæ˜¯å…³é”®å­—ï¼Œæºç åœ¨jvmä¸­ï¼Œç”¨c++è¯­è¨€å®ç°</li><li>Lockæ˜¯æ¥å£ï¼Œæºç ç”±jdkæä¾›ï¼Œç”¨javaè¯­è¨€å®ç°</li><li>ä½¿ç”¨synchronizedæ—¶ï¼Œé€€å‡ºåŒæ­¥ä»£ç å—é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œè€Œä½¿ç”¨Lockæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨unlockæ–¹æ³•é‡Šæ”¾é”</li></ul></li><li>åŠŸèƒ½å±‚é¢<ul><li>äºŒè€…å‡å±äºæ‚²è§‚é”ã€éƒ½å…·å¤‡åŸºæœ¬çš„äº’æ–¥ã€åŒæ­¥ã€é”é‡å…¥åŠŸèƒ½</li><li>Lockæä¾›äº†è®¸å¤šsynchronizedä¸å…·å¤‡çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å…¬å¹³é”ã€å¯æ‰“æ–­ã€å¯è¶…æ—¶ã€å¤šæ¡ä»¶å˜é‡</li><li>Lockæœ‰é€‚åˆä¸åŒåœºæ™¯çš„å®ç°ï¼Œå¦‚ReentrantLock,ReentrantReadWriteLock(è¯»å†™é”ï¼‰</li></ul></li><li>æ€§èƒ½å±‚é¢<ul><li>åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œsynchronizedåšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå¦‚åå‘é”ã€è½»é‡çº§é”ï¼Œæ€§èƒ½ä¸èµ–</li><li>åœ¨ç«äº‰æ¿€çƒˆæ—¶ï¼ŒL0ckçš„å®ç°é€šå¸¸ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½</li></ul></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312214318.png" alt="image.png"></p><h4 id="æ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯ä»€ä¹ˆ"><a href="#æ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯ä»€ä¹ˆ"></a>æ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯ä»€ä¹ˆ</h4><ul><li>æ­»é”ï¼šçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„é”é‡Šæ”¾</li><li>è¯Šæ–­ï¼š<ul><li>1ã€å¯è§†åŒ–å·¥å…· jconsoleã€VisualVM</li><li>2ã€JDK è‡ªå¸¦çš„ï¼šjps å’Œ jstack</li></ul></li></ul><p>æ­»é”ï¼šä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è·å–å¤šæŠŠé”ï¼Œè¿™æ—¶å°±å®¹æ˜“å‘ç”Ÿæ­»é”</p><p>æ­¤æ—¶ç¨‹åºå¹¶æ²¡æœ‰ç»“æŸï¼Œè¿™ç§ç°è±¡å°±æ˜¯æ­»é”ç°è±¡.çº¿ç¨‹t1 æŒæœ‰Açš„é”ç­‰å¾…è·å–Bé”ï¼Œçº¿ç¨‹t2æŒæœ‰Bçš„é”ç­‰å¾…è·å–A çš„é”ã€‚</p><p>å¦‚ä½•è¿›è¡Œæ­»é”è¯Šæ–­ï¼Ÿ</p><ul><li>å½“ç¨‹åºå‡ºç°äº†æ­»é”ç°è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨jdkè‡ªå¸¦çš„å·¥å…·ï¼š jpså’Œjstack<ul><li>jps:è¾“å‡º JVMä¸­è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ä¿¡æ¯</li><li>jstackï¼šæŸ¥çœ‹javaè¿›ç¨‹å†…çº¿ç¨‹çš„å †æ ˆä¿¡æ¯</li></ul></li></ul><p>2.å¦‚ä½•è¿›è¡Œæ­»é”è¯Šæ–­ï¼Ÿ</p><p>å½“ç¨‹åºå‡ºç°äº†æ­»é”ç°è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ jdk è‡ªå¸¦çš„å·¥å…·ï¼šjpså’Œjstack</p><ul><li><p>jps:è¾“å‡º JVM ä¸­è¿è¡Œçš„è¿›ç¨‹çŠ¶æ€ä¿¡æ¯</p></li><li><p>jstack:æŸ¥çœ‹javaè¿›ç¨‹å†…çº¿ç¨‹çš„å †æ ˆä¿¡æ¯ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ­»é”;  å¦‚æœæœ‰æ­»é”ç°è±¡ï¼Œéœ€è¦æŸ¥çœ‹å…·ä½“ä»£ç åˆ†æåï¼Œå¯ä¿®å¤</p></li><li><p>å¯è§†åŒ–å·¥å…· jconsoleã€VisGalVMä¹Ÿå¯ä»¥æ£€æŸ¥æ­»é”é—®é¢˜</p></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312214711.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312214741.png" alt="image.png"></p><h4 id="å¯¼è‡´å¹¶å‘ç¨‹åºå‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ"><a href="#å¯¼è‡´å¹¶å‘ç¨‹åºå‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ" class="headerlink" title="å¯¼è‡´å¹¶å‘ç¨‹åºå‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ"></a>å¯¼è‡´å¹¶å‘ç¨‹åºå‡ºç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆ</h4><p>Javaå¹¶å‘ç¼–ç¨‹ä¸‰å¤§ç‰¹æ€§</p><ul><li>åŸå­æ€§<ul><li>ä¸€ä¸ªçº¿ç¨‹åœ¨ CPU ä¸­æ“ä½œä¸å¯æš‚åœï¼Œä¹Ÿä¸å¯ä¸­æ–­ï¼Œè¦ä¸æ‰§è¡Œå®Œæˆï¼Œè¦ä¸ä¸æ‰§è¡Œ</li><li>ä¸€èˆ¬æ“ä½œï¼ˆåŠ é”ï¼‰<ul><li>synchronizedï¼šåŒæ­¥åŠ é”</li><li>JUCé‡Œé¢çš„lockï¼šåŠ é”</li></ul></li></ul></li><li>å¯è§æ€§<ul><li>å†…å­˜å¯è§æ€§ï¼šè®©ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§</li><li>è§£å†³æ–¹å¼<ul><li>synchronized</li><li>volatile (ä¸€èˆ¬ä½¿ç”¨)</li><li>LOCK</li></ul></li></ul></li><li>æœ‰åºæ€§<ul><li>æŒ‡ä»¤é‡æ’ï¼šå¤„ç†å™¨ä¸ºäº†æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œå¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå®ƒä¸ä¿è¯ç¨‹åºä¸­å„ä¸ªè¯­å¥çš„æ‰§è¡Œå…ˆåé¡ºåºåŒä»£ç ä¸­çš„é¡ºåºä¸€è‡´ï¼Œä½†æ˜¯å®ƒä¼šä¿è¯ç¨‹åºæœ€ç»ˆæ‰§è¡Œç»“æœå’Œä»£ç é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„</li><li>è§£å†³æ–¹æ¡ˆï¼švolatile</li></ul></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240312233851.png" alt="image.png"></p><h3 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h3><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313111136.png" alt="image.png"></p><ul><li>1ã€è¯´ä¸€ä¸‹çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆçº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å—ï¼‰</li><li>2ã€çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å¸¸è§çš„é˜»å¡é˜Ÿåˆ—</li><li>3ã€å¦‚ä½•ç¡®è®¤æ ¸å¿ƒçº¿ç¨‹æ•°</li><li>4ã€çº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº›</li><li>5ã€ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ Executor åˆ›å»ºçº¿ç¨‹æ± </li></ul><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± </p><ul><li><p>1ã€æ¯æ¬¡åˆ›å»ºçº¿ç¨‹éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´</p></li><li><p>2ã€çº¿ç¨‹çš„æ‰§è¡Œéœ€è¦ CPU çš„æ‰§è¡Œæƒï¼ŒCPU çš„è¿ç®—èƒ½åŠ›æ˜¯æœ‰é™çš„</p></li><li><h2 id="çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆæ‰§è¡ŒåŸç†ï¼‰"><a href="#çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆæ‰§è¡ŒåŸç†ï¼‰" class="headerlink" title="çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆæ‰§è¡ŒåŸç†ï¼‰"></a>çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°ï¼ˆæ‰§è¡ŒåŸç†ï¼‰</h2></li></ul><h4 id="çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°"><a href="#çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°" class="headerlink" title="çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°"></a>çº¿ç¨‹æ± çš„æ ¸å¿ƒå‚æ•°</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313085232.png" alt="image.png"></p><ul><li>æ ¸å¿ƒå‚æ•°<ul><li>æ ¸å¿ƒçº¿ç¨‹æ•°ç›®</li><li>æœ€å¤§çº¿ç¨‹æ•°ç›®</li><li>ç”Ÿå­˜æ—¶é—´</li><li>æ—¶é—´å•ä½</li><li>é˜»å¡é˜Ÿåˆ—</li><li>çº¿ç¨‹å·¥å‚</li><li>æ‹’ç»ç­–ç•¥</li></ul></li><li><h2 id="æ‰§è¡ŒåŸç†"><a href="#æ‰§è¡ŒåŸç†" class="headerlink" title="æ‰§è¡ŒåŸç†"></a>æ‰§è¡ŒåŸç†</h2></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313085019.png" alt="image.png"></p><h4 id="çº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å˜›"><a href="#çº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å˜›" class="headerlink" title="çº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å˜›"></a>çº¿ç¨‹æ± çš„æ‰§è¡ŒåŸç†çŸ¥é“å˜›</h4><ul><li>æ‰§è¡ŒåŸç†<ul><li>å½“å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡</li><li>åˆ¤æ–­ä¸€ä¸‹æ ¸å¿ƒçº¿ç¨‹æ˜¯å¦å·²æ»¡<ul><li>æ˜¯ï¼šåˆ¤æ–­é˜»å¡é˜Ÿåˆ—æ˜¯å¦å·²æ»¡</li><li>å¦ï¼š</li></ul></li></ul></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313085343.png" alt="image.png"></p><h4 id="çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å¸¸è§çš„é˜»å¡é˜Ÿåˆ—"><a href="#çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å¸¸è§çš„é˜»å¡é˜Ÿåˆ—" class="headerlink" title="çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å¸¸è§çš„é˜»å¡é˜Ÿåˆ—"></a>çº¿ç¨‹æ± ä¸­æœ‰å“ªäº›å¸¸è§çš„é˜»å¡é˜Ÿåˆ—</h4><p>workQueue-å½“æ²¡æœ‰ç©ºé—²æ ¸å¿ƒçº¿ç¨‹æ—¶ï¼Œæ–°æ¥ä»»åŠ¡ä¼šåŠ å…¥åˆ°æ­¤é˜Ÿåˆ—æ’é˜Ÿï¼Œé˜Ÿåˆ—æ»¡ä¼šåˆ›å»ºæ•‘æ€¥çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</p><ul><li>1.ArrayBlockingQueue:åŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒFIFOã€‚</li><li>2.LinkedBlockingQueue:åŸºäºé“¾è¡¨ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒFIFOã€‚</li><li>3.DelayedWorkQueueï¼šæ˜¯ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå®ƒå¯ä»¥ä¿è¯æ¯æ¬¡å‡ºé˜Ÿçš„ä»»åŠ¡éƒ½æ˜¯å½“å‰é˜Ÿåˆ—ä¸­æ‰§è¡Œæ—¶é—´æœ€é å‰çš„</li><li>4.SynchronousQueue:ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œéƒ½å¿…é¡»ç­‰å¾…ä¸€ä¸ªç§»å‡ºæ“ä½œã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313105753.png" alt="image.png"></p><h4 id="å¦‚ä½•ç¡®è®¤æ ¸å¿ƒçº¿ç¨‹æ•°-ğŸš©"><a href="#å¦‚ä½•ç¡®è®¤æ ¸å¿ƒçº¿ç¨‹æ•°-ğŸš©" class="headerlink" title="å¦‚ä½•ç¡®è®¤æ ¸å¿ƒçº¿ç¨‹æ•°  ğŸš©"></a>å¦‚ä½•ç¡®è®¤æ ¸å¿ƒçº¿ç¨‹æ•°  ğŸš©</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313110121.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313110201.png" alt="image.png"></p><h4 id="çº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº›-ğŸš©"><a href="#çº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº›-ğŸš©" class="headerlink" title="çº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº›  ğŸš©"></a>çº¿ç¨‹æ± çš„ç§ç±»æœ‰å“ªäº›  ğŸš©</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313110448.png" alt="image.png"></p><ul><li><strong>FixedThreadPool</strong>ï¼šå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œé€‚ç”¨äºéœ€è¦é™åˆ¶çº¿ç¨‹æ•°é‡çš„åœºæ™¯ã€‚</li><li><strong>CachedThreadPool</strong>ï¼šå¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œé€‚ç”¨äºæ‰§è¡Œè®¸å¤šçŸ­æœŸå¼‚æ­¥ä»»åŠ¡çš„åœºæ™¯ã€‚</li><li><strong>ScheduledThreadPool</strong>ï¼šæ”¯æŒå®šæ—¶å’Œå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œçš„çº¿ç¨‹æ± ã€‚</li><li><strong>SingleThreadExecutor</strong>ï¼šå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼Œé€‚ç”¨äºé¡ºåºæ‰§è¡Œä»»åŠ¡çš„åœºæ™¯ã€‚</li></ul><h4 id="æ ¸å¿ƒçº¿ç¨‹æ•°å¯ä»¥ä¸ºé›¶å—"><a href="#æ ¸å¿ƒçº¿ç¨‹æ•°å¯ä»¥ä¸ºé›¶å—" class="headerlink" title="æ ¸å¿ƒçº¿ç¨‹æ•°å¯ä»¥ä¸ºé›¶å—"></a>æ ¸å¿ƒçº¿ç¨‹æ•°å¯ä»¥ä¸ºé›¶å—</h4><h4 id="æ€ä¹ˆåˆ¤æ–­è¿™ä¸ªçº¿ç¨‹æ˜¯å¯ä»¥è¢«å›æ”¶çš„"><a href="#æ€ä¹ˆåˆ¤æ–­è¿™ä¸ªçº¿ç¨‹æ˜¯å¯ä»¥è¢«å›æ”¶çš„" class="headerlink" title="æ€ä¹ˆåˆ¤æ–­è¿™ä¸ªçº¿ç¨‹æ˜¯å¯ä»¥è¢«å›æ”¶çš„"></a>æ€ä¹ˆåˆ¤æ–­è¿™ä¸ªçº¿ç¨‹æ˜¯å¯ä»¥è¢«å›æ”¶çš„</h4><h4 id="çº¿ç¨‹æ± çš„çŠ¶æ€æœ‰å“ªäº›"><a href="#çº¿ç¨‹æ± çš„çŠ¶æ€æœ‰å“ªäº›" class="headerlink" title="çº¿ç¨‹æ± çš„çŠ¶æ€æœ‰å“ªäº›"></a>çº¿ç¨‹æ± çš„çŠ¶æ€æœ‰å“ªäº›</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313112723.png" alt="image.png"></p><h4 id="Shutdown-å’Œ-shutdownnow-çš„åŒºåˆ«ï¼Œæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼å…³é—­"><a href="#Shutdown-å’Œ-shutdownnow-çš„åŒºåˆ«ï¼Œæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼å…³é—­" class="headerlink" title="Shutdown å’Œ shutdownnow çš„åŒºåˆ«ï¼Œæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼å…³é—­"></a>Shutdown å’Œ shutdownnow çš„åŒºåˆ«ï¼Œæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼å…³é—­</h4><h4 id="æ€ä¹ˆå°†ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å…³é—­ï¼Œä»€ä¹ˆæ ·çš„çº¿ç¨‹æ˜¯å¯ä»¥è¢«ä¸­æ–­çš„"><a href="#æ€ä¹ˆå°†ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å…³é—­ï¼Œä»€ä¹ˆæ ·çš„çº¿ç¨‹æ˜¯å¯ä»¥è¢«ä¸­æ–­çš„" class="headerlink" title="æ€ä¹ˆå°†ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å…³é—­ï¼Œä»€ä¹ˆæ ·çš„çº¿ç¨‹æ˜¯å¯ä»¥è¢«ä¸­æ–­çš„"></a>æ€ä¹ˆå°†ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å…³é—­ï¼Œä»€ä¹ˆæ ·çš„çº¿ç¨‹æ˜¯å¯ä»¥è¢«ä¸­æ–­çš„</h4><h4 id="é¡¹ç›®ä¸­çº¿ç¨‹æ± çš„ä½¿ç”¨"><a href="#é¡¹ç›®ä¸­çº¿ç¨‹æ± çš„ä½¿ç”¨" class="headerlink" title="é¡¹ç›®ä¸­çº¿ç¨‹æ± çš„ä½¿ç”¨"></a>é¡¹ç›®ä¸­çº¿ç¨‹æ± çš„ä½¿ç”¨</h4><p>ç›´æ¥ä½¿ç”¨<code>@Autowired</code>æ³¨å…¥ä¸€ä¸ª<code>ThreadPoolTaskExecutor</code>å®ä¾‹é€šå¸¸æ„å‘³ç€ä½ è¦ä½¿ç”¨Springçš„é»˜è®¤é…ç½®</p><ul><li>1ã€ä¸€èˆ¬ä¼šæ³¨å…¥ä¸€ä¸ªçº¿ç¨‹æ± çš„é…ç½®ç±»çš„ @Bean</li></ul><h4 id="çº¿ç¨‹æ± å¦‚ä½•ç›‘å¬å­çº¿ç¨‹çš„å¼‚å¸¸ï¼Œå¹¶ä½œå‡ºå¤„ç†"><a href="#çº¿ç¨‹æ± å¦‚ä½•ç›‘å¬å­çº¿ç¨‹çš„å¼‚å¸¸ï¼Œå¹¶ä½œå‡ºå¤„ç†" class="headerlink" title="çº¿ç¨‹æ± å¦‚ä½•ç›‘å¬å­çº¿ç¨‹çš„å¼‚å¸¸ï¼Œå¹¶ä½œå‡ºå¤„ç†"></a>çº¿ç¨‹æ± å¦‚ä½•ç›‘å¬å­çº¿ç¨‹çš„å¼‚å¸¸ï¼Œå¹¶ä½œå‡ºå¤„ç†</h4><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><ul><li>1ã€è®²è¿°ä¸€ä¸‹ä½ ä»¬é¡¹ç›®ä¸­å“ªé‡Œç”¨åˆ°äº†çº¿ç¨‹æ± ï¼ˆå¼‚æ­¥çº¿ç¨‹ï¼‰</li><li>2ã€å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡</li><li>3ã€è°ˆè°ˆä½ å¯¹ ThreadLocal çš„ç†è§£</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313141718.png" alt="image.png"></p><h4 id="çº¿ç¨‹æ± ä½¿ç”¨åœºæ™¯"><a href="#çº¿ç¨‹æ± ä½¿ç”¨åœºæ™¯" class="headerlink" title="çº¿ç¨‹æ± ä½¿ç”¨åœºæ™¯"></a>çº¿ç¨‹æ± ä½¿ç”¨åœºæ™¯</h4><ul><li>CountDownLatch</li><li>Future</li></ul><h5 id="es-æ•°æ®æ‰¹é‡å¯¼å…¥"><a href="#es-æ•°æ®æ‰¹é‡å¯¼å…¥" class="headerlink" title="es æ•°æ®æ‰¹é‡å¯¼å…¥"></a>es æ•°æ®æ‰¹é‡å¯¼å…¥</h5><p>CountDownLatch çš„ä½¿ç”¨ï¼š <a href="https://www.bilibili.com/list/watchlater?bvid=BV1yT411H7YK&oid=485022417&p=111">https://www.bilibili.com/list/watchlater?bvid=BV1yT411H7YK&amp;oid=485022417&amp;p=111</a></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313113337.png" alt="image.png"></p><p>CountDownLatch</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313111009.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313113212.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313113337.png" alt="image.png"></p><p>CountDownLatch çš„éƒ¨åˆ†ä»£ç ä½¿ç”¨ç¤ºä¾‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313113911.png" alt="image.png"></p><h5 id="Future-ï¼ˆæŠ¥è¡¨æ±‡æ€»ä¹Ÿå¯ä»¥ç”¨åˆ°ï¼‰"><a href="#Future-ï¼ˆæŠ¥è¡¨æ±‡æ€»ä¹Ÿå¯ä»¥ç”¨åˆ°ï¼‰" class="headerlink" title="Future ï¼ˆæŠ¥è¡¨æ±‡æ€»ä¹Ÿå¯ä»¥ç”¨åˆ°ï¼‰"></a>Future ï¼ˆæŠ¥è¡¨æ±‡æ€»ä¹Ÿå¯ä»¥ç”¨åˆ°ï¼‰</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313114227.png" alt="image.png"></p><p>è¿™é‡Œæ˜¯ä¸€ç§åšæ³•æ˜¯è¿™äº›æµç¨‹å®é™…æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼Œç„¶åé€šè¿‡ Futrue è·å–è¿”å›ç»“æœï¼Œåé¢å†æ‹¼æ¥åˆ°ä¸€èµ·ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313114805.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313114913.png" alt="image.png"></p><p>ç»™ä¸€ä¸ª Future å’Œ çº¿ç¨‹æ± çš„ä½¿ç”¨ç¤ºä¾‹</p><h5 id="å¼‚æ­¥çº¿ç¨‹"><a href="#å¼‚æ­¥çº¿ç¨‹" class="headerlink" title="å¼‚æ­¥çº¿ç¨‹"></a>å¼‚æ­¥çº¿ç¨‹</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313135702.png" alt="image.png"></p><h4 id="å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡"><a href="#å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡" class="headerlink" title="å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡"></a>å¦‚ä½•æ§åˆ¶æŸä¸ªæ–¹æ³•å…è®¸å¹¶å‘è®¿é—®çº¿ç¨‹çš„æ•°é‡</h4><ul><li>Semaphore</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313140027.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313140102.png" alt="image.png"></p><h4 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h4><ul><li>ThreadLocalï¼šç‹¬ç«‹å˜é‡å‰¯æœ¬ï¼Œé¿å…çº¿ç¨‹å…±äº«å¯èƒ½å¯¼è‡´çš„å¹¶å‘é—®é¢˜</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240313140213.png" alt="image.png"></p><p>ThreadLocal ä¸€èˆ¬æ˜¯ç”¨ä½œç‹¬ç«‹å˜é‡å‰¯æœ¬ï¼ˆçº¿ç¨‹çš„å˜é‡å‰¯æœ¬ï¼‰ï¼Œé¿å…çº¿ç¨‹å…±äº«å˜é‡å¯èƒ½å¯¼è‡´çš„å¹¶å‘é—®é¢˜ã€‚</p><p>å»ºè®®å…ˆçœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š <a href="https://cloud.tencent.com/developer/article/1636025">https://cloud.tencent.com/developer/article/1636025</a></p><p>ThreadLocalåŒ…å«äº†å››ä¸ªæ–¹æ³•:</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">void</span> <span class="hljs-built_in">set</span>(<span class="hljs-built_in">Object</span> value)è®¾ç½®å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼ã€‚<br><span class="hljs-keyword">public</span> <span class="hljs-built_in">Object</span> <span class="hljs-built_in">get</span>()è¯¥æ–¹æ³•è¿”å›å½“å‰çº¿ç¨‹æ‰€å¯¹åº”çš„çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span>()å°†å½“å‰çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼åˆ é™¤ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å†…å­˜ä½¿ç”¨ï¼ŒåŠ å¿«å†…å­˜å›æ”¶ã€‚<br><span class="hljs-keyword">protected</span> <span class="hljs-built_in">Object</span> <span class="hljs-title function_">initialValue</span>()è¿”å›è¯¥çº¿ç¨‹å±€éƒ¨å˜é‡çš„åˆå§‹å€¼ï¼Œè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ª<span class="hljs-keyword">protected</span>çš„æ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©å­ç±»è¦†ç›–è€Œè®¾è®¡çš„ã€‚<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨åˆ° ThreadLocal çš„ä¸‰ä¸ªå¸¸ç”¨åœºæ™¯ï¼š</p><ul><li><ol><li>ä»£æ›¿å‚æ•°çš„æ˜¾ç¤ºä¼ é€’</li></ol></li><li><ol start="2"><li>å…¨å±€å­˜å‚¨ç”¨æˆ·ä¿¡æ¯</li></ol></li><li><ol start="3"><li>è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ˆæ¯”å¦‚æ•°æ®åº“è¿æ¥çš„Connection)</li></ol></li></ul><p>æ…ç”¨çš„åœºæ™¯ï¼šçº¿ç¨‹æ± ä¸­çº¿ç¨‹è°ƒç”¨ä½¿ç”¨ThreadLocalã€å¼‚æ­¥ç¨‹åºï¼›åŒæ—¶æ³¨æ„çš„æ˜¯ä½¿ç”¨å®ŒThreadLocal ï¼Œæœ€å¥½æ‰‹åŠ¨è°ƒç”¨ remove() æ–¹æ³•ã€‚</p><hr><p>å…³äº ThreadLocal çš„æ•°æ®ç»“æ„ï¼Œæ–¹æ³•æºç ï¼Œæ‰©å®¹æœºåˆ¶ç­‰å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š <a href="https://javaguide.cn/java/concurrent/threadlocal.html">https://javaguide.cn/java/concurrent/threadlocal.html</a></p><h4 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.Callable;<br><span class="hljs-keyword">import</span> java.util.concurrent.ExecutionException;<br><span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;<br><span class="hljs-keyword">import</span> java.util.concurrent.Executors;<br><span class="hljs-keyword">import</span> java.util.concurrent.Future;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FutureExample</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </span><br>        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">3</span>);<br><br>        <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ª Callable ä»»åŠ¡</span><br>        Callable&lt;String&gt; callableTask = () -&gt; &#123;<br>            <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            Thread.sleep(<span class="hljs-number">2000</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Task&#x27;s execution result&quot;</span>;<br>        &#125;;<br><br>        <span class="hljs-comment">// æäº¤ä»»åŠ¡å¹¶è·å– Future å¯¹è±¡</span><br>        Future&lt;String&gt; future = executorService.submit(callableTask);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// å…¶ä»–æ“ä½œå¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œ</span><br>            System.out.println(<span class="hljs-string">&quot;Do something else while task is executing...&quot;</span>);<br><br>            <span class="hljs-comment">// è·å–ä»»åŠ¡æ‰§è¡Œç»“æœï¼ˆä¼šé˜»å¡ç›´åˆ°ä»»åŠ¡å®Œæˆï¼‰</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> future.get();<br>            System.out.println(<span class="hljs-string">&quot;Task result: &quot;</span> + result);<br><br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException | ExecutionException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">// å…³é—­çº¿ç¨‹æ± </span><br>            executorService.shutdown();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h4><h4 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h4>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•ç…ç†¬æˆè›‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLå­¦ä¹ _åŸºç¡€å†…å®¹01</title>
    <link href="/2024/03/08/MySQL%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B901/"/>
    <url>/2024/03/08/MySQL%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B901/</url>
    
    <content type="html"><![CDATA[<p>2023-12-22ï¼šåˆ›å»ºæ–‡ç« </p><p>2024-03-10ï¼šæ›´æ–°äº†éƒ¨åˆ†å†…å®¹</p><blockquote><p>å¤§çº²</p></blockquote><ul><li>åŸºç¡€æ¶æ„</li><li>æ—¥å¿—ç³»ç»Ÿ</li><li>äº‹åŠ¡éš”ç¦»</li><li>MySQLç´¢å¼•</li><li>é”æœºåˆ¶</li><li>explain</li></ul><h3 id="1ã€åŸºç¡€æ¶æ„"><a href="#1ã€åŸºç¡€æ¶æ„" class="headerlink" title="1ã€åŸºç¡€æ¶æ„"></a>1ã€åŸºç¡€æ¶æ„</h3><p>MySQLçš„é€»è¾‘æ¶æ„å¯ä»¥ä»ä¸Šåˆ°ä¸‹åˆ†ä¸ºå‡ ä¸ªä¸»è¦å±‚æ¬¡ï¼š</p><ul><li>å®¢æˆ·ç«¯å±‚<ul><li>åŒ…æ‹¬äº†ç”¨æˆ·çš„æ¥å£ï¼Œå¦‚å‘½ä»¤è¡Œå®¢æˆ·ç«¯å’Œå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰</li></ul></li><li>æœåŠ¡å±‚<ul><li>è¿æ¥å¤„ç†ï¼šç®¡ç†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ï¼ŒåŒ…æ‹¬èº«ä»½è®¤è¯ã€‚</li><li>SQLæ¥å£ï¼šæ¥æ”¶SQLå‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›æŸ¥è¯¢ç»“æœã€‚</li><li>è§£æå™¨ï¼šå°†SQLè¯­å¥åˆ†è§£æˆå¯ä»¥ç†è§£å’Œæ‰§è¡Œçš„éƒ¨åˆ†ã€‚</li><li>ä¼˜åŒ–å™¨ï¼šå†³å®šæœ€ä½³çš„æŸ¥è¯¢è·¯å¾„ã€‚</li><li>ç¼“å­˜&#x2F;ç¼“å†²ï¼šå­˜å‚¨æ•°æ®ï¼Œä»¥ä¾¿æ›´å¿«åœ°è®¿é—®ã€‚</li></ul></li><li>å­˜å‚¨å¼•æ“å±‚<ul><li>è´Ÿè´£MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚</li><li>MySQLçš„å­˜å‚¨å¼•æ“æ˜¯å¯æ’æ‹”çš„ï¼Œæœ€å¸¸è§çš„å¦‚InnoDBï¼ˆæ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”å®šï¼‰å’ŒMyISAMï¼ˆæ”¯æŒå…¨æ–‡æœç´¢ä½†ä¸æ”¯æŒäº‹åŠ¡ï¼‰ã€‚</li></ul></li><li>å­˜å‚¨å±‚<ul><li>å®é™…å­˜å‚¨æ•°æ®çš„åœ°æ–¹</li><li>åŒ…æ‹¬æ•°æ®æ–‡ä»¶ã€ç´¢å¼•æ–‡ä»¶ç­‰</li></ul></li></ul><p>æ¯ä¸€å±‚åœ¨MySQLçš„è¿è¡Œä¸­æ‰®æ¼”ç€å…³é”®è§’è‰²ï¼Œå¹¶ä¸”å®ƒä»¬å…±åŒå·¥ä½œä»¥å¤„ç†å’Œå­˜å‚¨æ•°æ®ã€‚<br>å®¢æˆ·ç«¯å±‚æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„SQLæŸ¥è¯¢ï¼ŒæœåŠ¡å±‚å¯¹è¿™äº›æŸ¥è¯¢è¿›è¡Œå¤„ç†å’Œä¼˜åŒ–ï¼Œå­˜å‚¨å¼•æ“å±‚æ‰§è¡Œè¿™äº›æŸ¥è¯¢å¹¶é€šè¿‡å­˜å‚¨å±‚å¯¹æ•°æ®è¿›è¡Œç‰©ç†å­˜å‚¨å’Œä¿®æ”¹ã€‚</p><blockquote><p>é¤å…ä¸æ•°æ®åº“</p></blockquote><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç±»æ¯”æ¥å¸®åŠ©ç†è§£ã€‚æƒ³è±¡MySQLæ˜¯ä¸€å®¶é¤å…ï¼š</p><p>å®¢æˆ·ç«¯å±‚åƒæ˜¯é¤å…çš„é¡¾å®¢ï¼Œä»–ä»¬ç‚¹èœï¼ˆå‘é€SQLæŸ¥è¯¢ï¼‰ã€‚</p><p>æœåŠ¡å±‚æ˜¯æœåŠ¡å‘˜ï¼Œä»–ä»¬æ¥æ”¶è®¢å•ï¼Œè§£é‡Šé¡¾å®¢çš„éœ€æ±‚ï¼ˆè§£æSQLï¼‰ï¼Œå¹¶å†³å®šå¦‚ä½•æœ€æœ‰æ•ˆåœ°å‡†å¤‡é£Ÿç‰©ï¼ˆä¼˜åŒ–æŸ¥è¯¢ï¼‰ã€‚<br>å­˜å‚¨å¼•æ“å±‚åƒæ˜¯å¨å¸ˆï¼Œæ ¹æ®æœåŠ¡å‘˜ç»™å‡ºçš„è®¢å•æ¥å‡†å¤‡é£Ÿç‰©ï¼ˆæ‰§è¡ŒSQLæŸ¥è¯¢ï¼‰ã€‚</p><p>å­˜å‚¨å±‚åˆ™æ˜¯å†°ç®±å’Œå‚¨è—å®¤ï¼Œå­˜å‚¨ç€æ‰€æœ‰é£Ÿæï¼ˆæ•°æ®ï¼‰ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªå‘˜å·¥å’Œæ¯ä¸ªå­˜å‚¨åŒºéƒ½å¿…é¡»åè°ƒä¸€è‡´ï¼Œä»¥ç¡®ä¿é£Ÿç‰©ï¼ˆæ•°æ®ï¼‰çš„è´¨é‡å’ŒæœåŠ¡çš„æ•ˆç‡ã€‚</p><blockquote><p>é»˜è®¤å­˜å‚¨å¼•æ“</p></blockquote><p>ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼Œå®ƒä» MySQL 5.5.5 ç‰ˆæœ¬å¼€å§‹æˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><blockquote><p>Serverå±‚å’Œå­˜å‚¨å¼•æ“å±‚</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312221022103.png" alt="image.png|600"></p><p>å°†è¿™ä¸ªæè¿°ä¸ä¸Šé¢çš„ç±»æ¯”ç»“åˆèµ·æ¥ï¼Œå¯ä»¥è¿™æ ·ç†è§£ï¼š</p><ol><li><strong>Serverå±‚</strong>ï¼š<ul><li>è¿™ä¸€å±‚å¯ä»¥è¢«è§†ä¸ºé¤å…çš„å‰å°å’ŒæœåŠ¡åŒºåŸŸã€‚</li><li><strong>è¿æ¥å™¨</strong>ï¼šé¤å…çš„æ¥å¾…å°ï¼Œè´Ÿè´£è¿æ¥é¡¾å®¢ï¼ˆå»ºç«‹å®¢æˆ·ç«¯è¿æ¥ï¼‰ã€‚</li><li><strong>æŸ¥è¯¢ç¼“å­˜</strong>ï¼šå·²ç»å‡†å¤‡å¥½çš„èœè‚´ï¼Œå¯ä»¥ç«‹å³æä¾›ç»™é¡¾å®¢ï¼Œæ— éœ€å†æ¬¡ç­‰å¾…å¨å¸ˆå‡†å¤‡ï¼ˆç¼“å­˜ä¹‹å‰çš„æŸ¥è¯¢ç»“æœï¼‰ã€‚</li><li><strong>åˆ†æå™¨</strong>ï¼šæœåŠ¡å‘˜å¬é¡¾å®¢ç‚¹èœå¹¶ç¡®è®¤èœå•ä¸Šæœ‰è¿™é“èœï¼ˆè§£æSQLæŸ¥è¯¢ï¼Œæ£€æŸ¥è¯­æ³•ï¼‰ã€‚</li><li><strong>ä¼˜åŒ–å™¨</strong>ï¼šæœåŠ¡å‘˜å†³å®šä¸ºé¡¾å®¢æœåŠ¡çš„é¡ºåºï¼Œä»¥ç¡®ä¿æ•ˆç‡ï¼ˆå†³å®šæŸ¥è¯¢çš„æœ€ä¼˜æ‰§è¡Œè®¡åˆ’ï¼‰ã€‚</li><li><strong>æ‰§è¡Œå™¨</strong>ï¼šæœåŠ¡å‘˜å°†é¡¾å®¢çš„è®¢å•ä¼ è¾¾ç»™å¨å¸ˆå¹¶ç¡®ä¿èœè‚´èƒ½å¤ŸæŒ‰è¦æ±‚å‡ºå“ï¼ˆæ‰§è¡ŒæŸ¥è¯¢ï¼‰ã€‚</li><li>æ­¤å±‚åŒ…å«æ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼Œå°±åƒé¤å…æœ‰å„ç§è°ƒå‘³å“å’Œçƒ¹é¥ªæ–¹æ³•å¯ä¾›é€‰æ‹©ã€‚</li><li>è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ï¼Œå¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ï¼Œéƒ½åƒæ˜¯é¤å…æä¾›çš„ç‰¹æ®ŠæœåŠ¡ï¼Œæ— è®ºä½¿ç”¨å“ªä¸ªå¨æˆ¿ï¼ˆå­˜å‚¨å¼•æ“ï¼‰ï¼Œéƒ½å¯ä»¥æä¾›ã€‚</li></ul></li><li><strong>å­˜å‚¨å¼•æ“å±‚</strong>ï¼š<ul><li>è¿™ä¸€å±‚ç›¸å½“äºé¤å…çš„å¨æˆ¿ã€‚</li><li>æ¯ä¸ªå­˜å‚¨å¼•æ“éƒ½åƒæ˜¯ä¸€ä¸ªä¸“é—¨çš„çƒ¹é¥ªåŒºåŸŸï¼Œæœ‰ç€ä¸åŒçš„çƒ¹é¥ªæŠ€æœ¯å’Œè®¾å¤‡ï¼ˆå¦‚InnoDBæ”¯æŒäº‹åŠ¡ï¼ŒMyISAMæä¾›å…¨æ–‡æœç´¢åŠŸèƒ½ï¼‰ã€‚</li><li>å­˜å‚¨å¼•æ“è´Ÿè´£æ•°æ®çš„ç‰©ç†å­˜å‚¨å’Œæ£€ç´¢ï¼Œå°±åƒå¨å¸ˆä»¬ç®¡ç†é£Ÿæå¹¶å°†å…¶åˆ¶ä½œæˆèœè‚´ä¸€æ ·ã€‚</li></ul></li></ol><blockquote><p>å¯¹äºSQLçš„è§£æå’Œä¼˜åŒ–</p></blockquote><ul><li><strong>SQLè§£æ</strong>ï¼šå½“æœåŠ¡å±‚æ¥æ”¶åˆ°å®¢æˆ·ç«¯å±‚å‘é€çš„SQLè¯­å¥åï¼Œå®ƒé¦–å…ˆè¿›è¡Œè¯­æ³•æ£€æŸ¥å’Œè§£æï¼Œå°†SQLåˆ†è§£ä¸ºè§£ææ ‘ã€‚</li><li><strong>SQLä¼˜åŒ–</strong>ï¼šç„¶åï¼Œä¼˜åŒ–å™¨ä¼šè¯„ä¼°å¤šä¸ªå¯èƒ½çš„æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªæˆæœ¬æœ€ä½ï¼ˆé€šå¸¸æ˜¯æ‰§è¡Œæ—¶é—´æœ€çŸ­ï¼‰çš„è®¡åˆ’</li></ul><blockquote><p>è¿æ¥å™¨</p></blockquote><p>å»ºè®®åœ¨ä½¿ç”¨ä¸­è¦å°½é‡å‡å°‘å»ºç«‹è¿æ¥çš„åŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯å°½é‡ä½¿ç”¨é•¿è¿æ¥ã€‚</p><p>ä½†å¦‚æœä½¿ç”¨é•¿è¿æ¥ï¼ŒæœåŠ¡å™¨éœ€è¦ä¸€ç›´åˆ†é…èµ„æºç»™è¿™äº›è¿æ¥ï¼ˆåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨çš„å†…å­˜æ˜¯ç®¡ç†åœ¨è¿æ¥å¯¹è±¡é‡Œé¢ï¼‰ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¦‚æœæœ‰å¾ˆå¤šå¤§çš„æ“ä½œï¼Œå®ƒå ç”¨çš„å†…å­˜å°±ä¼šè¶Šæ¥è¶Šå¤§ï¼Œæœ€ç»ˆå¯èƒ½ä¼šè€—å°½å†…å­˜ï¼Œå¯¼è‡´æ•°æ®åº“æœåŠ¡å´©æºƒã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ol><li><strong>å®šæœŸæ–­å¼€è¿æ¥</strong>ï¼šå°±åƒå®šæœŸæ¸…ç†æ‰‹æœºåå°è¿è¡Œçš„åº”ç”¨ï¼Œä»¥é‡Šæ”¾å†…å­˜ï¼Œä¿æŒæ‰‹æœºè¿è¡Œæµç•…ã€‚ä½ å¯ä»¥åœ¨æ•°æ®åº“ä¸­ï¼Œç”¨å®Œè¿æ¥åæˆ–è€…æ‰§è¡Œäº†ä¸€äº›å¤§æŸ¥è¯¢æ“ä½œä¹‹åï¼Œæ–­å¼€è¿æ¥ï¼Œä¸‹æ¬¡éœ€è¦æ—¶å†é‡æ–°è¿æ¥ã€‚</li><li><strong>ä½¿ç”¨mysql_reset_connection</strong>ï¼šå¦‚æœä½ ç”¨çš„æ˜¯MySQL 5.7æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¿™å°±åƒç»™æ‰‹æœºåšä¸ªå¿«é€Ÿé‡å¯ï¼Œæ¸…é™¤æ‰€æœ‰è¿è¡Œçš„ç¨‹åºä½†ä¸å®Œå…¨å…³æœºï¼Œè¿™æ ·å¯ä»¥è¿…é€Ÿé‡Šæ”¾å†…å­˜ã€‚<code>mysql_reset_connection</code>å‘½ä»¤å¯ä»¥é‡ç½®è¿æ¥çš„çŠ¶æ€ï¼Œä½†ä¸éœ€è¦åƒå®Œå…¨æ–­å¼€è¿æ¥é‚£æ ·å†æ¬¡è¿›è¡Œç¹ççš„æ¡æ‰‹å’Œæƒé™éªŒè¯ã€‚</li></ol><blockquote><p>æŸ¥è¯¢ç¼“å­˜</p></blockquote><p>ä½œç”¨ï¼šä½œä¸ºæŸ¥è¯¢ç¼“å­˜</p><ol><li>å½“ä½ æ‰§è¡Œä¸€ä¸ª<code>SELECT</code>è¯­å¥æ—¶ï¼ŒMySQLä¼šæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ã€‚</li><li>å¦‚æœä¹‹å‰æ‰§è¡Œè¿‡ç›¸åŒçš„æŸ¥è¯¢ï¼ˆè¿™é‡Œçš„â€œç›¸åŒâ€æ„å‘³ç€å­—èŠ‚åˆ°å­—èŠ‚çš„å®Œå…¨åŒ¹é…ï¼‰ï¼Œå¹¶ä¸”ç»“æœå·²ç»ç¼“å­˜ï¼ŒMySQLå°±ä¼šç«‹å³è¿”å›ç»“æœï¼Œä¸ç”¨å†æ¬¡æ‰§è¡ŒæŸ¥è¯¢ã€‚</li><li>æŸ¥è¯¢çš„æ–‡æœ¬æ˜¯ç¼“å­˜çš„â€œkeyâ€ï¼ŒæŸ¥è¯¢çš„ç»“æœæ˜¯â€œvalueâ€ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ul><li>æŸ¥è¯¢ç¼“å­˜æ¯å½“è¡¨æ›´æ–°æ—¶å°±ä¼šå¤±æ•ˆã€‚å¦‚æœè¡¨ç»å¸¸æ›´æ–°ï¼Œé‚£ä¹ˆç¼“å­˜çš„å‘½ä¸­ç‡å°±ä¼šéå¸¸ä½ã€‚</li><li>æ¯æ¬¡è¡¨æ›´æ–°ï¼Œæ‰€æœ‰ç›¸å…³çš„ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿ä½ çš„æŸ¥è¯¢ç»“æœè¢«å­˜å…¥ç¼“å­˜ï¼Œä½†å¦‚æœè¡¨ä¸€æ›´æ–°ï¼Œè¿™äº›ç»“æœå°±ä¼šæ¶ˆå¤±ã€‚</li></ul><p>å› ä¸ºè¿™äº›é™åˆ¶ï¼Œå¯¹äºé‚£äº›æ•°æ®æ›´æ–°é¢‘ç¹çš„ç³»ç»Ÿï¼Œå¯ç”¨æŸ¥è¯¢ç¼“å­˜å¯èƒ½ä¼šå¸¦æ¥æ›´å¤šçš„æ€§èƒ½å¼€é”€è€Œä¸æ˜¯å¥½å¤„ã€‚åªæœ‰åœ¨æ•°æ®å¾ˆå°‘å˜åŠ¨çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚æŸäº›é…ç½®è¡¨ï¼ŒæŸ¥è¯¢ç¼“å­˜æ‰å¯èƒ½æé«˜æ€§èƒ½ã€‚</p><p>å¦‚æœä½ è¿˜æ˜¯æƒ³è¦åˆ©ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œå¯ä»¥å°†<code>query_cache_type</code>è®¾ç½®ä¸º<code>DEMAND</code>ã€‚è¿™æ ·ï¼Œåªæœ‰é‚£äº›ä½ æ˜¾å¼æŒ‡å®šä¸º<code>SQL_CACHE</code>çš„æŸ¥è¯¢æ‰ä¼šä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> SQL_CACHE * <span class="hljs-keyword">FROM</span> T <span class="hljs-keyword">WHERE</span> ID=<span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»MySQL 8.0ç‰ˆæœ¬å¼€å§‹ï¼ŒæŸ¥è¯¢ç¼“å­˜åŠŸèƒ½è¢«å®Œå…¨ç§»é™¤äº†ã€‚è¿™æ˜¯å› ä¸ºåœ¨å®è·µä¸­ï¼Œç»´æŠ¤æŸ¥è¯¢ç¼“å­˜é€šå¸¸ä¼šå¯¼è‡´æ›´å¤šçš„æ€§èƒ½é—®é¢˜ï¼Œè€Œç°ä»£çš„æ•°æ®åº“ç³»ç»Ÿæœ‰æ›´é«˜æ•ˆçš„æ–¹å¼æ¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œæ¯”å¦‚æ›´å¥½çš„ç´¢å¼•å’Œä¼˜åŒ–å™¨ç­–ç•¥ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨æœ€æ–°çš„MySQLç‰ˆæœ¬ä¸­ï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜äº†ã€‚</p><blockquote><p>åˆ†æå™¨</p></blockquote><ul><li>è¯æ³•åˆ†æ</li><li>è¯­æ³•åˆ†æ</li></ul><blockquote><p>ä¼˜åŒ–å™¨:  å†³å®šæŸ¥è¯¢çš„æœ€ä¼˜æ‰§è¡Œè®¡åˆ’</p></blockquote><blockquote><p>æ‰§è¡Œå™¨ï¼šæ‰§è¡ŒæŸ¥è¯¢ï¼ˆæ“ä½œå­˜å‚¨å¼•æ“ï¼Œè¿”å›ç»“æœï¼‰</p></blockquote><h4 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h4><p>MySQL çš„å­˜å‚¨å¼•æ“è´Ÿè´£MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚å…¶ä¸­ MySQLçš„å­˜å‚¨å¼•æ“æ˜¯å¯æ’æ‹”çš„ï¼Œæœ€å¸¸è§çš„å¦‚InnoDBï¼ˆæ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”å®šï¼‰å’ŒMyISAMï¼ˆæ”¯æŒå…¨æ–‡æœç´¢ä½†ä¸æ”¯æŒäº‹åŠ¡ï¼‰ã€‚</p><p>åœ¨ MySQL ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â <code>SHOW ENGINES</code>Â å‘½ä»¤æ¥æŸ¥çœ‹ MySQL æ”¯æŒçš„æ‰€æœ‰å­˜å‚¨å¼•æ“ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>SELECT VERSION()</code> å‘½ä»¤æŸ¥çœ‹ä½ çš„ MySQL ç‰ˆæœ¬ã€‚ä¸åŒçš„ MySQL ç‰ˆæœ¬ä¹‹é—´çš„é»˜è®¤å­˜å‚¨å¼•æ“å¯èƒ½ä¼šæœ‰å·®åˆ«ã€‚</p><p>MySQL 5.5.5 ä¹‹å‰ï¼ŒMyISAM æ˜¯ MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚5.5.5 ç‰ˆæœ¬ä¹‹åï¼ŒInnoDB æ˜¯ MySQL çš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚</p><p>MySQL å½“å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBã€‚å¹¶ä¸”ï¼Œæ‰€æœ‰çš„å­˜å‚¨å¼•æ“ä¸­åªæœ‰ InnoDB æ˜¯äº‹åŠ¡æ€§å­˜å‚¨å¼•æ“ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰ InnoDB æ”¯æŒäº‹åŠ¡ã€‚</p><p>InnoDB å­˜å‚¨å¼•æ“è¯¦ç»†ä»‹ç»ï¼š<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html">https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html</a> ã€‚</p><p>å¸¸è§çš„å‡ ç§ MySQL å­˜å‚¨å¼•æ“ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240217210220.png" alt="image.png"></p><blockquote><p>MyISAM å’Œ InnoDB ä¸¤ç§ MySQL å­˜å‚¨å¼•æ“åœ¨ç´¢å¼•å®ç°ä¸Šçš„æ ¹æœ¬åŒºåˆ«</p></blockquote><ol><li><p><strong>InnoDB çš„ç´¢å¼•å’Œæ•°æ®å­˜å‚¨æ–¹å¼</strong>ï¼šInnoDB ä½¿ç”¨çš„æ˜¯ä¸€ç§ç§°ä¸ºèšé›†ç´¢å¼•ï¼ˆClustered Indexï¼‰çš„ç»“æ„ï¼Œå…¶ä¸­æ•°æ®è¡¨æ˜¯æŒ‰ç…§ä¸»é”®é¡ºåºå­˜å‚¨å’Œç»„ç»‡çš„ï¼Œè¿™å°±æ„å‘³ç€è¡¨æ•°æ®æœ¬èº«å°±æ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼ŒInnoDB çš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±å……å½“äº†ç´¢å¼•çš„è§’è‰²ï¼Œå¶èŠ‚ç‚¹åŒ…å«äº†å®é™…çš„è¡¨æ•°æ®ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯è®¿é—®ä¸»é”®ç´¢å¼•éå¸¸å¿«ï¼Œä½†ç¼ºç‚¹æ˜¯æ¬¡çº§ç´¢å¼•ï¼ˆéä¸»é”®ç´¢å¼•ï¼‰éœ€è¦å­˜å‚¨ä¸»é”®çš„å€¼æ¥å¼•ç”¨å®é™…çš„æ•°æ®è¡Œã€‚</p></li><li><p><strong>MyISAM çš„ç´¢å¼•å’Œæ•°æ®å­˜å‚¨æ–¹å¼</strong>ï¼šä¸ InnoDB ä¸åŒï¼ŒMyISAM å°†ç´¢å¼•å’Œæ•°æ®å­˜å‚¨åœ¨åˆ†å¼€çš„æ–‡ä»¶ä¸­ã€‚å®ƒä½¿ç”¨éèšé›†ç´¢å¼•ï¼Œç´¢å¼•æ–‡ä»¶ä»…å­˜å‚¨æ•°æ®è®°å½•çš„åœ°å€ã€‚è¿™æ„å‘³ç€æ— è®ºæ˜¯ä¸»é”®ç´¢å¼•è¿˜æ˜¯æ¬¡çº§ç´¢å¼•ï¼ŒMyISAM éƒ½éœ€è¦è¿›è¡Œé¢å¤–çš„æŸ¥æ‰¾æ­¥éª¤æ¥å®šä½å®é™…çš„æ•°æ®è®°å½•ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ç®€åŒ–äº†ç´¢å¼•çš„ç®¡ç†ï¼Œå°¤å…¶æ˜¯å¯¹äºéä¸»é”®ç´¢å¼•çš„æ“ä½œï¼›ä½†ç¼ºç‚¹æ˜¯è®¿é—®æ•°æ®å¯èƒ½éœ€è¦æ›´å¤šçš„ç£ç›˜I&#x2F;Oï¼Œå°¤å…¶æ˜¯å¯¹ä¸»é”®çš„æŸ¥è¯¢ã€‚</p></li></ol><p>ç®€è€Œè¨€ä¹‹ï¼ŒInnoDB çš„æ•°æ®æ–‡ä»¶å°±æ˜¯æŒ‰ B+Tree ç»„ç»‡çš„èšé›†ç´¢å¼•ï¼Œæ•°æ®ç›´æ¥å­˜å‚¨åœ¨ç´¢å¼•çš„å¶èŠ‚ç‚¹ä¸­ï¼Œè€Œ MyISAM ä½¿ç”¨åˆ†ç¦»çš„æ–‡ä»¶å­˜å‚¨æ•°æ®å’Œç´¢å¼•ï¼Œç´¢å¼•æ–‡ä»¶ä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘æ•°æ®æ–‡ä»¶ä¸­è®°å½•çš„æŒ‡é’ˆã€‚è¿™ä¸¤ç§ä¸åŒçš„å®ç°æ–¹å¼å½±å“äº†æ•°æ®è®¿é—®çš„æ€§èƒ½å’Œå­˜å‚¨æ•ˆç‡ã€‚</p><hr><h3 id="2ã€æ—¥å¿—ç³»ç»Ÿ"><a href="#2ã€æ—¥å¿—ç³»ç»Ÿ" class="headerlink" title="2ã€æ—¥å¿—ç³»ç»Ÿ"></a>2ã€æ—¥å¿—ç³»ç»Ÿ</h3><p>MySQLçš„æ—¥å¿—ç³»ç»Ÿæ˜¯å…¶æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œå°±åƒé»‘åŒ£å­ä¸€æ ·ï¼Œè®°å½•äº†å‘ç”Ÿåœ¨æ•°æ®åº“ä¸­çš„æ‰€æœ‰å…³é”®æ´»åŠ¨ã€‚å®ƒåŒ…æ‹¬å¤šç§ç±»å‹çš„æ—¥å¿—ï¼Œæ¯ç§æ—¥å¿—è®°å½•ä¸åŒç±»å‹çš„ä¿¡æ¯ï¼Œå¯¹äºæ•°æ®åº“çš„æ¢å¤ã€ä¼˜åŒ–å’Œæ•…éšœæ’é™¤éƒ½è‡³å…³é‡è¦ã€‚</p><p>ä¸‹é¢æ˜¯MySQLæ—¥å¿—ç³»ç»Ÿä¸­æœ€é‡è¦çš„å‡ ç§æ—¥å¿—ç±»å‹ï¼š</p><ul><li>é”™è¯¯æ—¥å¿—</li><li>æŸ¥è¯¢æ—¥å¿—ï¼ˆé€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼‰</li><li>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰</li><li>æ…¢æŸ¥è¯¢æ—¥å¿—</li><li>ä¸­ç»§æ—¥å¿—ï¼ˆRelay Logï¼‰</li><li>InnoDBé‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰</li><li>InnoDBå›æ»šæ—¥å¿—ï¼ˆUndo Logï¼‰</li></ul><blockquote><p>é”™è¯¯æ—¥å¿—</p></blockquote><p>é”™è¯¯æ—¥å¿—å°±åƒæ˜¯åŒ»ç”Ÿçš„è¯Šæ–­è®°å½•ï¼Œå®ƒè®°å½•MySQLæœåŠ¡å™¨å¯åŠ¨ã€è¿è¡Œæˆ–åœæ­¢æ—¶é‡åˆ°çš„é—®é¢˜ã€‚å¦‚æœæ•°æ®åº“å‡ºç°é—®é¢˜ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªè¦æŸ¥çœ‹çš„åœ°æ–¹ã€‚è¿™é‡Œä¼šæœ‰å…³äºä»»ä½•é”™è¯¯çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœåŠ¡å¯åŠ¨å¤±è´¥çš„åŸå› ã€‚</p><blockquote><p>æŸ¥è¯¢æ—¥å¿—ï¼ˆé€šç”¨æŸ¥è¯¢æ—¥å¿—ï¼‰</p></blockquote><p>æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰€æœ‰å¯¹MySQLæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œæ— è®ºè¿™äº›è¯·æ±‚æ˜¯å¦å¾—åˆ°äº†æ‰§è¡Œã€‚å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯å•†åº—çš„å®¢æµè®°å½•å™¨ï¼Œè®°å½•æ¯ä¸€ä¸ªè¿›é—¨çš„é¡¾å®¢åŠå…¶è¯·æ±‚çš„å•†å“ã€‚</p><p>ç”±äºè®°å½•äº†æ‰€æœ‰æ´»åŠ¨ï¼ŒåŒ…æ‹¬æ¯æ¡SQLè¯­å¥çš„æ–‡å­—è®°å½•ï¼Œè¿™ä¸ªæ—¥å¿—å¾ˆå®¹æ˜“å˜å¾—éå¸¸å¤§ï¼Œå› æ­¤åœ¨é«˜è´Ÿè½½ç³»ç»Ÿä¸­é€šå¸¸ä¸æ¨èå¼€å¯ã€‚</p><blockquote><p>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰</p></blockquote><p>äºŒè¿›åˆ¶æ—¥å¿—æ˜¯æ•°æ®åº“æ´»åŠ¨çš„è¯¦ç»†è®°å½•ï¼ŒåŒ…æ‹¬æ‰€æœ‰ä¿®æ”¹æ•°æ®æˆ–å¯èƒ½ä¿®æ”¹æ•°æ®çš„è¯­å¥ï¼ˆå¦‚<code>INSERT</code>ã€<code>UPDATE</code>ã€<code>DELETE</code>ï¼‰ã€‚å¯ä»¥å°†äºŒè¿›åˆ¶æ—¥å¿—è§†ä¸ºé£æœºçš„é»‘åŒ£å­ï¼Œè®°å½•é£è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰é‡è¦äº‹ä»¶ã€‚</p><p>å®ƒå¯¹äºå¤åˆ¶å’Œæ•°æ®æ¢å¤æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥ç”¨æ¥åœ¨å¦ä¸€å°æœåŠ¡å™¨ä¸Šé‡æ”¾æ•°æ®æ›´æ”¹ï¼Œæˆ–è€…åœ¨æ•°æ®ä¸¢å¤±åæ¢å¤æ•°æ®ã€‚</p><blockquote><p>æ…¢æŸ¥è¯¢æ—¥å¿—</p></blockquote><p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡ç‰¹å®šæ—¶é•¿çš„æŸ¥è¯¢ã€‚</p><p>å°†å…¶æƒ³è±¡ä¸ºç›‘æ§æ‘„åƒå¤´ï¼Œç‰¹åˆ«å…³æ³¨é‚£äº›åœ¨å•†åº—é‡Œé€—ç•™æ—¶é—´è¿‡é•¿çš„é¡¾å®¢ã€‚è¿™å¯¹äºå‘ç°é‚£äº›éœ€è¦ä¼˜åŒ–çš„æŸ¥è¯¢éå¸¸æœ‰å¸®åŠ©ã€‚</p><blockquote><p>ä¸­ç»§æ—¥å¿—ï¼ˆRelay Logï¼‰</p></blockquote><p>åœ¨MySQLå¤åˆ¶è®¾ç½®ä¸­ï¼Œä»æœåŠ¡å™¨ä¸Šçš„ä¸­ç»§æ—¥å¿—è®°å½•äº†ä»ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ‰€æœ‰äºŒè¿›åˆ¶æ—¥å¿—äº‹ä»¶ã€‚</p><p>ä»æœåŠ¡å™¨ä¸Šçš„å¤åˆ¶å­ç³»ç»Ÿä¼šè¯»å–è¿™äº›æ—¥å¿—ï¼Œå¹¶åº”ç”¨åˆ°ä»æœåŠ¡å™¨çš„æ•°æ®åº“ä¸­ã€‚è¿™ç±»ä¼¼äºæ¥åŠ›èµ›ä¸­ï¼Œæ¥åŠ›æ£’åœ¨è¿åŠ¨å‘˜ä¹‹é—´ä¼ é€’çš„è¿‡ç¨‹ã€‚</p><blockquote><p>InnoDBé‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰</p></blockquote><p>InnoDBå­˜å‚¨å¼•æ“ä¸“ç”¨çš„æ—¥å¿—ï¼Œå®ƒè®°å½•äº†å¯¼è‡´æ•°æ®åº“çŠ¶æ€æ”¹å˜çš„æ‰€æœ‰æ“ä½œï¼Œç¡®ä¿åœ¨ç³»ç»Ÿå´©æºƒåèƒ½å¤Ÿæ¢å¤æ•°æ®ã€‚</p><p>å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯é£æœºä¸Šçš„é£è¡Œè®°å½•ä»ªï¼Œè®°å½•äº†é£è¡Œä¸­æ‰€æœ‰çš„æ“ä½œï¼Œä»¥ä¾¿åœ¨äº‹æ•…åé‡å»ºå‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><blockquote><p>InnoDBå›æ»šæ—¥å¿—ï¼ˆUndo Logï¼‰</p></blockquote><p>å›æ»šæ—¥å¿—æ˜¯InnoDBç”¨æ¥å¤„ç†äº‹åŠ¡çš„ï¼Œå®ƒè®°å½•äº†æ•°æ®çš„æ—§ç‰ˆæœ¬ï¼Œä½¿å¾—æ•°æ®åº“èƒ½å¤Ÿâ€œå›æ»šâ€åˆ°ä»¥å‰çš„çŠ¶æ€ã€‚</p><p>å¯ä»¥æŠŠå®ƒæ¯”ä½œæ˜¯æ—¶å…‰æœºï¼Œèƒ½å¤ŸæŠŠäº‹æƒ…æ¢å¤åˆ°è¿‡å»æŸä¸ªæ—¶é—´ç‚¹çš„çŠ¶æ€ã€‚</p><h4 id="RedoLog-And-binlog"><a href="#RedoLog-And-binlog" class="headerlink" title="RedoLog And  binlog"></a>RedoLog And  binlog</h4><p><strong>InnoDBé‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰ä¸ äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰</strong></p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹InnoDBçš„é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰å’ŒäºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰çš„ä½œç”¨å’Œå®ƒä»¬åœ¨MySQLä¸­çš„åº”ç”¨ã€‚</p><blockquote><p>InnoDBé‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰</p></blockquote><div style="background-color: #ecf0f1; color: #34495e; padding: 15px; border: 2px solid #bdc3c7; border-radius: 5px;">  <strong>Redo Logï¼š</strong>é‡åšæ—¥å¿—æ–‡ä»¶å¤§å°æ˜¯å›ºå®šçš„ï¼Œå¹¶ç»„æˆä¸€ä¸ªå¾ªç¯å†™å…¥çš„åºåˆ—ã€‚ï¼ˆæœ‰ä¸€ä¸ªæ“¦é™¤ç‚¹å’Œå†™å…¥ç‚¹ï¼Œæ–‡ä»¶æ»¡çš„æ—¶å€™éœ€è¦å…ˆæ“¦é™¤å†å†™å…¥ï¼‰</div><p>åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œé‡åšæ—¥å¿—ç”¨äºè®°å½•å¯¹æ•°æ®åº“æ‰€åšçš„æ¯ä¸ªå†™æ“ä½œï¼Œç¡®ä¿åœ¨ç³»ç»Ÿå´©æºƒåå¯ä»¥æ¢å¤è¿™äº›æ“ä½œã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºä¼ ç»Ÿè´¦æœ¬ä¸ä¾¿ç¬ºçš„ä½¿ç”¨ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå½“åº—ä¸»åœ¨ä¾¿ç¬ºä¸Šå¿«é€Ÿè®°ä¸‹å®¢æˆ·çš„è´­ä¹°è®°å½•ï¼Œä¹‹ååœ¨æ¯å¤©ç»“æŸæ—¶ï¼Œä»–ä¼šå°†è¿™äº›è®°å½•è¯¦ç»†åœ°è½¬ç§»åˆ°æ­£å¼çš„è´¦æœ¬ä¸­ã€‚ä¾¿ç¬ºä¸Šçš„è®°å½•å¯¹åº”äºé‡åšæ—¥å¿—ï¼Œè€Œæ­£å¼è´¦æœ¬å°±åƒæ˜¯æ•°æ®åº“æ–‡ä»¶ã€‚</p><p>é‡åšæ—¥å¿—æ˜¯å¾ªç¯ä½¿ç”¨çš„ï¼Œæœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°ã€‚å½“æ•°æ®åº“è¿›è¡Œå†™æ“ä½œæ—¶ï¼ŒInnoDBä¼šå°†æ“ä½œè¯¦æƒ…å†™å…¥é‡åšæ—¥å¿—ï¼Œå¹¶æ ‡è®°ä¸ºå‡†å¤‡ï¼ˆprepareï¼‰çŠ¶æ€ã€‚</p><p>éšåï¼Œåœ¨åˆé€‚çš„æ—¶æœºï¼Œè¿™äº›æ“ä½œä¼šè¢«å®é™…åº”ç”¨åˆ°ç£ç›˜ä¸Šçš„æ•°æ®æ–‡ä»¶ä¸­ã€‚</p><p>è¿™ç§ç­–ç•¥å…è®¸InnoDBå¼•æ“å¿«é€Ÿå“åº”å†™æ“ä½œï¼Œå› ä¸ºå®ƒä¸éœ€è¦æ¯æ¬¡éƒ½åŒæ­¥å†™å…¥ç£ç›˜ã€‚</p><hr><p>InnoDBçš„é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šå†…å­˜ä¸­çš„é‡åšæ—¥å¿—ç¼“å†²ï¼ˆredo log bufferï¼‰å’Œç£ç›˜ä¸Šçš„é‡åšæ—¥å¿—æ–‡ä»¶ã€‚</p><ol><li><p><strong>é‡åšæ—¥å¿—ç¼“å†²ï¼ˆRedo Log Bufferï¼‰</strong>ï¼šè¿™æ˜¯å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæš‚æ—¶å­˜æ”¾é‚£äº›è¿˜æ²¡æœ‰è¢«å†™å…¥åˆ°ç£ç›˜é‡åšæ—¥å¿—æ–‡ä»¶çš„æ•°æ®ã€‚å½“äº‹åŠ¡è¢«æäº¤æ—¶ï¼Œäº‹åŠ¡çš„é‡åšæ—¥å¿—ä¿¡æ¯é¦–å…ˆè¢«å†™å…¥åˆ°è¿™ä¸ªç¼“å†²åŒºä¸­ã€‚</p></li><li><p><strong>é‡åšæ—¥å¿—æ–‡ä»¶ï¼ˆRedo Log Filesï¼‰</strong>ï¼šè¿™äº›æ˜¯å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„ç‰©ç†æ–‡ä»¶ï¼Œç”¨äºæŒä¹…ä¿å­˜é‡åšæ—¥å¿—æ•°æ®ã€‚å³ä½¿åœ¨ç³»ç»Ÿå´©æºƒçš„æƒ…å†µä¸‹ï¼Œç”±äºè¿™äº›ä¿¡æ¯è¢«å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼ŒInnoDBä¹Ÿå¯ä»¥åœ¨é‡å¯åä½¿ç”¨è¿™äº›æ—¥å¿—æ¥æ¢å¤æ•°æ®ã€‚</p></li></ol><p>å…³äºé‡åšæ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼Œå®ƒä»¬æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡MySQLçš„é…ç½®æ–‡ä»¶è¿›è¡Œè®¾ç½®ã€‚é€šå¸¸ï¼Œé‡åšæ—¥å¿—æ–‡ä»¶ç»„æˆä¸€ä¸ªå¾ªç¯å†™å…¥çš„åºåˆ—ï¼Œè¿™æ„å‘³ç€å½“æœ€åä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å†™æ»¡åï¼Œç³»ç»Ÿä¼šå›åˆ°ç¬¬ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å¼€å§‹è¦†ç›–æ—§çš„æ—¥å¿—ï¼ˆè¿™å–å†³äºæ—¥å¿—çš„å†™å…¥ä½ç½®å’Œæ£€æŸ¥ç‚¹çš„ä½ç½®ï¼‰ã€‚</p><p>åœ¨é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯<code>my.cnf</code>æˆ–<code>my.ini</code>ï¼‰ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‚æ•°æ¥å®šä¹‰é‡åšæ—¥å¿—æ–‡ä»¶çš„å¤§å°å’Œæ•°é‡ï¼š</p><ul><li><code>innodb_log_file_size</code>ï¼šå®šä¹‰å•ä¸ªé‡åšæ—¥å¿—æ–‡ä»¶çš„å¤§å°ã€‚</li><li><code>innodb_log_files_in_group</code>ï¼šå®šä¹‰é‡åšæ—¥å¿—æ–‡ä»¶ç»„ä¸­æ–‡ä»¶çš„æ•°é‡ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ è®¾ç½®<code>innodb_log_file_size</code>ä¸º512MBï¼Œå¹¶ä¸”è®¾ç½®<code>innodb_log_files_in_group</code>ä¸º4ï¼Œé‚£ä¹ˆæ€»å…±ä¼šæœ‰2GBçš„é‡åšæ—¥å¿—ç©ºé—´å¯ç”¨ï¼ˆ512MB * 4 &#x3D; 2048MBæˆ–2GBï¼‰ã€‚</p><p>é€‰æ‹©é€‚å½“çš„é‡åšæ—¥å¿—æ–‡ä»¶å¤§å°æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºå®ƒä¼šå½±å“æ•°æ®åº“çš„æ€§èƒ½å’Œæ¢å¤èƒ½åŠ›ã€‚å¦‚æœé‡åšæ—¥å¿—å¤ªå°ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„I&#x2F;Oæ“ä½œï¼Œå› ä¸ºæ—¥å¿—ç©ºé—´ä¼šè¿…é€Ÿå¡«æ»¡å¹¶éœ€è¦é¢‘ç¹åœ°è¿›è¡Œæ—¥å¿—åˆ‡æ¢æ“ä½œã€‚å¦‚æœå¤ªå¤§ï¼Œæ¢å¤è¿‡ç¨‹å¯èƒ½ä¼šæ›´æ…¢ï¼Œå› ä¸ºInnoDBå¯èƒ½éœ€è¦å¤„ç†å¤§é‡çš„æ—¥å¿—æ•°æ®æ¥æ¢å¤çŠ¶æ€ã€‚é€šå¸¸ï¼Œè¿™ä¸ªå€¼åº”è¯¥æ ¹æ®ç³»ç»Ÿçš„è´Ÿè½½å’ŒI&#x2F;Oèƒ½åŠ›æ¥è°ƒæ•´ã€‚</p><blockquote><p>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰</p></blockquote><p>äºŒè¿›åˆ¶æ—¥å¿—è®°å½•äº†æ‰€æœ‰å¯¹æ•°æ®åº“è¿›è¡Œæ›´æ”¹çš„SQLè¯­å¥ã€‚å®ƒä¸æ˜¯ç‰¹å®šäºInnoDBçš„ï¼Œè€Œæ˜¯MySQLæœåŠ¡å™¨å±‚é¢çš„æ—¥å¿—ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ä¸€éƒ¨æ‘„åƒæœºï¼Œè®°å½•ä¸‹äº†å‘ç”Ÿçš„æ‰€æœ‰äº‹ä»¶ï¼Œæ— è®ºæ˜¯å¥½æ˜¯åã€‚</p><p>åœ¨æ•°æ®åº“éœ€è¦æ¢å¤æˆ–è€…è¿›è¡Œå¤åˆ¶è®¾ç½®æ—¶ï¼ŒäºŒè¿›åˆ¶æ—¥å¿—æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚</p><p>ä¸é‡åšæ—¥å¿—ä¸åŒï¼ŒäºŒè¿›åˆ¶æ—¥å¿—æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯å‘ç”Ÿäº†ä»€ä¹ˆï¼ˆä¾‹å¦‚â€œç»™ID&#x3D;2çš„è¿™ä¸€è¡Œçš„cå­—æ®µåŠ 1â€ï¼‰ï¼Œè€Œé‡åšæ—¥å¿—æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯åœ¨å“ªä¸ªæ•°æ®é¡µä¸Šåšäº†ä¿®æ”¹ã€‚äºŒè¿›åˆ¶æ—¥å¿—æ˜¯æŒ‰é¡ºåºè¿½åŠ çš„ï¼Œå¹¶ä¸”ä¸ä¼šè¦†ç›–æ—§çš„æ—¥å¿—ã€‚</p><blockquote><p>ä¸¤è€…çš„ååŒå·¥ä½œä¸ä¸¤é˜¶æ®µæäº¤</p></blockquote><div style="background-color: #ced6e0; color: #34495e; padding: 15px; border: 2px solid #bdc3c7; border-radius: 5px;">  <strong>ä¸¤é˜¶æ®µæäº¤ï¼š</strong>åªæœ‰åœ¨é‡åšæ—¥å¿—å’ŒäºŒè¿›åˆ¶æ—¥å¿—éƒ½è¢«æˆåŠŸå†™å…¥åï¼Œäº‹åŠ¡æ‰ä¼šæäº¤ã€‚</div><p>å½“æ‰§è¡Œä¸€ä¸ªæ›´æ–°æ“ä½œæ—¶ï¼ŒInnoDBä¼šå…ˆå†™å…¥é‡åšæ—¥å¿—ï¼Œè¿™ä¸ªæ“ä½œä¼šæ ‡è®°ä¸ºprepareçŠ¶æ€ã€‚ä¸€æ—¦è¿™ä¸ªæ“ä½œè¢«å†™å…¥ï¼Œå³ä½¿ç³»ç»Ÿå´©æºƒï¼Œè¿™ä¸ªæ“ä½œä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œç¡®ä¿äº†æ•°æ®åº“çš„crash-safeç‰¹æ€§ã€‚<strong>åªæœ‰åœ¨é‡åšæ—¥å¿—å’ŒäºŒè¿›åˆ¶æ—¥å¿—éƒ½è¢«æˆåŠŸå†™å…¥åï¼Œäº‹åŠ¡æ‰ä¼šæäº¤</strong>ã€‚</p><p>è¿™å°±å¼•å…¥äº†æ‰€è°“çš„â€œä¸¤é˜¶æ®µæäº¤â€ï¼š</p><ol><li><strong>å‡†å¤‡é˜¶æ®µ</strong>ï¼šäº‹åŠ¡çš„ä¿®æ”¹å…ˆè¢«å†™å…¥é‡åšæ—¥å¿—ï¼Œå¹¶å°†äº‹åŠ¡æ ‡è®°ä¸ºprepareçŠ¶æ€ã€‚</li><li><strong>æäº¤é˜¶æ®µ</strong>ï¼šäº‹åŠ¡çš„ä¿®æ”¹è¢«å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ï¼Œç„¶åInnoDBäº‹åŠ¡ä¼šæäº¤ï¼Œé‡åšæ—¥å¿—çš„çŠ¶æ€ä¼šå˜ä¸ºcommitã€‚</li></ol><p>è¿™ç§æœºåˆ¶ä¿è¯äº†å³ä½¿åœ¨äº‹åŠ¡æäº¤è¿‡ç¨‹ä¸­å‘ç”Ÿæ•…éšœï¼Œé‡åšæ—¥å¿—å’ŒäºŒè¿›åˆ¶æ—¥å¿—çš„çŠ¶æ€ä¹Ÿèƒ½ä¿æŒä¸€è‡´ã€‚è¿™å¯¹äºæ¢å¤åˆ°ç²¾ç¡®çš„æŸä¸€ç‚¹ä»¥åŠä¸»ä»å¤åˆ¶æ˜¯å¿…è¦çš„ï¼Œç¡®ä¿äº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><blockquote><p>åº”ç”¨åœºæ™¯</p></blockquote><p>åœ¨åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥åˆ©ç”¨é‡åšæ—¥å¿—æ¥ç¡®ä¿äº‹åŠ¡çš„æŒä¹…æ€§å’ŒåŸå­æ€§ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿçªç„¶æ–­ç”µæˆ–è€…å´©æºƒï¼Œé‡åšæ—¥å¿—å¯ä»¥ç”¨æ¥æ¢å¤æœªæäº¤çš„äº‹åŠ¡ï¼Œä»¥åŠç¡®ä¿å·²æäº¤çš„äº‹åŠ¡ä¸ä¼šä¸¢å¤±ã€‚</p><p>äºŒè¿›åˆ¶æ—¥å¿—ä¸»è¦ç”¨äºï¼š</p><ul><li><strong>æ•°æ®å¤åˆ¶</strong>ï¼šå°†binlogå†…å®¹å¤åˆ¶åˆ°ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨é‡æ”¾è¿™äº›æ“ä½œï¼Œä¿æŒå’Œä¸»æœåŠ¡å™¨çš„æ•°æ®ä¸€è‡´ã€‚</li><li><strong>æ•°æ®æ¢å¤</strong>ï¼šå½“éœ€è¦å°†æ•°æ®åº“æ¢å¤åˆ°è¿‡å»çš„æŸä¸ªçŠ¶æ€æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…¨é‡å¤‡ä»½åŠ ä¸ŠäºŒè¿›åˆ¶æ—¥å¿—æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚</li></ul><p>ä¸¤é˜¶æ®µæäº¤ä¿è¯äº†åœ¨ä½¿ç”¨é‡åšæ—¥å¿—å’ŒäºŒè¿›åˆ¶æ—¥å¿—æ—¶ï¼Œç³»ç»Ÿçš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼Œè¿™å¯¹äºç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§å’Œå¯æ¢å¤æ€§éå¸¸é‡è¦ã€‚</p><blockquote><p>æ€è€ƒé¢˜ï¼š åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ï¼Œä¸€å¤©ä¸€å¤‡ä¼šæ¯”ä¸€å‘¨ä¸€å¤‡æ›´æœ‰ä¼˜åŠ¿å‘¢ï¼Ÿ</p></blockquote><p>æ—¥å¸¸å…¨é‡å¤‡ä»½ç›¸æ¯”å‘¨å¤‡ä»½çš„ä¼˜åŠ¿åœ¨äºå‡å°‘äº†æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚å¦‚æœå‘ç”Ÿç¾éš¾ï¼Œä½ åªä¼šä¸¢å¤±ä¸€å¤©çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€å‘¨çš„ã€‚è¿™ç›´æ¥å½±å“äº†æ•°æ®åº“ç³»ç»Ÿçš„æ¢å¤ç‚¹ç›®æ ‡ï¼ˆRecovery Point Objectiveï¼ŒRPOï¼‰ï¼Œå³åœ¨æ•°æ®ä¸¢å¤±äº‹ä»¶åæ•°æ®æ¢å¤çš„èƒ½åŠ›ã€‚</p><p>æ¯å¤©å¤‡ä»½çš„RPOæ˜æ˜¾å°äºæ¯å‘¨å¤‡ä»½ï¼Œå› æ­¤ä¸€å¤©ä¸€å¤‡çš„ç­–ç•¥æ›´é€‚åˆå¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚è¾ƒé«˜çš„ç³»ç»Ÿã€‚</p><h3 id="3ã€äº‹åŠ¡éš”ç¦»"><a href="#3ã€äº‹åŠ¡éš”ç¦»" class="headerlink" title="3ã€äº‹åŠ¡éš”ç¦»"></a>3ã€äº‹åŠ¡éš”ç¦»</h3><p>äº‹åŠ¡å°±æ˜¯è¦ä¿è¯ä¸€ç»„æ•°æ®åº“æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</p><p>åœ¨Â <strong>MySQL</strong>Â ä¸­ï¼Œäº‹åŠ¡æ”¯æŒæ˜¯åœ¨å¼•æ“å±‚å®ç°çš„ï¼ŒMyISAM å¼•æ“æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„ï¼ŒInnoDB æ”¯æŒï¼›</p><p>ä¸‹è¿°å†…å®¹æ˜¯å›´ç»• InnoDB å¼•æ“æ¥è®²è¿°ã€‚</p><h4 id="éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«"><a href="#éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«" class="headerlink" title="éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«"></a>éš”ç¦»æ€§ä¸éš”ç¦»çº§åˆ«</h4><p>åœ¨MySQLä¸­ï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«å®šä¹‰äº†ä¸€ä¸ªäº‹åŠ¡å¯èƒ½å—å…¶ä»–å¹¶å‘äº‹åŠ¡å½±å“çš„ç¨‹åº¦ã€‚</p><p>è¿™ä¸ªæ¦‚å¿µå¯¹äºç†è§£å¹¶å‘æ“ä½œæ—¶å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼ˆå¦‚è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ï¼‰è‡³å…³é‡è¦ã€‚</p><p>MySQLæ”¯æŒä»¥ä¸‹å››ç§æ ‡å‡†çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š</p><ul><li>è¯»æœªæäº¤</li><li>è¯»å·²æäº¤</li><li>å¯é‡å¤è¯»</li><li>ä¸²è¡ŒåŒ–</li></ul><blockquote><ol><li>READ UNCOMMITTEDï¼ˆè¯»æœªæäº¤ï¼‰</li></ol></blockquote><p>è¿™æ˜¯æœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œåœ¨è¿™ä¸ªçº§åˆ«ï¼Œäº‹åŠ¡å¯ä»¥è¯»å–åˆ°å…¶ä»–äº‹åŠ¡è¿˜æœªæäº¤çš„æ›´æ”¹ã€‚</p><p>æƒ³è±¡ä¸€ä¸ªå›¾ä¹¦é¦†ï¼Œæ‰€æœ‰ä¹¦ç±å³ä½¿æ­£åœ¨è¢«ç¼–è¾‘ï¼ˆæ•°æ®è¢«ä¿®æ”¹ï¼‰ä¹Ÿå¯ä»¥è¢«ä»»ä½•äººé˜…è¯»ã€‚</p><p>è¿™å¯èƒ½å¯¼è‡´â€œè„è¯»â€ï¼Œå³ä¸€ä¸ªäº‹åŠ¡å¯èƒ½è¯»å–åˆ°å¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹ä½†å°šæœªæäº¤çš„æ•°æ®ï¼Œå¦‚æœé‚£ä¸ªäº‹åŠ¡å›æ»šï¼Œè¯»å–åˆ°çš„æ•°æ®å°±æ˜¯æ— æ•ˆçš„ã€‚</p><blockquote><ol start="2"><li>READ COMMITTEDï¼ˆè¯»å·²æäº¤ï¼‰</li></ol></blockquote><p>åœ¨è¿™ä¸ªçº§åˆ«ï¼Œä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–åˆ°å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„æ›´æ”¹ã€‚</p><p>å›åˆ°å›¾ä¹¦é¦†çš„ä¾‹å­ï¼Œè¿™å°±ç›¸å½“äºåªæœ‰å½“ä¸€æœ¬ä¹¦å®Œæˆç¼–è¾‘å¹¶è¿”å›åˆ°ä¹¦æ¶ä¸Šæ—¶ï¼Œå…¶ä»–äººæ‰èƒ½é˜…è¯»å®ƒã€‚</p><p>è¿™è§£å†³äº†è„è¯»çš„é—®é¢˜ï¼Œä½†ä»ç„¶å¯èƒ½å‡ºç°â€œä¸å¯é‡å¤è¯»â€ï¼Œå› ä¸ºåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒåŒæ ·çš„æŸ¥è¯¢å¯èƒ½ä¼šè¿”å›ä¸åŒçš„ç»“æœï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡åœ¨ä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´æäº¤äº†æ›´æ”¹ã€‚</p><blockquote><ol start="3"><li>REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰</li></ol></blockquote><p>MySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</p><p>åœ¨è¿™ä¸ªçº§åˆ«ï¼Œäº‹åŠ¡åœ¨å¼€å§‹æ—¶åˆ›å»ºä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œ<strong>ç¡®ä¿åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´å¯ä»¥é‡å¤è¯»å–ç›¸åŒçš„æ•°æ®</strong>ï¼Œå³ä½¿å…¶ä»–äº‹åŠ¡æäº¤äº†æ›´æ”¹ã€‚</p><p>åœ¨å›¾ä¹¦é¦†ä¸­ï¼Œå³ä½¿ä¹¦ç±è¢«ç¼–è¾‘ï¼Œä½ ä¹Ÿä¼šä¸€ç›´è¯»åˆ°ä½ æœ€åˆæ‰¾åˆ°çš„ç‰ˆæœ¬ã€‚è™½ç„¶è§£å†³äº†ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œä½†å®ƒä»ç„¶é¢ä¸´â€œå¹»è¯»â€çš„é—®é¢˜ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸¤ä¸ªç›¸åŒçš„æŸ¥è¯¢å¯èƒ½<strong>å› ä¸ºå¦ä¸€ä¸ªäº‹åŠ¡çš„æ’å…¥æ“ä½œ</strong>è€Œè¿”å›ä¸åŒçš„è¡Œæ•°ã€‚</p><blockquote><ol start="4"><li>SERIALIZABLEï¼ˆä¸²è¡ŒåŒ–ï¼‰</li></ol></blockquote><p>è¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡<strong>å¼ºåˆ¶äº‹åŠ¡é¡ºåºæ‰§è¡Œ</strong>ï¼Œé¿å…äº†å¹»è¯»çš„é—®é¢˜ã€‚åœ¨å›¾ä¹¦é¦†ä¸­ï¼Œè¿™ç›¸å½“äºå½“ä½ é˜…è¯»ä¸€æœ¬ä¹¦æ—¶ï¼Œ<strong>å…¶ä»–ä»»ä½•äººéƒ½ä¸èƒ½ç¼–è¾‘æˆ–æ£€æŸ¥è¿™æœ¬ä¹¦</strong>ã€‚è¿™ä¼šå¯¼è‡´æ˜æ˜¾çš„æ€§èƒ½ä¸‹é™ï¼Œå› ä¸ºå®ƒé˜»æ­¢äº†å¯èƒ½çš„å¹¶å‘äº‹åŠ¡æ‰§è¡Œã€‚</p><p>ä¸åŒéš”ç¦»çº§åˆ«å¯¹æ€§èƒ½å’Œå¹¶å‘æ€§çš„å½±å“æ˜¯ä¸€ä¸ªæƒè¡¡ï¼š</p><ul><li>æ›´ä½çš„éš”ç¦»çº§åˆ«ï¼ˆå¦‚READ UNCOMMITTEDå’ŒREAD COMMITTEDï¼‰æé«˜äº†å¹¶å‘æ€§ï¼Œä½†ç‰ºç‰²äº†æ•°æ®çš„å‡†ç¡®æ€§ã€‚</li><li>æ›´é«˜çš„éš”ç¦»çº§åˆ«ï¼ˆå¦‚REPEATABLE READå’ŒSERIALIZABLEï¼‰æä¾›äº†æ›´å‡†ç¡®çš„æ•°æ®å’Œäº‹åŠ¡ä¸€è‡´æ€§ï¼Œä½†å¯èƒ½ä¼šé™ä½å¹¶å‘æ€§ã€‚</li></ul><p>é€‰æ‹©å“ªä¸ªéš”ç¦»çº§åˆ«å–å†³äºåº”ç”¨ç¨‹åºçš„ç‰¹å®šéœ€æ±‚å’Œå®ƒå¯ä»¥å®¹å¿çš„æ•°æ®ä¸ä¸€è‡´ç¨‹åº¦ã€‚</p><p>ä¾‹å¦‚ï¼Œé“¶è¡Œç³»ç»Ÿå¯èƒ½ä¼šå€¾å‘äºä½¿ç”¨æ›´é«˜çš„éš”ç¦»çº§åˆ«ä»¥ä¿è¯äº‹åŠ¡çš„å‡†ç¡®æ€§ï¼Œè€Œä¸€ä¸ªåªæ˜¾ç¤ºè¿‘ä¼¼æ•°æ®çš„æŠ¥å‘Šç³»ç»Ÿå¯èƒ½ä¼šé€‰æ‹©ä¸€ä¸ªæ›´ä½çš„éš”ç¦»çº§åˆ«ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p><h4 id="éš”ç¦»çº§åˆ«REPEATABLE-READï¼ˆå¯é‡å¤è¯»ï¼‰çš„å®ç°"><a href="#éš”ç¦»çº§åˆ«REPEATABLE-READï¼ˆå¯é‡å¤è¯»ï¼‰çš„å®ç°" class="headerlink" title="éš”ç¦»çº§åˆ«REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰çš„å®ç°"></a>éš”ç¦»çº§åˆ«REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰çš„å®ç°</h4><p>åœ¨MySQLä¸­ï¼ŒREPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«çš„å®ç°æ˜¯é€šè¿‡ç»“åˆä½¿ç”¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰å’Œå›æ»šæ—¥å¿—æ¥å®Œæˆçš„ã€‚</p><p>è¿™ä¸¤ç§æœºåˆ¶å…±åŒå·¥ä½œï¼Œä»¥ç¡®ä¿äº‹åŠ¡å¯ä»¥åœ¨å…¶æ‰§è¡ŒæœŸé—´å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®çš„ä¸€è‡´çŠ¶æ€ï¼ŒåŒæ—¶é¿å…ç”±å…¶ä»–å¹¶å‘äº‹åŠ¡å¼•èµ·çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p><blockquote><p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰</p></blockquote><p>MVCCæ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«çš„æ ¸å¿ƒï¼Œå®ƒå…è®¸åœ¨ä¸åŠ é”çš„æƒ…å†µä¸‹è¿›è¡Œè¯»æ“ä½œï¼ŒåŒæ—¶ä»ç„¶ä¿æŒäº‹åŠ¡é—´çš„éš”ç¦»ã€‚</p><ul><li><strong>æ•°æ®ç‰ˆæœ¬åŒ–</strong>ï¼šåœ¨MVCCä¸­ï¼Œæ¯å½“æ•°æ®è¢«æ›´æ–°æ—¶ï¼ŒåŸå§‹æ•°æ®ä¸ä¼šç«‹å³è¢«è¦†ç›–ã€‚ç›¸åï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®ç‰ˆæœ¬ã€‚è¿™æ ·ï¼Œä¸åŒçš„äº‹åŠ¡å¯ä»¥çœ‹åˆ°åŒä¸€æ•°æ®çš„ä¸åŒç‰ˆæœ¬ã€‚</li><li><strong>è¯»è§†å›¾ï¼ˆRead-Viewï¼‰</strong>ï¼šå½“äº‹åŠ¡å¼€å§‹æ—¶ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªè¯»è§†å›¾ï¼Œè¿™ä¸ªè§†å›¾ä»£è¡¨æ•°æ®åº“åœ¨é‚£ä¸€æ—¶åˆ»çš„çŠ¶æ€ã€‚åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´ï¼Œå³ä½¿æ•°æ®åœ¨å…¶ä»–äº‹åŠ¡ä¸­è¢«æ›´æ”¹ï¼Œè¯¥äº‹åŠ¡ä¹Ÿèƒ½çœ‹åˆ°å…¶è¯»è§†å›¾ä¸­çš„æ•°æ®ç‰ˆæœ¬ã€‚</li></ul><blockquote><p>å›æ»šæ—¥å¿—</p></blockquote><p>å›æ»šæ—¥å¿—æ˜¯å®ç°MVCCçš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œå®ƒç”¨äºè®°å½•æ¯ä¸ªæ•°æ®ç‰ˆæœ¬çš„å†å²ä¿¡æ¯ã€‚</p><ul><li><strong>ç‰ˆæœ¬é“¾</strong>ï¼šæ¯å½“æ•°æ®é¡¹è¢«æ›´æ–°ï¼Œå›æ»šæ—¥å¿—å°±ä¼šè®°å½•ä¸€ä¸ªæ“ä½œï¼Œè¿™äº›æ“ä½œå½¢æˆäº†ä¸€æ¡ç‰ˆæœ¬é“¾ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå€¼ä»1æ”¹ä¸º2ï¼Œå†æ”¹ä¸º3ï¼Œæœ€åå˜ä¸º4ï¼Œå›æ»šæ—¥å¿—ä¼šè®°å½•è¿™ä¸€ç³»åˆ—å˜åŒ–ã€‚</li><li><strong>ä¿ç•™å†å²æ•°æ®</strong>ï¼šè¿™äº›å›æ»šæ“ä½œå…è®¸æ•°æ®åº“â€œå›æ»šâ€åˆ°æ—©æœŸçš„çŠ¶æ€ã€‚å› æ­¤ï¼Œå³ä½¿å½“å‰æ•°æ®å€¼æ˜¯4ï¼Œä¸åŒçš„äº‹åŠ¡ä¾æ®å®ƒä»¬çš„è¯»è§†å›¾å¯èƒ½çœ‹åˆ°çš„å€¼æ˜¯1ã€2æˆ–4ã€‚</li></ul><p>å›æ»šæ—¥å¿—ä»€ä¹ˆæ—¶å€™åˆ é™¤ï¼Ÿ</p><ul><li>åœ¨ä¸éœ€è¦çš„æ—¶å€™æ‰åˆ é™¤ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿä¼šåˆ¤æ–­ï¼Œå½“æ²¡æœ‰äº‹åŠ¡å†éœ€è¦ç”¨åˆ°è¿™äº›å›æ»šæ—¥å¿—æ—¶ï¼Œå›æ»šæ—¥å¿—ä¼šè¢«åˆ é™¤ã€‚</li><li>ä»€ä¹ˆæ—¶å€™æ‰ä¸éœ€è¦äº†å‘¢ï¼Ÿå°±æ˜¯å½“ç³»ç»Ÿé‡Œæ²¡æœ‰æ¯”è¿™ä¸ªå›æ»šæ—¥å¿—æ›´æ—©çš„ read-view çš„æ—¶å€™ã€‚</li></ul><blockquote><p>å®ç°åŸç†</p></blockquote><p>ç»“åˆMVCCå’Œå›æ»šæ—¥å¿—ï¼Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«åœ¨MySQLä¸­çš„å®ç°å¯ä»¥è¿™æ ·ç†è§£ï¼š</p><ol><li><strong>äº‹åŠ¡å¼€å§‹æ—¶åˆ›å»ºè¯»è§†å›¾</strong>ï¼šäº‹åŠ¡å¼€å§‹æ—¶æ•æ‰æ•°æ®åº“çš„ç¬æ—¶å¿«ç…§ï¼Œè¿™ä¸ªå¿«ç…§å®šä¹‰äº†äº‹åŠ¡èƒ½çœ‹åˆ°çš„æ•°æ®ç‰ˆæœ¬ã€‚</li><li><strong>è¯»å–æ“ä½œæ—¶ä½¿ç”¨å›æ»šæ—¥å¿—</strong>ï¼šå½“äº‹åŠ¡ä¸­çš„æ“ä½œéœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œç³»ç»Ÿä¼šåˆ©ç”¨å›æ»šæ—¥å¿—æ‰¾åˆ°è¯¥äº‹åŠ¡è¯»è§†å›¾å¯¹åº”çš„æ•°æ®ç‰ˆæœ¬ã€‚</li><li><strong>éš”ç¦»æ€§çš„ä¿è¯</strong>ï¼šå³ä½¿åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡å·²ç»æäº¤äº†å¯¹ç›¸åŒæ•°æ®çš„æ›´æ”¹ï¼Œè¯¥äº‹åŠ¡ä»ç„¶åªèƒ½çœ‹åˆ°å…¶å¼€å§‹æ—¶çš„æ•°æ®ç‰ˆæœ¬ã€‚</li><li><strong>å›æ»šæ—¥å¿—çš„ç»´æŠ¤</strong>ï¼šå›æ»šæ—¥å¿—ä¼šä¸€ç›´ä¿ç•™ï¼Œç›´åˆ°æ²¡æœ‰äº‹åŠ¡éœ€è¦æ—©æœŸçš„æ•°æ®ç‰ˆæœ¬ä¸ºæ­¢ã€‚è¿™ç¡®ä¿äº†å³ä½¿åœ¨æœ‰é•¿äº‹åŠ¡å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ•°æ®çš„æ—©æœŸç‰ˆæœ¬ä»ç„¶å¯ç”¨ã€‚</li></ol><blockquote><p>é•¿äº‹åŠ¡çš„å½±å“</p></blockquote><p>ç”±äºé•¿äº‹åŠ¡å¯èƒ½ä¼šè®¿é—®æ—§ç‰ˆæœ¬çš„æ•°æ®ï¼ŒMySQLå¿…é¡»ä¿ç•™é•¿äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„æ‰€æœ‰å›æ»šä¿¡æ¯ã€‚è¿™ä¸ä»…å ç”¨äº†å¤§é‡å­˜å‚¨ç©ºé—´ï¼Œè€Œä¸”å¯èƒ½å½±å“ç³»ç»Ÿæ€§èƒ½ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨MySQL 5.5åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¤§é‡çš„å›æ»šæ—¥å¿—å¯èƒ½å¯¼è‡´ibdataæ–‡ä»¶è¿‡å¤§ï¼Œå³ä½¿é•¿äº‹åŠ¡æœ€ç»ˆæäº¤ï¼Œè¿™äº›ç©ºé—´ä¹Ÿä¸ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œæœ‰æ—¶éœ€è¦é‡å»ºæ•´ä¸ªæ•°æ®åº“æ¥æ¸…ç†è¿™äº›ç©ºé—´ã€‚</p><p>å› æ­¤ï¼Œè™½ç„¶REPEATABLE READæä¾›äº†è¾ƒå¼ºçš„éš”ç¦»æ€§ï¼Œä½†ä¹Ÿéœ€è¦åˆç†ç®¡ç†äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œé¿å…é•¿äº‹åŠ¡å¯¹ç³»ç»Ÿæ€§èƒ½å’Œå­˜å‚¨ç©ºé—´çš„è´Ÿé¢å½±å“ã€‚</p><hr><p>åˆšåˆšçœ‹åˆ°ä¸€ä¸ªæ¦‚å¿µï¼Œå« Next-Key Lockingã€‚ä»–å¯ä»¥ä¿æŒåœ¨å¯é‡å¤éš”ç¦»çº§åˆ«ä¸‹ï¼ŒåŒæ—¶é¿å…è„è¯»çš„ä¸€ç§é”æœºåˆ¶ã€‚</p><p>å¯ä¸²è¡ŒåŒ–çš„åŒ–å°±å®Œå…¨æ˜¯å¼ºåˆ¶äº‹åŠ¡é¡ºåºæ‰§è¡Œï¼Œè€Œ Next-Key Locking çš„è¯æ˜¯ç»“åˆäº†è¡Œé”å’Œé—´éš™é”ï¼Œé¿å…äº†ä¸€å®šèŒƒå›´å†…å‡ºç°è„è¯»ã€‚</p><h4 id="Next-Key-Locking"><a href="#Next-Key-Locking" class="headerlink" title="Next-Key Locking"></a>Next-Key Locking</h4><p>Next-Key Locking æ˜¯ InnoDB å­˜å‚¨å¼•æ“ç‰¹æœ‰çš„é”æœºåˆ¶ï¼Œå®ƒç»“åˆäº†è¡Œé”å’Œé—´éš™é”ï¼ˆgap lockï¼‰çš„ç‰¹æ€§ã€‚Next-Key Lock å®é™…ä¸Šé”å®šäº†ä¸€ä¸ªèŒƒå›´ï¼Œä¸ä»…é”å®šäº†è¡Œè®°å½•æœ¬èº«ï¼Œè¿˜é”å®šäº†è®°å½•ä¹‹é—´çš„é—´éš™ï¼Œä»è€Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„è®°å½•ã€‚</p><blockquote><p>ä½œç”¨ä¸æ•ˆæœ</p></blockquote><ul><li><strong>ä½œç”¨</strong>ï¼šé€šè¿‡ Next-Key Lockingï¼ŒMySQL èƒ½å¤Ÿç¡®ä¿åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸€ä¸ªäº‹åŠ¡åœ¨å…¶æ‰§è¡ŒæœŸé—´çœ‹åˆ°çš„æ•°æ®èŒƒå›´ä¿æŒä¸å˜ï¼Œå³ä½¿æœ‰å…¶ä»–äº‹åŠ¡è¯•å›¾åœ¨è¿™ä¸ªèŒƒå›´å†…æ’å…¥æ–°çš„æ•°æ®ï¼Œä¹Ÿä¼šå› ä¸ºé”çš„å­˜åœ¨è€Œè¢«é˜»å¡ï¼Œç›´åˆ°åŸäº‹åŠ¡å®Œæˆã€‚è¿™æ ·å°±æœ‰æ•ˆåœ°é¿å…äº†å¹»è¯»é—®é¢˜ã€‚</li><li><strong>æ•ˆæœ</strong>ï¼šå› æ­¤ï¼Œåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼ŒMySQL èƒ½å¤Ÿæœ‰æ•ˆè§£å†³å¹»è¯»é—®é¢˜ï¼Œç¡®ä¿äº‹åŠ¡çš„ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ã€‚</li></ul><p>ç®€è€Œè¨€ä¹‹ï¼Œé€šè¿‡ Next-Key Locking æœºåˆ¶ï¼ŒMySQL åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹é€šè¿‡é”å®šæ•°æ®èŒƒå›´å’Œé—´éš™æ¥é˜²æ­¢å¹»è¯»ï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„ä¸€è‡´æ€§å’Œäº‹åŠ¡çš„éš”ç¦»æ€§ã€‚</p><blockquote><p>å’Œä¸²è¡ŒåŒ–çš„åŒºåˆ«</p></blockquote><p>Next-Key Locking ä¸æ˜¯ä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰éš”ç¦»çº§åˆ«ï¼Œè€Œæ˜¯ä¸€ç§é”æœºåˆ¶ï¼Œä¸»è¦ç”¨äº InnoDB å­˜å‚¨å¼•æ“åœ¨å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰éš”ç¦»çº§åˆ«ä¸‹é˜²æ­¢å¹»è¯»é—®é¢˜çš„ä¸€ç§å®ç°æ–¹æ³•ã€‚ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«å’Œå¯é‡å¤è¯»éš”ç¦»çº§åˆ«æ˜¯äº‹åŠ¡éš”ç¦»çº§åˆ«çš„ä¸¤ç§ä¸åŒæ ‡å‡†ï¼Œå®ƒä»¬åœ¨å¤„ç†å¹¶å‘äº‹åŠ¡æ—¶æœ‰ä¸åŒçš„ç‰¹æ€§å’Œè¡Œä¸ºã€‚</p><p>Next-Key Locking</p><ul><li>Next-Key Locking æ˜¯ InnoDB ç‰¹æœ‰çš„ä¸€ç§é”æœºåˆ¶ï¼Œç»“åˆäº†è¡Œé”å’Œé—´éš™é”ï¼ˆGap Lockï¼‰ã€‚</li><li>å®ƒé”å®šä¸€ä¸ªèŒƒå›´è€Œä¸ä»…ä»…æ˜¯å•ä¸ªè¡Œè®°å½•ï¼ŒåŒ…æ‹¬è®°å½•æœ¬èº«å’Œè®°å½•ä¹‹é—´çš„é—´éš™ã€‚</li><li>ä¸»è¦ç”¨åœ¨å¯é‡å¤è¯»ï¼ˆRepeatable Readï¼‰éš”ç¦»çº§åˆ«ä¸‹ï¼Œç”¨äºé˜²æ­¢å¹»è¯»é—®é¢˜ã€‚</li></ul><p>ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ï¼ˆSerializableï¼‰</p><ul><li>ä¸²è¡ŒåŒ–æ˜¯æœ€é«˜çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡å¼ºåˆ¶äº‹åŠ¡é¡ºåºæ‰§è¡Œæ¥é¿å…å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜ï¼ŒåŒ…æ‹¬è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»ã€‚</li><li>åœ¨ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¯»æ“ä½œä¼šåŠ é”ï¼Œä½¿å¾—å…¶ä»–äº‹åŠ¡ä¸èƒ½åŒæ—¶è¿›è¡Œå†™æ“ä½œã€‚</li><li>ä¸²è¡ŒåŒ–é€šè¿‡å¯¹æ‰€æœ‰è¯»å–çš„è¡ŒåŠ é”è¾¾åˆ°ä¸å•çº¿ç¨‹é¡ºåºæ‰§è¡Œç›¸åŒçš„æ•ˆæœï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„ç»å¯¹ä¸€è‡´æ€§ã€‚</li></ul><p>åŒºåˆ«</p><ul><li><strong>éš”ç¦»çº§åˆ«</strong>ï¼šNext-Key Locking æ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹é˜²æ­¢å¹»è¯»çš„ä¸€ç§é”æœºåˆ¶ï¼Œè€Œä¸²è¡ŒåŒ–æ˜¯ä¸€ä¸ªäº‹åŠ¡éš”ç¦»çš„æ ‡å‡†çº§åˆ«ï¼Œå®ƒé€šè¿‡åŠ é”æ¥åºåˆ—åŒ–æ‰€æœ‰çš„äº‹åŠ¡ã€‚</li><li><strong>æ€§èƒ½å’Œå¹¶å‘</strong>ï¼šç”±äº Next-Key Locking åªé”å®šéœ€è¦çš„æ•°æ®èŒƒå›´ï¼Œæ‰€ä»¥å¯é‡å¤è¯»çº§åˆ«ä¸‹çš„å¹¶å‘æ€§èƒ½æ¯”ä¸²è¡ŒåŒ–çº§åˆ«æ›´å¥½ã€‚ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«é€šè¿‡åŠ é”é™åˆ¶äº†å¹¶å‘ï¼Œè™½ç„¶æ•°æ®ä¸€è‡´æ€§æœ€å¼ºï¼Œä½†æ€§èƒ½å¼€é”€ä¹Ÿæœ€å¤§ã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šNext-Key Locking åœ¨éœ€è¦é˜²æ­¢å¹»è¯»åŒæ—¶åˆè¦ä¿æŒè¾ƒé«˜å¹¶å‘æ€§çš„åœºæ™¯ä¸‹ä½¿ç”¨è¾ƒå¤šã€‚ä¸²è¡ŒåŒ–é€‚ç”¨äºå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯ï¼Œä½†å¹¶å‘è¦æ±‚ä¸é«˜ã€‚</li></ul><p>æ€»ç»“æ¥è¯´ï¼ŒNext-Key Locking æ˜¯ä¸€ç§é”æœºåˆ¶ï¼Œç”¨äºå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹çš„ InnoDB å­˜å‚¨å¼•æ“ï¼Œè€Œä¸²è¡ŒåŒ–æ˜¯æœ€é«˜ç­‰çº§çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¸¤è€…åœ¨å¹¶å‘æ§åˆ¶å’Œæ€§èƒ½å¼€é”€ä¸Šæœ‰æ˜æ˜¾çš„å·®å¼‚ã€‚</p><h4 id="äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼"><a href="#äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼" class="headerlink" title="äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼"></a>äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼</h4><div style="background-color: #ecf0f1; color: #34495e; padding: 15px; border: 2px solid #bdc3c7; border-radius: 5px;">  <strong>äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼ï¼š</strong>æ˜¾ç¤ºå¯åŠ¨äº‹åŠ¡ï¼›è‡ªåŠ¨æäº¤æ¨¡å¼</div><p>åœ¨MySQLä¸­ï¼Œäº‹åŠ¡çš„å¯åŠ¨æ–¹å¼å¯¹äºäº‹åŠ¡ç®¡ç†å’Œæ€§èƒ½ä¼˜åŒ–è‡³å…³é‡è¦ã€‚ç†è§£å’Œæ­£ç¡®ä½¿ç”¨ä¸åŒçš„äº‹åŠ¡å¯åŠ¨æ–¹å¼å¯ä»¥é¿å…é•¿äº‹åŠ¡å¸¦æ¥çš„é£é™©ã€‚ä¸‹é¢æ˜¯MySQLä¸­å¸¸è§çš„å‡ ç§äº‹åŠ¡å¯åŠ¨æ–¹å¼ï¼š</p><blockquote><ol><li>æ˜¾å¼å¯åŠ¨äº‹åŠ¡</li></ol></blockquote><ul><li><strong>ä½¿ç”¨è¯­å¥å¯åŠ¨</strong>ï¼šæœ€ç›´æ¥çš„å¯åŠ¨äº‹åŠ¡çš„æ–¹å¼æ˜¯ä½¿ç”¨<code>BEGIN</code>æˆ–<code>START TRANSACTION</code>è¯­å¥ã€‚è¿™ç§æ–¹å¼ä¸‹ï¼Œäº‹åŠ¡ä¼šæŒç»­åˆ°æ‰§è¡Œ<code>COMMIT</code>æˆ–<code>ROLLBACK</code>è¯­å¥ä¸ºæ­¢ã€‚<code>COMMIT</code>ç”¨äºæäº¤äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ›´æ”¹ï¼Œè€Œ<code>ROLLBACK</code>ç”¨äºæ’¤é”€æ‰€æœ‰æ›´æ”¹ã€‚</li><li><strong>æ˜¾å¼æ§åˆ¶</strong>ï¼šè¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å¼€å‘è€…å¯¹äº‹åŠ¡çš„å¼€å§‹å’Œç»“æŸæœ‰æ˜ç¡®çš„æ§åˆ¶ï¼Œè¿™æœ‰åŠ©äºé¿å…ä¸å¿…è¦çš„é•¿äº‹åŠ¡ã€‚</li></ul><blockquote><ol start="2"><li>è‡ªåŠ¨æäº¤æ¨¡å¼</li></ol></blockquote><ul><li><strong>è®¾ç½®è‡ªåŠ¨æäº¤</strong>ï¼šé€šè¿‡æ‰§è¡Œ<code>SET autocommit=0</code>ï¼Œå¯ä»¥å…³é—­å½“å‰çº¿ç¨‹çš„è‡ªåŠ¨æäº¤ã€‚è¿™æ„å‘³ç€å³ä½¿æ‰§è¡Œäº†ä¸€ä¸ªç®€å•çš„<code>SELECT</code>æŸ¥è¯¢ï¼Œä¹Ÿä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶ä¸”äº‹åŠ¡ä¸ä¼šè‡ªåŠ¨æäº¤ã€‚</li><li><strong>æ½œåœ¨é£é™©</strong>ï¼šè¿™ç§æ¨¡å¼ä¸‹ï¼Œå¦‚æœå¼€å‘è€…å¿˜è®°äº†æ‰‹åŠ¨æäº¤æˆ–å›æ»šäº‹åŠ¡ï¼Œæˆ–è€…åœ¨é•¿è¿æ¥ä¸­ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œå¯èƒ½ä¼šæ— æ„ä¸­åˆ›å»ºé•¿äº‹åŠ¡ï¼Œè¿™ä¼šå ç”¨å¤§é‡èµ„æºå¹¶å½±å“æ•°æ®åº“æ€§èƒ½ã€‚</li></ul><blockquote><ol start="3"><li>æ¨èçš„å®è·µ</li></ol></blockquote><ul><li><strong>é»˜è®¤è‡ªåŠ¨æäº¤</strong>ï¼šå»ºè®®æ€»æ˜¯ä½¿ç”¨<code>SET autocommit=1</code>ã€‚é€šè¿‡æ˜¾å¼çš„<code>BEGIN</code>ã€<code>COMMIT</code>å’Œ<code>ROLLBACK</code>è¯­å¥æ¥æ§åˆ¶äº‹åŠ¡ï¼Œè¿™æ ·å¯ä»¥æ¸…æ™°åœ°ç®¡ç†äº‹åŠ¡çš„ç”Ÿå‘½å‘¨æœŸã€‚</li><li><strong>å‡å°‘äº¤äº’</strong>ï¼šå¯¹äºéœ€è¦é¢‘ç¹å¯åŠ¨äº‹åŠ¡çš„åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨<code>COMMIT WORK AND CHAIN</code>è¯­æ³•ã€‚åœ¨<code>autocommit=1</code>çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå‘½ä»¤ä¸ä»…æäº¤å½“å‰äº‹åŠ¡ï¼Œè¿˜ä¼šè‡ªåŠ¨å¼€å§‹ä¸€ä¸ªæ–°äº‹åŠ¡ã€‚è¿™å‡å°‘äº†æ¯ä¸ªäº‹åŠ¡å¼€å§‹æ—¶æ‰§è¡Œ<code>BEGIN</code>çš„éœ€æ±‚ï¼ŒåŒæ—¶ä¿æŒäº†äº‹åŠ¡çš„æ˜¾å¼æ§åˆ¶ã€‚</li></ul><blockquote><ol start="4"><li>ç›‘æ§é•¿äº‹åŠ¡</li></ol></blockquote><ul><li><strong>æ£€æµ‹é•¿äº‹åŠ¡</strong>ï¼šå¯ä»¥é€šè¿‡æŸ¥è¯¢<code>information_schema.innodb_trx</code>è¡¨æ¥ç›‘æ§é•¿æ—¶é—´è¿è¡Œçš„äº‹åŠ¡ã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥æ‰¾è¿è¡Œæ—¶é—´è¶…è¿‡60ç§’çš„äº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼ä»¥ä¸‹çš„æŸ¥è¯¢è¯­å¥ï¼š<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> information_schema.innodb_trx <br><span class="hljs-keyword">WHERE</span> TIME_TO_SEC(TIMEDIFF(NOW(), trx_started)) &gt; <span class="hljs-number">60</span>;<br></code></pre></td></tr></table></figure>  è¿™å¯¹äºè¯†åˆ«å¯èƒ½å½±å“æ•°æ®åº“æ€§èƒ½çš„é•¿äº‹åŠ¡éå¸¸æœ‰ç”¨ã€‚</li></ul><p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥æ›´æœ‰æ•ˆåœ°ç®¡ç†MySQLäº‹åŠ¡ï¼Œé¿å…å› è¯¯ç”¨æˆ–ä¸å½“çš„äº‹åŠ¡ç®¡ç†å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚</p><p>æ˜ç¡®çš„äº‹åŠ¡ç•Œå®šï¼Œç»“åˆå¯¹é•¿äº‹åŠ¡çš„ç›‘æ§ï¼Œæœ‰åŠ©äºç»´æŒæ•°æ®åº“çš„å¥åº·çŠ¶æ€å’Œé«˜æ•ˆæ€§èƒ½ã€‚</p><hr><blockquote><p>é—®é¢˜ï¼šä½œä¸ºä¸šåŠ¡å¼€å‘è´Ÿè´£äººå…¼æ•°æ®åº“è´Ÿè´£äººï¼Œå¦‚ä½•é¿å…é•¿äº‹åŠ¡çš„å‡ºç°å¹¶å¦¥å–„å¤„ç†è¿™ç§æƒ…å†µã€‚</p></blockquote><p>é•¿äº‹åŠ¡å¯èƒ½å¯¼è‡´å¤šç§æ€§èƒ½é—®é¢˜ï¼Œå¦‚é”äº‰ç”¨ã€äº‹åŠ¡æ—¥å¿—è†¨èƒ€ã€ä¸»ä»å»¶è¿Ÿç­‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰æ•ˆçš„ç­–ç•¥å’Œæœ€ä½³å®è·µï¼š</p><ul><li><ol><li>æ•™è‚²å’ŒåŸ¹è®­</li></ol></li><li><ol start="2"><li>ä»£ç å®¡æŸ¥</li></ol></li><li><ol start="3"><li>ç›‘æ§å’ŒæŠ¥è­¦</li></ol></li><li><ol start="4"><li>æ€§èƒ½åˆ†æ</li></ol></li><li><ol start="5"><li>ä¼˜åŒ–äº‹åŠ¡ç®¡ç†</li></ol></li><li><ol start="6"><li>åº”ç”¨æ¶æ„è®¾è®¡</li></ol></li><li><ol start="7"><li>æµ‹è¯•å’Œä»¿çœŸ</li></ol></li><li><ol start="8"><li>ç¯å¢ƒç®¡ç†</li></ol></li></ul><blockquote><ol start="3"><li>ç›‘æ§å’ŒæŠ¥è­¦</li></ol></blockquote><ul><li><strong>äº‹åŠ¡æŒç»­æ—¶é—´ç›‘æ§</strong>ï¼šç›‘æ§äº‹åŠ¡çš„æŒç»­æ—¶é—´ï¼Œä½¿ç”¨å¦‚<code>information_schema.innodb_trx</code>çš„æŸ¥è¯¢æ¥è¯†åˆ«é•¿äº‹åŠ¡ã€‚</li><li><strong>å®æ—¶æŠ¥è­¦ç³»ç»Ÿ</strong>ï¼šå®ç°å®æ—¶æŠ¥è­¦ç³»ç»Ÿï¼Œå½“äº‹åŠ¡è¶…è¿‡é¢„è®¾é˜ˆå€¼æ—¶å‘å‡ºè­¦å‘Šã€‚</li></ul><blockquote><ol start="4"><li>æ€§èƒ½åˆ†æ</li></ol></blockquote><ul><li><strong>åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—</strong>ï¼šå®šæœŸæ£€æŸ¥æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ‰¾å‡ºå¯èƒ½å¯¼è‡´é•¿äº‹åŠ¡çš„æ…¢SQLè¯­å¥ã€‚</li><li><strong>ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·</strong>ï¼šä½¿ç”¨å¦‚MySQL Workbenchç­‰å·¥å…·åˆ†ææ•°æ®åº“æ€§èƒ½ï¼Œå¯»æ‰¾ä¼˜åŒ–ç‚¹ã€‚</li></ul><blockquote><ol start="5"><li>ä¼˜åŒ–äº‹åŠ¡ç®¡ç†</li></ol></blockquote><ul><li><strong>çŸ­äº‹åŠ¡åŸåˆ™</strong>ï¼šé¼“åŠ±ä½¿ç”¨çŸ­äº‹åŠ¡åŸåˆ™ï¼Œå°½é‡å‡å°‘äº‹åŠ¡çš„ä½œç”¨èŒƒå›´å’ŒæŒç»­æ—¶é—´ã€‚</li><li><strong>é¿å…ä¸å¿…è¦çš„äº‹åŠ¡</strong>ï¼šæœ‰äº›è¯»å–æ“ä½œå¯èƒ½ä¸éœ€è¦äº‹åŠ¡ï¼Œç‰¹åˆ«æ˜¯åœ¨åªè¯»æ“ä½œä¸­ã€‚</li></ul><h3 id="4ã€æ•°æ®åº“ç´¢å¼•-ğŸ±"><a href="#4ã€æ•°æ®åº“ç´¢å¼•-ğŸ±" class="headerlink" title="4ã€æ•°æ®åº“ç´¢å¼•   ğŸ±"></a>4ã€æ•°æ®åº“ç´¢å¼•   ğŸ±</h3><p>åœ¨MySQLä¸­ï¼Œæ•°æ®åº“ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œå®ƒä»¬å¸®åŠ©æ•°æ®åº“å¿«é€Ÿé«˜æ•ˆåœ°å®šä½å’Œæ£€ç´¢æ•°æ®ã€‚</p><p>ä½ å¯ä»¥å°†ç´¢å¼•ç±»æ¯”ä¸ºå›¾ä¹¦çš„ç›®å½•ï¼šå°±åƒç›®å½•ä½¿ä½ èƒ½å¤Ÿå¿«é€Ÿæ‰¾åˆ°ä½ æƒ³è¦é˜…è¯»çš„ç« èŠ‚ï¼Œæ•°æ®åº“ç´¢å¼•å…è®¸æ•°æ®åº“å¿«é€Ÿæ‰¾åˆ°å­˜å‚¨åœ¨æ•°æ®è¡¨ä¸­çš„ç‰¹å®šæ•°æ®ï¼Œè€Œä¸å¿…æ‰«ææ•´ä¸ªè¡¨ã€‚</p><blockquote><p>ç´¢å¼•çš„ç±»å‹</p></blockquote><p>æŒ‰æ•°æ®ç»“æ„åˆ†ç±»å¯åˆ†ä¸ºï¼šB+treeç´¢å¼•ã€Hashç´¢å¼•ã€Full-textç´¢å¼•ã€‚<br>æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»å¯åˆ†ä¸ºï¼šèšç°‡ç´¢å¼•ã€äºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰ã€‚<br>æŒ‰å­—æ®µç‰¹æ€§åˆ†ç±»å¯åˆ†ä¸ºï¼šä¸»é”®ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€‚<br>æŒ‰å­—æ®µä¸ªæ•°åˆ†ç±»å¯åˆ†ä¸ºï¼šå•åˆ—ç´¢å¼•ã€è”åˆç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ã€ç»„åˆç´¢å¼•ï¼‰ã€‚</p><h4 id="ç´¢å¼•-B-æ ‘"><a href="#ç´¢å¼•-B-æ ‘" class="headerlink" title="ç´¢å¼•(B+æ ‘)"></a>ç´¢å¼•(B+æ ‘)</h4><blockquote><p>B+ Tree åŸç†</p></blockquote><p>å‚è€ƒï¼š </p><ul><li><a href="https://www.pdai.tech/md/db/sql-mysql/sql-mysql-b-tree.html">https://www.pdai.tech/md/db/sql-mysql/sql-mysql-b-tree.html</a></li><li><a href="https://www.yuque.com/snailclimb/mf2z3k/wghadf">https://www.yuque.com/snailclimb/mf2z3k/wghadf</a></li></ul><p>ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨ B+ æ ‘</p><p>å¼•å…¥å„ç§æ ‘è§£å†³çš„é—®é¢˜ä»¥åŠé¢ä¸´çš„æ–°é—®é¢˜</p><ul><li>äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBST)<ul><li>ä¸å¹³è¡¡</li><li>äºŒå‰æŸ¥æ‰¾æ ‘çš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯ O(lgn)ï¼›ä½†æ˜¯åœ¨æç«¯æƒ…å†µä¸‹ï¼ŒBSTä¼šé€€åŒ–ä¸ºé“¾è¡¨ï¼Œæ­¤æ—¶æ—¶é—´å¤æ‚åº¦ä¸º O(n)</li></ul></li><li>å¹³è¡¡äºŒå‰æ ‘ï¼ˆAVL)<ul><li>æ—‹è½¬è€—æ—¶</li><li>åˆ é™¤çš„ä¸€ä¸ªè€—æ—¶æ•ˆç‡è¾ƒä½ï¼Œæ¯”èµ·ä½¿ç”¨çš„å¥½å¤„è€Œè¨€ï¼Œç»¼åˆä½¿ç”¨å¹¶ä¸å¹¿æ³›</li></ul></li><li>çº¢é»‘æ ‘<ul><li>æ ‘å¤ªé«˜</li><li>çº¢é»‘æ ‘åœ¨å†…å­˜çš„è¡¨ç°ä¼˜å¼‚ï¼›ä½†æ˜¯åœ¨çœŸæ­£å­˜å‚¨åœ¨ç£ç›˜çš„æ—¶å€™ï¼Œè€ƒè™‘çš„åé‡æ˜¯éœ€è¦å‡å°‘IOæ¬¡æ•°</li></ul></li><li>Bæ ‘<ul><li>ä¸ºç£ç›˜è€Œç”Ÿ</li><li>å°†äºŒå‰æ ‘æ”¹ä¸ºäº†å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘</li></ul></li><li>B+ æ ‘<ul><li>åœ¨ B æ ‘çš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥é™ä½äº†æ ‘çš„é«˜åº¦ï¼Œéƒ¨åˆ†æ”¹é€ ï¼Œä½¿å¾—èŒƒå›´æŸ¥è¯¢æ›´åŠ é«˜æ•ˆã€‚</li></ul></li></ul><h3 id="5ã€é”æœºåˆ¶"><a href="#5ã€é”æœºåˆ¶" class="headerlink" title="5ã€é”æœºåˆ¶"></a>5ã€é”æœºåˆ¶</h3><p>MySQLçš„é”æœºåˆ¶æ˜¯ä¸€ç§ç”¨æ¥ç®¡ç†å¤šä¸ªäº‹åŠ¡å¯¹åŒä¸€æ•°æ®è¿›è¡Œè®¿é—®çš„æœºåˆ¶ï¼Œæ—¨åœ¨ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚</p><p>é”æœºåˆ¶å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è¯»å†™æ•°æ®åº“ï¼ŒåŒæ—¶é˜²æ­¢æ•°æ®å†²çªå’Œä¸ä¸€è‡´ã€‚ï¼ˆé”æ˜¯ä¸€ç§å¸¸è§çš„å¹¶å‘äº‹åŠ¡çš„æ§åˆ¶æ–¹å¼ï¼‰</p><p>MySQLä¸­çš„é”ä¸»è¦å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li>è¡¨çº§é”ï¼ˆTable-level Locksï¼‰</li><li>è¡Œçº§é”ï¼ˆRow-level Locksï¼‰</li><li>é¡µé¢é”ï¼ˆPage-level Locksï¼‰</li><li>å…±äº«é”å’Œæ’ä»–é”</li><li>æ„å‘é”ï¼ˆIntention Locksï¼‰</li><li>æ­»é”ï¼ˆDeadlocksï¼‰</li></ul><blockquote><ol><li>è¡¨çº§é”ï¼ˆTable-level Locksï¼‰</li></ol></blockquote><ul><li><strong>ç®€å•ä½†å¼€é”€å°</strong>ï¼šé”å®šæ•´ä¸ªè¡¨ï¼Œæ˜¯æœ€ç®€å•çš„é”ç­–ç•¥ï¼Œå¼€é”€æœ€å°ã€‚</li><li><strong>å¹¶å‘æ€§ä½</strong>ï¼šä¸é€‚åˆé«˜å¹¶å‘æ“ä½œï¼Œå› ä¸ºå®ƒé˜»æ­¢äº†å¯¹åŒä¸€è¡¨çš„å…¶ä»–è®¿é—®ã€‚</li><li><strong>åº”ç”¨</strong>ï¼šMyISAMå­˜å‚¨å¼•æ“ä¸»è¦ä½¿ç”¨è¡¨çº§é”ã€‚</li></ul><blockquote><ol start="2"><li>è¡Œçº§é”ï¼ˆRow-level Locksï¼‰</li></ol></blockquote><ul><li><strong>é«˜å¹¶å‘å¤„ç†</strong>ï¼šåªé”å®šéœ€è¦è®¿é—®çš„æ•°æ®è¡Œã€‚æ˜¯æœ€ç»†ç²’åº¦çš„é”ï¼Œå…è®¸é«˜åº¦çš„å¹¶å‘ã€‚</li><li><strong>å¼€é”€å¤§</strong>ï¼šæ¯”è¡¨çº§é”æ›´å¤šçš„å†…å­˜å’ŒCPUèµ„æºã€‚</li><li><strong>æ­»é”</strong>ï¼šå¯èƒ½ä¼šå¼•èµ·æ­»é”ï¼Œéœ€è¦é¢å¤–çš„é€»è¾‘æ¥å¤„ç†ã€‚</li><li><strong>åº”ç”¨</strong>ï¼šInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨è¡Œçº§é”ã€‚</li></ul><blockquote><ol start="3"><li>é¡µé¢é”ï¼ˆPage-level Locksï¼‰</li></ol></blockquote><ul><li><strong>ä¸­é—´ç²’åº¦</strong>ï¼šé”å®šå†…å­˜ä¸­çš„é¡µé¢ï¼Œä»‹äºè¡¨çº§é”å’Œè¡Œçº§é”ä¹‹é—´ã€‚</li><li><strong>å¹¶å‘å’Œèµ„æº</strong>ï¼šå¹³è¡¡äº†å¹¶å‘æ€§å’Œèµ„æºå¼€é”€ã€‚</li><li><strong>åº”ç”¨</strong>ï¼šä¸€äº›å­˜å‚¨å¼•æ“å¦‚BerkeleyDBä½¿ç”¨é¡µé¢é”ã€‚</li></ul><blockquote><ol start="4"><li>å…±äº«é”å’Œæ’ä»–é”</li></ol></blockquote><ul><li><strong>å…±äº«é”ï¼ˆShared Locksï¼‰</strong>ï¼šåˆç§°è¯»é”ï¼Œå…è®¸äº‹åŠ¡è¯»ä¸€è¡Œæ•°æ®ã€‚<ul><li>è¯»é”ï¼Œäº‹åŠ¡åœ¨è¯»å–è®°å½•çš„æ—¶å€™è·å–å…±äº«é”ï¼Œå…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ï¼ˆé”å…¼å®¹ï¼‰ã€‚</li></ul></li><li><strong>æ’ä»–é”ï¼ˆExclusive Locksï¼‰</strong>ï¼šåˆç§°å†™é”ï¼Œå…è®¸äº‹åŠ¡æ’ä»–åœ°å†™ä¸€è¡Œæ•°æ®ã€‚<ul><li>åˆç§°å†™é”&#x2F;ç‹¬å é”ï¼Œäº‹åŠ¡åœ¨ä¿®æ”¹è®°å½•çš„æ—¶å€™è·å–æ’ä»–é”ï¼Œä¸å…è®¸å¤šä¸ªäº‹åŠ¡åŒæ—¶è·å–ã€‚å¦‚æœä¸€ä¸ªè®°å½•å·²ç»è¢«åŠ äº†æ’ä»–é”ï¼Œé‚£å…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹è¿™æ¡äº‹åŠ¡åŠ ä»»ä½•ç±»å‹çš„é”ï¼ˆé”ä¸å…¼å®¹ï¼‰ã€‚</li><li>æ’ä»–é”ä¸ä»»ä½•çš„é”éƒ½ä¸å…¼å®¹ï¼Œå…±äº«é”ä»…å’Œå…±äº«é”å…¼å®¹ã€‚</li></ul></li></ul><blockquote><ol start="5"><li>æ„å‘é”ï¼ˆIntention Locksï¼‰</li></ol></blockquote><ul><li><strong>å±‚çº§é”ç³»ç»Ÿ</strong>ï¼šç”¨äºæ”¯æŒè¡¨çº§é”å’Œè¡Œçº§é”çš„å…¼å®¹ã€‚</li><li><strong>ç±»å‹</strong>ï¼šåŒ…æ‹¬æ„å‘å…±äº«é”å’Œæ„å‘æ’ä»–é”ã€‚</li></ul><blockquote><ol start="6"><li>æ­»é”ï¼ˆDeadlocksï¼‰</li></ol></blockquote><ul><li><strong>é—®é¢˜</strong>ï¼šå½“å¤šä¸ªäº‹åŠ¡ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”æ—¶å‘ç”Ÿã€‚</li><li><strong>è§£å†³</strong>ï¼šMySQLä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è§£å†³æ­»é”ï¼Œé€šå¸¸æ˜¯é€šè¿‡å›æ»šä¸€ä¸ªäº‹åŠ¡æ¥è§£é”ã€‚</li></ul><p><strong>é”ç­–ç•¥çš„é€‰æ‹©</strong></p><ul><li>ä¸åŒçš„å­˜å‚¨å¼•æ“æ”¯æŒä¸åŒçš„é”ç­–ç•¥ã€‚ä¾‹å¦‚ï¼ŒInnoDBæ”¯æŒè¡Œçº§é”å’Œè¡¨çº§é”ï¼Œè€ŒMyISAMä¸»è¦ä½¿ç”¨è¡¨çº§é”ã€‚</li><li>é”çš„é€‰æ‹©å–å†³äºå¤šç§å› ç´ ï¼ŒåŒ…æ‹¬äº‹åŠ¡çš„ç±»å‹ã€å¹¶å‘çº§åˆ«ã€æ•°æ®è¡¨çš„å¤§å°ç­‰ã€‚</li></ul><p>é”æœºåˆ¶çš„å®é™…åº”ç”¨</p><ul><li>åœ¨é«˜å¹¶å‘çš„æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œé€‚å½“çš„é”ç­–ç•¥å¯¹äºç»´æŠ¤æ•°æ®çš„å®Œæ•´æ€§å’Œæé«˜ç³»ç»Ÿæ€§èƒ½è‡³å…³é‡è¦ã€‚</li><li>ç†è§£ä¸åŒé”çš„è¡Œä¸ºå’Œå½±å“å¯ä»¥å¸®åŠ©æ•°æ®åº“ç®¡ç†å‘˜å’Œå¼€å‘äººå‘˜ä¼˜åŒ–æŸ¥è¯¢ï¼Œå‡å°‘æ­»é”ï¼Œå¹¶æé«˜æ•°æ®åº“çš„æ•´ä½“æ€§èƒ½ã€‚</li></ul><p>å‚è€ƒ <a href="https://javaguide.cn/database/mysql/mysql-questions-01.html#mysql-%E9%94%81">https://javaguide.cn/database/mysql/mysql-questions-01.html#mysql-%E9%94%81</a></p><h4 id="è¡¨çº§é”å’Œè¡Œçº§é”"><a href="#è¡¨çº§é”å’Œè¡Œçº§é”" class="headerlink" title="è¡¨çº§é”å’Œè¡Œçº§é”"></a>è¡¨çº§é”å’Œè¡Œçº§é”</h4><p>æ¦‚å¿µï¼š</p><blockquote><ol><li>è¡¨çº§é”ï¼ˆTable-level Locksï¼‰</li></ol></blockquote><ul><li><strong>ç®€å•ä½†å¼€é”€å°</strong>ï¼šé”å®šæ•´ä¸ªè¡¨ï¼Œæ˜¯æœ€ç®€å•çš„é”ç­–ç•¥ï¼Œå¼€é”€æœ€å°ã€‚</li><li><strong>å¹¶å‘æ€§ä½</strong>ï¼šä¸é€‚åˆé«˜å¹¶å‘æ“ä½œï¼Œå› ä¸ºå®ƒé˜»æ­¢äº†å¯¹åŒä¸€è¡¨çš„å…¶ä»–è®¿é—®ã€‚</li><li><strong>åº”ç”¨</strong>ï¼šMyISAMå­˜å‚¨å¼•æ“ä¸»è¦ä½¿ç”¨è¡¨çº§é”ã€‚</li></ul><blockquote><ol start="2"><li>è¡Œçº§é”ï¼ˆRow-level Locksï¼‰</li></ol></blockquote><ul><li><strong>é«˜å¹¶å‘å¤„ç†</strong>ï¼šåªé”å®šéœ€è¦è®¿é—®çš„æ•°æ®è¡Œã€‚æ˜¯æœ€ç»†ç²’åº¦çš„é”ï¼Œå…è®¸é«˜åº¦çš„å¹¶å‘ã€‚</li><li><strong>å¼€é”€å¤§</strong>ï¼šæ¯”è¡¨çº§é”æ›´å¤šçš„å†…å­˜å’ŒCPUèµ„æºã€‚</li><li><strong>æ­»é”</strong>ï¼šå¯èƒ½ä¼šå¼•èµ·æ­»é”ï¼Œéœ€è¦é¢å¤–çš„é€»è¾‘æ¥å¤„ç†ã€‚</li><li><strong>åº”ç”¨</strong>ï¼šInnoDBå­˜å‚¨å¼•æ“ä½¿ç”¨è¡Œçº§é”ã€‚</li></ul><p>åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼ŒMySQL ç›®å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“ InnoDB ä¸­ï¼Œé»˜è®¤ä¸ºè¡Œçº§é”ï¼ŒåŒæ—¶ InnoDB ä¹Ÿæ”¯æŒè¡¨çº§é”ã€‚</p><p>ä¸ä¹‹å¯¹åº”çš„ MyISAM å­˜å‚¨å¼•æ“ï¼Œå®ƒåªæ”¯æŒè¡¨çº§é”ï¼ˆtable-level lockingï¼‰ï¼Œä¸€é”å°±é”æ•´å¼ è¡¨ã€‚</p><p>è¡Œçº§é”çš„ç²’åº¦æ›´å°ï¼Œä»…å¯¹ç›¸å…³çš„è®°å½•ä¸Šé”å³å¯ï¼ˆå¯¹ä¸€è¡Œæˆ–è€…å¤šè¡Œè®°å½•åŠ é”ï¼‰ï¼Œæ‰€ä»¥å¯¹äºå¹¶å‘å†™å…¥æ“ä½œæ¥è¯´ï¼Œ InnoDB çš„æ€§èƒ½æ›´é«˜ã€‚</p><p><strong>è¡¨çº§é”å’Œè¡Œçº§é”å¯¹æ¯”</strong>ï¼š</p><ul><li><strong>è¡¨çº§é”ï¼š</strong> MySQL ä¸­é”å®šç²’åº¦æœ€å¤§çš„ä¸€ç§é”ï¼ˆå…¨å±€é”é™¤å¤–ï¼‰ï¼Œæ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œå¯¹å½“å‰æ“ä½œçš„æ•´å¼ è¡¨åŠ é”ï¼Œå®ç°ç®€å•ï¼Œèµ„æºæ¶ˆè€—ä¹Ÿæ¯”è¾ƒå°‘ï¼ŒåŠ é”å¿«ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚ä¸è¿‡ï¼Œè§¦å‘é”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œé«˜å¹¶å‘ä¸‹æ•ˆç‡æä½ã€‚è¡¨çº§é”å’Œå­˜å‚¨å¼•æ“æ— å…³ï¼ŒMyISAM å’Œ InnoDB å¼•æ“éƒ½æ”¯æŒè¡¨çº§é”ã€‚</li><li><strong>è¡Œçº§é”ï¼š</strong> MySQL ä¸­é”å®šç²’åº¦æœ€å°çš„ä¸€ç§é”ï¼Œæ˜¯ <strong>é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é”</strong> ï¼Œåªé’ˆå¯¹å½“å‰æ“ä½œçš„è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚ è¡Œçº§é”èƒ½å¤§å¤§å‡å°‘æ•°æ®åº“æ“ä½œçš„å†²çªã€‚å…¶åŠ é”ç²’åº¦æœ€å°ï¼Œå¹¶å‘åº¦é«˜ï¼Œä½†åŠ é”çš„å¼€é”€ä¹Ÿæœ€å¤§ï¼ŒåŠ é”æ…¢ï¼Œä¼šå‡ºç°æ­»é”ã€‚è¡Œçº§é”å’Œå­˜å‚¨å¼•æ“æœ‰å…³ï¼Œæ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚é¢å®ç°çš„ã€‚</li></ul><blockquote><p>è¡Œçº§é”çš„ä½¿ç”¨æœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹ï¼Ÿ</p></blockquote><p>InnoDB çš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•å­—æ®µåŠ çš„é”ï¼Œè¡¨çº§é”æ˜¯é’ˆå¯¹éç´¢å¼•å­—æ®µåŠ çš„é”ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ <code>UPDATE</code>ã€<code>DELETE</code> è¯­å¥æ—¶ï¼Œå¦‚æœ <code>WHERE</code>æ¡ä»¶ä¸­å­—æ®µæ²¡æœ‰å‘½ä¸­å”¯ä¸€ç´¢å¼•æˆ–è€…ç´¢å¼•å¤±æ•ˆçš„è¯ï¼Œå°±ä¼šå¯¼è‡´æ‰«æå…¨è¡¨å¯¹è¡¨ä¸­çš„æ‰€æœ‰è¡Œè®°å½•è¿›è¡ŒåŠ é”ã€‚è¿™ä¸ªåœ¨æˆ‘ä»¬æ—¥å¸¸å·¥ä½œå¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°ï¼Œä¸€å®šè¦å¤šå¤šæ³¨æ„ï¼ï¼ï¼</p><p>ä¸è¿‡ï¼Œå¾ˆå¤šæ—¶å€™å³ä½¿ç”¨äº†ç´¢å¼•ä¹Ÿæœ‰å¯èƒ½ä¼šèµ°å…¨è¡¨æ‰«æï¼Œè¿™æ˜¯å› ä¸º MySQL ä¼˜åŒ–å™¨çš„åŸå› </p><h4 id="è¡Œé”åˆ†ç±»"><a href="#è¡Œé”åˆ†ç±»" class="headerlink" title="è¡Œé”åˆ†ç±»"></a>è¡Œé”åˆ†ç±»</h4><blockquote><p>InnoDB æœ‰å“ªå‡ ç±»è¡Œé”</p></blockquote><p>InnoDB è¡Œé”æ˜¯é€šè¿‡å¯¹ç´¢å¼•æ•°æ®é¡µä¸Šçš„è®°å½•åŠ é”å®ç°çš„ï¼ŒMySQL InnoDB æ”¯æŒä¸‰ç§è¡Œé”å®šæ–¹å¼ï¼š</p><ul><li><strong>è®°å½•é”ï¼ˆRecord Lockï¼‰</strong>ï¼šä¹Ÿè¢«ç§°ä¸ºè®°å½•é”ï¼Œå±äºå•ä¸ªè¡Œè®°å½•ä¸Šçš„é”ã€‚</li><li><strong>é—´éš™é”ï¼ˆGap Lockï¼‰</strong>ï¼šé”å®šä¸€ä¸ªèŒƒå›´ï¼Œä¸åŒ…æ‹¬è®°å½•æœ¬èº«ã€‚</li><li><strong>ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰</strong>ï¼šRecord Lock+Gap Lockï¼Œé”å®šä¸€ä¸ªèŒƒå›´ï¼ŒåŒ…å«è®°å½•æœ¬èº«ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³å¹»è¯»é—®é¢˜ï¼ˆMySQL äº‹åŠ¡éƒ¨åˆ†æåˆ°è¿‡ï¼‰ã€‚è®°å½•é”åªèƒ½é”ä½å·²ç»å­˜åœ¨çš„è®°å½•ï¼Œä¸ºäº†é¿å…æ’å…¥æ–°è®°å½•ï¼Œéœ€è¦ä¾èµ–é—´éš™é”ã€‚</li></ul><p><strong>åœ¨ InnoDB é»˜è®¤çš„éš”ç¦»çº§åˆ« REPEATABLE-READ ä¸‹ï¼Œè¡Œé”é»˜è®¤ä½¿ç”¨çš„æ˜¯ Next-Key Lockã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œçš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•æˆ–ä¸»é”®ï¼ŒInnoDB ä¼šå¯¹ Next-Key Lock è¿›è¡Œä¼˜åŒ–ï¼Œå°†å…¶é™çº§ä¸º Record Lockï¼Œå³ä»…é”ä½ç´¢å¼•æœ¬èº«ï¼Œè€Œä¸æ˜¯èŒƒå›´ã€‚</strong></p><p>ä¸€äº›å¤§å‚é¢è¯•ä¸­å¯èƒ½ä¼šé—®åˆ° Next-Key Lock çš„åŠ é”èŒƒå›´ï¼š <a href="https://segmentfault.com/a/1190000040129107">https://segmentfault.com/a/1190000040129107</a></p><hr><h4 id="æ„å‘é”"><a href="#æ„å‘é”" class="headerlink" title="æ„å‘é”"></a>æ„å‘é”</h4><p>ä½œç”¨ï¼š é€šè¿‡æ„å‘é”æ¥å¿«é€Ÿåˆ¤æ–­æ˜¯å¦å¯ä»¥å¯¹æŸä¸ªè¡¨ä½¿ç”¨è¡¨é”ã€‚</p><p>æ„å‘é”æ˜¯è¡¨çº§é”ï¼Œå…±æœ‰ä¸¤ç§ï¼š</p><ul><li><strong>æ„å‘å…±äº«é”ï¼ˆIntention Shared Lockï¼ŒIS é”ï¼‰</strong>ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ å…±äº«é”ï¼ˆS é”ï¼‰ï¼ŒåŠ å…±äº«é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IS é”ã€‚</li><li><strong>æ„å‘æ’ä»–é”ï¼ˆIntention Exclusive Lockï¼ŒIX é”ï¼‰</strong>ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è®°å½•åŠ æ’ä»–é”ï¼ˆX é”ï¼‰ï¼ŒåŠ æ’ä»–é”ä¹‹å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ IX é”ã€‚</li></ul><p><strong>æ„å‘é”æ˜¯ç”±æ•°æ®å¼•æ“è‡ªå·±ç»´æŠ¤çš„ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº«&#x2F;æ’ä»–é”ä¹‹å‰ï¼ŒInooDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œæ‰€åœ¨åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”ã€‚</strong></p><p>æ„å‘é”ä¹‹é—´æ˜¯äº’ç›¸å…¼å®¹çš„ã€‚</p><table><thead><tr><th></th><th>IS é”</th><th>IX é”</th></tr></thead><tbody><tr><td>IS é”</td><td>å…¼å®¹</td><td>å…¼å®¹</td></tr><tr><td>IX é”</td><td>å…¼å®¹</td><td>å…¼å®¹</td></tr></tbody></table><p>æ„å‘é”å’Œå…±äº«é”å’Œæ’å®ƒé”äº’æ–¥ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯è¡¨çº§åˆ«çš„å…±äº«é”å’Œæ’ä»–é”ï¼Œæ„å‘é”ä¸ä¼šä¸è¡Œçº§çš„å…±äº«é”å’Œæ’ä»–é”äº’æ–¥ï¼‰ã€‚</p><table><thead><tr><th></th><th>IS é”</th><th>IX é”</th></tr></thead><tbody><tr><td>S é”</td><td>å…¼å®¹</td><td>äº’æ–¥</td></tr><tr><td>X é”</td><td>äº’æ–¥</td><td>äº’æ–¥</td></tr></tbody></table><hr><p>å†çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™ä¸ªè§£é‡Šï¼š</p><p>æ„å‘é”æ˜¯ InnoDB å¼•æ“ç”¨æ¥ä¼˜åŒ–è¡Œé”å’Œè¡¨é”ä¹‹é—´æ“ä½œçš„ä¸€ç§é”æœºåˆ¶ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†åœ¨æ•°æ®åº“ä¸­å®ç°å¤šç²’åº¦é”å®šï¼ˆå³åŒæ—¶ä½¿ç”¨è¡Œé”å’Œè¡¨é”ï¼‰ï¼Œå¹¶ä¸”èƒ½å¤Ÿæä¾›ä¸€ç§æœºåˆ¶æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥å®‰å…¨åœ°å¯¹æ•´ä¸ªè¡¨åŠ é”ã€‚æ„å‘é”æ˜¯è¡¨çº§é”ï¼Œä½†å®ƒæ˜¯ç”¨æ¥è¡¨æ˜äº‹åŠ¡åœ¨æ¥ä¸‹æ¥çš„æ“ä½œä¸­ï¼Œå¯¹è¡¨ä¸­è¡Œè®°å½•æ‰€è®¡åˆ’ä½¿ç”¨çš„é”ç±»å‹ï¼ˆå…±äº«æˆ–æ’ä»–ï¼‰ã€‚</p><blockquote><p>æ„å‘é”çš„ä½œç”¨</p></blockquote><ul><li><strong>å¿«é€Ÿåˆ¤æ–­è¡¨é”å…¼å®¹æ€§</strong>ï¼šæ„å‘é”è®©æ•°æ®åº“å¿«é€ŸçŸ¥é“æ˜¯å¦å¯ä»¥ä¸æ£€æŸ¥æ¯ä¸€è¡Œè€Œå¯¹æ•´ä¸ªè¡¨åŠ é”ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡å·²ç»å¯¹æŸè¡ŒåŠ äº†æ’ä»–é”ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸èƒ½å¯¹æ•´ä¸ªè¡¨åŠ å…±äº«é”ï¼Œå› ä¸ºå­˜åœ¨ä¸å…¼å®¹çš„è¡Œé”ã€‚</li><li><strong>é¿å…æ­»é”</strong>ï¼šé€šè¿‡å…ˆè·å–æ„å‘é”å†è·å–å…·ä½“çš„è¡Œé”ï¼Œå¯ä»¥å‡å°‘æ­»é”çš„å¯èƒ½æ€§ã€‚</li></ul><blockquote><p>æ„å‘é”çš„ç±»å‹</p></blockquote><ul><li><strong>æ„å‘å…±äº«é”ï¼ˆISé”ï¼‰</strong>ï¼šè¡¨æ˜äº‹åŠ¡æ‰“ç®—å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ å…±äº«é”ã€‚åœ¨åŠ å…±äº«é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ISé”ã€‚</li><li><strong>æ„å‘æ’ä»–é”ï¼ˆIXé”ï¼‰</strong>ï¼šè¡¨æ˜äº‹åŠ¡æ‰“ç®—å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ æ’ä»–é”ã€‚åœ¨åŠ æ’ä»–é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„IXé”ã€‚</li></ul><blockquote><p>å·¥ä½œåŸç†</p></blockquote><p>å½“äº‹åŠ¡æƒ³è¦å¯¹æŸä¸ªæ•°æ®è¡Œè¿›è¡Œæ“ä½œï¼ˆè¯»å–æˆ–ä¿®æ”¹ï¼‰æ—¶ï¼Œå®ƒä¼šæ ¹æ®æ“ä½œç±»å‹ï¼ˆæ˜¯å¦ä¼šä¿®æ”¹æ•°æ®ï¼‰å°è¯•åœ¨è¯¥è¡Œä¸ŠåŠ å…±äº«é”æˆ–æ’ä»–é”ã€‚ä½†åœ¨æ­¤ä¹‹å‰ï¼Œäº‹åŠ¡å¿…é¡»å…ˆåœ¨æ•´ä¸ªè¡¨ä¸Šè·å–å¯¹åº”çš„æ„å‘é”ï¼ˆISæˆ–IXï¼‰ã€‚è¿™æ ·ï¼Œå½“å¦ä¸€ä¸ªäº‹åŠ¡å°è¯•å¯¹æ•´ä¸ªè¡¨åŠ é”æ—¶ï¼Œå®ƒå¯ä»¥é€šè¿‡æ£€æŸ¥è¡¨ä¸Šçš„æ„å‘é”æ¥å¿«é€Ÿç¡®å®šæ˜¯å¦å­˜åœ¨è¡Œçº§é”å†²çªï¼Œè€Œä¸å¿…æ£€æŸ¥è¡¨ä¸­æ¯ä¸€è¡Œçš„é”çŠ¶æ€ã€‚</p><blockquote><p>ç”¨æˆ·é€æ˜</p></blockquote><p>å¯¹äºæ•°æ®åº“çš„ä½¿ç”¨è€…è€Œè¨€ï¼Œæ„å‘é”æ˜¯å®Œå…¨é€æ˜çš„ï¼Œå³ç”¨æˆ·æ— éœ€æ‰‹åŠ¨ç®¡ç†æ„å‘é”ã€‚InnoDB å­˜å‚¨å¼•æ“ä¼šè‡ªåŠ¨ç®¡ç†æ„å‘é”çš„è·å–å’Œé‡Šæ”¾ï¼Œä»¥ç¡®ä¿æ•°æ®åº“æ“ä½œçš„ä¸€è‡´æ€§å’Œå¹¶å‘æ€§ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œæ„å‘é”æ˜¯ä¸€ç§è¡¨çº§é”ï¼Œç”¨äºå£°æ˜äº‹åŠ¡å¯¹è¡¨ä¸­è¡Œè®°å½•çš„åŠ é”æ„å›¾ï¼Œå®ƒä½¿å¾—æ•°æ®åº“èƒ½å¤Ÿåœ¨ä¿æŒé«˜å¹¶å‘çš„åŒæ—¶ï¼Œæœ‰æ•ˆåœ°ç®¡ç†å’Œè°ƒå’Œè¡Œçº§é”å’Œè¡¨çº§é”ä¹‹é—´çš„å…³ç³»ã€‚</p><h3 id="6ã€explainçš„ä½¿ç”¨"><a href="#6ã€explainçš„ä½¿ç”¨" class="headerlink" title="6ã€explainçš„ä½¿ç”¨"></a>6ã€explainçš„ä½¿ç”¨</h3><p>åœ¨MySQLä¸­ï¼Œ<code>EXPLAIN</code>æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒç”¨äºåˆ†æMySQLå¦‚ä½•æ‰§è¡ŒSQLæŸ¥è¯¢ï¼Œç‰¹åˆ«æ˜¯ç”¨äºä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚</p><p>ä½¿ç”¨<code>EXPLAIN</code>å¯ä»¥å¸®åŠ©ä½ ç†è§£MySQLå¦‚ä½•å¤„ç†ä½ çš„SQLè¯­å¥ï¼ŒåŒ…æ‹¬é€‰æ‹©å“ªäº›ç´¢å¼•ï¼Œå¦‚ä½•è¿æ¥è¡¨ï¼Œä»¥åŠä¼°è®¡çš„è¡Œæ•°ç­‰ã€‚</p><blockquote><p>å¦‚ä½•ä½¿ç”¨EXPLAIN</p></blockquote><p>è¦ä½¿ç”¨<code>EXPLAIN</code>ï¼Œåªéœ€åœ¨ä½ çš„SELECTè¯­å¥ä¹‹å‰åŠ ä¸Šå…³é”®å­—<code>EXPLAIN</code>ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">EXPLAIN</span> <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> your_table <span class="hljs-keyword">WHERE</span> your_column = <span class="hljs-string">&#x27;some_value&#x27;</span>;<br></code></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤ä¼šè¿”å›ä¸€ä¸ªç»“æœé›†ï¼Œå±•ç¤ºäº†MySQLæ‰§è¡Œè¯¥æŸ¥è¯¢çš„è®¡åˆ’ã€‚</p><blockquote><p>EXPLAINè¾“å‡ºçš„å…³é”®åˆ—</p></blockquote><p><code>EXPLAIN</code>çš„è¾“å‡ºåŒ…å«äº†è®¸å¤šåˆ—ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›æœ€é‡è¦çš„åˆ—ï¼š</p><ol><li><strong>id</strong>ï¼šè¡¨ç¤ºSELECTçš„åºåˆ—å·ï¼Œç”¨äºåŒºåˆ†æŸ¥è¯¢ä¸­ä¸åŒéƒ¨åˆ†çš„æ‰§è¡Œé¡ºåºã€‚</li><li><strong>select_type</strong>ï¼šæŸ¥è¯¢çš„ç±»å‹ï¼Œå¦‚SIMPLEï¼ˆç®€å•è¡¨ï¼Œå³ä¸ä½¿ç”¨è¡¨è¿æ¥æˆ–å­æŸ¥è¯¢ï¼‰ï¼ŒPRIMARYï¼ˆä¸»æŸ¥è¯¢ï¼‰ï¼ŒSUBQUERYï¼ˆå­æŸ¥è¯¢ï¼‰ç­‰ã€‚</li><li><strong>table</strong>ï¼šæ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªä¸ªè¡¨çš„ã€‚</li><li><strong>type</strong>ï¼šè¡¨ç¤ºè¿æ¥ç±»å‹ï¼Œæ˜¯ä¼˜åŒ–ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œä»æœ€å¥½åˆ°æœ€å·®ä¾æ¬¡æ˜¯ï¼šsystem &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALLã€‚</li><li><strong>possible_keys</strong>ï¼šæ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸Šçš„ç´¢å¼•ã€‚</li><li><strong>key</strong>ï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</li><li><strong>key_len</strong>ï¼šä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚</li><li><strong>ref</strong>ï¼šæ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ã€‚</li><li><strong>rows</strong>ï¼šMySQLè®¤ä¸ºå¿…é¡»æ£€æŸ¥çš„ç”¨æ¥è¿”å›è¯·æ±‚æ•°æ®çš„è¡Œæ•°ã€‚</li><li><strong>Extra</strong>ï¼šåŒ…å«MySQLè§£å†³æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œâ€œUsing indexâ€è¡¨ç¤ºç›¸åº”çš„SELECTæ“ä½œä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œé¿å…äº†è®¿é—®è¡¨çš„æ•°æ®è¡Œã€‚</li></ol><blockquote><p>ä½¿ç”¨EXPLAINè¿›è¡Œæ€§èƒ½ä¼˜åŒ–</p></blockquote><p>é€šè¿‡åˆ†æ<code>EXPLAIN</code>çš„è¾“å‡ºï¼Œä½ å¯ä»¥è·å¾—å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢çš„çº¿ç´¢ï¼š</p><ul><li><strong>ç¡®ä¿é€‚å½“çš„ç´¢å¼•è¢«ä½¿ç”¨</strong>ï¼šå¦‚æœ<code>key</code>åˆ—æ˜¯NULLï¼Œæˆ–è€…<code>type</code>åˆ—æ˜¾ç¤ºä¸ºALLæˆ–indexï¼Œå¯èƒ½éœ€è¦ä¼˜åŒ–ç´¢å¼•ã€‚</li><li><strong>æ£€æŸ¥è¿æ¥é¡ºåº</strong>ï¼šåœ¨<code>id</code>åˆ—ä¸­ï¼Œè¾ƒå¤§çš„å€¼è¡¨ç¤ºä¼˜å…ˆçº§è¾ƒé«˜çš„è¡¨ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒæ•´æŸ¥è¯¢ç»“æ„æ¥æ”¹å˜è¿æ¥é¡ºåºã€‚</li><li><strong>ä¼˜åŒ–æŸ¥è¯¢ç»“æ„</strong>ï¼šæ ¹æ®<code>Extra</code>åˆ—çš„ä¿¡æ¯ï¼Œä½ å¯èƒ½éœ€è¦è°ƒæ•´æŸ¥è¯¢ç»“æ„ï¼Œå¦‚æ›´æ”¹JOINç±»å‹æˆ–é‡æ–°ç¼–å†™å­æŸ¥è¯¢ã€‚</li></ul><blockquote><p>æ³¨æ„äº‹é¡¹</p></blockquote><ul><li><strong>EXPLAINä¸æ‰§è¡ŒæŸ¥è¯¢</strong>ï¼šå®ƒåªæ˜¾ç¤ºMySQLå¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢ï¼Œå®é™…ä¸Šå¹¶ä¸æ‰§è¡Œè¯¥æŸ¥è¯¢ã€‚</li><li><strong>ä¼°è®¡çš„è¡Œæ•°å¯èƒ½ä¸å‡†ç¡®</strong>ï¼š<code>rows</code>åˆ—æ˜¾ç¤ºçš„æ˜¯ä¼°è®¡çš„è¡Œæ•°ï¼Œè¿™ä¸ªä¼°è®¡å¯èƒ½åŸºäºè¡¨ç»Ÿè®¡æ•°æ®ï¼Œè€Œä¸æ˜¯å®é™…çš„è¡Œæ•°ã€‚</li></ul><p>å¹³æ—¶ç”¨è¿™ä¸ªè¿›è¡Œåˆ†æè¯­å¥çš„æ—¶å€™ï¼Œçœ‹çš„æœ€å¤šçš„ä¸‰ä¸ªå­—æ®µæ˜¯ï¼šselect_typeã€keyã€rows</p><ul><li>select_type : æŸ¥è¯¢ç±»å‹ï¼Œæœ‰ç®€å•æŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰</li><li>key : ä½¿ç”¨çš„ç´¢å¼•</li><li>rows : æ‰«æçš„è¡Œæ•°</li></ul><p>æ€§èƒ½ä¼˜åŒ–æ³¨æ„çš„ç‚¹æ¯”è¾ƒå¤šï¼Œå»ºè®®çœ‹ä¸€ä¸‹è¿™ä¸ªï¼š </p><ul><li><a href="https://www.pdai.tech/md/db/sql-mysql/sql-mysql-performance.html">https://www.pdai.tech/md/db/sql-mysql/sql-mysql-performance.html</a></li></ul><p>æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</p><ul><li>ä¼˜åŒ–æ•°æ®è®¿é—®<ul><li><ol><li>å‡å°‘è¯·æ±‚çš„æ•°æ®é‡</li></ol></li><li><ol start="2"><li>å‡å°‘æœåŠ¡å™¨ç«¯æ‰«æçš„è¡Œæ•°</li></ol></li></ul></li><li>é‡æ„æŸ¥è¯¢æ–¹å¼<ul><li>1.åˆ‡åˆ†å¤§æŸ¥è¯¢</li><li>2.åˆ†è§£å¤§è¿æ¥æŸ¥è¯¢</li></ul></li></ul><blockquote><p>å¤§çº²</p></blockquote><h3 id="7ã€åˆ†åº“åˆ†è¡¨"><a href="#7ã€åˆ†åº“åˆ†è¡¨" class="headerlink" title="7ã€åˆ†åº“åˆ†è¡¨"></a>7ã€åˆ†åº“åˆ†è¡¨</h3><p>MySQLçš„åˆ†è¡¨åˆ†åº“æ˜¯ä¸€ç§æ•°æ®åº“æ¶æ„è®¾è®¡æ–¹æ³•ï¼Œç”¨äºå¤„ç†å¤§è§„æ¨¡æ•°æ®å’Œé«˜å¹¶å‘è®¿é—®ã€‚</p><p>éšç€æ•°æ®é‡çš„å¢é•¿å’Œè®¿é—®é‡çš„æå‡ï¼Œå•ä¸€æ•°æ®åº“æˆ–è¡¨å¯èƒ½éš¾ä»¥æ‰¿å—å‹åŠ›ï¼Œè¿™æ—¶é€šè¿‡åˆ†è¡¨åˆ†åº“å¯ä»¥æœ‰æ•ˆåœ°æé«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚</p><blockquote><p>åˆ†è¡¨ï¼ˆShardingï¼‰</p></blockquote><p>åˆ†è¡¨æ˜¯æŒ‡å°†ä¸€ä¸ªå¤§è¡¨æ‹†åˆ†æˆå¤šä¸ªå°è¡¨çš„è¿‡ç¨‹ã€‚</p><p>è¿™äº›å°è¡¨å¯ä»¥åˆ†å¸ƒåœ¨åŒä¸€ä¸ªæ•°æ®åº“æˆ–å¤šä¸ªæ•°æ®åº“ä¸­ã€‚åˆ†è¡¨é€šå¸¸åŸºäºæŸäº›å…³é”®å­—æ®µè¿›è¡Œï¼Œæ¯”å¦‚æ—¶é—´ã€ç”¨æˆ·IDç­‰ã€‚</p><ul><li><strong>å‚ç›´åˆ†è¡¨</strong>ï¼šå°†è¡¨ä¸­ä¸åŒçš„åˆ—åˆ†åˆ°ä¸åŒçš„è¡¨ä¸­ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·è¡¨å¯ä»¥è¢«åˆ†æˆç”¨æˆ·åŸºç¡€ä¿¡æ¯è¡¨å’Œç”¨æˆ·è¯¦ç»†ä¿¡æ¯è¡¨ã€‚</li><li><strong>æ°´å¹³åˆ†è¡¨</strong>ï¼šæ ¹æ®è¡Œæ•°æ®å°†è¡¨åˆ†æˆå¤šä¸ªè¡¨ï¼Œæ¯ä¸ªè¡¨åŒ…å«ç›¸åŒçš„åˆ—ï¼Œä½†åªåŒ…å«éƒ¨åˆ†è¡Œã€‚ä¾‹å¦‚ï¼ŒåŸºäºç”¨æˆ·IDèŒƒå›´æˆ–åˆ›å»ºæ—¶é—´è¿›è¡Œåˆ‡åˆ†ã€‚</li></ul><blockquote><p>åˆ†åº“ï¼ˆDatabase Shardingï¼‰</p></blockquote><p>åˆ†åº“æ¶‰åŠå°†æ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“å®ä¾‹ä¸Šã€‚æ¯ä¸ªæ•°æ®åº“å®ä¾‹å¯ä»¥æ‰˜ç®¡åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä»è€Œåˆ†æ•£è´Ÿè½½å’Œæé«˜å®¹é”™èƒ½åŠ›ã€‚</p><ul><li><strong>åˆ†å¸ƒå¼æ•°æ®åº“</strong>ï¼šæ•°æ®è¢«åˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªç‰©ç†ä½ç½®ï¼Œæ¯ä¸ªæ•°æ®åº“å®ä¾‹å¯ä»¥ç‹¬ç«‹å¤„ç†æŸ¥è¯¢å’Œäº‹åŠ¡ã€‚</li><li><strong>è¯»å†™åˆ†ç¦»</strong>ï¼šå¸¸ä¸åˆ†åº“ç»“åˆä½¿ç”¨ï¼Œè¯»æ“ä½œå’Œå†™æ“ä½œåˆ†åˆ«åœ¨ä¸åŒçš„æ•°æ®åº“å®ä¾‹ä¸Šè¿›è¡Œã€‚</li></ul><p>åœ¨å®ç°MySQLçš„åˆ†è¡¨åˆ†åº“æ—¶ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ä¸€äº›å·¥å…·å’Œä¸­é—´ä»¶ï¼Œå¦‚MyCATã€Shard-Queryç­‰ï¼Œå®ƒä»¬å¸®åŠ©ç®¡ç†å¤æ‚çš„åˆ†ç‰‡é€»è¾‘ï¼Œå¹¶å¯¹åº”ç”¨å±‚é€æ˜ã€‚</p><h3 id="8ã€ä¸»ä»å¤åˆ¶å’Œè¯»å†™åˆ†ç¦»"><a href="#8ã€ä¸»ä»å¤åˆ¶å’Œè¯»å†™åˆ†ç¦»" class="headerlink" title="8ã€ä¸»ä»å¤åˆ¶å’Œè¯»å†™åˆ†ç¦»"></a>8ã€ä¸»ä»å¤åˆ¶å’Œè¯»å†™åˆ†ç¦»</h3><p>åœ¨MySQLä¸­ï¼Œä¸»ä»å¤åˆ¶å’Œè¯»å†™åˆ†ç¦»æ˜¯ä¸¤ç§å¸¸ç”¨çš„æ¶æ„ç­–ç•¥ï¼Œç”¨äºæé«˜æ•°æ®åº“çš„å¯ç”¨æ€§ã€æ‰©å±•æ€§å’Œæ€§èƒ½ã€‚</p><h4 id="ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave-Replicationï¼‰"><a href="#ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave-Replicationï¼‰" class="headerlink" title="ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave Replicationï¼‰"></a>ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave Replicationï¼‰</h4><p>ä¸»ä»å¤åˆ¶æ˜¯ä¸€ç§æ•°æ®å¤åˆ¶çš„æ–¹æ³•ï¼Œå…¶ä¸­æ•°æ®ä»ä¸€ä¸ªä¸»æœåŠ¡å™¨ï¼ˆMasterï¼‰è‡ªåŠ¨å¤åˆ¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä»æœåŠ¡å™¨ï¼ˆSlaveï¼‰ã€‚</p><p>å·¥ä½œåŸç†</p><ol><li><strong>æ—¥å¿—å¤åˆ¶</strong>ï¼šä¸»æœåŠ¡å™¨çš„æ›´æ”¹ï¼ˆå¦‚INSERTã€UPDATEã€DELETEæ“ä½œï¼‰è¢«è®°å½•åˆ°äºŒè¿›åˆ¶æ—¥å¿—ä¸­ã€‚</li><li><strong>æ—¥å¿—ä¼ è¾“</strong>ï¼šè¿™äº›æ›´æ”¹ï¼ˆæ—¥å¿—æ¡ç›®ï¼‰è¢«ä¼ è¾“åˆ°ä»æœåŠ¡å™¨ã€‚</li><li><strong>åº”ç”¨æ›´æ”¹</strong>ï¼šä»æœåŠ¡å™¨è¯»å–è¿™äº›æ—¥å¿—æ¡ç›®ï¼Œå¹¶åœ¨è‡ªå·±çš„æ•°æ®å‰¯æœ¬ä¸Šåº”ç”¨è¿™äº›æ›´æ”¹ã€‚</li></ol><p>ç›®çš„å’Œä¼˜åŠ¿ï¼š</p><ul><li><strong>æ•°æ®å¤‡ä»½</strong>ï¼šæä¾›äº†æ•°æ®å¤‡ä»½ï¼Œæœ‰åŠ©äºç¾éš¾æ¢å¤ã€‚</li><li><strong>è¯»å–è´Ÿè½½åˆ†æ•£</strong>ï¼šä»æœåŠ¡å™¨å¯ä»¥ç”¨äºè¯»å–æ“ä½œï¼Œå‡è½»ä¸»æœåŠ¡å™¨çš„è´Ÿè½½ã€‚</li><li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šå¦‚æœä¸»æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œä»æœåŠ¡å™¨å¯ä»¥è¢«æå‡ä¸ºæ–°çš„ä¸»æœåŠ¡å™¨ã€‚</li></ul><p>ä¸»ä»è¾…åŠ©æ“ä½œä¸»è¦æ¶‰åŠä¸‰ä¸ªçº¿ç¨‹: binlog çº¿ç¨‹ã€I&#x2F;O çº¿ç¨‹å’Œ SQL çº¿ç¨‹ã€‚</p><ul><li><strong>binlog çº¿ç¨‹</strong> : è´Ÿè´£å°†ä¸»æœåŠ¡å™¨ä¸Šçš„æ•°æ®æ›´æ”¹å†™å…¥äºŒè¿›åˆ¶æ—¥å¿—ä¸­ã€‚</li><li><strong>I&#x2F;O çº¿ç¨‹</strong> : è´Ÿè´£ä»ä¸»æœåŠ¡å™¨ä¸Šè¯»å–äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¹¶å†™å…¥ä»æœåŠ¡å™¨çš„ä¸­ç»§æ—¥å¿—ä¸­ã€‚</li><li><strong>SQL çº¿ç¨‹</strong> : è´Ÿè´£è¯»å–ä¸­ç»§æ—¥å¿—å¹¶é‡æ”¾å…¶ä¸­çš„ SQL è¯­å¥ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401041611217.png" alt="image.png"></p><h4 id="è¯»å†™åˆ†ç¦»ï¼ˆRead-Write-Splittingï¼‰"><a href="#è¯»å†™åˆ†ç¦»ï¼ˆRead-Write-Splittingï¼‰" class="headerlink" title="è¯»å†™åˆ†ç¦»ï¼ˆRead-Write Splittingï¼‰"></a>è¯»å†™åˆ†ç¦»ï¼ˆRead-Write Splittingï¼‰</h4><p>è¯»å†™åˆ†ç¦»æ¶‰åŠå°†æ•°æ®åº“çš„è¯»å–æ“ä½œï¼ˆSELECTæŸ¥è¯¢ï¼‰å’Œå†™å…¥æ“ä½œï¼ˆINSERTã€UPDATEã€DELETEï¼‰åˆ†ç¦»åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚</p><p>å®ç°æ–¹æ³•</p><ul><li><strong>ä¸»æœåŠ¡å™¨å¤„ç†å†™æ“ä½œ</strong>ï¼šæ‰€æœ‰æ›´æ”¹æ•°æ®çš„æ“ä½œéƒ½åœ¨ä¸»æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚</li><li><strong>ä»æœåŠ¡å™¨å¤„ç†è¯»æ“ä½œ</strong>ï¼šæ‰€æœ‰çš„è¯»å–è¯·æ±‚éƒ½è¢«é‡å®šå‘åˆ°ä»æœåŠ¡å™¨ã€‚</li></ul><p>è¯»å†™åˆ†ç¦»å¸¸ç”¨ä»£ç†æ–¹å¼æ¥å®ç°ï¼Œä»£ç†æœåŠ¡å™¨æ¥æ”¶åº”ç”¨å±‚ä¼ æ¥çš„è¯»å†™è¯·æ±‚ï¼Œç„¶åå†³å®šè½¬å‘åˆ°å“ªä¸ªæœåŠ¡å™¨ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401041612689.png" alt="image.png"></p><blockquote><p>å°ç»“</p></blockquote><p>è¯»å†™åˆ†ç¦»å’Œä¸»ä»å¤åˆ¶å¯ä»¥é€šè¿‡MySQLçš„å†…ç½®åŠŸèƒ½å®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å¦‚ProxySQLã€MaxScaleç­‰æ¥å¸®åŠ©ç®¡ç†ã€‚</p><p>ä¸»ä»å¤åˆ¶å’Œè¯»å†™åˆ†ç¦»æ˜¯æé«˜MySQLæ•°æ®åº“æ€§èƒ½å’Œå¯é æ€§çš„é‡è¦ç­–ç•¥ã€‚</p><p>å®ƒä»¬åœ¨å¤„ç†å¤§é‡æ•°æ®å’Œé«˜å¹¶å‘è®¿é—®çš„æƒ…å†µä¸‹å°¤å…¶æœ‰ç”¨ï¼Œä½†ä¹Ÿéœ€è¦è€ƒè™‘å…¶å¸¦æ¥çš„é¢å¤–ç®¡ç†å’Œé…ç½®å¤æ‚æ€§ã€‚</p><h3 id="9ã€å¸¸è§é¢è¯•é¢˜-ğŸš©"><a href="#9ã€å¸¸è§é¢è¯•é¢˜-ğŸš©" class="headerlink" title="9ã€å¸¸è§é¢è¯•é¢˜  ğŸš©"></a>9ã€å¸¸è§é¢è¯•é¢˜  ğŸš©</h3><ul><li>1ã€å¦‚ä½•å®šä½æ…¢æŸ¥è¯¢</li><li>2ã€SQL è¯­å¥æ‰§è¡Œçš„å¾ˆæ…¢ï¼Œå¦‚ä½•åˆ†æ</li><li>3ã€ç´¢å¼•æ¦‚å¿µä»¥åŠç´¢å¼•åº•å±‚æ•°æ®ç»“æ„</li><li>4ã€èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ã€å›è¡¨æŸ¥è¯¢</li><li>5ã€è¦†ç›–ç´¢å¼•ã€è¶…å¤§åˆ†é¡µä¼˜åŒ–</li><li>6ã€ç´¢å¼•åˆ›å»ºçš„åŸåˆ™</li><li>7ã€ä»€ä¹ˆæƒ…å†µä¸‹ç´¢å¼•ä¼šå¤±æ•ˆ</li><li>8ã€è°ˆä¸€è°ˆä½ å¯¹ SQL ä¼˜åŒ–çš„ç»éªŒ</li><li>9ã€äº‹åŠ¡çš„ç‰¹æ€§</li><li>10ã€å¹¶å‘äº‹åŠ¡é—®é¢˜ã€éš”ç¦»çº§åˆ«</li><li>11ã€undo log å’Œ redo log çš„åŒºåˆ«</li><li>12ã€è§£é‡Šä¸€ä¸‹ MVCC</li><li>13ã€ä¸»ä»åŒæ­¥åŸç†</li><li>14ã€åˆ†åº“åˆ†è¡¨</li></ul><p>ä¸»è¦é¢è¯•é¢˜ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305190628.png" alt="image.png"></p><h4 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h4><h5 id="æ…¢æŸ¥è¯¢"><a href="#æ…¢æŸ¥è¯¢" class="headerlink" title="æ…¢æŸ¥è¯¢"></a>æ…¢æŸ¥è¯¢</h5><blockquote><p>åœ¨ MySQL ä¸­ï¼Œå¦‚ä½•å®šä½æ…¢æŸ¥è¯¢ï¼Ÿ</p></blockquote><ul><li>èšåˆæŸ¥è¯¢</li><li>å¤šè¡¨æŸ¥è¯¢</li><li>è¡¨æ•°æ®é‡è¿‡å¤§æŸ¥è¯¢</li><li>æ·±åº¦åˆ†é¡µæŸ¥è¯¢</li></ul><p>è¡¨è±¡ï¼šé¡µé¢åŠ è½½è¿‡æ…¢ã€æ¥å£å‹æµ‹å“åº”æ—¶é—´è¿‡é•¿ï¼ˆè¶…è¿‡ 1s ï¼‰</p><p>æ–¹æ¡ˆä¸€ã€å¼€æºå·¥å…·</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204256.png" alt="image.png"></p><p>æ–¹æ¡ˆäºŒï¼š MySQL è‡ªå¸¦æ…¢æ—¥å¿—</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204349.png" alt="image.png"></p><p>æ€»ç»“ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204413.png" alt="image.png"></p><p>ï¼ˆç”Ÿäº§é˜¶æ®µä¸€èˆ¬ä¸å¼€å¯æ…¢æ—¥å¿—æŸ¥è¯¢ï¼‰</p><p>å¼€æºé‡‡ç”¨ EXPLAIN æˆ–è€… DESC å‘½ä»¤è·å– MySQL å¦‚ä½•æ‰§è¡Œ SELECT è¯­å¥çš„ä¿¡æ¯</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305205010.png" alt="image.png"></p><p>å‚æ•°ä½¿ç”¨</p><ul><li>possible_key</li><li>key</li><li>key_len</li><li>Extra</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204719.png" alt="image.png"></p><ul><li>type</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204847.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305204938.png" alt="image.png"></p><h5 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h5><blockquote><p>ä»€ä¹ˆæ˜¯ç´¢å¼•</p></blockquote><p>æé«˜è®¿é—®æ•ˆç‡ï¼Œç´¢å¼•æ˜¯æŸç§æ•°æ®ç»“æ„ç»„æˆ</p><p>ç´¢å¼•(index)æ˜¯å¸®åŠ© MySQL é«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ (æœ‰åº) ã€‚</p><p>åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„(B+æ ‘)ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚</p><blockquote><p>ç´¢å¼•çš„åº•å±‚ç»“æ„</p></blockquote><ul><li>ç›®å‰ç´¢å¼•é‡‡ç”¨çš„åº•å±‚ç»“æ„æ˜¯ B+ æ ‘</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305211546.png" alt="image.png"></p><blockquote><p>ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯éèšç°‡ç´¢å¼•</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305212233.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305212341.png" alt="image.png"></p><blockquote><p>è®²ä¸€ä¸‹å›è¡¨æŸ¥è¯¢</p></blockquote><p>å›è¡¨æŸ¥è¯¢ï¼šé€šè¿‡äºŒçº§ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„ä¸»é”®å€¼</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305212500.png" alt="image.png"></p><blockquote><p>çŸ¥é“ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•å—</p></blockquote><p>å¯¹æŸ¥è¯¢åˆ—æœ‰è¦æ±‚ï¼Œä¸€èˆ¬æ˜¯æŸ¥è¯¢çš„å­—æ®µå’Œç´¢å¼•å­—æ®µç›¸åŒï¼Œä¸åŒèµ°ä¸»é”®æŸ¥è¯¢é‚£æ­¥ï¼Œç›´æ¥ä»ç´¢å¼•æ ‘ä¸ŠæŸ¥è¯¢å‡ºäº†æ•°æ®</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305212622.png" alt="image.png"></p><p>ä½ çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼Œä¸»é”®ç´¢å¼•ä¸­æŸ¥è¯¢æ¡ä»¶æ˜¯ä¸»é”®çš„è¯ï¼Œç›´æ¥æŸ¥è¯¢æ‰€æœ‰æ•°æ®æ˜¯è¯ç®—æ˜¯è¦†ç›–ç´¢å¼•ï¼Œç„¶åå¦‚æœæ˜¯äºŒçº§ç´¢å¼•ï¼ŒæŸ¥è¯¢ ä¸»é”®+ ç´¢å¼• æ˜¯ç®—è¦†ç›–ç´¢å¼•æŸ¥è¯¢(ç´¢å¼•æ ‘ä¸Šç›´æ¥æŸ¥è¯¢)</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305212749.png" alt="image.png"></p><p>è¦†ç›–ç´¢å¼•çš„åŸºæœ¬ä»‹ç»</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305213542.png" alt="image.png"></p><h6 id="è¶…å¤§åˆ†é¡µ"><a href="#è¶…å¤§åˆ†é¡µ" class="headerlink" title="è¶…å¤§åˆ†é¡µ"></a>è¶…å¤§åˆ†é¡µ</h6><blockquote><p>MySQL è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305213731.png" alt="image.png"></p><p>æä¾›ä¸€ç§è§£å†³æ€è·¯ï¼šé€šè¿‡è¦†ç›–ç´¢å¼• + å­æŸ¥è¯¢ å½¢å¼è¿›è¡Œä¼˜åŒ–<br>ã€</p><ul><li>å…ˆé€šè¿‡è¦†ç›–ç´¢å¼•æŸ¥è¯¢å‡ºå¯¹åº”çš„IDï¼Œç„¶åé€šè¿‡å…³è”æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å‡ºåˆ†é¡µæ•°æ®</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305214250.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305214458.png" alt="image.png"></p><h6 id="ç´¢å¼•åˆ›å»ºåŸåˆ™"><a href="#ç´¢å¼•åˆ›å»ºåŸåˆ™" class="headerlink" title="ç´¢å¼•åˆ›å»ºåŸåˆ™"></a>ç´¢å¼•åˆ›å»ºåŸåˆ™</h6><p>å›ç­”æ€è·¯ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305214539.png" alt="image.png"></p><p>ä¸»è¦çš„ä¸€äº›åŸåˆ™ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305214712.png" alt="image.png"></p><p>ç´¢å¼•åˆ›å»ºåŸåˆ™æœ‰å“ªäº›ï¼Ÿ</p><ul><li><ol><li>æ•°æ®é‡è¾ƒå¤§ï¼Œä¸”æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹çš„è¡¨             <strong>é‡è¦</strong></li></ol></li><li>2).å¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€æ’åºã€åˆ†ç»„çš„å­—æ®µ         <strong>é‡è¦</strong></li><li>3).å­—æ®µå†…å®¹åŒºåˆ†åº¦é«˜</li><li>4).å†…å®¹è¾ƒé•¿ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•</li><li>5).å°½é‡è”åˆç´¢å¼•                                              <strong>é‡è¦</strong></li><li>6).è¦æ§åˆ¶ç´¢å¼•çš„æ•°é‡                                       <strong>é‡è¦</strong></li><li>7).å¦‚æœç´¢å¼•åˆ—ä¸èƒ½å­˜å‚¨NULL å€¼ï¼Œè¯·åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨NOT NULL çº¦æŸå®ƒ</li></ul><h6 id="ç´¢å¼•å¤±æ•ˆ"><a href="#ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="ç´¢å¼•å¤±æ•ˆ"></a>ç´¢å¼•å¤±æ•ˆ</h6><p>å¦‚ä½•åˆ¤æ–­ç´¢å¼•æ˜¯å¦å¤±æ•ˆï¼šé€šè¿‡ æ‰§è¡Œè®¡åˆ’ explain</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305222045.png" alt="image.png"></p><p>ç´¢å¼•å¤±æ•ˆçš„ä¸€äº›æƒ…å†µï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305222317.png" alt="image.png"></p><p>ç†è§£å»è®°å¿†ä¸€ä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305222354.png" alt="image.png"></p><h4 id="SQL-ä¼˜åŒ–"><a href="#SQL-ä¼˜åŒ–" class="headerlink" title="SQL ä¼˜åŒ–"></a>SQL ä¼˜åŒ–</h4><p>è°ˆè°ˆä½ å¯¹ SQL ä¼˜åŒ–çš„ç»éªŒ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305222506.png" alt="image.png"></p><ul><li>ä¸»ä»å¤åˆ¶ã€è¯»å†™åˆ†ç¦»</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305222712.png" alt="image.png"></p><p>æ€»ç»“ï¼š</p><ul><li>1ã€è¡¨çš„è®¾è®¡ä¼˜åŒ–ï¼Œæ•°æ®ç±»å‹çš„é€‰æ‹©</li><li>2ã€ç´¢å¼•ä¼˜åŒ–ï¼Œç´¢å¼•åˆ›å»ºåŸåˆ™ã€</li><li>3ã€sqlè¯­å¥ä¼˜åŒ–ï¼Œé¿å…ç´¢å¼•å¤±æ•ˆï¼Œé¿å…ä½¿ç”¨select * â€¦.</li><li>4ã€ä¸»ä»å¤åˆ¶ã€è¯»å†™åˆ†ç¦»ï¼Œä¸è®©æ•°æ®çš„å†™å…¥ï¼Œå½±å“è¯»æ“ä½œ</li><li>5ã€åˆ†åº“åˆ†è¡¨</li></ul><hr><h4 id="å…¶ä»–é—®é¢˜"><a href="#å…¶ä»–é—®é¢˜" class="headerlink" title="å…¶ä»–é—®é¢˜"></a>å…¶ä»–é—®é¢˜</h4><h5 id="äº‹åŠ¡ç›¸å…³"><a href="#äº‹åŠ¡ç›¸å…³" class="headerlink" title="äº‹åŠ¡ç›¸å…³"></a>äº‹åŠ¡ç›¸å…³</h5><blockquote><p>äº‹åŠ¡çš„ç‰¹æ€§</p></blockquote><p>äº‹åŠ¡ï¼šäº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡ä¼šæŠŠæ‰€æœ‰çš„æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“ä¸€èµ·å‘ç³»<br>ç»Ÿæäº¤æˆ–æ’¤é”€æ“ä½œè¯·æ±‚ï¼Œå³è¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><p>ACIDæ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥è¯¦ç»†è¯´ä¸€ä¸‹å—ï¼Ÿ</p><ul><li>åŸå­æ€§(Atomicity):äº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</li><li>ä¸€è‡´æ€§(Consistency):äº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚</li><li>éš”ç¦»æ€§(Isolation)ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚</li><li>æŒä¹…æ€§(Durability)ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚</li></ul><p>è®²è¿°è¿™ç§é¢˜ç›®çš„é€‚åˆæœ€å¥½ç»“åˆä¸€ä¸‹å®é™…æ¡ˆä¾‹æ¥è®²è¿°ä¸€ä¸‹ï¼Œè®©é¢è¯•å®˜è§‰å¾—ä½ è®²çš„å’Œå…¶ä»–äººæœ‰æ‰€ä¸åŒ</p><p>ç¤ºä¾‹ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305223200.png" alt="image.png"></p><hr><blockquote><p>å¹¶å‘äº‹åŠ¡å¸¦æ¥å“ªäº›é—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜å‘¢ï¼ŸMySQL çš„éš”ç¦»çº§åˆ«æ˜¯ï¼Ÿ</p></blockquote><ul><li>å¹¶å‘äº‹åŠ¡é—®é¢˜ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</li><li>éš”ç¦»çº§åˆ«ï¼šè¯»æœªæäº¤ã€è¯»å·²æäº¤ã€å¯é‡å¤è¯»ã€ä¸²è¡ŒåŒ–</li></ul><p>å¹¶å‘äº‹åŠ¡é—®é¢˜</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305223338.png" alt="image.png"></p><p>æ€ä¹ˆè§£å†³å¹¶å‘äº‹åŠ¡çš„é—®é¢˜ï¼Ÿ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305223402.png" alt="image.png"></p><p>æ³¨æ„ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®è¶Šå®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½è¶Šä½ã€‚</p><p>æ€»ç»“ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305223512.png" alt="image.png"></p><h5 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h5><blockquote><p>undo log  å’Œ redo log çš„åŒºåˆ«ï¼Ÿ</p></blockquote><p>å…ˆå¼•å…¥ä¸€ä¸ªæ¦‚å¿µï¼šå³ç¼“å­˜æ± å’Œæ•°æ®é¡µï¼Œæ•°æ®é¡µæ˜¯ç£ç›˜ä¸­å®é™…å­˜å‚¨çš„æ•°æ®ï¼Œä½†ä¸€èˆ¬æ•°æ®åŠ è½½çš„æ—¶å€™ä¼šå…ˆä»å†…å­˜ä¸­åˆ°ç£ç›˜ï¼Œè¿™ä¸ªå†…å­˜çš„åŒºåŸŸå«åšç¼“å†²æ± ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305223637.png" alt="image.png"></p><p>æœåŠ¡å®•æœºçš„æ—¶å€™ï¼Œæ•°æ®å¦‚ä½•ä¿è¯ä¸ä¸¢å¤±ï¼Œæ˜¯ç”±äºæ—¥å¿—çš„å­˜åœ¨ã€‚</p><ul><li>redo logï¼š</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305231922.png" alt="image.png"></p><ul><li>undo log</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305232004.png" alt="image.png"></p><p>æ€»ç»“ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305232037.png" alt="image.png"></p><hr><p>åé¢è¿˜æœ‰å‡ é“ï¼Œæ˜å¤©å†çœ‹ä¸€ä¸‹</p><ul><li>12ã€è§£é‡Šä¸€ä¸‹ MVCC</li><li>13ã€ä¸»ä»åŒæ­¥åŸç†</li><li>14ã€åˆ†åº“åˆ†è¡¨</li></ul><hr><p>å‚è€ƒ</p><ul><li><a href="https://www.bilibili.com/video/BV1ve411F794">https://www.bilibili.com/video/BV1ve411F794</a></li><li><a href="https://gitee.com/moxi159753/LearningNotes/tree/master/MySQL/MySQL45%E8%AE%B2">https://gitee.com/moxi159753/LearningNotes/tree/master/MySQL/MySQL45%E8%AE%B2</a></li><li><a href="https://javaguide.cn/database/mysql/mysql-questions-01.html#mysql-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E">https://javaguide.cn/database/mysql/mysql-questions-01.html#mysql-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E</a></li><li><a href="https://gitee.com/moxi159753/LearningNotes/tree/master/MySQL/MySQL45%E8%AE%B2">https://gitee.com/moxi159753/LearningNotes/tree/master/MySQL/MySQL45%E8%AE%B2</a></li><li><a href="https://developer.huawei.com/consumer/cn/forum/topic/0204405591412170236">https://developer.huawei.com/consumer/cn/forum/topic/0204405591412170236</a></li><li><a href="https://javaguide.cn/database/mysql/mysql-questions-01.html">https://javaguide.cn/database/mysql/mysql-questions-01.html</a></li><li><a href="https://www.pdai.tech/md/db/sql-mysql/sql-mysql-overview.html">https://www.pdai.tech/md/db/sql-mysql/sql-mysql-overview.html</a></li><li><a href="https://www.yuque.com/snailclimb/mf2z3k/wghadf">https://www.yuque.com/snailclimb/mf2z3k/wghadf</a></li><li><a href="https://blog.csdn.net/qq_44766883/article/details/105879308">https://blog.csdn.net/qq_44766883/article/details/105879308</a></li><li><a href="https://javaguide.cn/database/mysql/mysql-questions-01.html">https://javaguide.cn/database/mysql/mysql-questions-01.html</a></li><li><a href="https://www.pdai.tech/md/db/sql-mysql/sql-mysql-devide.html">https://www.pdai.tech/md/db/sql-mysql/sql-mysql-devide.html</a></li><li><a href="https://www.bilibili.com/video/BV1yT411H7YK">https://www.bilibili.com/video/BV1yT411H7YK</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—_RocketMQ_åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2024/03/07/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RocketMQ_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2024/03/07/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RocketMQ_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<p>é‡æ–°æ•´åˆä¸€ä¸‹ç›¸å…³çš„ RocketMQ çš„å†…å®¹ï¼Œå¦‚æœæœ‰é—æ¼ï¼Œåç»­ä¼šå°½é‡è¡¥å……è¿›è¡Œå®Œå–„ã€‚</p><p>ä¸€æ–¹é¢çš„å†…å®¹æ˜¯ä¸ºäº†é¢è¯•éœ€è¦ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†å¯¹æ•´ä¸ªRocketMQçš„çŸ¥è¯†ä½“ç³»è¿›è¡Œå®Œå–„ã€‚</p><h3 id="ä¸€ã€åŸºç¡€æ¦‚å¿µ"><a href="#ä¸€ã€åŸºç¡€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºç¡€æ¦‚å¿µ"></a>ä¸€ã€åŸºç¡€æ¦‚å¿µ</h3><h4 id="RocketMQ-æ˜¯ä»€ä¹ˆ"><a href="#RocketMQ-æ˜¯ä»€ä¹ˆ" class="headerlink" title="RocketMQ æ˜¯ä»€ä¹ˆ"></a>RocketMQ æ˜¯ä»€ä¹ˆ</h4><p>RocketMQ æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯å’Œæµå¤„ç†å¹³å°ï¼Œç”±é˜¿é‡Œå·´å·´é›†å›¢å¼€å‘å¹¶è´¡çŒ®ç»™ Apache è½¯ä»¶åŸºé‡‘ä¼šã€‚å®ƒè¢«è®¾è®¡ç”¨äºå¤„ç†å¤§è§„æ¨¡ã€é«˜ååé‡çš„æ¶ˆæ¯ä¼ é€’ï¼Œå¹¶åœ¨é˜¿é‡Œå·´å·´é›†å›¢å†…éƒ¨åŠä¼—å¤šä¼ä¸šä¸­å¹¿æ³›ä½¿ç”¨ã€‚</p><p>ç‰¹ç‚¹ï¼šé«˜æ€§èƒ½ï¼Œé«˜å¯é ï¼Œé«˜å®æ—¶ï¼Œåˆ†å¸ƒå¼</p><p>RocketMQ æ˜¯å‘å¸ƒ&#x2F;è®¢é˜… çš„æ¶ˆæ¯æ¨¡å‹</p><p>ä¼˜ç‚¹ä¹‹ä¸€ï¼šå¯é æ€§å¾ˆå¥½</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307221946.png" alt="image.png"></p><h4 id="æ¶ˆæ¯æ¨¡å‹"><a href="#æ¶ˆæ¯æ¨¡å‹" class="headerlink" title="æ¶ˆæ¯æ¨¡å‹"></a>æ¶ˆæ¯æ¨¡å‹</h4><p>æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä¸¤ç§æ¨¡å‹ï¼š<strong>é˜Ÿåˆ—æ¨¡å‹</strong>å’Œ<strong>å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å‹</strong>ã€‚RocketMQ æ˜¯åè€…ã€‚</p><ul><li>é˜Ÿåˆ—æ¨¡å‹<ul><li>é˜Ÿåˆ—æ–¹å¼ï¼Œç”Ÿäº§è€…æ¶ˆè´¹è€…</li></ul></li><li>ä¸»é¢˜æ¨¡å‹&#x2F;å‘å¸ƒè®¢é˜…<ul><li>å‘å¸ƒè€…å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šä¸»é¢˜ä¸­ï¼Œè®¢é˜…è€…éœ€è¦Â <strong>æå‰è®¢é˜…ä¸»é¢˜</strong>Â æ‰èƒ½æ¥å—ç‰¹å®šä¸»é¢˜çš„æ¶ˆæ¯ã€‚<img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231220201308.png" alt="image.png|500"></li></ul></li></ul><h4 id="RocketMQ-çš„æ¶ˆæ¯æ¨¡å‹"><a href="#RocketMQ-çš„æ¶ˆæ¯æ¨¡å‹" class="headerlink" title="RocketMQ çš„æ¶ˆæ¯æ¨¡å‹"></a>RocketMQ çš„æ¶ˆæ¯æ¨¡å‹</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307223302.png" alt="image.png"></p><h5 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307222243.png" alt="image.png"></p><h5 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307222314.png" alt="image.png"></p><p>å°†Queueè¿›è¡Œåˆ†ç±»ï¼Œç±»ä¼¼åˆ†ç»„ã€æ ‡ç­¾ï¼ˆé€»è¾‘ä¸Šï¼‰</p><h5 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h5><blockquote><p>Topic å’Œ Tag  çš„åŒºåˆ«</p></blockquote><p>æ¶ˆæ¯å‘é€çš„æ—¶å€™ä¸€èˆ¬ä¼šæŒ‡å®šæ¶ˆæ¯ä½“ï¼Œæ¶ˆæ¯ä½“å¯¹è±¡åŒ…æ‹¬ Topicï¼Œ Tag ï¼ˆå¯é€‰ï¼‰ï¼Œæ¶ˆæ¯æ•°æ®</p><p>å…¶ä¸­ Tagæ˜¯è¿›ä¸€æ­¥ç»†åŒ–Topicæ¶ˆæ¯åˆ†ç±»çš„æ ‡ç­¾ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307222400.png" alt="image.png"></p><h5 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307222511.png" alt="image.png"></p><h5 id="Message-Queue"><a href="#Message-Queue" class="headerlink" title="Message Queue"></a>Message Queue</h5><p>ç‰©ç†å®é™…åˆ†åŒºï¼Œæ¶ˆæ¯çš„å®é™…å­˜å‚¨åœ°æ–¹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307222626.png" alt="image.png"></p><h5 id="Offset"><a href="#Offset" class="headerlink" title="Offset"></a>Offset</h5><p>Offset æ˜¯æ¶ˆè´¹è€…ç»„åœ¨ Queue çš„æ¶ˆè´¹ä½ç½®ä¸‹æ ‡</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307222738.png" alt="image.png"></p><h4 id="æ¶ˆæ¯çš„æ¶ˆè´¹æ¨¡å¼"><a href="#æ¶ˆæ¯çš„æ¶ˆè´¹æ¨¡å¼" class="headerlink" title="æ¶ˆæ¯çš„æ¶ˆè´¹æ¨¡å¼"></a>æ¶ˆæ¯çš„æ¶ˆè´¹æ¨¡å¼</h4><p>æ¶ˆæ¯æ¶ˆè´¹æ¨¡å¼æœ‰ä¸¤ç§ï¼š<strong>Clustering</strong>ï¼ˆé›†ç¾¤æ¶ˆè´¹ï¼‰å’Œ<strong>Broadcasting</strong>ï¼ˆå¹¿æ’­æ¶ˆè´¹ï¼‰ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯é›†ç¾¤æ¶ˆè´¹ï¼Œè¿™ç§æ¨¡å¼ä¸‹<code>ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å…±åŒæ¶ˆè´¹ä¸€ä¸ªä¸»é¢˜çš„å¤šä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªé˜Ÿåˆ—åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</code>ï¼Œå¦‚æœæŸä¸ªæ¶ˆè´¹è€…æŒ‚æ‰ï¼Œåˆ†ç»„å†…å…¶å®ƒæ¶ˆè´¹è€…ä¼šæ¥æ›¿æŒ‚æ‰çš„æ¶ˆè´¹è€…ç»§ç»­æ¶ˆè´¹ã€‚</p><p>è€Œå¹¿æ’­æ¶ˆè´¹æ¶ˆæ¯ä¼šå‘ç»™æ¶ˆè´¹è€…ç»„ä¸­çš„æ¯ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€‚</p><h3 id="äºŒã€æ¶æ„å’Œç»„ä»¶"><a href="#äºŒã€æ¶æ„å’Œç»„ä»¶" class="headerlink" title="äºŒã€æ¶æ„å’Œç»„ä»¶"></a>äºŒã€æ¶æ„å’Œç»„ä»¶</h3><h4 id="åŸºç¡€ç»„ä»¶-ğŸš©"><a href="#åŸºç¡€ç»„ä»¶-ğŸš©" class="headerlink" title="åŸºç¡€ç»„ä»¶  ğŸš©"></a>åŸºç¡€ç»„ä»¶  ğŸš©</h4><p>åŸºç¡€ç»„ä»¶æœ‰ï¼šNameServer æ³¨å†Œä¸­å¿ƒã€Broker æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ã€Producerã€Consumer</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231226214425.png" alt="image.png"></p><p><code>RocketMQ</code>Â æŠ€æœ¯æ¶æ„ä¸­æœ‰å››å¤§è§’è‰²Â <code>NameServer</code>ã€<code>Broker</code>ã€<code>Producer</code>ã€<code>Consumer</code></p><ul><li><code>NameServer</code><ul><li>Â·å»ä¸­å¿ƒåŒ–çš„æ³¨å†Œä¸­å¿ƒï¼šè¿›è¡ŒBrokerèŠ‚ç‚¹ç®¡ç†å’Œè·¯ç”±ä¿¡æ¯ç®¡ç†</li><li>è´Ÿè½½å‡è¡¡ï¼Œè·¯ç”±ç®¡ç†ï¼Œæ³¨å†Œä¸­å¿ƒ</li><li>æ“ä½œæ­¥éª¤<ul><li><ol><li><code>Broker</code> ä¼šå°†è‡ªå·±çš„ä¿¡æ¯æ³¨å†Œåˆ° <code>NameServer</code> ä¸­ï¼ˆæ­¤æ—¶ï¼Œ<code>NameServer</code> ä¼šå­˜æ”¾å¾ˆå¤š <code>Broker</code> çš„ä¿¡æ¯  â†  Broker çš„è·¯ç”±è¡¨ä¿¡æ¯ï¼‰</li></ol></li><li><ol start="2"><li>æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ä» <code>NameServer</code> è·å–è·¯ç”±è¡¨ä¿¡æ¯å’Œå¯¹åº”çš„  <code>Broker</code> è¿›è¡Œé€šä¿¡(ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®šæœŸä¼šå‘ <code>NameServer</code> å»æŸ¥è¯¢ç›¸å…³çš„ <code>Broker</code> çš„ä¿¡æ¯)</li></ol></li></ul></li><li>å¤šä¸ª NameServer å½¢æˆé›†ç¾¤ï¼Œä½†å®ƒä»¬ä¹‹é—´ä¸åŒæ­¥ä¿¡æ¯ã€‚å®¢æˆ·ç«¯ï¼ˆProducer å’Œ Consumerï¼‰å¯ä»¥è¿æ¥ä»»æ„ä¸€ä¸ª NameServer</li></ul></li><li><code>Broker</code><ul><li>æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯åˆ°Â <code>Broker</code>Â ï¼Œæ¶ˆè´¹è€…ä»Â <code>Broker</code>Â æ‹‰å–æ¶ˆæ¯å¹¶æ¶ˆè´¹ã€‚<ul><li>Broker å¯ä»¥æ˜¯ Master ä¹Ÿå¯ä»¥æ˜¯ Slaveã€‚<ul><li>æ¯ä¸ª Master å¯ä»¥æœ‰å¤šä¸ª Slaveã€‚Master è´Ÿè´£è¯»å†™æ¶ˆæ¯ï¼ŒSlave å¯ä»¥è¿›è¡Œæ¶ˆæ¯çš„åŒæ­¥ï¼Œä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ã€‚</li></ul></li></ul></li><li>å®šæœŸå‘ Name Server å‘é€å¿ƒè·³åŒ…ï¼ˆåŒ…å«è‡ªèº«çš„ä¸»é¢˜ä¿¡æ¯ï¼‰ï¼›Brokerï¼šæ¶ˆæ¯å¤„ç†çš„èŠ‚ç‚¹ä¸­å¿ƒï¼›NameSpace ç®¡ç†çš„è·¯ç”±ä¹Ÿæ˜¯å¯¹åº”èŠ‚ç‚¹æ¥å¤„ç†çš„ï¼›ä¸€ä¸ªBroker èŠ‚ç‚¹ä¸‹æœ‰å¤šä¸ªQueue</li><li>æ¶ˆæ¯å­˜å‚¨å’Œè½¬å‘ï¼šBroker æ˜¯æ¶ˆæ¯å­˜å‚¨å’Œè½¬å‘çš„æ ¸å¿ƒã€‚ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ° Brokerï¼ŒBroker è´Ÿè´£å°†æ¶ˆæ¯ä¿å­˜åœ¨ç›¸åº”çš„é˜Ÿåˆ—ä¸­ã€‚</li><li>æ¶ˆæ¯å¤„ç†ï¼šBroker å¤„ç†æ‰€æœ‰ä¸æ¶ˆæ¯ç›¸å…³çš„æ“ä½œï¼ŒåŒ…æ‹¬æ¶ˆæ¯çš„å­˜å‚¨ã€æ£€ç´¢ã€åˆ é™¤ä»¥åŠå‘æ¶ˆè´¹è€…åˆ†å‘æ¶ˆæ¯ã€‚</li><li>ç»´æŠ¤é˜Ÿåˆ—çŠ¶æ€ï¼šBroker è´Ÿè´£ç»´æŠ¤æ¯ä¸ªé˜Ÿåˆ—çš„çŠ¶æ€ï¼Œå¦‚æ¶ˆæ¯åç§»é‡ï¼ˆOffsetï¼‰ï¼Œç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿè¢«æ­£ç¡®åœ°æ¶ˆè´¹ã€‚</li></ul></li><li><code>Producer</code><ul><li>ç”Ÿäº§è€…</li><li>ç”Ÿäº§è€…ä¼šå®šæœŸå‘ NameServer æŸ¥è¯¢ Broker çš„ä¿¡æ¯</li><li>å½“ç”Ÿäº§è€…å‡†å¤‡å‘é€æ¶ˆæ¯æ—¶ï¼Œå®ƒé¦–å…ˆè”ç³» NameServer ä»¥è·å– Topic æ‰€åœ¨çš„ Broker ä¿¡æ¯ã€‚ç„¶åï¼Œæ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°æ­£ç¡®çš„ Broker å’Œå¯¹åº”çš„é˜Ÿåˆ—ä¸­ã€‚</li></ul></li><li><code>Consumer</code><ul><li>æ¶ˆè´¹è€…</li><li>å®šæœŸå‘ NameServer æŸ¥è¯¢ Broker çš„ä¿¡æ¯</li><li>è®¢é˜…ä¸»é¢˜ï¼šæ¶ˆè´¹è€…å‘ Broker è®¢é˜…ç‰¹å®šçš„ Topicã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæ¶‰åŠ NameServer æ¥æ‰¾åˆ°æ‰˜ç®¡è¯¥ Topic çš„ Brokerã€‚</li><li>æ¶ˆæ¯æ¥æ”¶ï¼šä¸€æ—¦ Broker ä¸­çš„ Topic æ”¶åˆ°æ¶ˆæ¯ï¼Œç¬¦åˆæ¡ä»¶çš„æ¶ˆè´¹è€…ï¼ˆé‚£äº›è®¢é˜…äº†è¯¥ Topic çš„æ¶ˆè´¹è€…ï¼‰å°±å¯ä»¥æ¥æ”¶åˆ°è¿™äº›æ¶ˆæ¯ã€‚</li><li><strong>æ¶ˆè´¹æ¨¡å¼</strong>ï¼š<ul><li>åœ¨é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œæ¯æ¡æ¶ˆæ¯åªä¼šè¢«æ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ã€‚</li><li>åœ¨å¹¿æ’­æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œæ¯æ¡æ¶ˆæ¯ä¼šè¢«å‘é€åˆ°æ¶ˆè´¹è€…ç»„ä¸­çš„æ‰€æœ‰æ¶ˆè´¹è€…ã€‚</li></ul></li></ul></li></ul><h5 id="NameServer"><a href="#NameServer" class="headerlink" title="NameServer"></a>NameServer</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307223602.png" alt="image.png"></p><h6 id="ä¸ºä»€ä¹ˆRocketMQä¸ä½¿ç”¨Zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆRocketMQä¸ä½¿ç”¨Zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆRocketMQä¸ä½¿ç”¨Zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Ÿ"></a>ä¸ºä»€ä¹ˆRocketMQä¸ä½¿ç”¨Zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Ÿ</h6><p>RocketMQä¸»è¦æ˜¯ä¿éšœæœ€ç»ˆâ¼€è‡´æ€§ï¼Œå®ƒåªéœ€è¦â¼€ä¸ªè½»é‡çº§çš„å…ƒæ•°æ®æœ åŠ¡å°±â¾äº†ï¼Œâ½½Zookeeperæ˜¯å¼ºâ¼€è‡´æ€§çš„è§£å†³â½…æ¡ˆï¼Œå¹¶ä¸”å°‘ä½¿â½¤â¼€ä¸ªä¸­ é—´ä»¶å¯ä»¥å‡å°‘ç»´æŠ¤æˆæœ¬</p><p>è¿˜æœ‰ä¸€æ–¹é¢RocketMQ æ˜¯è®¾è®¡æ˜¯è®©æ³¨å†Œä¸­å¿ƒå°½é‡è½»é‡åŒ–ï¼Œä½¿å¾—æ¶ˆæ¯å‘é€å¼±ä¾èµ–æ³¨å†Œä¸­å¿ƒã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308110227.png" alt="image.png"></p><h5 id="Broker"><a href="#Broker" class="headerlink" title="Broker"></a>Broker</h5><p>æ¶ˆæ¯å­˜å‚¨å’Œä¸­è½¬è§’è‰²ï¼Œè´Ÿè´£å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯ã€‚</p><ul><li>å•ä¸ª Broker ä¸æ‰€æœ‰çš„ Nameserver ä¿æŒç€é•¿è¿æ¥å’Œå¿ƒè·³ï¼Œå¹¶ä¼šå®šæ—¶å°† Topic ä¿¡æ¯åŒæ­¥åˆ° NameServerï¼Œå’Œ NameServer çš„é€šä¿¡åº•å±‚æ˜¯é€šè¿‡ Netty å®ç°çš„ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307223652.png" alt="image.png"></p><h5 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a>Producer</h5><p>æ¶ˆæ¯ç”Ÿäº§è€…</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307223840.png" alt="image.png"></p><h5 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307223944.png" alt="image.png"></p><h4 id="æ¶ˆæ¯å‘é€æµç¨‹"><a href="#æ¶ˆæ¯å‘é€æµç¨‹" class="headerlink" title="æ¶ˆæ¯å‘é€æµç¨‹"></a>æ¶ˆæ¯å‘é€æµç¨‹</h4><p>ç”Ÿäº§æ¶ˆæ¯å’Œæ¶ˆè´¹æ¶ˆæ¯æ“ä½œï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312271701523.png" alt="image.png"></p><blockquote><p>Q1ï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æµç¨‹</p></blockquote><p>ç”Ÿäº§è€…ç»„å‘é€æ¶ˆæ¯ä»¥åŠæ¶ˆè´¹è€…ç»„æ˜¯å¦‚ä½•æ¥å—æ¶ˆæ¯ï¼š</p><p>åœ¨RocketMQ ä¸­ï¼ŒNameServer è´Ÿè´£æœåŠ¡å‘ç°å’Œè·¯ç”±ç®¡ç†ï¼Œå½“ç”Ÿäº§è€…ç»„å‘é€æŸä¸€ä¸ªä¸»é¢˜çš„æ¶ˆæ¯æ—¶å€™ï¼ŒProducer Groups ä¼šå…ˆä» NameServer è·å–åˆ° Topic ä¸»é¢˜æ¶ˆæ¯ æ‰€åœ¨çš„ Broker ä¿¡æ¯ï¼Œæ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œç”Ÿäº§è€…ç»„ä¼šå‘é€æ¶ˆæ¯åˆ°æ­£ç¡®çš„ Broker å’Œ å¯¹åº”çš„é˜Ÿåˆ—ä¸­ã€‚</p><p>é‡Œé¢çš„ä¸€ä¸ªæ ¸å¿ƒè§‚ç‚¹æ˜¯ Topic ï¼Œä¸ªäººç†è§£ä¸»é¢˜Topic æ˜¯ å°†Queueè¿›è¡Œåˆ†ç±»ï¼Œç±»ä¼¼åˆ†ç»„ã€æ ‡ç­¾ï¼ˆé€»è¾‘ä¸Šï¼‰</p><p>è€Œ Queue çš„å®é™…ä½œç”¨æ˜¯ ç‰©ç†å®é™…åˆ†åŒºï¼Œæ¶ˆæ¯çš„å®é™…å­˜å‚¨åœ°æ–¹ï¼›æ¶ˆæ¯å‘é€åˆ°æ­£ç¡®çš„ Broker åï¼ŒBroker ä¼šè´Ÿè´£å°†æ¶ˆæ¯<strong>ä¿å­˜åœ¨</strong>ç›¸åº”çš„é˜Ÿåˆ—ä¸­ã€‚</p><p>Consumer Groups ä¼šä»NameServer æŸ¥è¯¢ Broker çš„ä¿¡æ¯ï¼ˆä» NameServer æ¥æ‰¾åˆ°æ‰˜ç®¡è¯¥ Topic çš„ Brokerï¼‰ï¼Œè®¢é˜…å¯¹åº”ä¸»é¢˜çš„æ¶ˆæ¯ï¼Œå½“ ä¸€æ—¦ Broker ä¸­çš„ Topic æ”¶åˆ°æ¶ˆæ¯ï¼Œå°±å¯ä»¥æ¥æ”¶åˆ°å¯¹åº”æ¶ˆæ¯ã€‚</p><h4 id="è·¯ç”±æ³¨å†Œ"><a href="#è·¯ç”±æ³¨å†Œ" class="headerlink" title="è·¯ç”±æ³¨å†Œ"></a>è·¯ç”±æ³¨å†Œ</h4><ul><li>NameServer æ¯éš” 10 s æ‰«æ Broker Live Table </li><li>æ£€æŸ¥ä¸Šæ¬¡å¿ƒè·³æ—¶é—´ä¸å½“å‰æ—¶é—´çš„æ—¶å·®ï¼Œå¦‚æœè¶…è¿‡ 120 sï¼Œåˆ™è®¤ä¸º Broker ä¸å¯ç”¨ï¼Œç§»é™¤è·¯ç”±è¡¨ä¸­ Broker ç›¸å…³çš„ä¿¡æ¯<ul><li>Broker ä¸€èˆ¬ä¼šæ¯éš” 30s å‘ NameServer æŠ¥å‘Šæ˜¯å¦å­˜æ´»</li></ul></li></ul><h4 id="è·¯ç”±å‰”é™¤"><a href="#è·¯ç”±å‰”é™¤" class="headerlink" title="è·¯ç”±å‰”é™¤"></a>è·¯ç”±å‰”é™¤</h4><ul><li>å®šæ—¶æ‰«æåˆ¤æ–­è¯¥è·¯ç”±èŠ‚ç‚¹æ˜¯å¦å¯ç”¨</li></ul><h4 id="RocketMQçš„æ•´ä½“å·¥ä½œæµç¨‹-ğŸš©"><a href="#RocketMQçš„æ•´ä½“å·¥ä½œæµç¨‹-ğŸš©" class="headerlink" title="RocketMQçš„æ•´ä½“å·¥ä½œæµç¨‹  ğŸš©"></a>RocketMQçš„æ•´ä½“å·¥ä½œæµç¨‹  ğŸš©</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308105913.png" alt="image.png"></p><p>ç®€å•æ¥è¯´ï¼ŒRocketMQæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯<code>æ¶ˆæ¯é˜Ÿåˆ—</code>+<code>åˆ†å¸ƒå¼ç³»ç»Ÿ</code>ã€‚</p><p>ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒæ˜¯<code>å‘</code>-<code>å­˜</code>-<code>æ”¶</code>çš„ä¸€ä¸ªæ¨¡å‹ï¼Œå¯¹åº”çš„å°±æ˜¯Producerã€Brokerã€Cosumerï¼›ä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå®ƒè¦æœ‰æœåŠ¡ç«¯ã€å®¢æˆ·ç«¯ã€æ³¨å†Œä¸­å¿ƒï¼Œå¯¹åº”çš„å°±æ˜¯Brokerã€Producer&#x2F;Consumerã€NameServer</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308105905.png" alt="image.png"></p><h4 id="RocketMQ-çš„è´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•å®ç°çš„"><a href="#RocketMQ-çš„è´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="RocketMQ çš„è´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•å®ç°çš„"></a>RocketMQ çš„è´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•å®ç°çš„</h4><p>RocketMQå®ç°äº†å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼ŒåŒ…æ‹¬ç”Ÿäº§è€…ï¼ˆProducerï¼‰å’Œæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ä¸¤ä¸ªæ–¹é¢ã€‚</p><p>ç”Ÿäº§è€…</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308201331.png" alt="image.png"></p><p>æ¶ˆè´¹è€…</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308201406.png" alt="image.png"></p><ul><li>åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—è¢«å‡åŒ€åœ°åˆ†é…ç»™åŒä¸€ä¸ªæ¶ˆè´¹ç»„å†…çš„æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œç¡®ä¿åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—åªè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚</li><li>åœ¨å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…éƒ½ä¼šæ¶ˆè´¹åˆ°æ‰€æœ‰çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li></ul><h4 id="æ¶ˆæ¯é•¿è½®è¯¢"><a href="#æ¶ˆæ¯é•¿è½®è¯¢" class="headerlink" title="æ¶ˆæ¯é•¿è½®è¯¢"></a>æ¶ˆæ¯é•¿è½®è¯¢</h4><p>æ¶ˆæ¯é•¿è½®è¯¢ä¼˜åŒ–äº†æ¶ˆæ¯æ‹‰å–çš„è¿‡ç¨‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308200609.png" alt="image.png"></p><h3 id="ä¸‰ã€åŠŸèƒ½å®ç°å’Œå¸¸ç”¨æ¦‚å¿µ"><a href="#ä¸‰ã€åŠŸèƒ½å®ç°å’Œå¸¸ç”¨æ¦‚å¿µ" class="headerlink" title="ä¸‰ã€åŠŸèƒ½å®ç°å’Œå¸¸ç”¨æ¦‚å¿µ"></a>ä¸‰ã€åŠŸèƒ½å®ç°å’Œå¸¸ç”¨æ¦‚å¿µ</h3><h4 id="Topic-å’Œ-Queue-çš„å…³ç³»"><a href="#Topic-å’Œ-Queue-çš„å…³ç³»" class="headerlink" title="Topic å’Œ Queue çš„å…³ç³»"></a>Topic å’Œ Queue çš„å…³ç³»</h4><blockquote><p>Topic Data â†‘  Queue Num â†‘</p></blockquote><p>å½“æŸä¸ª <code>Topic</code> æ¶ˆæ¯é‡å¾ˆå¤§ï¼Œåº”è¯¥ç»™å®ƒå¤šé…ç½®å‡ ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ä¸” <strong>å°½é‡å¤šåˆ†å¸ƒåœ¨ä¸åŒ <code>Broker</code> ä¸Šï¼Œä»¥å‡è½»æŸä¸ª <code>Broker</code> çš„å‹åŠ›</strong> ã€‚</p><p><code>Topic</code> æ¶ˆæ¯é‡éƒ½æ¯”è¾ƒå‡åŒ€çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæŸä¸ª <code>broker</code> ä¸Šçš„é˜Ÿåˆ—è¶Šå¤šï¼Œåˆ™è¯¥ <code>broker</code> å‹åŠ›è¶Šå¤§ã€‚</p><h4 id="æ¶ˆè´¹è€…å’ŒQueue-çš„å…³ç³»"><a href="#æ¶ˆè´¹è€…å’ŒQueue-çš„å…³ç³»" class="headerlink" title="æ¶ˆè´¹è€…å’ŒQueue çš„å…³ç³»"></a>æ¶ˆè´¹è€…å’ŒQueue çš„å…³ç³»</h4><blockquote><p>Advice  Num(Consumer) &#x3D; Num(Queue)</p></blockquote><p>é€šå¸¸å»ºè®®æ¶ˆè´¹è€…ç»„ä¸­çš„æ¶ˆè´¹è€…æ•°é‡ä¸ä¸»é¢˜ä¸­çš„é˜Ÿåˆ—æ•°é‡ä¿æŒä¸€è‡´</p><ul><li>è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æœ€å¤§åŒ–å¹¶è¡Œå¤„ç†çš„æ•ˆç‡ã€‚<ul><li>å¦‚æœæ¶ˆè´¹è€…çš„æ•°é‡å¤šäºé˜Ÿåˆ—çš„æ•°é‡ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€äº›æ¶ˆè´¹è€…å®é™…ä¸Šæ²¡æœ‰åˆ†é…åˆ°é˜Ÿåˆ—ï¼Œä»è€Œé—²ç½®ã€‚</li><li>ç›¸åï¼Œå¦‚æœæ¶ˆè´¹è€…çš„æ•°é‡å°‘äºé˜Ÿåˆ—çš„æ•°é‡ï¼ŒæŸäº›é˜Ÿåˆ—å¯èƒ½ä¸ä¼šè¢«åŠæ—¶æ¶ˆè´¹ï¼Œå¯¼è‡´æ¶ˆæ¯ç§¯å‹ã€‚</li></ul></li></ul><blockquote><p><strong>æ¯ä¸ªæ¶ˆè´¹ç»„åœ¨æ¯ä¸ªé˜Ÿåˆ—ä¸Šç»´æŠ¤ä¸€ä¸ªæ¶ˆè´¹ä½ç½®</strong>Â </p></blockquote><ul><li><strong>Offset çš„ä½œç”¨</strong>ï¼šæ¶ˆè´¹ä½ç§»æ˜¯æŒ‡æ¶ˆè´¹è€…åœ¨é˜Ÿåˆ—ä¸­æ¶ˆè´¹åˆ°çš„ä½ç½®ã€‚å®ƒç”¨äºè·Ÿè¸ªæ¶ˆè´¹è€…å·²ç»æ¶ˆè´¹åˆ°å“ªé‡Œï¼Œä»¥ä¾¿åœ¨æ¶ˆè´¹è€…é‡å¯æˆ–æ•…éšœåèƒ½å¤Ÿä»ä¸Šæ¬¡çš„ä½ç½®ç»§ç»­æ¶ˆè´¹ã€‚</li><li><strong>è°æ¥ç»´æŠ¤</strong>ï¼šè¿™ä¸ªä½ç§»æ˜¯ç”± Broker ç»´æŠ¤çš„ã€‚æ¶ˆè´¹è€…åœ¨å¤„ç†å®Œæ¶ˆæ¯åï¼Œä¼šå‘ Broker æŠ¥å‘Šè‡ªå·±çš„æ¶ˆè´¹ä½ç§»ã€‚</li><li><strong>æ¶ˆæ¯çš„ä¿ç•™</strong>ï¼šé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯é€šå¸¸ä¼šåœ¨æ‰€æœ‰æ¶ˆè´¹è€…ç»„æ¶ˆè´¹ä¹‹åæ‰ä¼šè¢«åˆ é™¤ã€‚è¿™æ„å‘³ç€ï¼Œåªè¦æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ç»„è¿˜æ²¡æœ‰æ¶ˆè´¹æŸæ¡æ¶ˆæ¯ï¼Œè¿™æ¡æ¶ˆæ¯å°±ä¼šè¢«ä¿ç•™åœ¨é˜Ÿåˆ—ä¸­ã€‚</li></ul><h4 id="æ¶ˆæ¯çš„æŒä¹…åŒ–å’Œåˆ é™¤"><a href="#æ¶ˆæ¯çš„æŒä¹…åŒ–å’Œåˆ é™¤" class="headerlink" title="æ¶ˆæ¯çš„æŒä¹…åŒ–å’Œåˆ é™¤"></a>æ¶ˆæ¯çš„æŒä¹…åŒ–å’Œåˆ é™¤</h4><blockquote><p>æ¦‚å¿µï¼šæ¶ˆæ¯çš„å­˜å‚¨å’Œåˆ é™¤</p></blockquote><ul><li><strong>æ•°æ®çš„æŒä¹…åŒ–</strong>ï¼šBroker è´Ÿè´£æ¶ˆæ¯çš„å­˜å‚¨ã€‚åªè¦æ¶ˆæ¯è¿˜æ²¡æœ‰è¢«æ‰€æœ‰è®¢é˜…çš„æ¶ˆè´¹è€…ç»„æ¶ˆè´¹ï¼Œå®ƒå°±ä¼šä¸€ç›´å­˜å‚¨åœ¨ Broker ä¸­ã€‚</li><li><strong>æ¶ˆæ¯çš„åˆ é™¤</strong>ï¼šæ¶ˆæ¯é€šå¸¸åœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶åæ‰ä¼šè¢«åˆ é™¤ï¼Œä¾‹å¦‚ï¼Œå½“æ‰€æœ‰æ¶ˆè´¹è€…ç»„éƒ½æ¶ˆè´¹äº†è¯¥æ¶ˆæ¯ï¼Œæˆ–è€…æ¶ˆæ¯è¾¾åˆ°äº†å…¶å­˜å‚¨çš„æœ€å¤§æ—¶é—´ï¼ˆå¦‚è®¾ç½®äº†æ¶ˆæ¯çš„å­˜å‚¨æ—¶é•¿ï¼‰ã€‚</li></ul><h4 id="Topic-å’Œ-Queue-çš„å…³ç³»-1"><a href="#Topic-å’Œ-Queue-çš„å…³ç³»-1" class="headerlink" title="Topic å’Œ Queue çš„å…³ç³»"></a>Topic å’Œ Queue çš„å…³ç³»</h4><blockquote><p>ä¸ºä»€ä¹ˆä¸€ä¸ªä¸»é¢˜ä¸­éœ€è¦ç»´æŠ¤å¤šä¸ªé˜Ÿåˆ—ï¼Ÿ</p></blockquote><ol><li><strong>æé«˜å¹¶å‘èƒ½åŠ›</strong>ï¼šåœ¨ä¸€ä¸ªä¸»é¢˜ä¸‹é…ç½®å¤šä¸ªé˜Ÿåˆ—çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜æ¶ˆæ¯å¤„ç†çš„å¹¶å‘èƒ½åŠ›ã€‚è¿™å…è®¸å¤šä¸ªç”Ÿäº§è€…åŒæ—¶å‘ä¸åŒçš„é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼ŒåŒæ—¶ä¹Ÿå…è®¸å¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œåœ°ä»ä¸åŒé˜Ÿåˆ—ä¸­æ‹‰å–å’Œå¤„ç†æ¶ˆæ¯ã€‚</li><li><strong>è´Ÿè½½å‡è¡¡å’Œæ•ˆç‡</strong>ï¼šå¦‚æœä¸€ä¸ªä¸»é¢˜åªæœ‰ä¸€ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šè¢«é¡ºåºåœ°æ”¾å…¥è¿™ä¸ªå•ä¸€çš„é˜Ÿåˆ—ä¸­ï¼Œè¿™é™åˆ¶äº†å¹¶è¡Œå¤„ç†çš„å¯èƒ½æ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿æœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œä¹Ÿåªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…åœ¨ä»»ä½•ç»™å®šæ—¶é—´å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œä»è€Œé™ä½äº†æ•´ä½“çš„å¤„ç†æ•ˆç‡ã€‚</li></ol><h4 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h4><blockquote><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼ˆè´Ÿè½½å‡è¡¡è½¬å‘åˆ° Broker  ï¼‰</p></blockquote><p>åœ¨RocketMQä¸­ï¼Œä¸€æ¡æ¶ˆæ¯åœ¨æ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸ä¼šè¢«å‘é€åˆ°å¤šä¸ªBrokerçš„</p><p>æ‰€è°“çš„è´Ÿè½½å‡è¡¡ä¸€èˆ¬æŒ‡çš„æ˜¯ï¼šè½®è¯¢ï¼Œéšæœºå’Œå…¶ä»–ç­–ç•¥</p><p>ç„¶åå‘é€ç»™æŸä¸€ä¸ª Broker ï¼Œä½†æ˜¯è¿™ä¸ª Broker å¦‚æœæ˜¯ä¸»ä»çš„è¯ï¼Œå°±æ˜¯æ¶ˆæ¯é»˜è®¤å‘é€åˆ°MasterèŠ‚ç‚¹ï¼ŒMasterèŠ‚ç‚¹è´Ÿè´£å°†æ¶ˆæ¯å¤åˆ¶åˆ°SlaveèŠ‚ç‚¹ã€‚</p><h4 id="æ¨æ‹‰æ¨¡å¼"><a href="#æ¨æ‹‰æ¨¡å¼" class="headerlink" title="æ¨æ‹‰æ¨¡å¼"></a>æ¨æ‹‰æ¨¡å¼</h4><blockquote><p>æ¶ˆè´¹è€…çš„æ‹‰å–è¯·æ±‚</p></blockquote><p>å®é™…éƒ½æ˜¯ä¸»åŠ¨æ‹‰å–çš„ï¼Œä¸è¿‡æ¶ˆè´¹è€…ç«¯çš„æ¨é€æ˜¯æœ‰ä¸€ä¸ªç›‘å¬æœºåˆ¶ï¼ˆå®šæ—¶æ‹‰å–ï¼Œä¸è¿‡å¯¹äºç”¨æˆ·æ¥è¯´è¿™ä¸ªè¿‡ç¨‹æ˜¯éšè—çš„ï¼‰</p><p>RocketMQ é‡‡ç”¨çš„æ˜¯æ‹‰æ¨¡å¼ã€‚</p><h4 id="å›æº¯æ¶ˆè´¹"><a href="#å›æº¯æ¶ˆè´¹" class="headerlink" title="å›æº¯æ¶ˆè´¹"></a>å›æº¯æ¶ˆè´¹</h4><blockquote><p>å®˜æ–¹æ–‡æ¡£è§£é‡Š</p></blockquote><p>å›æº¯æ¶ˆè´¹æ˜¯æŒ‡ <code>Consumer</code> å·²ç»æ¶ˆè´¹æˆåŠŸçš„æ¶ˆæ¯ï¼Œç”±äºä¸šåŠ¡ä¸Šéœ€æ±‚éœ€è¦é‡æ–°æ¶ˆè´¹ï¼Œ</p><p>åœ¨<code>RocketMQ</code> ä¸­ï¼Œ <code>Broker</code> åœ¨å‘<code>Consumer</code> æŠ•é€’æˆåŠŸæ¶ˆæ¯åï¼Œ<strong>æ¶ˆæ¯ä»ç„¶éœ€è¦ä¿ç•™</strong> ã€‚å¹¶ä¸”é‡æ–°æ¶ˆè´¹ä¸€èˆ¬æ˜¯æŒ‰ç…§æ—¶é—´ç»´åº¦ï¼Œä¾‹å¦‚ç”±äº <code>Consumer</code> ç³»ç»Ÿæ•…éšœï¼Œæ¢å¤åéœ€è¦é‡æ–°æ¶ˆè´¹ 1 å°æ—¶å‰çš„æ•°æ®ï¼Œé‚£ä¹ˆ <code>Broker</code> è¦æä¾›ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥æŒ‰ç…§æ—¶é—´ç»´åº¦æ¥å›é€€æ¶ˆè´¹è¿›åº¦ã€‚<code>RocketMQ</code> æ”¯æŒæŒ‰ç…§æ—¶é—´å›æº¯æ¶ˆè´¹ï¼Œæ—¶é—´ç»´åº¦ç²¾ç¡®åˆ°æ¯«ç§’ã€‚</p><h4 id="ç”Ÿäº§è€…åˆ†ç»„"><a href="#ç”Ÿäº§è€…åˆ†ç»„" class="headerlink" title="ç”Ÿäº§è€…åˆ†ç»„"></a>ç”Ÿäº§è€…åˆ†ç»„</h4><p>å¾…æ•´ç†ä¸€ä¸‹</p><p>æ¶ˆè´¹è€…åˆ†ç»„  ğŸ¦Œ</p><ul><li>PushConsumer</li><li>SimpleConsumer</li><li>PullConsumer</li></ul><p>ç”Ÿäº§è€…åˆ†ç»„å’Œæ¶ˆè´¹è€…åˆ†ç»„</p><blockquote><p>ç”Ÿäº§è€…åˆ†ç»„</p></blockquote><ol><li><strong>RocketMQ 5.x ç‰ˆæœ¬åŠä»¥å</strong>ï¼š<ul><li>ç”Ÿäº§è€…ç°åœ¨æ˜¯â€œåŒ¿åâ€çš„ï¼Œå³ä¸å†å¼ºè°ƒç”Ÿäº§è€…åˆ†ç»„ï¼ˆProducerGroupï¼‰çš„æ¦‚å¿µã€‚</li><li>åœ¨æœåŠ¡ç«¯ï¼Œç”Ÿäº§è€…ä¸éœ€è¦æ˜¾å¼åœ°é…ç½®ä¸ºç‰¹å®šçš„åˆ†ç»„ï¼Œè¿™ç®€åŒ–äº†ç”Ÿäº§è€…çš„ç®¡ç†ã€‚</li></ul></li><li><strong>RocketMQ 3.x å’Œ 4.x ç‰ˆæœ¬</strong>ï¼š<ul><li>åœ¨è¿™äº›å†å²ç‰ˆæœ¬ä¸­ï¼Œç”Ÿäº§è€…åˆ†ç»„æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œç”¨äºæ ‡è¯†å’Œç®¡ç†ä¸€ç»„æœ‰ç€ç›¸åŒè¡Œä¸ºçš„ç”Ÿäº§è€…ã€‚</li><li>å¦‚æœä½ æ˜¯ä»è¿™äº›æ—§ç‰ˆæœ¬å‡çº§åˆ° 5.xï¼Œé‚£ä¹ˆä¹‹å‰ä½¿ç”¨çš„ç”Ÿäº§è€…åˆ†ç»„å¯ä»¥åºŸå¼ƒï¼Œä¸å†éœ€è¦è®¾ç½®ï¼Œä¸”ä¸ä¼šå½±å“å½“å‰ä¸šåŠ¡ã€‚</li></ul></li></ol><blockquote><p>æ¶ˆè´¹è€…åˆ†ç»„</p></blockquote><ol><li><strong>æ¦‚å¿µ</strong>ï¼š<ul><li>æ¶ˆè´¹è€…åˆ†ç»„æ˜¯å¤šä¸ªæ¶ˆè´¹è€…çš„ä¸€ä¸ªé€»è¾‘åˆ†ç»„ï¼Œè¿™äº›æ¶ˆè´¹è€…æœ‰ç€ä¸€è‡´çš„æ¶ˆè´¹è¡Œä¸ºã€‚</li><li>é€šè¿‡æ¶ˆè´¹è€…åˆ†ç»„ï¼Œå¯ä»¥å®ç°æ¶ˆè´¹è¡Œä¸ºçš„è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ã€‚</li></ul></li><li><strong>åŠŸèƒ½</strong>ï¼š<ul><li><strong>è®¢é˜…å…³ç³»ç®¡ç†</strong>ï¼šRocketMQ ä»¥æ¶ˆè´¹è€…åˆ†ç»„çš„ç²’åº¦æ¥ç®¡ç†å’Œè¿½æº¯è®¢é˜…å…³ç³»ã€‚</li><li><strong>æŠ•é€’é¡ºåºæ€§</strong>ï¼šæœåŠ¡ç«¯æ”¯æŒé¡ºåºæŠ•é€’å’Œå¹¶å‘æŠ•é€’ï¼Œè¿™äº›æŠ•é€’æ–¹å¼åœ¨æ¶ˆè´¹è€…åˆ†ç»„ä¸­ç»Ÿä¸€é…ç½®ã€‚</li><li><strong>æ¶ˆè´¹é‡è¯•ç­–ç•¥</strong>ï¼šåŒ…æ‹¬é‡è¯•æ¬¡æ•°å’Œæ­»ä¿¡é˜Ÿåˆ—çš„è®¾ç½®ï¼Œç”¨äºå¤„ç†æ¶ˆè´¹å¤±è´¥çš„æƒ…å†µã€‚</li></ul></li><li><strong>ç‰ˆæœ¬å·®å¼‚</strong>ï¼š<ul><li><strong>5.x ç‰ˆæœ¬</strong>ï¼šæ¶ˆè´¹è€…çš„æ¶ˆè´¹è¡Œä¸ºç»Ÿä¸€ç”±å…³è”çš„æ¶ˆè´¹è€…åˆ†ç»„åœ¨æœåŠ¡ç«¯é…ç½®å’Œç®¡ç†ï¼Œç¡®ä¿åŒä¸€åˆ†ç»„å†…æ‰€æœ‰æ¶ˆè´¹è€…çš„è¡Œä¸ºä¸€è‡´ã€‚</li><li><strong>3.x&#x2F;4.x å†å²ç‰ˆæœ¬</strong>ï¼šæ¶ˆè´¹è¡Œä¸ºç”±æ¶ˆè´¹è€…å®¢æˆ·ç«¯æ¥å£å®šä¹‰ï¼Œéœ€è¦åœ¨æ¶ˆè´¹è€…å®¢æˆ·ç«¯è®¾ç½®æ—¶ç¡®ä¿åŒä¸€åˆ†ç»„ä¸‹çš„æ¶ˆè´¹è€…è¡Œä¸ºä¸€è‡´ã€‚</li></ul></li></ol><p>RocketMQ 5.x ç‰ˆæœ¬ä¸­å¯¹ç”Ÿäº§è€…åˆ†ç»„çš„æ¦‚å¿µè¿›è¡Œäº†ç®€åŒ–ï¼Œä½¿å…¶æˆä¸ºåŒ¿åçš„ï¼Œè€Œæ¶ˆè´¹è€…åˆ†ç»„åˆ™ä»ç„¶æ˜¯ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼Œç”¨äºç®¡ç†æ¶ˆè´¹è€…çš„è¡Œä¸ºå’Œç­–ç•¥ã€‚</p><h4 id="æ¶ˆè´¹è€…åˆ†ç»„"><a href="#æ¶ˆè´¹è€…åˆ†ç»„" class="headerlink" title="æ¶ˆè´¹è€…åˆ†ç»„"></a>æ¶ˆè´¹è€…åˆ†ç»„</h4><h3 id="å››ã€RocketMQæ”¯æŒçš„æ¶ˆæ¯ç±»å‹"><a href="#å››ã€RocketMQæ”¯æŒçš„æ¶ˆæ¯ç±»å‹" class="headerlink" title="å››ã€RocketMQæ”¯æŒçš„æ¶ˆæ¯ç±»å‹"></a>å››ã€RocketMQæ”¯æŒçš„æ¶ˆæ¯ç±»å‹</h3><p>åœ¨ RocketMQ ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨çš„æ˜¯æ™®é€šæ¶ˆæ¯ï¼Œè¿˜æœ‰å®šæ—¶æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ï¼›ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥äº†è§£ä¸€ä¸‹å…·ä½“çš„ä¸€äº›ä½¿ç”¨ã€‚</p><blockquote><p>æ™®é€šæ¶ˆæ¯</p></blockquote><ul><li><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šé€‚ç”¨äºå¤§å¤šæ•°æ ‡å‡†çš„æ¶ˆæ¯ä¼ é€’éœ€æ±‚ï¼Œå¦‚å¼‚æ­¥å¤„ç†ã€ç³»ç»Ÿè§£è€¦ã€æ•°æ®åˆ†å‘ç­‰ã€‚</li><li><strong>ä½¿ç”¨</strong>ï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šçš„ä¸»é¢˜ï¼ˆTopicï¼‰ï¼Œæ¶ˆè´¹è€…ä»ä¸»é¢˜è®¢é˜…å¹¶å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚æ¶ˆæ¯æŒ‰ç…§åˆ°è¾¾ Broker çš„é¡ºåºå­˜å‚¨ã€‚</li></ul><p><strong>æ™®é€šæ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸ</strong></p><ul><li>åˆå§‹åŒ–ï¼šæ¶ˆæ¯è¢«ç”Ÿäº§è€…æ„å»ºå¹¶å®Œæˆåˆå§‹åŒ–ï¼Œå¾…å‘é€åˆ°æœåŠ¡ç«¯çš„çŠ¶æ€ã€‚</li><li>å¾…æ¶ˆè´¹ï¼šæ¶ˆæ¯è¢«å‘é€åˆ°æœåŠ¡ç«¯ï¼Œå¯¹æ¶ˆè´¹è€…å¯è§ï¼Œç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹çš„çŠ¶æ€ã€‚</li><li>æ¶ˆè´¹ä¸­ï¼šæ¶ˆæ¯è¢«æ¶ˆè´¹è€…è·å–ï¼Œå¹¶æŒ‰ç…§æ¶ˆè´¹è€…æœ¬åœ°çš„ä¸šåŠ¡é€»è¾‘è¿›è¡Œå¤„ç†çš„è¿‡ç¨‹ã€‚ æ­¤æ—¶æœåŠ¡ç«¯ä¼šç­‰å¾…æ¶ˆè´¹è€…å®Œæˆæ¶ˆè´¹å¹¶æäº¤æ¶ˆè´¹ç»“æœï¼Œå¦‚æœä¸€å®šæ—¶é—´åæ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„å“åº”ï¼ŒRocketMQ ä¼šå¯¹æ¶ˆæ¯è¿›è¡Œé‡è¯•å¤„ç†ã€‚</li><li>æ¶ˆè´¹æäº¤ï¼šæ¶ˆè´¹è€…å®Œæˆæ¶ˆè´¹å¤„ç†ï¼Œå¹¶å‘æœåŠ¡ç«¯æäº¤æ¶ˆè´¹ç»“æœï¼ŒæœåŠ¡ç«¯æ ‡è®°å½“å‰æ¶ˆæ¯å·²ç»è¢«å¤„ç†ï¼ˆåŒ…æ‹¬æ¶ˆè´¹æˆåŠŸå’Œå¤±è´¥ï¼‰ã€‚RocketMQ é»˜è®¤æ”¯æŒä¿ç•™æ‰€æœ‰æ¶ˆæ¯ï¼Œæ­¤æ—¶æ¶ˆæ¯æ•°æ®å¹¶ä¸ä¼šç«‹å³è¢«åˆ é™¤ï¼Œåªæ˜¯é€»è¾‘æ ‡è®°å·²æ¶ˆè´¹ã€‚æ¶ˆæ¯åœ¨ä¿å­˜æ—¶é—´åˆ°æœŸæˆ–å­˜å‚¨ç©ºé—´ä¸è¶³è¢«åˆ é™¤å‰ï¼Œæ¶ˆè´¹è€…ä»ç„¶å¯ä»¥å›æº¯æ¶ˆæ¯é‡æ–°æ¶ˆè´¹ã€‚</li><li>æ¶ˆæ¯åˆ é™¤ï¼šRocketMQ æŒ‰ç…§æ¶ˆæ¯ä¿å­˜æœºåˆ¶æ»šåŠ¨æ¸…ç†æœ€æ—©çš„æ¶ˆæ¯æ•°æ®ï¼Œå°†æ¶ˆæ¯ä»ç‰©ç†æ–‡ä»¶ä¸­åˆ é™¤ã€‚</li></ul><h4 id="å®šæ—¶æ¶ˆæ¯"><a href="#å®šæ—¶æ¶ˆæ¯" class="headerlink" title="å®šæ—¶æ¶ˆæ¯"></a>å®šæ—¶æ¶ˆæ¯</h4><ul><li><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šç”¨äºé‚£äº›éœ€è¦åœ¨æŒ‡å®šæ—¶é—´ç‚¹æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¦‚å»¶è¿Ÿé€šçŸ¥ã€å®šæ—¶ä»»åŠ¡ç­‰ã€‚</li><li><strong>ä½¿ç”¨</strong>ï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶æŒ‡å®šä¸€ä¸ªå»¶æ—¶çº§åˆ«ï¼Œæ¶ˆæ¯å°†åœ¨æŒ‡å®šçš„å»¶æ—¶åæ‰è¢«æŠ•é€’ã€‚RocketMQ ä¸æ”¯æŒä»»æ„çš„å»¶æ—¶æ—¶é—´ï¼Œè€Œæ˜¯æä¾›äº†å‡ ä¸ªé¢„è®¾çš„å»¶æ—¶çº§åˆ«ï¼ˆå¦‚1åˆ†é’Ÿã€5åˆ†é’Ÿã€10åˆ†é’Ÿç­‰ï¼‰ã€‚</li></ul><p><strong>å®šæ—¶æ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸ</strong></p><ul><li>åˆå§‹åŒ–ï¼šæ¶ˆæ¯è¢«ç”Ÿäº§è€…æ„å»ºå¹¶å®Œæˆåˆå§‹åŒ–ï¼Œå¾…å‘é€åˆ°æœåŠ¡ç«¯çš„çŠ¶æ€ã€‚</li><li>å®šæ—¶ä¸­ï¼šæ¶ˆæ¯è¢«å‘é€åˆ°æœåŠ¡ç«¯ï¼Œå’Œæ™®é€šæ¶ˆæ¯ä¸åŒçš„æ˜¯ï¼ŒæœåŠ¡ç«¯ä¸ä¼šç›´æ¥æ„å»ºæ¶ˆæ¯ç´¢å¼•ï¼Œè€Œæ˜¯ä¼šå°†å®šæ—¶æ¶ˆæ¯<strong>å•ç‹¬å­˜å‚¨åœ¨å®šæ—¶å­˜å‚¨ç³»ç»Ÿä¸­</strong>ï¼Œç­‰å¾…å®šæ—¶æ—¶åˆ»åˆ°è¾¾ã€‚</li><li>å¾…æ¶ˆè´¹ï¼šå®šæ—¶æ—¶åˆ»åˆ°è¾¾åï¼ŒæœåŠ¡ç«¯å°†æ¶ˆæ¯é‡æ–°å†™å…¥æ™®é€šå­˜å‚¨å¼•æ“ï¼Œå¯¹ä¸‹æ¸¸æ¶ˆè´¹è€…å¯è§ï¼Œç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹çš„çŠ¶æ€ã€‚</li><li>æ¶ˆè´¹ä¸­ï¼šæ¶ˆæ¯è¢«æ¶ˆè´¹è€…è·å–ï¼Œå¹¶æŒ‰ç…§æ¶ˆè´¹è€…æœ¬åœ°çš„ä¸šåŠ¡é€»è¾‘è¿›è¡Œå¤„ç†çš„è¿‡ç¨‹ã€‚ æ­¤æ—¶æœåŠ¡ç«¯ä¼šç­‰å¾…æ¶ˆè´¹è€…å®Œæˆæ¶ˆè´¹å¹¶æäº¤æ¶ˆè´¹ç»“æœï¼Œå¦‚æœä¸€å®šæ—¶é—´åæ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„å“åº”ï¼ŒRocketMQ ä¼šå¯¹æ¶ˆæ¯è¿›è¡Œé‡è¯•å¤„ç†ã€‚</li><li>æ¶ˆè´¹æäº¤ï¼šæ¶ˆè´¹è€…å®Œæˆæ¶ˆè´¹å¤„ç†ï¼Œå¹¶å‘æœåŠ¡ç«¯æäº¤æ¶ˆè´¹ç»“æœï¼ŒæœåŠ¡ç«¯æ ‡è®°å½“å‰æ¶ˆæ¯å·²ç»è¢«å¤„ç†ï¼ˆåŒ…æ‹¬æ¶ˆè´¹æˆåŠŸå’Œå¤±è´¥ï¼‰ã€‚RocketMQ é»˜è®¤æ”¯æŒä¿ç•™æ‰€æœ‰æ¶ˆæ¯ï¼Œæ­¤æ—¶æ¶ˆæ¯æ•°æ®å¹¶ä¸ä¼šç«‹å³è¢«åˆ é™¤ï¼Œåªæ˜¯é€»è¾‘æ ‡è®°å·²æ¶ˆè´¹ã€‚æ¶ˆæ¯åœ¨ä¿å­˜æ—¶é—´åˆ°æœŸæˆ–å­˜å‚¨ç©ºé—´ä¸è¶³è¢«åˆ é™¤å‰ï¼Œæ¶ˆè´¹è€…ä»ç„¶å¯ä»¥å›æº¯æ¶ˆæ¯é‡æ–°æ¶ˆè´¹ã€‚</li><li>æ¶ˆæ¯åˆ é™¤ï¼šApache RocketMQ æŒ‰ç…§æ¶ˆæ¯ä¿å­˜æœºåˆ¶æ»šåŠ¨æ¸…ç†æœ€æ—©çš„æ¶ˆæ¯æ•°æ®ï¼Œå°†æ¶ˆæ¯ä»ç‰©ç†æ–‡ä»¶ä¸­åˆ é™¤ã€‚</li></ul><p>å®šæ—¶æ¶ˆæ¯çš„å®ç°é€»è¾‘éœ€è¦å…ˆç»è¿‡å®šæ—¶å­˜å‚¨ç­‰å¾…è§¦å‘ï¼Œå®šæ—¶æ—¶é—´åˆ°è¾¾åæ‰ä¼šè¢«æŠ•é€’ç»™æ¶ˆè´¹è€…ã€‚å› æ­¤ï¼Œå¦‚æœå°†å¤§é‡å®šæ—¶æ¶ˆæ¯çš„å®šæ—¶æ—¶é—´è®¾ç½®ä¸ºåŒä¸€æ—¶åˆ»ï¼Œåˆ™åˆ°è¾¾è¯¥æ—¶åˆ»åä¼šæœ‰å¤§é‡æ¶ˆæ¯åŒæ—¶éœ€è¦è¢«å¤„ç†ï¼Œä¼šé€ æˆç³»ç»Ÿå‹åŠ›è¿‡å¤§ï¼Œå¯¼è‡´æ¶ˆæ¯åˆ†å‘å»¶è¿Ÿï¼Œå½±å“å®šæ—¶ç²¾åº¦ã€‚</p><h4 id="äº‹åŠ¡æ¶ˆæ¯"><a href="#äº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="äº‹åŠ¡æ¶ˆæ¯"></a>äº‹åŠ¡æ¶ˆæ¯</h4><ul><li><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šé€‚ç”¨äºéœ€è¦ä¿è¯æ¶ˆæ¯å‘é€å’Œæœ¬åœ°äº‹åŠ¡åŒæ—¶æˆåŠŸæˆ–å¤±è´¥çš„åœºæ™¯ï¼Œå¦‚æ”¯ä»˜å’Œè®¢å•æœåŠ¡é—´çš„äº¤äº’ã€‚</li><li><strong>ä½¿ç”¨</strong>ï¼š<ul><li>ç”Ÿäº§è€…å‘é€åŠæ¶ˆæ¯ï¼ˆé¢„å¤‡æ¶ˆæ¯ï¼‰ã€‚</li><li>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼ˆæ¯”å¦‚æ•°æ®åº“æ“ä½œï¼‰ã€‚</li><li>æ ¹æ®æœ¬åœ°äº‹åŠ¡æ‰§è¡Œç»“æœï¼Œæäº¤æˆ–å›æ»šæ¶ˆæ¯ã€‚æäº¤çš„æ¶ˆæ¯å°†è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œå›æ»šçš„æ¶ˆæ¯å°†è¢«åˆ é™¤ã€‚</li></ul></li></ul><h4 id="é¡ºåºæ¶ˆæ¯ï¼ˆé¡ºåºæ¶ˆè´¹ï¼‰-ğŸš©"><a href="#é¡ºåºæ¶ˆæ¯ï¼ˆé¡ºåºæ¶ˆè´¹ï¼‰-ğŸš©" class="headerlink" title="é¡ºåºæ¶ˆæ¯ï¼ˆé¡ºåºæ¶ˆè´¹ï¼‰  ğŸš©"></a>é¡ºåºæ¶ˆæ¯ï¼ˆé¡ºåºæ¶ˆè´¹ï¼‰  ğŸš©</h4><p>é¡ºåºæ¶ˆæ¯åˆ†ä¸ºå…¨å±€é¡ºåºæ¶ˆæ¯å’Œéƒ¨åˆ†é¡ºåºæ¶ˆæ¯ï¼Œå…¨å±€é¡ºåºæ¶ˆæ¯æŒ‡æŸä¸ª Topic ä¸‹çš„æ‰€æœ‰æ¶ˆæ¯éƒ½è¦ä¿è¯é¡ºåºï¼›</p><p>éƒ¨åˆ†é¡ºåºæ¶ˆæ¯åªè¦ä¿è¯æ¯ä¸€ç»„æ¶ˆæ¯è¢«é¡ºåºæ¶ˆè´¹å³å¯ï¼Œæ¯”å¦‚è®¢å•æ¶ˆæ¯ï¼Œåªè¦ä¿è¯åŒä¸€ä¸ªè®¢å• ID ä¸ªæ¶ˆæ¯èƒ½æŒ‰é¡ºåºæ¶ˆè´¹å³å¯ã€‚</p><p>å…¨å±€é¡ºåºæ¶ˆè´¹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308101253.png" alt="image.png"></p><p>éƒ¨åˆ†é¡ºåºæ¶ˆæ¯</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308101347.png" alt="image.png"></p><p>éƒ¨åˆ†é¡ºåºæ¶ˆæ¯ï¼šé¡ºåºæŠ•é€’ï¼Œé¡ºåºæ¶ˆè´¹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308101509.png" alt="image.png"></p><p>å‘é€ç«¯ä½¿ç”¨ MessageQueueSelector ç±»æ¥æ§åˆ¶ æŠŠæ¶ˆæ¯å‘å¾€å“ªä¸ª Message Queue ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308101609.png" alt="image.png"></p><p>æ¶ˆè´¹ç«¯é€šè¿‡ä½¿ç”¨ MessageListenerOrderly æ¥è§£å†³å• Message Queue çš„æ¶ˆæ¯è¢«å¹¶å‘å¤„ç†çš„é—®é¢˜ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308101625.png" alt="image.png"></p><hr><ul><li>åˆ†ä¸ºå…¨å±€æ¶ˆæ¯å’Œåˆ†åŒºæ¶ˆæ¯  </li><li>å…¨å±€æ¶ˆæ¯  <ul><li>å°†ä¸€ä¸ªä¸»é¢˜çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­  </li><li>æ¶ˆè´¹è€…ä»è¿™ä¸ªé˜Ÿåˆ—ä¸­é¡ºåºæ‹‰å–å¹¶æ¶ˆè´¹æ¶ˆæ¯ï¼Œä»è€Œå®ç°å…¨å±€é¡ºåºã€‚</li></ul></li><li>åˆ†åŒºæ¶ˆæ¯  <ul><li>ç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶æŒ‡å®šæ¶ˆæ¯çš„Keyï¼ˆä¸šåŠ¡æ ‡è¯†ï¼‰ï¼ŒRocketMQæ ¹æ®è¿™ä¸ªKeyçš„hashå€¼å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚  </li><li>æ¶ˆè´¹è€…ä»è¿™ä¸ªé˜Ÿåˆ—ä¸­æ‹‰å–æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œç”±äºæ¶ˆæ¯æ˜¯æŒ‰é¡ºåºå‘é€åˆ°é˜Ÿåˆ—çš„ï¼Œæ¶ˆè´¹è€…ä¹Ÿä¼šæŒ‰è¿™ä¸ªé¡ºåºæ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚</li></ul></li><li>åˆ†åŒºæ¶ˆæ¯ä¸€èˆ¬æ˜¯ä¸ºäº†æŸä¸€ä¸ªäº‹ä»¶çš„å…¨é“¾è·¯é¡ºåºï¼Œå…¨å±€æ¶ˆæ¯æ˜¯è¿™ä¸ªç±»å‹çš„å…¨éƒ¨äº‹ä»¶éƒ½é¡ºåºã€‚</li></ul><h4 id="å»¶è¿Ÿæ¶ˆæ¯ï¼ˆå»¶æ—¶é˜Ÿåˆ—ï¼‰"><a href="#å»¶è¿Ÿæ¶ˆæ¯ï¼ˆå»¶æ—¶é˜Ÿåˆ—ï¼‰" class="headerlink" title="å»¶è¿Ÿæ¶ˆæ¯ï¼ˆå»¶æ—¶é˜Ÿåˆ—ï¼‰"></a>å»¶è¿Ÿæ¶ˆæ¯ï¼ˆå»¶æ—¶é˜Ÿåˆ—ï¼‰</h4><p>RocketMQå®ç°å»¶æ—¶æ¶ˆæ¯çš„æ–¹å¼æ˜¯é€šè¿‡é¢„è®¾çš„å»¶æ—¶çº§åˆ«æ¥å®ç°çš„ã€‚å½“å‘é€ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥æŒ‡å®šè¿™æ¡æ¶ˆæ¯çš„å»¶æ—¶çº§åˆ«ã€‚RocketMQå†…éƒ¨å®šä¹‰äº†å¤šä¸ªå»¶æ—¶çº§åˆ«ï¼Œæ¯ä¸ªçº§åˆ«å¯¹åº”ä¸€å®šçš„å»¶æ—¶æ—¶é—´ï¼Œå¦‚1sã€5sã€10sç­‰ã€‚</p><ol><li><strong>è®¾ç½®å»¶æ—¶çº§åˆ«</strong>ï¼šç”Ÿäº§è€…åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè®¾ç½®æ¶ˆæ¯çš„å»¶æ—¶çº§åˆ«å±æ€§ï¼ˆ<code>delayTimeLevel</code>ï¼‰ã€‚</li><li><strong>å­˜å‚¨å»¶æ—¶æ¶ˆæ¯</strong>ï¼šBrokeræ¥æ”¶åˆ°è¿™æ¡å»¶æ—¶æ¶ˆæ¯åï¼Œæ ¹æ®å…¶å»¶æ—¶çº§åˆ«ï¼Œå°†æ¶ˆæ¯å­˜å‚¨åœ¨å¯¹åº”çš„å»¶æ—¶é˜Ÿåˆ—ä¸­ã€‚</li><li><strong>è®¡æ—¶ç­‰å¾…</strong>ï¼šæ¶ˆæ¯åœ¨å»¶æ—¶é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œç›´åˆ°å»¶æ—¶æ—¶é—´è¿‡å»ã€‚</li><li><strong>è½¬ç§»è‡³æ­£å¸¸é˜Ÿåˆ—</strong>ï¼šè¾¾åˆ°å»¶æ—¶æ—¶é—´åï¼Œæ¶ˆæ¯ä¼šä»å»¶æ—¶é˜Ÿåˆ—è½¬ç§»åˆ°æ­£å¸¸çš„æ¶ˆè´¹é˜Ÿåˆ—ä¸­ï¼Œæ­¤æ—¶æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åˆ°è¿™æ¡æ¶ˆæ¯</li></ol><p>RocketMQçš„å»¶æ—¶é˜Ÿåˆ—æä¾›äº†ä¸€ç§ç®€ä¾¿çš„å»¶æ—¶æ¶ˆæ¯å¤„ç†æœºåˆ¶ï¼Œéå¸¸é€‚åˆéœ€è¦æ¶ˆæ¯å®šæ—¶å¤„ç†çš„åº”ç”¨åœºæ™¯ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.apache.rocketmq.client.producer.DefaultMQProducer;<br><span class="hljs-keyword">import</span> org.apache.rocketmq.common.message.Message;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayProducer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// å®ä¾‹åŒ–æ¶ˆæ¯ç”Ÿäº§è€…Producer</span><br>        <span class="hljs-type">DefaultMQProducer</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">&quot;ExampleProducerGroup&quot;</span>);<br>        <span class="hljs-comment">// è®¾ç½®NameServerçš„åœ°å€</span><br>        producer.setNamesrvAddr(<span class="hljs-string">&quot;localhost:9876&quot;</span>);<br>        <span class="hljs-comment">// å¯åŠ¨Producerå®ä¾‹</span><br>        producer.start();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">messageCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; messageCount; i++) &#123;<br>            <span class="hljs-comment">// åˆ›å»ºæ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šTopicï¼ŒTagå’Œæ¶ˆæ¯ä½“</span><br>            <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">&quot;TestTopic&quot;</span>, <span class="hljs-string">&quot;TagA&quot;</span>, (<span class="hljs-string">&quot;Hello RocketMQ &quot;</span> + i).getBytes());<br>            <span class="hljs-comment">// è®¾ç½®å»¶æ—¶çº§åˆ«3ï¼Œè¿™ä¸ªæ—¶é—´å¤§çº¦å»¶æ—¶10s</span><br>            msg.setDelayTimeLevel(<span class="hljs-number">3</span>);<br>            <span class="hljs-comment">// å‘é€æ¶ˆæ¯</span><br>            producer.send(msg);<br>        &#125;<br>        <span class="hljs-comment">// å¦‚æœä¸å†å‘é€æ¶ˆæ¯ï¼Œå…³é—­Producerå®ä¾‹ã€‚</span><br>        producer.shutdown();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæ¶ˆæ¯é€šè¿‡è®¾ç½®<code>setDelayTimeLevel(3)</code>æ¥æŒ‡å®šå»¶æ—¶çº§åˆ«ã€‚RocketMQé¢„å®šä¹‰äº†å¤šä¸ªå»¶æ—¶çº§åˆ«ï¼Œæ¯ä¸ªçº§åˆ«å¯¹åº”ä¸åŒçš„å»¶æ—¶æ—¶é—´ï¼Œä»1såˆ°å‡ ä¸ªå°æ—¶ä¸ç­‰ã€‚å…·ä½“çš„å»¶æ—¶çº§åˆ«å’Œå¯¹åº”çš„æ—¶é—´å¯ä»¥åœ¨RocketMQçš„æ–‡æ¡£ä¸­æ‰¾åˆ°æˆ–é€šè¿‡æŸ¥çœ‹Brokeré…ç½®æ–‡ä»¶ï¼ˆ<code>broker.conf</code>ï¼‰æ¥äº†è§£ã€‚</p><ul><li>å»¶æ—¶æ¶ˆæ¯çš„ä½¿ç”¨éœ€è¦æ³¨æ„ï¼Œå»¶æ—¶çº§åˆ«æ˜¯é¢„è®¾çš„ï¼Œä¸èƒ½è‡ªå®šä¹‰å…·ä½“çš„å»¶æ—¶æ—¶é—´ï¼Œåªèƒ½é€‰æ‹©æœ€æ¥è¿‘çš„å»¶æ—¶çº§åˆ«ã€‚</li><li>å»¶æ—¶æ¶ˆæ¯å¯èƒ½ä¼šå› ä¸ºBrokerçš„é‡å¯è€Œå¯¼è‡´å»¶æ—¶ä¸å‡†ç¡®ã€‚</li><li>ä½¿ç”¨å»¶æ—¶æ¶ˆæ¯æ—¶ï¼Œè¦è€ƒè™‘åˆ°æ¶ˆæ¯çš„å­˜å‚¨é—®é¢˜ï¼Œå› ä¸ºæ¶ˆæ¯åœ¨å»¶æ—¶æœŸé—´ä»å ç”¨å­˜å‚¨ç©ºé—´ã€‚</li></ul><hr><p>åŸç†å®ç°</p><p>å…ˆæš‚å­˜åˆ° SCHEDULE_TOPIC_xxxx çš„ Topic ä¸­</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307102232.png" alt="image.png"></p><h5 id="RocketMQæ€ä¹ˆå®ç°å»¶æ—¶æ¶ˆæ¯çš„ï¼Ÿ"><a href="#RocketMQæ€ä¹ˆå®ç°å»¶æ—¶æ¶ˆæ¯çš„ï¼Ÿ" class="headerlink" title="RocketMQæ€ä¹ˆå®ç°å»¶æ—¶æ¶ˆæ¯çš„ï¼Ÿ"></a>RocketMQæ€ä¹ˆå®ç°å»¶æ—¶æ¶ˆæ¯çš„ï¼Ÿ</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308102037.png" alt="image.png"></p><h4 id="é‡è¯•æ¶ˆæ¯"><a href="#é‡è¯•æ¶ˆæ¯" class="headerlink" title="é‡è¯•æ¶ˆæ¯"></a>é‡è¯•æ¶ˆæ¯</h4><p>é‡è¯•æ¶ˆæ¯å¹¶ä¸æ˜¯æˆ‘ä»¬ä¸šåŠ¡ä¸­ä¸»åŠ¨å‘é€çš„ï¼Œè€Œæ˜¯æŒ‡å½“æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯å¤±è´¥ä¹‹åï¼Œä¼š<strong>é—´éš”ä¸€æ®µæ—¶é—´</strong>ä¹‹åå†æ¬¡æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯</p><p>é‡è¯•çš„æœºåˆ¶åœ¨å¹¶å‘æ¶ˆè´¹æ¨¡å¼å’Œé¡ºåºæ¶ˆè´¹æ¨¡å¼ä¸‹å®ç°çš„åŸç†å¹¶ä¸ç›¸åŒ</p><p><strong>é¡ºåºæ¶ˆè´¹</strong></p><p>å½“æ¶ˆè´¹å¤±è´¥çš„æ—¶å€™ï¼Œä»–å¹¶ä¸ä¼šå°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯ï¼Œè€Œæ˜¯ç›´æ¥åœ¨æœ¬åœ°ç­‰1sé’Ÿä¹‹åé‡è¯•ï¼ˆæ— é™é‡è¯•ï¼‰</p><p>åœ¨è¿™ä¸ªç­‰å¾…çš„æœŸé—´å…¶å®ƒæ¶ˆæ¯æ˜¯ä¸èƒ½è¢«æ¶ˆè´¹çš„</p><p><strong>å¹¶å‘æ¶ˆè´¹</strong></p><p>RocetMQä¼šä¸º<strong>æ¯ä¸ªæ¶ˆè´¹è€…ç»„</strong>åˆ›å»ºä¸€ä¸ªé‡è¯•æ¶ˆæ¯æ‰€åœ¨çš„Topicï¼Œåå­—æ ¼å¼ä¸ºï¼š%RETRY% + æ¶ˆè´¹è€…ç»„åç§°</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æ¶ˆè´¹è€…ç»„ä¸º<strong>sanyouConsumer</strong>ï¼Œé‚£ä¹ˆé‡è¯•Topicçš„åç§°ä¸ºï¼š%RETRY%sanyouConsumer</p><p>å½“æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥åï¼ŒRocketMQä¼šæŠŠæ¶ˆæ¯å­˜åˆ°è¿™ä¸ªTopicåº•ä¸‹</p><blockquote><p><strong>é‡è¯•æ¶ˆæ¯æ˜¯å¦‚ä½•å®ç°é—´éš”ä¸€æ®µæ—¶é—´æ¥æ¶ˆè´¹å‘¢ï¼Ÿ</strong></p></blockquote><p>å¹¶å‘æ¶ˆè´¹æ¨¡å¼ä¸‹<strong>é—´éš”ä¸€æ®µæ—¶é—´</strong>åº•å±‚å°±æ˜¯ä½¿ç”¨çš„å»¶è¿Ÿæ¶ˆæ¯æ¥å®ç°çš„</p><p>RocetMQä¼šä¸ºé‡è¯•æ¶ˆæ¯è®¾ç½®ä¸€ä¸ªå»¶è¿Ÿçº§åˆ«ï¼Œå¹¶ä¸”å»¶è¿Ÿçº§åˆ«ä¸é‡è¯•æ¬¡æ•°çš„å…³ç³»ä¸ºï¼šdelayLevel &#x3D; 3 + å·²ç»é‡è¯•æ¬¡æ•°</p><ul><li>æ¯”å¦‚ç¬¬ä¸€æ¬¡æ¶ˆè´¹å¤±è´¥ï¼Œé‚£ä¹ˆå·²ç»é‡è¯•æ¬¡æ•°å°±æ˜¯0ï¼Œé‚£ä¹ˆæ­¤æ—¶å»¶è¿Ÿçº§åˆ«å°±æ˜¯3</li><li>å¯¹åº”çš„é»˜è®¤çš„å»¶è¿Ÿæ—¶é—´å°±æ˜¯10sï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡æ¶ˆæ¯é‡è¯•æ¶ˆè´¹é—´éš”æ—¶é—´æ˜¯10s</li><li>éšç€é‡è¯•æ¬¡æ•°è¶Šå¤šï¼Œå»¶è¿Ÿçº§åˆ«ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼Œé‡è¯•çš„é—´éš”ä¹Ÿå°±è¶Šæ¥è¶Šé•¿ï¼Œä½†æ˜¯æœ€å¤§ä¹Ÿæ˜¯æœ€å¤§å»¶è¿Ÿçº§åˆ«çš„æ—¶é—´</li></ul><p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å¹¶å‘æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼Œåªæœ‰é›†ç¾¤æ¶ˆè´¹æ‰æ”¯æŒæ¶ˆæ¯é‡è¯•ï¼Œå¯¹äºå¹¿æ’­æ¶ˆè´¹æ¨¡å¼æ¥è¯´ï¼Œæ˜¯ä¸æ”¯æŒæ¶ˆæ¯é‡è¯•çš„ï¼Œæ¶ˆè´¹å¤±è´¥å°±å¤±è´¥äº†ï¼Œä¸ä¼šç®¡ã€‚</p><h4 id="æ­»ä¿¡æ¶ˆæ¯ï¼ˆæ­»ä¿¡é˜Ÿåˆ—ï¼‰"><a href="#æ­»ä¿¡æ¶ˆæ¯ï¼ˆæ­»ä¿¡é˜Ÿåˆ—ï¼‰" class="headerlink" title="æ­»ä¿¡æ¶ˆæ¯ï¼ˆæ­»ä¿¡é˜Ÿåˆ—ï¼‰"></a>æ­»ä¿¡æ¶ˆæ¯ï¼ˆæ­»ä¿¡é˜Ÿåˆ—ï¼‰</h4><p>æ­»ä¿¡é˜Ÿåˆ—ç”¨äºå¤„ç†æ— æ³•è¢«æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå³æ­»ä¿¡æ¶ˆæ¯ã€‚</p><p>å‘é€å¤±è´¥è‡ªåŠ¨é‡è¯•åä»ç„¶å¤±è´¥æ”¾å…¥åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308103510.png" alt="image.png"></p><p>å‘½åè§„åˆ™ï¼š</p><ul><li>RocketMQä¸ºæ­»ä¿¡é˜Ÿåˆ—ä½¿ç”¨äº†ç‰¹æ®Šçš„Topicå‘½åçº¦å®šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ¶ˆæ¯åœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­é‡è¯•æ¬¡æ•°è¶…è¿‡è®¾å®šé˜ˆå€¼è€Œæ— æ³•è¢«æ¶ˆè´¹æ—¶ï¼Œè¿™äº›æ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨å‘é€åˆ°ä¸€ä¸ªç‰¹æ®Šçš„æ­»ä¿¡é˜Ÿåˆ—ã€‚</li><li>è¿™ä¸ªé˜Ÿåˆ—çš„Topicé€šå¸¸æ˜¯<strong>åŸTopicåç§°å‰åŠ ä¸Š<code>%DLQ%</code>å‰ç¼€</strong>ï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç”¨äºå­˜æ”¾æ­»ä¿¡çš„é˜Ÿåˆ—</li></ul><p>å…³äºé‡è¯•çš„è¯´æ˜ï¼š</p><ul><li>å¹¶å‘æ¶ˆè´¹çš„è¯ï¼Œæœ€å¤§é‡è¯•æ¬¡æ•°é»˜è®¤æ˜¯16æ¬¡</li><li>é¡ºåºæ¶ˆè´¹ï¼Œé»˜è®¤æœ€å¤§é‡è¯•æ¬¡æ•°å°±æ˜¯ Integer.MAX_VALUEï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æ— é™æ¬¡é‡è¯•ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹é¡ºåºæ¶ˆè´¹çš„æ¶ˆæ¯å‡ ä¹ä¸å¯èƒ½æˆä¸ºæ­»ä¿¡æ¶ˆæ¯</li></ul><h3 id="äº”ã€é«˜å¯ç”¨å’Œé«˜çº§ç‰¹æ€§"><a href="#äº”ã€é«˜å¯ç”¨å’Œé«˜çº§ç‰¹æ€§" class="headerlink" title="äº”ã€é«˜å¯ç”¨å’Œé«˜çº§ç‰¹æ€§"></a>äº”ã€é«˜å¯ç”¨å’Œé«˜çº§ç‰¹æ€§</h3><h4 id="åˆ†å¸ƒå¼äº‹åŠ¡-ğŸš©"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡-ğŸš©" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡ ğŸš©"></a>åˆ†å¸ƒå¼äº‹åŠ¡ ğŸš©</h4><p>è¿™é‡Œå»ºè®®ç”¨å®é™…ä¾‹å­å»è¡¥å……ä¸€ä¸‹å…·ä½“å¦‚ä½•å®Œæˆçš„ï¼Œç›®å‰æˆ‘ä»¬è®²è¿°ä¸€ä¸‹ RocketMQ æ˜¯å¦‚ä½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„ã€‚</p><blockquote><p>åˆ†å¸ƒå¼äº‹åŠ¡çš„å¸¸è§å®ç°æ–¹å¼ï¼ˆæ¯ç§æ–¹æ³•éƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯å’Œå±€é™æ€§ï¼‰</p></blockquote><ul><li>2PCï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰</li><li>ä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰</li><li>åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶<ul><li>Seata</li><li>TCCï¼ˆTry-Confirm-Cancelï¼‰</li></ul></li><li>æœ¬åœ°æ¶ˆæ¯è¡¨</li><li>æ¶ˆæ¯é˜Ÿåˆ—ã€ äº‹åŠ¡æ¶ˆæ¯ï¼ˆhalf åŠæ¶ˆæ¯æœºåˆ¶ï¼‰ã€‘</li></ul><blockquote><p>RocketMQ çš„åˆ†å¸ƒå¼äº‹åŠ¡å®ç°</p></blockquote><p>åœ¨ RocketMQ ä¸­ï¼Œå…¶é‡‡ç”¨çš„å®ç°æœºåˆ¶æ˜¯ï¼šäº‹åŠ¡æ¶ˆæ¯åŠ ä¸Šäº‹åŠ¡åæŸ¥æœºåˆ¶ã€‚</p><p>å‚è€ƒä¸€ä¸‹è¿™ç¯‡åšå®¢ä¸­å…³äºè®¢å•å…³äºçš„ä¸€ä¸ªæµç¨‹ä½¿ç”¨ï¼š <a href="https://juejin.cn/post/6844904099993878536">https://juejin.cn/post/6844904099993878536</a></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312281351790.png" alt="image.png"></p><p>ä¸Šè¿°å†…å®¹æåŠåˆ°è‡ªå·±è®¤ä¸ºéœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><ul><li>æœ¬åœ°äº‹åŠ¡è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œåï¼ŒæœåŠ¡æ–¹æ‰ä¼šæäº¤æˆ–è€…å›æ»šåŠæ¶ˆæ¯åˆ° RocketMQ çš„èŠ‚ç‚¹ Broker</li></ul><p>å…³äº Half Messageï¼ŒåŠæ¶ˆæ¯  å’Œ äº‹åŠ¡çŠ¶æ€å›æŸ¥  çš„ä¸€ä¸ªåŸºæœ¬è¡¨è¿°ï¼š</p><ol><li><strong>äº‹åŠ¡æ¶ˆæ¯ï¼ˆHalf æ¶ˆæ¯ï¼‰</strong>ï¼š<ul><li><strong>ç¬¬ä¸€æ­¥ï¼šå‘é€ Half æ¶ˆæ¯</strong>ï¼šæ‰€è°“çš„ Half æ¶ˆæ¯æ˜¯æŒ‡ä¸€ç§ç‰¹æ®ŠçŠ¶æ€çš„æ¶ˆæ¯ï¼Œå®ƒåœ¨äº‹åŠ¡å®Œæˆä¹‹å‰å¯¹æ¶ˆè´¹è€…æ˜¯ä¸å¯è§çš„ã€‚</li><li><strong>å®ç°æœºåˆ¶</strong>ï¼šå½“å‘é€ä¸€ä¸ªäº‹åŠ¡æ¶ˆæ¯æ—¶ï¼ŒRocketMQ é¦–å…ˆå­˜å‚¨è¿™ä¸ªæ¶ˆæ¯ï¼Œä½†å°†å…¶æ ‡è®°ä¸ºä¸å¯è§çŠ¶æ€ï¼ˆHalf çŠ¶æ€ï¼‰ã€‚è¿™æ˜¯é€šè¿‡æ”¹å˜æ¶ˆæ¯çš„ä¸»é¢˜ä¸º <code>RMQ_SYS_TRANS_HALF_TOPIC</code> å®ç°çš„ï¼Œå› ä¸ºæ¶ˆè´¹è€…é€šå¸¸ä¸è®¢é˜…è¿™ä¸ªç‰¹æ®Šä¸»é¢˜ï¼Œæ‰€ä»¥ä¸ä¼šæ¶ˆè´¹è¿™äº› Half æ¶ˆæ¯ã€‚</li></ul></li><li><strong>äº‹åŠ¡åæŸ¥æœºåˆ¶</strong>ï¼š<ul><li><strong>å®šæ—¶ä»»åŠ¡</strong>ï¼šRocketMQ ä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸæ£€æŸ¥ <code>RMQ_SYS_TRANS_HALF_TOPIC</code> ä¸­çš„æ¶ˆæ¯ã€‚</li><li><strong>åæŸ¥è¯·æ±‚</strong>ï¼šå¯¹äºæ¯æ¡ Half æ¶ˆæ¯ï¼ŒRocketMQ ä¼šæ ¹æ®å…¶ç”Ÿäº§è€…ç»„å‘ç›¸åº”çš„æœåŠ¡å‘é€äº‹åŠ¡çŠ¶æ€å›æŸ¥è¯·æ±‚ã€‚</li><li><strong>äº‹åŠ¡çŠ¶æ€å†³å®š</strong>ï¼šæ ¹æ®å›æŸ¥ç»“æœï¼ŒRocketMQ ä¼šå†³å®šæ˜¯æäº¤è¿˜æ˜¯å›æ»šè¿™æ¡æ¶ˆæ¯ã€‚å¦‚æœäº‹åŠ¡æˆåŠŸï¼Œæ¶ˆæ¯å°†å˜ä¸ºæ­£å¸¸çŠ¶æ€å¹¶å¯è¢«æ¶ˆè´¹ï¼›å¦‚æœäº‹åŠ¡å¤±è´¥ï¼Œæ¶ˆæ¯å°†è¢«å›æ»šæˆ–åˆ é™¤ã€‚</li></ul></li></ol><hr><p>RocketMQ ä¸»è¦æ˜¯ä¾èµ–åŠæ¶ˆæ¯ï¼Œå®ç°çš„åˆ†å¸ƒå¼æ¶ˆæ¯äº‹åŠ¡ï¼Œé€šè¿‡ äºŒæ¬¡ç¡®è®¤ä»¥åŠæ¶ˆæ¯å›æŸ¥æœºåˆ¶å®ç°ã€‚</p><p>æµç¨‹æè¿°ï¼š</p><ul><li>1ã€Producer å‘ broker å‘é€åŠæ¶ˆæ¯</li><li>2ã€Producer ç«¯æ”¶åˆ°å“åº”ï¼Œæ¶ˆæ¯å‘é€æˆåŠŸï¼Œæ­¤æ—¶æ¶ˆæ¯æ˜¯åŠæ¶ˆæ¯ï¼Œæ ‡è®°ä¸º â€œä¸å¯æŠ•é€’â€ çŠ¶æ€ï¼ŒConsumer æ¶ˆè´¹ä¸äº†ã€‚</li><li>3ã€Producer ç«¯æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ã€‚</li><li>4ã€æ­£å¸¸æƒ…å†µæœ¬åœ°äº‹åŠ¡æ‰§è¡Œå®Œæˆï¼ŒProducer å‘ Broker å‘é€ Commit&#x2F;Rollbackï¼Œå¦‚æœæ˜¯ Commitï¼ŒBroker ç«¯å°†åŠæ¶ˆæ¯æ ‡è®°ä¸ºæ­£å¸¸æ¶ˆæ¯ï¼ŒConsumer å¯ä»¥æ¶ˆè´¹ï¼Œå¦‚æœæ˜¯ Rollbackï¼ŒBroker ä¸¢å¼ƒæ­¤æ¶ˆæ¯ã€‚</li><li>5ã€å¼‚å¸¸æƒ…å†µï¼ŒBroker ç«¯è¿Ÿè¿Ÿç­‰ä¸åˆ°äºŒæ¬¡ç¡®è®¤ã€‚åœ¨ä¸€å®šæ—¶é—´åï¼Œä¼šæŸ¥è¯¢æ‰€æœ‰çš„åŠæ¶ˆæ¯ï¼Œç„¶ååˆ° Producer ç«¯æŸ¥è¯¢åŠæ¶ˆæ¯çš„æ‰§è¡Œæƒ…å†µã€‚</li><li>6ã€Producer ç«¯æŸ¥è¯¢æœ¬åœ°äº‹åŠ¡çš„çŠ¶æ€</li><li>7ã€æ ¹æ®äº‹åŠ¡çš„çŠ¶æ€æäº¤ commit&#x2F;rollback åˆ° broker ç«¯ã€‚ï¼ˆ5ï¼Œ6ï¼Œ7 æ˜¯æ¶ˆæ¯å›æŸ¥ï¼‰</li><li>8ã€æ¶ˆè´¹è€…æ®µæ¶ˆè´¹åˆ°æ¶ˆæ¯ä¹‹åï¼Œæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œæ‰§è¡Œæœ¬åœ°äº‹åŠ¡ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308102444.png" alt="image.png"></p><p>åŠæ¶ˆæ¯ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308102529.png" alt="image.png"></p><h5 id="äº‹åŠ¡å›æŸ¥æœºåˆ¶"><a href="#äº‹åŠ¡å›æŸ¥æœºåˆ¶" class="headerlink" title="äº‹åŠ¡å›æŸ¥æœºåˆ¶"></a>äº‹åŠ¡å›æŸ¥æœºåˆ¶</h5><p>ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªå®šæ—¶æœºåˆ¶ï¼Œç„¶åå¦‚æœé•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°äºŒæ¬¡ç¡®è®¤ï¼Œä¼šè¿›è¡Œäº‹åŠ¡å›æŸ¥</p><ul><li>è¿™ä¸ªæ˜¯ç”Ÿäº§è€…åè€Œæ˜¯æ¶ˆè´¹è€…ï¼Œæ”¶åˆ°è¿™æ¡æ¶ˆæ¯åï¼Œé€šè¿‡æœ¬åœ°å®ç°çš„ checker æ¥å£çš„ checkLocalTransaction æ–¹æ³•è¿›è¡Œæ£€æŸ¥æœ¬åœ°äº‹åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œå¹¶å°†ç»“æœå‘ŠçŸ¥ MQ æœåŠ¡å™¨ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307155659.png" alt="image.png"></p><h4 id="é«˜å¯ç”¨-ğŸš©"><a href="#é«˜å¯ç”¨-ğŸš©" class="headerlink" title="é«˜å¯ç”¨ ğŸš©"></a>é«˜å¯ç”¨ ğŸš©</h4><p>é«˜å¯ç”¨æƒ…æ™¯ä¸‹ï¼Œ</p><ul><li>ä¼šæ„å»º <code>broker</code>  é›†ç¾¤å¹¶ä¸”è¿›è¡Œä¸»ä»éƒ¨ç½²ï¼ŒåŒæ—¶<code>NameServer</code> ä¹Ÿè¿›è¡Œé›†ç¾¤éƒ¨ç½²ã€‚</li><li>åŒæ­¥å¤åˆ¶ + å¼‚æ­¥åˆ·ç›˜</li></ul><p>NameServerå› ä¸ºæ˜¯æ— çŠ¶æ€ï¼Œä¸”ä¸ç›¸äº’é€šä¿¡çš„ï¼Œæ‰€ä»¥åªè¦é›†ç¾¤éƒ¨ç½²å°±å¯ä»¥ä¿è¯é«˜å¯ç”¨ã€‚</p><p>RocketMQçš„é«˜å¯ç”¨ä¸»è¦æ˜¯åœ¨ä½“ç°åœ¨Brokerçš„è¯»å’Œå†™çš„é«˜å¯ç”¨ï¼ŒBrokerçš„é«˜å¯ç”¨æ˜¯é€šè¿‡<code>é›†ç¾¤</code>å’Œ<code>ä¸»ä»</code>å®ç°çš„ã€‚</p><blockquote><p><strong>çœ‹ä¸€ä¸‹è¿™å¥è¯ï¼šå…³äºå¦‚ä½•å®ç°å†™çš„é«˜å¯ç”¨</strong></p></blockquote><ul><li>å½“ Master æŒ‚æœºä¹‹åï¼Œå…¶ä»–èŠ‚ç‚¹çš„ Master æ˜¯ä»ç„¶å¯ç”¨çš„</li><li>è¯¥èŠ‚ç‚¹ä¸‹çš„Slave ä»ç„¶æ˜¯æä¾›è¯»æœåŠ¡çš„ï¼Œä½†æ˜¯å¦‚æœéœ€è¦ä» Slave æ”¹ä¸º Master ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308105413.png" alt="image.png"></p><p>å®˜ç½‘æ¶æ„å›¾</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312211545167.png" alt="image.png"></p><p>æ„å»º <code>broker</code> é›†ç¾¤å¹¶ä¸”è¿›è¡Œä¸»ä»éƒ¨ç½²ï¼ŒåŒæ—¶<code>NameServer</code> ä¹Ÿè¿›è¡Œé›†ç¾¤éƒ¨ç½²ï¼ˆå»ä¸­å¿ƒåŒ–ï¼‰</p><p>ç¬¬ä¸€ï¼Œæ„å»º <code>broker</code>  é›†ç¾¤å¹¶ä¸”è¿›è¡Œä¸»ä»éƒ¨ç½²ï¼Œæ­¤æ—¶ï¼Œæ¶ˆæ¯ä¼šåˆ†å¸ƒåœ¨å¤šä¸ª  <code>broker</code> </p><p>å½“æŸä¸ª <code>Broker</code> å®•æœºï¼Œåœ¨<code>Rocketmq</code> çš„ <code>master/slave</code> ç»“æ„ä¸‹ï¼Œ<code>salve</code> å®šæ—¶ä» <code>master</code> åŒæ­¥æ•°æ®(åŒæ­¥åˆ·ç›˜æˆ–è€…å¼‚æ­¥åˆ·ç›˜)ï¼Œå¦‚æœ <code>master</code> å®•æœºï¼Œåˆ™ <code>slave</code> æä¾›æ¶ˆè´¹æœåŠ¡ï¼Œä½†æ˜¯ä¸èƒ½å†™å…¥æ¶ˆæ¯</p><p>ç¬¬äºŒï¼Œ <code>NameServer</code> è¿›è¡Œäº†é›†ç¾¤éƒ¨ç½²ï¼ˆ <strong>å»ä¸­å¿ƒåŒ–</strong> çš„ï¼Œæ²¡æœ‰ä¸»èŠ‚ç‚¹ï¼‰ï¼›</p><p><code>Broker ä¼šå’Œæ‰€æœ‰ NameServer ä¿æŒé•¿è¿æ¥ ï¼Œå¹¶ä¸”åœ¨æ¯éš” 30 ç§’ </code>Broker<code>ä¼šå‘æ‰€æœ‰</code>Nameserver<code>å‘é€å¿ƒè·³ï¼Œå¿ƒè·³åŒ…å«äº†è‡ªèº«çš„</code>Topic<code>é…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªæ­¥éª¤å°±å¯¹åº”å›¾ä¸­çš„</code>Routing Info&#96;</p><p>ç¬¬ä¸‰ï¼Œåœ¨ç”Ÿäº§è€…éœ€è¦å‘ <code>Broker</code> å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œ<strong>éœ€è¦å…ˆä» <code>NameServer</code> è·å–å…³äº <code>Broker</code> çš„è·¯ç”±ä¿¡æ¯</strong>ï¼Œç„¶åé€šè¿‡ <strong>è½®è¯¢</strong> çš„æ–¹æ³•å»å‘æ¯ä¸ªé˜Ÿåˆ—ä¸­ç”Ÿäº§æ•°æ®ä»¥è¾¾åˆ° <strong>è´Ÿè½½å‡è¡¡</strong> çš„æ•ˆæœã€‚</p><p>ç¬¬å››ã€æ¶ˆè´¹è€…é€šè¿‡ <code>NameServer</code> è·å–æ‰€æœ‰ <code>Broker</code> çš„è·¯ç”±ä¿¡æ¯åï¼Œå‘ <code>Broker</code> å‘é€ <code>Pull</code> è¯·æ±‚æ¥è·å–æ¶ˆæ¯æ•°æ®ã€‚</p><p><code>Consumer</code> å¯ä»¥ä»¥ä¸¤ç§æ¨¡å¼å¯åŠ¨â€”â€” <strong>å¹¿æ’­ï¼ˆBroadcastï¼‰å’Œé›†ç¾¤ï¼ˆClusterï¼‰</strong>ã€‚å¹¿æ’­æ¨¡å¼ä¸‹ï¼Œä¸€æ¡æ¶ˆæ¯ä¼šå‘é€ç»™ <strong>åŒä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­çš„æ‰€æœ‰æ¶ˆè´¹è€…</strong> ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹æ¶ˆæ¯åªä¼šå‘é€ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚</p><hr><h4 id="æ¶ˆæ¯è¿‡æ»¤"><a href="#æ¶ˆæ¯è¿‡æ»¤" class="headerlink" title="æ¶ˆæ¯è¿‡æ»¤"></a>æ¶ˆæ¯è¿‡æ»¤</h4><p>æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p><ul><li><p>ä¸€ç§æ˜¯åœ¨ Broker ç«¯æŒ‰ç…§ Consumer çš„å»é‡é€»è¾‘è¿›è¡Œè¿‡æ»¤ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯é¿å…äº†æ— ç”¨çš„æ¶ˆæ¯ä¼ è¾“åˆ° Consumer ç«¯ï¼Œç¼ºç‚¹æ˜¯åŠ é‡äº† Broker çš„è´Ÿæ‹…ï¼Œå®ç°èµ·æ¥ç›¸å¯¹å¤æ‚ã€‚</p></li><li><p>å¦ä¸€ç§æ˜¯åœ¨ Consumer ç«¯è¿‡æ»¤ï¼Œæ¯”å¦‚æŒ‰ç…§æ¶ˆæ¯è®¾ç½®çš„ tag å»é‡ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å®ç°èµ·æ¥ç®€å•ï¼Œç¼ºç‚¹æ˜¯æœ‰å¤§é‡æ— ç”¨çš„æ¶ˆæ¯åˆ°è¾¾äº† Consumer ç«¯åªèƒ½ä¸¢å¼ƒä¸å¤„ç†ã€‚</p></li></ul><p>ä¸€èˆ¬é‡‡ç”¨Cosumerç«¯è¿‡æ»¤ï¼Œå¦‚æœå¸Œæœ›æé«˜ååé‡ï¼Œå¯ä»¥é‡‡ç”¨Brokerè¿‡æ»¤ã€‚</p><p>å¯¹æ¶ˆæ¯çš„è¿‡æ»¤æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308101827.png" alt="image.png"></p><ul><li><p>æ ¹æ®Tagè¿‡æ»¤ï¼šè¿™æ˜¯æœ€å¸¸è§çš„ä¸€ç§ï¼Œç”¨èµ·æ¥é«˜æ•ˆç®€å•</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs haxe">DefaultMQPushConsumerÂ consumerÂ =Â <span class="hljs-keyword">new</span><span class="hljs-type"></span>Â DefaultMQPushConsumer(<span class="hljs-string">&quot;CID_EXAMPLE&quot;</span>);  <br>consumer.subscribe(<span class="hljs-string">&quot;TOPIC&quot;</span>,Â <span class="hljs-string">&quot;TAGAÂ ||Â TAGBÂ ||Â TAGC&quot;</span>);<br></code></pre></td></tr></table></figure></li><li><p>SQL è¡¨è¾¾å¼è¿‡æ»¤ï¼šSQLè¡¨è¾¾å¼è¿‡æ»¤æ›´åŠ çµæ´»</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs haxe">DefaultMQPushConsumerÂ consumerÂ =Â <span class="hljs-keyword">new</span><span class="hljs-type"></span>Â DefaultMQPushConsumer(<span class="hljs-string">&quot;please_rename_unique_group_name_4&quot;</span>);  <br><span class="hljs-comment">//Â åªæœ‰è®¢é˜…çš„æ¶ˆæ¯æœ‰è¿™ä¸ªå±æ€§a,Â aÂ &gt;=0Â andÂ aÂ &lt;=Â 3  </span><br>consumer.subscribe(<span class="hljs-string">&quot;TopicTest&quot;</span>,Â MessageSelector.bySql(<span class="hljs-string">&quot;aÂ betweenÂ 0Â andÂ 3&quot;</span>);  <br>consumer.registerMessageListener(<span class="hljs-keyword">new</span><span class="hljs-type"></span>Â MessageListenerConcurrently()Â &#123;  <br>Â Â Â <span class="hljs-meta">@Override  </span><br>Â Â Â <span class="hljs-keyword">public</span>Â ConsumeConcurrentlyStatusÂ consumeMessage(List&lt;MessageExt&gt;Â msgs,Â ConsumeConcurrentlyContextÂ context)Â &#123;  <br>Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â ConsumeConcurrentlyStatus.CONSUME_SUCCESS;  <br>Â Â Â &#125;  <br>&#125;);  <br>consumer.start();<br></code></pre></td></tr></table></figure></li><li><p>Filter Server æ–¹å¼ï¼šæœ€çµæ´»ï¼Œä¹Ÿæ˜¯æœ€å¤æ‚çš„ä¸€ç§æ–¹å¼ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°è¿›è¡Œè¿‡æ»¤</p></li></ul><h3 id="å…­ã€è¯»å†™ï¼ˆå†…å­˜ã€æ—¥å¿—ï¼‰"><a href="#å…­ã€è¯»å†™ï¼ˆå†…å­˜ã€æ—¥å¿—ï¼‰" class="headerlink" title="å…­ã€è¯»å†™ï¼ˆå†…å­˜ã€æ—¥å¿—ï¼‰"></a>å…­ã€è¯»å†™ï¼ˆå†…å­˜ã€æ—¥å¿—ï¼‰</h3><h4 id="Broker-å¦‚ä½•ä¿å­˜æ•°æ®ï¼ˆ-æ¶ˆæ¯æŒä¹…åŒ–ï¼‰-ğŸš©"><a href="#Broker-å¦‚ä½•ä¿å­˜æ•°æ®ï¼ˆ-æ¶ˆæ¯æŒä¹…åŒ–ï¼‰-ğŸš©" class="headerlink" title="Broker å¦‚ä½•ä¿å­˜æ•°æ®ï¼ˆ æ¶ˆæ¯æŒä¹…åŒ–ï¼‰ ğŸš©"></a>Broker å¦‚ä½•ä¿å­˜æ•°æ®ï¼ˆ æ¶ˆæ¯æŒä¹…åŒ–ï¼‰ ğŸš©</h4><ul><li>CommitLog  æ¶ˆæ¯å­˜å‚¨æ–‡ä»¶</li><li>ComsumerQueue æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ç´¢å¼•æ–‡ä»¶</li><li>Indexfile      æ¶ˆæ¯ç´¢å¼•ï¼ˆå¿«é€Ÿæ£€ç´¢æ¶ˆæ¯ï¼‰</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308142459.png" alt="image.png"></p><p>RocketMQä¸»è¦çš„å­˜å‚¨æ–‡ä»¶åŒ…æ‹¬CommitLogæ–‡ä»¶ã€ConsumeQueueæ–‡ä»¶ã€Indexfileæ–‡ä»¶ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308110801.png" alt="image.png"></p><p>æ¶ˆæ¯å­˜å‚¨çš„æ•´ä½“è®¾è®¡</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308110842.png" alt="image.png"></p><p>ä»¥ä¸‹æ˜¯è¿™äº›ç»„ä»¶çš„åŠŸèƒ½å’Œå®ƒä»¬åœ¨æ•´ä¸ªå­˜å‚¨ç»“æ„ä¸­çš„ä½œç”¨ï¼š</p><h5 id="CommitLog-æ ¸å¿ƒæ–‡ä»¶"><a href="#CommitLog-æ ¸å¿ƒæ–‡ä»¶" class="headerlink" title="CommitLog   æ ¸å¿ƒæ–‡ä»¶"></a>CommitLog   æ ¸å¿ƒæ–‡ä»¶</h5><ul><li><strong>åŠŸèƒ½</strong>ï¼šCommitLog æ˜¯æ¶ˆæ¯å­˜å‚¨çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œå®ƒå­˜å‚¨äº†ç”Ÿäº§è€…å†™å…¥çš„æ¶ˆæ¯ä¸»ä½“å†…å®¹åŠå…¶å…ƒæ•°æ®ã€‚</li><li><strong>å­˜å‚¨ç»“æ„</strong>ï¼šCommitLog æ–‡ä»¶çš„å¤§å°é»˜è®¤ä¸º1GBï¼Œæ–‡ä»¶å‘½ååŸºäºèµ·å§‹åç§»é‡ï¼Œä¾‹å¦‚ <code>00000000001073741824</code>ã€‚</li><li><strong>å†™å…¥æ–¹å¼</strong>ï¼šæ¶ˆæ¯ä¸»è¦æ˜¯é¡ºåºå†™å…¥CommitLogæ–‡ä»¶ï¼Œæé«˜äº†å†™å…¥æ•ˆç‡ã€‚å½“ä¸€ä¸ªæ–‡ä»¶å†™æ»¡åï¼Œå†™å…¥ä¼šç»§ç»­åœ¨ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308110951.png" alt="image.png"></p><h5 id="ConsumeQueue-ç´¢å¼•æ–‡ä»¶"><a href="#ConsumeQueue-ç´¢å¼•æ–‡ä»¶" class="headerlink" title="ConsumeQueue   ç´¢å¼•æ–‡ä»¶"></a>ConsumeQueue   ç´¢å¼•æ–‡ä»¶</h5><ul><li><strong>åŠŸèƒ½</strong>ï¼šConsumeQueue ä½œä¸ºæ¶ˆè´¹æ¶ˆæ¯çš„ç´¢å¼•ï¼Œæå‡è¯»å–æ•ˆç‡ã€‚</li><li><strong>ç»“æ„</strong>ï¼šConsumeQueue ä¿å­˜äº†ç‰¹å®šTopicä¸‹é˜Ÿåˆ—æ¶ˆæ¯åœ¨CommitLogä¸­çš„èµ·å§‹ç‰©ç†åç§»é‡ã€æ¶ˆæ¯å¤§å°å’Œæ¶ˆæ¯Tagçš„HashCodeå€¼ã€‚</li><li><strong>å­˜å‚¨è·¯å¾„</strong>ï¼šé‡‡ç”¨ <code>topic/queue/file</code> çš„ä¸‰å±‚ç»„ç»‡ç»“æ„ï¼Œæ–‡ä»¶è·¯å¾„ä¸º <code>$HOME/store/consumequeue/&#123;topic&#125;/&#123;queueId&#125;/&#123;fileName&#125;</code>ã€‚</li><li><strong>æ¡ç›®ç»„ç»‡</strong>ï¼šæ¯ä¸ªæ¡ç›®å›ºå®š20å­—èŠ‚ï¼ŒåŒ…æ‹¬commitlogçš„ç‰©ç†åç§»é‡ã€æ¶ˆæ¯é•¿åº¦å’Œtag hashcodeï¼Œå…è®¸åƒæ•°ç»„ä¸€æ ·éšæœºè®¿é—®æ¯ä¸ªæ¡ç›®ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308111131.png" alt="image.png"></p><h5 id="IndexFile"><a href="#IndexFile" class="headerlink" title="IndexFile"></a>IndexFile</h5><ul><li><strong>åŠŸèƒ½</strong>ï¼šæä¾›äº†é€šè¿‡keyæˆ–æ—¶é—´åŒºé—´æŸ¥è¯¢æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œä½†ä¸æ¶‰åŠæ¶ˆæ¯çš„ä¸»ä½“å†…å®¹ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308111226.png" alt="image.png"></p><h5 id="æ€»ç»“-ğŸ‰"><a href="#æ€»ç»“-ğŸ‰" class="headerlink" title="æ€»ç»“  ğŸ‰"></a>æ€»ç»“  ğŸ‰</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308141410.png" alt="image.png"></p><p>ReputMessageService æœåŠ¡ä¼šå°†å¯¹åº”çš„ CommitLog æ–‡ä»¶ä¸­çš„æ¶ˆæ¯å¼‚æ­¥æ›´æ–°å†…å®¹åˆ° ComsumeQueue å’Œ IndexFile ä¸­</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308141719.png" alt="image.png"></p><p>RocketMQ æ˜¯é»˜è®¤å¼€å¯ Broker æŒä¹…åŒ–æœºåˆ¶çš„ï¼Œæ¶ˆè´¹è€… Comsumer çš„æ¶ˆè´¹å®é™…æ˜¯æ ¹æ® ComsumerQueue æ¥è¿›è¡Œæ¶ˆè´¹çš„ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308142224.png" alt="image.png"></p><h4 id="é«˜æ€§èƒ½è¯»å†™-ğŸš©"><a href="#é«˜æ€§èƒ½è¯»å†™-ğŸš©" class="headerlink" title="é«˜æ€§èƒ½è¯»å†™  ğŸš©"></a>é«˜æ€§èƒ½è¯»å†™  ğŸš©</h4><blockquote><p>RocketMQæ€ä¹ˆå¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™çš„</p></blockquote><p>RocketMQå¯¹æ–‡ä»¶çš„è¯»å†™å·§å¦™åœ°åˆ©ç”¨äº†æ“ä½œç³»ç»Ÿçš„ä¸€äº›é«˜æ•ˆæ–‡ä»¶è¯»å†™æ–¹å¼â€”â€”<code>PageCache</code>ã€<code>é¡ºåºè¯»å†™</code>ã€<code>é›¶æ‹·è´</code>ã€‚</p><h5 id="PageCacheã€é¡ºåºè¯»å–"><a href="#PageCacheã€é¡ºåºè¯»å–" class="headerlink" title="PageCacheã€é¡ºåºè¯»å–"></a>PageCacheã€é¡ºåºè¯»å–</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308142836.png" alt="image.png"></p><p>é¡ºåºè¯»å†™æé«˜äº† CommitLog å’Œ ComsumerQueue çš„å†™å…¥å’Œè¯»å–é€Ÿç‡</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308182341.png" alt="image.png"></p><p>å…³äº PageCache çš„ç†è§£ï¼Œå› ä¸º CommitLog æ˜¯é¡ºåºå†™å…¥çš„ï¼Œè€Œ PageCache æŠ€æœ¯èƒ½å¤Ÿå½“ç¬¬ä¸€æ¬¡åŠ è½½æ–‡ä»¶çš„æ—¶å€™ä¼šå°†æ•°æ®æ”¾å…¥åˆ°ç¼“å­˜ä¸­ï¼Œé€šè¿‡ç›´æ¥å¯¹å†…å­˜çš„è¯»å–åŠ å¿«å¯¹æ¶ˆæ¯å¤„ç†çš„æ€§èƒ½ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308183931.png" alt="image.png"></p><h5 id="é›¶æ‹·è´-ğŸš©"><a href="#é›¶æ‹·è´-ğŸš©" class="headerlink" title="é›¶æ‹·è´  ğŸš©"></a>é›¶æ‹·è´  ğŸš©</h5><p>é€šè¿‡äº†é›¶æ‹·è´æŠ€æœ¯æé«˜äº†â½‚ä»¶ä¼ è¾“é€Ÿåº¦ï¼Œå®ç°æ–¹å¼æ˜¯ mmap</p><ul><li>mmap å°±æ˜¯é€šè¿‡â½‚ä»¶ä½ç½®ä¸è¿›ç¨‹åœ°å€ç©ºé—´å»ºâ½´æ˜ å°„å…³ç³»ï¼Œç¨‹åºå¯ ä»¥ç›´æ¥è®¿é—®â½‚ä»¶å†…å®¹</li><li>è¿™ç§æœºåˆ¶åœ¨Javaä¸­æ˜¯é€šè¿‡MappedByteBufferå®ç°çš„</li></ul><hr><p>ä¼ ç»Ÿæ–¹å¼ï¼š</p><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼ï¼Œæ•°æ®éœ€è¦ç»å†å‡ æ¬¡æ‹·è´ï¼Œè¿˜è¦ç»å†ç”¨æˆ·æ€&#x2F;å†…æ ¸æ€åˆ‡æ¢</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308184631.png" alt="image.png"></p><ol><li>ä»ç£ç›˜å¤åˆ¶æ•°æ®åˆ°å†…æ ¸æ€å†…å­˜ï¼›</li><li>ä»å†…æ ¸æ€å†…å­˜å¤åˆ¶åˆ°ç”¨æˆ·æ€å†…å­˜ï¼›</li><li>ç„¶åä»ç”¨æˆ·æ€å†…å­˜å¤åˆ¶åˆ°ç½‘ç»œé©±åŠ¨çš„å†…æ ¸æ€å†…å­˜ï¼›</li><li>æœ€åæ˜¯ä»ç½‘ç»œé©±åŠ¨çš„å†…æ ¸æ€å†…å­˜å¤åˆ¶åˆ°ç½‘å¡ä¸­è¿›è¡Œä¼ è¾“</li></ol><p>é›¶æ‹·è´æ–¹å¼ï¼š</p><p>å¯ä»¥é€šè¿‡é›¶æ‹·è´çš„æ–¹å¼ï¼Œ<strong>å‡å°‘ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>å’Œ<strong>å†…å­˜æ‹·è´çš„æ¬¡æ•°</strong>ï¼Œç”¨æ¥æå‡I&#x2F;Oçš„æ€§èƒ½ã€‚é›¶æ‹·è´æ¯”è¾ƒå¸¸è§çš„å®ç°æ–¹å¼æ˜¯<strong>mmap</strong>ï¼Œè¿™ç§æœºåˆ¶åœ¨Javaä¸­æ˜¯é€šè¿‡MappedByteBufferå®ç°çš„ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308190931.png" alt="image.png"></p><p>é›¶æ‹·è´çš„å¥½å¤„ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308185040.png" alt="image.png"></p><p>çœ‹ä¸€ä¸‹è¿™ä¸ªå¯¹æ¯”ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308190654.png" alt="image.png"></p><p>æ‰©å±•ï¼š</p><p>RocketMQä¸»è¦é€šè¿‡MappedByteBufferå¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œã€‚</p><p>å…¶ä¸­ï¼Œåˆ©ç”¨äº†NIOä¸­çš„FileChannelæ¨¡å‹å°†ç£ç›˜ä¸Šçš„ç‰©ç†æ–‡ä»¶ç›´æ¥æ˜ å°„åˆ°ç”¨æˆ·æ€çš„å†…å­˜åœ°å€ä¸­ï¼ˆè¿™ç§Mmapçš„æ–¹å¼å‡å°‘äº†ä¼ ç»ŸIOï¼Œå°†ç£ç›˜æ–‡ä»¶æ•°æ®åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸åœ°å€ç©ºé—´çš„ç¼“å†²åŒºï¼Œå’Œç”¨æˆ·åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´çš„ç¼“å†²åŒºä¹‹é—´æ¥å›è¿›è¡Œæ‹·è´çš„æ€§èƒ½å¼€é”€ï¼‰ï¼Œå°†å¯¹æ–‡ä»¶çš„æ“ä½œè½¬åŒ–ä¸ºç›´æ¥å¯¹å†…å­˜åœ°å€è¿›è¡Œæ“ä½œï¼Œä»è€Œæå¤§åœ°æé«˜äº†æ–‡ä»¶çš„è¯»å†™æ•ˆç‡ï¼ˆæ­£å› ä¸ºéœ€è¦ä½¿ç”¨å†…å­˜æ˜ å°„æœºåˆ¶ï¼Œæ•…RocketMQçš„æ–‡ä»¶å­˜å‚¨éƒ½ä½¿ç”¨å®šé•¿ç»“æ„æ¥å­˜å‚¨ï¼Œæ–¹ä¾¿ä¸€æ¬¡å°†æ•´ä¸ªæ–‡ä»¶æ˜ å°„è‡³å†…å­˜ï¼‰</p><h4 id="åˆ·ç›˜æœºåˆ¶"><a href="#åˆ·ç›˜æœºåˆ¶" class="headerlink" title="åˆ·ç›˜æœºåˆ¶"></a>åˆ·ç›˜æœºåˆ¶</h4><h5 id="åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜"><a href="#åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜" class="headerlink" title="åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜"></a>åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜</h5><p>åœ¨ RocketMQ ä¸­ï¼ŒåŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜æ˜¯ä¸¤ç§ä¸åŒçš„æ¶ˆæ¯æŒä¹…åŒ–ç­–ç•¥ï¼Œå®ƒä»¬å„æœ‰ä¼˜åŠ£ï¼Œå¹¶é€‚ç”¨äºä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312281520496.png" alt="image.png"></p><p>ä»¥ä¸‹æ˜¯å¯¹è¿™ä¸¤ç§ç­–ç•¥çš„è¯¦ç»†è¯´æ˜å’Œæ¯”è¾ƒï¼š</p><blockquote><p>åŒæ­¥åˆ·ç›˜ï¼ˆSYNC_FLUSHï¼‰</p></blockquote><ul><li><strong>å·¥ä½œåŸç†</strong>ï¼šåœ¨åŒæ­¥åˆ·ç›˜æ¨¡å¼ä¸‹ï¼Œæ¯å½“ç”Ÿäº§è€…å‘é€ä¸€æ¡æ¶ˆæ¯ï¼ŒBroker éœ€è¦å°†æ¶ˆæ¯å†™å…¥ç£ç›˜å¹¶å®Œæˆåˆ·ç›˜æ“ä½œåï¼Œæ‰ä¼šå‘ç”Ÿäº§è€…è¿”å›ç¡®è®¤ï¼ˆACKï¼‰ã€‚åªæœ‰æ”¶åˆ°è¿™ä¸ªç¡®è®¤ï¼Œç”Ÿäº§è€…æ‰çŸ¥é“æ¶ˆæ¯å·²ç»å®‰å…¨å­˜å‚¨ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šæä¾›äº†æ›´é«˜çš„æ¶ˆæ¯å¯é æ€§ã€‚å³ä½¿åœ¨Brokeræ„å¤–å®•æœºçš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¸ä¼šä¸¢å¤±å·²ç¡®è®¤çš„æ¶ˆæ¯ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå½±å“æ€§èƒ½ã€‚ç”±äºæ¯æ¡æ¶ˆæ¯éƒ½éœ€è¦ç­‰å¾…ç£ç›˜å†™å…¥å®Œæˆï¼Œè¿™ä¼šå¢åŠ æ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´ï¼Œé™ä½ååé‡ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå¯¹æ¶ˆæ¯å¯é æ€§æœ‰æé«˜è¦æ±‚çš„åœºæ™¯ï¼Œå¦‚é‡‘èäº¤æ˜“ã€é‡è¦ä¸šåŠ¡æ•°æ®å¤„ç†ç­‰ã€‚</li></ul><blockquote><p>å¼‚æ­¥åˆ·ç›˜ï¼ˆASYNC_FLUSHï¼‰</p></blockquote><ul><li><strong>å·¥ä½œåŸç†</strong>ï¼šåœ¨å¼‚æ­¥åˆ·ç›˜æ¨¡å¼ä¸‹ï¼ŒBroker å°†æ¶ˆæ¯å†™å…¥å†…å­˜åï¼Œå°±ç«‹å³å‘ç”Ÿäº§è€…è¿”å›ç¡®è®¤ã€‚å®é™…çš„åˆ·ç›˜æ“ä½œæ˜¯ç”±åå°çº¿ç¨‹å¼‚æ­¥å®Œæˆçš„ï¼Œä¸ä¼šé˜»å¡æ¶ˆæ¯çš„å‘é€ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šæé«˜äº†æ€§èƒ½å’Œååé‡ã€‚ç”±äºæ¶ˆæ¯å‘é€ä¸éœ€è¦ç­‰å¾…ç£ç›˜æ“ä½œå®Œæˆï¼Œå› æ­¤å‡å°‘äº†å»¶è¿Ÿã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šæ¶ˆæ¯å¯é æ€§é™ä½ã€‚å¦‚æœBrokeråœ¨æ¶ˆæ¯è¿˜æœªåˆ·å…¥ç£ç›˜å‰å‘ç”Ÿå®•æœºï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œä½†å¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚ä¸æ˜¯ç‰¹åˆ«ä¸¥æ ¼çš„åœºæ™¯ï¼Œå¦‚æ—¥å¿—æ”¶é›†ã€ä¸€äº›éå…³é”®çš„ä¸šåŠ¡é€šçŸ¥ç­‰ã€‚</li></ul><p><strong>åˆ·ç›˜ç­–ç•¥çš„è®¾ç½®</strong></p><ul><li><strong>é…ç½®å‚æ•°</strong>ï¼šåœ¨ RocketMQ ä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®Brokerçš„<code>FlushDiskType</code>å‚æ•°æ¥è°ƒæ•´åˆ·ç›˜ç­–ç•¥ã€‚</li><li>å¯ä»¥é€‰æ‹©<code>ASYNC_FLUSH</code>ï¼ˆå¼‚æ­¥åˆ·ç›˜ï¼‰æˆ–<code>SYNC_FLUSH</code>ï¼ˆåŒæ­¥åˆ·ç›˜ï¼‰ã€‚</li></ul><p>åŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜åœ¨æ¶ˆæ¯å¯é æ€§å’Œæ€§èƒ½ä¹‹é—´æä¾›äº†ä¸åŒçš„å¹³è¡¡ç‚¹ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”æ ¹æ®ä¸šåŠ¡éœ€æ±‚çš„ä¸åŒï¼Œé€‰æ‹©æœ€åˆé€‚çš„åˆ·ç›˜ç­–ç•¥ã€‚å¯¹äºé‚£äº›è¦æ±‚é«˜å¯é æ€§çš„åœºæ™¯ï¼ŒåŒæ­¥åˆ·ç›˜æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼›è€Œå¯¹äºé‚£äº›æ›´çœ‹é‡æ€§èƒ½å’Œååé‡çš„åº”ç”¨ï¼Œå¼‚æ­¥åˆ·ç›˜åˆ™æ›´ä¸ºé€‚åˆ</p><h5 id="åŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶"><a href="#åŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶" class="headerlink" title="åŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶"></a>åŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶</h5><p>åŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶åœ¨ RocketMQ ä¸­æŒ‡çš„æ˜¯ä¸»ä»Brokerä¹‹é—´çš„æ•°æ®å¤åˆ¶æ–¹å¼ï¼Œè¿™ç›´æ¥å½±å“æ¶ˆæ¯çš„å¯é æ€§å’Œç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚è¿™ä¸¤ç§å¤åˆ¶ç­–ç•¥åœ¨ä¿è¯æ•°æ®ä¸€è‡´æ€§å’Œæé«˜ç³»ç»Ÿæ€§èƒ½ä¹‹é—´æä¾›äº†ä¸åŒçš„å¹³è¡¡ç‚¹ã€‚ä»¥ä¸‹æ˜¯å¯¹è¿™ä¸¤ç§ç­–ç•¥çš„è¯¦ç»†è¯´æ˜å’Œæ¯”è¾ƒï¼š</p><blockquote><p>åŒæ­¥å¤åˆ¶ï¼ˆåŒæ­¥åŒå†™ï¼‰</p></blockquote><ul><li><strong>å·¥ä½œåŸç†</strong>ï¼šåœ¨åŒæ­¥å¤åˆ¶æ¨¡å¼ä¸‹ï¼Œå½“æ¶ˆæ¯è¢«å†™å…¥ä¸»Brokeråï¼Œå®ƒå¿…é¡»åŒæ—¶è¢«å¤åˆ¶åˆ°ä»Brokerä¸Šã€‚åªæœ‰å½“æ¶ˆæ¯åœ¨ä¸»ä»Brokerä¸Šéƒ½æˆåŠŸå†™å…¥åï¼Œæ‰å‘ç”Ÿäº§è€…è¿”å›å†™å…¥æˆåŠŸçš„ç¡®è®¤ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šæé«˜äº†æ•°æ®çš„å¯é æ€§ã€‚å³ä½¿ä¸»Brokerå®•æœºï¼Œä»Brokerä¸Šä»ç„¶æœ‰æ¶ˆæ¯çš„å®Œæ•´å‰¯æœ¬ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå½±å“æ€§èƒ½ã€‚ç”±äºæ¶ˆæ¯å†™å…¥æ“ä½œéœ€è¦åœ¨ä¸»ä»Brokerä¸Šéƒ½å®Œæˆï¼Œè¿™å¯èƒ½å¯¼è‡´è¾ƒé«˜çš„å»¶è¿Ÿå’Œé™ä½ååé‡ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå¯¹æ•°æ®å¯é æ€§è¦æ±‚æé«˜çš„åœºæ™¯ï¼Œå¦‚é‡‘èäº¤æ˜“ã€‚</li></ul><blockquote><p>å¼‚æ­¥å¤åˆ¶</p></blockquote><ul><li><strong>å·¥ä½œåŸç†</strong>ï¼šåœ¨å¼‚æ­¥å¤åˆ¶æ¨¡å¼ä¸‹ï¼Œå½“æ¶ˆæ¯å†™å…¥ä¸»Brokerä¹‹åï¼Œç³»ç»Ÿå°±ç›´æ¥è¿”å›å†™å…¥æˆåŠŸã€‚æ¶ˆæ¯çš„å¤åˆ¶åˆ°ä»Brokeræ˜¯å¼‚æ­¥è¿›è¡Œçš„ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šæé«˜äº†æ€§èƒ½ã€‚ç”±äºä¸éœ€è¦ç­‰å¾…ä»Brokerç¡®è®¤ï¼Œæ¶ˆæ¯çš„å†™å…¥å’Œç¡®è®¤é€Ÿåº¦æ›´å¿«ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚å¦‚æœä¸»Brokeråœ¨æ•°æ®å¤åˆ¶å®Œæˆå‰å®•æœºï¼Œä»Brokerå¯èƒ½ç¼ºå°‘æœ€æ–°çš„æ•°æ®ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œä½†æ•°æ®å¯é æ€§è¦æ±‚ä¸æ˜¯æç«¯ä¸¥æ ¼çš„åœºæ™¯ã€‚</li></ul><blockquote><p>å¯ç”¨æ€§ä¸é¡ºåºæ€§çš„è€ƒè™‘</p></blockquote><ul><li><strong>å¯ç”¨æ€§é—®é¢˜</strong>ï¼šç”±äºRocketMQä¸æ”¯æŒè‡ªåŠ¨ä¸»ä»åˆ‡æ¢ï¼Œå¦‚æœä¸»Brokerå®•æœºï¼Œæ•´ä¸ªç³»ç»Ÿå°†æ— æ³•ç»§ç»­ç”Ÿäº§æ¶ˆæ¯ã€‚è™½ç„¶æ¶ˆè´¹è€…å¯ä»¥ä»ä»Brokeræ¶ˆè´¹æ¶ˆæ¯ï¼Œä½†åœ¨ä¸»Brokerå®•æœºæœŸé—´ä¼šå­˜åœ¨çŸ­æš‚çš„ä¸»ä»æ•°æ®ä¸ä¸€è‡´æƒ…å†µã€‚</li><li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé€šè¿‡éƒ¨ç½²å¤šä¸ªä¸»ä»é›†ç¾¤ï¼ˆå¤šBrokeræ¶æ„ï¼‰æ¥æé«˜å¯ç”¨æ€§ã€‚æ¯ä¸ªTopicåˆ†å¸ƒåœ¨ä¸åŒçš„Brokerä¸­ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³å•ä¸ªBrokerå®•æœºé—®é¢˜ã€‚</li><li><strong>é¡ºåºæ€§é—®é¢˜</strong>ï¼šåœ¨å¤šBrokeræ¶æ„ä¸‹ï¼Œå¦‚æœæŸä¸ªä¸»Brokerè´Ÿè´£ç‰¹å®šé¡ºåºæ¶ˆæ¯å®•æœºï¼Œå…¶ä»–Brokeræ— æ³•æ›¿ä»£å®ƒå¤„ç†è¿™äº›æ¶ˆæ¯ï¼Œå¯èƒ½å½±å“æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚</li><li><strong>Dledger</strong>ï¼šRocketMQé€šè¿‡å¼•å…¥DledgeræŠ€æœ¯ï¼Œæ”¯æŒåŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„æ¶ˆæ¯å¤åˆ¶åæ‰ç¡®è®¤å†™å…¥æˆåŠŸï¼Œå¹¶æ”¯æŒä¸»èŠ‚ç‚¹çš„åŠ¨æ€é€‰ä¸¾ï¼Œè§£å†³äº†ä¸¥æ ¼é¡ºåºæ€§å’Œé«˜å¯ç”¨æ€§çš„é—®é¢˜ã€‚</li></ul><p>åŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶åœ¨RocketMQä¸­æä¾›äº†ä¸åŒçš„æ•°æ®ä¸€è‡´æ€§å’Œæ€§èƒ½å¹³è¡¡ã€‚åœ¨è®¾è®¡ç³»ç»Ÿæ—¶ï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚çš„å…·ä½“æƒ…å†µé€‰æ‹©åˆé€‚çš„å¤åˆ¶ç­–ç•¥ã€‚</p><p>Dledgerä½œä¸ºä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè™½ç„¶æé«˜äº†å¯ç”¨æ€§å’Œé¡ºåºæ€§ä¿è¯ï¼Œä½†åœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæš‚æ—¶æ— æ³•æä¾›æœåŠ¡ï¼Œå¹¶ä¸”å¯¹èŠ‚ç‚¹çš„æ•°é‡æœ‰ä¸€å®šè¦æ±‚ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€ç»¼åˆè€ƒè™‘ä¸šåŠ¡åœºæ™¯çš„ç‰¹æ€§å’Œå¯¹æ•°æ®å¯é æ€§ã€ç³»ç»Ÿæ€§èƒ½çš„å…·ä½“éœ€æ±‚æ¥å†³å®šä½¿ç”¨å“ªç§å¤åˆ¶ç­–ç•¥ã€‚</p><h3 id="ä¸ƒã€å¸¸è§ç”Ÿäº§é—®é¢˜"><a href="#ä¸ƒã€å¸¸è§ç”Ÿäº§é—®é¢˜" class="headerlink" title="ä¸ƒã€å¸¸è§ç”Ÿäº§é—®é¢˜"></a>ä¸ƒã€å¸¸è§ç”Ÿäº§é—®é¢˜</h3><h4 id="æ¶ˆæ¯å‘é€æœ‰æ—¶å€™ä¼šé‡åˆ°çš„é—®é¢˜ï¼ˆæ¶ˆæ¯è¿‡å¤§ã€å‘é€å¼‚å¸¸ï¼‰"><a href="#æ¶ˆæ¯å‘é€æœ‰æ—¶å€™ä¼šé‡åˆ°çš„é—®é¢˜ï¼ˆæ¶ˆæ¯è¿‡å¤§ã€å‘é€å¼‚å¸¸ï¼‰" class="headerlink" title="æ¶ˆæ¯å‘é€æœ‰æ—¶å€™ä¼šé‡åˆ°çš„é—®é¢˜ï¼ˆæ¶ˆæ¯è¿‡å¤§ã€å‘é€å¼‚å¸¸ï¼‰"></a>æ¶ˆæ¯å‘é€æœ‰æ—¶å€™ä¼šé‡åˆ°çš„é—®é¢˜ï¼ˆæ¶ˆæ¯è¿‡å¤§ã€å‘é€å¼‚å¸¸ï¼‰</h4><blockquote><p>å‘é€æ¶ˆæ¯ä¼šé‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼ˆç‰¹æ®Šæƒ…å†µå¤„ç†ï¼‰</p></blockquote><ul><li>ä¸å»ºè®®å•ä¸€è¿›ç¨‹åˆ›å»ºå¤§é‡ç”Ÿäº§è€…<ul><li>å¯¹äºç”Ÿäº§è€…çš„åˆ›å»ºå’Œåˆå§‹åŒ–ï¼Œå»ºè®®éµå¾ªå¤Ÿç”¨å³å¯ã€æœ€å¤§åŒ–å¤ç”¨åŸåˆ™</li></ul></li><li>ä¸å»ºè®®é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ç”Ÿäº§è€…</li></ul><blockquote><p>åˆ›å»ºå’Œé”€æ¯ç”Ÿäº§è€…</p></blockquote><p>æ­£ç¡®ç¤ºä¾‹ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf">Producer p <span class="hljs-operator">=</span> ProducerBuilder.build()<span class="hljs-comment">;</span><br>for (int i <span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-comment">;i&lt;n;i++)&#123;</span><br>    Message m<span class="hljs-operator">=</span> MessageBuilder.build()<span class="hljs-comment">;</span><br>    p.send(m)<span class="hljs-comment">;</span><br> &#125;<br>p.shutdown()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><strong>å‘é€å¼‚å¸¸</strong></p><p>é€‰æ‹©é˜Ÿåˆ—åä¼šä¸ Broker å»ºç«‹è¿æ¥ï¼Œé€šè¿‡ç½‘ç»œè¯·æ±‚å°†æ¶ˆæ¯å‘é€åˆ° Broker ä¸Šï¼Œå¦‚æœ Broker æŒ‚äº†æˆ–è€…ç½‘ç»œæ³¢åŠ¨å‘é€æ¶ˆæ¯è¶…æ—¶æ­¤æ—¶ RocketMQ ä¼šè¿›è¡Œé‡è¯•ã€‚</p><p>é‡æ–°é€‰æ‹©å…¶ä»– Broker ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå‘é€ï¼Œé»˜è®¤é‡è¯•ä¸¤æ¬¡ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®ã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">producer.setRetryTimesWhenSendFailed(<span class="hljs-number">5</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><strong>æ¶ˆæ¯è¿‡å¤§</strong></p><p>æ¶ˆæ¯è¶…è¿‡ 4k æ—¶ RocketMQ ä¼šå°†æ¶ˆæ¯å‹ç¼©ååœ¨å‘é€åˆ° Broker ä¸Šï¼Œå‡å°‘ç½‘ç»œèµ„æºçš„å ç”¨ã€‚</p><h4 id="æ¶ˆæ¯å †ç§¯é—®é¢˜"><a href="#æ¶ˆæ¯å †ç§¯é—®é¢˜" class="headerlink" title="æ¶ˆæ¯å †ç§¯é—®é¢˜"></a>æ¶ˆæ¯å †ç§¯é—®é¢˜</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307135759.png" alt="image.png"></p><p>ä¸€èˆ¬æ˜¯é‡‡ç”¨å¢åŠ æ¶ˆè´¹è€…å®ä¾‹çš„æ–¹å¼</p><p>ä¸ªäººç†è§£ï¼šå¦‚æœæ˜¯åº”å¯¹ç”Ÿäº§å¿«çš„ï¼Œä¸€æ–¹é¢æ˜¯éœ€è¦éœ€è¦è¿™ä¸ªé˜Ÿåˆ—æ•°é‡å’Œæ¶ˆè´¹è€…æ•°é‡ï¼Œç„¶ååº”å¯¹å †ç§¯çš„æƒ…å†µï¼Œå°±è¦åŠ ä¸€ä¸ªä¸­è½¬çš„ï¼ŒæŠŠè¿™ä¸ªå †ç§¯çš„æ¶ˆæ¯åˆ†æ•£åˆ°å¤šä¸ªQueuï¼Œç„¶åå¤šä¸ªComsumeræ¶ˆè´¹</p><hr><p>å‘ç”Ÿäº†æ¶ˆæ¯ç§¯å‹ï¼Œè¿™æ—¶å€™å°±å¾—æƒ³åŠæ³•èµ¶ç´§æŠŠç§¯å‹çš„æ¶ˆæ¯æ¶ˆè´¹å®Œï¼Œå°±å¾—è€ƒè™‘æé«˜æ¶ˆè´¹èƒ½åŠ›ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§åŠæ³•ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308100619.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308100915.png" alt="image.png"></p><p>æ¶ˆæ¯è¿ç§»æ‰©å®¹æ¶ˆè´¹<br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307105817.png" alt="image.png"></p><h4 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±-ğŸš©"><a href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±-ğŸš©" class="headerlink" title="å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±  ğŸš©"></a>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±  ğŸš©</h4><p>å¯èƒ½ä¼šåœ¨è¿™ä¸‰ä¸ªé˜¶æ®µå‘ç”Ÿä¸¢å¤±ï¼šç”Ÿäº§é˜¶æ®µã€å­˜å‚¨é˜¶æ®µã€æ¶ˆè´¹é˜¶æ®µã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308094409.png" alt="image.png"></p><ul><li>å¯èƒ½çš„ç‚¹ï¼šç”Ÿäº§ â†’ Brokerï¼›Broker æŒä¹…åŒ–ï¼›Broker â†’ æ¶ˆè´¹  </li><li>ç”Ÿäº§ â†’ Broker  <ul><li>RockerMQç”Ÿäº§ç«¯æœ‰ä¸‰ç§å‘é€æ¨¡å¼  <ul><li>åŒæ­¥å‘é€ï¼ˆéœ€è¦ç­‰ Broker æœ‰åé¦ˆä¹‹åæ‰èƒ½ç»§ç»­å‘ï¼‰  </li><li>å•å‘å‘é€ï¼ˆç”Ÿäº§ç«¯ç›´æ¥å‘ï¼‰  </li><li>å¼‚æ­¥å‘é€ï¼ˆå‘é€æ¶ˆæ¯çš„åŒæ—¶æ³¨å†Œä¸€ä¸ªå›è°ƒ å»å¤„ç†å“åº”ï¼Œå®‰å…¨æ€§ä½ï¼Œå®¹æ˜“ä¸¢æ¶ˆæ¯ï¼‰</li></ul></li><li>é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼Œå¯ä»¥é‡‡ç”¨åŒæ­¥å‘é€</li></ul></li><li>Broker æŒä¹…åŒ–  <ul><li>é‡‡ç”¨åŒæ­¥åˆ·ç›˜ä»¥åŠ2PC ä¸¤é˜¶æ®µæäº¤ï¼Œæ¥ä¿è¯åŒæ­¥æ—¶ä¸ä¼šä¸¢æ¶ˆæ¯  </li><li>å¼‚æ­¥åˆ·ç›˜ä¸€æ–­ç”µå°±ä¼šä¸¢æ¶ˆæ¯</li></ul></li><li>Broker â†’ æ¶ˆè´¹  <ul><li>é‡‡ç”¨åŒæ­¥æ¶ˆè´¹æœºåˆ¶ï¼Œä¸è¦ä½¿ç”¨å¼‚æ­¥æ¶ˆè´¹æœºåˆ¶  <ul><li>åœ¨åŒæ­¥æ¶ˆè´¹æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹å®Œæ¶ˆæ¯ä¹‹åå†å»ç»™Brokerç«¯åé¦ˆï¼Œç„¶åBrokerç«¯ä¼šå»ç»´æŠ¤æ¶ˆæ¯åç§»é‡ï¼Œå¦‚æœæ¶ˆè´¹å¤±è´¥å¯ä»¥è¿›â¾â¼€å®šæ¬¡æ•°çš„é‡è¯•  </li><li>åœ¨å¼‚æ­¥æ¶ˆè´¹æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹å®Œæ¶ˆæ¯çš„åŒæ—¶ä¹Ÿä¼šå‘Brokerç«¯åé¦ˆï¼Œç„¶åBrokerç«¯ä¼šå»ç»´æŠ¤æ¶ˆæ¯åç§»é‡ï¼Œå¦‚æœå¤„ç†å¤±è´¥äº†ï¼Œä¸ä¼šè¿›â¾é‡è¯•å› ä¸ºåç§»é‡å·²ç»å˜æ›´</li></ul></li></ul></li><li>å¦å¤–RocketMQæœåŠ¡éœ€è¦æœ‰é™çº§â½…æ¡ˆï¼Œå¯¹äºRocketMQæ¥è¯´ï¼ŒNameServeræŒ‚äº†ï¼Œæœ¬èº«å°±â½†æ³•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±äº†ï¼Œæ‰€ä»¥åº”å¯¹è¿™ç§åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿â½¤æœåŠ¡é™çº§â½…æ¡ˆï¼Œå°†æ¶ˆæ¯æš‚å­˜åˆ°Redisã€â½‚ä»¶æˆ–å†…å­˜ä¸­ï¼Œç­‰MQæœåŠ¡æ¢å¤ä¹‹åå†å°†æ¶ˆæ¯è½¬ç§»è¿‡å»</li></ul><p>ç”Ÿäº§é˜¶æ®µ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308094540.png" alt="image.png"></p><p>ç”Ÿäº§è€…å¯ä»¥åˆ©ç”¨RocketMQæä¾›çš„æŸ¥è¯¢APIæ¥ç¡®è®¤æ¶ˆæ¯æ˜¯å¦å·²ç»æˆåŠŸå­˜å‚¨åœ¨Brokerä¸Šã€‚</p><p>å­˜å‚¨é˜¶æ®µ</p><p>å¦‚æœéœ€è¦ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œå¯ä»¥ä½¿ç”¨ åŒæ­¥å¤åˆ¶ï¼ˆèŠ‚ç‚¹ä¸»ä»ï¼‰ + åŒæ­¥åˆ·ç›˜ï¼ˆæ—¥å¿—å­˜å‚¨ï¼‰</p><p>ä¸è¿‡ä¸€èˆ¬é›†ç¾¤æ˜¯ åŒæ­¥å¤åˆ¶ + å¼‚æ­¥åˆ·ç›˜</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308094801.png" alt="image.png"><br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308094823.png" alt="image.png"></p><p>æ¶ˆè´¹é˜¶æ®µ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308095216.png" alt="image.png"></p><h4 id="å¦‚ä½•é¿å…é‡å¤æ¶ˆè´¹"><a href="#å¦‚ä½•é¿å…é‡å¤æ¶ˆè´¹" class="headerlink" title="å¦‚ä½•é¿å…é‡å¤æ¶ˆè´¹"></a>å¦‚ä½•é¿å…é‡å¤æ¶ˆè´¹</h4><p>å¤„ç†æ¶ˆæ¯é‡å¤é—®é¢˜ï¼Œä¸»è¦æœ‰ä¸šåŠ¡ç«¯è‡ªå·±ä¿è¯ï¼Œä¸»è¦çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š<strong>ä¸šåŠ¡å¹‚ç­‰</strong>å’Œ<strong>æ¶ˆæ¯å»é‡</strong>ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308095941.png" alt="image.png"></p><p>åœ¨æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿä¸­ï¼Œç”±äºå„ç§åŸå› ï¼ˆå¦‚ç½‘ç»œæ³¢åŠ¨ã€Broker é‡å¯ç­‰ï¼‰ï¼Œæ¶ˆæ¯å¯èƒ½ä¼šè¢«é‡å¤å‘é€ç»™æ¶ˆè´¹è€…ã€‚</p><blockquote><p>å®ç°å¹‚ç­‰æ€§çš„æ–¹æ³•</p></blockquote><ul><li>1ã€é€šè¿‡å”¯ä¸€æ ‡è¯†ç¬¦æ ‡è®°æŸæ¡æ¶ˆæ¯</li><li>2ã€é€šè¿‡æ•°æ®åº“å”¯ä¸€çº¦æŸæˆ–è€…å”¯ä¸€ä¸»é”®è¿›è¡Œå¹‚ç­‰æ“ä½œ</li><li>3ã€åˆ†å¸ƒå¼é”ï¼šé€šè¿‡ Redis çš„ setnx è¿›è¡Œåˆ¤æ–­æ˜¯å¦ç›¸åŒæ ‡è¯†ç¬¦</li></ul><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.yuque.com/quzuopeng/gnbc16/aa63cam94sbc80y1">https://www.yuque.com/quzuopeng/gnbc16/aa63cam94sbc80y1</a></li><li><a href="https://javaguide.cn/high-performance/message-queue/rocketmq-questions.html">https://javaguide.cn/high-performance/message-queue/rocketmq-questions.html</a></li><li><a href="https://www.bilibili.com/video/BV1ua4y1N7P2?p=17&vd_source=6a019ecccfe7d8f62b9a3fe99c723bd0">https://www.bilibili.com/video/BV1ua4y1N7P2?p=17&amp;vd_source=6a019ecccfe7d8f62b9a3fe99c723bd0</a></li><li><a href="https://rocketmq.apache.org/zh/docs/quickStart/01quickstart/">https://rocketmq.apache.org/zh/docs/quickStart/01quickstart/</a></li><li><a href="https://doocs.github.io/advanced-java/#/docs/high-concurrency/how-to-ensure-high-availability-of-message-queues">https://doocs.github.io/advanced-java/#/docs/high-concurrency/how-to-ensure-high-availability-of-message-queues</a></li><li><a href="http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/RocketMQ%20%E9%9D%A2%E8%AF%95%E9%A2%98%E9%9B%86%E9%94%A6.md">http://learn.lianglianglee.com/%E6%96%87%E7%AB%A0/RocketMQ%20%E9%9D%A2%E8%AF%95%E9%A2%98%E9%9B%86%E9%94%A6.md</a></li><li><a href="https://www.cnblogs.com/javazhiyin/p/13327925.html">https://www.cnblogs.com/javazhiyin/p/13327925.html</a></li><li><a href="https://mp.weixin.qq.com/s/IvBt3tB_IWZgPjKv5WGS4A">https://mp.weixin.qq.com/s/IvBt3tB_IWZgPjKv5WGS4A</a>   ğŸš©</li><li><a href="https://www.bilibili.com/video/BV1ua4y1N7P2">https://www.bilibili.com/video/BV1ua4y1N7P2</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>MQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2024/03/07/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2024/03/07/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<p>2023-11-22ï¼šç¬¬ä¸€æ¬¡åˆ›å»º</p><p>20240308ï¼š å¯¹éƒ¨åˆ†å†…å®¹è¿›è¡Œäº†æ›´æ–°</p><ul><li>SpringCloud<ul><li>æœåŠ¡æ³¨å†Œ<ul><li>nacos</li><li>eureka</li></ul></li><li>è´Ÿè½½å‡è¡¡<ul><li>Ribbon è´Ÿè½½å‡è¡¡ç­–ç•¥</li><li>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡</li></ul></li><li>ç†”æ–­ã€é™çº§</li><li>ç›‘æ§   skywalking</li></ul></li><li>ä¸šåŠ¡ç›¸å…³<ul><li>é™æµ<ul><li>æ¼æ¡¶ç®—æ³•</li><li>ä»¤ç‰Œæ¡¶ç®—æ³•</li></ul></li><li>åˆ†å¸ƒå¼äº‹åŠ¡ <ul><li>åˆ†å¸ƒå¼ç†è®º CAPã€BASE</li><li>åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</li><li>seata</li></ul></li><li>åˆ†å¸ƒå¼æœåŠ¡æ¥å£å¹‚ç­‰</li><li>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦   xxl-job</li></ul></li><li>æ¶ˆæ¯ä¸­é—´ä»¶</li></ul><h3 id="ä¸€ã€åŸºç¡€æ¦‚å¿µ"><a href="#ä¸€ã€åŸºç¡€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºç¡€æ¦‚å¿µ"></a>ä¸€ã€åŸºç¡€æ¦‚å¿µ</h3><h4 id="1ã€SpringCloudæ˜¯ä»€ä¹ˆ"><a href="#1ã€SpringCloudæ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€SpringCloudæ˜¯ä»€ä¹ˆ"></a>1ã€SpringCloudæ˜¯ä»€ä¹ˆ</h4><p>SpringCloud æä¾›äº†ä¸€æ•´å¥—çš„åˆ†å¸ƒå¼ç³»ç»Ÿè§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡ Spring Boot é£æ ¼çš„å°è£…ï¼Œå±è”½æ‰äº†å¤æ‚çš„é…ç½®å’Œå®ç°åŸç†ï¼Œæœ€ç»ˆç»™å¼€å‘è€…ç•™å‡ºäº†ä¸€å¥—ç®€å•æ˜“æ‡‚ã€å®¹æ˜“éƒ¨ç½²çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·åŒ…ã€‚</p><p>SpringCloud åŒ…å«äº†ï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°ã€é…ç½®ä¸­å¿ƒã€æœåŠ¡ç½‘å…³ã€æ™ºèƒ½è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€ç›‘æ§è·Ÿè¸ªã€åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚</p><p>Spring Cloud åŒ…å«å¾ˆå¤šå­é¡¹ç›®ï¼Œå›½å†…ä¸»è¦æ˜¯é‡‡ç”¨ Netflix å’Œ Alibaba ä¸¤ä¸ªæ ‡å‡†å®ç°ï¼Œå‰è€…ç”±äºä¸å†ç»´æŠ¤ï¼Œç›®å‰ä¸€èˆ¬é‡‡ç”¨Spring Cloud Alibaba è¿™ä¸€å¥—å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆã€‚</p><blockquote><p>äº†è§£ç»„ä»¶</p></blockquote><p>Spring Cloud Netflix ç¬¬ä¸€ä»£</p><p>é’ˆå¯¹å¤šç§ Netflix ç»„ä»¶æä¾›çš„å¼€å‘å·¥å…·åŒ…ï¼Œå…¶ä¸­åŒ…æ‹¬ Eurekaã€Ribbonã€Feignã€Hystrixã€Zuulã€Archaius ç­‰ã€‚</p><ul><li><code>Netflix Eureka</code>ï¼šä¸€ä¸ªåŸºäº Rest æœåŠ¡çš„æœåŠ¡æ²»ç†ç»„ä»¶ï¼ŒåŒ…æ‹¬æœåŠ¡æ³¨å†Œä¸­å¿ƒã€æœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°æœºåˆ¶çš„å®ç°ï¼Œå®ç°äº†äº‘ç«¯è´Ÿè½½å‡è¡¡å’Œä¸­é—´å±‚æœåŠ¡å™¨çš„æ•…éšœè½¬ç§»ã€‚</li><li><code>Netflix Ribbon</code>ï¼šå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„æœåŠ¡è°ƒç”¨ç»„ä»¶ã€‚</li><li><code>Netflix Hystrix</code>ï¼šå®¹é”™ç®¡ç†å·¥å…·ï¼Œå®ç°æ–­è·¯å™¨æ¨¡å¼ï¼Œé€šè¿‡æ§åˆ¶æœåŠ¡çš„èŠ‚ç‚¹ï¼Œä»è€Œå¯¹å»¶è¿Ÿå’Œæ•…éšœæä¾›æ›´å¼ºå¤§çš„å®¹é”™èƒ½åŠ›ã€‚</li><li><code>Netflix Feign</code>ï¼šåŸºäº Ribbon å’Œ Hystrix çš„å£°æ˜å¼æœåŠ¡è°ƒç”¨ç»„ä»¶ã€‚</li><li><code>Netflix Zuul</code>ï¼šå¾®æœåŠ¡ç½‘å…³ï¼Œæä¾›åŠ¨æ€è·¯ç”±ï¼Œè®¿é—®è¿‡æ»¤ç­‰æœåŠ¡ã€‚</li><li><code>Netflix Archaius</code>ï¼šé…ç½®ç®¡ç† APIï¼ŒåŒ…å«ä¸€ç³»åˆ—é…ç½®ç®¡ç† APIï¼Œæä¾›åŠ¨æ€ç±»å‹åŒ–å±æ€§ã€çº¿ç¨‹å®‰å…¨é…ç½®æ“ä½œã€è½®è¯¢æ¡†æ¶ã€å›è°ƒæœºåˆ¶ç­‰åŠŸèƒ½ã€‚</li></ul><p>Spring Cloud Alibaba ç¬¬äºŒä»£</p><p><strong>é˜¿é‡Œå¼€æºç»„ä»¶</strong></p><ul><li><code>Nacos</code>ï¼šé˜¿é‡Œå·´å·´å¼€æºäº§å“ï¼Œä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚</li><li><code>Sentinel</code>ï¼šé¢å‘åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„è½»é‡çº§æµé‡æ§åˆ¶äº§å“ï¼ŒæŠŠæµé‡ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</li><li><code>RocketMQ</code>ï¼šä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼ŒåŸºäºé«˜å¯ç”¨åˆ†å¸ƒå¼é›†ç¾¤æŠ€æœ¯ï¼Œæä¾›ä½å»¶æ—¶çš„ã€é«˜å¯é çš„æ¶ˆæ¯å‘å¸ƒä¸è®¢é˜…æœåŠ¡ã€‚</li><li><code>Dubbo</code>ï¼šApache Dubboâ„¢ æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ Java RPC æ¡†æ¶ï¼Œç”¨äºå®ç°æœåŠ¡é€šä¿¡ã€‚</li><li><code>Seata</code>ï¼šé˜¿é‡Œå·´å·´å¼€æºäº§å“ï¼Œä¸€ä¸ªæ˜“äºä½¿ç”¨çš„é«˜æ€§èƒ½å¾®æœåŠ¡åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</li></ul><p><strong>é˜¿é‡Œå•†ä¸šåŒ–ç»„ä»¶</strong></p><ul><li><code>Alibaba Cloud ACM</code>ï¼šä¸€æ¬¾åœ¨åˆ†å¸ƒå¼æ¶æ„ç¯å¢ƒä¸­å¯¹åº”ç”¨é…ç½®è¿›è¡Œé›†ä¸­ç®¡ç†å’Œæ¨é€çš„åº”ç”¨é…ç½®ä¸­å¿ƒäº§å“ã€‚</li><li><code>Alibaba Cloud OSS</code>ï¼šé˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆObject Storage Serviceï¼Œç®€ç§° OSSï¼‰ï¼Œæ˜¯é˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ‚¨å¯ä»¥åœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li><li><code>Alibaba Cloud SchedulerX</code>ï¼šé˜¿é‡Œä¸­é—´ä»¶å›¢é˜Ÿå¼€å‘çš„ä¸€æ¬¾åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦äº§å“ï¼Œæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚</li><li><code>Alibaba Cloud SMS</code>ï¼šè¦†ç›–å…¨çƒçš„çŸ­ä¿¡æœåŠ¡ï¼Œå‹å¥½ã€é«˜æ•ˆã€æ™ºèƒ½çš„äº’è”åŒ–é€šè®¯èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šè¿…é€Ÿæ­å»ºå®¢æˆ·è§¦è¾¾é€šé“ã€‚</li></ul><blockquote><p>å…³äºCloudå„ç§ç»„ä»¶çš„åœæ›´å‡çº§æ›¿æ¢</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311221942122.png" alt="image.png"></p><blockquote><p>SpringCloud ç‰ˆæœ¬ä»‹ç»</p></blockquote><p>ç•¥</p><p>Eurekaã€Ribbonã€Feignã€Hystrixã€Zuulã€Archaius</p><h4 id="2ã€SpringCloud-çš„å¸¸ç”¨ç»„ä»¶"><a href="#2ã€SpringCloud-çš„å¸¸ç”¨ç»„ä»¶" class="headerlink" title="2ã€SpringCloud çš„å¸¸ç”¨ç»„ä»¶"></a>2ã€SpringCloud çš„å¸¸ç”¨ç»„ä»¶</h4><p>å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»è¦å›ç­”å‡ºåŸºæœ¬æ¶æ„ç›¸å…³çš„ä¸€äº›ç»„ä»¶ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402280922280.png" alt="image.png"></p><p>Spring Cloud Netflix ç¬¬ä¸€ä»£</p><ul><li>Eureka   æ³¨å†Œä¸­å¿ƒ</li><li>Ribbon   è´Ÿè½½å‡è¡¡</li><li>Feign     è¿œç¨‹è°ƒç”¨</li><li>Hystrix  æœåŠ¡ç†”æ–­</li><li>Zuul  ç½‘å…³</li></ul><p>Spring Cloud Alibaba ç¬¬äºŒä»£</p><ul><li>Nacos   æ³¨å†Œä¸­å¿ƒã€é…ç½®ä¸­å¿ƒ</li><li>Ribbon   è´Ÿè½½å‡è¡¡</li><li>OpenFeign     è¿œç¨‹è°ƒç”¨</li><li>Sentinel   æœåŠ¡ä¿æŠ¤</li><li>Gateway  ç½‘å…³</li></ul><h4 id="3ã€å¾®æœåŠ¡"><a href="#3ã€å¾®æœåŠ¡" class="headerlink" title="3ã€å¾®æœåŠ¡"></a>3ã€å¾®æœåŠ¡</h4><p>å¯èƒ½ä¼šé—®ä¸€äº›å…³äºå¾®æœåŠ¡ç›¸å…³çš„æ¦‚å¿µå’ŒçŸ¥è¯†</p><h4 id="4ã€å¸¸è§æ¦‚å¿µ"><a href="#4ã€å¸¸è§æ¦‚å¿µ" class="headerlink" title="4ã€å¸¸è§æ¦‚å¿µ"></a>4ã€å¸¸è§æ¦‚å¿µ</h4><h5 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h5><ul><li>ä¸€è‡´æ€§</li><li>å¯ç”¨æ€§</li><li>åˆ†åŒºå®¹é”™æ€§</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281656511.png" alt="image.png"></p><ul><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ï¼šæ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„æ•°æ®åœ¨åŒä¸€æ—¶é—´æ˜¯ç›¸åŒçš„ã€‚å³åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¯æ¬¡è¯»å–æ“ä½œéƒ½èƒ½å¾—åˆ°æœ€æ–°çš„å†™å…¥ç»“æœã€‚ä¸€è‡´æ€§ç¡®ä¿äº†ç³»ç»Ÿçš„æ•°æ®å‰¯æœ¬ä¹‹é—´èƒ½å¤Ÿè¾¾æˆä¸€è‡´çš„çŠ¶æ€ã€‚</li><li><strong>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰</strong>ï¼šæ¯ä¸ªè¯·æ±‚éƒ½èƒ½åœ¨æœ‰é™çš„æ—¶é—´å†…æ”¶åˆ°ä¸€ä¸ªæ˜ç¡®çš„å“åº”ï¼Œæ— è®ºå“åº”æ˜¯æˆåŠŸçš„è¿˜æ˜¯å¤±è´¥çš„ã€‚å¯ç”¨æ€§ä¿è¯äº†ç³»ç»Ÿèƒ½å¤ŸæŒç»­å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</li><li><strong>åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰</strong>ï¼šç³»ç»Ÿèƒ½å¤Ÿåœ¨ä»»æ„ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ç»§ç»­è¿è¡Œã€‚åˆ†åŒºå®¹é”™æ€§æŒ‡çš„æ˜¯ï¼Œå³ä½¿ç³»ç»Ÿå†…éƒ¨å‘ç”Ÿäº†ç½‘ç»œåˆ†å‰²ï¼Œä½¿å¾—æŸäº›èŠ‚ç‚¹ä¹‹é—´æ— æ³•é€šä¿¡ï¼Œç³»ç»Ÿä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§æˆ–å¯ç”¨æ€§çš„æœåŠ¡ã€‚</li></ul><p>å®é™…åº”ç”¨ï¼š</p><p>åœ¨å®é™…çš„åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­ï¼ŒCAPå®šç†æä¾›äº†ä¸€ä¸ªç†è®ºæ¡†æ¶æ¥æŒ‡å¯¼å¦‚ä½•åœ¨ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ä¹‹é—´åšå‡ºæƒè¡¡ã€‚ä¸åŒçš„ç³»ç»Ÿå¯èƒ½ä¼šæ ¹æ®è‡ªèº«çš„ä¸šåŠ¡éœ€æ±‚å’Œç‰¹ç‚¹ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±çš„CAPå¹³è¡¡ç‚¹ï¼š</p><ul><li><strong>CAç³»ç»Ÿ</strong>ï¼šæ”¾å¼ƒåˆ†åŒºå®¹é”™æ€§ï¼Œé€šå¸¸é€‚ç”¨äºå•ä¸€æ•°æ®ä¸­å¿ƒçš„ä¼ ç»Ÿæ•°æ®åº“ç³»ç»Ÿã€‚</li><li><strong>CPç³»ç»Ÿ</strong>ï¼šæ”¾å¼ƒå¯ç”¨æ€§ï¼Œé€‚ç”¨äºå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜çš„ç³»ç»Ÿ</li><li><strong>APç³»ç»Ÿ</strong>ï¼šæ”¾å¼ƒä¸€è‡´æ€§ï¼Œé€‚ç”¨äºå¯¹å¯ç”¨æ€§è¦æ±‚æé«˜çš„ç³»ç»Ÿ</li></ul><p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç³»ç»ŸèŠ‚ç‚¹ä¹‹é—´è‚¯å®šçš„éœ€è¦æœ‰ç½‘ç»œè¿æ¥çš„ï¼Œå› æ­¤åˆ†åŒºï¼ˆP) æ˜¯å¿…ç„¶å­˜åœ¨çš„</p><hr><p>åœ¨ç°å®çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç½‘ç»œåˆ†åŒºæ˜¯ä¸å¯é¿å…çš„ï¼Œå› æ­¤åˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼‰æ˜¯å¿…é¡»è¦æ»¡è¶³çš„ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬åªèƒ½åœ¨ä¸€è‡´æ€§ï¼ˆCï¼‰å’Œå¯ç”¨æ€§ï¼ˆAï¼‰ä¹‹é—´åšå‡ºé€‰æ‹©ã€‚</p><ul><li><strong>APç³»ç»Ÿ</strong>ï¼šåœ¨ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œé€‰æ‹©ä¿è¯å¯ç”¨æ€§ï¼Œä½†ç‰ºç‰²äº†ä¸€è‡´æ€§ã€‚è¿™æ„å‘³ç€åœ¨æŸäº›èŠ‚ç‚¹ä¸Šå¯èƒ½è¯»å–åˆ°çš„æ˜¯è¿‡æ—¶çš„æ•°æ®ï¼Œå› ä¸ºç³»ç»Ÿä¸ºäº†ä¿è¯å“åº”çš„å¯ç”¨æ€§ï¼Œå…è®¸åœ¨æ²¡æœ‰è·å–åˆ°æœ€æ–°æ•°æ®å‰¯æœ¬çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚</li><li><strong>CPç³»ç»Ÿ</strong>ï¼šåœ¨ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œé€‰æ‹©ä¿è¯ä¸€è‡´æ€§ï¼Œä½†å¯èƒ½ç‰ºç‰²å¯ç”¨æ€§ã€‚è¿™æ„å‘³ç€å¦‚æœæ•°æ®ä¸èƒ½åœ¨æ‰€æœ‰èŠ‚ç‚¹é—´åŒæ­¥ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæ‹’ç»å¤„ç†è¯»å†™è¯·æ±‚ï¼Œä»¥ä¿è¯ä¸ä¼šè¿”å›é”™è¯¯æˆ–è¿‡æ—¶çš„æ•°æ®ã€‚</li></ul><h5 id="BASE-ğŸš©"><a href="#BASE-ğŸš©" class="headerlink" title="BASE  ğŸš©"></a>BASE  ğŸš©</h5><p>BASEç†è®ºæ˜¯å¯¹CAPç†è®ºçš„ä¸€ç§è¡¥å……å’Œå»¶ä¼¸ï¼Œä¸»è¦é¢å‘å¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåœ¨ç‰ºç‰²å¼ºä¸€è‡´æ€§çš„å‰æä¸‹ï¼Œè¿½æ±‚ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚</p><p>BASEæ˜¯ä¸‰ä¸ªè‹±æ–‡å•è¯çš„ç¼©å†™ï¼Œåˆ†åˆ«ä»£è¡¨ï¼š</p><ul><li><strong>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰</strong>ï¼šç³»ç»Ÿå…è®¸åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œä¿æŒæ ¸å¿ƒå¯ç”¨ï¼Œä½†æ˜¯å…è®¸éƒ¨åˆ†æš‚æ—¶ä¸å¯ç”¨ã€‚è¿™æ„å‘³ç€åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ˆå¦‚ç½‘ç»œåˆ†åŒºã€ç³»ç»Ÿæ•…éšœï¼‰ï¼Œç³»ç»Ÿä»ç„¶èƒ½æä¾›åŸºæœ¬çš„æœåŠ¡ï¼Œå³ä½¿è¿™äº›æœåŠ¡å¯èƒ½æ˜¯é™çº§çš„ã€‚</li><li><strong>è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰</strong>ï¼šç³»ç»Ÿçš„çŠ¶æ€ä¸éœ€è¦å®æ—¶ä¸€è‡´ï¼Œå…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¿™ç§çŠ¶æ€æ˜¯æ­£å¸¸çš„ã€‚ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ä¼ ç»Ÿæ•°æ®åº“ä¸­æ•°æ®çš„â€œç¡¬çŠ¶æ€â€ï¼Œå¿…é¡»ä¿è¯æ•°æ®åœ¨ä»»ä½•æ—¶åˆ»éƒ½æ˜¯ä¸€è‡´çš„ã€‚è½¯çŠ¶æ€å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹é—´æ•°æ®åŒæ­¥å­˜åœ¨å»¶è¿Ÿã€‚</li><li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰</strong>ï¼šç³»ç»Ÿä¿è¯åœ¨æ²¡æœ‰æ–°çš„æ›´æ–°æ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ•°æ®æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ï¼Œæ‰€æœ‰çš„æ›´æ–°æ“ä½œæœ€ç»ˆå°†ä¼šä¼ æ’­åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œä½†å¹¶ä¸ä¿è¯æ›´æ–°æ“ä½œçš„å®æ—¶æ€§å’Œé¡ºåºæ€§ã€‚</li></ul><p>BASEç†è®ºæä¾›äº†ä¸€ç§é¢å‘å¯ç”¨æ€§å’Œæ€§èƒ½çš„ã€å¯¹ä¸€è‡´æ€§è¦æ±‚ç›¸å¯¹å®½æ¾çš„è®¾è®¡å’Œå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ–¹æ³•è®ºï¼Œå¼ºè°ƒé€šè¿‡ç‰ºç‰²ä¸€è‡´æ€§æ¥è·å¾—é«˜å¯ç”¨æ€§å’Œé«˜æ€§èƒ½çš„å¯èƒ½æ€§ã€‚</p><blockquote><p>ç¤ºä¾‹ï¼šåŸºäºBase ç†è®ºå®ç°åˆ†å¸ƒå¼äº‹åŠ¡</p></blockquote><blockquote><p>é¢è¯•é¢˜ï¼šè§£é‡Šä¸€ä¸‹  CAP  å’Œ   BASE</p></blockquote><ul><li>CAPå®šç†ï¼ˆä¸€è‡´æ€§.å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§ï¼‰<ul><li>1.åˆ†å¸ƒå¼ç³»ç»ŸèŠ‚ç‚¹é€šè¿‡ç½‘æ ¼è¿æ¥ã€‚ä¸€å®šä¼šå‡ºç°åˆ†åŒºé—®é¢˜(P)</li><li>2.å½“åˆ†åŒºå‡ºç°æ—¶ï¼Œç³»ç»Ÿçš„ä¸€è‡´æ€§(C)å’Œå¯ç”¨æ€§(A)å°±æ— æ³•åŒæ—¶æ»¡è¶³</li></ul></li><li>BASEç†è®º<ul><li>1,åŸºæœ¬å¯ç”¨</li><li>2.è½¯çŠ¶æ€</li><li>3.æœ€ç»ˆä¸€è‡´</li></ul></li><li>è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„æ€æƒ³å’Œæ¨¡å‹ï¼š<ul><li>1,æœ€ç»ˆä¸€è‡´æ€æƒ³ï¼šå„åˆ†æ”¯äº‹åŠ¡åˆ†åˆ«æ‰§è¡Œå¹¶æäº¤ï¼Œå¦‚æœæœ‰ä¸ä¸€è‡´çš„æƒ…å†µï¼Œå†æƒ³åŠæ³•æ¢å¤æ•°æ®(AP)</li><li>2.å¼ºä¸€è‡´æ€æƒ³ï¼šå„åˆ†æ”¯äº‹åŠ¡æ‰§è¡Œå®Œä¸šåŠ¡ä¸è¦æäº¤ã€‚ç­‰å¾…å½¼æ­¤ç»“æœï¼Œè€Œåç»Ÿä¸€æäº¤æˆ–å›æ»š(CP)</li></ul></li></ul><p>è¿™ä¸ªç†è§£æœ‰ç‚¹é—®é¢˜ï¼Œå¾…åç»­å›é¡¾ä¸€ä¸‹ to be continedâ€¦.</p><hr><h3 id="äºŒã€Nacos"><a href="#äºŒã€Nacos" class="headerlink" title="äºŒã€Nacos"></a>äºŒã€Nacos</h3><h4 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><p>Nacosæ˜¯ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚</p><p>Nacosæ”¯æŒå‡ ä¹æ‰€æœ‰ä¸»æµç±»å‹çš„æœåŠ¡çš„â€œæœåŠ¡å‘ç°å’ŒæœåŠ¡å¥åº·ç›‘æµ‹â€ï¼ŒåŒæ—¶æä¾›åŠ¨æ€é…ç½®æœåŠ¡ï¼Œæ”¯æŒé…ç½®çš„åŠ¨æ€æ›´æ–°ï¼ŒæœåŠ¡è·¯ç”±å’Œç®¡ç†ç­‰ä¸°å¯Œçš„åŠŸèƒ½ã€‚ï¼ˆä¸»è¦åŠŸèƒ½åŒ…æ‹¬æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ï¼‰</p><h5 id="æœåŠ¡å‘ç°-ğŸš©"><a href="#æœåŠ¡å‘ç°-ğŸš©" class="headerlink" title="æœåŠ¡å‘ç°  ğŸš©"></a>æœåŠ¡å‘ç°  ğŸš©</h5><ol><li><strong>æœåŠ¡æ³¨å†Œ</strong>ï¼šæœåŠ¡å®ä¾‹åœ¨å¯åŠ¨æ—¶ï¼Œé€šè¿‡Nacoså®¢æˆ·ç«¯å‘Nacos Serveræ³¨å†Œè‡ªå·±çš„æœåŠ¡ä¿¡æ¯ï¼ˆåŒ…æ‹¬æœåŠ¡åã€å®ä¾‹IPã€ç«¯å£ç­‰ï¼‰ã€‚Nacos Serveræ¥æ”¶åˆ°æ³¨å†Œä¿¡æ¯åï¼Œå°†å…¶å­˜å‚¨åœ¨æœåŠ¡æ³¨å†Œè¡¨ä¸­ã€‚</li><li><strong>æœåŠ¡åŒæ­¥</strong>ï¼šåœ¨Nacosé›†ç¾¤ç¯å¢ƒä¸‹ï¼ŒæœåŠ¡æ³¨å†Œä¿¡æ¯ä¼šåœ¨Nacos ServerèŠ‚ç‚¹é—´è¿›è¡ŒåŒæ­¥ï¼Œç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹çš„æœåŠ¡æ³¨å†Œè¡¨ä¿¡æ¯ä¸€è‡´ã€‚</li><li><strong>æœåŠ¡å¥åº·æ£€æŸ¥</strong>ï¼šNacos Serverå®šæœŸå¯¹æ³¨å†Œçš„æœåŠ¡å®ä¾‹è¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œæ ¹æ®å¿ƒè·³æœºåˆ¶æˆ–è€…å…¶ä»–å¥åº·æ£€æŸ¥æœºåˆ¶æ¥æ›´æ–°æœåŠ¡å®ä¾‹çš„å¥åº·çŠ¶æ€ã€‚ä¸å¥åº·çš„æœåŠ¡å®ä¾‹ä¼šè¢«æ ‡è®°ï¼Œä»¥é˜²æ­¢è¢«è°ƒç”¨ã€‚</li><li><strong>æœåŠ¡å‘ç°</strong>ï¼šå®¢æˆ·ç«¯åº”ç”¨é€šè¿‡Nacoså®¢æˆ·ç«¯å‘Nacos ServeræŸ¥è¯¢ç›®æ ‡æœåŠ¡çš„å¯ç”¨æœåŠ¡å®ä¾‹åˆ—è¡¨ã€‚Nacos Serverè¿”å›å¥åº·çš„æœåŠ¡å®ä¾‹åˆ—è¡¨ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹è¿›è¡Œè°ƒç”¨ã€‚</li></ol><p>å·¥ä½œæµç¨‹å°†çš„æœ‰ç‚¹é—®é¢˜ï¼ŒåŒ…æ‹¬æœåŠ¡å‘ç°çš„å…·ä½“å®é™…æ“ä½œæ˜¯æ€ä¹ˆæ ·çš„ï¼Œç»†èŠ‚ä¹Ÿæ²¡æœ‰è®²è¿°åˆ°ã€‚ </p><h5 id="å·¥ä½œæµç¨‹-ğŸš©-ğŸ’£"><a href="#å·¥ä½œæµç¨‹-ğŸš©-ğŸ’£" class="headerlink" title="å·¥ä½œæµç¨‹ ğŸš© ğŸ’£"></a>å·¥ä½œæµç¨‹ ğŸš© ğŸ’£</h5><h5 id="é…ç½®ç®¡ç†"><a href="#é…ç½®ç®¡ç†" class="headerlink" title="é…ç½®ç®¡ç†"></a>é…ç½®ç®¡ç†</h5><ol><li><strong>é…ç½®å‘å¸ƒ</strong>ï¼šåº”ç”¨æˆ–æ“ä½œäººå‘˜é€šè¿‡Nacosæ§åˆ¶å°ã€APIæˆ–SDKå‘Nacos Serverå‘å¸ƒé…ç½®ä¿¡æ¯ã€‚Nacos Serverå°†é…ç½®ä¿¡æ¯å­˜å‚¨åœ¨é…ç½®å­˜å‚¨ä¸­ã€‚</li><li><strong>é…ç½®å˜æ›´é€šçŸ¥</strong>ï¼šå½“é…ç½®ä¿¡æ¯å‘ç”Ÿå˜æ›´æ—¶ï¼ŒNacos Serverä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…äº†è¯¥é…ç½®çš„å®¢æˆ·ç«¯åº”ç”¨ã€‚</li><li><strong>é…ç½®è·å–</strong>ï¼šå®¢æˆ·ç«¯åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¼šé€šè¿‡Nacoså®¢æˆ·ç«¯å‘Nacos ServeræŸ¥è¯¢æ‰€éœ€çš„é…ç½®ä¿¡æ¯ã€‚Nacos Serverä»é…ç½®å­˜å‚¨ä¸­æ£€ç´¢é…ç½®ä¿¡æ¯å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li><li><strong>åŠ¨æ€æ›´æ–°</strong>ï¼šå®¢æˆ·ç«¯åº”ç”¨åœ¨æ”¶åˆ°é…ç½®å˜æ›´é€šçŸ¥åï¼Œä¼šé‡æ–°å‘Nacos Serverè¯·æ±‚æœ€æ–°çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶æ ¹æ®æ–°çš„é…ç½®ä¿¡æ¯åŠ¨æ€è°ƒæ•´è‡ªå·±çš„è¡Œä¸ºï¼Œæ— éœ€é‡å¯åº”ç”¨ã€‚</li></ol><h5 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h5><ul><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šNacosé‡‡ç”¨Distroï¼ˆä¸€ç§APå‹çš„æ•°æ®ä¸€è‡´æ€§åè®®ï¼‰å’ŒRaftåè®®æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚Distroåè®®ç”¨äºæœåŠ¡å‘ç°çš„æ•°æ®åŒæ­¥ï¼Œè€ŒRaftåè®®ç”¨äºé…ç½®ç®¡ç†å’Œå…ƒæ•°æ®çš„æ•°æ®ä¸€è‡´æ€§ä¿è¯ã€‚</li><li><strong>æœåŠ¡éš”ç¦»</strong>ï¼šNacosæ”¯æŒå‘½åç©ºé—´ã€åˆ†ç»„ç­‰æœºåˆ¶ï¼Œå¯ä»¥å®ç°ä¸åŒç¯å¢ƒæˆ–ä¸åŒåº”ç”¨é—´çš„æœåŠ¡å’Œé…ç½®éš”ç¦»ã€‚</li><li><strong>çµæ´»çš„è´Ÿè½½å‡è¡¡</strong>ï¼šNacoså®¢æˆ·ç«¯æ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¹¶å…è®¸è‡ªå®šä¹‰ç­–ç•¥ã€‚</li></ul><blockquote><p>Nacos å’Œ Eureka çš„åŒºåˆ«æœ‰å“ªäº›ï¼Ÿ</p></blockquote><ul><li>Nacos å’Œ Eureka çš„å…±åŒç‚¹ï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰<ul><li>1ã€éƒ½æ”¯æŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ‹‰å–</li><li>2ã€éƒ½æ”¯æŒæœåŠ¡æä¾›è€…å¿ƒè·³æ–¹å¼åšå¥åº·æ£€æµ‹</li></ul></li><li>Nacosä¸Eurekaçš„åŒºåˆ«ï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰<ul><li>1ã€Nacos æ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€ï¼šä¸´æ—¶å®ä¾‹é‡‡ç”¨å¿ƒè·³æ¨¡å¼ï¼Œéä¸´æ—¶å®ä¾‹é‡‡ç”¨ä¸»åŠ¨æ£€æµ‹æ¨¡å¼</li><li>2ã€ä¸´æ—¶å®ä¾‹å¿ƒæ¡ƒä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼Œéä¸´æ—¶å®ä¾‹åˆ™ä¸ä¼šè¢«å‰”é™¤</li><li>3ã€Nacos æ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„æ¶ˆæ¯æ¨é€æ¨¡å¼ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°æ›´åŠæ—¶</li><li>4ã€Nacosé›†ç¾¤é»˜è®¤é‡‡ç”¨APæ–¹å¼ï¼Œå½“é›†ç¾¤ä¸­å­˜åœ¨éä¸´æ—¶å®ä¾‹æ—¶ï¼Œé‡‡ç”¨CPæ¨¡å¼ï¼›Eurekaé‡‡ç”¨APæ–¹å¼</li></ul></li><li>Nacosè¿˜æ”¯æŒäº†é…ç½®ä¸­å¿ƒï¼Œeurekaåˆ™åªæœ‰æ³¨å†Œä¸­å¿ƒï¼Œä¹Ÿæ˜¯é€‰æ‹©ä½¿ç”¨nacosçš„ä¸€ä¸ªé‡è¦åŸå› </li></ul><h4 id="é…ç½®ä¸­å¿ƒ"><a href="#é…ç½®ä¸­å¿ƒ" class="headerlink" title="é…ç½®ä¸­å¿ƒ"></a>é…ç½®ä¸­å¿ƒ</h4><p>å‚è€ƒï¼› <a href="https://www.yuque.com/snailclimb/mf2z3k/kptwkp">https://www.yuque.com/snailclimb/mf2z3k/kptwkp</a></p><ul><li>ä¸ºä»€ä¹ˆè¦ç”¨é…ç½®ä¸­å¿ƒ</li><li>å¸¸ç”¨çš„é…ç½®ä¸­å¿ƒæœ‰å“ªäº›</li></ul><p>Apolloå’ŒNacosä¸¤è€…éƒ½æ˜¯å›½å†…å…¬å¸å¼€æºçš„çŸ¥åé¡¹ç›®ï¼Œé¡¹ç›®ç¤¾åŒºéƒ½æ¯”è¾ƒæ´»è·ƒä¸”éƒ½è¿˜åœ¨ç»´æŠ¤ä¸­ã€‚</p><p>Nacosæ˜¯é˜¿é‡Œå¼€æºçš„ï¼ŒApolloæ˜¯æºç¨‹å¼€æºçš„ã€‚</p><p>Nacosä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ç›´æ¥ç”¨æ¥åšæœåŠ¡å‘ç°åŠç®¡ç†ã€‚</p><p>Apollo åªèƒ½ç”¨æ¥åšé…ç½®ç®¡ç†ï¼Œä½¿ç”¨ç›¸å¯¹å¤æ‚äº›ã€‚</p><p>å¦‚æœä½ çš„é¡¹ç›®ä»…ä»…éœ€è¦é…ç½®ä¸­å¿ƒçš„è¯ï¼Œå»ºè®®ä½¿ç”¨ Apolloã€‚å¦‚æœä½ çš„é¡¹ç›®éœ€è¦é…ç½®ä¸­å¿ƒçš„åŒæ—¶è¿˜éœ€è¦æœåŠ¡å‘ç°åŠç®¡ç†çš„è¯ï¼Œé‚£å°±æ›´å»ºè®®ä½¿ç”¨Nacosã€‚</p><p>å¤§æ¦‚è®²ä¸€ä¸‹ Nacos é…ç½®ä¸­å¿ƒæ˜¯æ€ä¹ˆç”¨çš„ï¼Œç„¶åå¸¦ä¸€ä¸‹ è¯´çŸ¥é“æœ‰ Apollo è¿™ä¸ªä¸œè¥¿ï¼Œä½†æ²¡æœ‰ç”¨è¿‡ã€‚</p><h3 id="ä¸‰ã€OpenFeign"><a href="#ä¸‰ã€OpenFeign" class="headerlink" title="ä¸‰ã€OpenFeign"></a>ä¸‰ã€OpenFeign</h3><p>OpenFeignå’ŒFeignæœ¬è´¨ä¸ŠæŒ‡çš„æ˜¯åŒä¸€ä¸ªæŠ€æœ¯ï¼Œä¸è¿‡ä»å†å²å‘å±•å’Œä½¿ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒä»¬æœ‰ç»†å¾®çš„åŒºåˆ«ã€‚</p><p><strong>Feign</strong> æœ€åˆæ˜¯ç”±Netflixå¼€å‘çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒå†…éƒ¨å†…ç½®é›†æˆäº†Ribbonï¼ˆå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼‰å’ŒHystrixï¼ˆæ–­è·¯å™¨ï¼‰ç­‰ç»„ä»¶ã€‚</p><p><strong>OpenFeign</strong> æ˜¯Spring Cloudåœ¨Feignçš„åŸºç¡€ä¸Šè¿›è¡Œäº†å°è£…å’Œæ‰©å±•çš„é¡¹ç›®ï¼Œæ­£å¼åç§°ä¸ºSpring Cloud OpenFeignã€‚å®ƒæ˜¯Spring Cloudç»„ä»¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä¸“é—¨ç”¨äºå¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡é—´è°ƒç”¨ã€‚</p><p>æ¯”èµ· Feign ï¼Œé¢å¤–æä¾›äº†ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚ Spring MVCçš„æ³¨è§£ã€è‡ªåŠ¨é…ç½®å’Œå¥åº·æ£€æŸ¥ç­‰åŠŸèƒ½ã€‚</p><ul><li>1ã€ä¸¤è€…éƒ½æ˜¯åŸºäºç›¸åŒçš„FeignæŠ€æœ¯ï¼Œæ ¸å¿ƒç†å¿µå’ŒåŸºæœ¬ç”¨æ³•ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡å®šä¹‰æ¥å£å’Œæ³¨è§£æ¥åˆ›å»ºHTTPå®¢æˆ·ç«¯ã€‚</li><li>2ã€Feignæ˜¯Netflixçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œè€ŒOpenFeignæ˜¯Spring Cloudé¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œå¾—åˆ°äº†Springç¤¾åŒºçš„æ”¯æŒå’Œç»´æŠ¤ã€‚</li><li>3ã€OpenFeignåœ¨åŸæœ‰Feignçš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ‰©å±•ï¼Œæ›´å¥½åœ°é›†æˆäº†Spring Bootå’ŒSpring Cloudçš„ç‰¹æ€§ï¼Œæä¾›äº†æ›´å¤šçš„é…ç½®é¡¹å’Œæ›´æ–¹ä¾¿çš„ä½¿ç”¨æ–¹å¼ã€‚</li></ul><p>å¦‚æœé—®èµ·è´Ÿè½½å‡è¡¡ï¼Œä¸€èˆ¬è¿˜æ˜¯é—® Ribbon ï¼Œç„¶å ribbon æ˜¯å†…åµŒåˆ°äº† openfeignï¼ŒåŒæ—¶è¿˜æœ‰ç†”æ–­å™¨çš„åŠŸèƒ½ã€‚</p><h4 id="æœåŠ¡è°ƒç”¨æµç¨‹"><a href="#æœåŠ¡è°ƒç”¨æµç¨‹" class="headerlink" title="æœåŠ¡è°ƒç”¨æµç¨‹"></a>æœåŠ¡è°ƒç”¨æµç¨‹</h4><p>è®²è¿°ä¸€ä¸‹å¤§è‡´çš„ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„æ“ä½œæ­¥éª¤ï¼š</p><p>æœåŠ¡æ³¨å†Œ  â†’   æœåŠ¡å‘ç°   â†’  è´Ÿè½½å‡è¡¡   â†’    æœåŠ¡è°ƒç”¨ </p><ul><li>åœ¨Nacosç»“åˆOpenFeignçš„å¾®æœåŠ¡ç¯å¢ƒä¸‹ï¼Œè´Ÿè½½å‡è¡¡æ˜¯è‡ªåŠ¨å®ç°çš„ã€‚<ul><li>Nacosä½œä¸ºæœåŠ¡å‘ç°å’ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ŒOpenFeignä½œä¸ºå£°æ˜å¼çš„HTTPå®¢æˆ·ç«¯è°ƒç”¨å·¥å…·ï¼Œå®ƒä»¬å…±åŒå·¥ä½œï¼Œæä¾›äº†ä¸€ä¸ªç®€æ´é«˜æ•ˆçš„æœåŠ¡è°ƒç”¨æµç¨‹ã€‚</li></ul></li><li>1ã€æœåŠ¡æ³¨å†Œ<ul><li><strong>æœåŠ¡æä¾›è€…å¯åŠ¨</strong>ï¼šæ¯ä¸ªå¾®æœåŠ¡åœ¨å¯åŠ¨æ—¶ï¼Œä¼šå°†è‡ªå·±çš„å¯ç”¨å®ä¾‹ä¿¡æ¯ï¼ˆåŒ…æ‹¬æœåŠ¡åã€IPåœ°å€ã€ç«¯å£ç­‰ï¼‰æ³¨å†Œåˆ°NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚</li><li><strong>æœåŠ¡åŒæ­¥</strong>ï¼šNacosä¼šå°†æœåŠ¡ä¿¡æ¯åŒæ­¥åˆ°æ‰€æœ‰çš„æœåŠ¡èŠ‚ç‚¹ï¼Œç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹çš„æœåŠ¡ä¿¡æ¯æ˜¯æœ€æ–°çš„ã€‚</li></ul></li><li>2ã€æœåŠ¡å‘ç°<ul><li><strong>æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨</strong>ï¼šæœåŠ¡æ¶ˆè´¹è€…ï¼ˆå®¢æˆ·ç«¯åº”ç”¨ï¼‰å¯åŠ¨æ—¶ï¼Œä¼šé€šè¿‡Nacoså®¢æˆ·ç«¯æŸ¥è¯¢éœ€è¦è°ƒç”¨çš„æœåŠ¡çš„å®ä¾‹åˆ—è¡¨ã€‚</li><li><strong>è·å–æœåŠ¡å®ä¾‹</strong>ï¼šNacosè¿”å›æ‰€æœ‰å¥åº·çš„æœåŠ¡å®ä¾‹ä¿¡æ¯ç»™æœåŠ¡æ¶ˆè´¹è€…ã€‚</li></ul></li><li>3ã€è´Ÿè½½å‡è¡¡<ul><li><strong>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</strong>ï¼šOpenFeignå†…éƒ¨é›†æˆäº†Ribbonï¼ŒRibbonä½œä¸ºå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨ï¼Œæ ¹æ®ç‰¹å®šçš„ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ã€éšæœºç­‰ï¼‰ä»Nacosè·å–çš„æœåŠ¡å®ä¾‹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªå®ä¾‹è¿›è¡Œè°ƒç”¨ã€‚</li><li><strong>æœåŠ¡è°ƒç”¨</strong>ï¼šé€‰å®šæœåŠ¡å®ä¾‹åï¼ŒOpenFeignä¼šæ„é€ HTTPè¯·æ±‚å¹¶å‘é€åˆ°ç›®æ ‡æœåŠ¡å®ä¾‹ã€‚</li></ul></li><li>4ã€æœåŠ¡è°ƒç”¨<ul><li><strong>æœåŠ¡å¤„ç†è¯·æ±‚</strong>ï¼šæœåŠ¡æä¾›è€…æ¥æ”¶åˆ°è¯·æ±‚åï¼Œæ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›å¤„ç†ç»“æœç»™æœåŠ¡æ¶ˆè´¹è€…ã€‚</li><li><strong>è¿”å›å“åº”</strong>ï¼šæœåŠ¡æ¶ˆè´¹è€…æ¥æ”¶åˆ°å“åº”æ•°æ®ï¼Œå®Œæˆä¸€æ¬¡æœåŠ¡è°ƒç”¨æµç¨‹ã€‚</li></ul></li><li>5ã€æ•…éšœå¤„ç†<ul><li><strong>æ–­è·¯å™¨</strong>ï¼šå¦‚æœæœåŠ¡è°ƒç”¨å¤±è´¥ï¼ˆä¾‹å¦‚ï¼Œè¶…æ—¶æˆ–æœåŠ¡å®ä¾‹ä¸å¯ç”¨ï¼‰ï¼ŒOpenFeigné›†æˆçš„Hystrixæ–­è·¯å™¨å¯ä»¥æä¾›å¤‡ç”¨æ–¹æ¡ˆï¼Œå¦‚è¿”å›ä¸€ä¸ªé»˜è®¤å€¼æˆ–è°ƒç”¨å¤‡ç”¨æœåŠ¡ï¼Œé¿å…æœåŠ¡é›ªå´©ã€‚</li></ul></li></ul><p>Ribboné»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æ˜¯è½®è¯¢ï¼Œä½†å¯ä»¥æ ¹æ®éœ€è¦æ›´æ”¹ç­–ç•¥ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281419782.png" alt="image.png"></p><h4 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h4><h5 id="å¸¸è§è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#å¸¸è§è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="å¸¸è§è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>å¸¸è§è´Ÿè½½å‡è¡¡ç­–ç•¥</h5><p>Ribbon å¸¸è§çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š</p><ul><li><strong>Round Robin Ruleï¼ˆè½®è¯¢è§„åˆ™ï¼‰</strong><ul><li>è¿™æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚å®ƒæŒ‰é¡ºåºå¾ªç¯åœ°é€‰æ‹©æœåŠ¡å®ä¾‹ï¼Œæ¯æ¬¡è¯·æ±‚è½®æµåˆ†é…ç»™ä¸‹ä¸€ä¸ªæœåŠ¡å®ä¾‹ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæ‰€æœ‰æœåŠ¡å®ä¾‹å¤„ç†èƒ½åŠ›ç›¸å½“çš„æƒ…å†µã€‚</li></ul></li><li><strong>Random Ruleï¼ˆéšæœºè§„åˆ™ï¼‰</strong><ul><li>éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ã€‚æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯éšæœºä»æœåŠ¡åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªæœåŠ¡å®ä¾‹è¿›è¡Œè°ƒç”¨ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæœåŠ¡å®ä¾‹ä¼—å¤šï¼Œéœ€è¦é¿å…è½®è¯¢å¸¦æ¥çš„å‡åŒ€æ€§ä¸è¶³é—®é¢˜çš„åœºæ™¯ã€‚</li></ul></li><li><strong>Response Time Weighted Rule</strong>ï¼ˆå“åº”æ—¶é—´åŠ æƒè§„åˆ™ï¼‰<ul><li>æ ¹æ®æœåŠ¡å®ä¾‹çš„å¹³å‡å“åº”æ—¶é—´æ¥è®¡ç®—æ‰€æœ‰æœåŠ¡å®ä¾‹çš„æƒé‡ï¼Œå“åº”æ—¶é—´çŸ­çš„æœåŠ¡å®ä¾‹å°†æœ‰æ›´é«˜çš„æƒé‡ï¼Œè¢«æ›´é¢‘ç¹åœ°é€‰æ‹©ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæœåŠ¡å®ä¾‹æ€§èƒ½å·®å¼‚è¾ƒå¤§ï¼Œå¸Œæœ›ä¼˜å…ˆè°ƒç”¨å“åº”æ—¶é—´çŸ­çš„æœåŠ¡å®ä¾‹çš„æƒ…å†µã€‚</li></ul></li><li>Retry Ruleï¼ˆé‡è¯•è§„åˆ™ï¼‰<ul><li>åœ¨ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´å†…ï¼Œå¦‚æœé€‰å®šçš„æœåŠ¡å®ä¾‹ä¸æˆåŠŸï¼Œåˆ™ä¼šé‡æ–°é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹è¿›è¡Œå°è¯•ï¼Œç›´åˆ°è·å–æˆåŠŸå“åº”æˆ–è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå¯¹æœåŠ¡è°ƒç”¨çš„å¯é æ€§è¦æ±‚è¾ƒé«˜çš„æƒ…å†µï¼Œå¯ä»¥å¢åŠ è°ƒç”¨æˆåŠŸçš„æœºä¼šã€‚</li></ul></li><li>Best Available Ruleï¼ˆæœ€ä½å¹¶å‘è§„åˆ™ï¼‰<ul><li>é€‰æ‹©å¹¶å‘è¯·æ±‚æœ€å°çš„æœåŠ¡å®ä¾‹ã€‚è¿™ä¸ªç­–ç•¥ä¼šè€ƒè™‘åˆ°æœåŠ¡å®ä¾‹çš„å¹¶å‘è¯·æ±‚é‡ï¼Œä¼˜å…ˆé€‰æ‹©å¹¶å‘é‡æœ€å°çš„å®ä¾‹ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºéœ€è¦å¹³è¡¡æœåŠ¡å®ä¾‹è´Ÿè½½ï¼Œé¿å…æŸäº›å®ä¾‹è¿‡è½½çš„åœºæ™¯ã€‚</li></ul></li><li>Availability Filtering Ruleï¼ˆå¯ç”¨æ€§è¿‡æ»¤è§„åˆ™ï¼‰<ul><li>å…ˆè¿‡æ»¤æ‰ä¸€ç›´è¿æ¥å¤±è´¥çš„è¢«æ ‡è®°ä¸ºcircuit trippedçš„æœåŠ¡å®ä¾‹ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„å®ä¾‹ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºéœ€è¦å‰”é™¤ä¸ç¨³å®šæœåŠ¡å®ä¾‹ï¼Œç¡®ä¿æœåŠ¡è°ƒç”¨çš„é«˜å¯ç”¨æ€§ã€‚</li></ul></li><li><strong>Zone Avoidance Rule</strong>ï¼ˆåŒºåŸŸæƒé‡è§„åˆ™ï¼‰<ul><li>ç»¼åˆåŒºåŸŸçš„æ€§èƒ½å’ŒæœåŠ¡å®ä¾‹çš„å¯ç”¨æ€§æ¥é€‰æ‹©æœåŠ¡å™¨ã€‚å°½å¯èƒ½åœ°é€‰æ‹©ä¸€ä¸ªè¾ƒå°‘è´Ÿè½½ä¸”å¯ç”¨æ€§è¾ƒé«˜çš„æœåŠ¡å®ä¾‹ã€‚</li><li>é€‚ç”¨äºè·¨å¤šä¸ªåŒºåŸŸï¼ˆå¦‚AWSåŒºåŸŸï¼‰éƒ¨ç½²çš„æœåŠ¡ï¼Œéœ€è¦è€ƒè™‘åŒºåŸŸæ€§èƒ½å’Œå¯ç”¨æ€§çš„åœºæ™¯ã€‚</li></ul></li></ul><p>ä¸€èˆ¬é—®åˆ°è´Ÿè½½å‡è¡¡å¸¸ç”¨çš„ç­–ç•¥ä¹Ÿå¯ä»¥ä»å¸¸è§çš„å‡ ä¸ªç­–ç•¥è°ˆä¸€ä¸‹ï¼šè½®è¯¢ã€éšæœºã€å“åº”æ—¶é—´æƒé‡ã€åŒºåŸŸæƒé‡ã€‚</p><p>å…·ä½“çš„è´Ÿè½½å‡è¡¡ç­–ç•¥é…ç½®æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼š</p><p>åœ¨Spring Cloudåº”ç”¨ä¸­ï¼Œå…·ä½“é…ç½®Ribbonçš„è´Ÿè½½å‡è¡¡ç­–ç•¥é€šå¸¸æ¶‰åŠåˆ°application.propertiesæˆ–application.ymlé…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼Œæˆ–è€…é€šè¿‡ç¼–ç çš„æ–¹å¼è‡ªå®šä¹‰é…ç½®ã€‚</p><p>ä¸‹é¢æ˜¯ä¸¤ç§å¸¸è§çš„é…ç½®æ–¹æ³•ï¼š</p><blockquote><p>é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®</p></blockquote><p>åœ¨<code>application.yml</code>æˆ–<code>application.properties</code>ä¸­ï¼Œå¯ä»¥ä¸ºæ‰€æœ‰æœåŠ¡æˆ–ç‰¹å®šæœåŠ¡è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥</p><p>application.ymlç¤ºä¾‹</p><p>ä¸ºæ‰€æœ‰æœåŠ¡è®¾ç½®è½®è¯¢ç­–ç•¥ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">ribbon:</span><br>  NFLoadBalancerRuleClassName: <span class="hljs-keyword">com</span>.netflix.loadbalancer.RoundRobinRule<br></code></pre></td></tr></table></figure><p>ä¸ºç‰¹å®šæœåŠ¡è®¾ç½®éšæœºç­–ç•¥ï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">user-service</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">ribbon</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">NFLoadBalancerRuleClassName</span><span class="hljs-punctuation">:</span> <span class="hljs-string">com.netflix.loadbalancer.RandomRule</span><br></code></pre></td></tr></table></figure><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™Javaé…ç½®ç±»æ¥è‡ªå®šä¹‰Ribbonçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè¿™ç§æ–¹æ³•æ›´åŠ çµæ´»ï¼Œå…è®¸æ›´å¤æ‚çš„é…ç½®ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¸º<code>user-service</code>æœåŠ¡è‡ªå®šä¹‰éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥çš„ä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> com.netflix.loadbalancer.IRule;<br><span class="hljs-keyword">import</span> com.netflix.loadbalancer.RandomRule;<br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RibbonConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> IRule ribbonRule() &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨éšæœºè´Ÿè½½å‡è¡¡ç­–ç•¥</span><br>        <span class="hljs-keyword">return</span> new RandomRule();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œä½ éœ€è¦åœ¨<code>application.properties</code>æˆ–<code>application.yml</code>ä¸­æŒ‡å®šè¿™ä¸ªé…ç½®ç±»åº”ç”¨äºå“ªä¸ªæœåŠ¡ï¼š</p><p>application.yml</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">user-service</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">ribbon</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">NFLoadBalancerClassName</span><span class="hljs-punctuation">:</span> <span class="hljs-string">com.example.demo.config.RibbonConfiguration</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹</p><ul><li>å½“é€šè¿‡ç¼–ç æ–¹å¼è‡ªå®šä¹‰Ribboné…ç½®æ—¶ï¼Œç¡®ä¿ä¸è¦å°†<code>@Configuration</code>é…ç½®ç±»æ”¾åœ¨ä¸»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„<code>@ComponentScan</code>ä¸­ï¼Œä»¥é¿å…è¯¥é…ç½®æˆä¸ºå…¨å±€é…ç½®ã€‚æ¨èçš„åšæ³•æ˜¯å°†Ribbonçš„é…ç½®ç±»æ”¾åœ¨ä¸»åº”ç”¨ç±»çš„åŒ…å¤–ï¼Œæˆ–è€…æ˜¾å¼æŒ‡å®š<code>@ComponentScan</code>çš„æ‰«æè·¯å¾„æ’é™¤è¿™äº›é…ç½®ã€‚</li><li>Spring Cloudä¸­ï¼ŒFeignå·²é»˜è®¤é›†æˆäº†Ribbonï¼Œæ‰€ä»¥é€šè¿‡Feignè°ƒç”¨æœåŠ¡æ—¶ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨è¿™äº›è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚</li></ul><p>é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥çµæ´»åœ°ä¸ºåº”ç”¨é…ç½®åˆé€‚çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä¼˜åŒ–æœåŠ¡è°ƒç”¨çš„æ€§èƒ½å’Œå¯é æ€§ã€‚</p><h5 id="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</h5><p>åœ¨ä¸Šæ–‡ä¸­å®é™…å·²ç»è®²è¿°äº†è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å®ç°ï¼š</p><ul><li>1ã€åˆ›å»ºç±»å®ç° IRule æ¥å£ï¼ŒæŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå…¨å±€ï¼‰</li><li>2ã€åœ¨å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®æŸä¸€ä¸ªæœåŠ¡æŒ‡å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆå±€éƒ¨ï¼‰</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281439113.png" alt="image.png"></p><blockquote><p>å…³äºã€åˆ›å»ºç±»å®ç° IRule æ¥å£ï¼ŒæŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‘çš„è¿›ä¸€æ­¥è¯´æ˜</p></blockquote><p>é¦–å…ˆæ˜¯è¿™ç§æ–¹å¼å’Œã€åœ¨é…ç½®æ–‡ä»¶ä¸­ä¸ºæ‰€æœ‰æœåŠ¡ç»Ÿä¸€è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‘çš„åŒºåˆ«ï¼š</p><ul><li>1ã€å¯¹äºå¤§å¤šæ•°æ ‡å‡†ä½¿ç”¨åœºæ™¯ï¼Œ<strong>é€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥</strong>æ›´å®¹æ˜“ç®¡ç†å’Œè°ƒæ•´ã€‚å°¤å…¶æ˜¯åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå½“æœåŠ¡æ•°é‡è¾ƒå¤šæ—¶ï¼Œèƒ½å¤Ÿå¿«é€Ÿç»Ÿä¸€è°ƒæ•´ç­–ç•¥ã€‚ï¼ˆåè€…çš„ä¸€ä¸ªä½œç”¨æ˜¯ç®€åŒ–é…ç½®ï¼‰</li><li>2ã€é€šè¿‡ç¼–ç æ–¹å¼å®ç°<code>IRule</code>æ¥å£ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè¿™ç§æ–¹æ³•æä¾›äº†æé«˜çš„çµæ´»æ€§å’Œæ§åˆ¶åŠ›ã€‚ä½ å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ç¼–å†™è´Ÿè½½å‡è¡¡é€»è¾‘ï¼Œå®ç°ä¸€äº›æ ‡å‡†ç­–ç•¥ï¼ˆå¦‚è½®è¯¢ã€éšæœºï¼‰ä¹‹å¤–çš„ç‰¹æ®Šéœ€æ±‚ã€‚ï¼ˆå‰è€…å¯ä»¥å®šåˆ¶åŒ–ä¸€äº›ç­–ç•¥ï¼Œä¸è¿‡å¤æ‚æ€§ä¼šé«˜ä¸€äº›ï¼‰</li></ul><blockquote><p>é’ˆå¯¹ã€åˆ›å»ºç±»å®ç° IRule æ¥å£ï¼ŒæŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‘æ˜¯å…¨å±€ç”Ÿæ•ˆçš„è¿›ä¸€æ­¥è¯´æ˜</p></blockquote><p>çœ‹äº†ä¸€ç§è§£é‡Šï¼Œæ˜¯è¯´ï¼šå¹¶ä¸æ˜¯éƒ½æ˜¯å…¨å±€ï¼Œä¸€èˆ¬æ˜¯å…¨å±€ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é’ˆå¯¹ç‰¹å®šæœåŠ¡ã€‚</p><p>åˆ›å»ºç±»å®ç°<code>IRule</code>æ¥å£æ¥æŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œç„¶ååœ¨Springé…ç½®ä¸­å°†è¿™ä¸ªè‡ªå®šä¹‰çš„è§„åˆ™åº”ç”¨åˆ°Ribbonå®¢æˆ·ç«¯ä¸Šï¼Œè¿™ç§åšæ³•å¯ä»¥æ˜¯å…¨å±€çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯é’ˆå¯¹ç‰¹å®šæœåŠ¡çš„ï¼Œå…·ä½“å–å†³äºå¦‚ä½•é…ç½®è¿™ä¸ªè‡ªå®šä¹‰è§„åˆ™ã€‚</p><p>å…¨å±€é…ç½®</p><p>å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªå®ç°<code>IRule</code>æ¥å£çš„ç±»æ¥å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¹¶ä¸”åœ¨Springçš„ä¸»é…ç½®ç±»ï¼ˆ<code>@SpringBootApplication</code>æ‰€åœ¨çš„ç±»ï¼‰ä¸­é€šè¿‡<code>@Bean</code>æ³¨è§£æ³¨å†Œäº†è¿™ä¸ªè§„åˆ™ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«åº”ç”¨ä¸ºå…¨å±€çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚</p><p>è¿™æ„å‘³ç€æ‰€æœ‰ä½¿ç”¨Ribbonå®¢æˆ·ç«¯è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„åœ°æ–¹éƒ½ä¼šä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡è§„åˆ™ã€‚</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">RibbonConfiguration</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> IRule ribbonRule() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">MyCustomRule</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç‰¹å®šæœåŠ¡é…ç½®</p><p>å¦‚æœä½ æƒ³è¦å°†è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥åº”ç”¨åˆ°ç‰¹å®šçš„æœåŠ¡ä¸Šï¼Œè€Œä¸æ˜¯å…¨å±€åº”ç”¨ï¼Œä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªRibbonçš„é…ç½®ç±»å¹¶ä½¿ç”¨<code>@RibbonClient</code>æ³¨è§£æ¥æŒ‡å®šè¿™ä¸ªé…ç½®ç±»åº”ç”¨åˆ°å“ªä¸ªæœåŠ¡ä¸Šã€‚è¿™ä¸ªé…ç½®ç±»ä¸åº”è¯¥è¢«ä¸»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„<code>@ComponentScan</code>æ‰€æ‰«æï¼Œä»¥é¿å…å®ƒæˆä¸ºå…¨å±€é…ç½®ã€‚é€šå¸¸ï¼Œè¿™æ„å‘³ç€å°†è¿™ä¸ªé…ç½®ç±»æ”¾åœ¨ä¸»åº”ç”¨ç¨‹åºç±»æ‰€åœ¨åŒ…çš„å¤–é¢ï¼Œæˆ–è€…åœ¨<code>@ComponentScan</code>æ³¨è§£ä¸­æ˜¾å¼æ’é™¤å®ƒã€‚</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRibbonConfiguration</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> IRule ribbonRule() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">MyCustomRuleForUserService</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@RibbonClient</span>(name = <span class="hljs-string">&quot;user-service&quot;</span>, configuration = UserRibbonConfiguration.class)<br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">ServiceConfig</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyCustomRuleForUserService</code>åªä¼šåº”ç”¨åˆ°<code>user-service</code>æœåŠ¡ä¸Šï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–æœåŠ¡ã€‚</p><p>åŒºåˆ«</p><ul><li><strong>å…¨å±€é…ç½®</strong>ï¼šé€šè¿‡åœ¨Springä¸»é…ç½®ä¸­æ³¨å†Œè‡ªå®šä¹‰<code>IRule</code>å®ç°ï¼Œå®ƒä¼šè¢«åº”ç”¨åˆ°æ‰€æœ‰é€šè¿‡Ribbonè°ƒç”¨çš„æœåŠ¡ä¸Šã€‚è¿™ç§æ–¹å¼ç®€å•ï¼Œä½†ç¼ºä¹é’ˆå¯¹æ€§ã€‚</li><li><strong>ç‰¹å®šæœåŠ¡é…ç½®</strong>ï¼šé€šè¿‡ä¸ºç‰¹å®šæœåŠ¡åˆ›å»ºç‹¬ç«‹çš„Ribboné…ç½®ç±»å¹¶ä½¿ç”¨<code>@RibbonClient</code>æ³¨è§£æ¥æŒ‡å®šï¼Œå¯ä»¥å®ç°å¯¹ä¸åŒæœåŠ¡ä½¿ç”¨ä¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚è¿™ç§æ–¹å¼æä¾›äº†æ›´é«˜çš„çµæ´»æ€§å’Œé’ˆå¯¹æ€§ã€‚</li></ul><hr><h4 id="æœåŠ¡è°ƒç”¨"><a href="#æœåŠ¡è°ƒç”¨" class="headerlink" title="æœåŠ¡è°ƒç”¨"></a>æœåŠ¡è°ƒç”¨</h4><p>æ¼”ç¤ºä¸€ä¸‹ä½¿ç”¨ openfegin è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„æ“ä½œï¼š</p><p>to be continedâ€¦ </p><p>è¿™é‡Œæ¼”ç¤ºä¸€ä¸‹ æŒ‡å®šFallback ç›¸å…³ç¤ºä¾‹ï¼ˆæœåŠ¡é™çº§ï¼‰</p><hr><h4 id="æœåŠ¡é›ªå´©"><a href="#æœåŠ¡é›ªå´©" class="headerlink" title="æœåŠ¡é›ªå´©"></a>æœåŠ¡é›ªå´©</h4><p>æœåŠ¡é›ªå´©æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸€ä¸ªå¸¸è§çš„é—®é¢˜ï¼ŒæŒ‡çš„æ˜¯å½“æŸä¸ªï¼ˆæˆ–æŸäº›ï¼‰å¾®æœåŠ¡ä¸å¯ç”¨æˆ–å“åº”æ—¶é—´è¿‡é•¿æ—¶ï¼Œä¼šå¯¼è‡´è°ƒç”¨è¯¥æœåŠ¡çš„å…¶ä»–æœåŠ¡ä¹Ÿè·Ÿç€å˜æ…¢æˆ–ä¸å¯ç”¨ï¼Œè¿™ç§æƒ…å†µä¼šåƒé›ªå´©ä¸€æ ·å‘æ•´ä¸ªç³»ç»Ÿè”“å»¶ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚</p><ul><li>æœåŠ¡é›ªå´©ï¼šä¸€ä¸ªæœåŠ¡å¤±è´¥ï¼Œå·è‡´æ•´æ¡çº¿è·¯çš„æœåŠ¡éƒ½å¤±è´¥çš„æƒ…å½¢</li><li>è§£å†³æ–¹æ¡ˆ<ul><li>æœåŠ¡é™çº§ï¼šæœåŠ¡è‡ªæˆ‘ä¿æŠ¤çš„ä¸€ç§æ–¹å¼ï¼Œæˆ–è€…ä¿æŠ¤ä¸‹æ¸¸æœåŠ¡çš„ä¸€ç§æ–¹å¼ï¼Œç”¨äºç¡®ä¿æœåŠ¡ä¸ä¼šå—è¯·æ±‚çªå¢å½±å“å˜å¾—ä¸å¯ç”¨ï¼Œç¡®ä¿æœåŠ¡ä¸ä¼šå´©æºƒï¼Œ<strong>ä¸€èˆ¬åœ¨å®æ ‡å¼€å‘ä¸­ä¸ feign æ¥å£æ•´åˆï¼Œç¼–å†™é™çº§é€»è¾‘</strong></li><li>æœåŠ¡ç†”æ–­ï¼šé»˜è®¤å…³é—­ã€‚éœ€è¦æ‰‹åŠ¨æ‰“å¼€ï¼Œå¦‚æœæ£€æµ‹åˆ°10ç§’å†…è¯·æ±‚çš„å¤±è´¥ç‡è¶…è¿‡50%ï¼Œå°±è§¦å‘ç†”æ–­æœºåˆ«ã€‚ä¹‹å<strong>æ¯éš” 5ç§’é‡æ–°å°è¯•è¯·æ±‚</strong>å¾®æœåŠ¡ï¼Œå¦‚æœå¾®æœåŠ¡ä¸èƒ½å“åº”ï¼Œç»§ç»­èµ°ç†”æ–­æœºåˆ¶ï¼Œå¦‚æœå¾®æœåŠ¡å¯è¾¾ï¼Œåˆ™å…³é—­ç†”æ–­æœºåˆ¶ï¼Œæ¢å¤æ­£å¸¸è¯·æ±‚</li></ul></li></ul><h3 id="å››ã€é™æµæ“ä½œ"><a href="#å››ã€é™æµæ“ä½œ" class="headerlink" title="å››ã€é™æµæ“ä½œ"></a>å››ã€é™æµæ“ä½œ</h3><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281528174.png" alt="image.png"></p><p>é™æµçš„å¸¸è§å®ç°æ–¹å¼ï¼š</p><ul><li>1ã€Tomcat: å¯ä»¥è®¾ç½®æœ€å¤§è¿æ¥æ•°<ul><li>ä¸è¿‡è¿™ç§æ–¹å¼é€‚åˆå•ä½“é¡¹ç›®ï¼Œåˆ†å¸ƒå¼é¡¹ç›®ä¸å¤ªé€‚åˆ</li></ul></li><li>2ã€Nginxï¼Œæ¼æ¡¶ç®—æ³•</li><li>3ã€ç½‘å…³ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•</li><li>4ã€è‡ªå®šä¹‰æ‹¦æˆªå™¨</li></ul><p>å…ˆæŒæ¡äº†è§£ä¸€ä¸‹ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æ–¹å¼</p><blockquote><p>é¢è¯•é¢˜ï¼šä½ ä»¬é¡¹ç›®ä¸­æœ‰æ²¡æœ‰åšè¿‡é™æµï¼Œæ€ä¹ˆåšçš„ã€‚</p></blockquote><ul><li>1ã€å…ˆæ¥ä»‹ç»ä¸šåŠ¡ï¼Œä»€ä¹ˆæƒ…å†µä¸‹å»åšé™æµï¼Œéœ€è¦è¯´æ˜QPSå…·ä½“å¤šå°‘<ul><li>æˆ‘ä»¬å½“æ—¶æœ‰ä¸€ä¸ªæ´»åŠ¨ï¼Œåˆ°äº†å‡æœŸå°±ä¼šæŠ¢è´­ä¼˜æƒ åˆ¸ï¼ŒQPS æœ€é«˜å¯ä»¥è¾¾åˆ°2000ï¼Œå¹³æ—¶10-50ä¹‹é—´ï¼Œä¸ºäº†åº”å¯¹çªå‘æµé‡ï¼Œéœ€è¦åšé™æµ</li><li>å¸¸è§„é™æµï¼Œä¸ºäº†é˜²æ­¢æ¶æ„æ”»å‡»ï¼Œä¿æŠ¤ç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼Œæˆ‘ä»¬å½“æ—¶ç³»ç»Ÿèƒ½å¤Ÿæ‰¿å—æœ€å¤§çš„QPSæ˜¯å¤šå°‘ï¼ˆå‹æµ‹ç»“æœï¼‰</li></ul></li><li>2ã€nginxé™æµ<ul><li>æ§åˆ¶é€Ÿç‡ï¼ˆçªå‘æµé‡ï¼‰ï¼Œä½¿ç”¨çš„æ¼æ¡¶ç®—æ³•æ¥å®ç°è¿‡æ»¤ï¼Œè®©è¯·æ±‚ä»¥å›ºå®šçš„é€Ÿç‡å¤„ç†è¯·æ±‚ï¼Œå¯ä»¥åº”å¯¹çªå‘æµé‡</li><li>æ§åˆ¶å¹¶å‘æ•°ï¼Œé™åˆ¶å•ä¸ªip çš„é“¾æ¥æ•°å’Œå¹¶å‘é“¾æ¥çš„æ€»æ•°</li></ul></li><li>3ã€ç½‘å…³é™æµ<ul><li>åœ¨spring cloud gatewayä¸­æ”¯æŒå±€éƒ¨è¿‡æ»¤å™¨RequestRateLimiteræ¥åšé™æµï¼Œä½¿ç”¨çš„æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå¯ä»¥æ ¹æ®æˆ–è·¯å¾„è¿›è¡Œé™æµï¼Œå¯ä»¥è®¾ç½®æ¯ç§’å¡«å……å¹³å‡é€Ÿç‡ï¼Œå’Œä»¤ç‰Œæ¡¶æ€»å®¹é‡ã€‚</li></ul></li></ul><blockquote><p>é™æµå¸¸è§çš„ç®—æ³•æœ‰å“ªäº›å‘¢</p></blockquote><p>å¯ä»¥è®²ä¸€ä¸‹ä»¤ç‰Œæ¡¶ç®—æ³•å’Œæ¼æ¡¶ç®—æ³•ã€‚</p><blockquote><p>è®²ä¸€äº›æ‰©å±•å†…å®¹</p></blockquote><p>1ã€ä¸€èˆ¬é€šè¿‡ä»€ä¹ˆåšå‹æµ‹çš„</p><p>å°±è®²ä½¿ç”¨ JMeter å³å¯</p><p>å…·ä½“éœ€è¦çœ‹å®é™…ä½¿ç”¨ to be continedâ€¦.</p><h4 id="Nginx-é™æµ"><a href="#Nginx-é™æµ" class="headerlink" title="Nginx é™æµ"></a>Nginx é™æµ</h4><ul><li>æ§åˆ¶è®¿é—®è¯·æ±‚é€Ÿç‡</li><li>æ§åˆ¶å¹¶å‘è¿æ¥æ•°ï¼ˆæŸä¸ªç”¨æˆ·å»ºç«‹çš„è¿æ¥æ•°ï¼‰</li></ul><p>Nginxæä¾›äº†å†…ç½®çš„æ¨¡å—æ¥æ”¯æŒé™æµï¼Œå¦‚<code>limit_req_module</code>å’Œ<code>limit_conn_module</code>ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ æ ¹æ®è¯·æ±‚é€Ÿç‡æˆ–å¹¶å‘è¿æ¥æ•°æ¥é™åˆ¶æµé‡ã€‚</p><p>åœ¨å®è·µä¸­ï¼Œé€šå¸¸ä¼šç»“åˆä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•æ¥æ›´å…¨é¢åœ°æ§åˆ¶æµé‡ï¼Œç¡®ä¿æœåŠ¡æ—¢ä¸ä¼šå› ä¸ºç¬æ—¶è¯·æ±‚è¿‡å¤šè€Œå´©æºƒï¼Œä¹Ÿä¸ä¼šå› ä¸ºè¿‡å¤šå¹¶å‘è¿æ¥è€Œè€—å°½èµ„æºã€‚</p><p>ä½¿ç”¨Nginxè¿›è¡Œé™æµåªæ˜¯åº”å¯¹æµé‡è¿‡è½½çš„ä¸€ç§æ‰‹æ®µï¼Œè¿˜éœ€è¦ç»“åˆåº”ç”¨å±‚çš„é™æµã€æœåŠ¡é™çº§ã€ç†”æ–­ç­‰ç­–ç•¥æ¥ç»¼åˆä¿éšœç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</p><blockquote><p>æ§åˆ¶é€Ÿç‡  limit_req_module</p></blockquote><p>å¯ä»¥ç†è§£Nginx è¿›è¡Œæ§åˆ¶è¯·æ±‚é€Ÿç‡é™åˆ¶æ˜¯ç±»ä¼¼æ¼æ¡¶ç®—æ³•çš„ä¸€ç§å®ç°ï¼ˆåº”ç”¨äº†æ¼æ¡¶ç®—æ³•çš„æ€æƒ³ï¼‰ï¼›</p><ol><li><strong>æ¡¶å®¹é‡</strong>ï¼šç®—æ³•ä¸­çš„â€œæ¡¶â€æœ‰ä¸€ä¸ªå›ºå®šçš„å®¹é‡ï¼Œè¿™ä¸ªå®¹é‡å¯ä»¥ç†è§£ä¸ºç³»ç»Ÿèƒ½å¤Ÿæ‰¿å—çš„æœ€å¤§æµé‡æˆ–è¯·æ±‚é€Ÿç‡çš„ä¸Šé™ã€‚</li><li><strong>å…¥æ°´é€Ÿç‡</strong>ï¼šæ•°æ®ï¼ˆæˆ–è¯·æ±‚ï¼‰ä»¥ä»»æ„é€Ÿç‡æµå…¥æ¡¶ä¸­ã€‚å¦‚æœæµå…¥é€Ÿç‡ä¸å®šï¼Œé‚£ä¹ˆè¿™äº›æ•°æ®ä¼šæš‚æ—¶å­˜å‚¨åœ¨æ¡¶ä¸­ï¼Œç›´åˆ°è¢«å¤„ç†ã€‚</li><li><strong>å‡ºæ°´é€Ÿç‡</strong>ï¼šæ•°æ®ä»¥å›ºå®šçš„é€Ÿç‡ä»æ¡¶ä¸­â€œæ¼å‡ºâ€ï¼ˆå³è¢«å¤„ç†ï¼‰ã€‚å‡ºæ°´é€Ÿç‡æ˜¯é¢„å…ˆè®¾å®šçš„ï¼Œä¸å®é™…æµå…¥é€Ÿç‡æ— å…³ã€‚</li><li><strong>æº¢å‡ºå¤„ç†</strong>ï¼šå¦‚æœæµå…¥çš„æ•°æ®é‡è¶…è¿‡äº†æ¡¶çš„å®¹é‡ï¼Œå³æ¡¶å·²æ»¡ï¼Œé‚£ä¹ˆè¶…å‡ºçš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒï¼ˆæˆ–è€…è§¦å‘å…¶ä»–çš„é™æµæªæ–½ï¼‰ï¼Œè¿™å¯ä»¥é˜²æ­¢ç³»ç»Ÿè¿‡è½½</li></ol><p>é€šè¿‡è¿™ç§æ–¹å¼çš„é™æµï¼Œè¯·æ±‚æµé‡ä¼šä»¥å›ºå®šçš„é€Ÿç‡ä»æ¡¶ä¸­â€œæ¼å‡ºâ€ï¼ˆå³è¢«å¤„ç†ï¼‰ï¼›å¦‚æœæµå…¥çš„æ•°æ®é‡è¶…è¿‡äº†æ¡¶çš„å®¹é‡ï¼Œå³æ¡¶å·²æ»¡ï¼Œé‚£ä¹ˆè¶…å‡ºçš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281533917.png" alt="image.png"></p><p>ä½¿ç”¨<code>limit_req_module</code>è¿›è¡Œè¯·æ±‚é€Ÿç‡é™åˆ¶</p><p><code>limit_req_module</code>æ¨¡å—å…è®¸ä½ é™åˆ¶å¤„ç†è¯·æ±‚çš„é€Ÿç‡ï¼Œé˜²æ­¢è¯·æ±‚è¿‡å¤šå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚è¿™ä¸ªæ¨¡å—é€šå¸¸ç”¨äºé™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚é€Ÿç‡ã€‚</p><ol><li><strong>å®šä¹‰é™æµè§„åˆ™</strong>ï¼šé¦–å…ˆï¼Œéœ€è¦åœ¨Nginxé…ç½®ä¸­å®šä¹‰ä¸€ä¸ªé™æµè§„åˆ™ï¼ˆ<code>limit_req_zone</code>ï¼‰ï¼ŒæŒ‡å®šé™æµçš„é”®ï¼ˆå¦‚å®¢æˆ·ç«¯IPï¼‰ã€é€Ÿç‡å’Œå­˜å‚¨åŒºåŸŸå¤§å°ã€‚</li></ol><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">http &#123;<br>    limit_req_zone <span class="hljs-variable">$binary_remote_addr</span> <span class="hljs-attribute">zone</span>=mylimit:10m <span class="hljs-attribute">rate</span>=1r/s;<br>    <span class="hljs-built_in">..</span>.<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code>mylimit</code>çš„åŒºåŸŸï¼Œå¤§å°ä¸º10MBï¼Œé™åˆ¶æ¯ä¸ªIPåœ°å€æ¯ç§’æœ€å¤šåªèƒ½å¤„ç†1ä¸ªè¯·æ±‚ã€‚</p><p><strong>åº”ç”¨é™æµè§„åˆ™</strong>ï¼šç„¶åï¼Œåœ¨éœ€è¦é™æµçš„locationæˆ–serverä¸Šåº”ç”¨è¿™ä¸ªè§„åˆ™ï¼ˆ<code>limit_req</code>ï¼‰ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">server &#123;<br>    location / &#123;<br>        limit_req <span class="hljs-attribute">zone</span>=mylimit <span class="hljs-attribute">burst</span>=5;<br>        <span class="hljs-built_in">..</span>.<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨<code>/</code>ä½ç½®åº”ç”¨äº†<code>mylimit</code>è§„åˆ™ï¼Œå¹¶è®¾ç½®äº†<code>burst</code>å‚æ•°ä¸º5ï¼Œæ„å‘³ç€å…è®¸åœ¨çŸ­æ—¶é—´å†…è¶…è¿‡é™åˆ¶çš„è¯·æ±‚è¢«ç¼“å­˜èµ·æ¥ï¼Œç›´åˆ°è¾¾åˆ°5ä¸ªè¯·æ±‚çš„é™åˆ¶ã€‚</p><blockquote><p>æ§åˆ¶å¹¶å‘è¿æ¥æ•°</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281535314.png" alt="image.png"></p><p>ä½¿ç”¨<code>limit_conn_module</code>è¿›è¡Œå¹¶å‘è¿æ¥æ•°é™åˆ¶</p><p><code>limit_conn_module</code>æ¨¡å—å…è®¸ä½ é™åˆ¶å¹¶å‘è¿æ¥æ•°ï¼Œè¿™é€‚ç”¨äºé™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶å»ºç«‹çš„è¿æ¥æ•°ã€‚</p><ol><li><strong>å®šä¹‰è¿æ¥æ•°é™åˆ¶</strong>ï¼šåŒæ ·ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªé™åˆ¶åŒºåŸŸï¼ˆ<code>limit_conn_zone</code>ï¼‰ã€‚</li></ol><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">http &#123;<br>    limit_conn_zone <span class="hljs-variable">$binary_remote_addr</span> <span class="hljs-attribute">zone</span>=connlimit:10m;<br>    <span class="hljs-built_in">..</span>.<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code>connlimit</code>çš„åŒºåŸŸï¼Œå¤§å°ä¸º10MBï¼Œç”¨äºå­˜å‚¨å¹¶å‘è¿æ¥æ•°çš„çŠ¶æ€ã€‚</p><ol start="2"><li><strong>åº”ç”¨è¿æ¥æ•°é™åˆ¶</strong>ï¼šåœ¨éœ€è¦é™åˆ¶çš„locationæˆ–serverä¸Šåº”ç”¨è¿™ä¸ªè§„åˆ™ï¼ˆ<code>limit_conn</code>ï¼‰ã€‚</li></ol><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">server &#123;<br>    <span class="hljs-keyword">location</span> <span class="hljs-title">/ &#123;</span><br><span class="hljs-title">        limit_conn</span> connlimit <span class="hljs-number">10</span>;<br>        ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåœ¨<code>/</code>ä½ç½®åº”ç”¨äº†<code>connlimit</code>è§„åˆ™ï¼Œé™åˆ¶æ¯ä¸ªIPæœ€å¤šå¯ä»¥åŒæ—¶å»ºç«‹10ä¸ªè¿æ¥ã€‚</p><hr><h4 id="ç½‘å…³é™æµ-ğŸš©"><a href="#ç½‘å…³é™æµ-ğŸš©" class="headerlink" title="ç½‘å…³é™æµ  ğŸš©"></a>ç½‘å…³é™æµ  ğŸš©</h4><p>ç½‘å…³é™æµä¸€èˆ¬æ˜¯ä½¿ç”¨ Spring Cloud Gateway æ¥å®ç°ç½‘å…³å±‚é¢çš„æµé‡æ§åˆ¶ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402281639179.png" alt="image.png"></p><p>å›´ç»•ç½‘å…³é™æµå¯ç”¨å…ˆå›ç­”ä¸€ä¸‹é¡¹ç›®æ˜¯å¦‚ä½•åšçš„ï¼šæ¯”å¦‚è¯´æ˜¯ï¼šåˆ©ç”¨<code>RequestRateLimiter</code>è¿‡æ»¤å™¨ï¼Œç»“åˆRedisæ¥å­˜å‚¨å’Œç®¡ç†é™æµæ•°æ®ã€‚</p><p>ç„¶åè¯´ä¸€ä¸‹é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°ä¸­æ˜¯åº”ç”¨äº†ä»¤ç‰Œæ¡¶ç®—æ³•çš„æ€æƒ³</p><p>è¿˜å¯ä»¥ç»“åˆ Gateway + Sentinel å®ç°æµæ§ï¼ˆå¸¦è¿‡ï¼‰</p><blockquote><p>ä»¤ç‰Œæ¡¶ç®—æ³•</p></blockquote><p>ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆToken Bucket Algorithmï¼‰æ˜¯ä¸€ç§æµé‡æ§åˆ¶ç®—æ³•ï¼Œå¹¿æ³›åº”ç”¨äºç½‘ç»œæµé‡æ•´å½¢ï¼ˆTraffic Shapingï¼‰å’Œé€Ÿç‡é™åˆ¶ï¼ˆRate Limitingï¼‰ä¸­ã€‚è¯¥ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»¥æ’å®šçš„é€Ÿç‡å‘æ¡¶ä¸­æ·»åŠ ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œè¯·æ±‚æ¶ˆè€—ä»¤ç‰Œæ‰èƒ½è¢«å¤„ç†ï¼Œå¦‚æœæ¡¶ä¸­æ²¡æœ‰ä»¤ç‰Œï¼Œåˆ™è¯·æ±‚è¢«é™åˆ¶ã€‚</p><p>åŸºæœ¬åŸç†</p><ol><li><strong>ä»¤ç‰Œæ¡¶</strong>ï¼šæœ‰ä¸€ä¸ªå›ºå®šå®¹é‡çš„æ¡¶ï¼Œç³»ç»Ÿä»¥å›ºå®šé€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œã€‚å¦‚æœæ¡¶æ»¡äº†ï¼Œåˆ™æ–°æ·»åŠ çš„ä»¤ç‰Œä¼šè¢«ä¸¢å¼ƒã€‚</li><li><strong>è¯·æ±‚å¤„ç†</strong>ï¼šæ¯ä¸ªä¼ å…¥çš„è¯·æ±‚éœ€è¦ä»æ¡¶ä¸­å–å‡ºä¸€å®šæ•°é‡çš„ä»¤ç‰Œã€‚å¦‚æœæ¡¶ä¸­çš„ä»¤ç‰Œè¶³å¤Ÿï¼Œè¯·æ±‚è¢«å¤„ç†ï¼ŒåŒæ—¶ä»æ¡¶ä¸­ç§»é™¤å¯¹åº”æ•°é‡çš„ä»¤ç‰Œï¼›å¦‚æœæ¡¶ä¸­ä»¤ç‰Œä¸è¶³ï¼Œè¯·æ±‚åˆ™æ ¹æ®ç­–ç•¥ï¼ˆå¦‚æ’é˜Ÿã€ç«‹å³æ‹’ç»ç­‰ï¼‰å¤„ç†ã€‚</li><li><strong>æ’å®šé€Ÿç‡</strong>ï¼šä»¤ç‰Œä»¥æ’å®šçš„é€Ÿç‡rè¢«æ·»åŠ åˆ°æ¡¶ä¸­ã€‚è¿™ä¸ªé€Ÿç‡rå†³å®šäº†è¯·æ±‚è¢«å…è®¸çš„æœ€å¤§å¹³å‡é€Ÿç‡ã€‚</li><li><strong>çªå‘æµé‡</strong>ï¼šæ¡¶çš„å®¹é‡å…è®¸åœ¨çŸ­æ—¶é—´å†…å¤„ç†çªå‘æµé‡ã€‚å¦‚æœæ¡¶ä¸­æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œï¼Œè¶…è¿‡å¹³å‡é€Ÿç‡rçš„è¯·æ±‚å¯ä»¥ç«‹å³è¢«å¤„ç†ï¼Œç›´åˆ°æ¡¶ä¸­çš„ä»¤ç‰Œè¢«è€—å°½ã€‚</li></ol><p>åœ¨Spring Cloud Gatewayä¸­ä½¿ç”¨Redis RateLimiterå®ç°é™æµæ—¶ï¼Œå…¶èƒŒåçš„åŸç†å°±å€Ÿé‰´äº†ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚</p><p>é€šè¿‡å®šä¹‰<code>replenishRate</code>å’Œ<code>burstCapacity</code>å‚æ•°ï¼Œåˆ†åˆ«å¯¹åº”ä»¤ç‰Œæ·»åŠ çš„é€Ÿç‡å’Œæ¡¶çš„å®¹é‡ï¼Œä»è€Œå®ç°å¯¹ç½‘å…³æµé‡çš„ç»†ç²’åº¦æ§åˆ¶ã€‚å½“è¯·æ±‚åˆ°è¾¾ç½‘å…³æ—¶ï¼Œä¼šå°è¯•ä»Redisä¸­çš„ä»¤ç‰Œæ¡¶è·å–ä»¤ç‰Œï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¯·æ±‚è¢«å…è®¸é€šè¿‡ï¼›å¦‚æœä»¤ç‰Œä¸è¶³ï¼Œåˆ™è¯·æ±‚è¢«é™æµã€‚</p><ul><li>ä»¤ç‰Œæ·»åŠ é€Ÿç‡</li><li>æ¡¶å®¹é‡</li></ul><hr><p>å…·ä½“ä½¿ç”¨ç¤ºä¾‹ï¼š</p><blockquote><p>Gateway ç½‘å…³é™æµ</p></blockquote><ul><li>1ã€åœ¨Spring Cloud Gatewayä¸­å®ç°ç½‘å…³é™æµï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåˆ©ç”¨<code>RequestRateLimiter</code>è¿‡æ»¤å™¨ï¼Œç»“åˆRedisæ¥å­˜å‚¨å’Œç®¡ç†é™æµæ•°æ®ã€‚</li><li>2ã€è¿˜æœ‰ä¸€ç§æ˜¯ Gateway + Sentinel ç»“åˆå®ç°æµé‡æ§åˆ¶</li></ul><p>è¿™é‡Œè¯´ä¸€ä¸‹ç¬¬ä¸€ç§ï¼Œç¬¬äºŒç§æ„Ÿè§‰å¼•å…¥ç»„ä»¶é€ æˆç³»ç»Ÿå¤æ‚åº¦æå‡ï¼Œå¹¶æ²¡æœ‰é‡‡ç”¨ï¼ˆä»è¿™ä¸ªè§’åº¦å›ç­”ï¼‰</p><p>ç¬¬ä¸€ç§æ–¹å¼</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäºSpring Cloud Gatewayä¸Rediså®ç°ç½‘å…³é™æµçš„ç¤ºä¾‹ã€‚</p><ul><li>1ã€æ·»åŠ Spring Cloud Gatewayå’ŒSpring Boot Redisçš„ä¾èµ–</li><li>2ã€é…ç½® Redis</li><li>3ã€å®šä¹‰é™æµè§„åˆ™</li></ul><p>åœ¨Spring Cloud Gatewayä¸­é€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰è·¯ç”±å’Œé™æµè§„åˆ™ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸º<code>/api/myService/**</code>è·¯å¾„é…ç½®äº†é™æµè§„åˆ™ã€‚</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">spring</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">cloud</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">gateway</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">routes</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">id: myservice_route</span><br>          <span class="hljs-attribute">uri</span><span class="hljs-punctuation">:</span> <span class="hljs-string">lb://MY-SERVICE # å‡è®¾MY-SERVICEæ˜¯ä½ çš„å¾®æœåŠ¡åç§°</span><br>          <span class="hljs-attribute">predicates</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/api/myService/**</span><br>          <span class="hljs-attribute">filters</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">name: RequestRateLimiter</span><br>              <span class="hljs-attribute">args</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-comment"># æ¯ç§’é’Ÿå…è®¸é€šè¿‡çš„è¯·æ±‚æ•°</span><br>                <span class="hljs-attribute">redis-rate-limiter.replenishRate</span><span class="hljs-punctuation">:</span> <span class="hljs-string">10</span><br>                <span class="hljs-comment"># ç”¨æˆ·åœ¨ä¸€ç§’é’Ÿå†…å¯ä»¥çªå‘çš„è¯·æ±‚æ•°é‡</span><br>                <span class="hljs-attribute">redis-rate-limiter.burstCapacity</span><span class="hljs-punctuation">:</span> <span class="hljs-string">20</span><br>                <span class="hljs-comment"># ä½¿ç”¨SpELè¡¨è¾¾å¼æ¥ç¡®å®šé™æµçš„key</span><br>                <span class="hljs-attribute">key-resolver</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;#&#123;@ipKeyResolver&#125;&quot;</span><br></code></pre></td></tr></table></figure><ol start="4"><li>å®ç°KeyResolver</li></ol><p><code>key-resolver</code>ç”¨äºç¡®å®šé™æµçš„ç»´åº¦ï¼Œä¾‹å¦‚å¯ä»¥æŒ‰IPåœ°å€é™æµã€‚ä¸‹é¢æ˜¯æŒ‰IPåœ°å€é™æµçš„<code>KeyResolver</code>å®ç°ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">cloud</span>.<span class="hljs-property">gateway</span>.<span class="hljs-property">filter</span>.<span class="hljs-property">ratelimit</span>.<span class="hljs-property">KeyResolver</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Bean</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Configuration</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">server</span>.<span class="hljs-property">ServerWebExchange</span>;<br><span class="hljs-keyword">import</span> reactor.<span class="hljs-property">core</span>.<span class="hljs-property">publisher</span>.<span class="hljs-property">Mono</span>;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RateLimiterConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-title class_">KeyResolver</span> <span class="hljs-title function_">ipKeyResolver</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyResolver</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-title class_">Mono</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">resolve</span>(<span class="hljs-params">ServerWebExchange exchange</span>) &#123;<br>                <span class="hljs-comment">// ä»è¯·æ±‚ä¸­è·å–IPåœ°å€ï¼Œä½œä¸ºé™æµçš„key</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-title class_">Mono</span>.<span class="hljs-title function_">just</span>(exchange.<span class="hljs-title function_">getRequest</span>().<span class="hljs-title function_">getRemoteAddress</span>().<span class="hljs-title function_">getAddress</span>().<span class="hljs-title function_">getHostAddress</span>());<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="5"><li>å¯åŠ¨å¹¶æµ‹è¯•</li></ol><p>å¯åŠ¨Spring Cloud Gatewayåº”ç”¨ï¼Œå¹¶å‘<code>/api/myService/**</code>è·¯å¾„å‘é€è¯·æ±‚æ¥æµ‹è¯•é™æµæ•ˆæœã€‚</p><p>å¦‚æœè¯·æ±‚é€Ÿç‡è¶…è¿‡äº†å®šä¹‰çš„<code>replenishRate</code>å’Œ<code>burstCapacity</code>ï¼Œè¶…å‡ºé™æµæ¡ä»¶çš„è¯·æ±‚å°†ä¼šæ”¶åˆ°429 Too Many Requestså“åº”ã€‚</p><p>æ³¨æ„äº‹é¡¹</p><ul><li>å®é™…éƒ¨ç½²æ—¶ï¼ŒRedisçš„é…ç½®åº”æ ¹æ®ä½ çš„ç¯å¢ƒè¿›è¡Œè°ƒæ•´ï¼ŒåŒ…æ‹¬è€ƒè™‘Redisé›†ç¾¤ç­‰é«˜å¯ç”¨é…ç½®ã€‚</li><li>é™æµå‚æ•°<code>replenishRate</code>å’Œ<code>burstCapacity</code>åº”æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯åˆç†è®¾ç½®ï¼Œé¿å…è¿‡åº¦é™æµå½±å“ç”¨æˆ·ä½“éªŒã€‚</li><li><code>key-resolver</code>çš„å®ç°å¯ä»¥æ ¹æ®å®é™…éœ€è¦é€‰æ‹©ä¸åŒçš„é™æµç»´åº¦ï¼Œé™¤äº†IPåœ°å€å¤–ï¼Œè¿˜å¯ä»¥æŒ‰ç”¨æˆ·IDã€APIè·¯å¾„ç­‰ç»´åº¦è¿›è¡Œé™æµã€‚</li></ul><hr><h3 id="äº”ã€æœåŠ¡ç›‘æ§"><a href="#äº”ã€æœåŠ¡ç›‘æ§" class="headerlink" title="äº”ã€æœåŠ¡ç›‘æ§"></a>äº”ã€æœåŠ¡ç›‘æ§</h3><p>ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§</p><p>ä¸€èˆ¬ç›®çš„æ˜¯ä¸ºäº†ï¼š</p><ul><li>é—®é¢˜å®šä½</li><li>æ€§èƒ½åˆ†æ</li><li>æœåŠ¡å…³ç³»</li><li>æœåŠ¡å‘Šè­¦</li></ul><p>ç›‘æ§å·¥å…·</p><ul><li>Springboot-admin</li><li>prometheus+Grafana</li><li>é“¾è·¯å·¥å…·<ul><li>zipkin</li><li>skywalking</li></ul></li></ul><blockquote><p>å¤§æ¦‚çœ‹ä¸€ä¸‹è¿™ä¸ªç”¨æ³•ï¼šprometheus+Grafana</p></blockquote><p>å¦‚æœå®é™…é—®åˆ°ï¼Œå°±å›ç­”è‡ªå·±å›ç­”æœ‰è¿™ä¸ªç›‘æ§æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨çš„ã€‚</p><p>Prometheuså’ŒGrafanaæ˜¯ä¸€å¯¹å¼ºå¤§çš„ç›‘æ§å’Œå¯è§†åŒ–å·¥å…·ç»„åˆï¼Œå¹¿æ³›ç”¨äºç›‘æ§å¾®æœåŠ¡æ¶æ„ä¸­çš„åº”ç”¨å’ŒåŸºç¡€è®¾æ–½çš„å¥åº·çŠ¶å†µã€æ€§èƒ½æŒ‡æ ‡ç­‰ã€‚è¿™ç§ç»„åˆçš„ç”¨æ³•ä¸»è¦æ¶‰åŠåˆ°ä¸‰ä¸ªæ­¥éª¤ï¼šæ•°æ®æ”¶é›†ï¼ˆPrometheusï¼‰ï¼Œæ•°æ®å­˜å‚¨ï¼ˆPrometheusï¼‰ï¼Œä»¥åŠæ•°æ®å¯è§†åŒ–ï¼ˆGrafanaï¼‰ã€‚</p><blockquote><p>æ­¥éª¤1: æ•°æ®æ”¶é›†</p></blockquote><p>Prometheusé€šè¿‡æ‹‰æ¨¡å¼ï¼ˆpullï¼‰æˆ–æ¨æ¨¡å¼ï¼ˆpushï¼Œéœ€è¦ä½¿ç”¨Pushgatewayï¼‰ä»åº”ç”¨ç¨‹åºå’ŒåŸºç¡€è®¾æ–½ä¸­æ”¶é›†æŒ‡æ ‡æ•°æ®ã€‚é€šå¸¸ï¼Œåº”ç”¨ç¨‹åºå’ŒæœåŠ¡ä¼šæš´éœ²ä¸€ä¸ªHTTPç«¯ç‚¹ï¼ˆé€šå¸¸æ˜¯<code>/metrics</code>ï¼‰ï¼ŒPrometheuså®šæ—¶ä»è¿™äº›ç«¯ç‚¹æŠ“å–ï¼ˆscrapeï¼‰æ•°æ®ã€‚</p><p>ä¸ºäº†è®©Prometheusèƒ½å¤Ÿæ”¶é›†æ•°æ®ï¼Œä½ éœ€è¦åœ¨Prometheusçš„é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯<code>prometheus.yml</code>ï¼‰ä¸­å®šä¹‰æŠ“å–ç›®æ ‡å’Œé¢‘ç‡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">scrape_configs</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">job_name: &#x27;spring-application&#x27;</span><br>    <span class="hljs-attribute">scrape_interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">15s</span><br>    <span class="hljs-attribute">metrics_path</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;/actuator/prometheus&#x27;</span><br>    <span class="hljs-attribute">static_configs</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">targets: [&#x27;localhost:8080&#x27;]</span><br></code></pre></td></tr></table></figure><p>æ•°æ®é‡‡é›†è¿™é‡Œè¦æ±‚ SpringBoot åº”ç”¨å¯¹å¤–å¼€å‘ <code>/metrics</code> æ¥å£ï¼Œå®é™…æ“ä½œé€šå¸¸æ˜¯é€šè¿‡<strong>é›†æˆSpring Boot Actuatorå’ŒMicrometeræ¥å®ç°çš„</strong>ã€‚  ğŸš©</p><p>Spring Boot Actuatoræä¾›äº†ä¸€ç³»åˆ—å†…ç½®çš„ç«¯ç‚¹ï¼ŒåŒ…æ‹¬<code>/metrics</code>ï¼Œç”¨äºç›‘æ§å’Œç®¡ç†åº”ç”¨ã€‚Micrometeråˆ™ä½œä¸ºSpring Bootçš„ç»´åº¦åŒ–æŒ‡æ ‡åº“ï¼Œå……å½“äº†åº”ç”¨å’Œç›‘æ§ç³»ç»Ÿä¹‹é—´çš„æ¡¥æ¢ã€‚</p><ul><li>å¼•å…¥ä¾èµ–ï¼šç¡®ä¿åœ¨Spring Booté¡¹ç›®çš„<code>pom.xml</code>æ–‡ä»¶ä¸­å¼•å…¥äº†Spring Boot Actuatorå’ŒMicrometer Prometheusçš„ä¾èµ–ã€‚</li><li>é…ç½®åº”ç”¨ï¼šç¡®ä¿<code>application.properties</code>æˆ–<code>application.yml</code>é…ç½®æ–‡ä»¶ä¸­å¯ç”¨äº†<code>/metrics</code>ç«¯ç‚¹ã€‚Spring Boot 2.xé»˜è®¤å¯ç”¨äº†å¤§éƒ¨åˆ†Actuatorç«¯ç‚¹ï¼ŒåŒ…æ‹¬<code>/metrics</code>ã€‚</li><li>æš´éœ²&#x2F;metricsç«¯ç‚¹</li><li>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æŒ‡æ ‡</li></ul><blockquote><p>æ­¥éª¤2: æ•°æ®å­˜å‚¨</p></blockquote><p>Prometheusä¼šå°†æ”¶é›†åˆ°çš„æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°çš„æ—¶é—´åºåˆ—æ•°æ®åº“ä¸­ã€‚Prometheusçš„å­˜å‚¨å¼•æ“ä¸“ä¸ºæ—¶é—´åºåˆ—æ•°æ®ä¼˜åŒ–ï¼Œæ”¯æŒé«˜æ•ˆçš„æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢å’Œç®¡ç†ã€‚</p><blockquote><p>æ­¥éª¤3: æ•°æ®å¯è§†åŒ–</p></blockquote><p>Grafanaæ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®å¯è§†åŒ–å·¥å…·ï¼Œæ”¯æŒä»å¤šç§æ•°æ®æºï¼ˆåŒ…æ‹¬Prometheusï¼‰æŸ¥è¯¢å’Œå±•ç¤ºæ•°æ®ã€‚è¦ä½¿ç”¨Grafanaå±•ç¤ºPrometheusçš„æ•°æ®ï¼Œä½ éœ€è¦ï¼š</p><ol><li><strong>å®‰è£…å¹¶å¯åŠ¨Grafana</strong>ï¼šä¸‹è½½å¹¶å®‰è£…Grafanaï¼Œç„¶åå¯åŠ¨GrafanaæœåŠ¡ã€‚</li><li><strong>é…ç½®æ•°æ®æº</strong>ï¼šç™»å½•Grafanaçš„Webç•Œé¢ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„æ•°æ®æºï¼Œé€‰æ‹©Prometheusä½œä¸ºç±»å‹ï¼Œå¹¶é…ç½®PrometheusæœåŠ¡å™¨çš„URLã€‚</li><li><strong>åˆ›å»ºä»ªè¡¨æ¿</strong>ï¼šåœ¨Grafanaä¸­åˆ›å»ºæ–°çš„ä»ªè¡¨æ¿ï¼Œå¯ä»¥æ·»åŠ å¤šç§ç±»å‹çš„é¢æ¿ï¼ˆå¦‚å›¾è¡¨ã€è¡¨æ ¼ã€å•å€¼æŒ‡æ ‡ç­‰ï¼‰æ¥å±•ç¤ºPrometheusæ”¶é›†çš„æŒ‡æ ‡æ•°æ®ã€‚</li><li><strong>æŸ¥è¯¢å’Œå±•ç¤ºæ•°æ®</strong>ï¼šåœ¨ä»ªè¡¨æ¿çš„é¢æ¿ä¸­ï¼Œä½¿ç”¨PromQLï¼ˆPrometheusæŸ¥è¯¢è¯­è¨€ï¼‰ç¼–å†™æŸ¥è¯¢ï¼Œä»Prometheusä¸­æ£€ç´¢æ•°æ®ï¼Œå¹¶æ ¹æ®éœ€æ±‚é…ç½®é¢æ¿çš„æ˜¾ç¤ºæ–¹å¼ã€‚</li></ol><hr><h3 id="å…­ã€ç”Ÿäº§é—®é¢˜-ğŸš©"><a href="#å…­ã€ç”Ÿäº§é—®é¢˜-ğŸš©" class="headerlink" title="å…­ã€ç”Ÿäº§é—®é¢˜  ğŸš©"></a>å…­ã€ç”Ÿäº§é—®é¢˜  ğŸš©</h3><h4 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h4><p>å‚è€ƒè¿™ç¯‡æ–‡ç« æ•´åˆä¸€ä¸‹ç›¸å…³å†…å®¹ï¼š <a href="https://www.yuque.com/snailclimb/mf2z3k/ng9vmg">https://www.yuque.com/snailclimb/mf2z3k/ng9vmg</a></p><ul><li>ç®€å†ä¸Šå†™çš„å¾®æœåŠ¡ï¼Œåªè¦æ˜¯å‘ç”Ÿäº†å¤šä¸ªæœåŠ¡ä¹‹é—´çš„<strong>å†™æ“ä½œ</strong>ï¼Œéƒ½éœ€è¦è¿›è¡Œåˆ†å¸ƒå¼äº‹åŠ¡æ§åˆ¶</li><li>æè¿°é¡¹ç›®ä¸­é‡‡ç”¨çš„é‚£ç§æ–¹æ¡ˆ(seata|MQ)<ul><li>1.seataçš„XAæ¨¡å¼ï¼ŒCP,éœ€è¦äº’ç›¸ç­‰å¾…å„ä¸ªåˆ†æ”¯äº‹åŠ¡æäº¤ï¼Œå¯ä»¥ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œæ€§èƒ½å·®      é“¶è¡Œä¸šåŠ¡</li><li>2.seataçš„ATæ¨¡å¼ï¼ŒAP,åº•å±‚ä½¿ç”¨undo logå®ç°ï¼Œæ€§èƒ½å¥½                          äº’è”ç½‘ä¸šåŠ¡</li><li><ol start="3"><li>seataçš„TCCæ¨¡å¼ï¼ŒAP,æ€§èƒ½è¾ƒå¥½ï¼Œä¸è¿‡éœ€è¦äººå·¥ç¼–ç å®ç°                   é“¶è¡Œä¸šåŠ¡</li></ol></li></ul></li><li>4.MQæ¨¡å¼å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œåœ¨AæœåŠ¡å†™æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…å‘é€æ¶ˆæ¯åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡ï¼Œå¼‚æ­¥ï¼Œæ€§èƒ½æœ€å¥½                                                äº’è”ç½‘ä¸šåŠ¡</li></ul><hr><p>å¾®æœåŠ¡é¡¹ç›®</p><ul><li>Seata æ¡†æ¶ï¼ˆXAã€ATã€TCCï¼‰</li><li>MQ</li></ul><h5 id="Seata-ğŸ“•"><a href="#Seata-ğŸ“•" class="headerlink" title="Seata   ğŸ“•"></a>Seata   ğŸ“•</h5><p>Seataæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œæ—¨åœ¨æä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚</p><p>åœ¨Seataä¸­ï¼Œä¸»è¦æä¾›äº†ä¸‰ç§äº‹åŠ¡æ¨¡å¼ï¼šXAã€ATå’ŒTCCï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡éœ€æ±‚ã€‚</p><hr><blockquote><p>Seata æ¶æ„</p></blockquote><p>Seataäº‹åŠ¡ç®¡ç†ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„è§’è‰²ï¼š</p><ul><li>TC(Transaction Coordinator)-äº‹åŠ¡åè°ƒè€…ï¼šç»´æŠ¤å…¨å±€å’Œåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œåè°ƒå…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</li><li>TM(Transaction Manager)-äº‹åŠ¡ç®¡ç†å™¨ï¼šå®šä¹‰å…¨å±€äº‹åŠ¡çš„èŒƒå›´ã€å¼€å§‹å…¨å±€äº‹åŠ¡ã€æäº¤æˆ–å›æ»šå…¨å±€äº‹åŠ¡ã€‚</li><li>RM(Resource Manager)-èµ„æºç®¡ç†å™¨ï¼šç®¡ç†åˆ†æ”¯äº‹åŠ¡å¤„ç†çš„èµ„æºï¼Œä¸TCäº¤è°ˆä»¥æ³¨å†Œåˆ†æ”¯äº‹åŠ¡å’ŒæŠ¥å‘Šåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é©±åŠ¨åˆ†æ”¯äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228213922.png" alt="image.png"></p><p>Seata ä¸­æœ‰ä¸‰ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ XAã€AT å’Œ TCC</p><ul><li>XA  æ¨¡å¼</li><li>AT  æ¨¡å¼</li><li>TCC æ¨¡å¼</li></ul><p><strong>XA æ¨¡å¼</strong></p><p>XAæ¨¡å¼åŸºäºXAåè®®å®ç°ï¼Œæ˜¯ä¸€ç§ä¸¤é˜¶æ®µæäº¤çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚XAæ¨¡å¼æ¶‰åŠåˆ°äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTMï¼‰ã€èµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰å’Œäº‹åŠ¡åè°ƒè€…ï¼ˆTCï¼‰ä¸‰ä¸ªè§’è‰²ã€‚</p><ul><li><strong>ç¬¬ä¸€é˜¶æ®µï¼ˆå‡†å¤‡é˜¶æ®µï¼‰</strong>ï¼šäº‹åŠ¡ç®¡ç†å™¨æŒ‡ç¤ºæ‰€æœ‰å‚ä¸å½“å‰äº‹åŠ¡çš„èµ„æºç®¡ç†å™¨å‡†å¤‡æäº¤äº‹åŠ¡ã€‚</li><li><strong>ç¬¬äºŒé˜¶æ®µï¼ˆæäº¤&#x2F;å›æ»šé˜¶æ®µï¼‰</strong>ï¼šå¦‚æœæ‰€æœ‰èµ„æºç®¡ç†å™¨éƒ½å‡†å¤‡å°±ç»ªï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¼šæŒ‡ç¤ºå®ƒä»¬æäº¤äº‹åŠ¡ï¼›å¦‚æœä»»ä½•èµ„æºç®¡ç†å™¨ä¸èƒ½å‡†å¤‡å°±ç»ªï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¼šæŒ‡ç¤ºæ‰€æœ‰èµ„æºç®¡ç†å™¨å›æ»šäº‹åŠ¡ã€‚</li></ul><p>XAæ¨¡å¼ä¿è¯äº†è·¨æ•°æ®åº“å’Œç³»ç»Ÿçš„äº‹åŠ¡ä¸€è‡´æ€§ï¼Œä½†å®ç°å¤æ‚ï¼Œæ€§èƒ½å¼€é”€è¾ƒå¤§ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228214142.png" alt="image.png"></p><p>AT æ¨¡å¼</p><p>ATæ¨¡å¼æ˜¯Seataè‡ªä¸»åˆ›æ–°çš„ä¸€ç§äº‹åŠ¡æ¨¡å¼ï¼Œå…¨ç§°ä¸ºAutomatic Transactionï¼Œå³è‡ªåŠ¨åŒ–äº‹åŠ¡æ¨¡å¼ã€‚å®ƒé€šè¿‡å¯¹æ•°æ®è¿›è¡Œå‰åé•œåƒè®°å½•æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><ul><li><strong>æäº¤äº‹åŠ¡</strong>ï¼šåœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œå¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œåˆ™ç›´æ¥æäº¤äº‹åŠ¡ï¼›å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œåˆ©ç”¨é•œåƒè®°å½•è¿›è¡Œå›æ»šã€‚</li><li><strong>å›æ»šäº‹åŠ¡</strong>ï¼šåœ¨å›æ»šæ—¶ï¼Œåˆ©ç”¨ä¹‹å‰è®°å½•çš„å‰é•œåƒå’Œåé•œåƒè¿›è¡Œæ•°æ®çš„æ¢å¤ã€‚</li></ul><p>ATæ¨¡å¼ä¸ä¾èµ–XAåè®®ï¼Œå…·æœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼Œæ˜“äºç†è§£å’Œä½¿ç”¨ï¼Œæ˜¯Seataä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„æ¨¡å¼ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228214546.png" alt="image.png"></p><p>TCC æ¨¡å¼</p><p>TCCæ¨¡å¼å³Try-Confirm-Cancelæ¨¡å¼ï¼Œæ˜¯ä¸€ç§è¡¥å¿æ€§çš„äº‹åŠ¡æ¨¡å¼ã€‚å®ƒå°†ä¸šåŠ¡æ“ä½œæ‹†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šå°è¯•ï¼ˆTryï¼‰ã€ç¡®è®¤ï¼ˆConfirmï¼‰å’Œå–æ¶ˆï¼ˆCancelï¼‰ã€‚</p><ul><li><strong>Tryé˜¶æ®µ</strong>ï¼šæ£€æŸ¥å¹¶é¢„ç•™ä¸šåŠ¡èµ„æºã€‚</li><li><strong>Confirmé˜¶æ®µ</strong>ï¼šå¦‚æœæ‰€æœ‰æœåŠ¡çš„Tryé˜¶æ®µéƒ½æˆåŠŸï¼Œé‚£ä¹ˆæ‰§è¡Œä¸šåŠ¡æ“ä½œã€‚</li><li><strong>Cancelé˜¶æ®µ</strong>ï¼šå¦‚æœä»»ä½•æœåŠ¡çš„Tryé˜¶æ®µå¤±è´¥ï¼Œé‚£ä¹ˆæ‰§è¡Œæ’¤é”€æ“ä½œï¼Œé‡Šæ”¾åœ¨Tryé˜¶æ®µé¢„ç•™çš„èµ„æºã€‚</li></ul><p>TCCæ¨¡å¼æä¾›äº†è¾ƒä¸ºçµæ´»çš„äº‹åŠ¡æ§åˆ¶èƒ½åŠ›ï¼Œé€‚ç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚é«˜çš„ä¸šåŠ¡åœºæ™¯ã€‚ä½†æ˜¯ï¼Œå¼€å‘æˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®ç°Tryã€Confirmå’ŒCancelä¸‰ä¸ªæ“ä½œã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228214636.png" alt="image.png"></p><p>æ€»ç»“ï¼›</p><ul><li><strong>XAæ¨¡å¼</strong>ï¼šåŸºäºXAåè®®çš„ä¸¤é˜¶æ®µæäº¤ï¼Œä¿è¯äº‹åŠ¡çš„ACIDç‰¹æ€§ï¼Œå®ç°å¤æ‚ï¼Œæ€§èƒ½å¼€é”€å¤§ã€‚</li><li><strong>ATæ¨¡å¼</strong>ï¼šé€šè¿‡æ•°æ®é•œåƒè®°å½•å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç®€å•æ˜“ç”¨ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œæ˜¯Seataçš„é»˜è®¤äº‹åŠ¡æ¨¡å¼ã€‚</li><li><strong>TCCæ¨¡å¼</strong>ï¼šé€šè¿‡æ˜¾å¼çš„Try-Confirm-Cancelæ“ä½œæ¥æ§åˆ¶äº‹åŠ¡ï¼Œçµæ´»æ€§é«˜ï¼Œé€‚åˆå¯¹ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œä½†å®ç°æˆæœ¬è¾ƒé«˜ã€‚</li></ul><p>æš‚æ—¶è¿˜ä¸å¤ªç†è§£ï¼Œåˆ°æ—¶å€™å°±è¯´ä¸€ä¸‹å…³äºåˆ†å¸ƒå¼äº‹åŠ¡</p><p>å…¶ä¸­ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ Seata è¿›è¡Œä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„ç®¡ç†ï¼Œé»˜è®¤é‡‡ç”¨çš„æ˜¯ AT æ¨¡å¼ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™ä¼šä¿ç•™ä¸€ä¸ªæ•°æ®å¿«ç…§ï¼Œå¦‚æœæ•´ä¸ªäº‹åŠ¡æœ‰æ‰§è¡Œå¤±è´¥çš„è¯ï¼Œåˆ™æ‰§è¡Œå›æ»šæ“ä½œã€‚ï¼ˆå¤§è‡´ Get ä¸€ä¸‹ï¼Œè¯¦ç»†çš„åé¢å†äº†è§£ä¸€ä¸‹ï¼‰</p><p>å…³äºå…¶ä»–çš„ ACã€XAã€TCC æ˜¯çŸ¥é“æœ‰è¿™ä¸ªï¼Œä½†å…·ä½“ä¸å¤ªæ¸…æ¥šã€‚ç„¶åè§’è‰²è®°ä¸€ä¸‹ï¼šTM äº‹åŠ¡ç®¡ç†å™¨ï¼ŒRM èµ„æºç®¡ç†å™¨ï¼ŒTC äº‹åŠ¡åè°ƒè€…ã€‚</p><hr><h5 id="MQ-ğŸš©-ğŸ’£"><a href="#MQ-ğŸš©-ğŸ’£" class="headerlink" title="MQ   ğŸš©  ğŸ’£"></a>MQ   ğŸš©  ğŸ’£</h5><p>éœ€è¦çœ‹ä¸€ä¸‹è¿™ä¸ªå•¥ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡MQ æ€ä¹ˆè¯•ä¸‹éš¾ç‚¹</p><p>é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰å®ç°åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ä¸€ç§å¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ç§æ–¹æ³•é€šå¸¸è¢«ç§°ä¸ºæœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆæˆ–å¼‚æ­¥ç¡®ä¿å‹æ–¹æ¡ˆã€‚å®ƒåˆ©ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„å¯é æ€§æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œä¸»è¦åº”ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚ä¸æ˜¯éå¸¸é«˜ï¼Œä½†å¯¹ç³»ç»Ÿå¯ç”¨æ€§å’Œä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚</p><p>é€šè¿‡MQå®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„åŸºæœ¬æ€è·¯æ˜¯å°†äº‹åŠ¡çš„æ‰§è¡Œåˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>æœ¬åœ°äº‹åŠ¡æ‰§è¡Œ</strong>ï¼šé¦–å…ˆåœ¨å‘é€æ–¹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¹¶å°†è¦æ‰§è¡Œçš„è·¨æœåŠ¡æ“ä½œå°è£…æˆæ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚æ­¤æ—¶ï¼Œæ¶ˆæ¯å¤„äºä¸å¯è¢«æ¶ˆè´¹çŠ¶æ€ã€‚</li><li><strong>æ¶ˆæ¯ç¡®è®¤ä¸æ¶ˆè´¹</strong>ï¼šå½“æœ¬åœ°äº‹åŠ¡æˆåŠŸæäº¤åï¼Œæ¶ˆæ¯å˜ä¸ºå¯æ¶ˆè´¹çŠ¶æ€ï¼Œæ¥æ”¶æ–¹ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ‹‰å–æ¶ˆæ¯å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚å¦‚æœæ“ä½œæˆåŠŸï¼Œå®Œæˆæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼›å¦‚æœæ“ä½œå¤±è´¥ï¼Œå¯ä»¥é€šè¿‡é‡è¯•æœºåˆ¶å†æ¬¡å°è¯•ï¼Œæˆ–è€…æ‰§è¡Œè¡¥å¿æ“ä½œä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚</li></ol><p>å®ç°MQåˆ†å¸ƒå¼äº‹åŠ¡é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p><strong>åŠæ¶ˆæ¯æœºåˆ¶</strong>ï¼šè¿™æ˜¯ä¸€ç§è¾ƒä¸ºå¤æ‚çš„å®ç°æ–¹å¼ï¼Œå‘é€æ–¹é¦–å…ˆå‘é€ä¸€æ¡â€œåŠæ¶ˆæ¯â€ï¼ˆå³é¢„å¤‡æ¶ˆæ¯ï¼‰åˆ°MQï¼Œè¿™æ¡æ¶ˆæ¯æš‚æ—¶ä¸ä¼šè¢«æ¶ˆè´¹ç«¯æ¶ˆè´¹ã€‚å‘é€æ–¹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œæœ¬åœ°äº‹åŠ¡æˆåŠŸåå†å‘é€å¦ä¸€æ¡ç¡®è®¤æ¶ˆæ¯ç»™MQï¼ŒMQæ”¶åˆ°ç¡®è®¤æ¶ˆæ¯åï¼Œå°†åŠæ¶ˆæ¯æ ‡è®°ä¸ºå¯æ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…æ­¤æ—¶å¯ä»¥æ­£å¸¸æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯ã€‚</p></li><li><p><strong>äº‹åŠ¡æ¶ˆæ¯</strong>ï¼šæŸäº›MQæ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„ç‰¹æ€§ï¼Œä¾‹å¦‚Apache RocketMQã€‚äº‹åŠ¡æ¶ˆæ¯å…è®¸å‘é€æ–¹åœ¨å‘é€æ¶ˆæ¯çš„åŒæ—¶æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå¦‚æœæœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œåˆ™æäº¤æ¶ˆæ¯ä½¿å…¶å¯è¢«æ¶ˆè´¹ï¼›å¦‚æœæœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œåˆ™å›æ»šæ¶ˆæ¯ï¼Œä½¿å…¶ä¸ä¼šè¢«æ¶ˆè´¹ã€‚</p></li></ol><h4 id="æ¥å£å¹‚ç­‰æ€§"><a href="#æ¥å£å¹‚ç­‰æ€§" class="headerlink" title="æ¥å£å¹‚ç­‰æ€§"></a>æ¥å£å¹‚ç­‰æ€§</h4><blockquote><p>åˆ†å¸ƒå¼æœåŠ¡çš„æ¥å£å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼Ÿ</p></blockquote><p>å¹‚ç­‰ï¼šå¤šæ¬¡è°ƒç”¨æ–¹æ³•æˆ–è€…æ¥å£ä¸ä¼šæ”¹å˜ä¸šåŠ¡çŠ¶æ€ï¼Œå¯ä»¥ä¿è¯é‡å¤è°ƒç”¨çš„ç»“æœå’Œå•æ¬¡è°ƒç”¨çš„ç»“æœä¸€è‡´ã€‚</p><p>éœ€è¦å¹‚ç­‰åœºæ™¯ï¼š</p><ul><li>1ã€ç”¨æˆ·é‡å¤ç‚¹å‡»ï¼ˆç½‘ç»œæ³¢åŠ¨ï¼‰ã€</li><li>2ã€MQ æ¶ˆæ¯é‡å¤</li><li>3ã€åº”ç”¨ä½¿ç”¨å¤±è´¥æˆ–è€…è¶…æ—¶é‡è¯•æœºåˆ¶</li></ul><p>åœ¨ Restful  API çš„è§’åº¦ï¼Œçœ‹å¸¸è§ç±»å‹è¯·æ±‚çš„å¹‚ç­‰æ€§åˆ†æï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228233944.png" alt="image.png"></p><h5 id="token-redis"><a href="#token-redis" class="headerlink" title="token + redis"></a>token + redis</h5><h5 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h5><p>setnx + redission</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234242.png" alt="image.png"></p><hr><p>é¢è¯•é¢˜å›ç­”ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234331.png" alt="image.png"></p><h3 id="ä¸ƒã€ä»»åŠ¡è°ƒåº¦"><a href="#ä¸ƒã€ä»»åŠ¡è°ƒåº¦" class="headerlink" title="ä¸ƒã€ä»»åŠ¡è°ƒåº¦"></a>ä¸ƒã€ä»»åŠ¡è°ƒåº¦</h3><h4 id="åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦-xxl-job"><a href="#åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦-xxl-job" class="headerlink" title="åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ xxl-job"></a>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ xxl-job</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234452.png" alt="image.png"></p><h5 id="è·¯ç”±ç­–ç•¥"><a href="#è·¯ç”±ç­–ç•¥" class="headerlink" title="è·¯ç”±ç­–ç•¥"></a>è·¯ç”±ç­–ç•¥</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234546.png" alt="image.png"></p><h5 id="å¤±è´¥é‡è¯•"><a href="#å¤±è´¥é‡è¯•" class="headerlink" title="å¤±è´¥é‡è¯•"></a>å¤±è´¥é‡è¯•</h5><blockquote><p>xxl-job ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ€ä¹ˆè§£å†³ï¼Ÿ</p></blockquote><p>è®¾ç½®æ•…éšœè½¬ç§» + å¤±è´¥é‡è¯•ï¼ŒæŸ¥çœ‹æ—¥å¿—åˆ†æ   â†’   é‚®ä»¶å‘Šè­¦</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234701.png" alt="image.png"></p><h5 id="åˆ†ç‰‡å¹¿æ’­"><a href="#åˆ†ç‰‡å¹¿æ’­" class="headerlink" title="åˆ†ç‰‡å¹¿æ’­"></a>åˆ†ç‰‡å¹¿æ’­</h5><blockquote><p>å¦‚æœæœ‰å¤§æ•°æ®é‡çš„ä»»åŠ¡åŒæ—¶éƒ½éœ€è¦æ‰§è¡Œï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228234936.png" alt="image.png"></p><p>é¢è¯•é¢˜å›ç­”ï¼›</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228235033.png" alt="image.png"></p><h3 id="å…«ã€æ—¥å¿—ç®¡ç†"><a href="#å…«ã€æ—¥å¿—ç®¡ç†" class="headerlink" title="å…«ã€æ—¥å¿—ç®¡ç†"></a>å…«ã€æ—¥å¿—ç®¡ç†</h3><p>è¿™éƒ¨åˆ†å…ˆä¸ç®¡ï¼Œå¤§æ¦‚è¯´ä¸€ä¸‹ï¼Œå®é™…é¡¹ç›®ä¸­çš„ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯æ€ä¹ˆåšçš„å°±è¡Œ</p><p>to be continedâ€¦.</p><p>åç»­æ‰“ç®—ä¼˜åŒ–å¯ç”¨çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š  <a href="https://www.yuque.com/snailclimb/mf2z3k/ma1byh">https://www.yuque.com/snailclimb/mf2z3k/ma1byh</a></p><hr><p>å‚è€ƒ</p><ul><li><a href="https://gitee.com/lixiaogou/cloud2020">https://gitee.com/lixiaogou/cloud2020</a></li><li><a href="https://blog.csdn.net/qq_36903261/article/details/106507150">https://blog.csdn.net/qq_36903261/article/details/106507150</a></li><li><a href="https://github.com/angenin/cloud2020">https://github.com/angenin/cloud2020</a></li><li><a href="https://www.bilibili.com/video/BV18E411x7eT">https://www.bilibili.com/video/BV18E411x7eT</a></li><li><a href="https://zhuanlan.zhihu.com/p/110249846">https://zhuanlan.zhihu.com/p/110249846</a></li><li><a href="https://www.bilibili.com/video/BV1yT411H7YK">https://www.bilibili.com/video/BV1yT411H7YK</a></li><li><a href="https://www.yuque.com/snailclimb/mf2z3k/ng9vmg#09ddab5d">https://www.yuque.com/snailclimb/mf2z3k/ng9vmg#09ddab5d</a></li></ul><p>å¼•ç”¨</p><ul><li><a href="https://www.bookstack.cn/read/spring-cloud-docs/docs-index.md">https://www.bookstack.cn/read/spring-cloud-docs/docs-index.md</a></li><li><a href="https://www.springcloud.cc/">https://www.springcloud.cc/</a></li><li><a href="https://cloud.spring.io/spring-cloud-static/Hoxton.SR5/reference/htmlsingle/">https://cloud.spring.io/spring-cloud-static/Hoxton.SR5/reference/htmlsingle/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>springcloud</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVMå…¥é—¨_åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2024/03/07/JVM%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2024/03/07/JVM%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€ä»€ä¹ˆæ˜¯-JVM"><a href="#1ã€ä»€ä¹ˆæ˜¯-JVM" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯ JVM"></a>1ã€ä»€ä¹ˆæ˜¯ JVM</h3><p>JVM å…¨ç§°æ˜¯ Java Virtual Machineï¼Œä¸­æ–‡åç§°å«Javaè™šæ‹Ÿæœºï¼Œå®ƒæ˜¯ç”±è½¯ä»¶æŠ€æœ¯æ¨¡æ‹Ÿå‡ºè®¡ç®—æœºè¿è¡Œçš„ä¸€ä¸ªè™šæ‹Ÿçš„è®¡ç®—æœºã€‚</p><p>JVM å……å½“ç€ä¸€ä¸ªç¿»è¯‘å®˜çš„è§’è‰²ï¼Œèƒ½å¤Ÿå°†æˆ‘ä»¬ç¼–å†™å‡ºçš„Javaç¨‹åºï¼Œç¿»è¯‘ç»™ç³»ç»Ÿâ€œå¬â€ï¼Œå‘Šè¯‰å®ƒæˆ‘ä»¬çš„ç¨‹åºéœ€è¦åšä»€ä¹ˆæ“ä½œã€‚</p><p>Javaçš„ä»£ç éœ€è¦ç»è¿‡ç¼–è¯‘å™¨ï¼Œç”Ÿæˆ.Classæ–‡ä»¶åï¼ŒJVMæ‰èƒ½è¯†åˆ«å¹¶è¿è¡Œå®ƒï¼ŒJVMé’ˆå¯¹æ¯ä¸ªæ“ä½œç³»ç»Ÿå¼€å‘å…¶å¯¹åº”çš„è§£é‡Šå™¨ï¼Œæ‰€ä»¥åªè¦å…¶æ“ä½œç³»ç»Ÿæœ‰å¯¹åº”ç‰ˆæœ¬çš„JVMï¼Œé‚£ä¹ˆè¿™ä»½Javaç¼–è¯‘åçš„ä»£ç å°±èƒ½å¤Ÿè¿è¡Œèµ·æ¥ï¼Œè¿™å°±æ˜¯Javaèƒ½ä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œçš„åŸå› ã€‚</p><p>å½“å‰å¸‚é¢ä¸Šä½¿ç”¨èŒƒå›´æœ€å¹¿çš„ï¼Œæ˜¯Sun&#x2F;OracleJDKæˆ–è€…OpenJDKä¸­é»˜è®¤çš„ HotSpot è™šæ‹Ÿæœºï¼Œè¿™é‡Œä¹Ÿæ˜¯ä»¥ HotSpot è™šæ‹Ÿæœºå±•å¼€ï¼Œå¯¹JVM åŸºç¡€æ¦‚å¿µè¿›è¡Œé˜è¿°ã€‚</p><h3 id="2ã€ç±»åŠ è½½æœºåˆ¶"><a href="#2ã€ç±»åŠ è½½æœºåˆ¶" class="headerlink" title="2ã€ç±»åŠ è½½æœºåˆ¶"></a>2ã€ç±»åŠ è½½æœºåˆ¶</h3><p>ä¸Šæ–‡æåˆ°ï¼ŒJavaçš„ä»£ç ç»è¿‡ç¼–è¯‘å™¨ï¼Œç”Ÿæˆ.Classæ–‡ä»¶åï¼ŒJVMæ‰èƒ½è¯†åˆ«å¹¶è¿è¡Œã€‚</p><blockquote><p>ç±»åŠ è½½è¿‡ç¨‹</p></blockquote><p><strong>Class æ–‡ä»¶éœ€è¦åŠ è½½åˆ°è™šæ‹Ÿæœºä¸­ä¹‹åæ‰èƒ½è¿è¡Œå’Œä½¿ç”¨ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºæ˜¯å¦‚ä½•åŠ è½½è¿™äº› Class æ–‡ä»¶å‘¢ï¼Ÿ</strong></p><p>ç³»ç»ŸåŠ è½½ Class ç±»å‹çš„æ–‡ä»¶ä¸»è¦ä¸‰æ­¥ï¼š<strong>åŠ è½½-&gt;è¿æ¥-&gt;åˆå§‹åŒ–</strong>ã€‚è¿æ¥è¿‡ç¨‹åˆå¯åˆ†ä¸ºä¸‰æ­¥ï¼š<strong>éªŒè¯-&gt;å‡†å¤‡-&gt;è§£æ</strong>ã€‚</p><p>æ•´ä¸ªç±»åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼ŒåŒ…æ‹¬<strong>åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–</strong>äº”ä¸ªé˜¶æ®µã€‚</p><p>åœ¨è¿™äº”ä¸ªé˜¶æ®µä¸­ï¼ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡å’Œåˆå§‹åŒ–è¿™å››ä¸ªé˜¶æ®µå‘ç”Ÿçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œè€Œè§£æé˜¶æ®µåˆ™ä¸ä¸€å®šï¼Œå®ƒåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒJavaè¯­è¨€çš„è¿è¡Œæ—¶ç»‘å®š(ä¹Ÿæˆä¸ºåŠ¨æ€ç»‘å®šæˆ–æ™šæœŸç»‘å®š)ã€‚</p><p>å¦å¤–æ³¨æ„<strong>è¿™é‡Œçš„å‡ ä¸ªé˜¶æ®µæ˜¯æŒ‰é¡ºåºå¼€å§‹ï¼Œè€Œä¸æ˜¯æŒ‰é¡ºåºè¿›è¡Œæˆ–å®Œæˆ</strong>ï¼Œå› ä¸ºè¿™äº›é˜¶æ®µé€šå¸¸éƒ½æ˜¯äº’ç›¸äº¤å‰åœ°æ··åˆè¿›è¡Œçš„ï¼Œé€šå¸¸åœ¨ä¸€ä¸ªé˜¶æ®µæ‰§è¡Œçš„è¿‡ç¨‹ä¸­è°ƒç”¨æˆ–æ¿€æ´»å¦ä¸€ä¸ªé˜¶æ®µã€‚</p><ul><li>ç±»çš„åŠ è½½: æŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ®</li><li>è¿æ¥<ul><li>éªŒè¯: ç¡®ä¿è¢«åŠ è½½çš„ç±»çš„æ­£ç¡®æ€§</li><li>å‡†å¤‡: ä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼</li><li>è§£æ: æŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</li></ul></li><li>åˆå§‹åŒ–ï¼šä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒJVMè´Ÿè´£å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸»è¦å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚</li><li>ä½¿ç”¨ï¼š ç±»è®¿é—®æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„çš„æ¥å£ï¼Œ å¯¹è±¡æ˜¯HeapåŒºçš„æ•°æ®</li><li>å¸è½½ï¼š ç»“æŸç”Ÿå‘½å‘¨æœŸ</li></ul><blockquote><p>ç±»åŠ è½½çš„å±‚æ¬¡</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231116234810.png" alt="image.png"></p><ul><li><strong>å¯åŠ¨ç±»åŠ è½½å™¨</strong>: Bootstrap ClassLoaderï¼Œ<ul><li>è´Ÿè´£åŠ è½½å­˜æ”¾åœ¨<code>JDK\jre\lib</code> (JDKä»£è¡¨JDKçš„å®‰è£…ç›®å½•ï¼Œä¸‹åŒ)ä¸‹ï¼Œæˆ–è¢«-Xbootclasspathå‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”èƒ½è¢«è™šæ‹Ÿæœºè¯†åˆ«çš„ç±»åº“(å¦‚rt.jarï¼Œæ‰€æœ‰çš„java.* å¼€å¤´çš„ç±»å‡è¢«Bootstrap ClassLoaderåŠ è½½)ã€‚</li><li>å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯æ— æ³•è¢«Javaç¨‹åºç›´æ¥å¼•ç”¨çš„ã€‚</li></ul></li><li><strong>æ‰©å±•ç±»åŠ è½½å™¨</strong>: Extension ClassLoaderï¼Œ<ul><li>è¯¥åŠ è½½å™¨ç”±<code>sun.misc.Launcher$ExtClassLoader</code>å®ç°ï¼Œå®ƒè´Ÿè´£åŠ è½½<code>JDK\jre\lib\ext</code>ç›®å½•ä¸­ï¼Œæˆ–è€…ç”± java.ext.dirs ç³»ç»Ÿå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“(å¦‚javax.* å¼€å¤´çš„ç±»)ï¼Œ</li><li>å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨ã€‚</li></ul></li><li><strong>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨</strong>: Application ClassLoaderï¼Œ<ul><li>è¯¥ç±»åŠ è½½å™¨ç”±<code>sun.misc.Launcher$AppClassLoader</code>æ¥å®ç°ï¼Œå®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„(ClassPath)æ‰€æŒ‡å®šçš„ç±»ï¼Œ</li><li>å¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚</li></ul></li><li><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong>: <ul><li>å› ä¸ºJVMè‡ªå¸¦çš„ ClassLoader åªæ˜¯æ‡‚å¾—ä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½æ ‡å‡†çš„ java class æ–‡ä»¶ï¼Œå› æ­¤å¦‚æœç¼–å†™äº†è‡ªå·±çš„ClassLoaderï¼Œä¾¿å¯ä»¥åšåˆ°å¦‚ä¸‹å‡ ç‚¹:<ul><li>åœ¨æ‰§è¡Œéç½®ä¿¡ä»£ç ä¹‹å‰ï¼Œè‡ªåŠ¨éªŒè¯æ•°å­—ç­¾åã€‚</li><li>åŠ¨æ€åœ°åˆ›å»ºç¬¦åˆç”¨æˆ·ç‰¹å®šéœ€è¦çš„å®šåˆ¶åŒ–æ„å»ºç±»ã€‚</li><li>ä»ç‰¹å®šçš„åœºæ‰€å–å¾—java classï¼Œä¾‹å¦‚æ•°æ®åº“ä¸­å’Œç½‘ç»œä¸­ã€‚</li></ul></li></ul></li></ul><blockquote><p>Class.forName() å’Œ ClassLoader.loadClass()åŒºåˆ«?</p></blockquote><ul><li><code>Class.forName()</code>: å°†ç±»çš„.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹ç±»è¿›è¡Œè§£é‡Šï¼Œæ‰§è¡Œç±»ä¸­çš„staticå—ï¼›</li><li><code>ClassLoader.loadClass()</code>: åªå¹²ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å°†.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ï¼Œä¸ä¼šæ‰§è¡Œstaticä¸­çš„å†…å®¹,åªæœ‰åœ¨newInstanceæ‰ä¼šå»æ‰§è¡Œstaticå—ã€‚</li><li><code>Class.forName(name, initialize, loader)</code>å¸¦å‚å‡½æ•°ä¹Ÿå¯æ§åˆ¶æ˜¯å¦åŠ è½½staticå—ã€‚å¹¶ä¸”åªæœ‰è°ƒç”¨äº†newInstance()æ–¹æ³•é‡‡ç”¨è°ƒç”¨æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç±»çš„å¯¹è±¡</li></ul><hr><p>Javaçš„ç±»åŠ è½½æœºåˆ¶æ˜¯Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰çš„ä¸€ä¸ªæ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£åŠ¨æ€åŠ è½½ã€é“¾æ¥å’Œåˆå§‹åŒ–æ‰€æœ‰çš„ç±»å’Œæ¥å£ã€‚ç±»åŠ è½½æœºåˆ¶çš„å·¥ä½œåŸç†æ˜¯åˆ†é˜¶æ®µè¿›è¡Œçš„ï¼Œä¸»è¦åŒ…æ‹¬åŠ è½½ï¼ˆLoadingï¼‰ã€é“¾æ¥ï¼ˆLinkingï¼‰å’Œåˆå§‹åŒ–ï¼ˆInitializationï¼‰ä¸‰ä¸ªé˜¶æ®µã€‚</p><ol><li>åŠ è½½ï¼ˆLoadingï¼‰</li></ol><p>åœ¨åŠ è½½é˜¶æ®µï¼ŒJVMä¼šé€šè¿‡ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰è¯»å–äºŒè¿›åˆ¶æ•°æ®ï¼ˆé€šå¸¸æ˜¯ä»<code>.class</code>æ–‡ä»¶ä¸­ï¼‰å¹¶å°†å…¶è½¬æ¢ä¸º<code>java.lang.Class</code>çš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹ä»£è¡¨äº†ç±»åœ¨JVMä¸­çš„ä¸€ä¸ªåŸå§‹æ•°æ®ç»“æ„ã€‚</p><p>ç±»åŠ è½½å™¨ç±»å‹ï¼š</p><ul><li><strong>å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰</strong>: åŠ è½½JVMçš„æ ¸å¿ƒç±»åº“ã€‚</li><li><strong>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰</strong>: åŠ è½½<code>jre/lib/ext</code>ç›®å½•ä¸‹æˆ–è€…ç”±ç³»ç»Ÿå±æ€§<code>java.ext.dirs</code>æŒ‡å®šä½ç½®ä¸­çš„ç±»åº“ã€‚</li><li><strong>ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆSystem ClassLoaderï¼‰</strong>: åŠ è½½ç³»ç»Ÿç±»è·¯å¾„ï¼ˆ<code>classpath</code>ï¼‰ä¸Šçš„ç±»åº“ã€‚</li></ul><ol start="2"><li>é“¾æ¥ï¼ˆLinkingï¼‰</li></ol><p>é“¾æ¥é˜¶æ®µè´Ÿè´£å°†åŠ è½½çš„ç±»æˆ–æ¥å£çš„äºŒè¿›åˆ¶æ•°æ®åˆå¹¶åˆ°JVMçš„è¿è¡ŒçŠ¶æ€ä¸­ã€‚é“¾æ¥é˜¶æ®µåˆ†ä¸ºä¸‰ä¸ªå­é˜¶æ®µï¼š</p><ul><li><strong>éªŒè¯ï¼ˆVerificationï¼‰</strong>: ç¡®ä¿è¢«åŠ è½½çš„ç±»æˆ–æ¥å£çš„äºŒè¿›åˆ¶è¡¨ç¤ºç¬¦åˆJVMè§„èŒƒï¼Œæ²¡æœ‰å®‰å…¨é—®é¢˜ã€‚</li><li><strong>å‡†å¤‡ï¼ˆPreparationï¼‰</strong>: JVMä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®é»˜è®¤åˆå§‹å€¼ï¼Œè¿™äº›å˜é‡æ‰€ä½¿ç”¨çš„å†…å­˜åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œåˆ†é…ã€‚</li><li><strong>è§£æï¼ˆResolutionï¼‰</strong>: JVMå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚</li></ul><ol start="3"><li>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</li></ol><p>åœ¨åˆå§‹åŒ–é˜¶æ®µï¼ŒJVMè´Ÿè´£æ‰§è¡Œç±»æ„é€ å™¨ <code>&lt;clinit&gt;()</code> æ–¹æ³•çš„è¿‡ç¨‹ã€‚<code>&lt;clinit&gt;()</code> æ–¹æ³•ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€ä»£ç å—ï¼ˆstatic{}å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶è€Œæˆã€‚åˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œè¿™äº›åˆå§‹åŒ–è¯­å¥å’Œé™æ€ä»£ç å—çš„è¿‡ç¨‹ã€‚</p><p>ç±»åŠ è½½æœºåˆ¶çš„ç‰¹ç‚¹</p><ul><li><strong>æ‡’åŠ è½½</strong>: ç±»åŠ è½½å™¨é‡‡ç”¨æ‡’åŠ è½½ç­–ç•¥ï¼Œå³å½“é¦–æ¬¡ä½¿ç”¨æŸä¸ªç±»æ—¶æ‰åŠ è½½ã€‚</li><li><strong>ç¼“å­˜æœºåˆ¶</strong>: åŠ è½½çš„ç±»ä¿¡æ¯ä¼šè¢«ç¼“å­˜ï¼ŒåŒä¸€ä¸ªç±»åŠ è½½å™¨ä¸‹ï¼Œä¸€ä¸ªç±»å‹åªä¼šè¢«åŠ è½½ä¸€æ¬¡ã€‚</li></ul><p>ç±»æ¯”</p><p>å¯ä»¥æŠŠç±»åŠ è½½æœºåˆ¶æƒ³è±¡æˆå›¾ä¹¦é¦†çš„å·¥ä½œæµç¨‹ï¼š</p><ul><li><strong>åŠ è½½</strong>: ç±»ä¼¼äºæ ¹æ®ä¹¦åæ‰¾åˆ°ä¹¦ç±çš„è¿‡ç¨‹ã€‚</li><li><strong>é“¾æ¥</strong>: ç±»ä¼¼äºæ£€æŸ¥ä¹¦ç±æ˜¯å¦å®Œæ•´ã€é¡µç æ˜¯å¦æ­£ç¡®ï¼Œå¹¶å‡†å¤‡å¥½æ”¾åˆ°ä¹¦æ¶ä¸Šã€‚</li><li><strong>åˆå§‹åŒ–</strong>: ç±»ä¼¼äºå°†ä¹¦ç±æ”¾åˆ°æŒ‡å®šçš„ä¹¦æ¶ä¸Šï¼Œæ ‡è®°ä¸ºå¯å€Ÿé˜…çŠ¶æ€ã€‚</li></ul><hr><h4 id="åŒäº²å§”æ´¾æ¨¡å‹"><a href="#åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹"></a>åŒäº²å§”æ´¾æ¨¡å‹</h4><p>åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰æ˜¯Javaç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºåŠ è½½ç±»å’Œæ¥å£ã€‚è¿™ä¸ªæ¨¡å‹æ—¨åœ¨æä¾›ä¸€ç§å®‰å…¨æ€§è¾ƒé«˜çš„ç±»åŠ è½½æœºåˆ¶ï¼Œç¡®ä¿Javaæ ¸å¿ƒåº“çš„ç±»å‹å®‰å…¨ï¼Œé¿å…ç±»çš„é‡å¤åŠ è½½ã€‚</p><p>åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œåŸç†</p><ol><li><strong>å§”æ´¾è¿‡ç¨‹</strong>: å½“ä¸€ä¸ªç±»åŠ è½½å™¨å°è¯•åŠ è½½æŸä¸ªç±»æ—¶ï¼Œå®ƒä¸ä¼šç«‹å³å°è¯•åŠ è½½è¿™ä¸ªç±»ã€‚ç›¸åï¼Œå®ƒä¼šé¦–å…ˆå°†åŠ è½½ä»»åŠ¡å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆã€‚</li><li><strong>å‘ä¸Šé€’å½’</strong>: è¿™ä¸ªè¿‡ç¨‹ä¼šé€’å½’å‘ä¸Šè¿›è¡Œï¼Œç›´åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ã€‚</li><li><strong>å°è¯•åŠ è½½</strong>: å¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»çš„åŠ è½½å·¥ä½œï¼Œé‚£ä¹ˆå°±æˆåŠŸè¿”å›ï¼›å¦‚æœçˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½ï¼ˆå› ä¸ºç±»ä¸åœ¨å…¶æœç´¢èŒƒå›´å†…ï¼‰ï¼Œé‚£ä¹ˆå­ç±»åŠ è½½å™¨ä¼šå°è¯•è‡ªå·±å»åŠ è½½è¿™ä¸ªç±»ã€‚</li></ol><p>åŒäº²å§”æ´¾æ¨¡å‹çš„ä¼˜åŠ¿</p><ol><li><strong>é¿å…ç±»çš„é‡å¤åŠ è½½</strong>: ç”±äºåœ¨å‘ä¸Šå§”æ´¾çš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨åœ¨åŠ è½½ç±»æ—¶ä¼šå…ˆæ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡äº†ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…é‡å¤åŠ è½½ã€‚</li><li><strong>ä¿æŠ¤ç¨‹åºå®‰å…¨æ€§</strong>: é˜²æ­¢æ ¸å¿ƒAPIè¢«éšæ„ç¯¡æ”¹ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªåä¸º<code>java.lang.Object</code>çš„ç±»ï¼Œä½†ç³»ç»Ÿç±»åŠ è½½å™¨ä¼šåœ¨ç”¨æˆ·çš„ç±»åŠ è½½å™¨ä¹‹å‰åŠ è½½<code>Object</code>ç±»ï¼Œå› æ­¤ä¸ä¼šåŠ è½½åˆ°ç”¨æˆ·è‡ªå®šä¹‰çš„é‚£ä¸ªç±»ã€‚</li></ol><p>åŒäº²å§”æ´¾æ¨¡å‹çš„ä¾‹å¤–</p><p>å°½ç®¡åŒäº²å§”æ´¾æ¨¡å‹æ˜¯Javaæ¨èçš„ç±»åŠ è½½æœºåˆ¶ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç±»åŠ è½½å™¨å¯èƒ½éœ€è¦è¿åè¿™ä¸ªæ¨¡å‹ã€‚ä¾‹å¦‚ï¼ŒJavaçš„SPI(Service Provider Interface)æœºåˆ¶å…è®¸æœåŠ¡æä¾›è€…åœ¨è¿è¡Œæ—¶è¢«æ’å…¥å’Œæ›¿æ¢ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°ä¸€ç§ä¸åŒäºæ ‡å‡†åŒäº²å§”æ´¾æ¨¡å‹çš„ç±»åŠ è½½æ–¹å¼ã€‚æ­¤å¤–ï¼Œä¸€äº›åº”ç”¨æœåŠ¡å™¨ä¹Ÿä¼šå¯¹Javaçš„åŒäº²å§”æ´¾æ¨¡å‹è¿›è¡Œä¿®æ”¹ä»¥æ»¡è¶³ç‰¹å®šéœ€æ±‚ã€‚</p><p>ç±»æ¯”</p><p>å¯ä»¥å°†åŒäº²å§”æ´¾æ¨¡å‹ç±»æ¯”äºç»„ç»‡ä¸­çš„ä»»åŠ¡å§”æ‰˜è¿‡ç¨‹ã€‚å½“ä¸€ä¸ªä»»åŠ¡åˆ°æ¥æ—¶ï¼Œå‘˜å·¥ä¼šå…ˆä¸ŠæŠ¥ç»™è‡ªå·±çš„ç›´æ¥ä¸Šå¸ï¼Œä¸Šå¸å†ä¸ŠæŠ¥ç»™æ›´é«˜å±‚çš„ç®¡ç†è€…ã€‚ç®¡ç†è€…å±‚å±‚å®¡æ‰¹ï¼Œå¦‚æœä¸Šå±‚å¯ä»¥å¤„ç†è¿™ä¸ªä»»åŠ¡ï¼Œå°±ä¸å†å¾€ä¸‹ä¼ é€’ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä»»åŠ¡å¤„ç†çš„æ­£ç¡®æ€§å’Œæƒå¨æ€§ï¼ŒåŒæ—¶é¿å…é‡å¤å¤„ç†åŒä¸€ä¸ªä»»åŠ¡ã€‚</p><hr><h4 id="æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶"><a href="#æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶"></a>æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶</h4><p>æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶é€šå¸¸æ¶‰åŠè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå¹¶é‡å†™å…¶<code>loadClass</code>æ–¹æ³•çš„è¡Œä¸ºã€‚è¿™é€šå¸¸æ˜¯å‡ºäºå¯¹ç‰¹å®šç¯å¢ƒçš„ç‰¹æ®Šéœ€æ±‚ï¼Œæ¯”å¦‚åœ¨å®¹å™¨ä¸­éš”ç¦»åº”ç”¨ç¨‹åºã€çƒ­éƒ¨ç½²ã€æ’ä»¶åŠ è½½ç­‰ã€‚</p><p>æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„æ–¹æ³•</p><p>è¦æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å¹¶é‡å†™<code>loadClass</code>æ–¹æ³•æ¥å®ç°ï¼š</p><ol><li><strong>åˆ›å»ºè‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong>ï¼šç»§æ‰¿<code>ClassLoader</code>ç±»ã€‚</li><li><strong>é‡å†™<code>loadClass</code>æ–¹æ³•</strong>ï¼šåœ¨è‡ªå®šä¹‰çš„<code>loadClass</code>æ–¹æ³•ä¸­ï¼Œå¯ä»¥å…ˆå°è¯•è‡ªå·±åŠ è½½ç±»ï¼Œå¦‚æœä¸æˆåŠŸï¼Œå†æ ¹æ®éœ€è¦é€‰æ‹©æ˜¯å¦å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨ã€‚</li></ol><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ClassLoader</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    public <span class="hljs-type">Class</span>&lt;?&gt; loadClass(<span class="hljs-type">String</span> name) <span class="hljs-keyword">throws</span> <span class="hljs-type">ClassNotFoundException</span> &#123;<br>        <span class="hljs-comment">// é¦–å…ˆ, æ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½</span><br>        <span class="hljs-type">Class</span>&lt;?&gt; loadedClass = findLoadedClass(name);<br>        <span class="hljs-keyword">if</span> (loadedClass == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// å°è¯•è‡ªå·±åŠ è½½ç±»</span><br>                loadedClass = findClass(name);<br>            &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-type">ClassNotFoundException</span> e) &#123;<br>                <span class="hljs-comment">// å¦‚æœè‡ªå·±æ— æ³•åŠ è½½, åˆ™å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨</span><br>                loadedClass = <span class="hljs-keyword">super</span>.loadClass(name, <span class="hljs-literal">false</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> loadedClass;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">Class</span>&lt;?&gt; findClass(<span class="hljs-type">String</span> name) <span class="hljs-keyword">throws</span> <span class="hljs-type">ClassNotFoundException</span> &#123;<br>        <span class="hljs-comment">// å®ç°è‡ªå·±çš„åŠ è½½é€»è¾‘</span><br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒäº²å§”æ´¾æœºåˆ¶çš„è®¾è®¡ç†å¿µ</p><p>åŒäº²å§”æ´¾æœºåˆ¶çš„è®¾è®¡ä¸»è¦åŸºäºä»¥ä¸‹å‡ ä¸ªç›®çš„ï¼š</p><ol><li><strong>å®‰å…¨æ€§</strong>ï¼šé˜²æ­¢æ ¸å¿ƒAPIè¢«éšæ„ç¯¡æ”¹ã€‚ä¾‹å¦‚ï¼Œé˜²æ­¢ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»æ›¿æ¢æ‰æ ¸å¿ƒçš„ç±»ï¼Œå¦‚<code>java.lang.Object</code>ã€‚</li><li><strong>é¿å…ç±»çš„é‡å¤åŠ è½½</strong>ï¼šå½“çˆ¶åŠ è½½å™¨å·²ç»åŠ è½½äº†è¯¥ç±»æ—¶ï¼Œå°±æ²¡æœ‰å¿…è¦å­åŠ è½½å™¨å†é‡æ–°åŠ è½½ä¸€æ¬¡ã€‚</li><li><strong>ä¿æŒå‘½åç©ºé—´çš„æ¸…æ™°</strong>ï¼šé€šè¿‡è¯¥æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿åœ¨ä¸åŒçš„ç±»åŠ è½½å™¨ä¸­åŠ è½½çš„ç±»èƒ½å¤Ÿç›¸äº’ä¸è§ï¼Œé¿å…ä¸åŒç±»åŠ è½½å™¨åŠ è½½ç›¸åŒå…¨åç±»è€Œå¼•èµ·çš„å†²çªã€‚</li></ol><p>æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶çš„ç†ç”±</p><p>å°½ç®¡åŒäº²å§”æ´¾æœºåˆ¶åœ¨å¤šæ•°æƒ…å†µä¸‹æ˜¯åˆç†çš„ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½éœ€è¦æ‰“ç ´è¿™ä¸€æœºåˆ¶ï¼š</p><ol><li><strong>éš”ç¦»åŠ è½½</strong>ï¼šåœ¨å®¹å™¨åŒ–çš„ç¯å¢ƒä¸­ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªJVMä¸­è¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„åŒä¸€åº“ã€‚</li><li><strong>çƒ­æ›¿æ¢å’Œçƒ­éƒ¨ç½²</strong>ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ–è€…æŸäº›åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½éœ€è¦é‡æ–°åŠ è½½ä¿®æ”¹è¿‡çš„ç±»ï¼Œä»¥å®ç°ä¸é‡å¯åº”ç”¨ç¨‹åºçš„æ›´æ–°ã€‚</li><li><strong>æ’ä»¶åŒ–æ¶æ„</strong>ï¼šåº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦åŠ è½½æ‰©å±•æˆ–æ’ä»¶ï¼Œè¿™äº›æ’ä»¶ä¸åº”ç”¨ç¨‹åºçš„ç±»åŠ è½½å™¨ç›¸ç‹¬ç«‹ã€‚</li></ol><p>åœ¨è®¾è®¡è‡ªå®šä¹‰ç±»åŠ è½½å™¨å’Œè€ƒè™‘æ˜¯å¦æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹æ—¶ï¼Œéœ€è¦ä»”ç»†æƒè¡¡å®‰å…¨æ€§ã€éš”ç¦»æ€§ä»¥åŠåŠ¨æ€åŠ è½½çš„éœ€æ±‚ã€‚</p><hr><blockquote><p>ä»€ä¹ˆæ˜¯ç±»åŠ è½½æœºåˆ¶ï¼Œè®²ä¸€ä¸‹åŒäº²å§”æ´¾æœºåˆ¶ï¼Œä¸ºä»€ä¹ˆæœ‰æ—¶å€™è¦æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œæ€ä¹ˆæ‰“ç ´ã€‚</p></blockquote><p>ç±»åŠ è½½æœºåˆ¶æ˜¯ JVM çš„ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œä»–èƒ½å¤Ÿå°†ç±»å’Œæ¥å£åŠ è½½ï¼›</p><p>ç±»åŠ è½½ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯ï¼šåŠ è½½ã€è¿æ¥å’Œåˆå§‹åŒ–ï¼›</p><p>åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µä¸­ï¼ŒJVM ä¼šé€šè¿‡ç±»åŠ è½½å™¨å°† .class æ–‡ä»¶è¿›è¡Œè¯»å–äºŒè¿›åˆ¶æ•°æ®å¹¶è½¬æ¢ä¸º Class å®ä¾‹ï¼›</p><p>å…¶ä¸­ç±»åŠ è½½å™¨ä¸»è¦åˆ†ä¸ºï¼šå¼•å¯¼ç±»åŠ è½½å™¨ Bootstrap ClassLoader ã€æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoaderã€ç³»ç»Ÿç±»åŠ è½½å™¨  System ClassLoader</p><p>åœ¨ç¬¬äºŒä¸ªé˜¶æ®µä¸­ï¼Œè¿æ¥ä¼šå°†åŠ è½½çš„ç±»æˆ–è€…æ¥å£çš„äºŒè¿›åˆ¶æ•°æ®åˆå¹¶åˆ° JVM çš„è¿è¡ŒçŠ¶æ€ä¸­ã€‚</p><p>åŒæ—¶è¿æ¥åˆåˆ†ä¸ºä¸‰ä¸ªå­é˜¶æ®µï¼Œåˆ†åˆ«æ˜¯ï¼šéªŒè¯ã€å‡†å¤‡ã€è§£æã€‚</p><p>åœ¨ç¬¬ä¸‰ä¸ªé˜¶æ®µä¸­ï¼Œåˆå§‹åŒ–ä¼šæ‰§è¡Œç±»æ„é€ å™¨æ–¹æ³•ï¼Œå³æ‰§è¡Œåˆå§‹åŒ–è¯­å¥å’Œé™æ€ä»£ç å—çš„è¿‡ç¨‹ã€‚</p><p>åŒäº²å§”æ´¾æœºåˆ¶æ˜¯ç±»åŠ è½½å™¨ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºåŠ è½½ç±»å’Œæ¥å£ã€‚ä»–çš„ä¸€ä¸ªæ ¸å¿ƒè¿‡ç¨‹æ˜¯é€šè¿‡å‘ä¸Šé€’å½’çš„æ“ä½œï¼Œå­åŠ è½½å™¨ä¼šå…ˆå§”æ´¾ä»»åŠ¡ç»™çˆ¶åŠ è½½å™¨ï¼Œç›´åˆ°é¡¶å±‚çš„ç±»åŠ è½½å™¨ Bootstrap ClassLoader ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½ï¼Œé‚£ä¹ˆæ­¤æ—¶å­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½è¿™ä¸ªç±»ã€‚<br>è¿™ç§æ“ä½œå¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½å’Œé˜²æ­¢æ ¸å¿ƒAPIè¢«éšæ„ç¯¡æ”¹ã€‚</p><p>æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶é€šå¸¸æ˜¯éœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å¹¶é‡å†™ <code>loadClass</code> æ–¹æ³•æ¥å®ç°ã€‚</p><h3 id="3ã€JVMçš„ç»“æ„ä½“ç³»"><a href="#3ã€JVMçš„ç»“æ„ä½“ç³»" class="headerlink" title="3ã€JVMçš„ç»“æ„ä½“ç³»"></a>3ã€JVMçš„ç»“æ„ä½“ç³»</h3><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231116235359.png" alt="image.png"></p><p>Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œ Java ç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒç®¡ç†çš„å†…å­˜åˆ’åˆ†æˆè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚</p><blockquote><p>è¿è¡Œæ—¶æ•°æ®åŒºæ ¹æ®çº¿ç¨‹æ˜¯å¦ç§æœ‰æˆ–è€…å…±äº«è¿›è¡ŒåŒºåˆ†</p></blockquote><p><strong>çº¿ç¨‹ç§æœ‰çš„ï¼š</strong></p><ul><li>ç¨‹åºè®¡æ•°å™¨</li><li>è™šæ‹Ÿæœºæ ˆ</li><li>æœ¬åœ°æ–¹æ³•æ ˆ</li></ul><p><strong>çº¿ç¨‹å…±äº«çš„ï¼š</strong></p><ul><li>å †</li><li>æ–¹æ³•åŒº</li><li>ç›´æ¥å†…å­˜ (éè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†)</li></ul><p>Java è™šæ‹Ÿæœºè§„èŒƒå¯¹äºè¿è¡Œæ—¶æ•°æ®åŒºåŸŸçš„è§„å®šæ˜¯ç›¸å½“å®½æ¾çš„ã€‚ä»¥å †ä¸ºä¾‹ï¼šå †å¯ä»¥æ˜¯è¿ç»­ç©ºé—´ï¼Œä¹Ÿå¯ä»¥ä¸è¿ç»­ã€‚å †çš„å¤§å°å¯ä»¥å›ºå®šï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶æŒ‰éœ€æ‰©å±• ã€‚è™šæ‹Ÿæœºå®ç°è€…å¯ä»¥ä½¿ç”¨ä»»ä½•åƒåœ¾å›æ”¶ç®—æ³•ç®¡ç†å †ï¼Œç”šè‡³å®Œå…¨ä¸è¿›è¡Œåƒåœ¾æ”¶é›†ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>ç›´æ¥å†…å­˜ï¼ˆJava7çš„æ°¸ä¹…ä»£æˆ–JDK8çš„å…ƒç©ºé—´ã€ä»£ç ç¼“å­˜ï¼‰</p><blockquote><p>JDK 1.8 å’Œä¹‹å‰çš„ç‰ˆæœ¬ç•¥æœ‰ä¸åŒï¼Œæˆ‘ä»¬è¿™é‡Œä»¥ JDK 1.7 å’Œ JDK 1.8 è¿™ä¸¤ä¸ªç‰ˆæœ¬ä¸ºä¾‹ä»‹ç»ã€‚</p></blockquote><p>1.8ä¹‹å‰ç‰ˆæœ¬</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231117000248.png" alt="image.png|600"></p><p>JVM1.8ä¹‹åç‰ˆæœ¬</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231117000319.png" alt="image.png|600"></p><p>1.8ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œçº¿ç¨‹å…±äº«ä¸ºä¸¤ä¸ªåŒºåŸŸï¼šå †ä¸æ–¹æ³•åŒºï¼›å…¶ä¸­æ–¹æ³•åŒºåªæ˜¯JVMè™šæ‹Ÿæœºè§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œä¸æ˜¯å®é™…çš„å®ç°ï¼›</p><p>ç›´æ¥å†…å­˜ï¼šæ˜¯JVMä»¥å¤–çš„æœ¬åœ°å†…å­˜ï¼›</p><p><strong>ç‰ˆæœ¬åŒºåˆ«ä»‹ç»</strong></p><ul><li>åŒºåˆ«ä¸€ï¼ˆæ–¹æ³•åŒºï¼‰<ul><li>1.8ç‰ˆæœ¬ä¹‹åï¼Œä½¿ç”¨å…ƒæ•°æ®åŒºå®ç°äº†æ–¹æ³•åŒºï¼Œä¹‹å‰æ˜¯ä½¿ç”¨æ°¸ä¹…ä»£æ¥å®ç°æ–¹æ³•åŒºï¼Œå¤§å°æ˜¯å¯åŠ¨æ—¶å›ºå®šå¥½çš„ï¼›</li><li>å…ƒç©ºé—´ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œå¹¶ä¸”å¤§å°å¯ä»¥è‡ªåŠ¨å¢é•¿ï¼Œå‡å°‘äº†OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰çš„å‡ ç‡ï¼›</li></ul></li><li>åŒºåˆ«äºŒï¼ˆå †åŒºï¼‰<ul><li>Java7ä¹‹åè¿è¡Œæ—¶å¸¸é‡æ± ä»æ–¹æ³•åŒºç§»åˆ°äº†è¿™é‡Œï¼Œä¸ºJava8ç§»å‡ºæ°¸ä¹…ä»£åšå¥½å‡†å¤‡ï¼›</li></ul></li></ul><h3 id="4ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"><a href="#4ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ" class="headerlink" title="4ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"></a>4ã€è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h3><h4 id="1-ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram-Counter-Registerï¼‰"><a href="#1-ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram-Counter-Registerï¼‰" class="headerlink" title="1. ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰"></a>1. ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</h4><ul><li><strong>æè¿°</strong>: ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å°å—å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚</li><li><strong>ä½œç”¨</strong>: <strong>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„</strong>ã€‚å®ƒçš„ä½œç”¨æ˜¯è®°ä½ä¸‹ä¸€æ¡JVMæŒ‡ä»¤çš„æ‰§è¡Œä½ç½®ï¼Œå¦‚æœæ˜¯æ‰§è¡ŒJavaæ–¹æ³•ï¼Œåˆ™è®°å½•å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœæ˜¯æ‰§è¡Œæœ¬åœ°æ–¹æ³•ï¼Œåˆ™ä¸ºç©ºï¼ˆUndefinedï¼‰ã€‚</li><li><strong>ç‰¹ç‚¹</strong>: ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼é—®é¢˜ï¼Œæ˜¯å”¯ä¸€ä¸€ä¸ªæ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚</li></ul><h4 id="2-è™šæ‹Ÿæœºæ ˆï¼ˆVM-Stacksï¼‰"><a href="#2-è™šæ‹Ÿæœºæ ˆï¼ˆVM-Stacksï¼‰" class="headerlink" title="2. è™šæ‹Ÿæœºæ ˆï¼ˆVM Stacksï¼‰"></a>2. è™šæ‹Ÿæœºæ ˆï¼ˆVM Stacksï¼‰</h4><ul><li><strong>æè¿°</strong>: è™šæ‹Ÿæœºæ ˆæ˜¯æè¿°Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚</li><li><strong>ä½œç”¨</strong>: æ¯ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚</li><li><strong>ç‰¹ç‚¹</strong>: ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒã€‚å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowErrorï¼›å¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå¦‚æœæ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¼šæŠ›å‡ºOutOfMemoryErrorã€‚</li></ul><h4 id="3-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stacksï¼‰"><a href="#3-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stacksï¼‰" class="headerlink" title="3. æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stacksï¼‰"></a>3. æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stacksï¼‰</h4><ul><li><strong>æè¿°</strong>: æœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆå‘æŒ¥çš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºæ‰§è¡ŒJavaæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å­—èŠ‚ç ï¼‰æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ã€‚</li><li><strong>ç‰¹ç‚¹</strong>: å’Œè™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯å’Œçº¿ç¨‹ç›¸åŒï¼Œå—åˆ°æœ¬åœ°æ–¹æ³•æ ˆå¤§å°çš„é™åˆ¶ï¼Œä¹Ÿå¯èƒ½æŠ›å‡ºStackOverflowErrorå’ŒOutOfMemoryErrorã€‚</li></ul><h4 id="4-å †ï¼ˆHeapï¼‰"><a href="#4-å †ï¼ˆHeapï¼‰" class="headerlink" title="4. å †ï¼ˆHeapï¼‰"></a>4. å †ï¼ˆHeapï¼‰</h4><ul><li><strong>æè¿°</strong>: å †æ˜¯Javaè™šæ‹Ÿæœºç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜åŒºåŸŸï¼Œå®ƒè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚</li><li><strong>ä½œç”¨</strong>: å®ƒçš„ä¸»è¦ç›®çš„æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚</li><li><strong>ç‰¹ç‚¹</strong>: å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œâ€œGCå †â€ã€‚å¦‚æœå †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‰©å±•æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorã€‚</li></ul><h4 id="5-æ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰"><a href="#5-æ–¹æ³•åŒºï¼ˆMethod-Areaï¼‰" class="headerlink" title="5. æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰"></a>5. æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</h4><ul><li><strong>æè¿°</strong>: æ–¹æ³•åŒºä¸Javaå †ä¸€æ ·ï¼Œæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸã€‚å®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ã€‚</li><li><strong>ä½œç”¨</strong>: å­˜å‚¨æ¯ä¸€ä¸ªç±»çš„ç»“æ„ä¿¡æ¯ï¼Œä¾‹å¦‚è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰ã€å­—æ®µå’Œæ–¹æ³•æ•°æ®ã€æ„é€ å‡½æ•°å’Œæ™®é€šæ–¹æ³•çš„å­—èŠ‚ç å†…å®¹ã€‚</li><li><strong>ç‰¹ç‚¹</strong>: æ–¹æ³•åŒºä¹Ÿè¢«ç§°ä¸ºæ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ï¼Œä½†ä»JDK 1.8å¼€å§‹ï¼Œå·²ç»è¢«å…ƒç©ºé—´ï¼ˆMetaSpaceï¼‰æ‰€å–ä»£ã€‚å¦‚æœæ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorã€‚</li></ul><p>è¿™äº›åŒºåŸŸå„æœ‰å…¶ç‰¹å®šçš„ç”¨é€”ï¼Œå®ƒä»¬å…±åŒå·¥ä½œä»¥æ”¯æŒJVMçš„è¿è¡Œã€‚ç†è§£è¿™äº›åŒºåŸŸå¦‚ä½•äº¤äº’å’Œç®¡ç†å†…å­˜ï¼Œæ˜¯æ·±å…¥ç†è§£Javaè¿è¡Œæ—¶ç¯å¢ƒçš„å…³é”®ã€‚</p><blockquote><p>ç±»æ¯”</p></blockquote><p>å¯ä»¥å°†JVMçš„è¿è¡Œæ—¶æ•°æ®åŒºæƒ³è±¡æˆä¸€å®¶å·¥å‚ï¼š</p><ul><li><strong>ç¨‹åºè®¡æ•°å™¨</strong>: å·¥å‚ä¸­çš„ä»»åŠ¡åˆ—è¡¨ï¼Œè®°å½•ä¸‹ä¸€ä¸ªä»»åŠ¡çš„ä½ç½®ã€‚</li><li><strong>è™šæ‹Ÿæœºæ ˆ</strong>: å·¥äººçš„å·¥ä½œå°ï¼Œæ¯å½“å¼€å§‹ä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œå°±ä¼šåœ¨å·¥ä½œå°ä¸Šå‡†å¤‡ç›¸åº”çš„ææ–™å’Œå·¥å…·ã€‚</li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>: ç‰¹æ®Šä»»åŠ¡çš„å·¥ä½œå°ï¼Œç”¨äºå¤„ç†ä¸€äº›éæ ‡å‡†çš„ä»»åŠ¡ã€‚</li><li><strong>å †</strong>: ææ–™ä»“åº“ï¼Œå­˜æ”¾æ‰€æœ‰éœ€è¦çš„ææ–™ã€‚</li><li><strong>æ–¹æ³•åŒº</strong>: è®¾è®¡å›¾çº¸å­˜æ”¾åŒºï¼Œå­˜æ”¾äº§å“è®¾è®¡å›¾çº¸å’Œåˆ¶é€ æŒ‡å¯¼ã€‚</li></ul><hr><blockquote><p>JVM çš„è¿è¡Œæ—¶æ•°æ®åŒºåŒºåŸŸæœ‰å“ªäº›ã€‚</p></blockquote><p>JVM å°† .class æ–‡ä»¶è¿›è¡Œç±»åŠ è½½åï¼Œæ•°æ®ä¼šåˆ°è¾¾ è¿è¡Œæ—¶æ•°æ®åŒºã€‚</p><p>åŒºåŸŸä¸»è¦åŒ…æ‹¬ï¼šå †ï¼ˆHeapï¼‰ã€æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ã€è™šæ‹Ÿæœºæ ˆï¼ˆVM Stacksï¼‰ã€æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stacksï¼‰å’Œç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</p><p>åŒºåˆ†å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªï¼š [[JVMå…¥é—¨_åŸºç¡€æ¦‚å¿µ#3ã€JVMçš„ç»“æ„ä½“ç³»]]</p><h3 id="5ã€åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#5ã€åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="5ã€åƒåœ¾å›æ”¶æœºåˆ¶"></a>5ã€åƒåœ¾å›æ”¶æœºåˆ¶</h3><p>Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰çš„åƒåœ¾å›æ”¶æœºåˆ¶æ˜¯ä¸€ç§è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿï¼Œå®ƒæ—¨åœ¨å¸®åŠ©å¼€å‘è€…ç®¡ç†åº”ç”¨ç¨‹åºä½¿ç”¨çš„å†…å­˜ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯è‡ªåŠ¨å‘ç°å¹¶é‡Šæ”¾é‚£äº›ä¸å†è¢«åº”ç”¨ç¨‹åºä½¿ç”¨çš„å†…å­˜åŒºåŸŸï¼Œä»è€Œé¿å…å†…å­˜æ³„éœ²å’Œè¿‡åº¦çš„å†…å­˜æ¶ˆè€—ã€‚</p><h4 id="1-åƒåœ¾å›æ”¶çš„åŸºæœ¬åŸç†"><a href="#1-åƒåœ¾å›æ”¶çš„åŸºæœ¬åŸç†" class="headerlink" title="1. åƒåœ¾å›æ”¶çš„åŸºæœ¬åŸç†"></a>1. åƒåœ¾å›æ”¶çš„åŸºæœ¬åŸç†</h4><p>åƒåœ¾å›æ”¶çš„åŸºæœ¬åŸç†æ˜¯ç¡®å®šå“ªäº›å†…å­˜æ˜¯å¯è¾¾çš„ï¼Œå³åœ¨ç¨‹åºçš„å½“å‰çŠ¶æ€ä¸‹ï¼Œå“ªäº›å†…å­˜ä»ç„¶å¯ä»¥è¢«ç¨‹åºè®¿é—®ã€‚</p><p>å†…å­˜åˆ†é…ç»™å¯¹è±¡æ—¶ï¼Œå¦‚æœè¯¥å¯¹è±¡å¯è¾¾ï¼Œå®ƒå°±ä¼šç»§ç»­å ç”¨å†…å­˜ï¼›å¦‚æœå¯¹è±¡ä¸å¯è¾¾ï¼Œé‚£ä¹ˆå®ƒå ç”¨çš„å†…å­˜å°±å¯ä»¥è¢«è§†ä¸ºåƒåœ¾ï¼Œå¹¶ç”±åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚</p><h4 id="2-åˆ¤å®šå¯¹è±¡å­˜æ´»çš„æ–¹æ³•"><a href="#2-åˆ¤å®šå¯¹è±¡å­˜æ´»çš„æ–¹æ³•" class="headerlink" title="2. åˆ¤å®šå¯¹è±¡å­˜æ´»çš„æ–¹æ³•"></a>2. åˆ¤å®šå¯¹è±¡å­˜æ´»çš„æ–¹æ³•</h4><ul><li><strong>å¼•ç”¨è®¡æ•°æ³•</strong>: æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å°±åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å°±å‡1ã€‚ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡éƒ½æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚ä½†è¿™ç§æ–¹æ³•æ— æ³•è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</li><li><strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>ï¼ˆæ›´å¸¸ç”¨ï¼‰: è¿™ç§ç®—æ³•é€šè¿‡ä¸€ç³»åˆ—ç§°ä¸ºâ€œæ ¹â€çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°æ ¹èŠ‚ç‚¹æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚</li></ul><h5 id="JVMåˆ†ä»£å¹´é¾„ä¸ºä»€ä¹ˆæ˜¯15"><a href="#JVMåˆ†ä»£å¹´é¾„ä¸ºä»€ä¹ˆæ˜¯15" class="headerlink" title="JVMåˆ†ä»£å¹´é¾„ä¸ºä»€ä¹ˆæ˜¯15"></a>JVMåˆ†ä»£å¹´é¾„ä¸ºä»€ä¹ˆæ˜¯15</h5><p>åœ¨Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰çš„åˆ†ä»£åƒåœ¾å›æ”¶æœºåˆ¶ä¸­ï¼Œâ€åˆ†ä»£å¹´é¾„â€æŒ‡çš„æ˜¯ä¸€ä¸ªå¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ç»è¿‡å¤šå°‘æ¬¡åƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰ä¹‹åè¿˜å­˜æ´»çš„è®¡æ•°ã€‚</p><p>å½“å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°ä¸€å®šçš„é˜ˆå€¼æ—¶ï¼Œå®ƒå°±ä¼šä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ã€‚è¿™ä¸ªé˜ˆå€¼è¢«ç§°ä¸ºæ™‹å‡å¹´é¾„ï¼ˆPromotion Ageï¼‰ï¼Œé»˜è®¤å€¼é€šå¸¸æ˜¯15ã€‚</p><p>é»˜è®¤å€¼15æ˜¯JVMè®¾è®¡è€…æ ¹æ®ç»éªŒè®¾ç½®çš„ï¼Œç›®çš„æ˜¯åœ¨å†…å­˜å ç”¨å’Œåƒåœ¾å›æ”¶æˆæœ¬ä¹‹é—´å¯»æ±‚å¹³è¡¡ã€‚</p><blockquote><p>JVMåˆ†ä»£å¹´é¾„çš„æœ€å¤§å€¼</p></blockquote><p>JVMåˆ†ä»£å¹´é¾„çš„æœ€å¤§å€¼ æ˜¯ 15.</p><p>ä¸€ä¸ªå¯¹è±¡çš„GCå¹´é¾„ï¼Œæ˜¯å­˜å‚¨åœ¨å¯¹è±¡å¤´é‡Œé¢çš„ï¼Œä¸€ä¸ªJavaå¯¹è±¡åœ¨JVMå†…å­˜ä¸­çš„å¸ƒå±€ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯å¯¹è±¡å¤´ï¼Œå®ä¾‹æ•°æ®ï¼Œå¯¹é½å¡«å……ã€‚è€Œå¯¹è±¡å¤´(Mark Word)é‡Œé¢æœ‰4ä¸ªbitä½æ¥å­˜å‚¨GCå¹´é¾„ã€‚è€Œ4ä¸ªbitä½èƒ½å¤Ÿå­˜å‚¨çš„æœ€å¤§æ•°å€¼æ˜¯1111(åè¿›åˆ¶å°±æ˜¯15)ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401231135898.png" alt="image.png"></p><h4 id="3-åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#3-åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="3. åƒåœ¾æ”¶é›†ç®—æ³•"></a>3. åƒåœ¾æ”¶é›†ç®—æ³•</h4><ul><li><strong>æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</strong>: é¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚</li><li><strong>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</strong>: å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚</li><li><strong>æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰</strong>: ç±»ä¼¼äºæ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œä½†åœ¨å®Œæˆæ ‡è®°åï¼Œå®ƒä¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</li><li><strong>åˆ†ä»£æ”¶é›†ç®—æ³•ï¼ˆGenerational Collectionï¼‰</strong>: å°†å †å†…å­˜åˆ†ä¸ºå‡ ä¸ªåŒºåŸŸï¼ˆå¦‚å¹´è½»ä»£ã€è€å¹´ä»£ï¼‰ï¼Œæ ¹æ®å„ä¸ªå¹´é¾„æ®µçš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚</li></ul><blockquote><p>ç±»æ¯”</p></blockquote><p>å¯ä»¥å°†åƒåœ¾å›æ”¶æ¯”ä½œæ˜¯æ¸…æ´å·¥äººåœ¨åŸå¸‚ä¸­æ”¶é›†åƒåœ¾çš„è¿‡ç¨‹ï¼š</p><ul><li><strong>å¯è¾¾æ€§åˆ†æ</strong>å°±åƒæ˜¯ç¡®å®šå“ªäº›åƒåœ¾æ¡¶æ˜¯ç©ºçš„ï¼Œå“ªäº›æ˜¯æ»¡çš„ã€‚</li><li><strong>æ ‡è®°-æ¸…é™¤</strong>å°±åƒæ˜¯æ ‡è®°å‡ºæ‰€æœ‰æ»¡çš„åƒåœ¾æ¡¶ï¼Œç„¶åä¸€ä¸€æ¸…ç©ºã€‚</li><li><strong>å¤åˆ¶ç®—æ³•</strong>å°±åƒæ˜¯å°†åŠæ»¡çš„åƒåœ¾æ¡¶çš„å†…å®¹è½¬ç§»åˆ°ä¸€ä¸ªç©ºçš„åƒåœ¾æ¡¶ä¸­ï¼Œç„¶åæ¸…ç†åŸæ¥çš„åƒåœ¾æ¡¶ã€‚</li><li><strong>æ ‡è®°-æ•´ç†</strong>å°±åƒæ˜¯å°†æ‰€æœ‰çš„åƒåœ¾é›†ä¸­åˆ°åƒåœ¾åœºçš„ä¸€è§’ï¼Œç„¶åæ¸…ç†æ‰å…¶ä½™çš„ç©ºé—´ã€‚</li></ul><h4 id="4-JVMä¸­çš„åƒåœ¾æ”¶é›†å™¨"><a href="#4-JVMä¸­çš„åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="4. JVMä¸­çš„åƒåœ¾æ”¶é›†å™¨"></a>4. JVMä¸­çš„åƒåœ¾æ”¶é›†å™¨</h4><p>JVMæä¾›äº†å¤šç§åƒåœ¾æ”¶é›†å™¨ï¼Œæ¯ç§æ”¶é›†å™¨éƒ½æœ‰å„è‡ªçš„ä¼˜åŠ¿ï¼Œé€‚ç”¨äºä¸åŒç±»å‹å’Œæ€§èƒ½è¦æ±‚çš„åº”ç”¨åœºæ™¯ã€‚<strong>å¸¸è§çš„</strong>åƒåœ¾æ”¶é›†å™¨åŒ…æ‹¬ï¼š</p><ul><li><strong>Serial GC</strong>: å•çº¿ç¨‹æ‰§è¡Œï¼Œé€‚åˆå•æ ¸å¤„ç†å™¨ã€‚</li><li><strong>Parallel GC</strong>: å¤šçº¿ç¨‹æ‰§è¡Œï¼Œå…³æ³¨ååé‡ã€‚</li><li><strong>CMS (Concurrent Mark Sweep) GC</strong>: å…³æ³¨æœ€çŸ­åœé¡¿æ—¶é—´ã€‚</li><li><strong>G1 GC</strong>: é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œå°†å †å†…å­˜åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œå¹¶å¹¶è¡Œæ‰§è¡Œåƒåœ¾å›æ”¶ã€‚</li></ul><p>æ¯ç§åƒåœ¾å›æ”¶å™¨éƒ½æœ‰å…¶ç‰¹å®šçš„ç®—æ³•å’Œè¿è¡Œæœºåˆ¶ï¼Œæ—¨åœ¨ä¼˜åŒ–ä¸åŒçš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚ååé‡ã€æš‚åœæ—¶é—´æˆ–å†…å­˜å ç”¨ã€‚é»˜è®¤åƒåœ¾å›æ”¶å™¨çš„é€‰æ‹©å–å†³äºJVMç‰ˆæœ¬å’Œå…·ä½“çš„é…ç½®å‚æ•°ã€‚</p><h5 id="1-ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼ˆSerial-GCï¼‰"><a href="#1-ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼ˆSerial-GCï¼‰" class="headerlink" title="1. ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼ˆSerial GCï¼‰"></a>1. ä¸²è¡Œåƒåœ¾å›æ”¶å™¨ï¼ˆSerial GCï¼‰</h5><ul><li><strong>è¿è¡Œæœºåˆ¶</strong>ï¼šä¸²è¡Œåƒåœ¾å›æ”¶å™¨ä½¿ç”¨å•ä¸ªçº¿ç¨‹æ‰§è¡Œåƒåœ¾å›æ”¶ã€‚åœ¨æ‰§è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå®ƒä¼šæš‚åœæ‰€æœ‰çš„åº”ç”¨ç¨‹åºçº¿ç¨‹ï¼ˆç§°ä¸ºStop-The-Worldï¼ŒSTWï¼‰ï¼Œç›´åˆ°åƒåœ¾å›æ”¶å®Œæˆã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå°å†…å­˜å’Œå•æ ¸å¤„ç†å™¨çš„ç¯å¢ƒï¼Œæˆ–è€…å¯¹æš‚åœæ—¶é—´ä¸æ•æ„Ÿçš„åº”ç”¨ã€‚</li></ul><h5 id="2-å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼ˆParallel-GCï¼‰"><a href="#2-å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼ˆParallel-GCï¼‰" class="headerlink" title="2. å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼ˆParallel GCï¼‰"></a>2. å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ï¼ˆParallel GCï¼‰</h5><ul><li><strong>è¿è¡Œæœºåˆ¶</strong>ï¼šå¹¶è¡Œåƒåœ¾å›æ”¶å™¨ä½¿ç”¨å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œåƒåœ¾å›æ”¶ä»»åŠ¡ã€‚åœ¨åƒåœ¾å›æ”¶æœŸé—´ï¼Œåº”ç”¨ç¨‹åºçš„æ‰§è¡Œä¹Ÿä¼šæš‚åœã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºéœ€è¦é«˜ååé‡å’Œå¤šæ ¸å¤„ç†å™¨çš„æœåŠ¡å™¨ç¯å¢ƒã€‚å®ƒèƒ½æœ‰æ•ˆåˆ©ç”¨CPUèµ„æºæ¥ç¼©çŸ­åƒåœ¾å›æ”¶çš„æ—¶é—´ã€‚</li></ul><h5 id="3-CMSåƒåœ¾å›æ”¶å™¨ï¼ˆConcurrent-Mark-Sweep-GCï¼‰"><a href="#3-CMSåƒåœ¾å›æ”¶å™¨ï¼ˆConcurrent-Mark-Sweep-GCï¼‰" class="headerlink" title="3. CMSåƒåœ¾å›æ”¶å™¨ï¼ˆConcurrent Mark Sweep GCï¼‰"></a>3. CMSåƒåœ¾å›æ”¶å™¨ï¼ˆConcurrent Mark Sweep GCï¼‰</h5><ul><li><strong>è¿è¡Œæœºåˆ¶</strong>ï¼š<ul><li><strong>åˆå§‹æ ‡è®°ï¼ˆInitial Markï¼‰</strong>ï¼šæ ‡è®°GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œéœ€è¦STWæš‚åœã€‚</li><li><strong>å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰</strong>ï¼šåœ¨åº”ç”¨çº¿ç¨‹è¿è¡Œçš„åŒæ—¶ï¼Œæ ‡è®°GC Rootså¯è¾¾çš„å¯¹è±¡ã€‚</li><li><strong>é‡æ–°æ ‡è®°ï¼ˆRemarkï¼‰</strong>ï¼šä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› åº”ç”¨ç¨‹åºè¿è¡Œè€Œäº§ç”Ÿå˜åŠ¨çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦STWæš‚åœã€‚</li><li><strong>å¹¶å‘æ¸…é™¤ï¼ˆConcurrent Sweepï¼‰</strong>ï¼šæ¸…é™¤ä¸å¯è¾¾çš„å¯¹è±¡ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå¯¹å“åº”æ—¶é—´è¦æ±‚é«˜çš„åº”ç”¨ï¼Œå› ä¸ºå®ƒå‡å°‘äº†åƒåœ¾å›æ”¶æ—¶çš„åœé¡¿æ—¶é—´ã€‚</li></ul><p>CMSï¼ˆConcurrent Mark-Sweepï¼‰åƒåœ¾å›æ”¶å™¨æ˜¯JVMä¸­ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œç‰¹åˆ«é€‚ç”¨äºé‚£äº›å¯¹å“åº”æ—¶é—´æœ‰å¾ˆé«˜è¦æ±‚çš„åœºæ™¯ã€‚CMSåƒåœ¾å›æ”¶å™¨ä¸»è¦ç”¨äºå›æ”¶è€å¹´ä»£ï¼ˆOld Generationï¼‰çš„ç©ºé—´ã€‚</p><p>åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼š</p><blockquote><ol><li>åˆå§‹æ ‡è®°ï¼ˆInitial Markï¼‰</li></ol></blockquote><ul><li><strong>è¿è¡Œæœºåˆ¶</strong>ï¼šè¿™ä¸ªé˜¶æ®µæ ‡è®°æ‰€æœ‰ä¸GC Rootsç›´æ¥ç›¸è¿çš„å¯¹è±¡ã€‚è¿™ä¸€æ­¥éœ€è¦â€Stop-The-Worldâ€ï¼ˆSTWï¼‰ï¼Œæ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹éƒ½ä¼šè¢«æš‚åœï¼Œä½†é€šå¸¸è¿™ä¸ªé˜¶æ®µå¾ˆå¿«ã€‚</li></ul><blockquote><ol start="2"><li>å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markï¼‰</li></ol></blockquote><ul><li><strong>è¿è¡Œæœºåˆ¶</strong>ï¼šåœ¨è¿™ä¸€é˜¶æ®µï¼ŒGCçº¿ç¨‹æ ‡è®°æ‰€æœ‰ä»ç›´æ¥ç›¸è¿çš„å¯¹è±¡å¯è¾¾çš„å¯¹è±¡ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯å¹¶å‘çš„ï¼Œå³åº”ç”¨ç¨‹åºå’Œåƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œä¸éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚</li></ul><blockquote><ol start="3"><li>é‡æ–°æ ‡è®°ï¼ˆRemarkï¼‰</li></ol></blockquote><ul><li><strong>è¿è¡Œæœºåˆ¶</strong>ï¼š<ul><li>ç”±äºåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œåº”ç”¨ç¨‹åºçº¿ç¨‹ä»åœ¨è¿è¡Œï¼Œå¯èƒ½ä¼šæœ‰æ–°çš„å¯¹è±¡è¢«åˆ†é…ï¼Œæˆ–è€…å¯¹è±¡å¼•ç”¨å…³ç³»å‘ç”Ÿå˜åŒ–ã€‚å› æ­¤ï¼Œéœ€è¦ä¸€ä¸ªSTWçš„é˜¶æ®µæ¥ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´çš„å˜åŠ¨ã€‚</li><li>ä¸ºäº†å‡å°‘è¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ï¼ŒCMSä½¿ç”¨äº†ä¸€ç§åä¸ºâ€œå¢é‡æ›´æ–°â€çš„æŠ€æœ¯ï¼ˆCard Markingï¼‰ï¼Œæ¥è®°å½•å¹¶å‘é˜¶æ®µæœŸé—´å¼•ç”¨å…³ç³»çš„å˜åŒ–ã€‚</li><li>æ­¤å¤–ï¼ŒCMSè¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸€ç§åä¸ºâ€œå¿«ç…§ç®—æ³•â€ï¼ˆSnapshot-at-the-beginning, SATBï¼‰æ¥å¤„ç†è¿™äº›å˜åŒ–ã€‚</li></ul></li></ul><blockquote><ol start="4"><li>å¹¶å‘æ¸…é™¤ï¼ˆConcurrent Sweepï¼‰</li></ol></blockquote><ul><li><strong>è¿è¡Œæœºåˆ¶</strong>ï¼šæ­¤é˜¶æ®µå›æ”¶é‚£äº›å·²ç»æ ‡è®°ä¸ºä¸å¯è¾¾çš„å¯¹è±¡å ç”¨çš„ç©ºé—´ã€‚è¿™ä¸€æ­¥æ˜¯å¹¶å‘çš„ï¼Œä¸éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚</li></ul><blockquote><ol start="5"><li>å¹¶å‘é‡ç½®ï¼ˆConcurrent Resetï¼‰</li></ol></blockquote><ul><li><strong>è¿è¡Œæœºåˆ¶</strong>ï¼šè¿™ä¸ªé˜¶æ®µæ˜¯æ¸…ç†å†…éƒ¨æ•°æ®ç»“æ„ï¼Œä¸ºä¸‹ä¸€æ¬¡GCå¾ªç¯åšå‡†å¤‡çš„è¿‡ç¨‹ã€‚è¿™ä¸€æ­¥æ˜¯å¹¶å‘çš„ï¼Œä¸éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚</li></ul><blockquote><p>ç±»æ¯”</p></blockquote><p>å¯ä»¥å°†CMSåƒåœ¾å›æ”¶ç±»æ¯”ä¸ºä¸€ä¸ªæœ‰åºçš„æ¸…æ´å·¥ä½œï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°</strong>å°±åƒæ˜¯ç¡®å®šæ¸…æ´çš„èµ·å§‹ä½ç½®ã€‚</li><li><strong>å¹¶å‘æ ‡è®°</strong>å°±åƒæ˜¯åœ¨æ—¥å¸¸çš„æ¸…æ´è¿‡ç¨‹ä¸­æ ‡è®°å‡ºéœ€è¦æ¸…æ´çš„åŒºåŸŸã€‚</li><li><strong>é‡æ–°æ ‡è®°</strong>å°±åƒæ˜¯åœ¨æ¸…æ´å‰å†æ¬¡æ£€æŸ¥æ ‡è®°çš„åŒºåŸŸï¼Œç¡®ä¿æ²¡æœ‰é—æ¼ã€‚</li><li><strong>å¹¶å‘æ¸…é™¤</strong>åˆ™æ˜¯å®é™…çš„æ¸…æ´è¿‡ç¨‹ã€‚</li><li><strong>å¹¶å‘é‡ç½®</strong>å°±åƒæ˜¯æ¸…ç†å’Œå‡†å¤‡æ¸…æ´å·¥å…·ï¼Œä¸ºä¸‹ä¸€æ¬¡æ¸…æ´åšå‡†å¤‡ã€‚</li></ul><p>CMSåƒåœ¾å›æ”¶å™¨çš„ä¸»è¦ç›®æ ‡æ˜¯<strong>å‡å°‘åƒåœ¾å›æ”¶æ—¶çš„åœé¡¿æ—¶é—´</strong>ï¼Œä»è€Œæé«˜åº”ç”¨ç¨‹åºçš„å“åº”æ€§ã€‚ç„¶è€Œï¼ŒCMSä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚å®ƒå¯¹CPUèµ„æºçš„ä½¿ç”¨è¾ƒå¤šï¼Œä¸”ç”±äºå¹¶å‘æ‰§è¡Œï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤šçš„å†…å­˜ç¢ç‰‡ã€‚</p><h5 id="4-G1åƒåœ¾å›æ”¶å™¨ï¼ˆG1-GCï¼‰"><a href="#4-G1åƒåœ¾å›æ”¶å™¨ï¼ˆG1-GCï¼‰" class="headerlink" title="4. G1åƒåœ¾å›æ”¶å™¨ï¼ˆG1 GCï¼‰"></a>4. G1åƒåœ¾å›æ”¶å™¨ï¼ˆG1 GCï¼‰</h5><ul><li><strong>è¿è¡Œæœºåˆ¶</strong>ï¼šG1åƒåœ¾å›æ”¶å™¨å°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œå¹¶æ ¹æ®æ¯ä¸ªåŒºåŸŸçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬æ¥ä¼˜å…ˆå›æ”¶ï¼Œç›®çš„æ˜¯åœ¨æœ‰é™çš„åœé¡¿æ—¶é—´å†…å›æ”¶å°½å¯èƒ½å¤šçš„å†…å­˜ã€‚</li><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºå¤§å†…å­˜ç¯å¢ƒï¼Œå¹¶ä¸”éœ€è¦æ›´å¯æ§çš„åƒåœ¾å›æ”¶æš‚åœæ—¶é—´ã€‚</li></ul><blockquote><p>é»˜è®¤çš„åƒåœ¾å›æ”¶å™¨</p></blockquote><p>é»˜è®¤çš„åƒåœ¾å›æ”¶å™¨å–å†³äºJVMç‰ˆæœ¬å’ŒJVMå‚æ•°ã€‚ä¾‹å¦‚ï¼Œåœ¨è¾ƒæ–°çš„Javaç‰ˆæœ¬ä¸­ï¼ˆå¦‚Java 9åŠä¹‹åï¼‰ï¼Œé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨å¯èƒ½æ˜¯G1 GCã€‚</p><blockquote><p>é€‰æ‹©ä¸åŒåƒåœ¾å›æ”¶å™¨çš„æƒ…å†µ</p></blockquote><p>ä¸åŒçš„åƒåœ¾å›æ”¶å™¨é€‚ç”¨äºä¸åŒçš„åœºæ™¯å’Œéœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯é€‰æ‹©ä¸åŒåƒåœ¾å›æ”¶å™¨çš„ä¸€äº›æƒ…å†µï¼š</p><ul><li><strong>å¯¹æš‚åœæ—¶é—´è¦æ±‚ä¸¥æ ¼</strong>ï¼šå¦‚æœéœ€è¦å‡å°‘åƒåœ¾å›æ”¶æœŸé—´çš„åœé¡¿æ—¶é—´ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨CMSæˆ–G1ã€‚</li><li><strong>éœ€è¦æœ€å¤§åŒ–ååé‡</strong>ï¼šå¦‚æœåº”ç”¨éœ€è¦æœ€å¤§åŒ–CPUæ—¶é—´ç”¨äºæ‰§è¡Œåº”ç”¨é€»è¾‘ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¹¶è¡Œåƒåœ¾å›æ”¶å™¨ã€‚</li><li><strong>èµ„æºå—é™çš„ç¯å¢ƒ</strong>ï¼šåœ¨å•æ ¸å¤„ç†å™¨æˆ–å†…å­˜è¾ƒå°çš„ç¯å¢ƒä¸­ï¼Œä¸²è¡Œåƒåœ¾å›æ”¶å™¨å¯èƒ½æ˜¯ä¸€ä¸ªè¾ƒå¥½çš„é€‰æ‹©ã€‚</li></ul><p>é€‰æ‹©åˆé€‚çš„åƒåœ¾å›æ”¶å™¨éœ€è¦è€ƒè™‘åº”ç”¨ç¨‹åºçš„å…·ä½“éœ€æ±‚å’Œè¿è¡Œç¯å¢ƒã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½è¿˜éœ€è¦æ ¹æ®åº”ç”¨ç¨‹åºçš„è¡Œä¸ºè¿›è¡Œè°ƒä¼˜ä»¥è¾¾åˆ°æœ€ä½³æ€§èƒ½ã€‚</p><hr><blockquote><p>åƒåœ¾å›æ”¶ä¸»è¦æ˜¯é’ˆå¯¹å“ªå—åŒºåŸŸè¿›è¡Œå›æ”¶çš„</p></blockquote><p>åƒåœ¾å›æ”¶ä¸»è¦æ˜¯é’ˆå¯¹å †å†…å­˜è¿›è¡Œçš„ï¼Œè¿™æ˜¯å¤§éƒ¨åˆ†Javaå¯¹è±¡å­˜å‚¨å’Œå›æ”¶çš„åœ°æ–¹ã€‚</p><p>å †å†…å­˜æ˜¯åƒåœ¾æ”¶é›†å™¨çš„ä¸»è¦å·¥ä½œåŒºåŸŸï¼Œè¿™é‡Œæ˜¯åŠ¨æ€åˆ†é…å†…å­˜çš„åœ°æ–¹ï¼Œå¯¹è±¡å®ä¾‹å’Œæ•°ç»„åœ¨è¿™é‡Œåˆ›å»ºå’Œå›æ”¶ã€‚</p><blockquote><p>æ–°ç”Ÿä»£çš„å¯¹è±¡æ€ä¹ˆåˆ°è¾¾è€å¹´ä»£çš„ã€‚</p></blockquote><p>åœ¨Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­ï¼Œå¯¹è±¡é€šå¸¸é¦–å…ˆåœ¨æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰åˆ†é…ã€‚éšç€æ—¶é—´çš„æ¨ç§»å’Œåƒåœ¾å›æ”¶çš„è¿›è¡Œï¼Œå¯¹è±¡å¯èƒ½ä¼šä»æ–°ç”Ÿä»£æ™‹å‡ï¼ˆPromotionï¼‰åˆ°è€å¹´ä»£ï¼ˆOld Generationï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯JVMè‡ªåŠ¨å†…å­˜ç®¡ç†çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦åŸºäºå¯¹è±¡çš„å­˜æ´»å‘¨æœŸå’Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚ä»¥ä¸‹æ˜¯å¯¹è±¡ä»æ–°ç”Ÿä»£åˆ°è¾¾è€å¹´ä»£çš„è¿‡ç¨‹ï¼š</p><ol><li>å¯¹è±¡çš„åˆå§‹åˆ†é…</li></ol><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡é¦–å…ˆåœ¨æ–°ç”Ÿä»£çš„EdenåŒºåŸŸåˆ†é…ã€‚è¿™æ˜¯åŸºäºå‡è®¾å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯æœç”Ÿå¤•æ­»çš„ã€‚</p><ol start="2"><li>Minor GCï¼ˆå°åƒåœ¾å›æ”¶ï¼‰</li></ol><p>å½“æ–°ç”Ÿä»£çš„EdenåŒºåŸŸå¡«æ»¡æ—¶ï¼ŒJVMä¼šè¿›è¡Œä¸€æ¬¡ Minor GCã€‚è¿™æ¬¡GCä¼šæ£€æŸ¥EdenåŒºä»¥åŠä¸¤ä¸ªSurvivoråŒºï¼ˆé€šå¸¸ç§°ä¸ºFromå’ŒToï¼Œæˆ–è€…S0å’ŒS1ï¼‰ï¼š</p><ul><li><strong>å­˜æ´»å¯¹è±¡çš„å¤åˆ¶</strong>ï¼šå­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°å½“å‰çš„SurvivoråŒºï¼ˆä¾‹å¦‚ï¼Œä»Edenå¤åˆ¶åˆ°S1ï¼‰ã€‚</li><li><strong>å¹´é¾„è®¡æ•°</strong>ï¼šæ¯å½“å¯¹è±¡åœ¨Minor GCåå­˜æ´»ï¼Œå®ƒçš„å¹´é¾„å°±ä¼šå¢åŠ ã€‚å½“å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­å­˜æ´»è¶³å¤Ÿé•¿çš„æ—¶é—´ï¼ˆè¶…è¿‡ç‰¹å®šçš„å¹´é¾„é˜ˆå€¼ï¼Œé€šå¸¸ç”±å‚æ•°<code>-XX:MaxTenuringThreshold</code>è®¾å®šï¼‰åï¼Œå®ƒå°±ä¼šè¢«è®¤ä¸ºè¶³å¤Ÿæˆç†Ÿï¼Œå¯ä»¥æ™‹å‡åˆ°è€å¹´ä»£ã€‚</li></ul><ol start="3"><li>å¯¹è±¡çš„æ™‹å‡</li></ol><p>å¯¹è±¡ä¸æ˜¯åœ¨æ¯æ¬¡Minor GCåéƒ½ä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚å®ƒä»¬å¯èƒ½ä¼šåœ¨æ–°ç”Ÿä»£çš„SurvivoråŒºä¹‹é—´æ¥å›å¤åˆ¶å‡ æ¬¡ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£é€šå¸¸æ˜¯åŸºäºä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p><ul><li><strong>å¹´é¾„é˜ˆå€¼</strong>ï¼šå½“å¯¹è±¡çš„å¹´é¾„è¾¾åˆ°é¢„è®¾çš„é˜ˆå€¼æ—¶ã€‚</li><li><strong>Survivorç©ºé—´ä¸è¶³</strong>ï¼šå¦‚æœSurvivorç©ºé—´ä¸è¶³ä»¥å®¹çº³ä¸€æ¬¡Minor GCåå­˜æ´»çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å°†ç›´æ¥æ™‹å‡åˆ°è€å¹´ä»£ã€‚</li><li><strong>å¤§å¯¹è±¡</strong>ï¼šå¤§å¯¹è±¡ï¼ˆå¤§äº<code>-XX:PretenureSizeThreshold</code>è®¾å®šçš„å¤§å°ï¼‰å¯èƒ½ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œä»¥é¿å…åœ¨æ–°ç”Ÿä»£ä¸­åå¤å¤åˆ¶ã€‚</li></ul><p>ç±»æ¯”ï¼šä¸€ä¸ªäººçš„æˆé•¿</p><p>å¯ä»¥å°†å¯¹è±¡ä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ç±»æ¯”ä¸ºä¸€ä¸ªäººçš„æˆé•¿è¿‡ç¨‹ï¼š</p><ul><li><strong>æ–°ç”Ÿä»£</strong>ï¼šå°±åƒå„¿ç«¥æ—¶æœŸï¼Œä¸ªä½“ï¼ˆå¯¹è±¡ï¼‰åœ¨è¿™ä¸ªé˜¶æ®µå¿«é€Ÿæˆé•¿ï¼ˆåˆ›å»ºï¼‰ï¼Œä½†è®¸å¤šå¾ˆå¿«å°±ä¸å†å­˜åœ¨ï¼ˆæœç”Ÿå¤•æ­»ï¼‰ã€‚</li><li><strong>Minor GC</strong>ï¼šå°±åƒå­¦æ ¡çš„è€ƒè¯•ï¼Œæ£€éªŒå“ªäº›å­¦ç”Ÿï¼ˆå¯¹è±¡ï¼‰è¶³å¤Ÿå¼ºå£®ï¼ˆå­˜æ´»ï¼‰ä»¥ç»§ç»­åˆ°ä¸‹ä¸€ä¸ªå­¦æœŸï¼ˆSurvivoråŒºæˆ–è€å¹´ä»£ï¼‰ã€‚</li><li><strong>æ™‹å‡åˆ°è€å¹´ä»£</strong>ï¼šä¸ªä½“ï¼ˆå¯¹è±¡ï¼‰é€šè¿‡å¤šæ¬¡è€ƒéªŒï¼ˆMinor GCï¼‰è¯æ˜äº†å…¶ç¨³å®šæ€§ï¼ˆå­˜æ´»ç‡é«˜ï¼‰ï¼Œå› æ­¤å¯ä»¥è¿›å…¥æ›´ä¸ºç¨³å®šçš„æˆå¹´é˜¶æ®µï¼ˆè€å¹´ä»£ï¼‰ã€‚</li></ul><blockquote><p>åˆ†ä»£å¹´é¾„ä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸º 15ï¼Œé»˜è®¤å€¼æ˜¯ 15ï¼Œ æœ€å¤§æ˜¯å¤šå°‘ã€‚</p></blockquote><p>åœ¨åƒåœ¾å›æ”¶å’Œå†…å­˜åˆ†é…ä¹‹é—´çš„ä¸€ä¸ªå¹³è¡¡å€¼,æœ€å¤§å€¼æ˜¯ 15ï¼Œé»˜è®¤å€¼ä¹Ÿæ˜¯15</p><p>å‚è€ƒï¼š![[JVMå…¥é—¨_åŸºç¡€æ¦‚å¿µ#JVMåˆ†ä»£å¹´é¾„ä¸ºä»€ä¹ˆæ˜¯15]]</p><blockquote><p>åƒåœ¾å›æ”¶å™¨</p></blockquote><p><strong>å¸¸è§çš„åƒåœ¾å›æ”¶å™¨æœ‰ å•çº¿ç¨‹ã€å¤šçº¿ç¨‹ã€CMSã€G1ã€‚</strong></p><blockquote><p>å“ªäº›å¯¹è±¡æ˜¯å¯ä»¥è¢«çœ‹åšæ˜¯ GCRoot</p></blockquote><p>åœ¨Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­ï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨å›æ”¶å†…å­˜ä¹‹å‰éœ€è¦ç¡®å®šå“ªäº›å¯¹è±¡æ˜¯æ´»åŠ¨çš„ï¼Œå³ä¸åº”è¯¥è¢«å›æ”¶çš„ã€‚è¿™æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æï¼ˆReachability Analysisï¼‰æ¥å®Œæˆçš„ï¼Œè¿‡ç¨‹ä¸­ä»¥ä¸€ç»„ç§°ä¸ºâ€œGC Rootsâ€ï¼ˆåƒåœ¾å›æ”¶æ ¹ï¼‰çš„å¯¹è±¡ä¸ºèµ·ç‚¹ã€‚ä»¥ä¸‹æ˜¯å¸¸è§çš„GC Rootå¯¹è±¡ï¼š</p><ol><li>åœ¨è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li></ol><ul><li><strong>å±€éƒ¨å˜é‡è¡¨</strong>ä¸­çš„å¼•ç”¨å¯¹è±¡ã€‚è¿™äº›å¼•ç”¨æ¥è‡ªäºå„ä¸ªçº¿ç¨‹çš„æ–¹æ³•è°ƒç”¨æ ˆã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿæœºæ ˆï¼Œå…¶ä¸­çš„å±€éƒ¨å˜é‡è¡¨å¯èƒ½å¼•ç”¨äº†å…¶ä»–å¯¹è±¡ã€‚</li></ul><ol start="2"><li>æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li></ol><ul><li><strong>é™æ€å±æ€§</strong>ï¼ˆstatic fieldï¼‰ä½äºæ–¹æ³•åŒºï¼Œå®ƒä»¬å¼•ç”¨çš„å¯¹è±¡ä¹Ÿä½œä¸ºGC Rootsã€‚</li></ul><ol start="3"><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li></ol><ul><li><strong>å¸¸é‡</strong>ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆString Constant Poolï¼‰ä¸­çš„å¼•ç”¨ã€‚</li></ul><ol start="4"><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³é€šå¸¸æ‰€è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li></ol><ul><li>ç”±Javaæœ¬åœ°æ¥å£ï¼ˆJNIï¼‰å¼•ç”¨çš„å¯¹è±¡ï¼Œä¾‹å¦‚åœ¨æœ¬åœ°ä»£ç ï¼ˆCæˆ–C++ç­‰ï¼‰ä¸­åˆ›å»ºå¹¶è¢«Javaä»£ç ä½¿ç”¨çš„å¯¹è±¡ã€‚</li></ul><ol start="5"><li>æ´»åŠ¨çš„Javaçº¿ç¨‹ï¼ˆThreadå¯¹è±¡ï¼‰</li></ol><ul><li>æ´»åŠ¨çš„çº¿ç¨‹ä¹Ÿæ˜¯ä¸€ä¸ªGC Rootã€‚</li></ul><p>ç±»æ¯”</p><p>å¯ä»¥å°†GC Rootsæƒ³è±¡ä¸ºå®¶æ—æ ‘çš„æ ¹ï¼šå®¶æ—æ ‘ä¸­çš„æ¯ä¸ªæˆå‘˜ï¼ˆå¯¹è±¡ï¼‰éƒ½å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—çš„å…³ç³»ï¼ˆå¼•ç”¨ï¼‰è¿½æº¯åˆ°å®¶æ—çš„å§‹ç¥–ï¼ˆGC Rootsï¼‰ã€‚å¦‚æœä¸€ä¸ªæˆå‘˜ï¼ˆå¯¹è±¡ï¼‰ä¸èƒ½é€šè¿‡ä»»ä½•å…³ç³»ï¼ˆå¼•ç”¨é“¾ï¼‰ä¸å§‹ç¥–ï¼ˆGC Rootsï¼‰ç›¸è¿ï¼Œé‚£ä¹ˆå¯ä»¥è®¤ä¸ºè¿™ä¸ªæˆå‘˜ï¼ˆå¯¹è±¡ï¼‰å·²ç»â€œç¦»ä¸–â€ï¼ˆå¯ä»¥è¢«åƒåœ¾å›æ”¶ï¼‰ã€‚</p><blockquote><p>åœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä¼šå‡ºç°ä¸€äº›å¤šæ ‡ã€æ¼æ ‡çš„è¿‡ç¨‹ï¼ŒCMSæ˜¯æ€ä¹ˆå¤„ç†çš„ã€‚</p></blockquote><p>åœ¨CMSï¼ˆConcurrent Mark-Sweepï¼‰åƒåœ¾å›æ”¶å™¨ä¸­ï¼Œå¹¶å‘æ ‡è®°è¿‡ç¨‹ç¡®å®å¯èƒ½ä¼šé¢ä¸´å¤šæ ‡ï¼ˆå¤šæ¬¡æ ‡è®°åŒä¸€ä¸ªå¯¹è±¡ï¼‰æˆ–æ¼æ ‡ï¼ˆæœªæ ‡è®°åˆ°åº”è¯¥å­˜æ´»çš„å¯¹è±¡ï¼‰çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºçš„çº¿ç¨‹åœ¨è¿™ä¸ªé˜¶æ®µæ˜¯å¤„äºæ´»åŠ¨çŠ¶æ€çš„ï¼Œå¯¹è±¡çš„å¼•ç”¨å…³ç³»å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚CMSé‡‡ç”¨äº†å‡ ç§æŠ€æœ¯å’Œç­–ç•¥æ¥å¤„ç†è¿™äº›é—®é¢˜ï¼Œç¡®ä¿æ ‡è®°è¿‡ç¨‹çš„å‡†ç¡®æ€§ã€‚ä»¥ä¸‹æ˜¯CMSå¤„ç†è¿™äº›é—®é¢˜çš„ä¸€äº›æ–¹æ³•ï¼š</p><ol><li>å†™å±éšœï¼ˆWrite Barrierï¼‰</li></ol><ul><li><strong>å†™å±éšœ</strong>æ˜¯ä¸€ç§ç³»ç»Ÿæœºåˆ¶ï¼Œç”¨äºç›‘æ§å’Œæ‹¦æˆªå¯¹è±¡å¼•ç”¨å­—æ®µçš„å†™æ“ä½œã€‚</li><li>åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼ŒJVMé€šè¿‡å†™å±éšœæ¥è®°å½•é‚£äº›è¢«ä¿®æ”¹çš„å¼•ç”¨ã€‚è¿™äº›ä¿¡æ¯å°†åœ¨ç¨åçš„é‡æ–°æ ‡è®°é˜¶æ®µè¢«ä½¿ç”¨ï¼Œä»¥ç¡®ä¿æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½è¢«æ­£ç¡®æ ‡è®°ã€‚</li></ul><ol start="2"><li>å¢é‡æ›´æ–°ï¼ˆIncremental Updateï¼‰</li></ol><ul><li>å¢é‡æ›´æ–°æ˜¯åœ¨å†™å±éšœçš„å¸®åŠ©ä¸‹å®ç°çš„ã€‚å®ƒè®°å½•äº†åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå’Œåº”ç”¨ç¨‹åºçº¿ç¨‹åŒæ—¶è¿è¡Œæ—¶ï¼Œå¼•ç”¨å…³ç³»å‘ç”Ÿå˜åŒ–çš„å¯¹è±¡ã€‚</li><li>åœ¨æ¥ä¸‹æ¥çš„é‡æ–°æ ‡è®°é˜¶æ®µï¼Œå¢é‡æ›´æ–°çš„ä¿¡æ¯è¢«ç”¨æ¥ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å¯èƒ½å‡ºç°çš„æ¼æ ‡é—®é¢˜ã€‚</li></ul><ol start="3"><li>é‡æ–°æ ‡è®°ï¼ˆRemark Phaseï¼‰</li></ol><ul><li>å°½ç®¡å†™å±éšœå’Œå¢é‡æ›´æ–°å¯ä»¥å‡å°‘æ¼æ ‡çš„é—®é¢˜ï¼Œä½†ä»ç„¶éœ€è¦ä¸€ä¸ªSTWï¼ˆStop-The-Worldï¼‰çš„é˜¶æ®µæ¥æœ€ç»ˆç¡®ä¿æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½è¢«æ­£ç¡®æ ‡è®°ã€‚è¿™ä¸ªé˜¶æ®µå°±æ˜¯é‡æ–°æ ‡è®°ã€‚</li><li>åœ¨é‡æ–°æ ‡è®°é˜¶æ®µï¼ŒCMSæ”¶é›†å™¨ä¼šå¤„ç†æ‰€æœ‰çš„å¢é‡æ›´æ–°ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡ä¸€ç§åä¸ºâ€œå¿«ç…§ç®—æ³•â€ï¼ˆSnapshot-at-the-beginning, SATBï¼‰æ¥å¤„ç†åœ¨å¹¶å‘é˜¶æ®µå‘ç”Ÿçš„å¼•ç”¨å˜åŒ–ã€‚</li></ul><p>ç±»æ¯”</p><p>å¯ä»¥å°†CMSçš„å¹¶å‘æ ‡è®°è¿‡ç¨‹ç±»æ¯”ä¸ºç»˜åˆ¶ä¸€å¹…å¤æ‚çš„ç”»ä½œï¼š</p><ul><li><strong>å¹¶å‘æ ‡è®°</strong>å°±åƒæ˜¯ä¸ºç”»ä½œå‹¾å‹’åˆæ­¥çš„è½®å»“ã€‚ç”»å®¶ï¼ˆåƒåœ¾æ”¶é›†å™¨ï¼‰åœ¨ç»˜åˆ¶çš„åŒæ—¶ï¼Œæ¨¡ç‰¹ï¼ˆåº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ï¼‰å¯èƒ½ä¼šç¨å¾®ç§»åŠ¨ï¼Œä»è€Œä½¿å¾—ç”»ä½œçš„æŸäº›éƒ¨åˆ†éœ€è¦è°ƒæ•´ã€‚</li><li><strong>å†™å±éšœå’Œå¢é‡æ›´æ–°</strong>å°±åƒæ˜¯ç”»å®¶è®°å½•ä¸‹æ¨¡ç‰¹çš„æ¯ä¸€ä¸ªå°åŠ¨ä½œï¼Œä»¥ä¾¿ç¨åä¿®æ­£ç”»ä½œçš„ç»†èŠ‚ã€‚</li><li><strong>é‡æ–°æ ‡è®°</strong>åˆ™æ˜¯ç”»å®¶æœ€ç»ˆå®¡è§†ç”»ä½œï¼Œæ ¹æ®ä¹‹å‰è®°å½•çš„æ‰€æœ‰å°åŠ¨ä½œè°ƒæ•´ç”»ä½œï¼Œç¡®ä¿ç”»ä½œçš„å‡†ç¡®æ€§ã€‚</li></ul><p>CMSçš„è®¾è®¡æ˜¯ä¸ºäº†å‡å°‘åƒåœ¾å›æ”¶æ—¶çš„åœé¡¿æ—¶é—´ï¼Œä½†ä¸ºäº†ç¡®ä¿å‡†ç¡®æ€§ï¼Œå®ƒéœ€è¦é‡‡ç”¨ä¸Šè¿°æœºåˆ¶æ¥å¤„ç†å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚</p><blockquote><p>ä¸‰è‰²æ ‡è®°ç®—æ³•æœ‰äº†è§£è¿‡å—</p></blockquote><p>ä¸‰è‰²æ ‡è®°ï¼ˆTri-color Markingï¼‰ç®—æ³•æ˜¯åƒåœ¾å›æ”¶ä¸­ä½¿ç”¨çš„ä¸€ç§æ ‡è®°ç®—æ³•ï¼Œç‰¹åˆ«æ˜¯åœ¨æ”¯æŒå¹¶å‘åƒåœ¾æ”¶é›†çš„æƒ…å†µä¸‹ï¼Œä¾‹å¦‚åœ¨CMSï¼ˆConcurrent Mark-Sweepï¼‰å’ŒG1ï¼ˆGarbage-Firstï¼‰åƒåœ¾å›æ”¶å™¨ä¸­ã€‚å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œç”¨ä¸‰ç§é¢œè‰²æ¥è¡¨ç¤ºå¯¹è±¡çš„çŠ¶æ€ï¼Œä»è€Œç¡®ä¿åœ¨å¹¶å‘ç¯å¢ƒä¸‹èƒ½å¤Ÿæ­£ç¡®åœ°è¿›è¡Œåƒåœ¾å›æ”¶ã€‚è¿™ä¸‰ç§é¢œè‰²é€šå¸¸æ˜¯ç™½è‰²ã€ç°è‰²å’Œé»‘è‰²ã€‚</p><p>ä¸‰è‰²æ ‡è®°ç®—æ³•çš„å·¥ä½œåŸç†</p><ol><li><strong>ç™½è‰²</strong>ï¼šè¡¨ç¤ºå¯¹è±¡å°šæœªè¢«è®¿é—®ã€‚åˆå§‹æ—¶ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ ‡è®°ä¸ºç™½è‰²ã€‚</li><li><strong>ç°è‰²</strong>ï¼šè¡¨ç¤ºå¯¹è±¡å·²è¢«è®¿é—®ï¼Œä½†è¯¥å¯¹è±¡å¼•ç”¨çš„å…¶ä»–å¯¹è±¡è¿˜æ²¡æœ‰å…¨éƒ¨è®¿é—®ã€‚æ¢å¥è¯è¯´ï¼Œä»æ ¹é›†åˆå‡ºå‘ï¼Œå¼•ç”¨è·¯å¾„ä¸Šçš„å¯¹è±¡å·²è¢«è®¿é—®ï¼Œä½†è¿™äº›å¯¹è±¡çš„å­å¯¹è±¡è¿˜æœªè¢«å…¨éƒ¨è®¿é—®ã€‚</li><li><strong>é»‘è‰²</strong>ï¼šè¡¨ç¤ºå¯¹è±¡å·²è¢«è®¿é—®ï¼Œä¸”è¯¥å¯¹è±¡å¼•ç”¨çš„æ‰€æœ‰å…¶ä»–å¯¹è±¡ä¹Ÿéƒ½å·²è®¿é—®ã€‚é»‘è‰²å¯¹è±¡æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒå’Œå®ƒå¼•ç”¨çš„å¯¹è±¡éƒ½å·²ç»è¢«æ‰«æè¿‡ï¼Œä¸ä¼šå†å¼•ç”¨ä»»ä½•ç™½è‰²å¯¹è±¡ã€‚</li></ol><p>ä¸‰è‰²æ ‡è®°çš„è¿‡ç¨‹</p><ul><li><strong>åˆå§‹é˜¶æ®µ</strong>ï¼šæ‰€æœ‰å¯¹è±¡éƒ½æ ‡è®°ä¸ºç™½è‰²ã€‚</li><li><strong>æ ‡è®°é˜¶æ®µ</strong>ï¼š<ul><li>ä»æ ¹é›†åˆå¼€å§‹ï¼Œè®¿é—®å’Œæ ‡è®°å¯¹è±¡ã€‚é¦–å…ˆï¼Œå°†æ ¹å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ã€‚</li><li>éå†ç°è‰²å¯¹è±¡ï¼Œå°†å…¶å¼•ç”¨çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼ˆå¦‚æœå®ƒä»¬æ˜¯ç™½è‰²çš„ï¼‰ï¼Œç„¶åå°†è¯¥å¯¹è±¡æ ‡è®°ä¸ºé»‘è‰²ã€‚</li><li>é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ²¡æœ‰ç°è‰²å¯¹è±¡ä¸ºæ­¢ã€‚</li></ul></li></ul><p>ä¸‰è‰²æ ‡è®°å’Œå¹¶å‘åƒåœ¾å›æ”¶</p><p>åœ¨å¹¶å‘åƒåœ¾å›æ”¶ä¸­ï¼Œåº”ç”¨çº¿ç¨‹å’Œåƒåœ¾æ”¶é›†çº¿ç¨‹æ˜¯åŒæ—¶è¿è¡Œçš„ã€‚è¿™å¯èƒ½å¯¼è‡´æ‰€è°“çš„â€œæµ®åŠ¨åƒåœ¾â€ï¼ˆFloating Garbageï¼‰ï¼Œå³åœ¨æ ‡è®°è¿‡ç¨‹ä¸­ç”±äºåº”ç”¨çº¿ç¨‹çš„è¿è¡Œäº§ç”Ÿçš„æ–°åƒåœ¾ã€‚ä¸‰è‰²æ ‡è®°ç®—æ³•é€šè¿‡ç»´æŠ¤è¿™äº›é¢œè‰²çš„ä¸å˜æ€§å’Œä½¿ç”¨ä¸€äº›æŠ€æœ¯ï¼Œå¦‚å†™å±éšœï¼ˆWrite Barrierï¼‰å’Œå¢é‡æ›´æ–°ï¼ˆIncremental Updateï¼‰ï¼Œæ¥ç¡®ä¿åƒåœ¾æ”¶é›†çš„æ­£ç¡®æ€§ã€‚</p><p>ç±»æ¯”</p><p>å¯ä»¥å°†ä¸‰è‰²æ ‡è®°ç®—æ³•ç±»æ¯”ä¸ºç®¡ç†ä¸€å®¶å›¾ä¹¦é¦†çš„è¿‡ç¨‹ï¼š</p><ul><li><strong>ç™½è‰²ä¹¦ç±</strong>ï¼šå°šæœªæ£€æŸ¥çš„ä¹¦ç±ã€‚</li><li><strong>ç°è‰²ä¹¦ç±</strong>ï¼šæ£€æŸ¥è¿‡ï¼Œä½†ä¹¦ç±é‡Œé¢çš„å¼•ç”¨ï¼ˆä¾‹å¦‚ä¹¦ä¸­çš„å¼•ç”¨æ–‡çŒ®ï¼‰è¿˜æ²¡æœ‰å…¨éƒ¨æ£€æŸ¥çš„ä¹¦ç±ã€‚</li><li><strong>é»‘è‰²ä¹¦ç±</strong>ï¼šå®Œå…¨æ£€æŸ¥è¿‡çš„ä¹¦ç±ï¼ŒåŒ…æ‹¬ä¹¦æœ¬åŠå…¶å¼•ç”¨çš„æ‰€æœ‰å†…å®¹ã€‚</li></ul><p>å›¾ä¹¦ç®¡ç†å‘˜ï¼ˆåƒåœ¾æ”¶é›†å™¨ï¼‰éœ€è¦ç¡®ä¿æ‰€æœ‰çš„ä¹¦ç±éƒ½è¢«æ­£ç¡®åœ°æ£€æŸ¥è¿‡ï¼ŒåŒæ—¶å¤„ç†å›¾ä¹¦é¦†è¿è¥æœŸé—´æ–°åŠ å…¥æˆ–å˜åŠ¨çš„ä¹¦ç±ï¼ˆåº”ç”¨çº¿ç¨‹çš„æ´»åŠ¨ï¼‰ã€‚</p><h3 id="6ã€å †ç©ºé—´"><a href="#6ã€å †ç©ºé—´" class="headerlink" title="6ã€å †ç©ºé—´"></a>6ã€å †ç©ºé—´</h3><h4 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h4><p>Java çš„è‡ªåŠ¨å†…å­˜ç®¡ç†ä¸»è¦æ˜¯<strong>é’ˆå¯¹å¯¹è±¡å†…å­˜çš„å›æ”¶å’Œå¯¹è±¡å†…å­˜çš„åˆ†é…</strong>ã€‚åŒæ—¶ï¼ŒJava è‡ªåŠ¨å†…å­˜ç®¡ç†æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯ <strong>å †</strong> å†…å­˜ä¸­å¯¹è±¡çš„åˆ†é…ä¸å›æ”¶ã€‚</p><p>Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œ <strong>GC å †ï¼ˆGarbage Collected Heapï¼‰</strong>ã€‚</p><p>ä»åƒåœ¾å›æ”¶çš„è§’åº¦æ¥è¯´ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †è¢«åˆ’åˆ†ä¸ºäº†å‡ ä¸ªä¸åŒçš„åŒºåŸŸï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å„ä¸ªåŒºåŸŸçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚</p><blockquote><p>&lt;&#x3D; JDK 7</p></blockquote><p>åœ¨ JDK 7 ç‰ˆæœ¬åŠ JDK 7 ç‰ˆæœ¬ä¹‹å‰ï¼Œå †å†…å­˜è¢«é€šå¸¸åˆ†ä¸ºä¸‹é¢ä¸‰éƒ¨åˆ†ï¼š</p><ol><li>æ–°ç”Ÿä»£å†…å­˜(Young Generation)</li><li>è€ç”Ÿä»£(Old Generation)</li><li>æ°¸ä¹…ä»£(Permanent Generation)</li></ol><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401231042051.png" alt="image.png"></p><p>Eden åŒºã€ä¸¤ä¸ª Survivor åŒº S0 å’Œ S1 éƒ½å±äºæ–°ç”Ÿä»£ï¼Œä¸­é—´ä¸€å±‚å±äºè€å¹´ä»£ï¼Œæœ€ä¸‹é¢ä¸€å±‚å±äºæ°¸ä¹…ä»£ã€‚</p><blockquote><p>&#x3D; JDK8</p></blockquote><p><strong>JDK 8 ç‰ˆæœ¬ä¹‹å PermGen(æ°¸ä¹…) å·²è¢« Metaspace(å…ƒç©ºé—´) å–ä»£ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜</strong></p><h5 id="Survivor-åŒº"><a href="#Survivor-åŒº" class="headerlink" title="Survivor åŒº"></a>Survivor åŒº</h5><blockquote><p>å¯¹è±¡åœ¨GCçš„æ—¶å€™åœ¨æ–°ç”Ÿä»£çš„ä¸€ä¸ªæ´»åŠ¨æ˜¯æ€ä¹ˆæ ·çš„ï¼›å…ƒç©ºé—´&#x2F;æ°¸ä¹…ä»£æœ‰ä»€ä¹ˆç”¨</p></blockquote><p>åœ¨Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­ï¼Œæ–°ç”Ÿä»£æ˜¯å †å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚æ–°ç”Ÿä»£é€šå¸¸åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼šEdenåŒºã€ä¸¤ä¸ªSurvivoråŒºï¼ˆåˆ†åˆ«ç§°ä¸ºS0å’ŒS1ï¼‰ã€‚</p><p>å¯¹è±¡åœ¨æ–°ç”Ÿä»£çš„åˆ†é…å’Œå›æ”¶æ˜¯åƒåœ¾å›æ”¶æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚æ­¤å¤–ï¼Œå…ƒç©ºé—´ï¼ˆæˆ–åœ¨Java 8ä¹‹å‰çš„ç‰ˆæœ¬ä¸­çš„æ°¸ä¹…ä»£ï¼‰ä¹Ÿåœ¨å†…å­˜ç®¡ç†ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚</p><blockquote><p>æ–°ç”Ÿä»£çš„å†…å­˜åŒºåŸŸ</p></blockquote><ol><li><strong>EdenåŒº</strong>:<ul><li>å½“æ–°å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œå®ƒä»¬é€šå¸¸é¦–å…ˆåœ¨EdenåŒºåˆ†é…ã€‚EdenåŒºå æ–°ç”Ÿä»£çš„å¤§éƒ¨åˆ†ç©ºé—´ã€‚</li></ul></li><li><strong>ä¸¤ä¸ªSurvivoråŒºï¼ˆS0å’ŒS1ï¼‰</strong>:<ul><li>SurvivoråŒºç”¨æ¥ä¿å­˜ä¸€æ¬¡Minor GCåä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚åœ¨ä¸¤ä¸ªSurvivoråŒºä¸­ï¼Œä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªæ˜¯è¢«ä½¿ç”¨çš„ï¼ˆæ´»åŠ¨çš„ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ç©ºé—²çš„ã€‚</li></ul></li></ol><div style="border: 1px solid #999; border-radius: 5px; padding: 10px;">    ä¸¤ä¸ªç”Ÿå­˜åŒºä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ˜¯ç©ºé—²çš„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æ´»åŠ¨çš„ã€‚</div><blockquote><p>å¯¹è±¡åœ¨æ–°ç”Ÿä»£çš„GCæ´»åŠ¨</p></blockquote><p>åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œæ–°ç”Ÿä»£çš„å¯¹è±¡ç»å†ä»¥ä¸‹æ´»åŠ¨ï¼š</p><ol><li><strong>æ–°å¯¹è±¡åˆ†é…</strong>:<ul><li>æ–°å¯¹è±¡é¦–å…ˆåœ¨EdenåŒºåˆ†é…ã€‚</li></ul></li><li><strong>ç¬¬ä¸€æ¬¡Minor GC</strong>:<ul><li>å½“EdenåŒºæ»¡æ—¶ï¼Œè¿›è¡Œä¸€æ¬¡Minor GCã€‚</li><li>å­˜æ´»çš„å¯¹è±¡ä»EdenåŒºç§»åŠ¨åˆ°ä¸€ä¸ªSurvivoråŒºï¼ˆæ¯”å¦‚S0ï¼‰ï¼Œå¹¶å°†å…¶å¹´é¾„è®¾ç½®ä¸º1ã€‚</li></ul></li><li><strong>åç»­çš„Minor GC</strong>:<ul><li>åœ¨åç»­çš„Minor GCä¸­ï¼ŒEdenåŒºå’Œå½“å‰æ´»åŠ¨çš„SurvivoråŒºï¼ˆæ¯”å¦‚S0ï¼‰ä¸­å­˜æ´»çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°å¦ä¸€ä¸ªSurvivoråŒºï¼ˆæ¯”å¦‚S1ï¼‰ï¼Œå¯¹è±¡å¹´é¾„å¢åŠ 1ã€‚</li><li>å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å¹´é¾„è¶…è¿‡äº†ä¸€å®šçš„é˜ˆå€¼ï¼ˆé€šå¸¸æ˜¯15ï¼‰ï¼Œå®ƒå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ã€‚</li></ul></li><li><strong>ä¸¤ä¸ªSurvivoråŒºçš„äº¤æ¢</strong>:<ul><li>æ¯æ¬¡Minor GCåï¼Œæ´»åŠ¨çš„å’Œç©ºé—²çš„SurvivoråŒºä¼šäº¤æ¢ã€‚è¿™æ„å‘³ç€å¦‚æœS0æ˜¯ä¸Šæ¬¡GCåçš„æ´»åŠ¨åŒºï¼Œé‚£ä¹ˆä¸‹æ¬¡GCæ—¶ï¼ŒS1å°†æˆä¸ºæ´»åŠ¨åŒºï¼Œåä¹‹äº¦ç„¶ã€‚</li></ul></li></ol><blockquote><p>ç±»æ¯”</p></blockquote><p>å¯ä»¥å°†æ–°ç”Ÿä»£çš„å†…å­˜ç®¡ç†æ¯”ä½œæ˜¯ä¸€ä¸ªå­©å­çš„æˆé•¿è¿‡ç¨‹ï¼š</p><ul><li><strong>EdenåŒº</strong>å°±åƒå©´å„¿å®¤ï¼Œæ–°ç”Ÿçš„å­©å­ï¼ˆå¯¹è±¡ï¼‰é¦–å…ˆåœ¨è¿™é‡Œã€‚</li><li><strong>SurvivoråŒº</strong>å°±åƒå­¦æ ¡ï¼Œç»è¿‡å‡ æ¬¡è€ƒæ ¸ï¼ˆGCï¼‰åï¼Œè¡¨ç°å¥½çš„å­©å­ï¼ˆå¯¹è±¡ï¼‰ä¼šè½¬åˆ°å­¦æ ¡ï¼ˆSurvivoråŒºï¼‰ã€‚</li><li>éšç€å­©å­ä»¬çš„æˆé•¿ï¼ˆå¯¹è±¡çš„å¹´é¾„å¢é•¿ï¼‰ï¼Œä¸€äº›ä¼šè½¬åˆ°å¤§å­¦ï¼ˆè€å¹´ä»£ï¼‰ã€‚</li></ul><blockquote><p>å…ƒç©ºé—´&#x2F;æ°¸ä¹…ä»£çš„ä½œç”¨</p></blockquote><ul><li><p><strong>æ°¸ä¹…ä»£ï¼ˆPermGen, Java 8ä¹‹å‰ï¼‰</strong>:</p><ul><li>ç”¨äºå­˜å‚¨JVMåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡æ± ã€é™æ€å˜é‡ç­‰æ•°æ®ã€‚</li><li>ç”±äºæ°¸ä¹…ä»£çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå®ƒå¯èƒ½ä¼šå› ä¸ºç±»åŠ è½½å™¨åŠ è½½äº†å¤ªå¤šçš„ç±»è€Œå¯¼è‡´å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryErrorï¼‰ã€‚</li></ul></li><li><p><strong>å…ƒç©ºé—´ï¼ˆMetaspace, Java 8åŠä¹‹åï¼‰</strong>:</p><ul><li>å…ƒç©ºé—´å–ä»£äº†æ°¸ä¹…ä»£ï¼Œç”¨äºå­˜å‚¨ç±»çš„å…ƒæ•°æ®ã€‚</li><li>å…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼ˆè€ŒéJVMå†…å­˜ï¼‰ï¼Œå› æ­¤å®ƒçš„å¤§å°åªå—æœ¬åœ°å†…å­˜é™åˆ¶ï¼Œè¿™å‡å°‘äº†å‘ç”Ÿå†…å­˜æº¢å‡ºçš„é£é™©ã€‚</li></ul></li></ul><h4 id="å†…å­˜åˆ†é…å’Œå›æ”¶åŸåˆ™"><a href="#å†…å­˜åˆ†é…å’Œå›æ”¶åŸåˆ™" class="headerlink" title="å†…å­˜åˆ†é…å’Œå›æ”¶åŸåˆ™"></a>å†…å­˜åˆ†é…å’Œå›æ”¶åŸåˆ™</h4><p>çœ‹ä¸€ä¸‹è¿™ä¸ªï¼š <a href="https://javaguide.cn/java/jvm/jvm-garbage-collection.html#%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%92%8C%E5%9B%9E%E6%94%B6%E5%8E%9F%E5%88%99">https://javaguide.cn/java/jvm/jvm-garbage-collection.html#%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%92%8C%E5%9B%9E%E6%94%B6%E5%8E%9F%E5%88%99</a></p><p>åœ¨Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­ï¼Œå †ç©ºé—´æ˜¯å¯¹è±¡å­˜å‚¨çš„ä¸»è¦åŒºåŸŸã€‚å †ç©ºé—´çš„å†…å­˜åˆ†é…å’Œå›æ”¶æ˜¯åƒåœ¾å›æ”¶æœºåˆ¶çš„æ ¸å¿ƒã€‚ä»¥ä¸‹æ˜¯JVMä¸­å †ç©ºé—´çš„å†…å­˜åˆ†é…å’Œå›æ”¶åŸåˆ™çš„è¯¦ç»†è§£é‡Šï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€äº›ç®€å•çš„ç±»æ¯”æ¥å¸®åŠ©ç†è§£ã€‚</p><h5 id="å†…å­˜åˆ†é…ç­–ç•¥"><a href="#å†…å­˜åˆ†é…ç­–ç•¥" class="headerlink" title="å†…å­˜åˆ†é…ç­–ç•¥"></a>å†…å­˜åˆ†é…ç­–ç•¥</h5><ul><li><strong>å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…</strong>ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨å¹´è½»ä»£çš„EdenåŒºåˆ†é…ã€‚å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼ŒJVMä¼šè¿›è¡Œä¸€æ¬¡Minor GCã€‚</li><li><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong>ï¼šé¿å…åœ¨EdenåŒºåŠä¸¤ä¸ªSurvivoråŒºä¹‹é—´å‘ç”Ÿå¤§é‡å†…å­˜å¤åˆ¶ã€‚</li><li><strong>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£</strong>ï¼šå¯¹è±¡åœ¨å¹´è½»ä»£ä¸­ç»è¿‡å¤šæ¬¡GCåä»ç„¶å­˜æ´»ï¼Œä¼šè¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚</li></ul><blockquote><p>å †ç©ºé—´çš„å†…å­˜åˆ†é…</p></blockquote><ol><li><strong>å¯¹è±¡çš„åˆ›å»ºå’Œå­˜å‚¨</strong>:<ul><li>å½“æ–°å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼ŒJVMé¦–å…ˆä¼šæ£€æŸ¥å †ç©ºé—´æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—´åˆ†é…ç»™è¿™ä¸ªæ–°å¯¹è±¡ã€‚</li><li>å¦‚æœæœ‰è¶³å¤Ÿç©ºé—´ï¼Œå¯¹è±¡å°†è¢«å­˜å‚¨åœ¨å †å†…å­˜ä¸­ï¼›å¦‚æœæ²¡æœ‰ï¼ŒJVMä¼šå°è¯•é€šè¿‡åƒåœ¾å›æ”¶æ¥é‡Šæ”¾ç©ºé—´ã€‚</li></ul></li><li><strong>åˆ†ä»£åˆ†é…ç­–ç•¥</strong>:<ul><li>å¤§éƒ¨åˆ†JVMä½¿ç”¨åˆ†ä»£åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå°†å †ç©ºé—´åˆ†ä¸ºå¹´è½»ä»£ï¼ˆYoung Generationï¼‰ã€è€å¹´ä»£ï¼ˆOld Generationï¼‰ç­‰åŒºåŸŸã€‚</li><li>æ–°åˆ›å»ºçš„å¯¹è±¡é¦–å…ˆåœ¨å¹´è½»ä»£ä¸­åˆ†é…ï¼ˆé€šå¸¸åœ¨å…¶ä¸­ä¸€ä¸ªç§°ä¸º<code>Eden</code>çš„åŒºï¼‰ã€‚å½“<code>Eden</code>åŒºæ»¡æ—¶ï¼Œä¼šè¿›è¡Œä¸€æ¬¡Minor GCï¼Œæ¸…ç†å¹´è½»ä»£ä¸­ä¸å†å­˜æ´»çš„å¯¹è±¡ã€‚</li></ul></li></ol><blockquote><p>ç±»æ¯”ï¼šåŸå¸‚å»ºè®¾</p></blockquote><p>å¯ä»¥å°†å †ç©ºé—´çš„å†…å­˜åˆ†é…æƒ³è±¡ä¸ºåŸå¸‚å»ºè®¾ã€‚æ–°å»ºçš„å»ºç­‘ï¼ˆå¯¹è±¡ï¼‰éœ€è¦åœ¨åŸå¸‚ï¼ˆå †ç©ºé—´ï¼‰ä¸­æ‰¾åˆ°åˆé€‚çš„ä½ç½®ã€‚æ–°å»ºç­‘é¦–å…ˆä¼šåœ¨å¼€å‘åŒºï¼ˆå¹´è½»ä»£ï¼‰ä¸­æ‰¾åœ°æ–¹ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œä¸€äº›ç»ä¹…è€ç”¨çš„å»ºç­‘ä¼šè¢«è¿ç§»åˆ°æ›´ç¨³å®šçš„åŒºåŸŸï¼ˆè€å¹´ä»£ï¼‰ã€‚</p><h5 id="å†…å­˜å›æ”¶"><a href="#å†…å­˜å›æ”¶" class="headerlink" title="å†…å­˜å›æ”¶"></a>å†…å­˜å›æ”¶</h5><blockquote><p>å †ç©ºé—´çš„å†…å­˜å›æ”¶</p></blockquote><ol><li><strong>å¯è¾¾æ€§åˆ†æ</strong>:<ul><li>JVMé€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚ä»ä¸€ç³»åˆ—çš„â€œæ ¹â€å¯¹è±¡ï¼ˆå¦‚çº¿ç¨‹æ ˆä¸­çš„å±€éƒ¨å˜é‡ã€é™æ€å˜é‡ç­‰ï¼‰å¼€å§‹ï¼ŒJVMæŸ¥æ‰¾å¹¶æ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ã€‚ä¸å¯è¾¾çš„å¯¹è±¡å¯ä»¥è¢«è®¤ä¸ºæ˜¯åƒåœ¾ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚</li></ul></li><li><strong>åƒåœ¾å›æ”¶ç®—æ³•</strong>:<ul><li><strong>æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰</strong>: æ ‡è®°æ‰€æœ‰ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œç„¶åç»Ÿä¸€æ¸…é™¤ã€‚</li><li><strong>å¤åˆ¶ï¼ˆCopyingï¼‰</strong>: å°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—åŒºåŸŸï¼Œç„¶åæ¸…ç†æ‰åŸæ¥çš„å…¨éƒ¨ç©ºé—´ã€‚</li><li><strong>æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰</strong>: æ ‡è®°æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œç„¶åå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œæ¸…ç†æ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</li><li><strong>åˆ†ä»£æ”¶é›†ï¼ˆGenerational Collectionï¼‰</strong>: æ ¹æ®å¯¹è±¡å­˜æ´»çš„æ—¶é—´ä¸åŒï¼Œå°†å †åˆ†ä¸ºå‡ å—ï¼Œå¦‚å¹´è½»ä»£ã€è€å¹´ä»£ï¼Œå„ä»£ä½¿ç”¨æœ€é€‚åˆçš„æ”¶é›†ç®—æ³•ã€‚</li></ul></li><li><strong>è§¦å‘åƒåœ¾å›æ”¶çš„æ¡ä»¶</strong>:<ul><li>å½“å †ç©ºé—´ä¸è¶³æ—¶ï¼Œä¾‹å¦‚åˆ›å»ºæ–°å¯¹è±¡æ—¶æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ã€‚</li><li>System.gc() è¢«è°ƒç”¨æ—¶ï¼ˆæ³¨æ„ï¼Œè¿™åªæ˜¯å»ºè®®JVMæ‰§è¡ŒGCï¼Œä¸æ˜¯å¼ºåˆ¶çš„ï¼‰ã€‚</li><li>JVMçš„å†…å­˜ç®¡ç†ç­–ç•¥å†³å®šæ‰§è¡Œã€‚</li></ul></li></ol><blockquote><p>ç±»æ¯”ï¼šåŸå¸‚æ¸…æ´</p></blockquote><p>åƒåœ¾å›æ”¶å¯ä»¥æ¯”ä½œåŸå¸‚çš„æ¸…æ´å·¥ä½œã€‚ä¸å†ä½¿ç”¨çš„å»ºç­‘ï¼ˆä¸å¯è¾¾å¯¹è±¡ï¼‰éœ€è¦è¢«æ‹†é™¤æ¥è…¾å‡ºç©ºé—´ã€‚åŸå¸‚ç®¡ç†è€…ï¼ˆåƒåœ¾æ”¶é›†å™¨ï¼‰ä¼šå®šæœŸæ£€æŸ¥å“ªäº›å»ºç­‘ä¸å†è¢«ä½¿ç”¨ï¼Œå¹¶æœ‰è®¡åˆ’åœ°è¿›è¡Œæ‹†é™¤å’Œæ¸…ç†ã€‚</p><h3 id="7ã€å¸¸è§é¢è¯•é¢˜"><a href="#7ã€å¸¸è§é¢è¯•é¢˜" class="headerlink" title="7ã€å¸¸è§é¢è¯•é¢˜"></a>7ã€å¸¸è§é¢è¯•é¢˜</h3><ul><li>1ã€JVMæ˜¯ä»€ä¹ˆï¼Œè®²ä¸€ä¸‹è¿è¡Œæµç¨‹</li><li>2ã€ä»€ä¹ˆæ˜¯ç¨‹åºè®¡æ•°å™¨</li><li>3ã€ä»‹ç»ä¸€ä¸‹å †</li><li>4ã€ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœºæ ˆ</li><li>5ã€è®²ä¸€ä¸‹æ–¹æ³•åŒº</li><li>6ã€å¬è¿‡ç›´æ¥å†…å­˜å—</li><li>7ã€ä»€ä¹ˆæ˜¯ç±»åŠ è½½å™¨ï¼Œä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æœºåˆ¶</li><li>8ã€è¯´ä¸€ä¸‹ç±»åŠ è½½çš„æ‰§è¡Œè¿‡ç¨‹</li><li>9ã€å¯¹è±¡ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«åƒåœ¾å™¨å›æ”¶</li><li>10ã€JVM åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›</li><li>11ã€è¯´ä¸€ä¸‹ JVM çš„åˆ†ä»£å›æ”¶</li><li>12ã€è¯´ä¸€ä¸‹ JVM æœ‰å“ªäº›åƒåœ¾å›æ”¶å™¨</li><li>13ã€è¯¦ç»†èŠä¸€ä¸‹ G1 åƒåœ¾å›æ”¶å™¨</li><li>14ã€å¼ºå¼•ç”¨ã€å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ã€è™šå¼•ç”¨çš„åŒºåˆ«</li><li>15ã€JVMè°ƒä¼˜å‚æ•°å¯ä»¥åœ¨å“ªé‡Œè®¾ç½®å‚æ•°å€¼</li><li>16ã€ç”¨çš„JVMè°ƒä¼˜çš„å‚æ•°éƒ½æœ‰å“ªäº›</li><li>17ã€è¯´ä¸€ä¸‹ JVM è°ƒä¼˜çš„å·¥å…·</li><li>18ã€JVM å†…å­˜æ³„æ¼çš„æ’æŸ¥æ€è·¯</li><li>19ã€CPU é£™é«˜çš„æ’æŸ¥æ–¹æ¡ˆåŠå…¶æ€è·¯</li></ul><p>å¸¸è§é¢è¯•é¢˜</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305164010.png" alt="image.png"></p><p>è¿˜æœ‰ä¸€äº›ç›¸å…³çš„ï¼šæ²™ç®±å®‰å…¨æœºåˆ¶ã€åŠ¨æ€é€ƒé€¸</p><h4 id="JVM-ç»„æˆ"><a href="#JVM-ç»„æˆ" class="headerlink" title="JVM ç»„æˆ"></a>JVM ç»„æˆ</h4><blockquote><p>JVM æ˜¯ ä»€ä¹ˆ</p></blockquote><p>Java Virtul Machineï¼šJava ç¨‹åºçš„è¿è¡Œç¯å¢ƒ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305151245.png" alt="image.png"></p><blockquote><p>JVM ç»„æˆ</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305151409.png" alt="image.png"></p><blockquote><p>ç¨‹åºè®¡æ•°å™¨</p></blockquote><p>ç¨‹åºè®¡æ•°å™¨ï¼šç”¨äºè®°å½•æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305151905.png" alt="image.png"></p><blockquote><p>Java å †</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305152210.png" alt="image.png"></p><blockquote><p>è™šæ‹Ÿæœºæ ˆ</p></blockquote><p>ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœºæ ˆ</p><ul><li>æ¯ä¸ªçº¿ç¨‹è¿è¡Œæ—¶æ‰€éœ€è¦çš„å†…å­˜ï¼Œæˆä¸ºè™šæ‹Ÿæœºæ ˆ</li><li>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆframeï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜</li><li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•</li></ul><p>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜</p><ul><li>åƒåœ¾å›æ”¶ä¸»è¦æŒ‡å°±æ˜¯å †å†…å­˜ï¼Œå½“æ ˆå¸§å¼¹æ ˆä»¥åï¼Œå†…å­˜å°±ä¼šé‡Šæ”¾</li></ul><p>æ ˆå†…å­˜åˆ†é…è¶Šå¤§è¶Šå¥½å—</p><ul><li>æœªå¿…ï¼Œé»˜è®¤çš„æ ˆå†…å­˜é€šå¸¸ä¸º 1024 K, æ ˆå¸§è¿‡å¤§ä¼šå¯¼è‡´çº¿ç¨‹æ•°å˜å°‘</li></ul><p>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨</p><ul><li>å¦‚æœæ–¹æ³•å†…å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œä»–æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>å¦‚æœæ˜¯å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡ï¼Œå¹¶é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</li></ul><p>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´æ ˆå†…å­˜æº¢å‡º</p><ul><li>1ã€æ ˆå¸§è¿‡å¤šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œå…¸å‹é—®é¢˜ï¼šé€’å½’è°ƒç”¨</li><li>2ã€æ ˆå¸§è¿‡å¤§å¯¼è‡´æ ˆå†…å­˜æº¢å‡º</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305152825.png" alt="image.png"></p><p>å †æ ˆçš„åŒºåˆ« æ˜¯ ä»€ä¹ˆ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305153247.png" alt="image.png"></p><blockquote><p>æ–¹æ³•åŒº</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305162830.png" alt="image.png"></p><blockquote><p>è¿è¡Œæ—¶å¸¸é‡æ± </p></blockquote><p>å¸¸é‡æ± </p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305163117.png" alt="image.png"></p><p>è¿è¡Œæ—¶å¸¸é‡æ± </p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305163147.png" alt="image.png"></p><p>æ€»ç»“ï¼ˆæ–¹æ³•åŒºï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305163227.png" alt="image.png"></p><blockquote><p>ç›´æ¥å†…å­˜</p></blockquote><p>å…ˆçœ‹ä¸€ä¸‹æ™®é€š IO å’Œ NIO çš„æ•°æ®æ‹·è´å›¾ç¤ºåŒºåˆ«</p><p>æ™®é€š IO</p><p>ä½¿ç”¨å¸¸è§„IO è¿›è¡Œæ•°æ®æ‹·è´çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨åˆ° Java ç¼“å†²åŒº å’Œ æ“ä½œç³»ç»Ÿçš„ ç³»ç»Ÿç¼“å­˜åŒºçš„ä¸¤ä¸ªç¼“å­˜åŒºçš„æ•°æ®äº¤äº’ï¼ˆJava ä¸èƒ½ç›´æ¥è®¿é—®ç³»ç»Ÿç¼“å­˜åŒºï¼Œä¸¤ä¸ªç¼“å­˜åŒºä¹‹é—´æœ‰ä¸€ä¸ªæ•°æ®å¤åˆ¶è€—æ—¶ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305163718.png" alt="image.png"></p><p>NIO</p><p>æä¾›äº†ä¸€ä¸ªç›´æ¥å†…å­˜ï¼ˆJava èƒ½ç›´æ¥è®¿é—®ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305163657.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305163930.png" alt="image.png"></p><h4 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h4><blockquote><p>ç±»åŠ è½½å™¨</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305164418.png" alt="image.png"></p><blockquote><p>åŒäº²å§”æ´¾æœºåˆ¶</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305164609.png" alt="image.png"></p><blockquote><p>ç±»è£…è½½çš„è¿‡ç¨‹</p></blockquote><p>æ€»ä½“çš„ä¸€ä¸ªè¿‡ç¨‹ï¼šåŠ è½½ â†’  éªŒè¯  â†’  å‡†å¤‡  â†’  è§£æ  â†’  åˆå§‹åŒ–   â†’   ä½¿ç”¨   â†’    å¸è½½</p><p> åŠ è½½</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305164809.png" alt="image.png"></p><p>éªŒè¯</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305164938.png" alt="image.png"></p><p>å‡†å¤‡</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305165107.png" alt="image.png"></p><p>è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305165526.png" alt="image.png"></p><p>åˆå§‹åŒ–ï¼šå¯¹ç±»çš„é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—æ‰§è¡Œåˆå§‹åŒ–æ“ä½œã€‚</p><p>åˆå§‹åŒ–çš„æ—¶å€™å…³äºå­ç±»å’Œçˆ¶ç±»ä»¥åŠé™æ€å˜é‡çš„åŠ è½½é¡ºåºå¯èƒ½è¦æ³¨æ„ä¸€ä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305165711.png" alt="image.png"></p><p>ä½¿ç”¨ï¼š JVM å¼€å§‹ä»å…¥å£æ–¹æ³•å¼€å§‹æ‰§è¡Œç”¨æˆ·çš„ç¨‹åºä»£ç ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305165803.png" alt="image.png"></p><p>å¸è½½ï¼šå½“ç”¨æˆ·ç¨‹åºä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒJVMä¾¿å¼€å§‹é”€æ¯åˆ›å»ºçš„ Class å¯¹è±¡ã€‚</p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305165216.png" alt="image.png"></p><h4 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h4><blockquote><p>å¯¹è±¡ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«åƒåœ¾å™¨å›æ”¶</p></blockquote><p>åˆ¤æ–­å¯¹è±¡æ˜¯åƒåœ¾ï¼Œåˆ™è¿›è¡Œå›æ”¶</p><p>å›æ”¶ç¡®è®¤åƒåœ¾çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ul><li>å¼•ç”¨è®¡æ•°æ³•</li><li>å¯è¾¾æ€§åˆ†æç®—æ³•</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305173256.png" alt="image.png"></p><blockquote><p>å¼•ç”¨è®¡æ•°æ³•</p></blockquote><p>å¼•ç”¨è®¡æ•°æ³•ï¼šä¸€ä¸ªå¯¹è±¡è¢«å¼•ç”¨äº†ä¸€æ¬¡ï¼Œåœ¨å½“å‰çš„å¯¹è±¡å¤´ä¸Šé€’å¢ä¸€æ¬¡å¼•ç”¨æ¬¡æ•°ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ä¸º0ï¼Œä»£è¡¨è¿™ä¸ªå¯¹è±¡å¯å›æ”¶</p><ul><li>é—®é¢˜ï¼šå½“å¯¹è±¡é—´å‡ºç°äº†å¾ªç¯å¼•ç”¨ï¼Œåˆ™å¼•ç”¨æŠ€æœ¯æ³•ä¼šå¤±æ•ˆï¼ˆä¸¤ä¸ªçš„å¼•ç”¨æ¬¡æ•°éƒ½ä¸æ˜¯0ï¼Œä¸ä½¿ç”¨çš„æ—¶å€™å¼•ç”¨æ¬¡æ•°äº’ç›¸ä¸º 1ï¼‰</li></ul><blockquote><p>å¯è¾¾æ€§åˆ†æç®—æ³•</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305173812.png" alt="image.png"></p><blockquote><p>å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º GC Root ï¼Ÿ</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305173900.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305173920.png" alt="image.png"></p><hr><blockquote><p>åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›</p></blockquote><ul><li>æ ‡è®°æ¸…é™¤ç®—æ³•</li><li>å¤åˆ¶ç®—æ³•</li><li>æ ‡è¯†æ•´ç†ç®—æ³•</li></ul><blockquote><p>æ ‡è®°æ¸…é™¤ç®—æ³•</p></blockquote><p>ï¼ˆä½¿ç”¨è¾ƒå°‘ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305174057.png" alt="image.png"></p><blockquote><p>æ ‡è®°æ•´ç†ç®—æ³•</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305174152.png" alt="image.png"></p><blockquote><p>å¤åˆ¶ç®—æ³•</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305174224.png" alt="image.png"></p><p>æ€»ç»“ï¼š</p><ul><li>æ ‡è®°æ¸…é™¤ç®—æ³•ï¼ˆä½¿ç”¨è¾ƒå°‘ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼‰</li><li>æ ‡è¯†æ•´ç†ç®—æ³•ï¼ˆè€å¹´ä»£ç”¨è¿™ç§æ–¹å¼å›æ”¶å¤šä¸€äº›ï¼‰</li><li>å¤åˆ¶ç®—æ³•ï¼ˆæ–°ç”Ÿä»£ç”¨è¿™ç§æ–¹å¼å›æ”¶å¤šä¸€äº›ï¼‰</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305174310.png" alt="image.png"></p><hr><blockquote><p>è¯´ä¸€ä¸‹ JVM çš„åˆ†ä»£å›æ”¶</p></blockquote><p>å·¥ä½œæœºåˆ¶</p><ul><li>1ã€æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œéƒ½ä¼šå…ˆåˆ†é…åˆ°edenåŒº</li><li>2ã€å½“ä¼Šç”¸å›­å†…å­˜ä¸è¶³ï¼Œæ ‡è®°ä¼Šç”¸å›­ä¸ from(ç°é˜¶æ®µæ²¡æœ‰) çš„å­˜æ´»å¯¹è±¡</li><li>3ã€å°†å­˜æ´»å¯¹è±¡é‡‡ç”¨å¤åˆ¶ç®—æ³•å¤åˆ¶åˆ°toä¸­ï¼Œå¤åˆ¶å®Œæ¯•åï¼Œä¼Šç”¸å›­å’Œ fromå†…å­˜éƒ½å¾—åˆ°é‡Šæ”¾</li><li>4ã€ç»è¿‡ä¸€æ®µæ—¶é—´åä¼Šç”¸å›­çš„å†…å­˜åˆå‡ºç°ä¸è¶³ï¼Œæ ‡è®°edenåŒºåŸŸtoåŒºå­˜æ´»çš„å¯¹è±¡ï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°fromåŒº</li><li>5ã€å½“å¹¸å­˜åŒºå¯¹è±¡ç†¬è¿‡å‡ æ¬¡å›æ”¶ï¼ˆæœ€å¤š15æ¬¡)ï¼Œæ™‹å‡åˆ°è€å¹´ä»£ï¼ˆå¹¸å­˜åŒºå†…å­˜ä¸è¶³æˆ–å¤§å¯¹è±¡ä¼šå¯¼è‡´æå‰æ™‹å‡ï¼‰</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305174530.png" alt="image.png"></p><blockquote><p>MinorGCã€Mixed GCã€FullGC çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305175024.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305175134.png" alt="image.png"></p><hr><p>åƒåœ¾å›æ”¶å™¨</p><p>åœ¨ jvm ä¸­ï¼Œå®ç°äº†å¤šç§åƒåœ¾æ”¶é›†å™¨ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨</li><li>å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨</li><li>CMS(å¹¶å‘)åƒåœ¾æ”¶é›†å™¨</li><li>G1åƒåœ¾æ”¶é›†å™¨</li></ul><p>ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305175345.png" alt="image.png"></p><p>å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305175531.png" alt="image.png"></p><p>CMS(å¹¶å‘)åƒåœ¾æ”¶é›†å™¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305175707.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305175748.png" alt="image.png"></p><hr><blockquote><p>G1 åƒåœ¾æ”¶é›†å™¨</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305175902.png" alt="image.png"></p><p>Young Collection(å¹´è½»ä»£åƒåœ¾å›æ”¶)</p><ul><li>1ã€åˆå§‹æ—¶ï¼Œæ‰€æœ‰åŒºåŸŸéƒ½å¤„äºç©ºé—²çŠ¶æ€</li><li>2ã€åˆ›å»ºäº†ä¸€äº›å¯¹è±¡ï¼ŒæŒ‘å‡ºä¸€äº›ç©ºé—²åŒºåŸŸä½œä¸ºä¼Šç”¸å›­åŒºå­˜å‚¨è¿™äº›å¯¹è±¡</li><li>3ã€å½“ä¼Šç”¸å›­éœ€è¦åƒåœ¾å›æ”¶æ—¶ï¼ŒæŒ‘å‡ºä¸€ä¸ªç©ºé—²åŒºåŸŸä½œä¸ºå¹¸å­˜åŒºï¼Œç”¨å¤åˆ¶ç®—æ³•å¤åˆ¶å­˜æ´»å¯¹è±¡ï¼Œéœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹</li><li>5ã€éšç€æ—¶é—´æµé€ï¼Œä¼Šç”¸å›­çš„å†…å­˜åˆæœ‰ä¸è¶³</li><li>6ã€å°†ä¼Šç”¸å›­ä»¥åŠä¹‹å‰å¹¸å­˜åŒºä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œå¤åˆ¶åˆ°æ–°çš„å¹¸å­˜åŒºï¼Œå…¶ä¸­è¾ƒè€å¯¹è±¡æ™‹å‡è‡³è€å¹´ä»£</li></ul><p>Young Collection+Concurrent Mark(å¹´è½»ä»£åƒåœ¾å›æ”¶+å¹¶å‘æ ‡è®°)</p><ul><li><p>å½“è€å¹´ä»£å ç”¨å†…å­˜è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤æ˜¯45%ï¼‰åï¼Œè§¦å‘å¹¶å‘æ ‡è®°ï¼Œè¿™æ—¶æ— éœ€æš‚åœç”¨æˆ·çº¿ç¨‹</p></li><li><p>å¹¶å‘æ ‡è®°ä¹‹åï¼Œä¼šæœ‰é‡æ–°æ ‡è®°é˜¶æ®µè§£å†³æ¼æ ‡é—®é¢˜ï¼Œæ­¤æ—¶éœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ã€‚</p></li><li><p>è¿™äº›éƒ½å®Œæˆåå°±çŸ¥é“äº†è€å¹´ä»£æœ‰å“ªäº›å­˜æ´»å¯¹è±¡ï¼Œéšåè¿›å…¥æ··åˆæ”¶é›†é˜¶æ®µã€‚æ­¤æ—¶ä¸ä¼šå¯¹æ‰€æœ‰è€å¹´ä»£åŒºåŸŸè¿›è¡Œå›æ”¶ï¼Œè€Œæ˜¯æ ¹æ®æš‚åœæ—¶é—´ç›®æ ‡ä¼˜å…ˆå›æ”¶ä»·å€¼é«˜ï¼ˆå­˜æ´»å¯¹è±¡å°‘ï¼‰çš„åŒºåŸŸï¼ˆè¿™ä¹Ÿæ˜¯Gabage Firståç§°çš„ç”±æ¥ï¼‰ã€‚</p></li></ul><p>Mixed Collection(æ··åˆåƒåœ¾å›æ”¶)</p><p>å¤åˆ¶å®Œæˆï¼Œå†…å­˜å¾—åˆ°é‡Šæ”¾ã€‚è¿›å…¥ä¸‹ä¸€è½®çš„æ–°ç”Ÿä»£å›æ”¶ã€å¹¶å‘æ ‡è®°ã€æ··åˆæ”¶é›†</p><p>å…¶ä¸­å¤§å¯¹è±¡å¦‚æœä¸€ä¸ªå›ºå®šåŒºåŸŸä¸å¤Ÿçš„è¯ï¼Œä¼šåˆ†é…ä¸€ä¸ªè¿ç»­çš„ç©ºé—´ç»™ä»–</p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305180830.png" alt="image.png"></p><hr><blockquote><p>å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨çš„åŒºåˆ«ï¼Ÿ</p></blockquote><ul><li>å¼ºå¼•ç”¨</li><li>è½¯å¼•ç”¨</li><li></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305180957.png" alt="image.png"></p><p>å¼±å¼•ç”¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305181051.png" alt="image.png"></p><p>è™šå¼•ç”¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305181207.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305181232.png" alt="image.png"></p><h4 id="JVM-å®è·µ"><a href="#JVM-å®è·µ" class="headerlink" title="JVM å®è·µ"></a>JVM å®è·µ</h4><blockquote><p>JVM è°ƒä¼˜å‚æ•°å¯ä»¥åœ¨å“ªé‡Œè®¾ç½®å‚æ•°å€¼</p></blockquote><p>ä¸€èˆ¬æ˜¯åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯ tomcat çš„ war åŒ…ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ SpringBoot æ‰“åŒ…çš„ Jar åŒ… </p><p>War åŒ…</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305181344.png" alt="image.png"></p><p>Jar åŒ…</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305181440.png" alt="image.png"></p><p>æ€»ç»“ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305181455.png" alt="image.png"></p><hr><blockquote><p>JVM è°ƒä¼˜å‚æ•°æœ‰å“ªäº›</p></blockquote><p>å®˜ç½‘å‚è€ƒï¼š <a href="https://www.oracle.com/java/technologies/javase/vmoptions-jsp.html">https://www.oracle.com/java/technologies/javase/vmoptions-jsp.html</a></p><p>ä¸€èˆ¬ä¸ä¼šç”¨åˆ°å¾ˆå¤š</p><p>å¯¹äº JVMè°ƒä¼˜ï¼Œä¸»è¦å°±æ˜¯è°ƒæ•´å¹´è½»ä»£ã€è€å¹´ä»£ã€å…ƒç©ºé—´çš„å†…å­˜ç©ºé—´å¤§å°åŠä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨ç±»å‹ã€‚</p><ul><li>è®¾ç½®å †ç©ºé—´å¤§å°</li><li>è™šæ‹Ÿæœºæ ˆçš„è®¾ç½®</li><li>å¹´è½»ä»£ä¸­EdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºçš„å¤§å°æ¯”ä¾‹</li><li>å¹´è½»ä»£æ™‹å‡è€å¹´ä»£é˜ˆå€¼</li><li>è®¾ç½®åƒåœ¾å›æ”¶æ”¶é›†å™¨</li></ul><p>è®¾ç½®å †ç©ºé—´å¤§å°</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305181900.png" alt="image.png"></p><p>è™šæ‹Ÿæœºæ ˆçš„è®¾ç½®</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305181941.png" alt="image.png"></p><p>å¹´è½»ä»£ä¸­ Eden åŒºå’Œ ä¸¤ä¸ª Survivor åŒºçš„å¤§å°æ¯”ä¾‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305182044.png" alt="image.png"></p><p>è®¾ç½®åƒåœ¾å›æ”¶æ”¶é›†å™¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305182124.png" alt="image.png"></p><p>æ€»ç»“</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305182217.png" alt="image.png"></p><hr><blockquote><p>è¯´ä¸€ä¸‹ JVM è°ƒä¼˜çš„å·¥å…·</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305182245.png" alt="image.png"></p><p>å…·ä½“å¾…å®è·µä½¿ç”¨ä¸€ä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305182346.png" alt="image.png"></p><ul><li>jmap</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305182527.png" alt="image.png"></p><ul><li>jstat</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305182633.png" alt="image.png"></p><ul><li>è°ƒä¼˜å·¥å…·ï¼šjconsole</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305182745.png" alt="image.png"></p><ul><li>è°ƒä¼˜å·¥å…· VisualVM</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305182942.png" alt="image.png"></p><p>æŸ¥çœ‹è¿è¡Œä¸­çš„dump</p><p>Dumpæ–‡ä»¶æ˜¯è¿›ç¨‹çš„å†…å­˜é•œåƒã€‚å¯ä»¥æŠŠç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€é€šè¿‡è°ƒè¯•å™¨ä¿å­˜åˆ°dumpæ–‡ä»¶ä¸­</p><p><a href="https://zhuanlan.zhihu.com/p/372721732">https://zhuanlan.zhihu.com/p/372721732</a></p><p>å¯ä»¥ä½¿ç”¨ JProfiler å·¥å…·æ¥æŸ¥çœ‹</p><p>æˆ–è€…</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305183605.png" alt="image.png"></p><p>æ€»ç»“ï¼šç•¥</p><hr><blockquote><p>Java å†…å­˜æ³„æ¼çš„æ’æŸ¥æ€è·¯</p></blockquote><p>Java çš„å†…å­˜æº¢å‡ºæœ‰ä¸‰ä¸ªæ–¹å‘ï¼šæ ˆã€å…ƒç©ºé—´å’Œå †ï¼Œæ ˆä¸€èˆ¬æ˜¯é€’å½’è°ƒç”¨é€ æˆï¼Œå †çš„æƒ…å†µæ˜¯å¹³æ—¶æœ€å¤šçš„æ—¶å€™ï¼Œä¸€èˆ¬è€ƒå¯Ÿä¹Ÿæ˜¯é—®å †å†…å­˜æº¢å‡ºæ€ä¹ˆæ’æŸ¥ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305183716.png" alt="image.png"></p><p>æ’æŸ¥çš„è¯ï¼Œæä¾›ä¸€ç§æ–¹æ³•ï¼šç”Ÿæˆ dump æ–‡ä»¶ï¼Œç„¶ååˆ†æè¿™ä¸ª dump æ–‡ä»¶</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305183831.png" alt="image.png"></p><p>ç”Ÿæˆ dump æ–‡ä»¶ï¼š</p><ul><li>ä¸€èˆ¬æ˜¯è®¾ç½® JVM å‚æ•°ï¼Œæœ‰æ—¶å€™ç¨‹åºæ˜¯ç›´æ¥é—ªé€€æŒ‚äº†ï¼Œä¸å¤ªå¯èƒ½è®©ä½ è¿è¡Œçš„æ—¶å€™ä½¿ç”¨  jmap å‘½ä»¤ï¼ˆä½¿ç”¨ vm å‚æ•°è·å– dump æ–‡ä»¶ï¼‰</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305184231.png" alt="image.png"></p><p>åˆ†æ dump æ–‡ä»¶</p><ul><li>1ã€æ‰“å¼€ VisualVM</li><li>2ã€é€‰æ‹©ï¼šæ–‡ä»¶ â†’  è£…å…¥  â†’  ï¼ˆé€‰æ‹©æ–‡ä»¶ï¼‰ â†’  æ‰“å¼€</li><li>3ã€æ¦‚è¦  â†’  å †è½¬å‚¨</li><li>4ã€é€šè¿‡æŸ¥çœ‹å †ä¿¡æ¯çš„æƒ…å†µï¼Œå¯ä»¥å¤§æ¦‚å®šä½å†…å­˜è°¥å‡ºæ˜¯å“ªè¡Œä»£ç å‡ºäº†é—®é¢˜</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305184450.png" alt="image.png"></p><p>æ€»ç»“ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305184724.png" alt="image.png"></p><hr><blockquote><p>CPU é£™é«˜æ’æŸ¥æ€è·¯</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305185105.png" alt="image.png"></p><p>å‚è€ƒï¼š <a href="https://www.bilibili.com/video/BV1yT411H7YK/?p=134&spm_id_from=pageDriver&vd_source=6a019ecccfe7d8f62b9a3fe99c723bd0">https://www.bilibili.com/video/BV1yT411H7YK/?p=134&amp;spm_id_from=pageDriver&amp;vd_source=6a019ecccfe7d8f62b9a3fe99c723bd0</a></p><p>åˆ†æä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹</p><ul><li>1ã€ä½¿ç”¨<code>top</code>å‘½ä»¤æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µï¼Œç¡®è®¤é—®é¢˜çš„å­˜åœ¨ã€‚</li><li>2ã€åœ¨<code>top</code>å‘½ä»¤è¾“å‡ºä¸­ï¼Œæ‰¾åˆ°CPUä½¿ç”¨ç‡æœ€é«˜çš„Javaè¿›ç¨‹ï¼Œè®°ä¸‹å®ƒçš„PIDã€‚æ¯”å¦‚ï¼ŒJavaè¿›ç¨‹çš„PIDä¸º12345ã€‚</li><li>3ã€ä½¿ç”¨<code>jstack</code>å‘½ä»¤å¯¼å‡ºJavaè¿›ç¨‹çš„çº¿ç¨‹å †æ ˆä¿¡æ¯åˆ°æ–‡ä»¶ã€‚</li><li>4ã€æ‰¾å‡ºCPUä½¿ç”¨ç‡æœ€é«˜çš„çº¿ç¨‹</li></ul><hr><p><strong>æŸ¥çœ‹è¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¿¡æ¯</strong></p><p>é¦–å…ˆï¼Œä½¿ç”¨<code>ps</code>ã€<code>top</code>ã€æˆ–<code>jps</code>ï¼ˆJava Virtual Machine Process Status Toolï¼‰å‘½ä»¤æ‰¾åˆ°Javaè¿›ç¨‹çš„PIDï¼ˆProcess IDï¼‰</p><p>ä½¿ç”¨<code>top</code>å‘½ä»¤ä»¥çº¿ç¨‹æ¨¡å¼è¿è¡Œï¼ŒæŒ‡å®šJavaè¿›ç¨‹çš„PIDï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-attribute">top</span> -H -<span class="hljs-selector-tag">p</span> <span class="hljs-number">12345</span><br></code></pre></td></tr></table></figure><p>è¿™å°†æ˜¾ç¤ºè¿›ç¨‹<code>12345</code>ä¸­æ‰€æœ‰çº¿ç¨‹çš„CPUä½¿ç”¨æƒ…å†µï¼ˆåˆ‡æ¢åˆ°<code>top</code>å‘½ä»¤çš„çº¿ç¨‹è§†å›¾ï¼ŒæŸ¥çœ‹é«˜CPUä½¿ç”¨çš„çº¿ç¨‹ã€‚ï¼‰</p><blockquote><p>å°†çº¿ç¨‹IDè½¬æ¢ä¸º16è¿›åˆ¶</p></blockquote><p>Linuxç³»ç»Ÿä¸­<code>top</code>å‘½ä»¤æ˜¾ç¤ºçš„æ˜¯çº¿ç¨‹çš„PIDï¼ˆå®é™…ä¸Šæ˜¯è½»é‡çº§è¿›ç¨‹IDï¼ŒLWP IDï¼‰ï¼Œéœ€è¦å°†å…¶è½¬æ¢ä¸º16è¿›åˆ¶ï¼Œä»¥åŒ¹é…<code>jstack</code>è¾“å‡ºä¸­çš„çº¿ç¨‹IDã€‚</p><p>å‡è®¾çº¿ç¨‹IDæ˜¯<code>6789</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>printf</code>å‘½ä»¤è¿›è¡Œè½¬æ¢ï¼š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">printf</span> <span class="hljs-string">&quot;%x\n&quot;</span> <span class="hljs-number">6789</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºå°†æ˜¯çº¿ç¨‹IDçš„16è¿›åˆ¶è¡¨ç¤ºã€‚</p><blockquote><p>è·å–çº¿ç¨‹å †æ ˆ</p></blockquote><p>ä½¿ç”¨<code>jstack</code>å‘½ä»¤å¯¼å‡ºJavaè¿›ç¨‹çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">jstack</span> <span class="hljs-number">12345</span> &gt; threadDump.txt<br></code></pre></td></tr></table></figure><p>è¿™å°†æŠŠè¿›ç¨‹<code>12345</code>çš„æ‰€æœ‰çº¿ç¨‹å †æ ˆä¿¡æ¯è¾“å‡ºåˆ°<code>threadDump.txt</code>æ–‡ä»¶ä¸­ã€‚</p><p>åœ¨<code>threadDump.txt</code>æ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾è½¬æ¢ä¸º16è¿›åˆ¶çš„çº¿ç¨‹IDå¯¹åº”çš„å †æ ˆä¿¡æ¯ã€‚è¿™é€šå¸¸ä»¥<code>nid=0x</code>å¼€å¤´ï¼Œåè·Ÿçº¿ç¨‹çš„16è¿›åˆ¶IDã€‚</p><p>å®šä½åˆ°é«˜CPUä½¿ç”¨çº¿ç¨‹çš„å †æ ˆä¿¡æ¯åï¼Œåˆ†æå®ƒæ­£åœ¨æ‰§è¡Œçš„ä»£ç ã€‚æŸ¥æ‰¾è¯¥å †æ ˆä¸­çš„Javaæ–¹æ³•å’Œç±»ï¼Œç‰¹åˆ«å…³æ³¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä»£ç ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240305190353.png" alt="image.png"></p><hr><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/java/jvm/memory-area.html">https://javaguide.cn/java/jvm/memory-area.html</a></li><li><a href="https://www.pdai.tech/md/interview/x-interview.html#_5-jvm%E5%92%8C%E8%B0%83%E4%BC%98">https://www.pdai.tech/md/interview/x-interview.html#_5-jvm%E5%92%8C%E8%B0%83%E4%BC%98</a></li><li><a href="http://moxi159753.gitee.io/learningnotes/#/">http://moxi159753.gitee.io/learningnotes/#/</a></li><li><a href="https://www.bilibili.com/video/BV1iJ411d7jS">https://www.bilibili.com/video/BV1iJ411d7jS</a></li><li><a href="https://blog.csdn.net/fllow_wind/article/details/117027924">https://blog.csdn.net/fllow_wind/article/details/117027924</a></li><li><a href="https://zhuanlan.zhihu.com/p/25713880">https://zhuanlan.zhihu.com/p/25713880</a></li><li><a href="https://blog.csdn.net/xianyun1992/article/details/126555575">https://blog.csdn.net/xianyun1992/article/details/126555575</a></li><li><a href="https://zhuanlan.zhihu.com/p/626321410">https://zhuanlan.zhihu.com/p/626321410</a></li><li><a href="https://www.bilibili.com/video/BV1yT411H7YK">https://www.bilibili.com/video/BV1yT411H7YK</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>JVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>jvm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå­¦ä¹ _å®˜æ–¹æ–‡æ¡£å­¦ä¹ </title>
    <link href="/2024/02/22/Spring%E5%AD%A6%E4%B9%A0_%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0/"/>
    <url>/2024/02/22/Spring%E5%AD%A6%E4%B9%A0_%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š <a href="https://spring.io/projects/spring-framework">https://spring.io/projects/spring-framework</a></p><p>to be continedâ€¦</p><p>Spring çš„è¿™éƒ¨åˆ†å†…å®¹éœ€è¦å†å­¦ä¹ ä¸€ä¸‹ï¼Œæ ¹æ®æºç å’Œå®˜æ–¹æ–‡æ¡£ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootå­¦ä¹ _åŸºç¡€å†…å®¹</title>
    <link href="/2024/02/19/SpringBoot%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/"/>
    <url>/2024/02/19/SpringBoot%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒä¸€ä¸‹è¿™ä¸ªæ•´åˆä¸€ä¸‹ç›¸å…³å†…å®¹ï¼š <a href="https://www.yuque.com/snailclimb/mf2z3k/vqe4gz">https://www.yuque.com/snailclimb/mf2z3k/vqe4gz</a></p><p>å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://spring.io/projects/spring-boot/">https://spring.io/projects/spring-boot/</a></p><p>å‚è€ƒï¼š</p><ul><li><a href="https://springdoc.cn/spring-boot/">https://springdoc.cn/spring-boot/</a></li><li><a href="https://pdai.tech/md/spring/springboot/springboot.html">https://pdai.tech/md/spring/springboot/springboot.html</a></li></ul><h3 id="ä¸€ã€åŸºç¡€çŸ¥è¯†"><a href="#ä¸€ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="ä¸€ã€åŸºç¡€çŸ¥è¯†"></a>ä¸€ã€åŸºç¡€çŸ¥è¯†</h3><p>ä¸ç®¡æ˜¯åœ¨å®˜æ–¹æ–‡æ¡£æˆ–è€…æ˜¯Githubä¸Šï¼Œå¯¹äºSpringBoot çš„ç›¸å…³æ•™ç¨‹æ˜¯å¹¶ä¸å°‘çš„ï¼Œé™¤äº†SpringBootçš„å¼€ç®±å³ç”¨ï¼Œå’Œç¬¬ä¸‰æ–¹æ¡†æ¶çš„é›†æˆä»¥åŠå…·ä½“çš„ä½¿ç”¨æ¡ˆä¾‹ä¹Ÿå æ®äº†å®ƒçš„å¤§éƒ¨åˆ†ç¯‡å¹…ã€‚</p><p>åœ¨é‡åˆ°SpringBoot çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå¾€å¾€æ˜¯ä¼šé—®ï¼šä¸ºä»€ä¹ˆæœ‰äº†SpringFrameworkè¿˜ä¼šè¯ç”ŸSpringBootï¼Ÿ</p><p>æ ¸å¿ƒå›ç­”å°±æ˜¯ï¼šç®€åŒ–é…ç½®ï¼Œå¼€ç®±å³ç”¨ã€‚</p><p>è™½ç„¶Springçš„ç»„ä»¶ä»£ç æ˜¯è½»é‡çº§çš„ï¼Œä½†å®ƒçš„é…ç½®å´æ˜¯é‡é‡çº§çš„ï¼›æ‰€ä»¥SpringBootçš„è®¾è®¡ç­–ç•¥æ˜¯é€šè¿‡å¼€ç®±å³ç”¨å’Œçº¦å®šå¤§äºé…ç½® æ¥è§£å†³é…ç½®é‡çš„é—®é¢˜ã€‚</p><p>å…³äºè‡ªåŠ¨è£…é…åŸç†ï¼Œå’Œæ‰‹æ’¸ä¸€ä¸ª Starter å¯ä»¥è§å¦å¤–ä¸€ç¯‡articleï¼š[[SpringBootå­¦ä¹ _SpringBootè‡ªåŠ¨è£…é…åŸç†]]</p><h3 id="äºŒã€åŸºç¡€å†…å®¹"><a href="#äºŒã€åŸºç¡€å†…å®¹" class="headerlink" title="äºŒã€åŸºç¡€å†…å®¹"></a>äºŒã€åŸºç¡€å†…å®¹</h3><h4 id="2-1-é…ç½®æ–‡ä»¶æ ¼å¼"><a href="#2-1-é…ç½®æ–‡ä»¶æ ¼å¼" class="headerlink" title="2.1  é…ç½®æ–‡ä»¶æ ¼å¼"></a>2.1  é…ç½®æ–‡ä»¶æ ¼å¼</h4><blockquote><p>Spring Bootçš„é…ç½®æ–‡ä»¶æœ‰å“ªå‡ ç§æ ¼å¼ï¼Ÿæ ¸å¿ƒé…ç½®æ–‡ä»¶æœ‰å“ªäº›ï¼Ÿ</p></blockquote><p>Spring Bootæ”¯æŒä»¥ä¸‹å‡ ç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼š</p><ol><li><strong>propertiesæ–‡ä»¶</strong>ï¼šä¼ ç»Ÿçš„Javaå±æ€§æ–‡ä»¶ï¼Œä½¿ç”¨<code>.properties</code>åç¼€ï¼Œæ–‡ä»¶æ ¼å¼æ˜¯é”®å€¼å¯¹å½¢å¼ï¼Œæ–‡ä»¶åé€šå¸¸æ˜¯<code>application.properties</code>æˆ–<code>bootstrap.properties</code>ã€‚</li><li><strong>YAMLæ–‡ä»¶</strong>ï¼šæ›´ä¸ºç°ä»£çš„é…ç½®æ–‡ä»¶æ ¼å¼ï¼Œä½¿ç”¨<code>.yml</code>æˆ–<code>.yaml</code>åç¼€ï¼Œä½¿ç”¨ç¼©è¿›æ¥è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œæ–‡ä»¶åé€šå¸¸æ˜¯<code>application.yml</code>æˆ–<code>bootstrap.yml</code>ã€‚</li></ol><p>æ ¸å¿ƒé…ç½®æ–‡ä»¶é€šå¸¸æ˜¯æŒ‡ï¼š</p><ol><li><strong>application.properties</strong> æˆ– <strong>application.yml</strong>ï¼šè¿™æ˜¯Spring Bootçš„ä¸»è¦é…ç½®æ–‡ä»¶ã€‚åœ¨æ­¤æ–‡ä»¶ä¸­å®šä¹‰çš„å±æ€§å¯ä»¥åº”ç”¨äºä½ çš„Spring Bootåº”ç”¨ç¨‹åºçš„ä»»ä½•éƒ¨åˆ†ã€‚</li><li><strong>bootstrap.properties</strong> æˆ– <strong>bootstrap.yml</strong>ï¼šå½“ä½¿ç”¨Spring Cloud Configæ—¶ï¼Œè¿™äº›æ–‡ä»¶ç”¨äºå¤–éƒ¨é…ç½®çš„æ—©æœŸåŠ è½½ã€‚</li></ol><p>è¿™äº›æ–‡ä»¶å¯ä»¥æ”¾åœ¨ä»¥ä¸‹ä½ç½®ï¼š</p><ul><li>é¡¹ç›®çš„æ ¹ç›®å½•ã€‚</li><li><code>/config</code> å­ç›®å½•ã€‚</li><li>ç±»è·¯å¾„çš„æ ¹ç›®å½• (<code>/resources</code> æˆ– <code>/src/main/resources</code>)ã€‚</li><li>ç±»è·¯å¾„çš„<code>/config</code> åŒ…ã€‚</li></ul><p>Spring Bootä¼šæŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ¥åŠ è½½è¿™äº›é…ç½®æ–‡ä»¶ï¼Œä»¥ç¡®ä¿å±æ€§çš„æ­£ç¡®è¦†ç›–å’ŒåŠ è½½ã€‚</p><p>ä¸Šé¢æåˆ°çš„  bootstrap é…ç½®æ–‡ä»¶æ˜¯å±äº SpringCloud ç¯å¢ƒï¼Œéœ€è¦å¼•å…¥ç›¸å…³ä¾èµ–ï¼›</p><p>åœ¨ SpringCloud ç¯å¢ƒä¸­ï¼Œ<strong>bootstrapé…ç½®æ–‡ä»¶ä¼šä¼˜å…ˆäºapplicationé…ç½®æ–‡ä»¶åŠ è½½</strong>ï¼Œå®ƒä¸»è¦ç”¨äºä»é¢å¤–çš„èµ„æºæ¥åŠ è½½é…ç½®å‚æ•°ï¼Œé€šå¸¸ç”¨æ¥åŠ è½½å¤–éƒ¨é…ç½®ï¼Œå¦‚Spring Cloudç”¨äºåŠ è½½é…ç½®ä¸­å¿ƒçš„é…ç½®å‚æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å®šä¹‰ç³»ç»Ÿä¸ä¼šè¢«æ”¹å˜çš„å‚æ•°ï¼Œå®ƒä»¬é»˜è®¤ä¸èƒ½è¢«æœ¬åœ°ç›¸åŒçš„é…ç½®æ‰€è¦†ç›–ã€‚</p><h4 id="2-2-é…ç½®åŠ è½½é¡ºåº"><a href="#2-2-é…ç½®åŠ è½½é¡ºåº" class="headerlink" title="2.2 é…ç½®åŠ è½½é¡ºåº"></a>2.2 é…ç½®åŠ è½½é¡ºåº</h4><blockquote><p>Spring Booté…ç½®åŠ è½½é¡ºåºæ˜¯æ€æ ·çš„ï¼Ÿ</p></blockquote><p>Spring Bootçš„é…ç½®åŠ è½½é¡ºåºè®¾è®¡ç”¨äºæ”¯æŒä¸åŒçš„é…ç½®éœ€æ±‚å’Œç¯å¢ƒï¼Œä»è€Œå…è®¸åœ¨è¿è¡Œæ—¶è¦†ç›–åº”ç”¨ç¨‹åºçš„é…ç½®ã€‚ä»¥ä¸‹æ˜¯Spring Booté…ç½®åŠ è½½çš„é¡ºåºï¼Œä»é«˜ä¼˜å…ˆçº§åˆ°ä½ä¼˜å…ˆçº§ï¼š</p><ol><li><strong>å¼€å‘è€…å·¥å…·çš„é…ç½®å±æ€§</strong> (å¦‚æœä½¿ç”¨Spring Bootçš„å¼€å‘è€…å·¥å…·)ã€‚</li><li><strong>å‘½ä»¤è¡Œå‚æ•°</strong> (<code>java -jar myproject.jar --name=&quot;Spring&quot;</code>).</li><li><strong>æ¥è‡ª<code>SPRING_APPLICATION_JSON</code>çš„å±æ€§</strong> (ç¯å¢ƒå˜é‡æˆ–ç³»ç»Ÿå±æ€§ä¸­çš„å†…è”JSON)ã€‚</li><li><strong><code>ServletConfig</code>åˆå§‹åŒ–å‚æ•°</strong>ã€‚</li><li><strong><code>ServletContext</code>åˆå§‹åŒ–å‚æ•°</strong>ã€‚</li><li><strong><code>java:comp/env</code>é‡Œçš„JNDIå±æ€§</strong>ã€‚</li><li><strong>Javaç³»ç»Ÿå±æ€§</strong> (<code>System.getProperties()</code>).</li><li><strong>æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡</strong>ã€‚</li><li><ul><li>åªæœ‰åœ¨random. é‡Œå®šä¹‰çš„éšæœºå±æ€§ã€‚</li></ul></li><li><strong>åº”ç”¨ç¨‹åºåœ¨æ‰“åŒ…æ—¶æä¾›çš„JARæ–‡ä»¶å¤–çš„<code>application.properties</code>æˆ–<code>application.yml</code>æ–‡ä»¶</strong>ã€‚</li><li><strong>åº”ç”¨ç¨‹åºæ‰“åŒ…åœ¨JARå†…çš„<code>application.properties</code>æˆ–<code>application.yml</code>æ–‡ä»¶</strong>ã€‚</li><li><strong>é€šè¿‡<code>@PropertySource</code>æ³¨è§£åœ¨<code>@Configuration</code>ç±»ä¸Šå®šä¹‰çš„å±æ€§</strong>ã€‚</li><li><strong>é»˜è®¤å±æ€§</strong> (é€šè¿‡<code>SpringApplication.setDefaultProperties</code>æŒ‡å®š)ã€‚</li></ol><p>åœ¨è¿™ä¸ªé¡ºåºä¸­ï¼Œè¾ƒé«˜çš„å±æ€§å°†è¦†ç›–è¾ƒä½çš„å±æ€§ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‘½ä»¤è¡Œå‚æ•°å¯ä»¥è¦†ç›–<code>application.properties</code>ä¸­çš„å±æ€§ï¼Œå› ä¸ºå‘½ä»¤è¡Œå‚æ•°çš„ä¼˜å…ˆçº§æ›´é«˜ã€‚</p><p>è¾…åŠ©ç†è§£ï¼š</p><p><strong>å‘½ä»¤è¡Œ &gt; å¤–éƒ¨é…ç½® &gt; å†…éƒ¨é…ç½®</strong></p><p>é‡ç‚¹é…ç½®æ¥æºåŠå…¶ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š</p><ul><li>å‘½ä»¤è¡Œå‚æ•°</li><li>å¤–éƒ¨JaråŒ…é…ç½®æ–‡ä»¶</li><li>åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶</li><li>é»˜è®¤å±æ€§</li></ul><ol><li><strong>å‘½ä»¤è¡Œå‚æ•°</strong>ï¼š<ul><li>æœ€ç›´æ¥çš„è¦†ç›–æ–¹å¼ï¼Œé€‚ç”¨äºä¸´æ—¶æ”¹å˜æŸäº›é…ç½®ã€‚</li><li>ä¾‹å¦‚ï¼š<code>java -jar app.jar --server.port=9090</code></li></ul></li><li><strong>å¤–éƒ¨é…ç½®æ–‡ä»¶</strong>ï¼ˆå¤–éƒ¨<code>application.properties</code>æˆ–<code>application.yml</code>ï¼‰ï¼š<ul><li>è¿™åŒ…æ‹¬ä½äºåº”ç”¨ç¨‹åºjaræ–‡ä»¶åŒçº§ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œæˆ–é€šè¿‡<code>--spring.config.location</code>æŒ‡å®šçš„è·¯å¾„ã€‚</li><li>è¿™äº›é…ç½®æ–‡ä»¶ä¼˜å…ˆäºåº”ç”¨ç¨‹åºå†…éƒ¨çš„é…ç½®æ–‡ä»¶ã€‚</li></ul></li><li><strong>åº”ç”¨ç¨‹åºå†…éƒ¨é…ç½®æ–‡ä»¶</strong>ï¼ˆå†…éƒ¨<code>application.properties</code>æˆ–<code>application.yml</code>ï¼‰ï¼š<ul><li>æ‰“åŒ…åœ¨åº”ç”¨ç¨‹åºjarå†…çš„é…ç½®æ–‡ä»¶ã€‚</li><li>å¯¹äºé»˜è®¤é…ç½®æˆ–å¼€å‘æ—¶çš„é…ç½®éå¸¸æœ‰ç”¨ã€‚</li></ul></li><li><strong><code>@PropertySource</code>æ³¨è§£</strong>ï¼š<ul><li>å¯ä»¥åœ¨Spring <code>@Configuration</code>ç±»ä¸ŠæŒ‡å®šé¢å¤–çš„é…ç½®æºã€‚</li><li>é€‚ç”¨äºæ›´ç»†ç²’åº¦çš„é…ç½®æˆ–ç¯å¢ƒç‰¹å®šé…ç½®ã€‚</li></ul></li><li><strong>é»˜è®¤å±æ€§</strong>ï¼š<ul><li>é€šè¿‡ç¼–ç æ–¹å¼è®¾ç½®çš„é»˜è®¤é…ç½®ï¼Œé€šå¸¸åœ¨åº”ç”¨å¯åŠ¨ç±»ä¸­è®¾ç½®ã€‚</li><li>é€‚ç”¨äºå®šä¹‰å…¨å±€çš„å›é€€é…ç½®ã€‚</li></ul></li></ol><hr><h4 id="2-3-å¸¸ç”¨çš„æ—¥å¿—æ¡†æ¶"><a href="#2-3-å¸¸ç”¨çš„æ—¥å¿—æ¡†æ¶" class="headerlink" title="2.3 å¸¸ç”¨çš„æ—¥å¿—æ¡†æ¶"></a>2.3 å¸¸ç”¨çš„æ—¥å¿—æ¡†æ¶</h4><blockquote><p>Spring Bootæ”¯æŒå“ªäº›æ—¥å¿—æ¡†æ¶ï¼Ÿ</p></blockquote><p>Spring Bootæ”¯æŒä»¥ä¸‹æ—¥å¿—æ¡†æ¶ï¼š</p><ol><li><strong>Logback</strong> (é»˜è®¤): Spring Booté»˜è®¤ä½¿ç”¨Logbackä½œä¸ºæ—¥å¿—æ¡†æ¶ã€‚</li><li><strong>Log4j2</strong>: é€šè¿‡æ’é™¤Spring Bootçš„é»˜è®¤æ—¥å¿—ä¾èµ–å¹¶åŒ…å«log4j2çš„ä¾èµ–ï¼Œå¯ä»¥ä½¿ç”¨Log4j2ã€‚</li><li><strong>JUL (Java Util Logging)</strong>: Spring Bootä¹Ÿæ”¯æŒJULï¼Œä½†é€šå¸¸éœ€è¦é¢å¤–çš„é…ç½®æ¥æ•´åˆã€‚</li><li><strong>SLF4J</strong>: Spring Bootä½¿ç”¨SLF4Jä½œä¸ºæ—¥å¿—æŠ½è±¡å±‚ï¼Œä½ å¯ä»¥å°†å…¶ä¸ä¸Šè¿°ä»»ä½•æ—¥å¿—å®ç°é…åˆä½¿ç”¨ã€‚</li></ol><p>ä¸ºäº†ä½¿ç”¨ç‰¹å®šçš„æ—¥å¿—æ¡†æ¶ï¼Œä½ éœ€è¦åœ¨é¡¹ç›®çš„ä¾èµ–ç®¡ç†æ–‡ä»¶ä¸­ï¼ˆå¦‚pom.xmlæˆ–build.gradleï¼‰åŒ…å«å¯¹åº”çš„ä¾èµ–ï¼Œå¹¶é€‚å½“é…ç½®æ—¥å¿—æ¡†æ¶çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚logback-spring.xml, log4j2.xmlç­‰ï¼‰ã€‚</p><p>åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼šç›®å‰Apacheå·²ç»å®£å¸ƒåœæ­¢å¯¹Log4j 1.xçš„æ›´æ–°å’Œæ”¯æŒï¼Œå¹¶ä¸” Log4j å‡ºç°äº†ä¸¥é‡çš„å®‰å…¨æ¼æ´ï¼ˆå¦‚Log4Shellï¼‰ï¼›å› æ­¤ç›®å‰ SpringBoot ä¹Ÿä¸æ”¯æŒ  Log4j ç‰ˆæœ¬ï¼›æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦é€‰æ‹© <strong>Log4j2</strong> è€Œä¸æ˜¯ Log4jã€‚</p><p>é…ç½®ç¤ºä¾‹ï¼š</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-comment">// Spring Booté…ç½®ç¤ºä¾‹ï¼ŒæŒ‡å®šæ—¥å¿—æ¡†æ¶ä¸ºLogback</span><br><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol">  main:</span><br>    web-application-type: none<br><span class="hljs-symbol">logging:</span><br><span class="hljs-symbol">  config:</span> classpath:logback-spring.xml<br></code></pre></td></tr></table></figure><h4 id="2-4-æ—¥å¿—å±æ€§é…ç½®"><a href="#2-4-æ—¥å¿—å±æ€§é…ç½®" class="headerlink" title="2.4 æ—¥å¿—å±æ€§é…ç½®"></a>2.4 æ—¥å¿—å±æ€§é…ç½®</h4><blockquote><p>Spring Bootå¦‚ä½•é…ç½®æ—¥å¿—ï¼Ÿ</p></blockquote><p>åœ¨Spring Bootä¸­é…ç½®æ—¥å¿—çš„å…³é”®ç‚¹ä¸»è¦æ¶‰åŠåˆ°æ—¥å¿—çº§åˆ«çš„è®¾ç½®ã€æ—¥å¿—è¾“å‡ºçš„å®šä½ä»¥åŠæ—¥å¿—çš„æ ¼å¼è‡ªå®šä¹‰ã€‚è¿™äº›é…ç½®é¡¹å¯ä»¥é€šè¿‡<code>application.properties</code>æˆ–<code>application.yml</code>æ–‡ä»¶æ¥çµæ´»è®¾ç½®ã€‚</p><p>ä¸‹é¢æ˜¯å…³äºè¿™äº›é…ç½®çš„é‡ç‚¹æ•´ç†ï¼š</p><blockquote><ol><li>è®¾ç½®æ—¥å¿—çº§åˆ«</li></ol></blockquote><ul><li><strong>ç›®çš„</strong>ï¼šæ§åˆ¶æ—¥å¿—çš„è¾“å‡ºç²’åº¦ï¼Œä¾‹å¦‚ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½éœ€è¦æ›´è¯¦ç»†çš„æ—¥å¿—ï¼ˆå¦‚<code>DEBUG</code>æˆ–<code>TRACE</code>çº§åˆ«ï¼‰ï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½åªéœ€<code>INFO</code>æˆ–<code>WARN</code>çº§åˆ«çš„æ—¥å¿—ã€‚</li><li><strong>é…ç½®æ–¹å¼</strong>ï¼š<code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code></li><li><strong>ç¤ºä¾‹</strong>ï¼š</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># è®¾ç½®æ ¹æ—¥å¿—è®°å½•å™¨çš„æ—¥å¿—çº§åˆ«ä¸ºWARNï¼Œè¿™æ„å‘³ç€åªæœ‰WARNçº§åˆ«ä»¥ä¸Šçš„æ—¥å¿—æ¶ˆæ¯ï¼ˆWARN, ERROR, FATALï¼‰ä¼šè¢«è®°å½•ã€‚</span><br><span class="hljs-attr">logging.level.root</span>=WARN<br><span class="hljs-comment"># è®¾ç½®org.springframework.webåŒ…ä¸‹çš„æ—¥å¿—è®°å½•å™¨çš„æ—¥å¿—çº§åˆ«ä¸ºDEBUGï¼Œè¿™å°†è®°å½•DEBUGçº§åˆ«åŠä»¥ä¸Šçš„æ—¥å¿—æ¶ˆæ¯ï¼Œé€‚ç”¨äºè°ƒè¯•Spring Webç›¸å…³çš„è¡Œä¸ºã€‚</span><br><span class="hljs-attr">logging.level.org.springframework.web</span>=DEBUG<br><span class="hljs-comment"># è®¾ç½®com.mycomåŒ…çš„æ—¥å¿—çº§åˆ«</span><br><span class="hljs-attr">logging.level.com.mycompany</span>=INFO<br></code></pre></td></tr></table></figure><blockquote><ol start="2"><li>æ—¥å¿—æ–‡ä»¶é…ç½®</li></ol></blockquote><ul><li><strong>ç›®çš„</strong>ï¼šæŒ‡å®šæ—¥å¿—è¾“å‡ºçš„æ–‡ä»¶åå’Œè·¯å¾„ï¼Œä¾¿äºæ—¥å¿—çš„æŸ¥é˜…å’Œç®¡ç†ã€‚</li><li><strong>é…ç½®é¡¹</strong>ï¼š<ul><li><code>logging.file.name</code>: æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å…¨åï¼ŒåŒ…æ‹¬è·¯å¾„ã€‚</li><li><code>logging.file.path</code>: æŒ‡å®šæ—¥å¿—æ–‡ä»¶å­˜æ”¾çš„ç›®å½•ï¼Œæ—¥å¿—æ–‡ä»¶åç”±Spring Bootè‡ªåŠ¨ç”Ÿæˆã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š</li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs fortran"># é…ç½®æ—¥å¿—æ–‡ä»¶çš„åç§°ä¸ºmyapp.<span class="hljs-built_in">log</span>ã€‚å¦‚æœè®¾ç½®äº†logging.<span class="hljs-keyword">file</span>.<span class="hljs-keyword">name</span>ï¼Œæ—¥å¿—å°†è¢«å†™å…¥æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯æ§åˆ¶å°ã€‚<br>logging.<span class="hljs-keyword">file</span>.<span class="hljs-keyword">name</span>=myapp.<span class="hljs-built_in">log</span><br># æˆ–è€…<br># æˆ–è€…ï¼Œå¯ä»¥å•ç‹¬è®¾ç½®æ—¥å¿—æ–‡ä»¶å­˜å‚¨çš„è·¯å¾„ã€‚è¿™é‡Œè®¾ç½®æ—¥å¿—æ–‡ä»¶å­˜å‚¨åœ¨`/var/<span class="hljs-built_in">log</span>`ç›®å½•ä¸‹ã€‚<br>logging.<span class="hljs-keyword">file</span>.path=/var/<span class="hljs-built_in">log</span><br># æ³¨æ„ï¼šå½“åŒæ—¶è®¾ç½®logging.<span class="hljs-keyword">file</span>.<span class="hljs-keyword">name</span>å’Œlogging.<span class="hljs-keyword">file</span>.pathæ—¶ï¼Œæ—¥å¿—æ–‡ä»¶ï¼ˆè¿™é‡Œæ˜¯myapp.<span class="hljs-built_in">log</span>ï¼‰å°†è¢«åˆ›å»ºåœ¨æŒ‡å®šçš„è·¯å¾„ä¸‹ï¼ˆ/var/<span class="hljs-built_in">log</span>/myapp.<span class="hljs-built_in">log</span>ï¼‰ã€‚<br></code></pre></td></tr></table></figure><blockquote><ol start="3"><li>æ—¥å¿—æ ¼å¼é…ç½®</li></ol></blockquote><ul><li><strong>ç›®çš„</strong>ï¼šè‡ªå®šä¹‰æ—¥å¿—è¾“å‡ºçš„æ ¼å¼ï¼Œä»¥æ»¡è¶³ä¸åŒçš„å¯è¯»æ€§å’Œä¿¡æ¯éœ€æ±‚ã€‚</li><li><strong>é…ç½®é¡¹</strong>ï¼š<ul><li><code>logging.pattern.console</code>: æ§åˆ¶å°æ—¥å¿—çš„æ ¼å¼ã€‚</li><li><code>logging.pattern.file</code>: æ–‡ä»¶æ—¥å¿—çš„æ ¼å¼ã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š</li></ul><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mel"># è®¾ç½®æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—æ ¼å¼ã€‚%d&#123;yyyy-MM-dd HH:mm:ss&#125;æ˜¯æ—¥æœŸæ—¶é—´çš„æ ¼å¼ï¼Œ%msgæ˜¯æ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ–°è¡Œã€‚<br>logging.pattern.console=%d&#123;yyyy-MM-dd HH:mm:ss&#125; - %msg%n<br># è®¾ç½®å†™å…¥æ–‡ä»¶çš„æ—¥å¿—æ ¼å¼ã€‚åŒ…å«äº†æ—¥æœŸæ—¶é—´ã€çº¿ç¨‹åã€æ—¥å¿—çº§åˆ«ã€æ—¥å¿—è®°å½•å™¨åå’Œæ—¥å¿—æ¶ˆæ¯ã€‚ <br># [%thread]æ˜¾ç¤ºçº¿ç¨‹åï¼Œ%-<span class="hljs-number">5</span>levelæ˜¯å·¦å¯¹é½çš„æ—¥å¿—çº§åˆ«ï¼Œ%logger&#123;<span class="hljs-number">36</span>&#125;æ˜¯æ—¥å¿—è®°å½•å™¨çš„åå­—ï¼Œæœ€å¤š<span class="hljs-number">36</span>ä¸ªå­—ç¬¦ï¼Œ%msgæ˜¯æ—¥å¿—æ¶ˆæ¯ã€‚<br>logging.pattern.<span class="hljs-keyword">file</span>=%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%thread] %-<span class="hljs-number">5</span>level %logger&#123;<span class="hljs-number">36</span>&#125; - %msg%n<br></code></pre></td></tr></table></figure><blockquote><ol start="4"><li>ä½¿ç”¨<code>logback-spring.xml</code>æˆ–<code>log4j2-spring.xml</code>æ–‡ä»¶</li></ol></blockquote><ul><li><strong>ç›®çš„</strong>ï¼šå¯¹äºæ›´å¤æ‚çš„æ—¥å¿—é…ç½®éœ€æ±‚ï¼Œå¦‚æ—¥å¿—å½’æ¡£ã€å¼‚æ­¥æ—¥å¿—è®°å½•ç­‰ï¼Œå¯ä»¥é€šè¿‡è¿™äº›XMLé…ç½®æ–‡ä»¶è¿›è¡Œè¯¦ç»†è®¾ç½®ã€‚</li><li><strong>æ³¨æ„</strong>ï¼šç¡®ä¿å°†è¿™äº›é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨<code>src/main/resources</code>ç›®å½•ä¸‹ï¼ŒSpring Bootä¼šè‡ªåŠ¨è¯†åˆ«å¹¶åŠ è½½å®ƒä»¬ã€‚</li></ul><blockquote><p>é…ç½®é‡ç‚¹</p></blockquote><ul><li><strong>çµæ´»æ€§</strong>ï¼šSpring Bootå…è®¸ä½ é€šè¿‡ç®€å•çš„å±æ€§é…ç½®æ¥å¿«é€Ÿè®¾ç½®æ—¥å¿—çº§åˆ«å’Œè¾“å‡ºä½ç½®ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒé€šè¿‡XMLé…ç½®æ–‡ä»¶è¿›è¡Œæ›´å¤æ‚çš„æ—¥å¿—ç®¡ç†é…ç½®ã€‚</li><li><strong>æ—¥å¿—çº§åˆ«çš„åˆç†è®¾ç½®</strong>ï¼šåˆç†è®¾ç½®æ—¥å¿—çº§åˆ«å¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¸­æ›´æœ‰æ•ˆåœ°è·å–æ‰€éœ€çš„æ—¥å¿—ä¿¡æ¯ã€‚</li><li><strong>æ—¥å¿—æ ¼å¼åŒ–</strong>ï¼šè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼å¯ä»¥æé«˜æ—¥å¿—çš„å¯è¯»æ€§ï¼Œä½¿å¾—æ—¥å¿—ä¿¡æ¯æ›´åŠ ç›´è§‚ã€æ˜“äºç†è§£ã€‚</li><li><strong>é«˜çº§é…ç½®</strong>ï¼šå¯¹äºé«˜çº§ç”¨æˆ·ï¼Œä½¿ç”¨XMLé…ç½®æ–‡ä»¶å¯ä»¥å®ç°æ›´é«˜çº§çš„æ—¥å¿—ç®¡ç†åŠŸèƒ½ï¼Œå¦‚æ»šåŠ¨å½’æ¡£ã€æ—¥å¿—æ¸…ç†ç­–ç•¥ç­‰ã€‚</li></ul><p>åç»­è¿™é‡Œå¾…æ•´ç†ä¸€ä¸‹ to be continedâ€¦.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">// application.propertiesä¸­é…ç½®æ—¥å¿—çº§åˆ«å’Œæ—¥å¿—æ–‡ä»¶è·¯å¾„çš„ç¤ºä¾‹</span><br>logging<span class="hljs-selector-class">.level</span>.root=INFO <br>logging<span class="hljs-selector-class">.level</span><span class="hljs-selector-class">.org</span><span class="hljs-selector-class">.springframework</span>.web=DEBUG<br>logging<span class="hljs-selector-class">.level</span><span class="hljs-selector-class">.com</span>.yourpackage=TRACE<br><br>logging<span class="hljs-selector-class">.file</span>.name=app<span class="hljs-selector-class">.log</span><br>logging<span class="hljs-selector-class">.file</span>.path=/var/log<br></code></pre></td></tr></table></figure><p>åœ¨Spring Bootä¸­ï¼Œä½ å¯ä»¥é€šè¿‡<code>application.properties</code>æˆ–<code>application.yml</code>æ–‡ä»¶æ¥é…ç½®æ—¥å¿—ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ—¥å¿—é…ç½®é€‰é¡¹ï¼š</p><ol><li><strong>è®¾ç½®æ—¥å¿—çº§åˆ«</strong>:<ul><li>é€šè¿‡<code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code>è®¾ç½®ç‰¹å®šæ—¥å¿—è®°å½•å™¨çš„æ—¥å¿—çº§åˆ«ã€‚</li><li>æ—¥å¿—çº§åˆ«åŒ…æ‹¬ï¼š<code>TRACE</code>, <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, <code>ERROR</code>, <code>FATAL</code>, <code>OFF</code>ã€‚</li></ul></li><li><strong>æ—¥å¿—æ–‡ä»¶é…ç½®</strong>:<ul><li><code>logging.file.name</code>: è®¾ç½®æ—¥å¿—æ–‡ä»¶åï¼Œä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ã€‚</li><li><code>logging.file.path</code>: è®¾ç½®æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œæ—¥å¿—æ–‡ä»¶ä¼šåœ¨æŒ‡å®šçš„ç›®å½•ç”Ÿæˆã€‚</li></ul></li><li><strong>æ—¥å¿—æ ¼å¼é…ç½®</strong>:<ul><li><code>logging.pattern.console</code>: è®¾ç½®æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—æ ¼å¼ã€‚</li><li><code>logging.pattern.file</code>: è®¾ç½®å†™å…¥æ–‡ä»¶çš„æ—¥å¿—æ ¼å¼ã€‚</li></ul></li><li><strong>æ—¥å¿—å½’æ¡£</strong>:<ul><li>å¦‚æœä½¿ç”¨Logbackï¼Œé»˜è®¤ä¼šè¿›è¡Œæ—¥å¿—å½’æ¡£ï¼ˆæ¯å¤©ç”Ÿæˆä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¿‡æœŸåˆ é™¤ç­‰ï¼‰ã€‚</li><li>è¯¦ç»†çš„å½’æ¡£ç­–ç•¥å¯ä»¥é€šè¿‡Logbackçš„<code>logback-spring.xml</code>é…ç½®æ–‡ä»¶æ¥è®¾ç½®ã€‚</li></ul></li><li><strong>ä½¿ç”¨<code>logback-spring.xml</code>æˆ–<code>log4j2-spring.xml</code>æ–‡ä»¶</strong>:<ul><li>å¯¹äºæ›´å¤æ‚çš„é…ç½®ï¼Œå¦‚æ—¥å¿—å½’æ¡£ã€å¼‚æ­¥è®°å½•ç­‰ï¼Œå¯ä»¥ä½¿ç”¨XMLé…ç½®æ–‡ä»¶ã€‚</li><li>å°†è¿™äº›æ–‡ä»¶æ”¾åœ¨<code>src/main/resources</code>ç›®å½•ä¸‹ï¼ŒSpring Bootä¼šè‡ªåŠ¨åŠ è½½å®ƒä»¬ã€‚</li></ul></li></ol><p>é€šè¿‡è¿™äº›é…ç½®ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦çµæ´»åœ°è®¾ç½®æ—¥å¿—çº§åˆ«ã€æ ¼å¼ã€è¾“å‡ºä½ç½®ç­‰ã€‚</p><h4 id="è‡ªåŠ¨é…ç½®"><a href="#è‡ªåŠ¨é…ç½®" class="headerlink" title="è‡ªåŠ¨é…ç½®"></a>è‡ªåŠ¨é…ç½®</h4><h5 id="Spring-Bootçš„è‡ªåŠ¨é…ç½®åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Spring-Bootçš„è‡ªåŠ¨é…ç½®åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// ç¤ºä¾‹ï¼šä½¿ç”¨è‡ªåŠ¨é…ç½®çš„æ³¨è§£</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">MyApplication</span>.<span class="hljs-property">class</span>, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†åŸºäºä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p><ol><li><p><strong>@SpringBootApplicationæ³¨è§£</strong>:</p><ul><li>è¿™æ˜¯ä¸€ä¸ªä¾¿åˆ©æ³¨è§£ï¼Œç›¸å½“äºåŒæ—¶ä½¿ç”¨äº†<code>@Configuration</code>ã€<code>@EnableAutoConfiguration</code>å’Œ<code>@ComponentScan</code>ã€‚</li><li><code>@EnableAutoConfiguration</code>æ˜¯è‡ªåŠ¨é…ç½®çš„å…³é”®ï¼Œå®ƒå‘Šè¯‰Spring Bootå¼€å§‹åŠ è½½åŸºäºç±»è·¯å¾„ä¸‹çš„å†…å®¹ã€å…¶ä»–beanå’Œå„ç§å±æ€§è®¾ç½®çš„è‡ªåŠ¨é…ç½®ã€‚</li></ul></li><li><p><strong>æ¡ä»¶æ³¨è§£</strong> (<code>@Conditional...</code>):</p><ul><li>Spring Bootè‡ªåŠ¨é…ç½®æ˜¯æ¡ä»¶åŒ–çš„ï¼Œæ„å‘³ç€è‡ªåŠ¨é…ç½®ç±»ä¼šæ ¹æ®ç¯å¢ƒå’Œclasspathä¸‹çš„ç±»çš„å­˜åœ¨ä¸å¦åº”ç”¨ã€‚</li><li>è¿™äº›æ¡ä»¶å¯ä»¥æ˜¯ç±»çš„å­˜åœ¨ã€beançš„å­˜åœ¨ã€å±æ€§çš„å­˜åœ¨æˆ–åŒ¹é…ç­‰ã€‚</li></ul></li><li><p><strong><code>spring.factories</code>æ–‡ä»¶</strong>:</p><ul><li>Spring Bootåˆ©ç”¨<code>spring.factories</code>æ–‡ä»¶æ¥åŠ è½½è‡ªåŠ¨é…ç½®å€™é€‰è€…ã€‚</li><li>åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œé€šè¿‡<code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code>é”®æŒ‡å®šè‡ªåŠ¨é…ç½®ç±»ã€‚</li></ul></li><li><p><strong>è‡ªåŠ¨é…ç½®ç±»</strong> (<code>@Configuration</code>):</p><ul><li>è‡ªåŠ¨é…ç½®ç±»æ˜¯å¸¸è§„çš„Springé…ç½®ç±»ï¼Œé€šå¸¸ç”¨<code>@Configuration</code>æ ‡è®°ï¼Œå¹¶é€šè¿‡æ¡ä»¶æ³¨è§£è¿›è¡Œæ¡ä»¶åŒ–é…ç½®ã€‚</li><li>è¿™äº›ç±»é€šè¿‡<code>@Bean</code>æ–¹æ³•æä¾›äº†é»˜è®¤çš„beanå®šä¹‰ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯é€šè¿‡<code>@ConditionalOn...</code>æ³¨è§£æ¥æ¡ä»¶åŒ–çš„ã€‚</li></ul></li></ol><p>åŸç†ç®€è¿°ï¼š</p><ul><li>å½“Springåº”ç”¨å¯åŠ¨æ—¶ï¼Œ<code>@EnableAutoConfiguration</code>æ³¨è§£è§¦å‘äº†ä¸€ä¸ªè‡ªåŠ¨é…ç½®çš„è¿‡ç¨‹ã€‚</li><li>è¿™ä¸ªè¿‡ç¨‹ä»<code>classpath</code>ä¸­çš„<code>META-INF/spring.factories</code>æ–‡ä»¶ä¸­è¯»å–å¹¶åŠ è½½æ‰€æœ‰å¯ç”¨çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</li><li>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»å¯ä»¥æ ¹æ®æ¡ä»¶ï¼ˆæ¯”å¦‚classpathä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªç±»ã€æ˜¯å¦å­˜åœ¨æŸä¸ªbeanã€æŸä¸ªå±æ€§æ˜¯å¦æœ‰ç‰¹å®šçš„å€¼ç­‰ï¼‰å†³å®šé…ç½®æ˜¯å¦åº”ç”¨ã€‚</li><li>å¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œç›¸åº”çš„é…ç½®è¢«åº”ç”¨ï¼ˆæ¯”å¦‚åˆ›å»ºä¸€ä¸ªbeanã€æ·»åŠ å±æ€§å€¼ç­‰ï¼‰ã€‚</li></ul><p>è¿™ç§è‡ªåŠ¨é…ç½®æœºåˆ¶å¤§å¤§ç®€åŒ–äº†Springåº”ç”¨çš„é…ç½®ï¼Œå°¤å…¶æ˜¯åœ¨æ„å»ºç‹¬ç«‹çš„ã€ç”Ÿäº§çº§åˆ«çš„Springåº”ç”¨æ—¶ã€‚</p><hr><p>è‡ªåŠ¨è£…é…åŸç†ï¼š</p><p>Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†æ˜¯é€šè¿‡<strong>æ¡ä»¶åŒ–é…ç½®</strong>å’ŒSpringçš„<strong>æ³¨è§£æœºåˆ¶</strong>æ¥å®ç°çš„ï¼Œå½“åº”ç”¨å¯åŠ¨æ—¶ï¼ŒSpring Bootä¼šè‡ªåŠ¨æ‰«æåº”ç”¨ä¸­çš„ä¾èµ–ï¼Œæ ¹æ®ä¾èµ–è‡ªåŠ¨é…ç½®Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿å¼€ç®±å³ç”¨ã€‚</p><h4 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h4><h5 id="SpringBoot-æœ‰å“ªäº›æ¡ä»¶æ³¨è§£ï¼Œè¿™äº›æ³¨è§£æ€ä¹ˆä½¿ç”¨çš„"><a href="#SpringBoot-æœ‰å“ªäº›æ¡ä»¶æ³¨è§£ï¼Œè¿™äº›æ³¨è§£æ€ä¹ˆä½¿ç”¨çš„" class="headerlink" title="SpringBoot æœ‰å“ªäº›æ¡ä»¶æ³¨è§£ï¼Œè¿™äº›æ³¨è§£æ€ä¹ˆä½¿ç”¨çš„"></a>SpringBoot æœ‰å“ªäº›æ¡ä»¶æ³¨è§£ï¼Œè¿™äº›æ³¨è§£æ€ä¹ˆä½¿ç”¨çš„</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// ç¤ºä¾‹: ä½¿ç”¨æ¡ä»¶æ³¨è§£</span><br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ConditionalOnClass</span>(&#123;<span class="hljs-title class_">ExampleService</span>.<span class="hljs-property">class</span>&#125;)<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleAutoConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ExampleService</span> <span class="hljs-title function_">exampleService</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExampleServiceImpl</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnProperty</span>(name = <span class="hljs-string">&quot;example.enabled&quot;</span>, havingValue = <span class="hljs-string">&quot;true&quot;</span>, matchIfMissing = <span class="hljs-literal">true</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ExampleFeature</span> <span class="hljs-title function_">exampleFeature</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExampleFeature</span>();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnExpression</span>(<span class="hljs-string">&quot;$&#123;example.expression:true&#125;&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ExampleComponent</span> <span class="hljs-title function_">exampleComponent</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExampleComponent</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Spring Bootæä¾›äº†å¤šç§æ¡ä»¶æ³¨è§£æ¥æ§åˆ¶é…ç½®çš„æ¡ä»¶åŒ–åˆ›å»ºï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ¡ä»¶æ³¨è§£åŠå…¶ç”¨æ³•ï¼š</p><ol><li><strong>@ConditionalOnClass</strong> &#x2F; <strong>@ConditionalOnMissingClass</strong>:<ul><li>æ ¹æ®ç±»è·¯å¾„ä¸Šæ˜¯å¦å­˜åœ¨æŸä¸ªç±»æ¥å†³å®šæ˜¯å¦åˆ›å»ºBeanã€‚</li></ul></li><li><strong>@ConditionalOnBean</strong> &#x2F; <strong>@ConditionalOnMissingBean</strong>:<ul><li>æ ¹æ®ä¸Šä¸‹æ–‡ä¸­æ˜¯å¦å­˜åœ¨ï¼ˆæˆ–ç¼ºå¤±ï¼‰æŸä¸ªBeanæ¥å†³å®šæ˜¯å¦åˆ›å»ºBeanã€‚</li></ul></li><li><strong>@ConditionalOnProperty</strong>:<ul><li>æ ¹æ®é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå±æ€§ï¼Œæˆ–è¯¥å±æ€§çš„å€¼æ˜¯å¦ç¬¦åˆé¢„æœŸæ¥å†³å®šæ˜¯å¦åˆ›å»ºBeanã€‚</li></ul></li><li><strong>@ConditionalOnResource</strong>:<ul><li>æ ¹æ®ç±»è·¯å¾„ä¸Šæ˜¯å¦å­˜åœ¨æŸä¸ªèµ„æºæ¥å†³å®šæ˜¯å¦åˆ›å»ºBeanã€‚</li></ul></li><li><strong>@ConditionalOnExpression</strong>:<ul><li>æ ¹æ®SpELè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœæ¥å†³å®šæ˜¯å¦åˆ›å»ºBeanã€‚</li></ul></li><li><strong>@ConditionalOnWebApplication</strong> &#x2F; <strong>@ConditionalOnNotWebApplication</strong>:<ul><li>æ ¹æ®åº”ç”¨æ˜¯å¦æ˜¯Webåº”ç”¨æ¥å†³å®šæ˜¯å¦åˆ›å»ºBeanã€‚</li></ul></li><li><strong>@ConditionalOnJndi</strong>:<ul><li>æ ¹æ®JNDIä½ç½®çš„å­˜åœ¨ä¸å¦æ¥å†³å®šæ˜¯å¦åˆ›å»ºBeanã€‚</li></ul></li></ol><p>è¿™äº›æ³¨è§£é€šå¸¸ç”¨åœ¨è‡ªåŠ¨é…ç½®ç±»ä¸­ï¼Œä½¿å¾—Beançš„åˆ›å»ºå¯ä»¥æ ¹æ®ä¸åŒçš„ç¯å¢ƒæˆ–é…ç½®åŠ¨æ€åœ°è¿›è¡Œã€‚</p><p>ä¸Šé¢è¿™å†™æ˜¯è·Ÿ @Conditional çš„åŸºç¡€ä¸Šç»„åˆä½¿ç”¨çš„ï¼Œä»‹ç»ä¸€ä¸‹å®ƒï¼š</p><ul><li>@Conditional</li><li>è¿™æ˜¯Spring4.0æ·»åŠ çš„æ–°æ³¨è§£ï¼Œç”¨æ¥æ ‡è¯†ä¸€ä¸ªSpring Beanæˆ–è€…Configurationé…ç½®æ–‡ä»¶ï¼Œå½“æ»¡è¶³æŒ‡å®šçš„æ¡ä»¶æ‰å¼€å¯é…ç½®ã€‚</li></ul><hr><h4 id="æ—¥å¿—æ¡†æ¶"><a href="#æ—¥å¿—æ¡†æ¶" class="headerlink" title="æ—¥å¿—æ¡†æ¶"></a>æ—¥å¿—æ¡†æ¶</h4><h4 id="å¯åŠ¨å™¨"><a href="#å¯åŠ¨å™¨" class="headerlink" title="å¯åŠ¨å™¨"></a>å¯åŠ¨å™¨</h4><h5 id="Spring-Bootå®˜æ–¹çš„å¯åŠ¨å™¨å‘½åè§„èŒƒæ˜¯ï¼Ÿ"><a href="#Spring-Bootå®˜æ–¹çš„å¯åŠ¨å™¨å‘½åè§„èŒƒæ˜¯ï¼Ÿ" class="headerlink" title="Spring Bootå®˜æ–¹çš„å¯åŠ¨å™¨å‘½åè§„èŒƒæ˜¯ï¼Ÿ"></a>Spring Bootå®˜æ–¹çš„å¯åŠ¨å™¨å‘½åè§„èŒƒæ˜¯ï¼Ÿ</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-*<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Spring Bootå®˜æ–¹çš„å¯åŠ¨å™¨ï¼ˆstartersï¼‰éµå¾ªä»¥ä¸‹å‘½åè§„èŒƒï¼š</p><ul><li><strong>åŸºæœ¬æ ¼å¼</strong>: <code>spring-boot-starter-XYZ</code></li><li><strong>XYZ</strong>: æè¿°å¯åŠ¨å™¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ <code>web</code>, <code>data-jpa</code>, <code>security</code> ç­‰ã€‚</li><li><strong>ç‰ˆæœ¬å·</strong>: æ ¹æ®é¡¹ç›®éœ€æ±‚æŒ‡å®šåˆé€‚çš„Spring Bootç‰ˆæœ¬ã€‚</li></ul><p>Spring Bootå®˜æ–¹çš„å¯åŠ¨å™¨éƒ½æ˜¯ä»¥spring-boot-starterâ€“* å‘½åçš„ï¼Œ* ä»£è¡¨äº†ä¸€ä¸ªç‰¹å®šçš„åº”ç”¨ç±»å‹ã€‚</p><p>ç¬¬ä¸‰æ–¹çš„å¯åŠ¨å™¨ä¸èƒ½ä»¥spring-bootå¼€å¤´å‘½åï¼Œå®ƒä»¬éƒ½è¢«Spring Bootå®˜æ–¹ä¿ç•™ã€‚</p><p>ä¸€èˆ¬ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„åº”è¯¥è¿™æ ·å‘½åï¼Œåƒmybatisçš„  mybatis-spring-boot-starterã€‚.</p><hr><h5 id="Spring-Bootçš„starteræ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Spring-Bootçš„starteræ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Spring Bootçš„starteræ˜¯ä»€ä¹ˆï¼Ÿ"></a>Spring Bootçš„starteræ˜¯ä»€ä¹ˆï¼Ÿ</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml">// Spring Boot Starter Dependency Example<br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>Spring Boot Starteræ˜¯ä¸€ç§ä¾èµ–ç®¡ç†å™¨ï¼Œå®ƒç®€åŒ–äº†Springåº”ç”¨ç¨‹åºçš„ä¾èµ–é…ç½®ã€‚</p><p>æ¯ä¸ªStarteréƒ½æ˜¯ä¸€ä¸ªMavené¡¹ç›®ï¼Œå®ƒå°è£…äº†ç‰¹å®šäºæŸä¸€åŠŸèƒ½ï¼ˆå¦‚Webå¼€å‘ã€æ•°æ®è®¿é—®ç­‰ï¼‰çš„ä¾èµ–å…³ç³»ã€‚ä½¿ç”¨Starteræ—¶ï¼Œä½ åªéœ€å£°æ˜å•ä¸ªä¾èµ–é¡¹ï¼ŒSpring Bootå°±ä¼šä¸ºä½ æä¾›è¯¥åŠŸèƒ½æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚è¿™æå¤§åœ°ç®€åŒ–äº†é¡¹ç›®çš„æ„å»ºé…ç½®ï¼Œå¹¶æœ‰åŠ©äºé¿å…ç‰ˆæœ¬å†²çªå’Œä¾èµ–æ€§é—®é¢˜ã€‚</p><h5 id="æ€ä¹ˆè‡ªå®šä¹‰ä¸€ä¸ª-starter"><a href="#æ€ä¹ˆè‡ªå®šä¹‰ä¸€ä¸ª-starter" class="headerlink" title="æ€ä¹ˆè‡ªå®šä¹‰ä¸€ä¸ª starter"></a>æ€ä¹ˆè‡ªå®šä¹‰ä¸€ä¸ª starter</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 1. åˆ›å»ºä¸€ä¸ªæ–°çš„Mavené¡¹ç›®ä½œä¸ºè‡ªå®šä¹‰Starter</span><br><br><span class="hljs-comment">// 2. åœ¨pom.xmlä¸­æ·»åŠ Spring Bootçš„parentå’ŒåŸºæœ¬ä¾èµ–</span><br>&lt;parent&gt;<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.x.x.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br>&lt;/parent&gt;<br><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span></span><br><span class="language-xml">    // æ·»åŠ æ‰€éœ€åŠŸèƒ½çš„ä¾èµ–</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></span><br><br><span class="hljs-comment">// 3. åˆ›å»ºè‡ªåŠ¨é…ç½®ç±»ï¼Œä½¿ç”¨@Configurationå’Œ@ConditionalOn...æ³¨è§£</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ConditionalOnClass</span>(&#123; <span class="hljs-title class_">YourService</span>.<span class="hljs-property">class</span> &#125;)<br><span class="hljs-meta">@ConditionalOnProperty</span>(prefix = <span class="hljs-string">&quot;your.starter&quot;</span>, name = <span class="hljs-string">&quot;enabled&quot;</span>, havingValue = <span class="hljs-string">&quot;true&quot;</span>, matchIfMissing = <span class="hljs-literal">true</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YourStarterAutoConfiguration</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">YourService</span> <span class="hljs-title function_">yourService</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YourServiceImpl</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 4. åœ¨resources/META-INFä¸‹åˆ›å»ºspring.factoriesæ–‡ä»¶ï¼Œå£°æ˜è‡ªåŠ¨é…ç½®ç±»</span><br>org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">EnableAutoConfiguration</span>=\<br>your.<span class="hljs-property">package</span>.<span class="hljs-property">YourStarterAutoConfiguration</span><br></code></pre></td></tr></table></figure><p>æ­¥éª¤ï¼š</p><ol><li><strong>åˆ›å»ºé¡¹ç›®</strong>: åˆ›å»ºä¸€ä¸ªMavené¡¹ç›®ä½œä¸ºä½ çš„Starterã€‚</li><li><strong>æ·»åŠ ä¾èµ–</strong>: åœ¨<code>pom.xml</code>ä¸­å£°æ˜Spring Bootçš„parentä¾èµ–ï¼Œå’Œå…¶ä»–æ‰€éœ€çš„ä¾èµ–ã€‚</li><li><strong>ç¼–å†™è‡ªåŠ¨é…ç½®</strong>: åˆ›å»ºé…ç½®ç±»ï¼Œä½¿ç”¨<code>@Configuration</code>æ³¨è§£ï¼Œé€šè¿‡<code>@ConditionalOn...</code>æ³¨è§£ç¡®ä¿åªåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰åº”ç”¨é…ç½®ã€‚</li><li><strong>å£°æ˜é…ç½®</strong>: åœ¨<code>resources/META-INF/spring.factories</code>æ–‡ä»¶ä¸­ï¼Œå£°æ˜ä½ çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œä»¥ä¾¿Spring Bootåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å‘ç°å®ƒã€‚</li></ol><hr><h4 id="å†…åµŒå®¹å™¨"><a href="#å†…åµŒå®¹å™¨" class="headerlink" title="å†…åµŒå®¹å™¨"></a>å†…åµŒå®¹å™¨</h4><h5 id="Spring-Bootæ”¯æŒå“ªå‡ ç§å†…åµŒå®¹å™¨ï¼Ÿ"><a href="#Spring-Bootæ”¯æŒå“ªå‡ ç§å†…åµŒå®¹å™¨ï¼Ÿ" class="headerlink" title="Spring Bootæ”¯æŒå“ªå‡ ç§å†…åµŒå®¹å™¨ï¼Ÿ"></a>Spring Bootæ”¯æŒå“ªå‡ ç§å†…åµŒå®¹å™¨ï¼Ÿ</h5><p>Springæ”¯ç‰¹çš„å†…åµŒå¼å®¹å™¨æœ‰ï¼šTomcatã€Jettyã€Undertow</p><p>é»˜è®¤çš„å†…åµŒå¼å®¹å™¨æ˜¯ï¼šTomcatã€‚</p><h4 id="é…ç½®åŠ è½½"><a href="#é…ç½®åŠ è½½" class="headerlink" title="é…ç½®åŠ è½½"></a>é…ç½®åŠ è½½</h4><h3 id="ä¸‰ã€å’Œç¬¬ä¸‰æ–¹é›†æˆ"><a href="#ä¸‰ã€å’Œç¬¬ä¸‰æ–¹é›†æˆ" class="headerlink" title="ä¸‰ã€å’Œç¬¬ä¸‰æ–¹é›†æˆ"></a>ä¸‰ã€å’Œç¬¬ä¸‰æ–¹é›†æˆ</h3><p>to be continedâ€¦.</p><h4 id="Spring-Bootæ€ä¹ˆå…¼å®¹è€Springé¡¹ç›®ï¼Ÿ"><a href="#Spring-Bootæ€ä¹ˆå…¼å®¹è€Springé¡¹ç›®ï¼Ÿ" class="headerlink" title="Spring Bootæ€ä¹ˆå…¼å®¹è€Springé¡¹ç›®ï¼Ÿ"></a>Spring Bootæ€ä¹ˆå…¼å®¹è€Springé¡¹ç›®ï¼Ÿ</h4><p>ç­”æ¡ˆæ˜¯å¯ä»¥å…¼å®¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>@ImportResource</code>æ³¨è§£ æ¥å¯¼å…¥ä¹‹å‰æ˜¯ Spring é¡¹ç›®çš„é…ç½®æ–‡ä»¶</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><span class="hljs-variable">@ImportResource</span>(&#123; <span class="hljs-string">&quot;classpath*:legacy-spring-context.xml&quot;</span> &#125;)<br>public class LegacyConfig &#123;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li><strong>åˆ›å»ºä¸€ä¸ªæ–°çš„Spring Booté¡¹ç›®</strong>: åˆå§‹åŒ–ä¸€ä¸ªæ ‡å‡†çš„Spring Booté¡¹ç›®ç»“æ„ã€‚</li><li><strong>é›†æˆè€é¡¹ç›®çš„é…ç½®</strong>:<ul><li>ä½¿ç”¨<code>@ImportResource</code>æ³¨è§£å¯¼å…¥è€Springé¡¹ç›®çš„XMLé…ç½®æ–‡ä»¶ã€‚</li><li>å¦‚æœè€é¡¹ç›®ä½¿ç”¨çš„æ˜¯Javaé…ç½®ï¼Œå¯ä»¥ç›´æ¥åœ¨Spring Bootçš„é…ç½®ç±»ä¸­å¯¼å…¥ã€‚</li></ul></li><li><strong>é€æ­¥è¿ç§»</strong>:<ul><li>å°†è€é¡¹ç›®çš„ä»£ç å’Œèµ„æºæ–‡ä»¶å¤åˆ¶åˆ°Spring Booté¡¹ç›®ä¸­ã€‚</li><li>é€æ­¥æ›¿æ¢è€é¡¹ç›®ä¸­çš„SpringåŠŸèƒ½å®ç°ï¼Œå¦‚æ•°æ®æºé…ç½®ã€äº‹åŠ¡ç®¡ç†ç­‰ï¼Œä½¿ç”¨Spring Bootçš„è‡ªåŠ¨é…ç½®åŠŸèƒ½ã€‚</li></ul></li><li><strong>æµ‹è¯•å’Œè°ƒä¼˜</strong>:<ul><li>ä»”ç»†æµ‹è¯•æ•´åˆåçš„åº”ç”¨ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸ã€‚</li><li>æ ¹æ®éœ€è¦è°ƒä¼˜Spring Bootçš„é…ç½®ï¼Œæ¯”å¦‚æ—¥å¿—çº§åˆ«ã€æ•°æ®åº“è¿æ¥ç­‰ã€‚</li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLå­¦ä¹ _æ•°æ®åº“ç´¢å¼•</title>
    <link href="/2024/01/29/MySQL%E5%AD%A6%E4%B9%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/"/>
    <url>/2024/01/29/MySQL%E5%AD%A6%E4%B9%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/</url>
    
    <content type="html"><![CDATA[<p>MySQL ç›¸å…³çš„æ•°æ®åº“ç´¢å¼•è¿™ä¸€éƒ¨åˆ†å†…å®¹å•ç‹¬æå‡ºæ¥ï¼Œç„¶åæ•´ç†ä¸€ä¸‹ç›¸å…³å†…å®¹ã€‚</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://javaguide.cn/database/mysql/mysql-index.html">https://javaguide.cn/database/mysql/mysql-index.html</a></li><li><a href="https://www.pdai.tech/md/db/sql-mysql/sql-mysql-b-tree.html">https://www.pdai.tech/md/db/sql-mysql/sql-mysql-b-tree.html</a></li><li><a href="https://www.yuque.com/snailclimb/mf2z3k/wghadf">https://www.yuque.com/snailclimb/mf2z3k/wghadf</a></li></ul><blockquote><p>å¤§çº²</p></blockquote><ul><li>åº•å±‚æ•°æ®ç»“æ„é€‰å‹</li><li>ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨ B+ æ ‘</li><li>å¸¸ç”¨çš„ç´¢å¼•ç±»å‹æœ‰å“ªäº›</li><li>è¦†ç›–ç´¢å¼•å’Œè”åˆç´¢å¼•</li><li>æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™</li><li>ç´¢å¼•ä¸‹æ¨</li><li>æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„ä¸€äº›å»ºè®®</li></ul><h3 id="1ã€åº•å±‚æ•°æ®ç»“æ„é€‰å‹"><a href="#1ã€åº•å±‚æ•°æ®ç»“æ„é€‰å‹" class="headerlink" title="1ã€åº•å±‚æ•°æ®ç»“æ„é€‰å‹"></a>1ã€åº•å±‚æ•°æ®ç»“æ„é€‰å‹</h3><p>å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªï¼š <a href="https://javaguide.cn/database/mysql/mysql-index.html#%E7%B4%A2%E5%BC%95%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E9%80%89%E5%9E%8B">MySQLç´¢å¼•è¯¦è§£ | JavaGuide</a></p><p>ç´¢å¼•çš„æ•°æ®ç»“æ„é€‰å‹ä¸€èˆ¬é€‰æ‹©æ–¹å‘æœ‰ï¼š Hash è¡¨ã€äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBST)ã€AVL æ ‘ã€çº¢é»‘æ ‘ã€B æ ‘ &amp; B+ æ ‘ ã€‚</p><p>è€ƒè™‘åˆ°ä¸€äº›åŸå› ï¼Œæœ€ç»ˆ MySQL çš„ç´¢å¼•é€‰ç”¨çš„æ•°æ®ç»“æ„æ˜¯ B+ æ ‘ã€‚</p><blockquote><p>Hash è¡¨</p></blockquote><p>å¦‚æœé‡‡ç”¨ Hash è¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„çš„è¯ï¼Œä¼˜ç‚¹æ˜¯èƒ½å¤Ÿå¿«é€Ÿæ£€ç´¢ï¼ˆå“ˆå¸Œè¡¨èƒ½å¤Ÿé€šè¿‡é”®å€¼å¯¹å¿«é€Ÿå®šä½æ•°æ®ï¼Œæ£€ç´¢æ•ˆç‡æ¥è¿‘ O(1)ï¼‰ï¼›ä½†ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œ</p><ul><li>ä¸€ä¸ªæ˜¯å“ˆå¸Œå†²çª<ul><li>ä¸åŒçš„é”®å¯èƒ½ä¼šäº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼ï¼Œå¯¼è‡´å†²çªï¼›è™½ç„¶é“¾åœ°å€æ³•ç­‰æŠ€æœ¯å¯ä»¥è§£å†³ï¼Œä½†ä¼šå¢åŠ å¤æ‚åº¦ï¼›</li></ul></li><li>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ˜¯å®ƒä¸æ”¯æŒé¡ºåºå’ŒèŒƒå›´æŸ¥è¯¢<ul><li>Hash ç´¢å¼•æ˜¯æ ¹æ® hash ç®—æ³•æ¥å®šä½çš„ï¼ˆåŸºäºå“ˆå¸Œå€¼è€Œéå®é™…æ•°æ®é¡ºåºï¼‰ï¼›å› æ­¤å®ƒä¸é€‚ç”¨äºé‚£äº›ä¾èµ–äºæ•°æ®é¡ºåºçš„æ“ä½œï¼Œå¦‚æ’åºï¼›åŒæ ·å› ä¸ºè¿™ä¸ªåŸå›  Hash ç´¢å¼• æ— æ³•å¿«é€Ÿå®šä½åˆ°ç‰¹å®šèŒƒå›´çš„æ•°æ®</li></ul></li></ul><hr><blockquote><p>äºŒå‰æŸ¥æ‰¾æ ‘ BST</p></blockquote><p>æœ€åæƒ…å†µï¼ˆé€€åŒ–æ–œæ ‘ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401291002721.png" alt="image.png"></p><blockquote><p>AVL æ ‘</p></blockquote><p>AVL æ ‘æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­æœ€æ—©è¢«å‘æ˜çš„<strong>è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘</strong>ï¼Œå®ƒçš„åç§°æ¥è‡ªäºå‘æ˜è€… G.M. Adelson-Velsky å’Œ E.M. Landis çš„åå­—ç¼©å†™ã€‚AVL æ ‘çš„ç‰¹ç‚¹æ˜¯ä¿è¯ä»»ä½•èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦ä¹‹å·®ä¸è¶…è¿‡ 1ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºé«˜åº¦å¹³è¡¡äºŒå‰æ ‘ï¼Œå®ƒçš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤åœ¨å¹³å‡å’Œæœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(logn)ã€‚</p><p>ä»–æœ‰ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„ç¼ºç‚¹ï¼šç”±äº AVL æ ‘éœ€è¦é¢‘ç¹åœ°è¿›è¡Œæ—‹è½¬æ“ä½œæ¥ä¿æŒå¹³è¡¡ï¼Œå› æ­¤ä¼šæœ‰è¾ƒå¤§çš„è®¡ç®—å¼€é”€è¿›è€Œé™ä½äº†æŸ¥è¯¢æ€§èƒ½ã€‚</p><blockquote><p>çº¢é»‘æ ‘</p></blockquote><p><strong>çº¢é»‘æ ‘çš„åº”ç”¨æ˜¯æ¯”è¾ƒå¹¿æ³›çš„ï¼ŒTreeMapã€TreeSet ä»¥åŠ JDK1.8 çš„ HashMap åº•å±‚éƒ½ç”¨åˆ°äº†çº¢é»‘æ ‘ã€‚å¯¹äºæ•°æ®åœ¨å†…å­˜ä¸­çš„è¿™ç§æƒ…å†µæ¥è¯´ï¼Œçº¢é»‘æ ‘çš„è¡¨ç°æ˜¯éå¸¸ä¼˜å¼‚</strong></p><p>ä½†å› ä¸ºæ ‘å¤ªé«˜ï¼Œä¸å¤ªé€‚åˆåœ¨ç£ç›˜ä¸­ä½¿ç”¨</p><blockquote><p>B æ ‘ &amp; B+ æ ‘</p></blockquote><p>ï¼Ÿï¼Ÿï¼Ÿ</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html">https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html</a></li><li><a href="https://oi-wiki.org/ds/bplus-tree/">https://oi-wiki.org/ds/bplus-tree/</a></li><li><a href="https://mp.weixin.qq.com/s/8qemhRg5MgXs1So5YCv0fQ">https://mp.weixin.qq.com/s/8qemhRg5MgXs1So5YCv0fQ</a></li></ul><p>B+Tree æ˜¯ä¸€ç§å¤šå‰æ ‘ï¼Œå¶å­èŠ‚ç‚¹æ‰å­˜æ”¾æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹åªå­˜æ”¾ç´¢å¼•ï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹é‡Œçš„æ•°æ®æ˜¯<strong>æŒ‰ä¸»é”®å€¼ï¼ˆidï¼‰é¡ºåºå­˜æ”¾</strong>çš„ï¼Œæ¯ä¸€å±‚çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•å€¼éƒ½ä¼šå‡ºç°åœ¨ä¸‹å±‚å­èŠ‚ç‚¹çš„ç´¢å¼•å€¼ä¸­ï¼Œå› æ­¤åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼ŒåŒ…æ‹¬äº†æ‰€æœ‰çš„ç´¢å¼•å€¼ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½æŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå½¢æˆä¸€ä¸ªé“¾è¡¨ï¼Œä¾¿äºèŒƒå›´æŸ¥è¯¢ã€‚</p><p>ç¤ºä¾‹ï¼š</p><p>å‡è®¾æœ‰ä¸€å¼ å•†å“è¡¨ï¼Œè¡¨é‡Œæœ‰è¿™äº›æ•°æ®</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401291358064.png" alt="image.png"></p><p>èšç°‡ç´¢å¼•çš„ B+Tree å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401291359520.png" alt="image.png"></p><p>å‡è®¾ï¼Œæ‰§è¡Œäº† Â <code>select * from t_product where id = 5</code>Â æŸ¥è¯¢è¯­å¥ï¼Œè¯¥æŸ¥è¯¢è¯­å¥çš„æ¡ä»¶æ˜¯æ‰¾åˆ° idï¼ˆä¸»é”®ï¼‰ä¸º 5 çš„è¿™æ¡è®°å½•ã€‚å› ä¸º B+Tree æ˜¯ä¸€ä¸ª<strong>æœ‰åº</strong>çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡äºŒåˆ†æŸ¥æ‰¾ç®—æ³•å¿«é€Ÿå®šä½åˆ°è¿™æ¡è®°å½•ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç´¢å¼•æŸ¥è¯¢ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå°† 5 ä¸æ ¹èŠ‚ç‚¹çš„ç´¢å¼•æ•°æ® (1ï¼Œ10ï¼Œ20) æ¯”è¾ƒï¼Œ5 åœ¨ 1 å’Œ 10 ä¹‹é—´ï¼Œæ ¹æ®äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ï¼Œæ‰¾åˆ°ç¬¬äºŒå±‚çš„ç´¢å¼•æ•°æ® (1ï¼Œ4ï¼Œ7)ï¼›</li><li>åœ¨ç¬¬äºŒå±‚çš„ç´¢å¼•æ•°æ® (1ï¼Œ4ï¼Œ7)ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå› ä¸º 5 åœ¨ 4 å’Œ 7 ä¹‹é—´ï¼Œæ ¹æ®äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ï¼Œæ‰¾åˆ°ç¬¬ä¸‰å±‚çš„ç´¢å¼•æ•°æ®ï¼ˆ4ï¼Œ5ï¼Œ6ï¼‰ï¼›</li><li>åœ¨å¶å­èŠ‚ç‚¹çš„ç´¢å¼•æ•°æ®ï¼ˆ4ï¼Œ5ï¼Œ6ï¼‰ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œç„¶åæˆ‘ä»¬æ‰¾åˆ°äº†ç´¢å¼•å€¼ä¸º 5 çš„è¿™æ¡è®°å½•ã€‚</li></ul><p><strong>äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼ï¼Œä¸æ˜¯å®é™…æ•°æ®</strong></p><h3 id="2ã€ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨-B-æ ‘"><a href="#2ã€ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨-B-æ ‘" class="headerlink" title="2ã€ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨ B+ æ ‘"></a>2ã€ç´¢å¼•ä¸ºä»€ä¹ˆä½¿ç”¨ B+ æ ‘</h3><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼Œç´¢å¼•ä½¿ç”¨ B+ æ ‘èƒ½å¤Ÿå‡å°‘ IO æ¬¡æ•°ï¼ŒæŸ¥è¯¢èŒƒå›´æ›´åŠ é«˜æ•ˆã€‚</p><p>![[MySQLå­¦ä¹ _åŸºç¡€å†…å®¹02#ç´¢å¼•(B+æ ‘)]]</p><h3 id="3ã€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹æœ‰å“ªäº›"><a href="#3ã€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹æœ‰å“ªäº›" class="headerlink" title="3ã€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹æœ‰å“ªäº›"></a>3ã€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹æœ‰å“ªäº›</h3><p>æŒ‰ç…§æ•°æ®ç»“æ„ç»´åº¦åˆ’åˆ†ï¼š</p><ul><li>BTree ç´¢å¼•ï¼šMySQL é‡Œé»˜è®¤å’Œæœ€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹ã€‚åªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨ valueï¼Œéå¶å­èŠ‚ç‚¹åªæœ‰æŒ‡é’ˆå’Œ keyã€‚å­˜å‚¨å¼•æ“ MyISAM å’Œ InnoDB å®ç° BTree ç´¢å¼•éƒ½æ˜¯ä½¿ç”¨ B+Treeï¼Œä½†äºŒè€…å®ç°æ–¹å¼ä¸ä¸€æ ·ï¼ˆå‰é¢å·²ç»ä»‹ç»äº†ï¼‰ã€‚</li><li>å“ˆå¸Œç´¢å¼•ï¼šç±»ä¼¼é”®å€¼å¯¹çš„å½¢å¼ï¼Œä¸€æ¬¡å³å¯å®šä½ã€‚</li><li>RTree ç´¢å¼•ï¼šä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œä»…æ”¯æŒ geometry æ•°æ®ç±»å‹ï¼Œä¼˜åŠ¿åœ¨äºèŒƒå›´æŸ¥æ‰¾ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ ElasticSearch ä»£æ›¿ã€‚</li><li>å…¨æ–‡ç´¢å¼•ï¼šå¯¹æ–‡æœ¬çš„å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œè¿›è¡Œæœç´¢ã€‚ç›®å‰åªæœ‰ <code>CHAR</code>ã€<code>VARCHAR</code> ï¼Œ<code>TEXT</code> åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ ElasticSearch ä»£æ›¿ã€‚</li></ul><p>æŒ‰ç…§åº•å±‚å­˜å‚¨æ–¹å¼è§’åº¦åˆ’åˆ†ï¼š</p><ul><li>èšç°‡ç´¢å¼•ï¼ˆèšé›†ç´¢å¼•ï¼‰ï¼šç´¢å¼•ç»“æ„å’Œæ•°æ®ä¸€èµ·å­˜æ”¾çš„ç´¢å¼•ï¼ŒInnoDB ä¸­çš„ä¸»é”®ç´¢å¼•å°±å±äºèšç°‡ç´¢å¼•ã€‚</li><li>éèšç°‡ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰ï¼šç´¢å¼•ç»“æ„å’Œæ•°æ®åˆ†å¼€å­˜æ”¾çš„ç´¢å¼•ï¼ŒäºŒçº§ç´¢å¼•(è¾…åŠ©ç´¢å¼•)å°±å±äºéèšç°‡ç´¢å¼•ã€‚MySQL çš„ MyISAM å¼•æ“ï¼Œä¸ç®¡ä¸»é”®è¿˜æ˜¯éä¸»é”®ï¼Œä½¿ç”¨çš„éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚</li></ul><p>æŒ‰ç…§åº”ç”¨ç»´åº¦åˆ’åˆ†ï¼š</p><ul><li>ä¸»é”®ç´¢å¼•ï¼šåŠ é€ŸæŸ¥è¯¢ + åˆ—å€¼å”¯ä¸€ï¼ˆä¸å¯ä»¥æœ‰ NULLï¼‰+ è¡¨ä¸­åªæœ‰ä¸€ä¸ªã€‚</li><li>æ™®é€šç´¢å¼•ï¼šä»…åŠ é€ŸæŸ¥è¯¢ã€‚</li><li>å”¯ä¸€ç´¢å¼•ï¼šåŠ é€ŸæŸ¥è¯¢ + åˆ—å€¼å”¯ä¸€ï¼ˆå¯ä»¥æœ‰ NULLï¼‰ã€‚</li><li>è¦†ç›–ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆæˆ–è€…è¯´è¦†ç›–ï¼‰æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ã€‚</li><li>è”åˆç´¢å¼•ï¼šå¤šåˆ—å€¼ç»„æˆä¸€ä¸ªç´¢å¼•ï¼Œä¸“é—¨ç”¨äºç»„åˆæœç´¢ï¼Œå…¶æ•ˆç‡å¤§äºç´¢å¼•åˆå¹¶ã€‚</li><li>å…¨æ–‡ç´¢å¼•ï¼šå¯¹æ–‡æœ¬çš„å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œè¿›è¡Œæœç´¢ã€‚ç›®å‰åªæœ‰ <code>CHAR</code>ã€<code>VARCHAR</code> ï¼Œ<code>TEXT</code> åˆ—ä¸Šå¯ä»¥åˆ›å»ºå…¨æ–‡ç´¢å¼•ã€‚ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ï¼Œæ•ˆç‡è¾ƒä½ï¼Œé€šå¸¸ä½¿ç”¨æœç´¢å¼•æ“å¦‚ ElasticSearch ä»£æ›¿ã€‚</li></ul><p>MySQL 8.x ä¸­å®ç°çš„ç´¢å¼•æ–°ç‰¹æ€§ï¼š</p><ul><li>éšè—ç´¢å¼•ï¼šä¹Ÿç§°ä¸ºä¸å¯è§ç´¢å¼•ï¼Œä¸ä¼šè¢«ä¼˜åŒ–å™¨ä½¿ç”¨ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦ç»´æŠ¤ï¼Œé€šå¸¸ä¼šè½¯åˆ é™¤å’Œç°åº¦å‘å¸ƒçš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚ä¸»é”®ä¸èƒ½è®¾ç½®ä¸ºéšè—ï¼ˆåŒ…æ‹¬æ˜¾å¼è®¾ç½®æˆ–éšå¼è®¾ç½®ï¼‰ã€‚</li><li>é™åºç´¢å¼•ï¼šä¹‹å‰çš„ç‰ˆæœ¬å°±æ”¯æŒé€šè¿‡ desc æ¥æŒ‡å®šç´¢å¼•ä¸ºé™åºï¼Œä½†å®é™…ä¸Šåˆ›å»ºçš„ä»ç„¶æ˜¯å¸¸è§„çš„å‡åºç´¢å¼•ã€‚ç›´åˆ° MySQL 8.x ç‰ˆæœ¬æ‰å¼€å§‹çœŸæ­£æ”¯æŒé™åºç´¢å¼•ã€‚å¦å¤–ï¼Œåœ¨ MySQL 8.x ç‰ˆæœ¬ä¸­ï¼Œä¸å†å¯¹ GROUP BY è¯­å¥è¿›è¡Œéšå¼æ’åºã€‚</li><li>å‡½æ•°ç´¢å¼•ï¼šä» MySQL 8.0.13 ç‰ˆæœ¬å¼€å§‹æ”¯æŒåœ¨ç´¢å¼•ä¸­ä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼çš„å€¼ï¼Œä¹Ÿå°±æ˜¯åœ¨ç´¢å¼•ä¸­å¯ä»¥åŒ…å«å‡½æ•°æˆ–è€…è¡¨è¾¾å¼</li></ul><h4 id="ä¸»é”®ç´¢å¼•-Primary-Key"><a href="#ä¸»é”®ç´¢å¼•-Primary-Key" class="headerlink" title="ä¸»é”®ç´¢å¼•  Primary Key"></a>ä¸»é”®ç´¢å¼•  Primary Key</h4><p>æ•°æ®è¡¨çš„ä¸»é”®åˆ—ä½¿ç”¨çš„å°±æ˜¯ä¸»é”®ç´¢å¼•ã€‚</p><p>ä¸€å¼ æ•°æ®è¡¨æœ‰åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Œå¹¶ä¸”ä¸»é”®ä¸èƒ½ä¸º nullï¼Œä¸èƒ½é‡å¤ã€‚</p><ul><li>æ£€æŸ¥å”¯ä¸€éç©ºç´¢å¼•<ul><li>InnoDBé¦–å…ˆæ£€æŸ¥è¡¨ä¸­æ˜¯å¦å­˜åœ¨å”¯ä¸€ç´¢å¼•ä¸”è¯¥ç´¢å¼•çš„æ‰€æœ‰åˆ—éƒ½ä¸å…è®¸ä¸ºnullã€‚å¦‚æœæ‰¾åˆ°è¿™æ ·çš„ç´¢å¼•ï¼ŒInnoDBä¼šå°†å…¶ä½œä¸ºä¸»é”®ã€‚</li></ul></li><li>è‡ªåŠ¨åˆ›å»ºéšè—çš„è‡ªå¢ä¸»é”®<ul><li>å¦‚æœä¸Šè¿°æ¡ä»¶ä¸æ»¡è¶³ï¼Œå³è¡¨ä¸­æ²¡æœ‰åˆé€‚çš„å”¯ä¸€éç©ºç´¢å¼•ï¼ŒInnoDBä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªéšè—çš„ã€è‡ªå¢çš„ã€6å­—èŠ‚å¤§å°çš„ä¸»é”®ã€‚</li><li>è¿™ä¸ªéšè—çš„ä¸»é”®å¯¹ç”¨æˆ·æ˜¯ä¸å¯è§çš„ï¼Œä½†åœ¨InnoDBå†…éƒ¨ç”¨äºå”¯ä¸€åœ°æ ‡è¯†æ¯ä¸€è¡Œã€‚</li><li>è¿™ä¸ªä¸»é”®æ˜¯è‡ªå¢çš„ï¼Œæ„å‘³ç€æ¯æ’å…¥ä¸€è¡Œæ–°æ•°æ®ï¼Œä¸»é”®çš„å€¼éƒ½ä¼šè‡ªåŠ¨å¢åŠ ã€‚</li></ul></li></ul><h4 id="äºŒçº§ç´¢å¼•"><a href="#äºŒçº§ç´¢å¼•" class="headerlink" title="äºŒçº§ç´¢å¼•"></a>äºŒçº§ç´¢å¼•</h4><p>äºŒçº§ç´¢å¼•çš„ä½œç”¨å°±æ˜¯é€šè¿‡ç´¢å¼•å¿«é€Ÿæ‰¾åˆ°ä¸»é”®ç´¢å¼•ï¼ˆå®šä½ä¸»é”®çš„ä½ç½®ï¼‰</p><p>äºŒçº§ç´¢å¼•ï¼ˆSecondary Indexï¼‰åˆç§°ä¸ºè¾…åŠ©ç´¢å¼•ï¼Œæ˜¯å› ä¸ºäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®æ˜¯ä¸»é”®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡äºŒçº§ç´¢å¼•ï¼Œå¯ä»¥å®šä½ä¸»é”®çš„ä½ç½®ã€‚</p><p>å”¯ä¸€ç´¢å¼•ï¼Œæ™®é€šç´¢å¼•ï¼Œå‰ç¼€ç´¢å¼•ç­‰ç´¢å¼•å±äºäºŒçº§ç´¢å¼•ã€‚</p><ul><li><strong>å”¯ä¸€ç´¢å¼•(Unique Key)</strong>:å”¯ä¸€ç´¢å¼•ä¹Ÿæ˜¯ä¸€ç§çº¦æŸã€‚å”¯ä¸€ç´¢å¼•çš„å±æ€§åˆ—ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ï¼Œä½†æ˜¯å…è®¸æ•°æ®ä¸º NULLï¼Œä¸€å¼ è¡¨å…è®¸åˆ›å»ºå¤šä¸ªå”¯ä¸€ç´¢å¼•ã€‚ å»ºç«‹å”¯ä¸€ç´¢å¼•çš„ç›®çš„å¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯ä¸ºäº†è¯¥å±æ€§åˆ—çš„æ•°æ®çš„å”¯ä¸€æ€§ï¼Œè€Œä¸æ˜¯ä¸ºäº†æŸ¥è¯¢æ•ˆç‡ã€‚</li><li><strong>æ™®é€šç´¢å¼•(Index)</strong>:æ™®é€šç´¢å¼•çš„å”¯ä¸€ä½œç”¨å°±æ˜¯ä¸ºäº†å¿«é€ŸæŸ¥è¯¢æ•°æ®ï¼Œä¸€å¼ è¡¨å…è®¸åˆ›å»ºå¤šä¸ªæ™®é€šç´¢å¼•ï¼Œå¹¶å…è®¸æ•°æ®é‡å¤å’Œ NULLã€‚</li><li><strong>å‰ç¼€ç´¢å¼•(Prefix)</strong>:å‰ç¼€ç´¢å¼•åªé€‚ç”¨äºå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ã€‚å‰ç¼€ç´¢å¼•æ˜¯å¯¹æ–‡æœ¬çš„å‰å‡ ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•ï¼Œç›¸æ¯”æ™®é€šç´¢å¼•å»ºç«‹çš„æ•°æ®æ›´å°ï¼Œ<br>  å› ä¸ºåªå–å‰å‡ ä¸ªå­—ç¬¦ã€‚</li><li><strong>å…¨æ–‡ç´¢å¼•(Full Text)</strong>:å…¨æ–‡ç´¢å¼•ä¸»è¦æ˜¯ä¸ºäº†æ£€ç´¢å¤§æ–‡æœ¬æ•°æ®ä¸­çš„å…³é”®å­—çš„ä¿¡æ¯ï¼Œæ˜¯ç›®å‰æœç´¢å¼•æ“æ•°æ®åº“ä½¿ç”¨çš„ä¸€ç§æŠ€æœ¯ã€‚Mysql5.6 ä¹‹å‰åªæœ‰ MYISAM å¼•æ“æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œ5.6 ä¹‹å InnoDB ä¹Ÿæ”¯æŒäº†å…¨æ–‡ç´¢å¼•ã€‚</li></ul><hr><h4 id="èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•</h4><h5 id="èšç°‡ç´¢å¼•ï¼ˆèšé›†ç´¢å¼•ï¼‰"><a href="#èšç°‡ç´¢å¼•ï¼ˆèšé›†ç´¢å¼•ï¼‰" class="headerlink" title="èšç°‡ç´¢å¼•ï¼ˆèšé›†ç´¢å¼•ï¼‰"></a>èšç°‡ç´¢å¼•ï¼ˆèšé›†ç´¢å¼•ï¼‰</h5><p><strong>èšç°‡ç´¢å¼•ï¼ˆClustered Indexï¼‰å³ç´¢å¼•ç»“æ„å’Œæ•°æ®ä¸€èµ·å­˜æ”¾çš„ç´¢å¼•ï¼Œå¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹ã€‚InnoDB ä¸­çš„ä¸»é”®ç´¢å¼•å°±å±äºèšç°‡ç´¢å¼•ã€‚</strong></p><p>åœ¨ MySQL ä¸­ï¼ŒInnoDB å¼•æ“çš„è¡¨çš„ <code>.ibd</code>æ–‡ä»¶å°±åŒ…å«äº†è¯¥è¡¨çš„ç´¢å¼•å’Œæ•°æ®ï¼Œå¯¹äº InnoDB å¼•æ“è¡¨æ¥è¯´ï¼Œè¯¥è¡¨çš„ç´¢å¼•(B+æ ‘)çš„æ¯ä¸ªéå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•å’Œç´¢å¼•å¯¹åº”çš„æ•°æ®ã€‚</p><h5 id="éèšç°‡ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰"><a href="#éèšç°‡ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰" class="headerlink" title="éèšç°‡ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰"></a>éèšç°‡ç´¢å¼•ï¼ˆéèšé›†ç´¢å¼•ï¼‰</h5><p><strong>éèšç°‡ç´¢å¼•(Non-Clustered Index)å³ç´¢å¼•ç»“æ„å’Œæ•°æ®åˆ†å¼€å­˜æ”¾çš„ç´¢å¼•ï¼Œå¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹ã€‚äºŒçº§ç´¢å¼•(è¾…åŠ©ç´¢å¼•)å°±å±äºéèšç°‡ç´¢å¼•ã€‚MySQL çš„ MyISAM å¼•æ“ï¼Œä¸ç®¡ä¸»é”®è¿˜æ˜¯éä¸»é”®ï¼Œä½¿ç”¨çš„éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚</strong></p><p>éèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å¹¶ä¸ä¸€å®šå­˜æ”¾æ•°æ®çš„æŒ‡é’ˆï¼Œå› ä¸ºäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å°±å­˜æ”¾çš„æ˜¯ä¸»é”®ï¼Œæ ¹æ®ä¸»é”®å†å›è¡¨æŸ¥æ•°æ®ã€‚</p><hr><p>èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401291152682.png" alt="image.png"></p><blockquote><p>é¢è¯•é¢˜: éèšç°‡ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—(è¦†ç›–ç´¢å¼•) ï¼Ÿ</p></blockquote><p>åœ¨MySQLä¸­ï¼Œä½¿ç”¨éèšç°‡ç´¢å¼•ï¼ˆä¹Ÿç§°ä¸ºäºŒçº§ç´¢å¼•æˆ–è¾…åŠ©ç´¢å¼•ï¼‰æ—¶ï¼Œå¹¶ä¸ä¸€å®šæ€»æ˜¯éœ€è¦è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚æ˜¯å¦éœ€è¦å›è¡¨æŸ¥è¯¢å–å†³äºæŸ¥è¯¢æ˜¯å¦ä¸ºè¦†ç›–ç´¢å¼•æŸ¥è¯¢ã€‚</p><p><strong>å›è¡¨æŸ¥è¯¢</strong>:</p><ul><li>å½“ä¸€ä¸ªæŸ¥è¯¢ä½¿ç”¨äº†éèšç°‡ç´¢å¼•ä½†æ˜¯éœ€è¦è·å–çš„æ•°æ®ä¸å®Œå…¨åœ¨ç´¢å¼•ä¸­æ—¶ï¼Œå°±ä¼šå‘ç”Ÿå›è¡¨æŸ¥è¯¢ã€‚</li><li>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®åº“é¦–å…ˆä½¿ç”¨éèšç°‡ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„ä¸»é”®ï¼Œç„¶åå†ä½¿ç”¨è¿™ä¸ªä¸»é”®å»èšç°‡ç´¢å¼•ï¼ˆå³æ•°æ®è¡¨ï¼‰ä¸­æ£€ç´¢å®Œæ•´çš„è¡Œæ•°æ®ã€‚</li></ul><p><strong>è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰</strong>:</p><ul><li>å¦‚æœæŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰æ•°æ®éƒ½åŒ…å«åœ¨éèšç°‡ç´¢å¼•ä¸­ï¼Œè¿™ç§æƒ…å†µç§°ä¸ºè¦†ç›–ç´¢å¼•ã€‚</li><li>å½“å‘ç”Ÿè¦†ç›–ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œä¸éœ€è¦è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œå› ä¸ºç´¢å¼•å·²ç»åŒ…å«äº†æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯ã€‚</li><li>è¦†ç›–ç´¢å¼•å¯ä»¥æ˜¾è‘—æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå› ä¸ºå®ƒé¿å…äº†é¢å¤–çš„I&#x2F;Oæ“ä½œå»è¯»å–æ•°æ®è¡¨ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªåŒ…å«<code>id</code>ï¼ˆä¸»é”®ï¼‰ï¼Œ<code>name</code>ï¼Œå’Œ<code>age</code>åˆ—çš„è¡¨ï¼Œä¸”å¯¹<code>name</code>åˆ—æœ‰ä¸€ä¸ªéèšç°‡ç´¢å¼•ã€‚<br>å¦‚æœä½ çš„æŸ¥è¯¢åªæ˜¯æ£€ç´¢<code>name</code>åˆ—ï¼ˆæ¯”å¦‚<code>SELECT name FROM table WHERE name = &#39;Alice&#39;</code>ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ¥è¯¢å°±æ˜¯ä¸€ä¸ªè¦†ç›–ç´¢å¼•æŸ¥è¯¢ï¼Œä¸éœ€è¦å›è¡¨æŸ¥è¯¢ã€‚ä½†æ˜¯å¦‚æœä½ éœ€è¦æ£€ç´¢<code>age</code>åˆ—çš„ä¿¡æ¯ï¼ˆå¦‚<code>SELECT age FROM table WHERE name = &#39;Alice&#39;</code>ï¼‰ï¼Œå°±éœ€è¦å›è¡¨æŸ¥è¯¢äº†ã€‚</p><h3 id="4ã€è¦†ç›–ç´¢å¼•å’Œè”åˆç´¢å¼•"><a href="#4ã€è¦†ç›–ç´¢å¼•å’Œè”åˆç´¢å¼•" class="headerlink" title="4ã€è¦†ç›–ç´¢å¼•å’Œè”åˆç´¢å¼•"></a>4ã€è¦†ç›–ç´¢å¼•å’Œè”åˆç´¢å¼•</h3><h4 id="è¦†ç›–ç´¢å¼•"><a href="#è¦†ç›–ç´¢å¼•" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h4><p>å¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«ï¼ˆæˆ–è€…è¯´è¦†ç›–ï¼‰æ‰€æœ‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µçš„å€¼ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸º <strong>è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰</strong> ã€‚æˆ‘ä»¬çŸ¥é“åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œå¦‚æœä¸æ˜¯ä¸»é”®ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®+åˆ—å€¼ã€‚æœ€ç»ˆè¿˜æ˜¯è¦â€œå›è¡¨â€ï¼Œä¹Ÿå°±æ˜¯è¦é€šè¿‡ä¸»é”®å†æŸ¥æ‰¾ä¸€æ¬¡ï¼Œè¿™æ ·å°±ä¼šæ¯”è¾ƒæ…¢ã€‚è€Œè¦†ç›–ç´¢å¼•å°±æ˜¯æŠŠè¦æŸ¥è¯¢å‡ºçš„åˆ—å’Œç´¢å¼•æ˜¯å¯¹åº”çš„ï¼Œä¸åšå›è¡¨æ“ä½œï¼</p><p><strong>è¦†ç›–ç´¢å¼•å³éœ€è¦æŸ¥è¯¢çš„å­—æ®µæ­£å¥½æ˜¯ç´¢å¼•çš„å­—æ®µï¼Œé‚£ä¹ˆç›´æ¥æ ¹æ®è¯¥ç´¢å¼•ï¼Œå°±å¯ä»¥æŸ¥åˆ°æ•°æ®äº†ï¼Œè€Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚</strong></p><h4 id="è”åˆç´¢å¼•"><a href="#è”åˆç´¢å¼•" class="headerlink" title="è”åˆç´¢å¼•"></a>è”åˆç´¢å¼•</h4><p>ä½¿ç”¨è¡¨ä¸­çš„å¤šä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œå°±æ˜¯Â <strong>è”åˆç´¢å¼•</strong>ï¼Œä¹Ÿå«Â <strong>ç»„åˆç´¢å¼•</strong>Â æˆ–Â <strong>å¤åˆç´¢å¼•</strong>ã€‚</p><p>ä»¥Â <code>score</code>Â å’ŒÂ <code>name</code>Â ä¸¤ä¸ªå­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `cus_order` <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">INDEX</span> id_score_name(score, <span class="hljs-type">name</span>);<br></code></pre></td></tr></table></figure><p><strong>è”åˆç´¢å¼•çš„ B+Tree æ˜¯å…ˆæŒ‰ score è¿›è¡Œæ’åºï¼Œç„¶åå† score ç›¸åŒçš„æƒ…å†µå†æŒ‰ name å­—æ®µæ’åºã€‚</strong></p><h4 id="æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™"><a href="#æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™" class="headerlink" title="æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™"></a>æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™</h4><p>æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™æŒ‡çš„æ˜¯ï¼Œ</p><ul><li>åœ¨ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œ<strong>MySQL</strong> ä¼šæ ¹æ®è”åˆç´¢å¼•ä¸­çš„å­—æ®µé¡ºåºï¼Œä»å·¦åˆ°å³ä¾æ¬¡åˆ°æŸ¥è¯¢æ¡ä»¶ä¸­å»åŒ¹é…ï¼Œ<ul><li>å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­å­˜åœ¨ä¸è”åˆç´¢å¼•ä¸­æœ€å·¦ä¾§å­—æ®µç›¸åŒ¹é…çš„å­—æ®µï¼Œåˆ™å°±ä¼šä½¿ç”¨è¯¥å­—æ®µè¿‡æ»¤ä¸€æ‰¹æ•°æ®ï¼Œç›´è‡³è”åˆç´¢å¼•ä¸­å…¨éƒ¨å­—æ®µåŒ¹é…å®Œæˆï¼Œ </li><li>æˆ–è€…åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ <strong><code>&gt;</code><strong>ã€</strong><code>&lt;</code></strong> ï¼‰æ‰ä¼šåœæ­¢åŒ¹é…ã€‚å¯¹äº <strong><code>&gt;=</code><strong>ã€</strong><code>&lt;=</code><strong>ã€</strong><code>BETWEEN</code><strong>ã€</strong><code>like</code></strong> å‰ç¼€åŒ¹é…çš„èŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸ä¼šåœæ­¢åŒ¹é…ã€‚</li></ul></li><li>æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œå¯ä»¥å°†åŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨æœ€å·¦è¾¹ï¼Œè¿™ä¹Ÿå¯ä»¥è¿‡æ»¤æ›´å¤šæ•°æ®</li></ul><blockquote><p><strong>è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ï¼Œåœ¨é‡åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ &gt;ã€&lt; ï¼‰çš„æ—¶å€™ï¼Œå°±ä¼šåœæ­¢åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯èŒƒå›´æŸ¥è¯¢çš„å­—æ®µå¯ä»¥ç”¨åˆ°è”åˆç´¢å¼•ï¼Œä½†æ˜¯åœ¨èŒƒå›´æŸ¥è¯¢å­—æ®µåé¢çš„å­—æ®µæ— æ³•ç”¨åˆ°è”åˆç´¢å¼•ã€‚ä½†æ˜¯ï¼Œå¯¹äº &gt;&#x3D;ã€&lt;&#x3D;ã€BETWEENã€like å‰ç¼€åŒ¹é…è¿™å››ç§èŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸ä¼šåœæ­¢åŒ¹é…</strong></p></blockquote><hr><p>å¤ä¹ çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š <a href="https://mp.weixin.qq.com/s/8qemhRg5MgXs1So5YCv0fQ">https://mp.weixin.qq.com/s/8qemhRg5MgXs1So5YCv0fQ</a></p><p>çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">-- ç¤ºä¾‹: åˆ›å»ºä¸€ä¸ªåŒ…å«è”åˆç´¢å¼•çš„è¡¨</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> example_table (<br>    col1 <span class="hljs-type">INT</span>,<br>    col2 <span class="hljs-type">INT</span>,<br>    col3 <span class="hljs-type">INT</span>,<br>    <span class="hljs-keyword">INDEX</span> idx_col1_col2_col3 (col1, col2, col3)<br>);<br></code></pre></td></tr></table></figure><p>åªæœ‰åœ¨ col1 ç›¸åŒçš„æƒ…å†µæ‰ï¼Œcol2 æ‰æ˜¯æœ‰åºçš„</p><p>è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°ã€ŒèŒƒå›´æŸ¥è¯¢ã€å°±ä¼šåœæ­¢åŒ¹é…ã€‚</p><blockquote><p>Q1: select * from t_table where a &gt; 1 and b &#x3D; 2ï¼Œè”åˆç´¢å¼•ï¼ˆa, bï¼‰å“ªä¸€ä¸ªå­—æ®µç”¨åˆ°äº†è”åˆç´¢å¼•çš„ B+Treeï¼Ÿ</p></blockquote><p>ç”±äºè”åˆç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰æ˜¯å…ˆæŒ‰ç…§ a å­—æ®µçš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥ç¬¦åˆ a &gt; 1 æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»çš„ï¼Œäºæ˜¯åœ¨è¿›è¡Œç´¢å¼•æ‰«æçš„æ—¶å€™ï¼Œå¯ä»¥å®šä½åˆ°ç¬¦åˆ a &gt; 1 æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆ a &gt; 1 æ¡ä»¶ä½ç½®ã€‚æ‰€ä»¥ a å­—æ®µå¯ä»¥åœ¨è”åˆç´¢å¼•çš„ B+Tree ä¸­è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚</p><p><strong>ä½†æ˜¯åœ¨ç¬¦åˆ a &gt; 1 æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œb å­—æ®µçš„å€¼æ˜¯æ— åºçš„</strong>ã€‚</p><p>è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™åœ¨é‡åˆ° a å­—æ®µçš„èŒƒå›´æŸ¥è¯¢ï¼ˆ &gt;ï¼‰åå°±åœæ­¢åŒ¹é…äº†ï¼Œå› æ­¤ b å­—æ®µå¹¶æ²¡æœ‰ä½¿ç”¨åˆ°è”åˆç´¢å¼•ã€‚</p><blockquote><p>Q2: select * from t_table where a &gt;&#x3D; 1 and b &#x3D; 2ï¼Œè”åˆç´¢å¼•ï¼ˆa, bï¼‰å“ªä¸€ä¸ªå­—æ®µç”¨åˆ°äº†è”åˆç´¢å¼•çš„ B+Treeï¼Ÿ</p></blockquote><p>ç”±äºè”åˆç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰æ˜¯å…ˆæŒ‰ç…§ a å­—æ®µçš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥ç¬¦åˆ &gt;&#x3D; 1 æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•è‚¯å®šæ˜¯ç›¸é‚»ï¼Œäºæ˜¯åœ¨è¿›è¡Œç´¢å¼•æ‰«æçš„æ—¶å€™ï¼Œå¯ä»¥å®šä½åˆ°ç¬¦åˆ &gt;&#x3D; 1 æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•ä¸ç¬¦åˆ a&gt;&#x3D; 1 æ¡ä»¶ä½ç½®ã€‚æ‰€ä»¥ a å­—æ®µå¯ä»¥åœ¨è”åˆç´¢å¼•çš„ B+Tree ä¸­è¿›è¡Œç´¢å¼•æŸ¥è¯¢ã€‚</p><p>è™½ç„¶åœ¨ç¬¦åˆ a&gt;&#x3D; 1 æ¡ä»¶çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œb å­—æ®µçš„å€¼æ˜¯ã€Œæ— åºã€çš„ï¼Œ<strong>ä½†æ˜¯å¯¹äºç¬¦åˆ a &#x3D; 1 çš„äºŒçº§ç´¢å¼•è®°å½•çš„èŒƒå›´é‡Œï¼Œb å­—æ®µçš„å€¼æ˜¯ã€Œæœ‰åºã€çš„</strong>ï¼ˆå› ä¸ºå¯¹äºè”åˆç´¢å¼•ï¼Œæ˜¯å…ˆæŒ‰ç…§ a å­—æ®µçš„å€¼æ’åºï¼Œç„¶ååœ¨ a å­—æ®µçš„å€¼ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå†æŒ‰ç…§ b å­—æ®µçš„å€¼è¿›è¡Œæ’åºï¼‰ã€‚</p><p>äºæ˜¯ï¼Œåœ¨ç¡®å®šéœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•çš„èŒƒå›´æ—¶ï¼Œå½“äºŒçº§ç´¢å¼•è®°å½•çš„ a å­—æ®µå€¼ä¸º 1 æ—¶ï¼Œå¯ä»¥é€šè¿‡ b &#x3D; 2 æ¡ä»¶å‡å°‘éœ€è¦æ‰«æçš„äºŒçº§ç´¢å¼•è®°å½•èŒƒå›´ï¼ˆb å­—æ®µå¯ä»¥åˆ©ç”¨è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢çš„æ„æ€ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»ç¬¦åˆ a &#x3D; 1 and b &#x3D; 2 æ¡ä»¶çš„ç¬¬ä¸€æ¡è®°å½•å¼€å§‹æ‰«æï¼Œè€Œä¸éœ€è¦ä»ç¬¬ä¸€ä¸ª a å­—æ®µå€¼ä¸º 1 çš„è®°å½•å¼€å§‹æ‰«æã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>Q2 è¿™æ¡æŸ¥è¯¢è¯­å¥ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢</strong>ã€‚</p><blockquote><p>Q3: SELECT * FROM t_table WHERE a BETWEEN 2 AND 8 AND b &#x3D; 2ï¼Œè”åˆç´¢å¼•ï¼ˆa, bï¼‰å“ªä¸€ä¸ªå­—æ®µç”¨åˆ°äº†è”åˆç´¢å¼•çš„ B+Treeï¼Ÿ</p></blockquote><p>Q3 æŸ¥è¯¢æ¡ä»¶ä¸­ a BETWEEN 2 AND 8 çš„æ„æ€æ˜¯æŸ¥è¯¢ a å­—æ®µçš„å€¼åœ¨ 2 å’Œ 8 ä¹‹é—´çš„è®°å½•ã€‚</p><p>ä¸åŒçš„æ•°æ®åº“å¯¹ BETWEEN â€¦ AND å¤„ç†æ–¹å¼æ˜¯æœ‰å·®å¼‚çš„ã€‚åœ¨ MySQL ä¸­ï¼ŒBETWEEN åŒ…å«äº† value1 å’Œ value2 è¾¹ç•Œå€¼ï¼Œç±»ä¼¼äº &gt;&#x3D; and &#x3D;&lt;ã€‚è€Œæœ‰çš„æ•°æ®åº“åˆ™ä¸åŒ…å« value1 å’Œ value2 è¾¹ç•Œå€¼ï¼ˆç±»ä¼¼äº &gt; and &lt;ï¼‰ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åªè®¨è®º MySQLã€‚ç”±äº MySQL çš„ BETWEEN åŒ…å« value1 å’Œ value2 è¾¹ç•Œå€¼ï¼Œ</p><p>æ‰€ä»¥ç±»ä¼¼äº Q2 æŸ¥è¯¢è¯­å¥ï¼Œå› æ­¤Â <strong>Q3 è¿™æ¡æŸ¥è¯¢è¯­å¥ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢</strong>ã€‚</p><blockquote><p>Q4: SELECT * FROM t_user WHERE name like â€˜j%â€™ and age &#x3D; 22ï¼Œè”åˆç´¢å¼•ï¼ˆname, ageï¼‰å“ªä¸€ä¸ªå­—æ®µç”¨åˆ°äº†è”åˆç´¢å¼•çš„ B+Treeï¼Ÿ</p></blockquote><p>ç”±äºè”åˆç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰æ˜¯å…ˆæŒ‰ç…§ name å­—æ®µçš„å€¼æ’åºçš„ï¼Œæ‰€ä»¥å‰ç¼€ä¸º â€˜jâ€™ çš„ name å­—æ®µçš„äºŒçº§ç´¢å¼•è®°å½•éƒ½æ˜¯ç›¸é‚»çš„ï¼Œ äºæ˜¯åœ¨è¿›è¡Œç´¢å¼•æ‰«æçš„æ—¶å€™ï¼Œå¯ä»¥å®šä½åˆ°ç¬¦åˆå‰ç¼€ä¸º â€˜jâ€™ çš„ name å­—æ®µçš„ç¬¬ä¸€æ¡è®°å½•ï¼Œç„¶åæ²¿ç€è®°å½•æ‰€åœ¨çš„é“¾è¡¨å‘åæ‰«æï¼Œç›´åˆ°æŸæ¡è®°å½•çš„ name å‰ç¼€ä¸ä¸º â€˜jâ€™ ä¸ºæ­¢ã€‚</p><p>æ‰€ä»¥ a å­—æ®µå¯ä»¥åœ¨è”åˆç´¢å¼•çš„ B+Tree ä¸­è¿›è¡Œç´¢å¼•æŸ¥è¯¢ï¼Œå½¢æˆçš„æ‰«æåŒºé—´æ˜¯<code>[&#39;j&#39;,&#39;k&#39;)</code>ã€‚æ³¨æ„ï¼Œ j æ˜¯é—­åŒºé—´ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>Q4 è¿™æ¡æŸ¥è¯¢è¯­å¥ a å’Œ b å­—æ®µéƒ½ç”¨åˆ°äº†è”åˆç´¢å¼•è¿›è¡Œç´¢å¼•æŸ¥è¯¢</strong>ã€‚</p><h3 id="5ã€ç´¢å¼•ä¸‹æ¨"><a href="#5ã€ç´¢å¼•ä¸‹æ¨" class="headerlink" title="5ã€ç´¢å¼•ä¸‹æ¨"></a>5ã€ç´¢å¼•ä¸‹æ¨</h3><p><strong>ç´¢å¼•ä¸‹æ¨ï¼ˆIndex Condition Pushdownï¼‰</strong> æ˜¯ <strong>MySQL 5.6</strong> ç‰ˆæœ¬ä¸­æä¾›çš„ä¸€é¡¹ç´¢å¼•ä¼˜åŒ–åŠŸèƒ½ï¼Œå¯ä»¥åœ¨éèšç°‡ç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œè¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ã€‚</p><ol><li><strong>æ²¡æœ‰ç´¢å¼•ä¸‹æ¨çš„æƒ…å†µ</strong>:<ul><li>åœ¨ä¼ ç»Ÿçš„ç´¢å¼•ä½¿ç”¨ä¸­ï¼Œæ•°æ®åº“é¦–å…ˆä½¿ç”¨ç´¢å¼•æ¥æ‰¾åˆ°ç¬¦åˆç´¢å¼•éƒ¨åˆ†æ¡ä»¶çš„è®°å½•ã€‚ç„¶åï¼Œå¯¹äºæ¯ä¸ªæ‰¾åˆ°çš„ç´¢å¼•æ¡ç›®ï¼Œæ•°æ®åº“éƒ½ä¼šè¿›è¡Œâ€œå›è¡¨â€æ“ä½œï¼Œå³è®¿é—®ä¸»æ•°æ®è¡¨æ¥è·å–å®Œæ•´çš„è¡Œæ•°æ®ã€‚</li><li>ä¸€æ—¦è·å–äº†å®Œæ•´çš„è¡Œæ•°æ®ï¼Œæ•°æ®åº“æ‰èƒ½å¯¹WHEREå­å¥ä¸­çš„å…¶ä»–æ¡ä»¶è¿›è¡Œè¯„ä¼°ã€‚è¿™æ„å‘³ç€å³ä½¿æŸäº›è¡Œæœ€ç»ˆä¸æ»¡è¶³æ‰€æœ‰æŸ¥è¯¢æ¡ä»¶ï¼Œå®ƒä»¬ä»ç„¶ä¼šè¢«ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¯¼è‡´ä¸å¿…è¦çš„I&#x2F;Oå¼€é”€ã€‚</li></ul></li><li><strong>æœ‰ç´¢å¼•ä¸‹æ¨çš„æƒ…å†µ</strong>:<ul><li>ä½¿ç”¨ç´¢å¼•ä¸‹æ¨æ—¶ï¼Œæ•°æ®åº“åœ¨ç´¢å¼•éå†è¿‡ç¨‹ä¸­å°±å¯ä»¥å¯¹ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µè¿›è¡Œæ›´å¤šçš„åˆ¤æ–­ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªç´¢å¼•åŒ…å«äº†å¤šä¸ªåˆ—ï¼Œæ•°æ®åº“å¯ä»¥åœ¨è®¿é—®ä¸»æ•°æ®è¡¨ä¹‹å‰ï¼Œåˆ©ç”¨ç´¢å¼•ä¸­çš„è¿™äº›åˆ—æ¥è¿‡æ»¤æ‰æ›´å¤šä¸ç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚</li><li>ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç´¢å¼•æ˜¯åœ¨<code>first_name</code>å’Œ<code>age</code>ä¸¤ä¸ªå­—æ®µä¸Šï¼Œå½“æŸ¥è¯¢æ¡ä»¶æ˜¯<code>first_name = &#39;Alice&#39; AND age &gt; 25</code>æ—¶ï¼Œæ•°æ®åº“å¯ä»¥åœ¨ç´¢å¼•å±‚é¢å°±åˆ©ç”¨è¿™ä¸¤ä¸ªæ¡ä»¶è¿›è¡Œç­›é€‰ï¼Œè€Œä¸ä»…ä»…æ˜¯<code>first_name</code>å­—æ®µã€‚è¿™å‡å°‘äº†å›è¡¨çš„æ¬¡æ•°ï¼Œå› ä¸ºåªæœ‰åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„è®°å½•æ‰ä¼šè¢«å®é™…åŠ è½½å…¨è¡Œæ•°æ®è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚</li></ul></li></ol><p>çœ‹ä¸Šé¢è¿™ä¸ªå¯¹æ¯”åŒºåˆ«ï¼Œæ„Ÿè§‰æ˜¯åœ¨ä½¿ç”¨ <code>&gt;</code>  è¿™ç§èŒƒå›´æŸ¥è¯¢è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p><hr><h3 id="6ã€æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„ä¸€äº›å»ºè®®"><a href="#6ã€æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„ä¸€äº›å»ºè®®" class="headerlink" title="6ã€æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„ä¸€äº›å»ºè®®"></a>6ã€æ­£ç¡®ä½¿ç”¨ç´¢å¼•çš„ä¸€äº›å»ºè®®</h3><ul><li>é€‰æ‹©åˆé€‚çš„å­—æ®µåˆ›å»ºç´¢å¼•</li><li>è¢«é¢‘ç¹æ›´æ–°çš„å­—æ®µåº”è¯¥æ…é‡å»ºç«‹ç´¢å¼•</li><li>é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡ï¼ˆå»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡ 5 ä¸ªï¼‰</li><li>å°½å¯èƒ½çš„è€ƒè™‘å»ºç«‹è”åˆç´¢å¼•è€Œä¸æ˜¯å•åˆ—ç´¢å¼•</li><li>æ³¨æ„é¿å…å†—ä½™ç´¢å¼•</li><li>å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µä½¿ç”¨å‰ç¼€ç´¢å¼•ä»£æ›¿æ™®é€šç´¢å¼•</li><li>é¿å…ç´¢å¼•å¤±æ•ˆ</li><li>åˆ é™¤é•¿æœŸæœªä½¿ç”¨çš„ç´¢å¼•</li><li>çŸ¥é“å¦‚ä½•åˆ†æè¯­å¥æ˜¯å¦èµ°ç´¢å¼•æŸ¥è¯¢ EXPLAIN</li><li>â€¦</li></ul><blockquote><p>é¿å…ç´¢å¼•å¤±æ•ˆ</p></blockquote><p>ç´¢å¼•å¤±æ•ˆä¹Ÿæ˜¯æ…¢æŸ¥è¯¢çš„ä¸»è¦åŸå› ä¹‹ä¸€ï¼Œå¸¸è§çš„å¯¼è‡´ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µæœ‰ä¸‹é¢è¿™äº›ï¼š</p><ul><li><code>SELECT *</code> ä¸ä¼šç›´æ¥å¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼ˆå¦‚æœä¸èµ°ç´¢å¼•å¤§æ¦‚ç‡æ˜¯å› ä¸º where æŸ¥è¯¢èŒƒå›´è¿‡å¤§å¯¼è‡´çš„ï¼‰ï¼Œä½†å®ƒå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›å…¶ä»–çš„æ€§èƒ½é—®é¢˜æ¯”å¦‚é€ æˆç½‘ç»œä¼ è¾“å’Œæ•°æ®å¤„ç†çš„æµªè´¹ã€æ— æ³•ä½¿ç”¨ç´¢å¼•è¦†ç›–;</li><li>åˆ›å»ºäº†ç»„åˆç´¢å¼•ï¼Œä½†æŸ¥è¯¢æ¡ä»¶æœªå‡†å®ˆæœ€å·¦åŒ¹é…åŸåˆ™;</li><li>åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè®¡ç®—ã€å‡½æ•°ã€ç±»å‹è½¬æ¢ç­‰æ“ä½œ;</li><li>ä»¥ % å¼€å¤´çš„ LIKE æŸ¥è¯¢æ¯”å¦‚ <code>LIKE &#39;%abc&#39;;</code>;</li><li>æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨ ORï¼Œä¸” OR çš„å‰åæ¡ä»¶ä¸­æœ‰ä¸€ä¸ªåˆ—æ²¡æœ‰ç´¢å¼•ï¼Œæ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ä½¿ç”¨åˆ°;</li><li>IN çš„å–å€¼èŒƒå›´è¾ƒå¤§æ—¶ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œèµ°å…¨è¡¨æ‰«æ(NOT IN å’Œ IN çš„å¤±æ•ˆåœºæ™¯ç›¸åŒ);</li><li>å‘ç”Ÿéšå¼è½¬æ¢</li><li>â€¦â€¦</li></ul><p>ç´¢å¼•å¤±æ•ˆåœºæ™¯å‚è€ƒï¼š <a href="https://mp.weixin.qq.com/s/mwME3qukHBFul57WQLkOYg">https://mp.weixin.qq.com/s/mwME3qukHBFul57WQLkOYg</a></p><p>to be continedâ€¦.</p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SSLè¯ä¹¦å®‰è£…</title>
    <link href="/2024/01/27/SSL%E8%AF%81%E4%B9%A6%E5%AE%89%E8%A3%85/"/>
    <url>/2024/01/27/SSL%E8%AF%81%E4%B9%A6%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€åˆ›å»ºè¯ä¹¦"><a href="#1ã€åˆ›å»ºè¯ä¹¦" class="headerlink" title="1ã€åˆ›å»ºè¯ä¹¦"></a>1ã€<strong>åˆ›å»ºè¯ä¹¦</strong></h3><p>SSL å…è´¹çš„è¯ä¹¦ï¼Œåœ¨å„ä¸ªäº‘æœåŠ¡å‚å•†éƒ½æœ‰æä¾›ï¼Œå¯ä»¥è‡ªå·±ç”³è¯·ã€‚è¿™é‡Œä»¥é˜¿é‡Œäº‘ä¸¾ä¾‹ï¼›</p><p>é˜¿é‡Œäº‘å…è´¹åŸŸåè¯ä¹¦ï¼š <a href="https://yundun.console.aliyun.com/?p=cas#/certExtend/free/cn-hangzhou">https://yundun.console.aliyun.com/?p=cas#/certExtend/free/cn-hangzhou</a></p><ol><li>æ­¥éª¤1ï¼›é€šè¿‡å…è´¹çš„æ–¹å¼åˆ›å»º SSLï¼Œä¹‹åé€šè¿‡å¼•å¯¼çš„ DNS æ–¹å¼è¿›è¡ŒéªŒè¯ã€‚å…¶å®å°±æ˜¯åœ¨ä½ çš„åŸŸåé‡Œé…ç½®ä¸‹éªŒè¯ä¿¡æ¯ã€‚</li><li>æ­¥éª¤2ï¼›ç”³è¯·åï¼Œ3-5åˆ†é’Ÿå·¦å³ DNS ä¼šéªŒè¯é€šè¿‡ï¼Œè¿™ä¸ªæ—¶å€™ä½ ç›´æ¥ä¸‹è½½ Nginx çš„ SSL åŒ…å³å¯ã€‚é‡Œé¢æœ‰2ä¸ªæ–‡ä»¶ã€x.keyã€x.pemã€‘</li></ol><p>SSLè¯ä¹¦ä¸‹å‘å ;ä¸‹è½½æ–‡ä»¶å®Œæˆï¼Œåœ¨å¯¹åº”çš„ _ dnsauthä¸»æœºè®°å½•æ˜¯å¯ä»¥åˆ é™¤(åŸŸåè§£æ)</p><p>å…·ä½“æ“ä½œçœ‹é˜¿é‡Œäº‘ç”³è¯·SSL è¯ä¹¦æ“ä½œæ–‡æ¡£</p><p>ç”³è¯·å®Œæˆå,é€‰æ‹©å¯¹åº”çš„æœåŠ¡å™¨è¿›è¡Œä¸‹è½½:  Nginx</p><ol><li>æŠŠä¸‹è½½å¥½çš„ SSL æ–‡ä»¶è§£å‹ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œé‡Œé¢å«æœ‰ x.keyã€x.pem ä¸¤ä¸ªæ–‡ä»¶ã€‚</li><li>åˆ›å»ºä¸€ä¸ª default.conf è¿™ä¸ªæ–‡ä»¶é…ç½®çš„ SSL ä¿¡æ¯</li></ol><p>çœ‹ä¸€ä¸‹è¿™ä¸ªæ“ä½œæ–‡æ¡£:  <a href="https://help.aliyun.com/zh/ssl-certificate/user-guide/install-ssl-certificates-on-nginx-servers-or-tengine-servers">https://help.aliyun.com/zh/ssl-certificate/user-guide/install-ssl-certificates-on-nginx-servers-or-tengine-servers</a></p><ul><li><ol><li>ç›´æ¥ä¿®æ”¹ nginx.conf çš„æ–‡ä»¶å†…å®¹</li></ol></li><li><ol start="2"><li>ä¿®æ”¹  conf.d æ–‡ä»¶å¤¹ ä¸‹çš„ defalut.conf æ–‡ä»¶</li></ol></li></ul><p>å‚è€ƒæ–‡æ¡£æ˜¯ç¬¬ä¸€ç§,è¿™é‡Œæ¼”ç¤ºç¬¬äºŒç§æ–¹å¼</p><p>ä¹‹æ‰€ä»¥ç¬¬äºŒç§æ–¹å¼èƒ½ç”Ÿæ•ˆ,æ˜¯å› ä¸ºåœ¨ nginx.conf çš„é…ç½®æ–‡ä»¶æœ‰è¿™ä¹ˆä¸€å¥ï¼›</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">include</span> <span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/conf.d/</span>*.conf; <br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆåªè¦æ˜¯ conf.d æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶éƒ½ä¼šè¢«åŠ è½½ã€‚æ‰€ä»¥ç›´æ¥åœ¨ conf.d&#x2F;default.conf é…ç½® SSL å°±ä¼šè¢«åŠ è½½ã€‚</p><h4 id="å•ä¸ªè¯ä¹¦"><a href="#å•ä¸ªè¯ä¹¦" class="headerlink" title="å•ä¸ªè¯ä¹¦"></a>å•ä¸ªè¯ä¹¦</h4><p>å¤åˆ¶conf.d æ–‡ä»¶å¤¹ ä¸‹çš„ defalut.conf æ–‡ä»¶ åˆ°æœ¬åœ°,è¿›è¡Œä¿®æ”¹</p><p>æ³¨æ„ä¿®æ”¹åŸŸåå’ŒSSLæ–‡ä»¶è·¯å¾„ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">listen</span>  [::]:<span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span>  openai.xfg.im;<br><br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)</span> https://<span class="hljs-variable">$server_name</span><span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>;<br><br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">443</span> ssl;<br>    <span class="hljs-attribute">server_name</span>  openai.xfg.im;<br><br>    <span class="hljs-attribute">ssl_certificate</span>      /etc/nginx/ssl/9740289_openai.xfg.im.pem;<br>    <span class="hljs-attribute">ssl_certificate_key</span>  /etc/nginx/ssl/9740289_openai.xfg.im.key;<br><br>    <span class="hljs-attribute">ssl_session_cache</span>    shared:SSL:<span class="hljs-number">1m</span>;<br>    <span class="hljs-attribute">ssl_session_timeout</span>  <span class="hljs-number">5m</span>;<br><br>    <span class="hljs-attribute">ssl_ciphers</span>  HIGH:!aNULL:!MD5;<br>    <span class="hljs-attribute">ssl_prefer_server_ciphers</span>  <span class="hljs-literal">on</span>;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">proxy_set_header</span>   X-Real-IP         <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">proxy_set_header</span>   Host              <span class="hljs-variable">$http_host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span>   X-Forwarded-For   <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        <span class="hljs-attribute">root</span>   /usr/share/nginx/html;<br>        <span class="hljs-attribute">index</span>  index.html index.htm;<br>    &#125;<br><br>    <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;<br>    <span class="hljs-section">location</span> = /50x.html &#123;<br>        <span class="hljs-attribute">root</span>   /usr/share/nginx/html;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ä¸€ä¸‹è¿™ä¸ªè·¯å¾„ &#x2F;etc&#x2F;nginx&#x2F;ssl&#x2F;  æ˜¯å®¹å™¨å†…çš„è·¯å¾„; ä¸æ˜¯æŒ‚è½½è·¯å¾„.</p><h4 id="å¤šä¸ªè¯ä¹¦"><a href="#å¤šä¸ªè¯ä¹¦" class="headerlink" title="å¤šä¸ªè¯ä¹¦"></a>å¤šä¸ªè¯ä¹¦</h4><p>å¦‚æœæ˜¯å¤šä¸ªè¯ä¹¦</p><p>å¦‚æœä½ éœ€è¦ç»™1ä¸ªä»¥ä¸Šçš„åŸŸåé…ç½®SSLï¼Œé‚£ä¹ˆå¯ä»¥é…ç½®å¤šç»„ server å¦‚ä¸‹ï¼›</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">listen</span>  [::]:<span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span>  itedus.cn;<br><br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)</span> https://<span class="hljs-variable">$server_name</span><span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>;<br><br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">443</span> ssl;<br>    <span class="hljs-attribute">server_name</span>  itedus.cn;<br><br>    <span class="hljs-attribute">ssl_certificate</span>      /etc/nginx/ssl/9750021_itedus.cn.pem;<br>    <span class="hljs-attribute">ssl_certificate_key</span>  /etc/nginx/ssl/9750021_itedus.cn.key;<br><br>    <span class="hljs-attribute">ssl_session_cache</span>    shared:SSL:<span class="hljs-number">1m</span>;<br>    <span class="hljs-attribute">ssl_session_timeout</span>  <span class="hljs-number">5m</span>;<br><br>    <span class="hljs-attribute">ssl_ciphers</span>  HIGH:!aNULL:!MD5;<br>    <span class="hljs-attribute">ssl_prefer_server_ciphers</span>  <span class="hljs-literal">on</span>;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">proxy_set_header</span>   X-Real-IP         <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">proxy_set_header</span>   Host              <span class="hljs-variable">$http_host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span>   X-Forwarded-For   <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        <span class="hljs-attribute">root</span>   /usr/share/nginx/html;<br>        <span class="hljs-attribute">index</span>  index.html index.htm;<br>    &#125;<br><br>    <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;<br>    <span class="hljs-section">location</span> = /50x.html &#123;<br>        <span class="hljs-attribute">root</span>   /usr/share/nginx/html;<br>    &#125;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">listen</span>  [::]:<span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span>  chatgpt.itedus.cn;<br><br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)</span> https://<span class="hljs-variable">$server_name</span><span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>;<br><br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">443</span> ssl;<br>    <span class="hljs-attribute">server_name</span>  chatgpt.itedus.cn;<br><br>    <span class="hljs-attribute">ssl_certificate</span>      /etc/nginx/ssl/9749920_chatgpt.itedus.cn.pem;<br>    <span class="hljs-attribute">ssl_certificate_key</span>  /etc/nginx/ssl/9749920_chatgpt.itedus.cn.key;<br><br>    <span class="hljs-attribute">ssl_session_cache</span>    shared:SSL:<span class="hljs-number">1m</span>;<br>    <span class="hljs-attribute">ssl_session_timeout</span>  <span class="hljs-number">5m</span>;<br><br>    <span class="hljs-attribute">ssl_ciphers</span>  HIGH:!aNULL:!MD5;<br>    <span class="hljs-attribute">ssl_prefer_server_ciphers</span>  <span class="hljs-literal">on</span>;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://180.76.119.100:3002;<br>        <span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br>        <span class="hljs-attribute">chunked_transfer_encoding</span> <span class="hljs-literal">off</span>;<br>        <span class="hljs-attribute">proxy_buffering</span> <span class="hljs-literal">off</span>;<br>        <span class="hljs-attribute">proxy_cache</span> <span class="hljs-literal">off</span>;<br>    &#125;<br><br>    <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;<br>    <span class="hljs-section">location</span> = /50x.html &#123;<br>        <span class="hljs-attribute">root</span>   /usr/share/nginx/html;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="é‡å¯æ“ä½œ"><a href="#é‡å¯æ“ä½œ" class="headerlink" title="é‡å¯æ“ä½œ"></a>é‡å¯æ“ä½œ</h4><p>ä¸€ç§æ–¹å¼æ˜¯é‡å¯ Nginx æœåŠ¡<code>nginx -s reload</code> (ä½†æ˜¯åœ¨ Docket ä¸­åº”è¯¥ä¸è¡Œ,éœ€è¦åˆ é™¤åé‡å¯)</p><p>åˆ é™¤ Nginx åè¿›è¡Œé‡æ–°å®‰è£…(å¤šäº†ä¸€ä¸ª 443 çš„æ˜ å°„ç«¯å£)</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">docker stop nginx<br><br>docker rm nginx<br></code></pre></td></tr></table></figure><p>æˆ–è€…åœ¨ Portainer ä¸­æ“ä½œ â†‘</p><p>å¯åŠ¨å‘½ä»¤</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs groovy">docker run \<br>-p <span class="hljs-number">443</span>:<span class="hljs-number">443</span> -p <span class="hljs-number">9002</span>:<span class="hljs-number">80</span> \<br>--name nginx \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/conf/</span>nginx.<span class="hljs-attr">conf:</span><span class="hljs-regexp">/etc/</span>nginx/nginx.conf \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/conf/</span>conf.<span class="hljs-attr">d:</span><span class="hljs-regexp">/etc/</span>nginx/conf.d \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/log:/</span><span class="hljs-keyword">var</span><span class="hljs-regexp">/log/</span>nginx \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/ssl:/</span>etc<span class="hljs-regexp">/nginx/</span>ssl \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/html:/</span>usr<span class="hljs-regexp">/share/</span>nginx/html \<br>-d <span class="hljs-attr">nginx:</span>latest<br></code></pre></td></tr></table></figure><p>ç”±äºå®é™…è®¿é—®çš„æ—¶å€™æ˜¾ç¤ºæ— æ³•è®¿é—®(éœ€è¦å·¥ä¿¡éƒ¨å¤‡æ¡ˆ); è¿™é‡Œæš‚æ—¶æ²¡çœ‹åˆ°æ‰€è°“çš„ https è¯ä¹¦å®‰å…¨è®¿é—®</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240128115823.png" alt="image.png"></p>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>web</tag>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubernetes</title>
    <link href="/2024/01/22/Kubernetes/"/>
    <url>/2024/01/22/Kubernetes/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¤ä¹ ä¸€ä¸‹ docker</p></blockquote><p>docker â†’  è¿›ç¨‹éš”ç¦» ï¼›æ“ä½œç³»ç»Ÿå±‚è™šæ‹ŸåŒ–ï¼ˆåŒä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸‹éš”ç¦»è½¯ä»¶ç¯å¢ƒï¼‰</p><p>é•œåƒ image â†’  å®¹å™¨ Container  â†’  ä»“åº“</p><p>æŸ¥çœ‹å®¹å™¨å ç”¨èµ„æºï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker status</span><br></code></pre></td></tr></table></figure><p>å¾®æœåŠ¡ï¼šè´Ÿè½½å‡è¡¡ï¼ˆå¤šèŠ‚ç‚¹ï¼Œå®ç°é«˜å¯ç”¨ï¼Œå¹³ç¨³è¿‡åº¦ï¼‰</p><p>å°†ä¸€ä¸ªæ•´ä½“çš„æœåŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå¾®æœåŠ¡</p><p>è€ƒè™‘çš„å†…å®¹ï¼šæ—¥å¿—æ”¶é›†ï¼ˆå¤šèŠ‚ç‚¹ï¼‰ï¼ŒæœåŠ¡ç›‘æ§ï¼Œèµ„æºæœåŠ¡å™¨åˆ†é…ï¼Œåˆ¤æ–­æœåŠ¡çš„å‰ç½®ä¾èµ–</p><p>ä¸Šé¢è¿™äº›è€ƒè™‘çš„å†…å®¹å¯ä»¥é€šè¿‡ K8s æ¥è¿›è¡Œå¤„ç†ã€‚</p><ul><li>K8s: å®¹å™¨ç¼–æ’ç³»ç»Ÿï¼Œç”¨äºç®¡ç†å’Œæ‰©å±•å¤§è§„æ¨¡çš„å®¹å™¨éƒ¨ç½²</li><li>Portainer: å®¹å™¨ç®¡ç†å·¥å…·ï¼Œæä¾›äº†ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„ç•Œé¢æ¥ç®¡ç† Docker å’Œ Kubernetes èµ„æºã€‚</li></ul><h3 id="1ã€K8s-æ˜¯ä»€ä¹ˆ"><a href="#1ã€K8s-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€K8s æ˜¯ä»€ä¹ˆ"></a>1ã€K8s æ˜¯ä»€ä¹ˆ</h3><p>Kubernetesï¼ˆä¹Ÿç§° k8s æˆ– â€œkubeâ€ï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¹³å°ï¼Œå¯ä»¥è‡ªåŠ¨åŒ–åœ¨éƒ¨ç½²ã€ç®¡ç†å’Œæ‰©å±•å®¹å™¨åŒ–åº”ç”¨è¿‡ç¨‹ä¸­æ¶‰åŠçš„è®¸å¤šæ‰‹åŠ¨æ“ä½œ</p><p>å‚è€ƒ</p><ul><li><a href="https://www.kubernetes.org.cn/k8s">https://www.kubernetes.org.cn/k8s</a></li><li><a href="https://kubernetes.io/zh-cn/docs/home/">https://kubernetes.io/zh-cn/docs/home/</a></li></ul><p>æ ¸å¿ƒç‰¹æ€§ï¼š</p><ul><li><strong>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</strong>ï¼šKuberneteså¯ä»¥è‡ªåŠ¨å‘ç°åº”ç”¨æœåŠ¡ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„æœåŠ¡åè¿›è¡Œè®¿é—®ï¼Œå¦‚æœæœåŠ¡çš„å®¹å™¨å‡ºç°æ•…éšœï¼Œå¯ä»¥è‡ªåŠ¨é‡æ–°è·¯ç”±åˆ°å…¶ä»–å¥åº·å®¹å™¨ã€‚</li><li><strong>å­˜å‚¨ç¼–æ’</strong>ï¼šè‡ªåŠ¨æŒ‚è½½æ‰€é€‰å­˜å‚¨ç³»ç»Ÿï¼Œæ— è®ºæ˜¯æœ¬åœ°å­˜å‚¨ã€å…¬å…±äº‘æä¾›å•†çš„å­˜å‚¨ï¼Œè¿˜æ˜¯ç½‘ç»œå­˜å‚¨ç³»ç»Ÿã€‚</li><li><strong>è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š</strong>ï¼šå¯ä»¥æè¿°åº”ç”¨çš„æœŸæœ›çŠ¶æ€ï¼ŒKuberneteså¯ä»¥è‡ªåŠ¨å°†å®é™…çŠ¶æ€æ”¹å˜ä¸ºæœŸæœ›çŠ¶æ€ã€‚å¦‚æœæœ‰ä»»ä½•å˜æ›´å¯¼è‡´é”™è¯¯ï¼ŒKuberneteså¯ä»¥å›æ»šåˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚</li><li><strong>è‡ªåŠ¨å®Œæˆå®¹å™¨ç¼–æ’</strong>ï¼šåŸºäºèµ„æºæ¶ˆè€—è‡ªåŠ¨æ”¾ç½®å®¹å™¨åˆ°èŠ‚ç‚¹ï¼Œè€ƒè™‘èµ„æºéœ€æ±‚å’Œçº¦æŸï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨é€‰æ‹©è¿è¡Œçš„èŠ‚ç‚¹ã€‚</li><li><strong>è‡ªæˆ‘ä¿®å¤</strong>ï¼šè‡ªåŠ¨é‡å¯å¤±è´¥çš„å®¹å™¨ï¼Œæ›¿æ¢å’Œæ€æ‰ä¸å“åº”ç”¨æˆ·å®šä¹‰çš„å¥åº·æ£€æŸ¥çš„å®¹å™¨ï¼Œç›´åˆ°åº”ç”¨æ­£å¸¸è¿è¡Œã€‚</li><li><strong>å¯†é’¥ä¸é…ç½®ç®¡ç†</strong>ï¼šéƒ¨ç½²å’Œæ›´æ–°å¯†é’¥å’Œåº”ç”¨é…ç½®ï¼Œä¸éœ€è¦æ”¹å˜å®¹å™¨é•œåƒï¼Œé¿å…å°†å¯†é’¥å­˜å‚¨åœ¨å®¹å™¨é•œåƒä¸­ã€‚</li></ul><h3 id="2ã€K8s-å¦‚ä½•ä½¿ç”¨"><a href="#2ã€K8s-å¦‚ä½•ä½¿ç”¨" class="headerlink" title="2ã€K8s å¦‚ä½•ä½¿ç”¨"></a>2ã€K8s å¦‚ä½•ä½¿ç”¨</h3><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240322095336.png" alt="image.png"></p><blockquote><p>æ§åˆ¶å¹³é¢ç»„ä»¶</p></blockquote><p>æ§åˆ¶å¹³é¢ï¼ˆMasterèŠ‚ç‚¹ï¼‰åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬è´Ÿè´£æ•´ä¸ªé›†ç¾¤çš„ç®¡ç†å’Œåè°ƒå·¥ä½œï¼š</p><ul><li><strong>API Server</strong>ï¼ˆkube-apiserverï¼‰ï¼šä½œä¸ºé›†ç¾¤çš„å‰ç«¯ï¼Œå®ƒæä¾›äº†Kubernetes APIæœåŠ¡ï¼Œæ˜¯ç”¨æˆ·ã€å¤–éƒ¨åº”ç”¨å’Œé›†ç¾¤å†…éƒ¨å„ç»„ä»¶äº¤äº’çš„æ¥å£ã€‚</li><li><strong>Scheduler</strong>ï¼ˆkube-schedulerï¼‰ï¼šè´Ÿè´£è°ƒåº¦å†³ç­–ï¼Œé€‰æ‹©å“ªä¸ªèŠ‚ç‚¹æ¥è¿è¡Œæœªè¿è¡Œçš„Podã€‚å®ƒæ ¹æ®èµ„æºéœ€æ±‚ã€ç¡¬ä»¶&#x2F;è½¯ä»¶&#x2F;ç­–ç•¥çº¦æŸã€äº²å’Œæ€§å’Œåäº²å’Œæ€§è§„èŒƒã€æ•°æ®å±€éƒ¨æ€§ã€å·¥ä½œè´Ÿè½½é—´å¹²æ‰°å’Œæˆªæ­¢æ—¥æœŸç­‰å¤šç§å› ç´ åšå‡ºå†³ç­–ã€‚</li><li><strong>Controller Manager</strong>ï¼ˆkube-controller-managerï¼‰ï¼šç®¡ç†æ§åˆ¶å™¨è¿›ç¨‹ï¼Œè¿™äº›æ§åˆ¶å™¨åŒ…æ‹¬èŠ‚ç‚¹æ§åˆ¶å™¨ã€å‰¯æœ¬æ§åˆ¶å™¨ã€ç«¯ç‚¹æ§åˆ¶å™¨ã€æœåŠ¡å¸å·å’Œä»¤ç‰Œæ§åˆ¶å™¨ç­‰ã€‚æ§åˆ¶å™¨é€šå¸¸è´Ÿè´£é›†ç¾¤çš„çŠ¶æ€ç®¡ç†ï¼Œç¡®ä¿åº”ç”¨çš„å½“å‰çŠ¶æ€ä¸ç”¨æˆ·å£°æ˜çš„æœŸæœ›çŠ¶æ€ä¸€è‡´ã€‚</li><li><strong>ETCD</strong>ï¼šæ˜¯ä¸€ä¸ªä¸€è‡´æ€§ã€é«˜å¯ç”¨çš„é”®å€¼å­˜å‚¨æ•°æ®åº“ï¼Œç”¨äºä¿å­˜æ‰€æœ‰é›†ç¾¤æ•°æ®ï¼Œæ˜¯æ•´ä¸ªé›†ç¾¤çš„â€œçœŸå®æ¥æºâ€ã€‚</li></ul><blockquote><p>èŠ‚ç‚¹ç»„ä»¶</p></blockquote><p>èŠ‚ç‚¹ï¼ˆNodeèŠ‚ç‚¹ï¼‰é€šå¸¸æ˜¯ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼Œè¿è¡Œç€å®¹å™¨åŒ–åº”ç”¨ï¼Œå®ƒåŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶ï¼š</p><ul><li><strong>Kubelet</strong>ï¼šè´Ÿè´£ç®¡ç†Podå’Œå®ƒä»¬çš„å®¹å™¨ã€é•œåƒã€å·ç­‰ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€åœæ­¢å®¹å™¨åº”ç”¨ï¼Œç»´æŠ¤å®¹å™¨çš„è¿è¡ŒçŠ¶æ€ç­‰ã€‚</li><li><strong>Kube Proxy</strong>ï¼ˆkube-proxyï¼‰ï¼šæ˜¯ç½‘ç»œä»£ç†ï¼Œè¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè´Ÿè´£æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œå®ƒå¤„ç†èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè·¯ç”±ï¼Œå¹¶å®æ–½éƒ¨åˆ†ç½‘ç»œç­–ç•¥ã€‚</li><li><strong>Container Runtime</strong>ï¼šè´Ÿè´£è¿è¡Œå®¹å™¨ï¼Œä¾‹å¦‚Dockerã€containerdç­‰ã€‚</li></ul><p> Pod</p><ul><li><strong>Pod</strong>ï¼šPodæ˜¯Kubernetesä¸­çš„åŸºæœ¬éƒ¨ç½²å•å…ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªæˆ–ä¸€ç»„å®¹å™¨çš„é›†åˆï¼Œå…±äº«å­˜å‚¨å’Œç½‘ç»œï¼Œè¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹ä¸Šã€‚</li></ul><blockquote><p>å·¥ä½œæµç¨‹</p></blockquote><p>å·¥ä½œæµç¨‹é€šå¸¸æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>ç”¨æˆ·æˆ–è‡ªåŠ¨åŒ–ç³»ç»Ÿä½¿ç”¨kubectlï¼ˆæˆ–å…¶ä»–å®¢æˆ·ç«¯ï¼‰å‘API Serverå‘é€æŒ‡ä»¤ã€‚</li><li>API Serverå°†é…ç½®ä¿¡æ¯å­˜å‚¨åœ¨ETCDä¸­ã€‚</li><li>Schedulerç›‘å¬API Serverï¼Œå¯»æ‰¾æ²¡æœ‰åˆ†é…èŠ‚ç‚¹çš„æ–°Podï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æ¥è¿è¡Œè¿™ä¸ªPodã€‚</li><li>ä¸€æ—¦Podè¢«æŒ‡æ´¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯¹åº”èŠ‚ç‚¹ä¸Šçš„Kubeletè´Ÿè´£åˆå§‹åŒ–å®¹å™¨ç¯å¢ƒï¼Œå¯åŠ¨å®¹å™¨ï¼Œå¹¶ä¿æŒå®¹å™¨çš„è¿è¡ŒçŠ¶æ€ã€‚</li><li>Kube Proxyè´Ÿè´£å¤„ç†è¯¥èŠ‚ç‚¹ä¸ŠPodçš„ç½‘ç»œé€šä¿¡ã€‚</li></ol><hr><p>K8s æ˜¯ä¸€ä¸ªå®¹å™¨ç¼–æ’è°ƒå·¥å…·ï¼Œèƒ½å¤Ÿè¿›è¡Œè‡ªåŠ¨èµ„æºè°ƒåº¦å’ŒæœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡</p><p>èµ„æºè°ƒåº¦</p><p>å®¹å™¨ç¼–æ’ç³»ç»Ÿèƒ½å¤Ÿæ ¹æ®å®¹å™¨çš„èµ„æºéœ€æ±‚ï¼ˆå¦‚CPUã€å†…å­˜ã€å­˜å‚¨ç­‰ï¼‰ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ä¸»æœºèŠ‚ç‚¹æ¥éƒ¨ç½²å®¹å™¨ã€‚è¿™é€šå¸¸æ¶‰åŠå¤æ‚çš„å†³ç­–è¿‡ç¨‹ï¼Œå¯èƒ½åŒ…æ‹¬ï¼š</p><ul><li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šåœ¨å¤šä¸ªä¸»æœºé—´åˆ†é…å®¹å™¨ï¼Œä»¥ä¿æŒè´Ÿè½½å‡è¡¡ã€‚</li><li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šç¡®ä¿åº”ç”¨ç»„ä»¶è·¨å¤šä¸ªæ•…éšœåŸŸéƒ¨ç½²ï¼Œä»¥æé«˜å®¹é”™èƒ½åŠ›ã€‚</li><li><strong>èµ„æºé™åˆ¶</strong>ï¼šä¸ºæ¯ä¸ªå®¹å™¨è®¾ç½®èµ„æºé™åˆ¶ï¼Œé¿å…å•ä¸ªå®¹å™¨è€—å°½æ‰€æœ‰ä¸»æœºèµ„æºã€‚</li></ul><p>æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡</p><p>å®¹å™¨å¯åŠ¨å’Œåœæ­¢æ—¶ï¼Œå®ƒä»¬çš„IPåœ°å€å’Œç«¯å£æ˜¯åŠ¨æ€åˆ†é…çš„ã€‚å®¹å™¨ç¼–æ’ç³»ç»Ÿéœ€è¦æä¾›æœåŠ¡å‘ç°æœºåˆ¶ï¼Œä»¥ä¾¿å®¹å™¨å’ŒæœåŠ¡å¯ä»¥äº’ç›¸å‘ç°å’Œé€šä¿¡ã€‚åŒæ—¶ï¼Œå®ƒå¯ä»¥å®ç°å†…éƒ¨è´Ÿè½½å‡è¡¡ï¼Œå°†æµé‡åˆ†å‘åˆ°å¤šä¸ªå®¹å™¨å®ä¾‹</p><hr><h3 id="3ã€ç°åº¦å‘å¸ƒ"><a href="#3ã€ç°åº¦å‘å¸ƒ" class="headerlink" title="3ã€ç°åº¦å‘å¸ƒ"></a>3ã€ç°åº¦å‘å¸ƒ</h3><p>ç°åº¦å‘å¸ƒï¼ˆä¹Ÿç§°ä¸ºé‡‘ä¸é›€å‘å¸ƒæˆ–æ¸è¿›å¼å‘å¸ƒï¼‰æ˜¯è½¯ä»¶å‘å¸ƒçš„ä¸€ç§ç­–ç•¥ï¼Œå…¶ä¸­æ–°ç‰ˆæœ¬çš„è½¯ä»¶é€æ­¥æ›¿æ¢æ—§ç‰ˆæœ¬ï¼Œè¿™æ ·æ–°çš„å˜æ›´åªå½±å“ä¸€éƒ¨åˆ†ç”¨æˆ·ã€‚è¿™ä¸ªè¿‡ç¨‹å…è®¸å¼€å‘å’Œè¿ç»´å›¢é˜Ÿç›‘æ§æ–°ç‰ˆæœ¬çš„è¡¨ç°ï¼Œè€Œä¸ä¼šå½±å“æ‰€æœ‰ç”¨æˆ·ã€‚</p><p>ç°åº¦å‘å¸ƒçš„å…³é”®ç›®çš„æ˜¯å‡å°‘ç”±äºæ–°ç‰ˆæœ¬å¼•å…¥çš„é£é™©ã€‚é€šè¿‡å…ˆå¯¹ä¸€å°éƒ¨åˆ†ç”¨æˆ·è¿›è¡Œå‘å¸ƒï¼Œå¯ä»¥åœ¨ä¸å¹²æ‰°æ‰€æœ‰ç”¨æˆ·çš„æƒ…å†µä¸‹æµ‹è¯•æ–°ç‰ˆæœ¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„è¡¨ç°ã€‚</p><p>è¿™ä¸ªç°åº¦å‘å¸ƒå¯ä»¥é€šè¿‡ k8s çš„éƒ¨ç½²ç­–ç•¥å»åšåˆ°</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240322102017.png" alt="image.png"></p><blockquote><p>æ¨èå‚è€ƒ</p></blockquote><p><a href="https://www.kancloud.cn/zatko/kubernetes_k8s/2290695">https://www.kancloud.cn/zatko/kubernetes_k8s/2290695</a></p><h3 id="éƒ¨ç½²ä½¿ç”¨-ğŸš©"><a href="#éƒ¨ç½²ä½¿ç”¨-ğŸš©" class="headerlink" title="éƒ¨ç½²ä½¿ç”¨  ğŸš©"></a>éƒ¨ç½²ä½¿ç”¨  ğŸš©</h3><h4 id="ç½‘ç»œè¿é€š"><a href="#ç½‘ç»œè¿é€š" class="headerlink" title="ç½‘ç»œè¿é€š"></a>ç½‘ç»œè¿é€š</h4><p>è¿™é‡Œä½¿ç”¨ä¸€ä¸‹è™šæ‹Ÿæœºå®Œæˆä»¥ä¸‹ç›¸å…³åŠŸèƒ½</p><p>è™šæ‹Ÿæœº å¼€ä¸‰ä¸ªæœºå™¨ï¼ŒmasterÂ åŒæ ¸4G,ä¸¤ä¸ªnodeåŒæ ¸8G</p><p>è¿™é‡Œä½¿ç”¨çš„è™šæ‹Ÿæœºæ˜¯ Virtual Box</p><p>å»ºè®®è®¾ç½®ä»¥ä¸‹   çƒ­é”®  â†’  è™šæ‹Ÿç”µè„‘  â†’  ä¸»æœºç»„åˆé”®  â†’ è®¾ç½®ä¸º  Ctrl + Alt</p><p>å¯†ç è®¾ç½® root&#x2F;root</p><p>åˆ›å»ºç”¨æˆ· luoqi&#x2F;123456 ğŸ•·</p><p>éœ€è¦åé¢çœ‹ä¸€ä¸‹ï¼Œç›®å‰æ˜¯è™šæ‹Ÿæœºä¸èƒ½è·å–åˆ° ip åœ°å€ï¼Œä¸”æ‰§è¡Œ sudo å‘½ä»¤ä¸èµ·æ•ˆæœ</p><p>ä¸ç”¨ç®¡ä¹‹å‰çš„æ“ä½œæ–¹å¼ï¼Œé€‰æ‹©æ–°å¢è™šæ‹Ÿæœºçš„æ“ä½œï¼Œç„¶ååœ¨ç½‘ç»œä¸ä¸»æœºååˆå§‹é…ç½®è¿™é‡Œé€‰æ‹©æ‰“å¼€</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240411153119.png" alt="image.png"></p><p>æ­£å¸¸æ¥è¯´ï¼ŒæŒ‰ç…§è¿™ç§åˆå§‹åŒ–é…ç½®æ˜¯å¯ä»¥è¿›è¡Œåœ¨è™šæ‹Ÿæœºä¸­ Ping é€šå¤–ç½‘çš„</p><p>è¿›è¡Œç½‘ç»œé…ç½®ï¼šé€‰æ‹©ç½‘å¡2ï¼Œè¿›è¡Œé€‰æ‹©â€œä»…ä¸»æœº(Host-Only) ç½‘ç»œâ€</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240411153802.png" alt="image.png"></p><p>å†æ¬¡å¯åŠ¨è™šæ‹Ÿæœºåï¼Œè¿›å…¥åˆ° ç»ˆç«¯ï¼Œè¾“å…¥ <code>ip addr</code></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240411155412.png" alt="image.png"></p><p>ç„¶åå°±å¯ä»¥ä½¿ç”¨ shell å·¥å…·è¿›è¡Œè¿æ¥æ“ä½œã€‚</p><p>æŒ‰ç…§åŒæ ·çš„æ–¹å¼åˆ›å»ºä¸¤ä¸ªä»èŠ‚ç‚¹ğŸ‘‡</p><p>å¤åˆ¶æ“ä½œï¼ˆé€‰æ‹©å¤åˆ¶ä¸€ä¸‹ä¸»èŠ‚ç‚¹ï¼‰ï¼Œå¤åˆ¶ä¸»èŠ‚ç‚¹è™šæ‹Ÿæœºåˆ°ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚</p><h4 id="éƒ¨ç½²æ“ä½œ"><a href="#éƒ¨ç½²æ“ä½œ" class="headerlink" title="éƒ¨ç½²æ“ä½œ"></a>éƒ¨ç½²æ“ä½œ</h4><p>è¿™é‡Œé€‰ç”¨äº† kubeadm å·¥å…·å»è¿›è¡Œé›†ç¾¤ç¯å¢ƒä¸‹çš„éƒ¨ç½²ã€‚</p><p>éƒ¨ç½² Kubernetes é›†ç¾¤é€šå¸¸åŒ…æ‹¬è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª master èŠ‚ç‚¹å’Œå¤šä¸ª worker èŠ‚ç‚¹ã€‚</p><blockquote><p>ç³»ç»Ÿè¦æ±‚</p></blockquote><ul><li>ä¸€å®šæ•°é‡çš„æœºå™¨ï¼ˆç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼‰ï¼Œè‡³å°‘ 2GB RAMï¼Œ2 CPUsã€‚</li><li>ç³»ç»Ÿæ”¯æŒçš„æ“ä½œç³»ç»Ÿï¼ˆå¦‚ Ubuntu, CentOSï¼‰ã€‚</li><li>ç¦ç”¨ Swapã€‚</li><li>é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¹‹é—´ç½‘ç»œäº’é€š</li><li>å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦æ‹‰å–é•œåƒ</li></ul><p>å¤§æ¦‚çš„ä¸€äº›æ­¥éª¤</p><ul><li>1ã€ç¯å¢ƒå‡†å¤‡</li><li>2ã€å®‰è£… kubeadm, kubelet å’Œ kubectl ï¼ˆå·¥å…·å®‰è£…ï¼‰</li><li>3ã€åˆå§‹åŒ–é›†ç¾¤</li><li>4ã€è®¾ç½® kubectlï¼Œé…ç½®å½“å‰ç”¨æˆ·ä½¿ç”¨ kubectl è¿æ¥åˆ° Kubernetes é›†ç¾¤</li><li>5ã€é€‰æ‹©å¹¶éƒ¨ç½²ä¸€ä¸ª Pod ç½‘ç»œåˆ°é›†ç¾¤ä¸­ï¼ŒåŠ å…¥å·¥ä½œèŠ‚ç‚¹ï¼Œè¿›è¡ŒéªŒè¯æ“ä½œã€‚</li></ul><hr><p>å‚è€ƒè¿™å¥—ï¼š <a href="https://cloud.tencent.com/developer/article/1674040">https://cloud.tencent.com/developer/article/1674040</a></p><p>è§†é¢‘å‚è€ƒï¼š <a href="https://www.bilibili.com/video/BV1LC4y1g7wz">https://www.bilibili.com/video/BV1LC4y1g7wz</a></p><h5 id="å‡†å¤‡ç¯å¢ƒ"><a href="#å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="å‡†å¤‡ç¯å¢ƒ"></a>å‡†å¤‡ç¯å¢ƒ</h5><p>ã€ç¯å¢ƒè§’è‰²ã€‘</p><p>masterï¼š192.168.56.101</p><p>node1ï¼š192.168.56.102</p><p>node2ï¼š192.168.56.103</p><p>ä¸‰ä¸ªèŠ‚ç‚¹éƒ½é€‰æ‹©æ— ç•Œé¢å¯åŠ¨ï¼ˆè™šæ‹Ÿæœºï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell">å…³é—­é˜²ç«å¢™ï¼š<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">systemctl stop firewalld</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">systemctl <span class="hljs-built_in">disable</span> firewalld</span><br><br>å…³é—­selinuxï¼š<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sed -i <span class="hljs-string">&#x27;s/enforcing/disabled/&#x27;</span> /etc/selinux/config  <span class="hljs-comment"># æ°¸ä¹…</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿™é‡Œè®¾ç½®æ°¸ä¹…çš„è¯ï¼Œæ˜¯éœ€è¦é‡å¯åæ‰èƒ½å¤±æ•ˆï¼Œè®¾ç½®ä¸´æ—¶æ˜¯ä¸ºäº†ä¿è¯è¿™ä¸€æ¬¡ä¸é‡å¯ä¹Ÿå…ˆä¸´æ—¶å…³é—­ä¸‹ selinux</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">setenforce 0  <span class="hljs-comment"># ä¸´æ—¶</span></span><br><br>å…³é—­swapï¼š<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">swapoff -a  <span class="hljs-comment"># ä¸´æ—¶</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">vim /etc/fstab  <span class="hljs-comment"># æ°¸ä¹…</span></span><br><br>è®¾ç½®ä¸»æœºåï¼š<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">hostnamectl set-hostname &lt;hostname&gt;</span><br><br>åœ¨masteræ·»åŠ hostsï¼š<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å»ºè®®åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ“ä½œ</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="hljs-string">EOF</span></span><br>192.168.56.101 k8s-master<br>192.168.56.102 k8s-node1<br>192.168.56.103 k8s-node2<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-string">æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿›è¡Œæ“ä½œï¼Œåˆ›å»ºæˆ–è¦†ç›–ä¸€ä¸ªåä¸º `k8s.conf` çš„æ–‡ä»¶åœ¨ `/etc/sysctl.d/` ç›®å½•ä¸‹</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-string">ç¡®ä¿ç»è¿‡ Linux ç½‘æ¡¥çš„ IPv4 å’Œ IPv6 æµé‡éƒ½è¢«ä¼ é€’åˆ° `iptables`ï¼ˆå’Œ `ip6tables`ï¼‰çš„é“¾ä¸­è¿›è¡Œå¤„ç†</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-string">å°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾ï¼š</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-string">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span></span><br>net.bridge.bridge-nf-call-ip6tables = 1<br>net.bridge.bridge-nf-call-iptables = 1<br>EOF<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sysctl --system  <span class="hljs-comment"># ç”Ÿæ•ˆ</span></span><br><br>æ—¶é—´åŒæ­¥ï¼š<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">yum install ntpdate -y</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">ntpdate time.windows.com</span><br></code></pre></td></tr></table></figure><p>æ“ä½œè¯´æ˜</p><ul><li>å…³é—­é˜²ç«å¢™ï¼šKubernetes éœ€è¦åœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œé˜²ç«å¢™å¯èƒ½ä¼šé˜»æ­¢æˆ–é™åˆ¶è¿™äº›é€šä¿¡ã€‚å…³é—­é˜²ç«å¢™å¯ä»¥ç®€åŒ–ç½‘ç»œé…ç½®å’Œæ•…éšœæ’é™¤è¿‡ç¨‹ï¼Œé¿å…é€šä¿¡è¢«ä¸å¿…è¦åœ°é˜»æ–­ã€‚</li><li>å…³é—­ SELinuxï¼šSELinuxï¼ˆSecurity-Enhanced Linuxï¼‰å¯ä»¥å¢å¼ºç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Œä½†å®ƒä¹Ÿå¯èƒ½ä¸ Kubernetes çš„ä¸€äº›ç»„ä»¶ä¸å…¼å®¹ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°æ–‡ä»¶ç³»ç»Ÿæƒé™å’Œç½‘ç»œè®¿é—®ã€‚ç¦ç”¨ SELinux å¯ä»¥å‡å°‘æƒé™é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨ Pod ä¹‹é—´å…±äº«æ•°æ®æ—¶ã€‚</li><li>å…³é—­swapï¼šKubernetes å®˜æ–¹æ¨èåœ¨è¿è¡Œ kubelet çš„æœºå™¨ä¸Šç¦ç”¨ swap ç©ºé—´ã€‚è¿™æ˜¯å› ä¸º Kubernetes çš„è°ƒåº¦å™¨å°†è€ƒè™‘èŠ‚ç‚¹çš„å†…å­˜ä½¿ç”¨æƒ…å†µæ¥å®‰æ’ Podï¼Œå¯ç”¨ swap ç©ºé—´ä¼šä½¿å†…å­˜ç®¡ç†å˜å¾—å¤æ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´è°ƒåº¦å’Œèµ„æºé™åˆ¶çš„é—®é¢˜ã€‚</li><li>è®¾ç½®ä¸»æœºåï¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ä¸»æœºåæœ‰åŠ©äºèŠ‚ç‚¹é—´çš„è¯†åˆ«å’Œç®¡ç†ã€‚åœ¨ç®¡ç†å’Œç»´æŠ¤é›†ç¾¤æ—¶ï¼Œèƒ½å¤Ÿé€šè¿‡ä¸»æœºåå¿«é€Ÿè¯†åˆ«å…·ä½“èŠ‚ç‚¹ã€‚</li><li>åœ¨ master æ·»åŠ  hostsï¼šè¿™ä¸ªæ“ä½œæ˜¯ä¸ºäº†ç®€åŒ–èŠ‚ç‚¹é—´çš„ç½‘ç»œé€šä¿¡ï¼Œå°¤å…¶æ˜¯åœ¨ DNS æœåŠ¡ä¸ç¨³å®šæˆ–ä¸å¯ç”¨çš„æƒ…å†µä¸‹ã€‚é€šè¿‡åœ¨ <code>/etc/hosts</code> æ–‡ä»¶ä¸­é™æ€å®šä¹‰ IP åœ°å€å’Œä¸»æœºåçš„æ˜ å°„ï¼Œå¯ä»¥ä¿è¯å³ä½¿åœ¨ DNS è§£æé—®é¢˜å‘ç”Ÿæ—¶ï¼ŒèŠ‚ç‚¹é—´çš„é€šä¿¡ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚</li><li>å°†æ¡¥æ¥çš„ IPv4 æµé‡ä¼ é€’åˆ° iptables çš„é“¾ï¼šè¿™äº›è®¾ç½®ç¡®ä¿æ‰€æœ‰ä» Linux bridges ä¼ é€’çš„æµé‡éƒ½ä¼šè¢« iptables çš„è§„åˆ™æ‰€å¤„ç†ã€‚è¿™å¯¹äºç½‘ç»œæ’ä»¶ï¼ˆå¦‚ Calico æˆ– Flannelï¼‰æ¥ç¡®ä¿ Pod ç½‘ç»œçš„æ­£å¸¸å·¥ä½œè‡³å…³é‡è¦ã€‚</li><li>æ—¶é—´åŒæ­¥ï¼šæ‰€æœ‰èŠ‚ç‚¹çš„æ—¶é—´åŒæ­¥æ˜¯éå¸¸é‡è¦çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ—¶é—´åå·®å¯èƒ½å¯¼è‡´æ—¥å¿—ã€äº‹ä»¶å¤„ç†å’Œå…¶ä»–æ—¶é—´æ•æ„Ÿçš„æ“ä½œå‡ºç°é—®é¢˜ã€‚ä½¿ç”¨ <code>ntpdate</code> ç¡®ä¿èŠ‚ç‚¹æ—¶é—´çš„ä¸€è‡´æ€§ï¼Œæœ‰åŠ©äºç»´æŠ¤é›†ç¾¤çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</li></ul><hr><p>ä½¿ç”¨ <code>vim</code> æ‰“å¼€ <code>/etc/fstab</code> æ–‡ä»¶åï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å†…å®¹</p><p>åœ¨å¯¹åº”çš„ å«æœ‰ swap çš„è¡Œï¼Œæ·»åŠ  # è¿›è¡Œæ³¨é‡Šï¼Œä¿å­˜é€€å‡º</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414140244.png" alt="image.png"></p><p>è®¾ç½®ä¸»æœºå</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">k8s-master</span><br><br><span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">k8s-node1</span><br><br><span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">k8s-node2</span><br></code></pre></td></tr></table></figure><h5 id="å·¥å…·å®‰è£…"><a href="#å·¥å…·å®‰è£…" class="headerlink" title="å·¥å…·å®‰è£…"></a>å·¥å…·å®‰è£…</h5><p>å®‰è£… docker</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">$ wget https://mirrors.aliyun.<span class="hljs-keyword">com</span>/docker-<span class="hljs-keyword">ce</span>/linux/centos/docker-<span class="hljs-keyword">ce</span>.repo -O /etc/yum.repos.d/docker-<span class="hljs-keyword">ce</span>.repo<br>$ yum -<span class="hljs-keyword">y</span> install docker-<span class="hljs-keyword">ce</span>-<span class="hljs-number">18.06</span>.<span class="hljs-number">1</span>.<span class="hljs-keyword">ce</span>-<span class="hljs-number">3</span>.el7<br>$ systemctl enable docker &amp;&amp; systemctl start docker<br>$ docker --<span class="hljs-keyword">version</span><br>Docker <span class="hljs-keyword">version</span> <span class="hljs-number">18.06</span>.<span class="hljs-number">1</span>-<span class="hljs-keyword">ce</span>, build e68fc7a<br></code></pre></td></tr></table></figure><p>é…ç½®é•œåƒä»“åº“åœ°å€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;registry-mirrors&quot;: [&quot;https://7iwp6tq0.mirror.aliyuncs.com&quot;]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ  k8s YUM æº</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ cat &gt; <span class="hljs-regexp">/etc/yum</span>.repos.d/kubernetes.repo &lt;&lt; EOF<br>[kubernetes]<br>name=Kubernetes<br>baseurl=https:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/kubernetes/yum</span><span class="hljs-regexp">/repos/</span>kubernetes-el7-x86_64<br>enabled=<span class="hljs-number">1</span><br>gpgcheck=<span class="hljs-number">0</span><br>repo_gpgcheck=<span class="hljs-number">0</span><br>gpgkey=https:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/kubernetes/yum</span><span class="hljs-regexp">/doc/yum</span>-key.gpg https:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/kubernetes/yum</span><span class="hljs-regexp">/doc/</span>rpm-package-key.gpg<br>EOF<br></code></pre></td></tr></table></figure><p>å®‰è£…kubeadmï¼Œkubeletå’Œkubectl</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">yum</span> install -y kubelet-<span class="hljs-number">1</span>.<span class="hljs-number">18</span>.<span class="hljs-number">0</span> kubeadm-<span class="hljs-number">1</span>.<span class="hljs-number">18</span>.<span class="hljs-number">0</span> kubectl-<span class="hljs-number">1</span>.<span class="hljs-number">18</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">systemctl</span> enable kubelet<br></code></pre></td></tr></table></figure><p>TIPSï¼šK8Sé›†ç¾¤è¿˜æœªæ‹‰èµ·ï¼Œæ•…è¿™é‡Œçš„kubeletæ˜¯æ— æ³•å¯åŠ¨çš„ï¼Œç­‰masteråˆå§‹åŒ–æ—¶ä¼šè‡ªåŠ¨æ‹‰èµ·</p><h5 id="éƒ¨ç½²-K8S-master"><a href="#éƒ¨ç½²-K8S-master" class="headerlink" title="éƒ¨ç½² K8S master"></a>éƒ¨ç½² K8S master</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubeadm init \<br>  <span class="hljs-attribute">--apiserver-advertise-address</span>=192.168.56.101 \<br>  --image-repository registry.aliyuncs.com/google_containers \<br>  --kubernetes-version v1.18.0 \<br>  <span class="hljs-attribute">--service-cidr</span>=10.92.0.0/12 \<br>  <span class="hljs-attribute">--pod-network-cidr</span>=10.220.0.0/16 \<br>  <span class="hljs-attribute">--ignore-preflight-errors</span>=all<br></code></pre></td></tr></table></figure><ul><li>apiserver-advertise-address æ˜¯ä¸»èŠ‚ç‚¹ IP  åœ°å€</li><li><code>service-cidr</code> ï¼šç”¨äº Kubernetes æœåŠ¡çš„è™šæ‹Ÿ IP åœ°å€ï¼ˆClusterIPï¼‰ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªæœåŠ¡æ—¶ï¼ŒKubernetes ä¼šè‡ªåŠ¨ä»è¿™ä¸ªèŒƒå›´åˆ†é…ä¸€ä¸ª IP åœ°å€ç»™æœ</li><li><code>pod-network-cidr</code>ï¼šè¿™ä¸ª CIDR èŒƒå›´ç”¨äºåˆ†é…ç»™é›†ç¾¤ä¸­çš„ Pods çš„ IP åœ°å€ã€‚æ¯ä¸ª Pod éƒ½ä¼šä»è¿™ä¸ªèŒƒå›´å†…è·å–ä¸€ä¸ª IP åœ°å€ã€‚</li></ul><p>åé¢ä¸¤ä¸ªåœ°å€ï¼šè¿™é‡Œç›®å‰ä½¿ç”¨çš„æ˜¯æ–‡æ¡£ç»™å®šçš„ä¸¤ä¸ªåœ°å€ï¼Œå…·ä½“å¦‚ä½•é…ç½®çš„ï¼Œåé¢æœ‰ç©ºå†çœ‹ä¸€ä¸‹</p><hr><p>éƒ¨ç½²å®Œæˆåä¼šè·å–åˆ° nodeåŠ å…¥é›†ç¾¤çš„å‘½ä»¤ä»¥åŠtoken</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414143912.png" alt="image.png"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm">kubeadm join <span class="hljs-number">192.168</span>.<span class="hljs-number">56.101</span>:<span class="hljs-number">6443</span> --token gdhwj<span class="hljs-number">6</span>.hmqvv<span class="hljs-number">0</span>wodnh<span class="hljs-number">6</span>suwd \<br>    --discovery-token-ca-cert-hash sha<span class="hljs-number">256</span>:<span class="hljs-number">3e37</span>e<span class="hljs-number">9</span><span class="hljs-keyword">c</span><span class="hljs-number">89</span>dbe<span class="hljs-number">37</span>bd<span class="hljs-number">0</span>d<span class="hljs-number">3</span>d<span class="hljs-number">639</span>f<span class="hljs-number">8002545</span>ebca<span class="hljs-number">2</span><span class="hljs-keyword">c</span><span class="hljs-number">083</span>a<span class="hljs-number">8</span>d<span class="hljs-number">9097</span><span class="hljs-keyword">c</span><span class="hljs-number">1725</span>f<span class="hljs-number">1</span>d<span class="hljs-number">7</span>af<span class="hljs-number">6</span>a<span class="hljs-number">1</span>ede<br></code></pre></td></tr></table></figure><hr><p>ä½¿ç”¨kubectlå‘½ä»¤ã€å¦‚éœ€nodeèŠ‚ç‚¹ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œå¯ä½¿ç”¨scpå‘½ä»¤åˆ†åˆ«æ‹·è´configæ–‡ä»¶è‡³å¯¹åº”ç›®å½•ã€‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#åˆ›å»ºä¸€ä¸ªåä¸º `.kube` çš„ç›®å½•ã€‚è¯¥ç›®å½•ç”¨äºå­˜æ”¾ `kubectl` çš„é…ç½®æ–‡ä»¶</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$HOME</span>/.kube<br><br><span class="hljs-comment">#å°† Kubernetes é›†ç¾¤çš„ç®¡ç†å‘˜é…ç½®æ–‡ä»¶ `admin.conf` å¤åˆ¶åˆ° `.kube` ç›®å½•ï¼Œå¹¶é‡å‘½åä¸º `config`ã€‚è¿™ä¸ªé…ç½®æ–‡ä»¶åŒ…å«äº†é›†ç¾¤çš„è¿æ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬ API æœåŠ¡å™¨çš„åœ°å€ã€è®¤è¯ä¿¡æ¯ç­‰</span><br>sudo <span class="hljs-built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="hljs-variable">$HOME</span>/.kube/config<br><br><span class="hljs-comment">#æˆæƒ</span><br>sudo <span class="hljs-built_in">chown</span> $(<span class="hljs-built_in">id</span> -u):$(<span class="hljs-built_in">id</span> -g) <span class="hljs-variable">$HOME</span>/.kube/config<br><br><span class="hljs-comment">#åˆ—å‡º Kubernetes é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹</span><br>$ kubectl get nodes<br></code></pre></td></tr></table></figure><h5 id="åŠ å…¥-K8S-node"><a href="#åŠ å…¥-K8S-node" class="headerlink" title="åŠ å…¥ K8S node"></a>åŠ å…¥ K8S node</h5><p>åœ¨nodeèŠ‚ç‚¹ä¸­åˆ†åˆ«æ‰§è¡Œï¼Œmaster initåäº§ç”Ÿçš„åŠ å…¥å‘½ä»¤ï¼š</p><p>TIPSï¼šè¿™é‡ŒåŠ å…¥nodeåä¼šçœ‹åˆ°nodeçŠ¶æ€ä¸ºNotReadyï¼Œæ˜¯å› ä¸ºæ²¡æœ‰å®‰è£…CNIï¼Œkubeletæ— æ³•é€šè¿‡ç½‘ç»œç»™apiserverä¸ŠæŠ¥nodeçŠ¶æ€ï¼Œå®‰è£…CNIåå³å¯æ¢å¤</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414144528.png" alt="image.png"></p><h5 id="éƒ¨ç½²ç½‘ç»œæ’ä»¶ã€CNIã€‘"><a href="#éƒ¨ç½²ç½‘ç»œæ’ä»¶ã€CNIã€‘" class="headerlink" title="éƒ¨ç½²ç½‘ç»œæ’ä»¶ã€CNIã€‘"></a>éƒ¨ç½²ç½‘ç»œæ’ä»¶ã€CNIã€‘</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//</span>docs.projectcalico.org<span class="hljs-regexp">/manifests/</span>calico.yaml<br></code></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæˆåï¼Œä¿®æ”¹calico.yamlã€å®šä¹‰Podç½‘ç»œï¼ˆCALICO_IPV4POOL_CIDRï¼‰ï¼Œä¸å‰é¢pod CIDRé…ç½®ä¸€æ ·å³å¯ã€‘</p><p><strong>è¿™é‡Œçš„æ“ä½œæ˜¯åœ¨ä¸»èŠ‚ç‚¹ä¸‹æ“ä½œ</strong>ï¼Œä¸‹è½½å®Œåï¼Œç›´æ¥åœ¨å½“å‰ç›®å½•è¿›è¡Œç¼–è¾‘å³å¯ï¼Œ</p><p>éœ€è¦è¿›è¡Œæ”¾å¼€æ³¨é‡Šï¼Œå¹¶ç¼–è¾‘å€¼</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414145415.png" alt="image.png"></p><p>åº”ç”¨è¯¥é…ç½®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># kubectl apply -f calico.yaml</span><br><span class="hljs-comment"># kubectl get pods -n kube-system</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œ <code>kubectl apply -f calico.yaml</code>  ä¼šæŠ¥é”™ï¼š</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">error: </span>unable to recognize &quot;calico.yaml&quot;: no matches for kind &quot;PodDisruptionBudget&quot; in version &quot;policy/v1&quot;<br></code></pre></td></tr></table></figure><p>çœ‹äº†ä¸€ä¸‹å¤§å®¶çš„é—®é¢˜ï¼Œæ˜¯å› ä¸ºç‰ˆæœ¬é—®é¢˜å¯¼è‡´ï¼ˆè¿™ç¯‡æ–‡ç« çš„æ—¶é—´æ˜¯ 2020 å¹´ï¼‰</p><p>çœ‹ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬å¯¹åº”ï¼š <a href="https://blog.csdn.net/qq_32596527/article/details/127692734">https://blog.csdn.net/qq_32596527/article/details/127692734</a></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414150322.png" alt="image.png"></p><p>è¿™é‡Œçš„ k8s ç‰ˆæœ¬æ˜¯ 1.18ï¼Œå¯¹åº”çš„ calico ç‰ˆæœ¬ä¸º  3.18</p><p>è§£å†³æ–¹æ¡ˆï¼š <a href="https://blog.csdn.net/qq_46237746/article/details/125453966">https://blog.csdn.net/qq_46237746/article/details/125453966</a></p><p>é‡æ–°ä¸‹è½½æ–‡ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//</span>docs.projectcalico.org<span class="hljs-regexp">/v3.18/m</span>anifests/calico.yaml<br></code></pre></td></tr></table></figure><p>é‡æ–°æ‰§è¡Œ</p><p>åº”ç”¨è¯¥é…ç½®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># kubectl apply -f calico.yaml</span><br><span class="hljs-comment"># kubectl get pods -n kube-system</span><br></code></pre></td></tr></table></figure><p>åº”ç”¨åå¯ä»¥çœ‹åˆ°CNI PODæ­£åœ¨åˆå§‹åŒ–ä¸­ï¼Œé™å¾…æ‹‰èµ·~</p><p>calico running çŠ¶æ€åï¼ŒæŸ¥çœ‹èŠ‚ç‚¹å·²å…¨éƒ¨ Readyã€éœ€è¦ç‚¹æ—¶é—´ã€‘</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414152107.png" alt="image.png"></p><p>åˆ°æ­¤éƒ¨ç½²æˆåŠŸã€‚</p><h3 id="ä½¿ç”¨-Kubernetes-éƒ¨ç½²-MySQL-æœåŠ¡"><a href="#ä½¿ç”¨-Kubernetes-éƒ¨ç½²-MySQL-æœåŠ¡" class="headerlink" title="ä½¿ç”¨ Kubernetes éƒ¨ç½² MySQL æœåŠ¡"></a>ä½¿ç”¨ Kubernetes éƒ¨ç½² MySQL æœåŠ¡</h3><p>é€šè¿‡ç¬¬äºŒèŠ‚çš„å†…å®¹ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œk8s ä¸»è¦è¿˜æ˜¯é€šè¿‡ yaml æ–‡ä»¶ï¼Œé€šè¿‡å·¥å…·å»è¿›è¡Œæ‰§è¡Œç›¸å…³æŒ‡ä»¤ï¼Œå¹¶è¿›è¡Œè¿è¡Œéƒ¨ç½²å®¹å™¨ï¼›</p><p>å…¶ä¸­ k8s ä¸»è¦å¯ä»¥åšä¸€äº›æ¯”è¾ƒé«˜çº§çš„å·¥ä½œï¼Œä½†æ€»ä½“æ¥è¯´ï¼Œå¯¹äºä½¿ç”¨è€…æ¥è¯´ï¼Œæˆ‘ä»¬åšçš„å·¥ä½œå°±æ˜¯ï¼š1ã€éƒ¨ç½² k8s ï¼›2ã€ç¼–å†™ yaml æ–‡ä»¶ï¼Œå°†æœåŠ¡æ”¾åˆ° k8s ä¸­è¿›è¡Œå®¹å™¨ç¼–æ’æœåŠ¡ç®¡ç†</p><p>æˆ‘ä»¬æ‰€è¦å…³å¿ƒçš„ï¼Œç¬¬ä¸€ç‚¹ä¸æ˜¯è´Ÿè´£ç®¡ç†å’Œå¦‚ä½•é«˜æ•ˆå¤„ç†è¿™ä¸ªç³»ç»Ÿçš„å·¥å…·æˆ–è€…æ¥å£ï¼Œè€Œæ˜¯ä» POD å¼€å§‹ã€‚</p><p><strong>Pod</strong>ï¼šPodæ˜¯Kubernetesä¸­çš„åŸºæœ¬éƒ¨ç½²å•å…ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªæˆ–ä¸€ç»„å®¹å™¨çš„é›†åˆï¼Œå…±äº«å­˜å‚¨å’Œç½‘ç»œï¼Œè¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹ä¸Šã€‚</p><blockquote><p>Docker Compose å’Œ Kubernates çš„ç®€æ˜“åŒºåˆ«ï¼š</p></blockquote><ul><li>Docker Compose ä¸»è¦ç”¨äºå¼€å‘å’Œæµ‹è¯•ï¼Œæˆ–è€…å°å‹ç”Ÿäº§ç¯å¢ƒã€‚</li><li>Kubernetes ç”¨äºå¤§è§„æ¨¡çš„ç”Ÿäº§ç¯å¢ƒã€‚</li></ul><p>æœåŠ¡æ­å»º</p><p>å‚è€ƒï¼š <a href="https://www.kancloud.cn/zatko/kubernetes_k8s/2290695">https://www.kancloud.cn/zatko/kubernetes_k8s/2290695</a></p><p>master èŠ‚ç‚¹ä¸Šæ“ä½œ</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#æ‹‰å–é•œåƒ</span><br><span class="hljs-attribute">docker</span> pull mysql:<span class="hljs-number">5</span>.<span class="hljs-number">7</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºæ–‡ä»¶</p><p>åœ¨<code>/root/docker/mysql</code>ç›®å½•ä¸‹åˆ›å»º mysql-rc.yaml æ–‡ä»¶</p><p>mysql-rc.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span> <span class="hljs-comment"># è¿™æ˜¯ç¨³å®šé•¿æœŸä½¿ç”¨çš„ API ç‰ˆæœ¬ï¼Œå…·ä½“èµ„æºå¯¹è±¡çš„ç‰ˆæœ¬å¯ä»¥å‚è€ƒâ€œæ¨èé˜…è¯»â€</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ReplicationController</span> <span class="hljs-comment"># å‰¯æœ¬æ§åˆ¶å™¨ RC</span><br><span class="hljs-attr">metadata:</span> <span class="hljs-comment"># å…ƒæ•°æ®</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-dev-57</span> <span class="hljs-comment"># å®šä¹‰è¿™ä¸ª rc çš„åç§°ä¸º mysqlï¼Œå®ƒå…·æœ‰å…¨å±€å”¯ä¸€æ€§,5.7 ç‰ˆæœ¬ï¼Œå¼€å‘ç¯å¢ƒ</span><br><span class="hljs-attr">spec:</span> <span class="hljs-comment"># è§„èŒƒ</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># pod å‰¯æœ¬çš„æœŸå¾…æ•°é‡ï¼Œè¿™é‡Œä¸º 1ï¼Œè¡¨ç¤ºå½“ç¯å¢ƒä¸­æ²¡æœ‰ç¬¦åˆæ¡ä»¶è¦æ±‚çš„ pod æ•°é‡æ—¶éœ€è¦åˆ›å»ºä¸€ä¸ªï¼Œå¦‚æœç¬¦åˆè¦æ±‚çš„ pod æ•°é‡å¤§äºä¸€ä¸ªå°±è¦åˆ é™¤å¤šä½™çš„ podï¼Œå§‹ç»ˆè¦ä¿æŒç¯å¢ƒä¸­åªæœ‰ä¸€ä¸ª pod ç¬¦åˆè¦æ±‚ã€‚</span><br>  <span class="hljs-attr">selector:</span> <span class="hljs-comment"># æ ‡ç­¾é€‰æ‹©å™¨</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">mysql</span> <span class="hljs-comment"># ç¬¦åˆè¦æ±‚çš„ pod éƒ½å¿…é¡»è¦æœ‰è¿™ä¸ªæ ‡ç­¾ app:mysql</span><br>  <span class="hljs-attr">template:</span> <span class="hljs-comment"># åˆ›å»º pod å‰¯æœ¬çš„æ¨¡æ¿</span><br>    <span class="hljs-attr">metadata:</span> <span class="hljs-comment"># åˆ›å»ºçš„ pod å‰¯æœ¬æ‹¥æœ‰çš„å…ƒæ•°æ®</span><br>      <span class="hljs-attr">labels:</span> <span class="hljs-comment"># åˆ›å»ºçš„ pod å‰¯æœ¬çš„æ ‡ç­¾</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">mysql</span> <span class="hljs-comment"># å¯¹åº” RC çš„æ ‡ç­¾é€‰æ‹©å™¨ï¼Œä¿è¯åˆ›å»ºçš„ pod å‰¯æœ¬ç¬¦åˆ RC çš„é€‰æ‹©å™¨èŒƒå›´</span><br>    <span class="hljs-attr">spec:</span> <span class="hljs-comment"># å®šä¹‰ pod å‰¯æœ¬ä¸­è¿è¡Œçš„å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</span><br>      <span class="hljs-attr">containers:</span> <span class="hljs-comment"># å®¹å™¨ä¿¡æ¯</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql</span> <span class="hljs-comment"># å®¹å™¨çš„åå­—</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span> <span class="hljs-comment"># å®¹å™¨ä¸­è¿è¡Œçš„é•œåƒ</span><br>          <span class="hljs-attr">ports:</span> <span class="hljs-comment"># å®¹å™¨å¯¹å¤–æš´éœ²çš„ç«¯å£</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">3306</span> <span class="hljs-comment"># å®¹å™¨çš„ç«¯å£ 3306</span><br>          <span class="hljs-attr">env:</span> <span class="hljs-comment"># å®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD</span> <span class="hljs-comment"># è®¾ç½®ç¯å¢ƒå˜é‡ MYSQL_ROOT_PASSWORD=&quot;123456&quot;</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;123456&#x27;</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºæœåŠ¡</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">kubectl <span class="hljs-keyword">create</span> -f mysql-rc.yaml<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå¥½èµ„æºåï¼ŒæŸ¥çœ‹å·²ç»åˆ›å»ºçš„ ReplicationController èµ„æºå¯¹è±¡ï¼Œåœ¨å‘½ä»¤ä¸­å¯ä»¥å°†å…¶ç®€å†™ä¸º rcï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl <span class="hljs-built_in">get</span> rc<br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414155512.png" alt="image.png"></p><p>åœ¨è¾“å‡ºä¸­ï¼Œ<code>DESIRED</code>è¡¨ç¤ºè¿™ä¸ªåä¸º mysql-dev-57  çš„ rc éœ€è¦åˆ›å»ºä¸€ä¸ª pod å‰¯æœ¬ï¼Œ<code>CURRENT</code>è¡¨ç¤ºå½“å‰å·²ç»åˆ›å»ºå¥½çš„ pod å‰¯æœ¬æ•°é‡ï¼Œ<code>READY</code>è¡¨ç¤º pod å‰¯æœ¬å·²ç»æˆåŠŸè¿è¡Œï¼Œ<code>AGE</code>è¡¨ç¤ºå­˜æ´»æ—¶é—´ï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰ã€‚</p><p>ç„¶åæŸ¥çœ‹ç¯å¢ƒä¸­çš„ podï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼šï¼ˆç­‰å¾…ä¸€æ®µæ—¶é—´åå†çœ‹ï¼Œåˆ›å»ºéœ€è¦ç‚¹æ—¶é—´ï¼‰</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl <span class="hljs-built_in">get</span> pods<br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414155752.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨ rc åˆ›å»ºçš„ pod å‰¯æœ¬çš„åå­—ä¸ºï¼šmysql-dev-57-pqjgmï¼Œè¿™ä¸ªåå­—æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼Œå‰é¢éƒ¨åˆ†çš„ mysql-dev-57 å’Œåˆ›å»ºå®ƒçš„ rc åå­—ç›¸åŒï¼Œåé¢çš„ pqjgm æ˜¯éšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²å¯ä»¥ç”¨æ¥åŒºåˆ†ç”±åŒä¸€ä¸ª rc åˆ›å»ºçš„ä¸åŒçš„ podï¼ŒREADY ä¸º 1&#x2F;1 è¡¨ç¤ºå·²ç»åˆ›å»ºå¥½ï¼ŒSTATUS ä¸º Running è¡¨ç¤ºè¿™ä¸ª pod æ­£å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŸ¥çœ‹ mysql-dev-57-pqjgm  pod çš„å…·ä½“æ„å»ºè¿‡ç¨‹ï¼Œå¦‚æœä»¥åè¿è¡Œä¸æˆåŠŸï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Events æ¥æŸ¥çœ‹å…·ä½“æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">kubectl</span> describe pod mysql-dev-<span class="hljs-number">57</span>-pqjgm<br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414160049.png" alt="image.png"></p><p>åœ¨åˆ›å»ºæˆåŠŸè¿è¡Œç€ MySQL çš„ pod ä¹‹åï¼Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªä¸ä¹‹å¤–åº”çš„ Serviceï¼Œè¿™æ ·æ‰èƒ½è®©å…¶å®ƒçš„ pod å¯ä»¥è®¿é—® MySQL åº”ç”¨æä¾›çš„æœåŠ¡ã€‚</p><p>Service è¢«åˆ›å»ºä¹‹åï¼ŒKubernetes ä¼šç»™å®ƒåˆ†é…ä¸€ä¸ªè™šæ‹Ÿçš„ Cluster IPï¼Œå¹¶ä¸”åœ¨ Service çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¿™ä¸ª Cluster IP éƒ½ä¸ä¼šæ”¹å˜ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼Œpod å¯èƒ½ä¼šéšæ—¶å‘ç”Ÿå˜åŒ–ï¼ˆç”±äºæŸäº›æ„å¤–æƒ…å†µè¢«é”€æ¯ç„¶åé‡å»ºï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ Service å§‹ç»ˆæ˜¯ç¡®å®šä¸å˜çš„ï¼Œ</p><p>åœ¨ Kubernetes é›†ç¾¤å†…éƒ¨é€šè¿‡æœåŠ¡åå’Œæš´éœ²å‡ºæ¥çš„ç«¯å£å°±å¯ä»¥ç¨³å®šçš„è®¿é—®æŸä¸€ä¸ªæœåŠ¡è€Œä¸éœ€è¦ç®¡éšè—åœ¨æœåŠ¡èƒŒåçš„ pod çš„å˜åŒ–ã€‚</p><p>åœ¨<code>/root/docker/mysql</code>ç›®å½•ä¸‹æ–°å»º <code>mysql-svc.yaml</code> æ–‡ä»¶ï¼Œå¹¶å‘å…¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p><p>mysql-svc.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span> <span class="hljs-comment"># API ç‰ˆæœ¬å·ï¼Œä½¿ç”¨ç¨³å®šç‰ˆï¼šv1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span> <span class="hljs-comment"># èµ„æºå¯¹è±¡ç±»å‹</span><br><span class="hljs-attr">metadata:</span> <span class="hljs-comment"># å…ƒæ•°æ®</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-dev-57</span> <span class="hljs-comment"># Service çš„åç§°ä¸ºï¼šmysqlï¼Œè¿™ä¸ªåç§°å…·æœ‰å…¨å±€å”¯ä¸€æ€§</span><br><span class="hljs-attr">spec:</span> <span class="hljs-comment"># è§„èŒƒ</span><br>  <span class="hljs-attr">ports:</span> <span class="hljs-comment"># å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">3306</span> <span class="hljs-comment"># è¿™é‡ŒæŒ‡å®šä¸º 3306 ç«¯å£</span><br>  <span class="hljs-attr">selector:</span> <span class="hljs-comment"># æ ‡ç­¾é€‰æ‹©å™¨</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">mysql</span> <span class="hljs-comment"># æœåŠ¡å¯¹åº”çš„ pod æ˜¯å…·æœ‰ app=mysql æ ‡ç­¾çš„è¿™äº›</span><br></code></pre></td></tr></table></figure><p>æ–°å»ºæœåŠ¡çš„ yaml æ–‡ä»¶ä¹‹åæ‰§è¡Œåˆ›å»º</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">kubectl <span class="hljs-keyword">create</span> -f mysql-svc.yaml<br></code></pre></td></tr></table></figure><p>æ¥æŸ¥çœ‹ä¸€ä¸‹åˆ›å»ºå¥½çš„æœåŠ¡ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå…¶ä¸­ svc æ˜¯ services çš„ç®€å†™</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl <span class="hljs-built_in">get</span> svc<br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414160817.png" alt="image.png"></p><p>è¿™é‡Œåˆ—å‡ºäº† kubernetes é›†ç¾¤ç›®å‰å…¨éƒ¨çš„æœåŠ¡ï¼Œç¬¬ä¸€ä¸ªåä¸º kubernetes çš„æœåŠ¡æ˜¯é›†ç¾¤å¯åŠ¨ä»¥åé»˜è®¤åˆ›å»ºçš„æœåŠ¡ï¼Œ</p><p>ç¬¬äºŒä¸ªåä¸º mysql-dev-57 çš„æœåŠ¡æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ï¼Œé›†ç¾¤è‡ªåŠ¨ä¸ºå®ƒåˆ†é…äº†ä¸€ä¸ª ClusterIP ä¸º 10.90.169.4ï¼Œå®ƒçš„ 3306 ç«¯å£ä¹Ÿæ˜¯å‰é¢åœ¨ yaml æ–‡ä»¶ä¸­å·²ç»å®šä¹‰å¥½äº†çš„ã€‚</p><p>è¿˜å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ mysql æœåŠ¡æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">kubectl</span> describe svc mysql-dev-<span class="hljs-number">57</span><br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240414161113.png" alt="image.png"></p><p>è¿™é‡Œæœ‰ç‚¹å°å‘ï¼ˆåº”è¯¥ä¹Ÿä¸ç®—ï¼Œå®é™…ç”Ÿäº§ä¸­ï¼Œçš„ç¡®å¤–éƒ¨æœ‰æ—¶å€™ä¼šä¸å…è®¸ç›´æ¥è®¿é—®ï¼‰</p><p>è¿™é‡Œæ˜¯ svc éœ€è¦è®¾ç½®ä¸€ä¸‹ EXTERNAL-IP</p><p>æ”¹ä¸€ä¸‹  mysql-svc.yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span> <span class="hljs-comment"># API ç‰ˆæœ¬å·ï¼Œä½¿ç”¨ç¨³å®šç‰ˆï¼šv1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span> <span class="hljs-comment"># èµ„æºå¯¹è±¡ç±»å‹</span><br><span class="hljs-attr">metadata:</span> <span class="hljs-comment"># å…ƒæ•°æ®</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-dev-57</span> <span class="hljs-comment"># Service çš„åç§°ä¸ºï¼šmysqlï¼Œè¿™ä¸ªåç§°å…·æœ‰å…¨å±€å”¯ä¸€æ€§</span><br><span class="hljs-attr">spec:</span> <span class="hljs-comment"># è§„èŒƒ</span><br>  <span class="hljs-attr">ports:</span> <span class="hljs-comment"># å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">3306</span> <span class="hljs-comment"># è¿™é‡ŒæŒ‡å®šä¸º 3306 ç«¯å£</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">3306</span><br>  <span class="hljs-attr">selector:</span> <span class="hljs-comment"># æ ‡ç­¾é€‰æ‹©å™¨</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">mysql</span> <span class="hljs-comment"># æœåŠ¡å¯¹åº”çš„ pod æ˜¯å…·æœ‰ app=mysql æ ‡ç­¾çš„è¿™äº›</span><br>  <span class="hljs-attr">externalIPs:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.56</span><span class="hljs-number">.101</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">kubectl <span class="hljs-built_in">apply</span> -f mysql-svc.yaml<br></code></pre></td></tr></table></figure><ul><li><code>kubectl apply</code> å‘½ä»¤ä¼šæ¯”è¾ƒå·²ç»å­˜åœ¨çš„èµ„æºé…ç½®å’Œæ–°çš„é…ç½®æ–‡ä»¶ï¼Œç„¶åè®¡ç®—å‡ºéœ€è¦æ›´æ–°çš„å·®å¼‚ï¼Œå¹¶åº”ç”¨è¿™äº›å·®å¼‚æ¥æ›´æ–°èµ„æºã€‚è¿™ç§æ–¹å¼éå¸¸é€‚åˆæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ï¼ˆCI&#x2F;CDï¼‰æµç¨‹ã€‚</li></ul><p>è‡³æ­¤ï¼Œè¿™é‡Œçš„å¤–éƒ¨æœåŠ¡è¿æ¥ä¹Ÿæ˜¯ OKçš„ã€‚</p><hr><h3 id="å…³åœ-k8s-æ“ä½œ"><a href="#å…³åœ-k8s-æ“ä½œ" class="headerlink" title="å…³åœ k8s æ“ä½œ"></a>å…³åœ k8s æ“ä½œ</h3><p>å‚è€ƒï¼š <a href="https://blog.51cto.com/u_14568336/9719914">https://blog.51cto.com/u_14568336/9719914</a></p><p>æœªå®é™…æ“ä½œï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹</p><p>åœæ­¢K8Sé›†ç¾¤æµç¨‹</p><table><thead><tr><th>æ­¥éª¤</th><th>æ“ä½œ</th></tr></thead><tbody><tr><td>1</td><td>æ¸…ç©ºKubernetesèµ„æº</td></tr><tr><td>2</td><td>åˆ é™¤Pod</td></tr><tr><td>3</td><td>åˆ é™¤Service</td></tr><tr><td>4</td><td>å…³é—­KubeletæœåŠ¡</td></tr><tr><td>5</td><td>åˆ é™¤MasterèŠ‚ç‚¹</td></tr><tr><td>6</td><td>åœæ­¢K8Sé›†ç¾¤</td></tr></tbody></table><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ¸…ç©ºKubernetesä¸­çš„æ‰€æœ‰èµ„æºï¼ŒåŒ…æ‹¬Deploymentã€StatefulSetã€Serviceç­‰ç­‰ã€‚è¿™å¯ä»¥é€šè¿‡kubectlå‘½ä»¤æ¥å®ç°ã€‚</p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gml">kubectl <span class="hljs-keyword">delete</span> deployment --<span class="hljs-literal">all</span><br>kubectl <span class="hljs-keyword">delete</span> statefulset --<span class="hljs-literal">all</span><br>kubectl <span class="hljs-keyword">delete</span> service --<span class="hljs-literal">all</span><br></code></pre></td></tr></table></figure><p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤å½“å‰æ‰€æœ‰çš„Podã€‚åŒæ ·å¯ä»¥ä½¿ç”¨kubectlå‘½ä»¤æ¥åˆ é™¤ã€‚</p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gml">kubectl <span class="hljs-keyword">delete</span> pods --<span class="hljs-literal">all</span><br></code></pre></td></tr></table></figure><p>åˆ é™¤Serviceèµ„æºï¼ŒåŒæ ·ä½¿ç”¨kubectlå‘½ä»¤ã€‚</p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gml">kubectl <span class="hljs-keyword">delete</span> service --<span class="hljs-literal">all</span><br></code></pre></td></tr></table></figure><p>å…³é—­KubeletæœåŠ¡ï¼Œå¯ä»¥é€šè¿‡systemctlå‘½ä»¤æ¥åœæ­¢ã€‚</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">sudo systemctl stop kubelet<br></code></pre></td></tr></table></figure><p>å°†MasterèŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»å‡ºï¼Œæ‰§è¡Œå‘½ä»¤å‰è¯·ç¡®ä¿å¤‡ä»½æ•°æ®ã€‚</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">kubeadm reset</span><br></code></pre></td></tr></table></figure><p>æœ€åï¼Œåœæ­¢æ•´ä¸ªKubernetesé›†ç¾¤ã€‚</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">sudo kubeadm reset</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>docker</tag>
      
      <tag>è¿ç»´</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Portainerç¯å¢ƒé…ç½®</title>
    <link href="/2024/01/21/Portainer%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <url>/2024/01/21/Portainer%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€åŸºç¡€å®‰è£…"><a href="#1ã€åŸºç¡€å®‰è£…" class="headerlink" title="1ã€åŸºç¡€å®‰è£…"></a>1ã€åŸºç¡€å®‰è£…</h3><p>Portainer æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç®¡ç†ç•Œé¢ï¼Œå¯ä»¥è®©ä½ è½»æ¾åœ°ç®¡ç†ä¸åŒçš„Dockerç¯å¢ƒã€‚Portainer å¯ä»¥è¿è¡Œä½œä¸ºä¸€ä¸ªå®¹å™¨ï¼Œå…è®¸ä½ ç®¡ç†å®¹å™¨ã€é•œåƒã€ç½‘ç»œç­‰ã€‚</p><blockquote><p>æ‹‰å–æœ€æ–°çš„ Portainer</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull portainer/portainer<br></code></pre></td></tr></table></figure><h3 id="2ã€å®‰è£…å’Œå¯åŠ¨"><a href="#2ã€å®‰è£…å’Œå¯åŠ¨" class="headerlink" title="2ã€å®‰è£…å’Œå¯åŠ¨"></a>2ã€å®‰è£…å’Œå¯åŠ¨</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -d -p 9000:9000 <span class="hljs-attribute">--name</span>=portainer <span class="hljs-attribute">--restart</span>=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer<br></code></pre></td></tr></table></figure><ul><li><code>-d</code>: åå°è¿è¡Œå®¹å™¨ã€‚</li><li><code>-p 9000:9000</code>: å°†å®¹å™¨çš„ 9000 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 9000 ç«¯å£ã€‚<ul><li>å®¿ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£</li></ul></li><li><code>--name=portainer</code>: å°†å®¹å™¨å‘½åä¸º portainerã€‚</li><li><code>--restart=always</code>: ç¡®ä¿å®¹å™¨æ€»æ˜¯é‡æ–°å¯åŠ¨ã€‚</li><li><code>-v /var/run/docker.sock:/var/run/docker.sock</code>: å°† Docker çš„ Unix socket æ˜ å°„åˆ°å®¹å™¨ï¼Œå…è®¸ Portainer ä¸æœ¬åœ° Docker å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ã€‚</li><li><code>-v portainer_data:/data</code>: å°† Portainer æ•°æ®å­˜å‚¨åœ¨åä¸º portainer_data çš„å·ä¸­ã€‚</li></ul><p>å¼€æ”¾ä¸€ä¸‹ç«¯å£</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#å¼€æ”¾ç«¯å£</span><br>firewall-cmd <span class="hljs-params">--zone=public</span> <span class="hljs-params">--add-port=9000/tcp</span> <span class="hljs-params">--permanent</span> <br><span class="hljs-comment"># é‡å¯é˜²ç«å¢™ </span><br>firewall-cmd <span class="hljs-params">--reload</span><br><span class="hljs-comment"># æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£åˆ—è¡¨ </span><br>firewall-cmd <span class="hljs-params">--list-port</span><br></code></pre></td></tr></table></figure><h3 id="3ã€ä½¿ç”¨"><a href="#3ã€ä½¿ç”¨" class="headerlink" title="3ã€ä½¿ç”¨"></a>3ã€ä½¿ç”¨</h3><p>è®¿é—®ï¼š IP:9000</p><p>å»ºè®®å‚è€ƒä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š</p><ul><li><a href="https://blog.csdn.net/bbwangj/article/details/80973219">https://blog.csdn.net/bbwangj/article/details/80973219</a></li><li><a href="https://articles.zsxq.com/id_7fr6g496c05k.html">https://articles.zsxq.com/id_7fr6g496c05k.html</a></li></ul><p>é‡Œé¢æ˜¯è°ˆåˆ°äº†ä¸€ä¸ªé›†ç¾¤çš„å®¹å™¨ç®¡ç†ï¼Œä¸è¿‡å¦‚æœæ˜¯å•æœºé€‰æ‹©æœ¬åœ°å°±å¯ä»¥ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>docker</tag>
      
      <tag>è¿ç»´</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenAiç”Ÿæˆå¼æœåŠ¡å¾®æœåŠ¡åº”ç”¨ä½“ç³»æ„å»º_Day01</title>
    <link href="/2024/01/16/OpenAi%E7%94%9F%E6%88%90%E5%BC%8F%E6%9C%8D%E5%8A%A1%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E4%BD%93%E7%B3%BB%E6%9E%84%E5%BB%BA_Day01/"/>
    <url>/2024/01/16/OpenAi%E7%94%9F%E6%88%90%E5%BC%8F%E6%9C%8D%E5%8A%A1%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BA%94%E7%94%A8%E4%BD%93%E7%B3%BB%E6%9E%84%E5%BB%BA_Day01/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ æ–‡æ¡£åœ°å€ï¼š <a href="https://wx.zsxq.com/dweb2/index/columns/48411118851818">https://wx.zsxq.com/dweb2/index/columns/48411118851818</a></p><p>ChatGLMå¤§æ¨¡å‹åœ°å€ï¼š <a href="https://open.bigmodel.cn/login">https://open.bigmodel.cn/login</a></p><p>é¡¹ç›®åœ°å€ï¼š </p><ul><li><a href="https://gitcode.net/KnowledgePlanet/chatgpt">https://gitcode.net/KnowledgePlanet/chatgpt</a></li><li><a href="https://gitcode.net/KnowledgePlanet/chatgpt/chatgpt-data">https://gitcode.net/KnowledgePlanet/chatgpt/chatgpt-data</a></li></ul><h3 id="1ã€ä»‹ç»å’Œä½¿ç”¨"><a href="#1ã€ä»‹ç»å’Œä½¿ç”¨" class="headerlink" title="1ã€ä»‹ç»å’Œä½¿ç”¨"></a>1ã€ä»‹ç»å’Œä½¿ç”¨</h3><p>è¿™ä¸ªé¡¹ç›®æ˜¯å±äº çŸ¥è¯†æ˜Ÿçƒ-ç å†œä¼šé”  é‡Œé¢çš„ä¸€ä¸ªé¡¹ç›® ã€ŠOpenAi(ChatGPT&#x2F;ChatGLM) å¾®æœåŠ¡åº”ç”¨ä½“ç³»æ„å»ºã€‹</p><p>Day01 è¿™ä¸€éƒ¨åˆ†çš„æ–‡ç« å†…å®¹ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹ç›¸å…³çš„å­¦ä¹ æ–‡æ¡£åœ°å€å’Œå­¦ä¹ å†…å®¹ï¼ˆå»ºè®®ç›´æ¥åŠ å…¥ä¸€ä¸‹è¿™ä¸ªæ˜Ÿçƒå»çœ‹ä¸€ä¸‹ç›¸å…³æ–‡ä»¶å†…å®¹ï¼‰</p><h4 id="è¿™ä¸ªé¡¹ç›®æ˜¯åšä»€ä¹ˆçš„"><a href="#è¿™ä¸ªé¡¹ç›®æ˜¯åšä»€ä¹ˆçš„" class="headerlink" title="è¿™ä¸ªé¡¹ç›®æ˜¯åšä»€ä¹ˆçš„"></a>è¿™ä¸ªé¡¹ç›®æ˜¯åšä»€ä¹ˆçš„</h4><p>è¿™ä¸ªæ˜¯ä¸€ä¸ªå­¦ä¹ ä½¿ç”¨ chatgpt&#x2F;chatglm ä½¿ç”¨çš„é¡¹ç›®ï¼Œåœ¨è°ƒç”¨ å¤§æ¨¡å‹è¯­è¨€ ç¬¬ä¸‰æ–¹æ¥å£çš„åŸºç¡€ä¸Šï¼ŒåŠ å…¥äº† ç½‘å…³ã€é‰´æƒè®¤è¯ã€å¾®ä¿¡å…¬ä¼—å·ã€ä¼ä¸šå¾®ä¿¡ã€æ”¯ä»˜åŒ…æ”¯ä»˜ç›¸å…³çš„æœåŠ¡ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šé¢æ„å»ºäº†ä¸€å¥—å¾®æœåŠ¡åº”ç”¨ä½“ç³»ã€‚</p><p>é…ç½®ç¯å¢ƒæ˜¯åŸºäº Nginx + Docker ï¼Œéƒ¨ç½²å’Œç›‘æ§åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä¹Ÿæœ‰ä½¿ç”¨åˆ°</p><h4 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h4><p>å…ˆæ˜¯ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ ˆå’Œä½¿ç”¨å·¥å…·</p><p>æŠ€æœ¯æ ˆï¼šSpringBootã€MyBatisã€MySQLã€Redis</p><p>å¼€å‘å·¥å…·ï¼š IntelliJ IDEAã€WebStormã€Dockerã€Protainterã€Nginxã€Gitã€Mavenã€Navicatã€SSHå·¥å…·</p><p>å‰ç«¯ï¼šNext.jsã€Typescript</p><p>å¼€å‘æµç¨‹ï¼š</p><ul><li><ol><li>åŸºç¡€è®¾ç½®çš„æœåŠ¡æ­å»º</li></ol></li><li><ol start="2"><li>æ¥å£é‰´æƒå¼€å‘</li></ol></li><li><ol start="3"><li>API-SDK çš„å¼€å‘ï¼Œç½‘é¡µçš„ç®€å•å¼€å‘</li></ol></li><li><ol start="4"><li>ChatGPT-WEB-UI -&gt; API-SDK -&gt; é‰´æƒ -&gt; OpenAI çš„ä½¿ç”¨</li></ol></li><li><ol start="5"><li>ChatGPT-WEB-UI æµç¨‹ğŸƒğŸ»è·‘é€šï¼Œé€æ­¥æ‰©å±•å…¶ä»–æœåŠ¡æ¨¡å—ã€‚è®©ä¸šåŠ¡ä¸åœºæ™¯ç»“åˆ</li></ol><ul><li>å…³æ³¨å…¬ä¼—å·ã€å…¬ä¼—å·å›å¤ã€ä¼ä¸šå¾®ä¿¡æœºå™¨äººã€äº¤æ˜“æ”¯ä»˜è´­ä¹°æˆæƒToken</li><li>è®© ChatGPT-WEB-UI ä¸å„ä¸ªæ¨¡å—ç»“åˆä½¿ç”¨ã€‚</li></ul></li></ul><p>æ¨èå·¥å…·ï¼š</p><ul><li>Termiusï¼šäº‘æœåŠ¡å™¨é“¾æ¥å·¥å…·ï¼Œè‡ªå¸¦ä¸€å¥— SFTP å·¥å…·ï¼Œå¾ˆå¥½ç”¨ã€‚</li><li>IDEA æ’ä»¶ï¼šSequence Diagram - ç”¨äºæ–¹æ³•ä¸Šå³é”®æŸ¥çœ‹ä»£ç æµç¨‹çš„ï¼Œä¸»è¦å¸®åŠ©å¤§å®¶ç†è§£ä»£ç ã€‚</li><li>Docker - å¯æœ¬åœ°å®‰è£…ï¼Œä¸éœ€è¦éå¾—è´­ä¹°äº‘æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ»¡è¶³å­¦ä¹ è¯‰æ±‚ã€‚</li><li>natapp - å†…ç½‘ç©¿é€å·¥å…·ï¼Œç›¸å½“äºä½ å¼€å¯åï¼Œå¯ä»¥åˆ†é…ç»™ä½ ä¸€ä¸ªåŸŸåï¼Œè®©å¤–ç½‘è®¿é—®åˆ°ä½ çš„æœåŠ¡</li></ul><p>æœåŠ¡å…³ç³»å›¾å’Œè¯¾ç¨‹ç›®å½•</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240118071619.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240118072039.png" alt="image.png"></p><h4 id="æœåŠ¡è§£è€¦æ€æƒ³"><a href="#æœåŠ¡è§£è€¦æ€æƒ³" class="headerlink" title="æœåŠ¡è§£è€¦æ€æƒ³"></a>æœåŠ¡è§£è€¦æ€æƒ³</h4><p>è¿™é‡Œä½¿ç”¨äº†ä¸€ç§æ–¹å¼ï¼Œæ˜¯å°†æ ¸å¿ƒçš„åŸºç¡€ç‰©æ–™é€šè¿‡ API çš„æ–¹å¼ä¸å…·ä½“çš„ç‰©æ–™æœåŠ¡æ¨¡å—è§£ï¼Œå…¶ä¸­ç‰©æ–™æŒ‡SDKå’ŒæœåŠ¡ï¼›</p><p>é¡¹ç›®ä¸­å…·ä½“çš„åšæ³•æ˜¯å°† SDK é¡¹ç›®è¿›è¡Œäº†æ‰“åŒ…åˆ°æœ¬åœ°ä»“åº“çš„æ“ä½œï¼Œç„¶ååœ¨å¾®æœåŠ¡åº”ç”¨ç¨‹åºä¸­ç›´æ¥å¼•ç”¨è¿™ä¸ªä¾èµ–ã€‚</p><h3 id="2ã€é¡¹ç›®åˆæ­¥å­¦ä¹ "><a href="#2ã€é¡¹ç›®åˆæ­¥å­¦ä¹ " class="headerlink" title="2ã€é¡¹ç›®åˆæ­¥å­¦ä¹ "></a>2ã€é¡¹ç›®åˆæ­¥å­¦ä¹ </h3><p>çœ‹è¿™ä¸ªæ–‡æ¡£çš„æ—¶å€™å»ºè®®è¿˜æ˜¯æœ‰è‡ªå·±çš„ä¸€ä¸ªå­¦ä¹ èŠ‚å¥ï¼Œä¿æŒæ›´æ–°è¿­ä»£è‡ªå·±çš„æ–‡æ¡£ç›¸å…³å†…å®¹ï¼Œå¯ä»¥å°†è‡ªå·±çš„ç†è§£è¾“å‡ºï¼Œå°è¯•ä½¿ç”¨æ›´ç®€çŸ­çš„è¯­è¨€æ›´æ–°ä¸€ä¸‹ä¹‹å‰çš„å†…å®¹ï¼Œå¹¶è¡¥å……ä¸€ä¸‹æ²¡æœ‰æ³¨æ„åˆ°çš„åœ°æ–¹ã€‚</p><h4 id="æ‹‰å–é¡¹ç›®æ“ä½œå’Œä¸Šä¼ ä»“åº“"><a href="#æ‹‰å–é¡¹ç›®æ“ä½œå’Œä¸Šä¼ ä»“åº“" class="headerlink" title="æ‹‰å–é¡¹ç›®æ“ä½œå’Œä¸Šä¼ ä»“åº“"></a>æ‹‰å–é¡¹ç›®æ“ä½œå’Œä¸Šä¼ ä»“åº“</h4><blockquote><p>push å·¥ç¨‹åˆ°ä»“åº“</p></blockquote><p>æ–‡æ¡£åœ°å€ï¼š <a href="https://articles.zsxq.com/id_z9wh4hsg21dn.html">https://articles.zsxq.com/id_z9wh4hsg21dn.html</a></p><p>è¿›å…¥åˆ°ï¼š <a href="https://gitcode.net/CreativeAlliance">https://gitcode.net/CreativeAlliance</a></p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ä»“åº“ï¼š chatgpt-dev-ops-10863-lq</p><p>æ‹‰å–è¿™ä¸ªé¡¹ç›®åˆ°æœ¬åœ°ï¼Œç„¶åç”¨ IDEAæ‰“å¼€å¹¶æäº¤</p><p>å‘½ä»¤è¡ŒæŒ‡å¼•</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240119205949.png" alt="image.png"></p><p>æ¨é€ç°æœ‰çš„ Git ä»“åº“</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">cd existing_repo<br>git remote <span class="hljs-built_in">rename</span> <span class="hljs-built_in">origin</span> old-<span class="hljs-built_in">origin</span><br>git remote add <span class="hljs-built_in">origin</span> https://gitcode.net/CreativeAlliance/chatgpt-dev-ops-<span class="hljs-number">10863</span>-lq.git<br>git <span class="hljs-built_in">push</span> -u <span class="hljs-built_in">origin</span> --all<br>git <span class="hljs-built_in">push</span> -u <span class="hljs-built_in">origin</span> --tags<br></code></pre></td></tr></table></figure><p>æ¨é€ç°æœ‰æ–‡ä»¶å¤¹</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">cd</span> existing_folder<br><span class="hljs-symbol">git</span> init<br><span class="hljs-symbol">git</span> remote <span class="hljs-keyword">add</span> origin https:<span class="hljs-comment">//gitcode.net/CreativeAlliance/chatgpt-dev-ops-10863-lq.git</span><br><span class="hljs-symbol">git</span> <span class="hljs-keyword">add</span> .<br><span class="hljs-symbol">git</span> commit -m <span class="hljs-string">&quot;Initial commit&quot;</span><br><span class="hljs-symbol">git</span> <span class="hljs-keyword">push</span> -u origin master<br></code></pre></td></tr></table></figure><p>gitcode çš„ç™»é™†æ–¹æ˜¯éœ€è¦ CSDN çš„è´¦å·å¯†ç ã€‚</p><hr><h4 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a>ç¯å¢ƒå®‰è£…</h4><p>Docker å®‰è£…ä½¿ç”¨</p><p>Portainer ç¯å¢ƒé…ç½®</p><p>Nginx ç¯å¢ƒé…ç½®ï¼š <a href="https://articles.zsxq.com/id_1lcdsxia3ld3.html">https://articles.zsxq.com/id_1lcdsxia3ld3.html</a></p><p>å®‰è£…æ“ä½œ: [[Dockerå…¥é—¨_Dockerçš„åŸºæœ¬ä½¿ç”¨#6ã€docker å®‰è£… nginx]]</p><p>Nginx çš„ä½¿ç”¨åŒ…æ‹¬çš„é…ç½®æœ‰ï¼›é…ç½®ã€é¦–é¡µã€æ—¥å¿—ã€SSLç­‰ï¼Œè€Œè¿™äº›å†…å®¹åœ¨é»˜è®¤åŸºç¡€å®‰è£…çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯åœ¨ Docker å®¹å™¨ä¸­çš„ï¼Œä¸å®¹æ˜“è¢«ç®¡ç†å’Œä½¿ç”¨ã€‚æ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬åœ¨å®‰è£… Nginx çš„æ—¶å€™æ˜¯éœ€è¦åšæ˜ å°„å¤„ç†ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠåœ¨ Docker ä¸Šå®‰è£…çš„ Nginx é…ç½®ä¿¡æ¯æ‹·è´åˆ°æœ¬åœ°ï¼Œä¹‹ååšä¸€äº›ä¿®æ”¹åï¼Œå†å»é‡æ–°æ‰§è¡Œ Nginx çš„å®‰è£…ã€é‡æ–°å®‰è£…å‰è®°å¾—æŠŠä¹‹å‰çš„ Nginx åˆ æ‰ã€‘ã€‚</p><p>å¸¸ç”¨å‘½ä»¤:</p><ol><li>åœæ­¢ï¼šdocker stop Nginx</li><li>é‡å¯ï¼šdocker restart Nginx</li><li>åˆ é™¤æœåŠ¡ï¼šdocker rm Nginx</li><li>åˆ é™¤é•œåƒï¼šdocker rmi Nginx</li><li>è¿›å…¥æœåŠ¡ï¼šdocker exec -it Nginx &#x2F;bin&#x2F;bash</li></ol><p>å…¶ä»–:</p><ol><li>æŸ¥çœ‹é…ç½®ï¼šls &#x2F;etc&#x2F;nginx&#x2F;</li><li>æŸ¥çœ‹é¡µé¢ï¼šls &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</li><li>å…¶ä»–è¯´æ˜ï¼šconf.d æ˜¯ä¸ªæ–‡ä»¶å¤¹</li></ol><p>è¿™ä¸ª Portainer æ§åˆ¶å°çš„ä½¿ç”¨å¯ä»¥çœ‹ä¸€ä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240127222958.png" alt="image.png"></p><h4 id="APIå·¥ç¨‹æ­å»º"><a href="#APIå·¥ç¨‹æ­å»º" class="headerlink" title="APIå·¥ç¨‹æ­å»º"></a>APIå·¥ç¨‹æ­å»º</h4><h5 id="ç®€å•è®¿é—®è®¤è¯"><a href="#ç®€å•è®¿é—®è®¤è¯" class="headerlink" title="ç®€å•è®¿é—®è®¤è¯"></a>ç®€å•è®¿é—®è®¤è¯</h5><p>æµç¨‹è®¾è®¡ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401291538617.png" alt="image.png"></p><p>å®ç°æ•ˆæœï¼šä»¥ç”¨æˆ·è§†è§’è®¿é—®APIå¼€å§‹ï¼Œè¿›å…¥ Nginx çš„ auth è®¤è¯æ¨¡å—ï¼Œè°ƒç”¨ SpringBoot æä¾›çš„è®¤è¯æœåŠ¡ã€‚æ ¹æ®è®¤è¯ç»“æœè°ƒç”¨é‡å®šå‘åˆ°å¯¹åº”çš„ API æ¥å£æˆ–è€… 404 é¡µé¢ã€‚</p><blockquote><p>ä»£ç å®ç°</p></blockquote><ol><li>åœ¨ Application ä¸­æä¾›äº†2ä¸ªæ¥å£ï¼Œä¸€ä¸ªè®¤è¯ï¼Œä¸€ä¸ªæˆåŠŸã€‚</li><li>åœ¨ verify æ¥å£ä¸­ï¼Œå¦‚æœ <code>token == success å°±è¿”å› HttpStatus.OK == 200 çš„ç ï¼Œå¦åˆ™è¿”å› HttpStatus.BAD_REQUEST == 400</code> é”™è¯¯ç </li></ol><p>Application</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Logger</span> logger = <span class="hljs-title class_">LoggerFactory</span>.<span class="hljs-title function_">getLogger</span>(<span class="hljs-title class_">Application</span>.<span class="hljs-property">class</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">Application</span>.<span class="hljs-property">class</span>, args);<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/verify&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">verify</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> token</span>) &#123;<br>        logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;éªŒè¯ tokenï¼š&#123;&#125;&quot;</span>, token);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;success&quot;</span>.<span class="hljs-title function_">equals</span>(token))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponseEntity</span>.<span class="hljs-title function_">status</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">OK</span>).<span class="hljs-title function_">build</span>();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponseEntity</span>.<span class="hljs-title function_">status</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">BAD_REQUEST</span>).<span class="hljs-title function_">build</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/success&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">success</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;test success by xfg&quot;</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>Nginx é…ç½®</p><ol><li>ç”¨æˆ·è®¿é—® <a href="http://localhost/api">http://localhost/api</a> ç›®æ ‡æ˜¯åˆ° <code>http://192.168.1.101:8080/success</code> ä½†è¿™é‡Œæ·»åŠ äº† auth æ¨¡å—ï¼Œæ‰€ä»¥ä¼šå…ˆè¿›å…¥ auth çš„å¤„ç†ã€‚</li><li>&#x3D;  <code>auth æ˜¯ç»å¯¹åŒ¹é…ï¼Œæ²¡æœ‰ = å·å°±æ˜¯å‰ç¼€åŒ¹é…ã€‚åœ¨ auth ä¸­æŠŠè¯·æ±‚ api çš„å‚æ•°è·å–åˆ°åœ¨è®¿é—®åˆ°éªŒè¯åœ°å€ http://192.168.1.101:8080/verify?$query</code> å¦‚æœæ¥å£è¿”å›ä¸€ä¸ª200çš„ç å°±é€šè¿‡ï¼Œå…¶ä»–çš„ç å°±å¤±è´¥ã€‚</li></ol><p>æ”¹åŠ¨ Nginx conf.d&#x2F;default.conf æ–‡ä»¶ï¼Œæ·»åŠ  auth è®¤è¯æ¨¡å—</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">server &#123;<br><br>    listen       <span class="hljs-number">80</span>;<br>    server_name  <span class="hljs-number">192.168</span>.<span class="hljs-number">1.101</span>;<br><br>    <span class="hljs-comment"># é¦–é¡µ</span><br>    index index.html;<br><br>    <span class="hljs-keyword">location</span> <span class="hljs-title">/ &#123;</span><br><span class="hljs-title">        root</span>   /usr/share/nginx/html;<br>        index  index.html index.htm;<br>    &#125;<br><br>    <span class="hljs-keyword">location</span> <span class="hljs-title">/api</span>/ &#123;<br>        auth_request /auth;<br>        <span class="hljs-comment"># é‰´æƒé€šè¿‡åçš„å¤„ç†æ–¹å¼</span><br>        proxy_pass http://<span class="hljs-number">192.168</span>.<span class="hljs-number">1.101</span>:<span class="hljs-number">8080</span>/success;<br>    &#125;<br><br>    <span class="hljs-keyword">location</span> <span class="hljs-title">= /auth</span> &#123;<br>        <span class="hljs-comment"># å‘é€å­è¯·æ±‚åˆ°HTTPæœåŠ¡ï¼ŒéªŒè¯å®¢æˆ·ç«¯çš„å‡­æ®ï¼Œè¿”å›å“åº”ç </span><br>        internal;<br>        <span class="hljs-comment"># è®¾ç½®å‚æ•°</span><br>        set $query &#x27;&#x27;;<br>        if ($request_uri ~* <span class="hljs-string">&quot;[^\?]+\?(.*)$&quot;</span>) &#123;<br>            set $query $<span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-comment"># éªŒè¯æˆåŠŸï¼Œè¿”å›200 OK</span><br>        proxy_pass http://<span class="hljs-number">192.168</span>.<span class="hljs-number">1.101</span>:<span class="hljs-number">8080</span>/verify?$query;<br>        <span class="hljs-comment"># å‘é€åŸå§‹è¯·æ±‚</span><br>        proxy_pass_request_body off;<br>        <span class="hljs-comment"># æ¸…ç©º Content-Type</span><br>        proxy_set_header Content-<span class="hljs-keyword">Type</span> <span class="hljs-string">&quot;&quot;</span>;<br>     &#125;<br><br>    error_page <span class="hljs-number">404</span> /<span class="hljs-number">404</span>.html;<br>        <span class="hljs-keyword">location</span> <span class="hljs-title">= /40x</span>.html &#123;<br><br>        &#125;<br><br>    error_page   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /<span class="hljs-number">50</span>x.html;<br>     <span class="hljs-keyword">location</span> <span class="hljs-title">= /50x</span>.html &#123;<br>     &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Shiroç™»å½•æˆæƒå‘æ”¾è®¿é—®token"><a href="#Shiroç™»å½•æˆæƒå‘æ”¾è®¿é—®token" class="headerlink" title="Shiroç™»å½•æˆæƒå‘æ”¾è®¿é—®token"></a>Shiroç™»å½•æˆæƒå‘æ”¾è®¿é—®token</h5><p>éœ€è¦å»çœ‹ä¸€ä¸‹ç›¸å…³çš„ä»£ç å’Œè¿›è¡Œæ•´ç†ï¼Œè¿™é‡Œä¸»è¦é˜…è¯»ä¸€ä¸‹ç›¸å…³çš„è¯¾ç¨‹æ–‡ç« å¹¶æ¨è¿›è¿›åº¦ã€‚</p><p>è¿™é‡Œæ˜¯å…ˆå®ç°ä¸€ä¸ªæ•ˆæœï¼š éªŒè¯é€šè¿‡åå‘æ”¾ Tokenï¼Œä¹‹åå†ä½¿ç”¨ Token è®¿é—® OpenAI åœ°å€ã€‚</p><p>æœ¬ç« æ˜¯åœ¨ SpringBoot é¡¹ç›®ä¸­å¼•å…¥è¿›æ¥ Shiroã€JWTï¼Œä»è€Œè¿›è¡Œå¤„ç†ã€‚</p><p>ä»£ç å†…å®¹å¾…åç»­åˆ†æ</p><blockquote><p>é¡¹ç›®ç»“æ„</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401291605000.png" alt="image.png|400"></p><ol><li>JwtTokenï¼šToken çš„å¯¹è±¡ä¿¡æ¯ï¼Œä½ å¯ä»¥è®¾ç½®ç”¨æˆ·IDã€ç”¨æˆ·å¯†ç </li><li>JwtRealmï¼šä¸€ä¸ªè‡ªå®šä¹‰çš„éªŒè¯æœåŠ¡ï¼Œéœ€è¦ç»§æ‰¿ AuthorizingRealm ç±»ã€‚</li><li>JwtFilterï¼šè‡ªå®šä¹‰çš„ Filter è¿‡æ»¤å™¨ã€‚</li><li>JwtUtilï¼štokençš„åˆ›å»ºã€è§£æã€éªŒè¯å·¥å…·ç±»ã€‚</li><li>ShiroConfigï¼šShiro çš„ä¸€ä¸ªé…ç½®å¯åŠ¨ç±»ã€‚</li><li>ApiAccessControllerï¼šæ–°å¢åŠ çš„APIè®¿é—®å‡†å…¥ç®¡ç†ï¼›å½“è®¿é—® OpenAI æ¥å£æ—¶ï¼Œéœ€è¦è¿›è¡Œå‡†å…¥éªŒè¯ã€‚</li></ol><hr><p>åç»­çœ‹ä¸€ä¸‹è¿™äº›ä»£ç ï¼Œå¤§æ¦‚çš„ä¸€ä¸ªæ€è·¯æ˜¯ï¼š</p><p>å½“ç™»å½•çš„æ—¶å€™æ ¡éªŒé€šè¿‡ï¼Œç„¶åè¿”å›ä¸€ä¸ªæˆæƒ token ï¼›åç»­ç™»å½•çš„æ—¶å€™é€šè¿‡è§£æè¿™ä¸ª token åˆ¤æ–­æ˜¯å¦æœ‰å¯¹åº”æƒé™æ“ä½œã€‚</p><p>çœ‹ä¸€ä¸‹è¿™ç¯‡è¯¾ç¨‹æ–‡ç« ï¼š <a href="https://articles.zsxq.com/id_0843dvwa4j2i.html">https://articles.zsxq.com/id_0843dvwa4j2i.html</a></p><p>ç™»å½•è¿™æ–¹é¢çš„å†…å®¹å»ºè®®å•ç‹¬å¼€ä¸€ä¸ªå•ç« å»ç†è§£ä¸€ä¸‹æµè¡Œçš„ä¸€äº›æŠ€æœ¯å’Œå®ç°æ€è·¯ã€‚</p><h5 id="chatgpt-api-é¡¹ç›®"><a href="#chatgpt-api-é¡¹ç›®" class="headerlink" title="chatgpt-api é¡¹ç›®"></a>chatgpt-api é¡¹ç›®</h5><p>é¡¹ç›®åœ°å€ï¼š <a href="https://gitcode.net/KnowledgePlanet/chatgpt/chatgpt-api">https://gitcode.net/KnowledgePlanet/chatgpt/chatgpt-api</a></p><p>to be continedâ€¦.</p><h4 id="æœåŠ¡é•œåƒæ„å»ºå’Œå®¹å™¨éƒ¨ç½²"><a href="#æœåŠ¡é•œåƒæ„å»ºå’Œå®¹å™¨éƒ¨ç½²" class="headerlink" title="æœåŠ¡é•œåƒæ„å»ºå’Œå®¹å™¨éƒ¨ç½²"></a>æœåŠ¡é•œåƒæ„å»ºå’Œå®¹å™¨éƒ¨ç½²</h4><p>å‚è€ƒï¼š <a href="https://articles.zsxq.com/id_q9d1o7nvj5nb.html">https://articles.zsxq.com/id_q9d1o7nvj5nb.html</a></p><p>è¿™ä¸€ç« çš„å®ç°åŠŸèƒ½ï¼š å°†ä¸Šä¸€ç« çš„å®ç°çš„ç®€æ˜“é¡¹ç›®æ„å»ºå·¥ç¨‹é¡¹ç›®å¹¶æ¨é€åˆ° Docker ä»“åº“ã€‚</p><p>æµç¨‹è¯´æ˜ï¼š åœ¨å·¥ç¨‹ä¸­æ·»åŠ  Dockerfile é…ç½®æ–‡ä»¶ï¼Œå¯¹å·¥ç¨‹è¿›è¡Œé•œåƒæ‰“åŒ…ã€‚å¹¶æŠŠå·¥ç¨‹æ¨é€åˆ°æœ¬åœ°å’Œè¿œç¨‹ Docker ä»“åº“è¿›è¡Œéƒ¨ç½²éªŒè¯ã€‚</p><p>æœ¬åœ°çš„ Docker ç›´æ¥åœ¨ IDEA é…ç½®å³å¯å¯åŠ¨ï¼Œè¿œç¨‹çš„æœåŠ¡ä»“åº“ä¸€ç§æ˜¯é…ç½®å¼€å¯2375ç«¯å£ï¼Œå¦å¤–ä¸€ç§æŠŠé•œåƒæ–‡ä»¶æ¨é€åˆ° <a href="https://hub.docker.com/">https://hub.docker.com</a> å†é€šè¿‡æ‹‰å–çš„æ–¹å¼ä½¿ç”¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401291634686.png" alt="image.png"></p><p>çœ‹ä¸€ä¸‹è¯¾ç¨‹æ–‡ä»¶ï¼Œç„¶åå®é™…æ“ä½œä¸€ä¸‹ï¼š <a href="https://articles.zsxq.com/id_q9d1o7nvj5nb.html">https://articles.zsxq.com/id_q9d1o7nvj5nb.html</a></p><p>éš¾åº¦åº”è¯¥æ¯”è¾ƒå°ï¼Œéœ€è¦å®é™…å»è·‘ä¸€ä¸‹ã€‚to be continedâ€¦</p><hr><h4 id="ChatGPT-SDKç»„ä»¶å·¥ç¨‹ç®€å•åŠŸèƒ½å®ç°"><a href="#ChatGPT-SDKç»„ä»¶å·¥ç¨‹ç®€å•åŠŸèƒ½å®ç°" class="headerlink" title="ChatGPT-SDKç»„ä»¶å·¥ç¨‹ç®€å•åŠŸèƒ½å®ç°"></a>ChatGPT-SDKç»„ä»¶å·¥ç¨‹ç®€å•åŠŸèƒ½å®ç°</h4><p>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_637o58swvzwv.html">https://articles.zsxq.com/id_637o58swvzwv.html</a></p><p>å®ç°æ•ˆæœï¼š æ­å»ºä¸€ä¸ª ChatGPT-SDK ç»„ä»¶å·¥ç¨‹ï¼Œä¸“é—¨ç”¨äºå°è£…å¯¹ OpenAI æ¥å£çš„ä½¿ç”¨ã€‚</p><p>æµç¨‹è®¾è®¡ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401291645971.png" alt="image.png"></p><h3 id="3ã€é¡¹ç›®å†…å®¹å­¦ä¹ "><a href="#3ã€é¡¹ç›®å†…å®¹å­¦ä¹ " class="headerlink" title="3ã€é¡¹ç›®å†…å®¹å­¦ä¹ "></a>3ã€é¡¹ç›®å†…å®¹å­¦ä¹ </h3><p>å°†è¯¾ç¨‹æ–‡æ¡£å¯¹åº”çš„é“¾æ¥æ”¾ä¸€ä¸‹ï¼Œåç»­å®é™…ä½¿ç”¨å’Œå­¦ä¹ åˆ°çš„æ—¶å€™ç”¨ä¸€ä¸‹ã€‚</p><ul><li>å¾®ä¿¡å…¬ä¼—å·éªŒç­¾å’Œåˆæ­¥å¯¹æ¥OpenAI<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_e9r7rfv308px.html">https://articles.zsxq.com/id_e9r7rfv308px.html</a></li><li>è·Ÿä¹‹å‰è‡ªå·±åšçš„ [[ChatGPTé—®ç­”åŠ©æ‰‹]]  é‡Œé¢éƒ¨åˆ†å†…å®¹å·®ä¸å¤šï¼Œå®ç°è¿‡ç¨‹ç±»ä¼¼ã€‚</li></ul></li><li>æµå¼åº”ç­”ä¼šè¯è®¾è®¡å®ç°<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_4r1ifost3bhh.html">https://articles.zsxq.com/id_4r1ifost3bhh.html</a></li><li>åŠŸèƒ½æ•ˆæœï¼š ä¸°å¯Œ OpenAiSession ä¼šè¯æœåŠ¡æ¥å£ï¼Œå¢åŠ æµå¼å›ç­”çš„äº‹ä»¶ç›‘å¬å¤„ç†ã€‚</li></ul></li><li>gpt-sdk å®Œå–„å®ç°å„ç±»å¸¸ç”¨æ¥å£<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_hif1r28gp3i4.html">https://articles.zsxq.com/id_hif1r28gp3i4.html</a></li><li>å®ç°æ•ˆæœï¼š å®ç° gpt å®˜ç½‘çš„ä¸€äº›å…¶ä»–æ¥å£åŠŸèƒ½</li></ul></li><li>å­¦ä¹ æ–‡æ¡£åœ°å€ï¼š <a href="https://wx.zsxq.com/dweb2/index/columns/48411118851818">https://wx.zsxq.com/dweb2/index/columns/48411118851818</a></li><li>1ã€å‰ç«¯é¡¹ç›®æ„å»º<ul><li>Webé¡µé¢å·¥ç¨‹åˆå§‹åŒ–<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_t56b7jqr7a95.html">https://articles.zsxq.com/id_t56b7jqr7a95.html</a></li></ul></li><li>å·¥å…·æ é¢æ¿<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_7oetre5ef0wo.html">https://articles.zsxq.com/id_7oetre5ef0wo.html</a></li><li>æŒ‰é’®å®šä¹‰ä¸äº‹ä»¶å®ç°</li><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_eosfsi8mkzw3.html">https://articles.zsxq.com/id_eosfsi8mkzw3.html</a></li></ul></li><li>å¯¹è¯æ¡†åˆ—è¡¨<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_13if2wn4jhlg.html">https://articles.zsxq.com/id_13if2wn4jhlg.html</a></li></ul></li><li>å¯¹è¯æ¡†æ¶ˆæ¯<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_57ho2v2ol52r.html">https://articles.zsxq.com/id_57ho2v2ol52r.html</a></li></ul></li><li>å®Œå–„å¯¹è¯å¤„ç†<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_vux657zw1e0c.html">https://articles.zsxq.com/id_vux657zw1e0c.html</a></li></ul></li><li>å¯¹è¯è§’è‰²è®¾å®š<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_44wg8c8os2o2.html">https://articles.zsxq.com/id_44wg8c8os2o2.html</a></li></ul></li></ul></li><li>2ã€å·¥ç¨‹é‡æ„å’Œæµå¼å¼‚æ­¥å“åº”æ¥å£å®ç°<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_cnp0sxnfmpww.html">https://articles.zsxq.com/id_cnp0sxnfmpww.html</a></li></ul></li><li>3ã€æµå¼æ¥å£å¯¹æ¥<br>  åœ°å€ï¼š  <a href="https://articles.zsxq.com/id_ifllevif6p6i.html">https://articles.zsxq.com/id_ifllevif6p6i.html</a></li><li>4ã€å…¬ä¼—å·å‘é€éªŒè¯ç é‰´æƒç™»å½•<ul><li>åœ°å€ï¼š  <a href="https://articles.zsxq.com/id_kt4oql6efmmo.html">https://articles.zsxq.com/id_kt4oql6efmmo.html</a></li></ul></li><li>5ã€å…¬ä¼—å·æ‰«ç ç™»å½•<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_a89dt3lfkm83.html">https://articles.zsxq.com/id_a89dt3lfkm83.html</a></li></ul></li><li>6ã€å‰åç«¯æ„å»ºé•œåƒéƒ¨ç½²<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_soxvwros9icn.html">https://articles.zsxq.com/id_soxvwros9icn.html</a></li></ul></li><li>7ã€ç½‘ç«™æ·»åŠ ç™¾åº¦ç»Ÿè®¡<ul><li>åœ°å€ï¼š  <a href="https://articles.zsxq.com/id_54o9ezlrnd8w.html">https://articles.zsxq.com/id_54o9ezlrnd8w.html</a></li></ul></li><li>chatgpt-api ç™½åå•å’Œæ•æ„Ÿè¯è§„åˆ™è¿‡æ»¤<ul><li>åœ°å€ï¼š  <a href="https://articles.zsxq.com/id_w35g7d56q72z.html">https://articles.zsxq.com/id_w35g7d56q72z.html</a></li></ul></li><li>chatgpt-sdk  æ”¯æŒå¤šæ¸ é“å¯¹è¯<ul><li>åœ°å€ï¼š  <a href="https://articles.zsxq.com/id_j8cowvswwzgh.html">https://articles.zsxq.com/id_j8cowvswwzgh.html</a></li></ul></li><li>ç”¨æˆ·é¢åº¦è´¦æˆ·çš„æ ¡éªŒé¢†åŸŸå®ç°<ul><li>åœ°å€ï¼š <a href="https://articles.zsxq.com/id_6en8ra41apnw.html">https://articles.zsxq.com/id_6en8ra41apnw.html</a></li></ul></li><li>å•†å“ä¸‹å•å¯¹æ¥å¾®ä¿¡æ”¯ä»˜<ul><li>åœ°å€ï¼š  <a href="https://articles.zsxq.com/id_z7jj23ml1eum.html">https://articles.zsxq.com/id_z7jj23ml1eum.html</a></li></ul></li><li>å•†å“æ”¯ä»˜é¡µ<ul><li>åœ°å€ï¼š  <a href="https://articles.zsxq.com/id_twprn855gkwg.html">https://articles.zsxq.com/id_twprn855gkwg.html</a></li></ul></li><li>OpenAiå¤šæ¸ é“ç­–ç•¥æ¨¡å¼<ul><li>åœ°å€ï¼š  <a href="https://articles.zsxq.com/id_hmjpsiji69lb.html">https://articles.zsxq.com/id_hmjpsiji69lb.html</a></li></ul></li><li>åº”ç”¨ç›‘æ§(Prometheus + Grafana)<ul><li>åœ°å€ï¼š  <a href="https://articles.zsxq.com/id_lai3vqzlp2pr.html">https://articles.zsxq.com/id_lai3vqzlp2pr.html</a></li></ul></li><li>åº”ç”¨åˆ†å¸ƒå¼è®¾è®¡<ul><li>åœ°å€ï¼š  <a href="https://articles.zsxq.com/id_9smix85x3e3e.html">https://articles.zsxq.com/id_9smix85x3e3e.html</a></li></ul></li><li>æ•´ä½“éƒ¨ç½²ä¸Šçº¿<ul><li>åœ°å€ï¼š <a href="https://wx.zsxq.com/dweb2/index/topic_detail/188414845252452">https://wx.zsxq.com/dweb2/index/topic_detail/188414845252452</a></li></ul></li><li>dall-e æ–‡ç”Ÿå›¾<ul><li>åœ°å€ï¼š  <a href="https://wx.zsxq.com/dweb2/index/topic_detail/588581121148184">https://wx.zsxq.com/dweb2/index/topic_detail/588581121148184</a></li></ul></li></ul><p>to be continedâ€¦.</p><p>åç»­å†…å®¹éº»çƒ¦çœ‹ä¸€ä¸‹ [[OpenAiç”Ÿæˆå¼æœåŠ¡å¾®æœåŠ¡åº”ç”¨ä½“ç³»æ„å»º_Day02]] ç›¸å…³çš„å†…å®¹ã€‚</p><hr>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>java</tag>
      
      <tag>chatgpt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¹¶å‘ç¼–ç¨‹_çº¿ç¨‹æ± </title>
    <link href="/2024/01/15/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
    <url>/2024/01/15/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    
    <content type="html"><![CDATA[<p>æ¦‚è¿°ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401161011272.png" alt="image.png"></p><hr><p>ä¸ªäººä»ç„¶æ˜¯æ¨å´‡çœ‹ä¸€ä¸‹JavaGuideçš„åšå®¢å†…å®¹ï¼Œç„¶åè¾…åŠ©æŸ¥é˜…ä¸€äº›èµ„æ–™å»å­¦ä¹ ï¼ŒåŒæ—¶è¾…åŠ©ä¸€äº›ä»£ç ç¼–ç¨‹å»ç†è§£ã€‚</p><p>åšå®¢åœ°å€ï¼š <a href="https://javaguide.cn/java/concurrent/java-thread-pool-summary.html">https://javaguide.cn/java/concurrent/java-thread-pool-summary.html</a></p><p>å¯ä»¥ç›´æ¥ä»ç¬¬äºŒç« å†…å®¹å¼€å§‹çœ‹ã€‚</p><h3 id="1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± "><a href="#1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± " class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± "></a>1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </h3><h4 id="ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„"><a href="#ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„" class="headerlink" title="ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„"></a>ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„</h4><p>ç±»ä¼¼æ•°æ®åº“çš„è¿æ¥æ± ï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‡å°‘çº¿ç¨‹çš„ä¸€äº›ä¸å¿…è¦çš„èµ„æºæŸè€—ï¼ˆæ¯”å¦‚åˆ›å»ºå’Œé”€æ¯ï¼‰ï¼›</p><p>åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œé’ˆå¯¹ä¸€äº›çŸ­æœŸå¼‚æ­¥ä»»åŠ¡ï¼Œå»ºè®®ä½¿ç”¨çº¿ç¨‹æ± ï¼›</p><p>å¯ä»¥çœ‹ä¸€ä¸‹è¿™ä¸ªåŒºåˆ«ï¼š</p><p>ç›´æ¥ä½¿ç”¨çº¿ç¨‹çš„æƒ…å†µ</p><ol><li><strong>ç®€å•æˆ–å•æ¬¡ä»»åŠ¡</strong>ï¼šå¯¹äºä¸€äº›ç®€å•çš„æˆ–åªéœ€æ‰§è¡Œä¸€æ¬¡çš„å¤šçº¿ç¨‹ä»»åŠ¡ï¼Œç›´æ¥åˆ›å»ºçº¿ç¨‹å¯èƒ½æ›´ä¸ºç›´æ¥å’Œç®€å•ã€‚</li><li><strong>ç²¾ç»†æ§åˆ¶</strong>ï¼šå¦‚æœéœ€è¦å¯¹æ¯ä¸ªçº¿ç¨‹çš„åˆ›å»ºã€å¯åŠ¨ã€è¿è¡Œå’Œé”€æ¯è¿‡ç¨‹æœ‰æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œç›´æ¥ä½¿ç”¨çº¿ç¨‹å¯èƒ½æ›´åˆé€‚ã€‚</li><li><strong>ç‰¹å®šè¡Œä¸º</strong>ï¼šæŸäº›ç‰¹å®šçš„è¡Œä¸ºå¯èƒ½éœ€è¦å•ç‹¬çš„çº¿ç¨‹ï¼Œä¾‹å¦‚é•¿æ—¶é—´è¿è¡Œçš„ç›‘å¬çº¿ç¨‹ç­‰ã€‚</li></ol><p>ä½¿ç”¨çº¿ç¨‹æ± çš„æƒ…å†µ</p><ol><li><strong>å¤§é‡çŸ­æœŸä»»åŠ¡</strong>ï¼šå¯¹äºå¤§é‡çš„çŸ­æœŸå¼‚æ­¥ä»»åŠ¡ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥æ˜¾è‘—å‡å°‘çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ã€‚</li><li><strong>èµ„æºç®¡ç†</strong>ï¼šçº¿ç¨‹æ± å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†çº¿ç¨‹èµ„æºï¼Œé¿å…å› ä¸ºè¿‡å¤šçº¿ç¨‹è€Œå¯¼è‡´çš„èµ„æºè€—å°½é—®é¢˜ã€‚</li><li><strong>æ€§èƒ½æå‡</strong>ï¼šåœ¨é«˜è´Ÿè½½çš„åº”ç”¨ç¨‹åºä¸­ï¼Œçº¿ç¨‹æ± å¯ä»¥é€šè¿‡é‡ç”¨ç°æœ‰çº¿ç¨‹æé«˜æ€§èƒ½ã€‚</li><li><strong>è´Ÿè½½å¹³è¡¡</strong>ï¼šçº¿ç¨‹æ± å¯ä»¥å¹³è¡¡ä»»åŠ¡è´Ÿè½½ï¼Œç¡®ä¿çº¿ç¨‹çš„æœ‰æ•ˆåˆ©ç”¨ã€‚</li><li><strong>ä»»åŠ¡é˜Ÿåˆ—å’Œè°ƒåº¦</strong>ï¼šçº¿ç¨‹æ± æä¾›ä»»åŠ¡é˜Ÿåˆ—å’Œè°ƒåº¦åŠŸèƒ½ï¼Œå¯ä»¥æ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼ŒåŒæ—¶æä¾›å®šæ—¶æ‰§è¡Œå’Œå‘¨æœŸæ€§æ‰§è¡Œç­‰åŠŸèƒ½ã€‚</li></ol><hr><p>ä»è¿™ä¸ªå®šä¹‰ä¸­çœ‹ä¸€èˆ¬åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç›´æ¥ä½¿ç”¨çº¿ç¨‹æ˜¯åœ¨ç‰¹å®šè¡Œä¸ºçš„æƒ…å†µä¸‹ï¼ˆç›‘å¬çº¿ç¨‹ç­‰ï¼‰ï¼Œå…¶ä»–æƒ…å†µè€ƒè™‘èµ„æºæ¶ˆè€—å’Œçº¿ç¨‹ç®¡ç†ï¼Œå»ºè®®ä½¿ç”¨çº¿ç¨‹æ± ï¼ˆå°¤å…¶æ˜¯åœ¨æ‰§è¡Œå¤§é‡çŸ­æœŸå¼‚æ­¥ä»»åŠ¡æ—¶ï¼‰ã€‚</p><h4 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h4><p>çœ‹ä¸€ä¸‹ Java çº¿ç¨‹æ±  çš„ä¸€äº›åŸºæœ¬å®šä¹‰å’Œä»‹ç»ï¼š</p><p>Javaä¸­çš„çº¿ç¨‹æ± æ˜¯ä¸€ç§æ‰§è¡Œä»»åŠ¡çš„æ¡†æ¶ï¼Œå®ƒç”¨äºå‡å°‘åœ¨åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´å’Œèµ„æºã€‚çº¿ç¨‹æ± åœ¨æ‰§è¡Œå¤§é‡çŸ­æœŸå¼‚æ­¥ä»»åŠ¡æ—¶å°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥æ˜¾è‘—æé«˜ç¨‹åºæ€§èƒ½ã€‚åœ¨Javaä¸­ï¼Œçº¿ç¨‹æ± ä¸»è¦æ˜¯é€šè¿‡<code>java.util.concurrent</code>åŒ…ä¸­çš„<code>Executor</code>æ¡†æ¶å®ç°çš„ã€‚</p><p>çº¿ç¨‹æ± çš„å…³é”®æ¦‚å¿µ</p><ol><li><strong>çº¿ç¨‹æ± ï¼ˆThreadPoolï¼‰</strong>ï¼šçº¿ç¨‹æ± æ˜¯ä¸€ç»„å·¥ä½œçº¿ç¨‹ï¼Œå®ƒä»¬è´Ÿè´£ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–å¹¶æ‰§è¡Œä»»åŠ¡ã€‚</li><li><strong>ä»»åŠ¡ï¼ˆTaskï¼‰</strong>ï¼šæäº¤ç»™çº¿ç¨‹æ± çš„å·¥ä½œå•å…ƒï¼Œé€šå¸¸æ˜¯å®ç°äº†<code>Runnable</code>æˆ–<code>Callable</code>æ¥å£çš„å¯¹è±¡ã€‚</li><li><strong>Executoræ¡†æ¶</strong>ï¼šè¿™ä¸ªæ¡†æ¶æä¾›äº†ç®¡ç†çº¿ç¨‹æ± çš„å·¥å…·ï¼ŒåŒ…æ‹¬åˆ›å»ºçº¿ç¨‹æ± ã€æäº¤ä»»åŠ¡å’Œç®¡ç†çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸã€‚</li></ol><p><strong>çº¿ç¨‹æ± çš„ä¸»è¦ç±»å‹</strong></p><ol><li><strong>FixedThreadPool</strong>ï¼šæ‹¥æœ‰å›ºå®šæ•°é‡çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚å¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨å·¥ä½œï¼Œæ–°ä»»åŠ¡å°†åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚</li><li><strong>CachedThreadPool</strong>ï¼šä¸€ä¸ªå¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä½†å¦‚æœçº¿ç¨‹åœ¨ä¸€å®šæ—¶é—´å†…æœªä½¿ç”¨ï¼Œå°†è¢«å›æ”¶ã€‚</li><li><strong>SingleThreadExecutor</strong>ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå®ƒä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æäº¤çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li><li><strong>ScheduledThreadPool</strong>ï¼šä¸€ä¸ªèƒ½å¤Ÿå®‰æ’ä»»åŠ¡åœ¨ç»™å®šå»¶è¿Ÿåæ‰§è¡Œï¼Œæˆ–å®šæœŸæ‰§è¡Œçš„çº¿ç¨‹æ± ã€‚</li></ol><p><strong>ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„</strong></p><ol><li><strong>æé«˜èµ„æºåˆ©ç”¨ç‡</strong>ï¼šé€šè¿‡é‡ç”¨ç°æœ‰çº¿ç¨‹å‡å°‘çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ã€‚</li><li><strong>æé«˜å“åº”é€Ÿåº¦</strong>ï¼šä»»åŠ¡ä¸éœ€è¦ç­‰å¾…çº¿ç¨‹åˆ›å»ºå°±å¯ä»¥ç«‹å³æ‰§è¡Œã€‚</li><li><strong>æä¾›æ›´å¥½çš„çº¿ç¨‹ç®¡ç†</strong>ï¼šå¯ä»¥æ ¹æ®ç³»ç»Ÿçš„èµ„æºæƒ…å†µè°ƒæ•´çº¿ç¨‹æ± çš„å¤§å°ã€‚</li><li><strong>æä¾›ä»»åŠ¡é˜Ÿåˆ—å’Œæ‰§è¡Œç­–ç•¥</strong>ï¼šå¯ä»¥æ ¹æ®éœ€æ±‚ç®¡ç†å’Œä¼˜åŒ–ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºã€‚</li></ol><blockquote><p>å¦‚ä½•ä½¿ç”¨</p></blockquote><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨<code>ExecutorService</code>åˆ›å»ºå›ºå®šå¤§å°çº¿ç¨‹æ± çš„ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;<br><span class="hljs-keyword">import</span> java.util.concurrent.Executors;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolExample</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºæ‹¥æœ‰å›ºå®šæ•°é‡çº¿ç¨‹çš„çº¿ç¨‹æ± </span><br>        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">4</span>);<br><br>        <span class="hljs-comment">// æäº¤ä»»åŠ¡ç»™çº¿ç¨‹æ± </span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>();<br>            executor.execute(task);<br>        &#125;<br><br>        <span class="hljs-comment">// å…³é—­çº¿ç¨‹æ± </span><br>        executor.shutdown();<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-comment">// ä»»åŠ¡ä»£ç </span><br>            System.out.println(<span class="hljs-string">&quot;Executing task in &quot;</span> + Thread.currentThread().getName());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„äº‹é¡¹</p></blockquote><ul><li>åœ¨ä½¿ç”¨å®Œçº¿ç¨‹æ± åï¼Œåº”è¯¥è°ƒç”¨<code>shutdown()</code>æ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ï¼Œå¦åˆ™ç¨‹åºå¯èƒ½ä¸ä¼šç»ˆæ­¢ã€‚</li></ul><p>åº”å½“åˆç†é…ç½®çº¿ç¨‹æ± çš„å¤§å°ï¼Œè¿‡å¤§çš„çº¿ç¨‹æ± å¯èƒ½ä¼šæ¶ˆè€—è¿‡å¤šèµ„æºï¼Œè¿‡å°åˆ™æ— æ³•å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚</p><ul><li>åœ¨å¤„ç†IOå¯†é›†å‹ä»»åŠ¡æ—¶ï¼Œå¯ä»¥é…ç½®æ¯”CPUæ ¸å¿ƒæ•°æ›´å¤šçš„çº¿ç¨‹ï¼Œå› ä¸ºIOæ“ä½œä¸ä¼šä¸€ç›´å ç”¨CPUã€‚</li><li>ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼Œåº”è¯¥æ³¨æ„ä»»åŠ¡æäº¤å’Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸ï¼Œå¹¶åˆç†å¤„ç†è¿™äº›å¼‚å¸¸ã€‚</li><li>å¯¹äºå®šæ—¶æˆ–å‘¨æœŸæ€§ä»»åŠ¡ï¼Œ<code>ScheduledThreadPoolExecutor</code>æä¾›äº†çµæ´»çš„è°ƒåº¦é€‰é¡¹ã€‚</li></ul><p>æ€»ä¹‹ï¼Œçº¿ç¨‹æ± åœ¨Javaå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç»„ä»¶ï¼Œå®ƒä¸ä»…èƒ½æé«˜ç¨‹åºæ€§èƒ½ï¼Œè¿˜èƒ½æä¾›æ›´å¥½çš„èµ„æºç®¡ç†å’Œæ›´ç®€æ´çš„ç¼–ç¨‹æ¨¡å‹ã€‚æ­£ç¡®ä½¿ç”¨çº¿ç¨‹æ± å¯¹äºæ„å»ºé«˜æ•ˆã€ç¨³å®šä¸”å¯ä¼¸ç¼©çš„Javaåº”ç”¨è‡³å…³é‡è¦ã€‚</p><p>è¿™ä¸ªä¾‹å­æ„Ÿè§‰å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œè¿™é‡Œæ˜¯ä½¿ç”¨ Executors å·¥å…·ç±»æ¥è¿›è¡Œåˆ›å»ºçš„ä¸€ä¸ªçº¿ç¨‹æ± å†…éƒ¨ç±»ã€‚</p><p>åœ¨ JavaGuide ä¸­æåŠåˆ°ï¼Œé˜¿é‡Œæ˜¯å»ºè®®å¤§å®¶éƒ½ä½¿ç”¨  <strong>é€šè¿‡<code>ThreadPoolExecutor</code>æ„é€ å‡½æ•°æ¥åˆ›å»º</strong> çº¿ç¨‹æ± ï¼Œä½¿ç”¨å·¥å…·ç±» Executors æ¥åˆ›å»ºçš„è¯ï¼Œå®¹æ˜“é€ æˆèµ„æºè€—æ—¶ï¼ˆå¦‚æœä½¿ç”¨ä¸å½“ï¼‰ã€‚</p><p>è¿™é‡Œçš„ ThreadPool å’Œ Task ä¸ç”¨å¤ªè¿‡äºç†è§£ï¼Œä½ å¯ä»¥è¾…åŠ©å»ç†è§£  Executor æ¡†æ¶çš„ä¸€ä¸ªè¿è¡Œï¼Œé€šè¿‡å®ƒå»å¼•ç”³ä¸€äº›å†…å®¹ï¼Œä»è€Œå¯¹æ•´ä¸ªçº¿ç¨‹æ± çš„å†…å®¹æœ‰æ›´å¥½çš„ä½¿ç”¨å’Œç†è§£ã€‚</p><p>å› æ­¤è¿™ä¸€ç¯‡æ–‡ç« çš„å†…å®¹ç¬¬ä¸€ç« èŠ‚çš„å†…å®¹å¯ä»¥è·³è¿‡çœ‹ï¼Œå¹¶æ²¡æœ‰å¤ªé‡è¦ã€‚</p><p>æ‰©å±•çš„ä¸€äº›å†…å®¹æ¦‚å¿µï¼š</p><h4 id="ThreadPool"><a href="#ThreadPool" class="headerlink" title="ThreadPool"></a>ThreadPool</h4><p><code>ThreadPool</code>ï¼ˆçº¿ç¨‹æ± ï¼‰åœ¨Javaä¸­æ˜¯é€šè¿‡<code>java.util.concurrent</code>åŒ…ä¸­çš„<code>Executor</code>æ¡†æ¶å®ç°çš„ã€‚</p><p>å†ä»‹ç»ä¸€äº›åŸºæœ¬æ¦‚å¿µ</p><ol><li><strong>Executorå’ŒExecutorService</strong>ï¼š<ul><li><code>Executor</code>æ˜¯åŸºç¡€çš„æ¥å£ï¼Œå®ƒæä¾›äº†æäº¤ä»»åŠ¡çš„æ–¹æ³•ã€‚</li><li><code>ExecutorService</code>æ˜¯æ›´å®Œæ•´çš„æ¥å£ï¼Œå®ƒç»§æ‰¿è‡ª<code>Executor</code>ï¼Œæä¾›äº†æ›´å¤æ‚çš„åŠŸèƒ½ï¼Œå¦‚ç®¡ç†çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸã€‚</li></ul></li><li><strong>ä»»åŠ¡ç±»å‹</strong>ï¼š<ul><li><code>Runnable</code>ï¼šä¸€ä¸ªä¸è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</li><li><code>Callable</code>ï¼šä¸€ä¸ªå¯ä»¥è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</li></ul></li></ol><p><code>ThreadPool</code>çš„ä¸€äº›åŸºæœ¬ç”¨æ³•ï¼š</p><ol><li><strong>åˆ›å»ºçº¿ç¨‹æ± </strong>ï¼š<ul><li>ä½ å¯ä»¥ä½¿ç”¨<code>Executors</code>ç±»ä¸­çš„é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»ºä¸åŒç±»å‹çš„çº¿ç¨‹æ± ï¼Œå¦‚<code>newFixedThreadPool</code>ã€<code>newCachedThreadPool</code>ã€<code>newSingleThreadExecutor</code>ç­‰ã€‚</li></ul></li><li><strong>æäº¤ä»»åŠ¡</strong>ï¼š<ul><li>ä½¿ç”¨<code>execute(Runnable)</code>æ–¹æ³•æäº¤ä¸è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</li><li>ä½¿ç”¨<code>submit(Callable)</code>æˆ–<code>submit(Runnable)</code>æ–¹æ³•æäº¤è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</li></ul></li><li><strong>å…³é—­çº¿ç¨‹æ± </strong>ï¼š<ul><li>ä½¿ç”¨<code>shutdown()</code>æ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ã€‚è¿™ä¸ªæ–¹æ³•ä¸ä¼šç«‹å³å…³é—­çº¿ç¨‹æ± ï¼Œè€Œæ˜¯ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œç­‰å¾…æ‰€æœ‰å·²æäº¤çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå…³é—­ã€‚</li><li>å¦‚æœéœ€è¦ç«‹å³å…³é—­çº¿ç¨‹æ± ï¼Œå¯ä»¥ä½¿ç”¨<code>shutdownNow()</code>ï¼Œä½†è¿™ä¼šå°è¯•åœæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚</li></ul></li></ol><h4 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h4><p><code>Task</code>æ˜¯ä¸€ä¸ªç”¨äºæ‰§è¡Œå…·æœ‰è¿”å›å€¼çš„å¼‚æ­¥è®¡ç®—çš„æŠ½è±¡æ¦‚å¿µã€‚</p><p>åœ¨çº¿ç¨‹æ± è¿™é‡Œä¸»è¦æ˜¯è¦å¼•å…¥<code>java.util.concurrent</code>åŒ…ä¸­çš„<code>Callable</code>æ¥å£ä¸<code>Future</code>ç±»ï¼›</p><p>ä»–ä»¬ä¸¤ä¸ªçš„ä½¿ç”¨ä»£è¡¨ç€<code>Task</code>çš„æ ¸å¿ƒæ¦‚å¿µã€‚</p><h5 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h5><p><code>Callable</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸<code>Runnable</code>ç›¸ä¼¼ï¼Œä½†å®ƒå¯ä»¥è¿”å›ä¸€ä¸ªç»“æœï¼Œå¹¶èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚<code>Callable</code>é€šå¸¸ç”¨äºé‚£äº›éœ€è¦è¿”å›ç»“æœçš„ä»»åŠ¡ã€‚</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">Callable&lt;Integer&gt; task = <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span> &#123;<br>    <span class="hljs-regexp">//</span> æ‰§è¡Œä¸€äº›è®¡ç®—<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">123</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><h5 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h5><p>å½“ä½ æäº¤ä¸€ä¸ª<code>Callable</code>ä»»åŠ¡ç»™çº¿ç¨‹æ± æ‰§è¡Œæ—¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ª<code>Future</code>å¯¹è±¡ã€‚</p><p><code>Future</code>ä»£è¡¨äº†å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼Œå®ƒæä¾›äº†æ£€æŸ¥è®¡ç®—æ˜¯å¦å®Œæˆçš„æ–¹æ³•ï¼Œå¹¶ä¸”èƒ½å¤Ÿè·å–è®¡ç®—çš„ç»“æœã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ExecutorService executor <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">1</span>)<span class="hljs-comment">;</span><br>Future&lt;Integer&gt; future <span class="hljs-operator">=</span> executor.submit(task)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>å…·ä½“å¯ä»¥çœ‹ä¸€ä¸‹å®é™…ä½¿ç”¨ï¼Œèƒ½å¤Ÿå¯¹è¿™ä¸¤ä¸ªæ¦‚å¿µæœ‰æ¯”è¾ƒæ˜ç¡®çš„ç†è§£ã€‚</p><p>Executor æ¡†æ¶ çš„å†…å®¹å¯ä»¥çœ‹ä¸‹ä¸€ç« èŠ‚çš„å†…å®¹ã€‚</p><h3 id="2ã€Executor-æ¡†æ¶ä»‹ç»"><a href="#2ã€Executor-æ¡†æ¶ä»‹ç»" class="headerlink" title="2ã€Executor æ¡†æ¶ä»‹ç»"></a>2ã€Executor æ¡†æ¶ä»‹ç»</h3><p>åœ¨Javaä¸­ï¼Œçº¿ç¨‹æ± ä¸»è¦æ˜¯é€šè¿‡<code>java.util.concurrent</code>åŒ…ä¸­çš„<code>Executor</code>æ¡†æ¶å®ç°çš„ã€‚</p><h4 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><p>è¿™ä¸ªæ¡†æ¶çš„ä½œç”¨å°±æ˜¯ç®€åŒ–å¹¶å‘ç¼–ç¨‹ï¼Œæä¾›äº†çº¿ç¨‹æ± çš„å®ç°ã€‚</p><p>ä»‹ç»ï¼š</p><p>åœ¨Javaä¸­ï¼Œ<code>Executor</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒä»£è¡¨äº†æ‰§è¡Œæä¾›çš„ä»»åŠ¡çš„å¯¹è±¡ã€‚å®ƒæ˜¯<code>java.util.concurrent</code>åŒ…ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæä¾›ä¸€ç§å°†ä»»åŠ¡çš„æäº¤ä¸æ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼åˆ†ç¦»çš„æœºåˆ¶ã€‚</p><p>åœ¨ JavaGuide æåŠåˆ° Executor æ¡†æ¶èƒ½å¤Ÿé¿å… this é€ƒåŒ¿ï¼Œç›®å‰ä¸æ˜¯å¤ªäº†è§£è¿™ä¸ªæ¦‚å¿µï¼Œæœ‰å…´è¶£å¯ä»¥äº†è§£ä¸‹ã€‚</p><blockquote><p><code>Executor</code> æ¡†æ¶æ˜¯ Java5 ä¹‹åå¼•è¿›çš„ï¼Œåœ¨ Java 5 ä¹‹åï¼Œé€šè¿‡ <code>Executor</code> æ¥å¯åŠ¨çº¿ç¨‹æ¯”ä½¿ç”¨ <code>Thread</code> çš„ <code>start</code> æ–¹æ³•æ›´å¥½ï¼Œé™¤äº†æ›´æ˜“ç®¡ç†ï¼Œæ•ˆç‡æ›´å¥½ï¼ˆç”¨çº¿ç¨‹æ± å®ç°ï¼ŒèŠ‚çº¦å¼€é”€ï¼‰å¤–ï¼Œè¿˜æœ‰å…³é”®çš„ä¸€ç‚¹ï¼šæœ‰åŠ©äºé¿å… this é€ƒé€¸é—®é¢˜ã€‚</p></blockquote><blockquote><p>this é€ƒé€¸æ˜¯æŒ‡åœ¨æ„é€ å‡½æ•°è¿”å›ä¹‹å‰å…¶ä»–çº¿ç¨‹å°±æŒæœ‰è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œè°ƒç”¨å°šæœªæ„é€ å®Œå…¨çš„å¯¹è±¡çš„æ–¹æ³•å¯èƒ½å¼•å‘ä»¤äººç–‘æƒ‘çš„é”™è¯¯ã€‚</p></blockquote><p><strong>ä¸‹é¢è¿™ä¸ªæ˜¯æ¯”è¾ƒé‡ç‚¹çš„ä¸€ä¸ªå†…å®¹</strong>ï¼Œå¯ä»¥é‡ç‚¹çœ‹ä¸€ä¸‹ï¼ˆç›´æ¥å¼•å…¥äº†JavaGuide çš„ä¸€äº›å†…å®¹è¿›è¡Œé˜è¿°ï¼‰</p><p> Executor æ¡†æ¶ ä¸‰å¤§éƒ¨åˆ†ç»„æˆ</p><ul><li><strong>ä»»åŠ¡(<code>Runnable</code>Â &#x2F;<code>Callable</code>)</strong><ul><li>æ‰§è¡Œä»»åŠ¡éœ€è¦å®ç°çš„ <strong><code>Runnable</code> æ¥å£</strong> æˆ– <strong><code>Callable</code>æ¥å£</strong>ã€‚</li><li><strong><code>Runnable</code> æ¥å£</strong>æˆ– <strong><code>Callable</code> æ¥å£</strong> å®ç°ç±»éƒ½å¯ä»¥è¢« <strong><code>ThreadPoolExecutor</code></strong> æˆ– <strong><code>ScheduledThreadPoolExecutor</code></strong> æ‰§è¡Œã€‚</li></ul></li><li><strong>ä»»åŠ¡çš„æ‰§è¡Œ(<code>Executor</code>)</strong></li><li><strong>å¼‚æ­¥è®¡ç®—çš„ç»“æœ(<code>Future</code>)</strong><ul><li><strong><code>Future</code></strong> æ¥å£ä»¥åŠ <code>Future</code> æ¥å£çš„å®ç°ç±» <strong><code>FutureTask</code></strong> ç±»éƒ½å¯ä»¥ä»£è¡¨å¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚</li><li>å½“æˆ‘ä»¬æŠŠ <strong><code>Runnable</code>æ¥å£</strong> æˆ– <strong><code>Callable</code> æ¥å£</strong> çš„å®ç°ç±»æäº¤ç»™ <strong><code>ThreadPoolExecutor</code></strong> æˆ– <strong><code>ScheduledThreadPoolExecutor</code></strong> æ‰§è¡Œã€‚ï¼ˆè°ƒç”¨ <code>submit()</code> æ–¹æ³•æ—¶ä¼šè¿”å›ä¸€ä¸ª <strong><code>FutureTask</code></strong> å¯¹è±¡ï¼‰</li></ul></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401160931282.png" alt="image.png"></p><blockquote><p><strong>ä»»åŠ¡çš„æ‰§è¡Œ(<code>Executor</code>)</strong></p></blockquote><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒ…æ‹¬ä»»åŠ¡æ‰§è¡Œæœºåˆ¶çš„æ ¸å¿ƒæ¥å£ <strong><code>Executor</code></strong> ï¼Œä»¥åŠç»§æ‰¿è‡ª <code>Executor</code> æ¥å£çš„ <code>ExecutorService</code> æ¥å£ã€‚</p><p><code>ThreadPoolExecutor</code> å’Œ <strong><code>ScheduledThreadPoolExecutor</code></strong> è¿™ä¸¤ä¸ªå…³é”®ç±»å®ç°äº† <strong><code>ExecutorService</code></strong> æ¥å£</p><p>å…¶ä¸­æˆ‘ä»¬å¯ä»¥å°†æ›´å¤šçš„ä¸€ä¸ªæ³¨æ„åŠ›æ”¾åœ¨ <code>ThreadPoolExecutor</code> è¿™ä¸ªç±»ä¸­ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231219213228.png" alt="image.png"></p><h4 id="Executoræ¡†æ¶ä½¿ç”¨æµç¨‹"><a href="#Executoræ¡†æ¶ä½¿ç”¨æµç¨‹" class="headerlink" title="Executoræ¡†æ¶ä½¿ç”¨æµç¨‹"></a><code>Executor</code>æ¡†æ¶ä½¿ç”¨æµç¨‹</h4><p>ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><blockquote><ol><li>åˆ›å»ºä»»åŠ¡å¯¹è±¡</li></ol></blockquote><p>é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ã€‚è¿™å¯ä»¥æ˜¯å®ç°äº†<code>Runnable</code>æ¥å£çš„ç±»ï¼Œæˆ–è€…æ˜¯å®ç°äº†<code>Callable</code>æ¥å£çš„ç±»ã€‚<code>Runnable</code>å’Œ<code>Callable</code>çš„åŒºåˆ«åœ¨äºï¼š</p><ul><li><strong>Runnable</strong>ï¼šä¸è¿”å›ç»“æœï¼Œä¹Ÿä¸èƒ½æŠ›å‡ºç»è¿‡æ£€æŸ¥çš„å¼‚å¸¸ã€‚</li><li><strong>Callable</strong>ï¼šå¯ä»¥è¿”å›ç»“æœï¼Œå¹¶ä¸”èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">Runnable runnableTask = <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span> &#123;<br>    <span class="hljs-regexp">//</span> æ‰§è¡Œä¸€äº›æ“ä½œ<br>&#125;;<br><br>Callable&lt;<span class="hljs-built_in">String</span>&gt; callableTask = <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span> &#123;<br>    <span class="hljs-regexp">//</span> æ‰§è¡Œä¸€äº›æ“ä½œï¼Œå¹¶è¿”å›ç»“æœ<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Result&quot;</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><ol start="2"><li>åˆ›å»ºExecutorServiceå¹¶æäº¤ä»»åŠ¡</li></ol></blockquote><p>ç„¶åï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ª<code>ExecutorService</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹æ± æœåŠ¡ï¼Œç”¨äºç®¡ç†å’Œæ‰§è¡Œä»»åŠ¡ã€‚æ‚¨å¯ä»¥é€šè¿‡<code>Executors</code>å·¥å…·ç±»åˆ›å»ºä¸åŒç±»å‹çš„<code>ExecutorService</code>ï¼ˆä¸æ¨èï¼‰ã€‚</p><p>æäº¤ä»»åŠ¡æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>execute(Runnable command) ï¼šç”¨äºæäº¤ä¸éœ€è¦è¿”å›ç»“æœçš„<code>Runnable</code>ä»»åŠ¡ã€‚</li><li><strong>submit(Runnable task)</strong> æˆ– submit(Callable&lt; T &gt; task) ï¼šç”¨äºæäº¤<code>Runnable</code>æˆ–<code>Callable</code>ä»»åŠ¡ã€‚è¿™å°†è¿”å›ä¸€ä¸ª<code>Future</code>å¯¹è±¡ï¼Œæ‚¨å¯ä»¥ç”¨å®ƒæ¥æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œå¹¶è·å–<code>Callable</code>ä»»åŠ¡çš„ç»“æœã€‚</li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ExecutorService executorService <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">4</span>)<span class="hljs-comment">;</span><br><br>// ä½¿ç”¨executeæ–¹æ³•æäº¤Runnableä»»åŠ¡<br>executorService.execute(runnableTask)<span class="hljs-comment">;</span><br><br>// ä½¿ç”¨submitæ–¹æ³•æäº¤Callableä»»åŠ¡ï¼Œå¹¶è·å–Futureå¯¹è±¡<br>Future&lt;String&gt; future <span class="hljs-operator">=</span> executorService.submit(callableTask)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><blockquote><ol start="3"><li>è·å–ä»»åŠ¡ç»“æœ</li></ol></blockquote><p>å¦‚æœæ‚¨æäº¤çš„æ˜¯<code>Callable</code>ä»»åŠ¡å¹¶ä½¿ç”¨äº†<code>submit</code>æ–¹æ³•ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ª<code>Future</code>å¯¹è±¡ã€‚æ‚¨å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡è·å–ä»»åŠ¡çš„ç»“æœï¼š</p><ul><li><strong>get()æ–¹æ³•</strong>ï¼šè°ƒç”¨<code>get()</code>ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°ä»»åŠ¡å®Œæˆï¼Œå¹¶è¿”å›ç»“æœã€‚</li><li>cancel(boolean mayInterruptIfRunning)ï¼šå¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œã€‚</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-built_in">String</span> result = future.<span class="hljs-keyword">get</span>(); <span class="hljs-comment">// ç­‰å¾…ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ</span><br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException | ExecutionException e) &#123;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ol start="4"><li>å…³é—­ExecutorService</li></ol></blockquote><p>æœ€åï¼Œå½“æ‚¨ä¸å†éœ€è¦çº¿ç¨‹æ± æ—¶ï¼Œåº”è¯¥å…³é—­<code>ExecutorService</code>ã€‚è¿™å¯ä»¥é˜²æ­¢æ–°ä»»åŠ¡è¢«æäº¤ï¼Œå¹¶å…è®¸å·²æäº¤çš„ä»»åŠ¡å®Œæˆã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">executorService.shutdown()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><blockquote><p>æ€»ç»“</p></blockquote><p>ä½¿ç”¨<code>Executor</code>æ¡†æ¶çš„æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»ºå®ç°<code>Runnable</code>æˆ–<code>Callable</code>æ¥å£çš„ä»»åŠ¡å¯¹è±¡ã€‚</li><li>åˆ›å»º<code>ExecutorService</code>å¹¶é€šè¿‡<code>execute</code>æˆ–<code>submit</code>æäº¤ä»»åŠ¡ã€‚</li><li>ï¼ˆå¯é€‰ï¼‰å¦‚æœä½¿ç”¨äº†<code>submit</code>æäº¤<code>Callable</code>ä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡è¿”å›çš„<code>Future</code>å¯¹è±¡è·å–ç»“æœã€‚</li><li>å…³é—­<code>ExecutorService</code>ã€‚</li></ol><p>è¿™ç§æ–¹å¼çš„å¥½å¤„åœ¨äºå®ƒæä¾›äº†ä¸€ç§çµæ´»ä¸”å¼ºå¤§çš„æœºåˆ¶æ¥ç®¡ç†çº¿ç¨‹å’Œæ‰§è¡Œå¹¶å‘ä»»åŠ¡ï¼ŒåŒæ—¶ä¹Ÿç®€åŒ–äº†çº¿ç¨‹çš„ä½¿ç”¨å’Œèµ„æºç®¡ç†ã€‚</p><p>é€šè¿‡ä½¿ç”¨çº¿ç¨‹æ± ï¼Œå¯ä»¥é¿å…åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ï¼Œä»è€Œæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p><h4 id="æ‰©å……æ¦‚å¿µ"><a href="#æ‰©å……æ¦‚å¿µ" class="headerlink" title="æ‰©å……æ¦‚å¿µ"></a>æ‰©å……æ¦‚å¿µ</h4><h5 id="Executors"><a href="#Executors" class="headerlink" title="Executors"></a>Executors</h5><ol><li><strong>Executoræ¥å£</strong>ï¼š<ul><li><code>Executor</code>æ¥å£å®šä¹‰äº†ä¸€ä¸ª<code>execute(Runnable command)</code>æ–¹æ³•ï¼Œç”¨äºåœ¨æœªæ¥æŸä¸ªæ—¶é—´æ‰§è¡Œç»™å®šçš„å‘½ä»¤ï¼ˆä»»åŠ¡ï¼‰ã€‚</li></ul></li><li><strong>ExecutorServiceæ¥å£</strong>ï¼š<ul><li><code>ExecutorService</code>æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„æ¥å£ï¼Œç»§æ‰¿è‡ª<code>Executor</code>ã€‚å®ƒæä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚ä»»åŠ¡æäº¤ã€å…³é—­çº¿ç¨‹æ± ã€è·Ÿè¸ªä»»åŠ¡çš„å®Œæˆç­‰ã€‚</li></ul></li><li><strong>Executorså·¥å…·ç±»</strong>ï¼š<ul><li><code>Executors</code>æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œæä¾›äº†ç”¨äºåˆ›å»ºä¸åŒç±»å‹çº¿ç¨‹æ± çš„å·¥å‚æ–¹æ³•ã€‚</li></ul></li></ol><h5 id="çº¿ç¨‹æ± ç±»å‹"><a href="#çº¿ç¨‹æ± ç±»å‹" class="headerlink" title="çº¿ç¨‹æ± ç±»å‹"></a>çº¿ç¨‹æ± ç±»å‹</h5><ol><li><strong>FixedThreadPool</strong>ï¼š<ul><li>åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚å½“æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨æ´»åŠ¨æ—¶ï¼Œæ–°ä»»åŠ¡å°†åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚</li></ul></li><li><strong>CachedThreadPool</strong>ï¼š<ul><li>åˆ›å»ºä¸€ä¸ªå¯æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚å¦‚æœçº¿ç¨‹åœ¨ä¸€å®šæ—¶é—´å†…ç©ºé—²ï¼Œåˆ™ä¼šè¢«å›æ”¶ã€‚</li></ul></li><li><strong>SingleThreadExecutor</strong>ï¼š<ul><li>åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„æ‰§è¡Œå™¨ï¼Œå®ƒç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œç¡®ä¿æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æäº¤é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li></ul></li><li><strong>ScheduledThreadPool</strong>ï¼š<ul><li>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒå¯ä»¥å®‰æ’å‘½ä»¤åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œï¼Œæˆ–è€…å®šæœŸæ‰§è¡Œã€‚</li></ul></li></ol><p>è¿™ç§ç±»å‹è®°å¿†å†…å®¹å»ºè®®ä½¿ç”¨æ€ç»´å¯¼å›¾ + å°é»„é¸­çš„æ–¹å¼è®°å¿†ï¼Œå¹¶ä¸”å®šæœŸå›é¡¾ã€‚</p><h3 id="3ã€ThreadPoolExecutor-ç±»ä½¿ç”¨-â˜…"><a href="#3ã€ThreadPoolExecutor-ç±»ä½¿ç”¨-â˜…" class="headerlink" title="3ã€ThreadPoolExecutor ç±»ä½¿ç”¨ â˜…"></a>3ã€ThreadPoolExecutor ç±»ä½¿ç”¨ â˜…</h3><p>çº¿ç¨‹æ± å®ç°ç±»Â <code>ThreadPoolExecutor</code>Â æ˜¯Â <code>Executor</code>Â æ¡†æ¶æœ€æ ¸å¿ƒçš„ç±»ã€‚</p><h4 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h4><p><code>ThreadPoolExecutor</code> ç±»ä¸­æä¾›çš„å››ä¸ªæ„é€ æ–¹æ³•ã€‚æˆ‘ä»¬æ¥çœ‹æœ€é•¿çš„é‚£ä¸ªï¼Œå…¶ä½™ä¸‰ä¸ªéƒ½æ˜¯åœ¨è¿™ä¸ªæ„é€ æ–¹æ³•çš„åŸºç¡€ä¸Šäº§ç”Ÿã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* ç”¨ç»™å®šçš„åˆå§‹å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ThreadPoolExecutorã€‚</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> ThreadPoolExecutor(int corePoolSize,     <span class="hljs-comment">//çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡</span><br>                          int maximumPoolSize,  <span class="hljs-comment">//çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°</span><br>                          long keepAliveTime,   <span class="hljs-comment">//å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹å­˜æ´»çš„æœ€é•¿æ—¶é—´</span><br>                          TimeUnit unit,        <span class="hljs-comment">//æ—¶é—´å•ä½</span><br>                          BlockingQueue&lt;Runnable&gt; workQueue, <span class="hljs-comment">//ä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨æ¥å‚¨å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ—</span><br>                          ThreadFactory threadFactory,       <span class="hljs-comment">//çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯</span><br>                          RejectedExecutionHandler handler  <span class="hljs-comment">//æ‹’ç»ç­–ç•¥ï¼Œå½“æäº¤çš„ä»»åŠ¡è¿‡å¤šè€Œä¸èƒ½åŠæ—¶å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡</span><br>  )&#123;<br>    <span class="hljs-comment">// å‚æ•°æ£€æŸ¥ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ä¸èƒ½å°äº0ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸èƒ½å°äºæˆ–ç­‰äº0ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸èƒ½å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼ŒkeepAliveTimeä¸èƒ½å°äº0</span><br>    <span class="hljs-keyword">if</span> (corePoolSize &lt; <span class="hljs-number">0</span> ||<br>        maximumPoolSize &lt;= <span class="hljs-number">0</span> ||<br>        maximumPoolSize &lt; corePoolSize ||<br>        keepAliveTime &lt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">throw</span> new IllegalArgumentException();<br><br>    <span class="hljs-comment">// å‚æ•°æ£€æŸ¥ï¼šå·¥ä½œé˜Ÿåˆ—ã€çº¿ç¨‹å·¥å‚å’Œæ‹’ç»ç­–ç•¥ä¸èƒ½ä¸ºnull</span><br>    <span class="hljs-keyword">if</span> (workQueue == <span class="hljs-literal">null</span> || threadFactory == <span class="hljs-literal">null</span> || handler == <span class="hljs-literal">null</span>)<br>        <span class="hljs-keyword">throw</span> new NullPointerException();<br><br>    <span class="hljs-comment">// è·å–å®‰å…¨ç®¡ç†å™¨çš„ä¸Šä¸‹æ–‡ï¼Œè¿™æ˜¯Javaå®‰å…¨æ¨¡å‹çš„ä¸€éƒ¨åˆ†</span><br>    <span class="hljs-keyword">this</span>.acc = System.getSecurityManager() == <span class="hljs-literal">null</span> ?<br>            <span class="hljs-literal">null</span> :<br>            AccessController.getContext();<br><br>    <span class="hljs-comment">// è®¾ç½®çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°</span><br>    <span class="hljs-keyword">this</span>.corePoolSize = corePoolSize;<br><br>    <span class="hljs-comment">// è®¾ç½®çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°</span><br>    <span class="hljs-keyword">this</span>.maximumPoolSize = maximumPoolSize;<br><br>    <span class="hljs-comment">// è®¾ç½®å·¥ä½œé˜Ÿåˆ—</span><br>    <span class="hljs-keyword">this</span>.workQueue = workQueue;<br><br>    <span class="hljs-comment">// è®¾ç½®çº¿ç¨‹ä¿æŒæ´»åŠ¨çš„æ—¶é—´ï¼Œå•ä½è½¬æ¢ä¸ºçº³ç§’</span><br>    <span class="hljs-keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);<br><br>    <span class="hljs-comment">// è®¾ç½®çº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºæ–°çº¿ç¨‹</span><br>    <span class="hljs-keyword">this</span>.threadFactory = threadFactory;<br><br>    <span class="hljs-comment">// è®¾ç½®æ‹’ç»ç­–ç•¥ï¼Œå½“çº¿ç¨‹æ± ä¸èƒ½æ¥å—ä»»åŠ¡æ—¶ä½¿ç”¨</span><br>    <span class="hljs-keyword">this</span>.handler = handler;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><p><strong><code>ThreadPoolExecutor</code> 3 ä¸ªæœ€é‡è¦çš„å‚æ•°ï¼š</strong></p><ul><li><strong><code>corePoolSize</code> :</strong> ä»»åŠ¡é˜Ÿåˆ—æœªè¾¾åˆ°é˜Ÿåˆ—å®¹é‡æ—¶ï¼Œæœ€å¤§å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ã€‚</li><li><strong><code>maximumPoolSize</code> :</strong> ä»»åŠ¡é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡è¾¾åˆ°é˜Ÿåˆ—å®¹é‡çš„æ—¶å€™ï¼Œå½“å‰å¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡å˜ä¸ºæœ€å¤§çº¿ç¨‹æ•°ã€‚</li><li><strong><code>workQueue</code>:</strong> æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœè¾¾åˆ°çš„è¯ï¼Œæ–°ä»»åŠ¡å°±ä¼šè¢«å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ã€‚</li></ul><p><code>ThreadPoolExecutor</code>å…¶ä»–å¸¸è§å‚æ•° :</p><ul><li><strong><code>keepAliveTime</code></strong>:çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº <code>corePoolSize</code> çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† <code>keepAliveTime</code>æ‰ä¼šè¢«å›æ”¶é”€æ¯ã€‚</li><li><strong><code>unit</code></strong> : <code>keepAliveTime</code> å‚æ•°çš„æ—¶é—´å•ä½ã€‚</li><li><strong><code>threadFactory</code></strong> :executor åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</li><li><strong><code>handler</code></strong> :é¥±å’Œç­–ç•¥ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240116002651.png" alt="image.png"></p><h5 id="é¥±å’Œç­–ç•¥"><a href="#é¥±å’Œç­–ç•¥" class="headerlink" title="é¥±å’Œç­–ç•¥"></a>é¥±å’Œç­–ç•¥</h5><p><code>ThreadPoolExecutor</code>çš„é¥±å’Œç­–ç•¥ï¼ˆRejectedExecutionHandlerï¼‰æ˜¯ä¸€ç§ç”¨äºå¤„ç†åœ¨ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ä¸”å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°é‡æ—¶æäº¤çš„æ–°ä»»åŠ¡çš„æœºåˆ¶ã€‚</p><p>è¿™äº›ç­–ç•¥å†³å®šäº†çº¿ç¨‹æ± åœ¨é¥±å’ŒçŠ¶æ€ä¸‹å¦‚ä½•å“åº”æ–°æäº¤çš„ä»»åŠ¡ã€‚ä¸‹é¢æ˜¯<code>ThreadPoolExecutor</code>ä¸­å¸¸ç”¨çš„å‡ ç§é¥±å’Œç­–ç•¥ï¼š</p><ul><li><ol><li>AbortPolicy</li></ol><ul><li>è¿™æ˜¯é»˜è®¤çš„é¥±å’Œç­–ç•¥ã€‚å½“çº¿ç¨‹æ± å’Œé˜Ÿåˆ—éƒ½æ»¡æ—¶ï¼Œæ–°æäº¤çš„ä»»åŠ¡å°†è¢«æ‹’ç»ï¼Œå¹¶æŠ›å‡º<code>RejectedExecutionException</code>å¼‚å¸¸ã€‚è¿™ç§ç­–ç•¥ç›´æ¥åé¦ˆæ‰§è¡Œå¤±è´¥ï¼Œé€‚ç”¨äºé‚£äº›å¸Œæœ›ç«‹å³çŸ¥é“ä»»åŠ¡æ— æ³•æ‰§è¡Œçš„åœºæ™¯ã€‚</li></ul></li><li><ol start="2"><li>CallerRunsPolicy</li></ol><ul><li>åœ¨è¿™ç§ç­–ç•¥ä¸‹ï¼Œå¦‚æœçº¿ç¨‹æ± é¥±å’Œï¼Œé‚£ä¹ˆæäº¤ä»»åŠ¡çš„çº¿ç¨‹è‡ªå·±ä¼šæ‰§è¡Œè¯¥ä»»åŠ¡ã€‚è¿™æ„å‘³ç€ä»»åŠ¡å°†åœ¨<code>execute</code>æ–¹æ³•çš„è°ƒç”¨çº¿ç¨‹ä¸­è¿è¡Œã€‚è¿™ç§ç­–ç•¥ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†å¯èƒ½ä¼šé™ä½æ–°ä»»åŠ¡çš„æäº¤é€Ÿåº¦ï¼Œä»è€Œå½±å“æ•´ä½“æ€§èƒ½ã€‚è¿™é€‚ç”¨äºå¸Œæœ›ç¡®ä¿æ‰€æœ‰ä»»åŠ¡éƒ½è¢«æ‰§è¡Œçš„åœºæ™¯ï¼Œå³ä½¿è¿™å¯èƒ½å¯¼è‡´åŸå§‹ä»»åŠ¡æäº¤çº¿ç¨‹çš„æ€§èƒ½ä¸‹é™ã€‚</li></ul></li><li><ol start="3"><li>DiscardPolicy</li></ol><ul><li>æ­¤ç­–ç•¥å°†é™é»˜ä¸¢å¼ƒè¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œä¸æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿä¸æä¾›ä»»ä½•è­¦å‘Šã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä»»åŠ¡çš„ä¸¢å¤±ï¼Œå› æ­¤ä½¿ç”¨è¿™ç§ç­–ç•¥æ—¶éœ€è¦å°å¿ƒã€‚</li></ul></li><li><ol start="4"><li>DiscardOldestPolicy</li></ol><ul><li>å½“çº¿ç¨‹æ± é¥±å’Œæ—¶ï¼Œè¿™ç§ç­–ç•¥å°†ä¸¢å¼ƒæœ€æ—©æäº¤ä½†å°šæœªå¤„ç†çš„ä»»åŠ¡ï¼Œç„¶åå°è¯•é‡æ–°æäº¤æ–°çš„ä»»åŠ¡ã€‚è¿™ç§ç­–ç•¥é€‚ç”¨äºé‚£äº›å¯ä»¥æ¥å—å¤„ç†æœ€æ–°ä»»åŠ¡ä¸ºä¼˜å…ˆçš„åœºæ™¯</li></ul></li></ul><p>ä½¿ç”¨è¯´æ˜ï¼š</p><p>å½“ä½¿ç”¨Springçš„<code>ThreadPoolTaskExecutor</code>æˆ–ç›´æ¥æ„é€ <code>ThreadPoolExecutor</code>æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š<code>RejectedExecutionHandler</code>ï¼Œåˆ™é»˜è®¤ä½¿ç”¨<code>AbortPolicy</code>ã€‚è¿™æ„å‘³ç€å½“çº¿ç¨‹æ± é¥±å’Œæ—¶ï¼Œæ–°ä»»åŠ¡å°†è¢«æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚å¯¹äºéœ€è¦å¯ä¼¸ç¼©æ€§çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<code>CallerRunsPolicy</code>ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿä¿è¯ä»»åŠ¡è¢«æ‰§è¡Œï¼Œå°½ç®¡è¿™å¯èƒ½ä¼šé™ä½ä»»åŠ¡æäº¤çš„é€Ÿåº¦ã€‚</p><p>åœ¨é€‰æ‹©é¥±å’Œç­–ç•¥æ—¶ï¼Œéœ€è¦è€ƒè™‘åº”ç”¨ç¨‹åºçš„ç‰¹å®šéœ€æ±‚å’Œè¡Œä¸ºã€‚</p><p>æ¯”å¦‚ï¼Œå¯¹äºé‚£äº›ä¸èƒ½ä¸¢å¤±ä»»ä½•ä»»åŠ¡çš„åº”ç”¨ï¼Œ<code>CallerRunsPolicy</code>å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è€Œå¯¹äºé‚£äº›å¯ä»¥å®¹å¿ä»»åŠ¡ä¸¢å¤±çš„æƒ…å†µï¼Œ<code>DiscardPolicy</code>æˆ–<code>DiscardOldestPolicy</code>å¯èƒ½æ›´åˆé€‚ã€‚</p><h4 id="çº¿ç¨‹æ± åˆ›å»ºçš„ä¸¤ç§æ–¹å¼"><a href="#çº¿ç¨‹æ± åˆ›å»ºçš„ä¸¤ç§æ–¹å¼" class="headerlink" title="çº¿ç¨‹æ± åˆ›å»ºçš„ä¸¤ç§æ–¹å¼"></a>çº¿ç¨‹æ± åˆ›å»ºçš„ä¸¤ç§æ–¹å¼</h4><h5 id="ThreadPoolExecutoræ„é€ å‡½æ•°"><a href="#ThreadPoolExecutoræ„é€ å‡½æ•°" class="headerlink" title="ThreadPoolExecutoræ„é€ å‡½æ•°"></a><code>ThreadPoolExecutor</code>æ„é€ å‡½æ•°</h5><p><strong>æ–¹å¼ä¸€ï¼šé€šè¿‡<code>ThreadPoolExecutor</code>æ„é€ å‡½æ•°æ¥åˆ›å»ºï¼ˆæ¨èï¼‰</strong></p><h5 id="Executorså·¥å…·ç±»"><a href="#Executorså·¥å…·ç±»" class="headerlink" title="Executorså·¥å…·ç±»"></a><code>Executors</code>å·¥å…·ç±»</h5><p><strong>æ–¹å¼äºŒï¼šé€šè¿‡Â <code>Executor</code>Â æ¡†æ¶çš„å·¥å…·ç±»Â <code>Executors</code>Â æ¥åˆ›å»ºã€‚</strong></p><p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šç§ç±»å‹çš„ <code>ThreadPoolExecutor</code>ï¼š</p><ul><li>**<code>FixedThreadPool</code>**ï¼šè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå›ºå®šçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± ã€‚è¯¥çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å§‹ç»ˆä¸å˜ã€‚å½“æœ‰ä¸€ä¸ªæ–°çš„ä»»åŠ¡æäº¤æ—¶ï¼Œçº¿ç¨‹æ± ä¸­è‹¥æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™ç«‹å³æ‰§è¡Œã€‚è‹¥æ²¡æœ‰ï¼Œåˆ™æ–°çš„ä»»åŠ¡ä¼šè¢«æš‚å­˜åœ¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¾…æœ‰çº¿ç¨‹ç©ºé—²æ—¶ï¼Œä¾¿å¤„ç†åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li><li><strong><code>SingleThreadExecutor</code>ï¼š</strong> è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚è‹¥å¤šä½™ä¸€ä¸ªä»»åŠ¡è¢«æäº¤åˆ°è¯¥çº¿ç¨‹æ± ï¼Œä»»åŠ¡ä¼šè¢«ä¿å­˜åœ¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¾…çº¿ç¨‹ç©ºé—²ï¼ŒæŒ‰å…ˆå…¥å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li><li><strong><code>CachedThreadPool</code>ï¼š</strong> è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´çº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ä¸ç¡®å®šï¼Œä½†è‹¥æœ‰ç©ºé—²çº¿ç¨‹å¯ä»¥å¤ç”¨ï¼Œåˆ™ä¼šä¼˜å…ˆä½¿ç”¨å¯å¤ç”¨çš„çº¿ç¨‹ã€‚è‹¥æ‰€æœ‰çº¿ç¨‹å‡åœ¨å·¥ä½œï¼Œåˆæœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹å¤„ç†ä»»åŠ¡ã€‚æ‰€æœ‰çº¿ç¨‹åœ¨å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå°†è¿”å›çº¿ç¨‹æ± è¿›è¡Œå¤ç”¨ã€‚</li><li>**<code>ScheduledThreadPool</code>**ï¼šè¯¥è¿”å›ä¸€ä¸ªç”¨æ¥åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œä»»åŠ¡æˆ–è€…å®šæœŸæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ã€‚</li></ul><blockquote><p>ä¸å»ºè®®ä½¿ç”¨ç¬¬äºŒç§ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p></blockquote><p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹å¼ºåˆ¶çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ <code>Executors</code> å»åˆ›å»ºï¼Œ</p><p>è€Œæ˜¯é€šè¿‡ <code>ThreadPoolExecutor</code> æ„é€ å‡½æ•°çš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©</p><p><code>Executors</code> è¿”å›çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š</p><ul><li><code>FixedThreadPool</code> å’Œ <code>SingleThreadExecutor</code>ï¼šä½¿ç”¨çš„æ˜¯æ— ç•Œçš„ <code>LinkedBlockingQueue</code>ï¼Œä»»åŠ¡é˜Ÿåˆ—æœ€å¤§é•¿åº¦ä¸º <code>Integer.MAX_VALUE</code>,å¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</li><li><code>CachedThreadPool</code>ï¼šä½¿ç”¨çš„æ˜¯åŒæ­¥é˜Ÿåˆ— <code>SynchronousQueue</code>, å…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸º <code>Integer.MAX_VALUE</code> ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</li><li><code>ScheduledThreadPool</code> å’Œ <code>SingleThreadScheduledExecutor</code> : ä½¿ç”¨çš„æ— ç•Œçš„å»¶è¿Ÿé˜»å¡é˜Ÿåˆ—<code>DelayedWorkQueue</code>ï¼Œä»»åŠ¡é˜Ÿåˆ—æœ€å¤§é•¿åº¦ä¸º <code>Integer.MAX_VALUE</code>,å¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</li></ul><p>è¿™ä¸ªå¼Šç«¯æ”¾åé¢å†äº†è§£ä¸€ä¸‹ã€‚</p><p>to be continedâ€¦</p><h3 id="4ã€çº¿ç¨‹æ± åŸç†åˆ†æ"><a href="#4ã€çº¿ç¨‹æ± åŸç†åˆ†æ" class="headerlink" title="4ã€çº¿ç¨‹æ± åŸç†åˆ†æ"></a>4ã€çº¿ç¨‹æ± åŸç†åˆ†æ</h3><p>çœ‹åšå®¢å†…å®¹ï¼š <a href="https://javaguide.cn/java/concurrent/java-thread-pool-summary.html#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90-%E9%87%8D%E8%A6%81">https://javaguide.cn/java/concurrent/java-thread-pool-summary.html#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90-%E9%87%8D%E8%A6%81</a></p><h3 id="5ã€çº¿ç¨‹æ± æœ€ä½³å®è·µ"><a href="#5ã€çº¿ç¨‹æ± æœ€ä½³å®è·µ" class="headerlink" title="5ã€çº¿ç¨‹æ± æœ€ä½³å®è·µ"></a>5ã€çº¿ç¨‹æ± æœ€ä½³å®è·µ</h3><p>å‚è€ƒï¼š <a href="https://javaguide.cn/java/concurrent/java-thread-pool-best-practices.html">https://javaguide.cn/java/concurrent/java-thread-pool-best-practices.html</a></p><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/java/concurrent/java-thread-pool-summary.html">https://javaguide.cn/java/concurrent/java-thread-pool-summary.html</a></li><li><a href="https://www.bilibili.com/video/BV1eD4y1w7Rp">https://www.bilibili.com/video/BV1eD4y1w7Rp</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>Thread</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>thread</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaFxåŸºç¡€ä½¿ç”¨</title>
    <link href="/2024/01/15/JavaFx%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/01/15/JavaFx%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€JavaFXæ˜¯ä»€ä¹ˆ"><a href="#1ã€JavaFXæ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€JavaFXæ˜¯ä»€ä¹ˆ"></a>1ã€JavaFXæ˜¯ä»€ä¹ˆ</h3><p>JavaFX æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå¯Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„è½¯ä»¶å¹³å°ã€‚å®ƒä¸»è¦ç”¨äºåˆ›å»ºæ¡Œé¢åº”ç”¨ç¨‹åºï¼Œä½†ä¹Ÿå¯ç”¨äºåˆ›å»ºæµè§ˆå™¨å†…è¿è¡Œçš„å¯ŒInternetåº”ç”¨ç¨‹åºï¼ˆRIAï¼‰ã€‚JavaFX æä¾›äº†ä¸€å¥—ä¸°å¯Œçš„å›¾å½¢å’Œåª’ä½“APIï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿè®¾è®¡å’Œåˆ›å»ºå…·æœ‰é«˜çº§è§†è§‰æ•ˆæœçš„åº”ç”¨ç¨‹åºã€‚</p><p>è¦ä½¿ç”¨JavaFXï¼Œä½ éœ€è¦éµå¾ªä»¥ä¸‹åŸºæœ¬æ­¥éª¤ï¼š</p><ol><li><p><strong>å®‰è£…å’Œè®¾ç½®</strong>ï¼š</p><ul><li>ç¡®ä¿ä½ å®‰è£…äº†Javaå¼€å‘å·¥å…·åŒ…ï¼ˆJDKï¼‰ã€‚è‡ªJava 11èµ·ï¼ŒJavaFXä¸å†ä½œä¸ºJDKçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ä½ éœ€è¦å•ç‹¬ä¸‹è½½å’Œå®‰è£…JavaFX SDKã€‚</li><li>åœ¨ä½ çš„å¼€å‘ç¯å¢ƒä¸­é…ç½®JavaFXã€‚è¿™å¯èƒ½åŒ…æ‹¬å°†JavaFX SDKè·¯å¾„æ·»åŠ åˆ°ä½ çš„é¡¹ç›®çš„åº“ä¸­ã€‚</li></ul></li><li><p><strong>åˆ›å»ºJavaFXåº”ç”¨ç¨‹åº</strong>ï¼š</p><ul><li>JavaFXåº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹æ˜¯ç»§æ‰¿è‡ª<code>javafx.application.Application</code>çš„ç±»ã€‚ä½ éœ€è¦é‡å†™<code>start(Stage primaryStage)</code>æ–¹æ³•ï¼Œè¿™æ˜¯JavaFXåº”ç”¨ç¨‹åºçš„ä¸»è¦å…¥å£ç‚¹ã€‚</li><li>ä½¿ç”¨JavaFXæä¾›çš„UIæ§ä»¶ï¼ˆå¦‚æŒ‰é’®ã€æ–‡æœ¬å­—æ®µã€è¡¨æ ¼ç­‰ï¼‰æ¥æ„å»ºç”¨æˆ·ç•Œé¢ã€‚</li></ul></li><li><p><strong>åœºæ™¯å’Œèˆå°</strong>ï¼š</p><ul><li>åœ¨JavaFXä¸­ï¼Œæ¯ä¸ªçª—å£è¢«ç§°ä¸ºä¸€ä¸ªâ€œèˆå°â€ï¼ˆStageï¼‰ï¼Œè€Œèˆå°ä¸Šçš„å†…å®¹è¢«ç»„ç»‡åœ¨ä¸€ä¸ªâ€œåœºæ™¯â€ï¼ˆSceneï¼‰ä¸­ã€‚</li><li>åˆ›å»ºä¸€ä¸ªåœºæ™¯å¹¶å°†å…¶è®¾ç½®åˆ°èˆå°ä¸Šï¼Œç„¶åæ˜¾ç¤ºèˆå°ã€‚</li></ul></li><li><p><strong>äº‹ä»¶å¤„ç†</strong>ï¼š</p><ul><li>JavaFXæä¾›äº†ä¸€å¥—ä¸°å¯Œçš„äº‹ä»¶å¤„ç†æœºåˆ¶ã€‚ä½ å¯ä»¥ä¸ºUIæ§ä»¶æ·»åŠ äº‹ä»¶å¤„ç†å™¨ï¼ˆå¦‚æŒ‰é’®ç‚¹å‡»ã€é¼ æ ‡äº‹ä»¶ç­‰ï¼‰ã€‚</li></ul></li><li><p><strong>è¿è¡Œåº”ç”¨ç¨‹åº</strong>ï¼š</p><ul><li>ä½¿ç”¨Javaå‘½ä»¤è¿è¡Œä½ çš„JavaFXåº”ç”¨ç¨‹åºï¼Œç¡®ä¿åŒ…æ‹¬JavaFXåº“çš„è·¯å¾„ã€‚</li></ul></li><li><p><strong>ä½¿ç”¨FXML</strong>ï¼ˆå¯é€‰ï¼‰ï¼š</p><ul><li>FXMLæ˜¯ä¸€ç§åŸºäºXMLçš„å£°æ˜å¼è¯­è¨€ï¼Œç”¨äºæ„å»ºJavaFXåº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢ã€‚ä½¿ç”¨FXMLå¯ä»¥å°†ç”¨æˆ·ç•Œé¢è®¾è®¡ä¸åº”ç”¨ç¨‹åºé€»è¾‘åˆ†ç¦»ï¼Œä½¿å¾—è®¾è®¡å¸ˆå’Œå¼€å‘è€…å¯ä»¥æ›´å®¹æ˜“åœ°åä½œã€‚</li></ul></li></ol><p>JavaFXæ”¯æŒCSSæ ·å¼ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥è½»æ¾æ”¹å˜åº”ç”¨ç¨‹åºçš„å¤–è§‚å’Œæ„Ÿè§‰ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æ”¯æŒ2Då’Œ3Då›¾å½¢ã€éŸ³é¢‘å’Œè§†é¢‘åª’ä½“ç­‰åŠŸèƒ½ã€‚</p><p>è¦å¼€å§‹ä½¿ç”¨JavaFXï¼Œä½ å¯èƒ½éœ€è¦æŸ¥çœ‹ä¸€äº›æ•™ç¨‹å’Œç¤ºä¾‹ï¼Œè¿™äº›å¯ä»¥åœ¨Oracleçš„å®˜æ–¹æ–‡æ¡£æˆ–å…¶ä»–ç¼–ç¨‹å­¦ä¹ èµ„æºä¸­æ‰¾åˆ°</p><h3 id="2ã€åŸºç¡€ä½¿ç”¨"><a href="#2ã€åŸºç¡€ä½¿ç”¨" class="headerlink" title="2ã€åŸºç¡€ä½¿ç”¨"></a>2ã€åŸºç¡€ä½¿ç”¨</h3><p>JavaFX æä¾›äº†ä¸€ç³»åˆ—çš„ç»„ä»¶ã€äº‹ä»¶ã€æ–¹æ³•å’Œæ ·å¼(CSS)æ”¯æŒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥åˆ›å»ºåŠŸèƒ½ä¸°å¯Œä¸”å¤–è§‚ç²¾ç¾çš„åº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯è¿™äº›æ–¹é¢çš„æ¦‚è§ˆï¼š</p><blockquote><p>ç»„ä»¶ï¼ˆæ§ä»¶ï¼‰</p></blockquote><p>JavaFX ä¸­çš„ç»„ä»¶é€šå¸¸è¢«ç§°ä¸ºæ§ä»¶ï¼ˆControlsï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„JavaFXæ§ä»¶ï¼š</p><ol><li><strong>åŸºæœ¬æ§ä»¶</strong>ï¼šå¦‚<code>Button</code>, <code>Label</code>, <code>TextField</code>, <code>TextArea</code>ç­‰ï¼Œç”¨äºåŸºæœ¬çš„ç”¨æˆ·äº¤äº’ã€‚</li><li><strong>é«˜çº§æ§ä»¶</strong>ï¼šå¦‚<code>TableView</code>, <code>ListView</code>, <code>TreeView</code>, <code>DatePicker</code>ç­‰ï¼Œç”¨äºæ›´å¤æ‚çš„æ•°æ®æ˜¾ç¤ºå’Œäº¤äº’ã€‚</li><li><strong>å¸ƒå±€å®¹å™¨</strong>ï¼šå¦‚<code>HBox</code>, <code>VBox</code>, <code>BorderPane</code>, <code>GridPane</code>ç­‰ï¼Œç”¨äºç»„ç»‡æ§ä»¶çš„å¸ƒå±€ã€‚</li><li><strong>èœå•æ§ä»¶</strong>ï¼šå¦‚<code>MenuBar</code>, <code>MenuItem</code>, <code>ContextMenu</code>ç­‰ï¼Œç”¨äºåˆ›å»ºèœå•ã€‚</li><li><strong>å¯¹è¯æ¡†</strong>ï¼šå¦‚<code>Alert</code>, <code>FileChooser</code>, <code>ColorPicker</code>ç­‰ï¼Œç”¨äºå¼¹å‡ºå¼äº¤äº’ã€‚</li></ol><blockquote><p>äº‹ä»¶</p></blockquote><p>JavaFX æ”¯æŒå¤šç§ç±»å‹çš„äº‹ä»¶ï¼Œå…è®¸å¼€å‘è€…å¤„ç†ç”¨æˆ·äº¤äº’å’Œå…¶ä»–åŠ¨æ€è¡Œä¸ºã€‚å¸¸è§çš„äº‹ä»¶ç±»å‹åŒ…æ‹¬ï¼š</p><ol><li><strong>é¼ æ ‡äº‹ä»¶</strong>ï¼šå¦‚<code>MouseEvent</code>ï¼Œå¤„ç†é¼ æ ‡çš„ç‚¹å‡»ã€ç§»åŠ¨ã€æ‹–æ‹½ç­‰ã€‚</li><li><strong>é”®ç›˜äº‹ä»¶</strong>ï¼šå¦‚<code>KeyEvent</code>ï¼Œå¤„ç†é”®ç›˜æŒ‰é”®çš„æŒ‰ä¸‹å’Œé‡Šæ”¾ã€‚</li><li><strong>åŠ¨ä½œäº‹ä»¶</strong>ï¼šå¦‚<code>ActionEvent</code>ï¼Œé€šå¸¸ç”¨äºæŒ‰é’®ç‚¹å‡»æˆ–èœå•é€‰æ‹©ã€‚</li><li><strong>çª—å£äº‹ä»¶</strong>ï¼šå¦‚çª—å£æ‰“å¼€ã€å…³é—­ã€æœ€å°åŒ–ç­‰ã€‚</li></ol><blockquote><p>æ–¹æ³•</p></blockquote><p>åœ¨JavaFXä¸­ï¼Œæ§ä»¶å’Œå…¶ä»–å¯¹è±¡æä¾›äº†å¤šç§æ–¹æ³•æ¥æ‰§è¡Œæ“ä½œæˆ–ä¿®æ”¹çŠ¶æ€ã€‚å¸¸è§çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><ol><li><strong>æ§ä»¶æ–¹æ³•</strong>ï¼šç”¨äºè®¾ç½®æ§ä»¶çš„å±æ€§ï¼Œå¦‚<code>setText()</code>, <code>setDisable()</code>, <code>setVisible()</code>ç­‰ã€‚</li><li><strong>å¸ƒå±€æ–¹æ³•</strong>ï¼šç”¨äºè®¾ç½®å¸ƒå±€ç›¸å…³å±æ€§ï¼Œå¦‚<code>setSpacing()</code>, <code>setAlignment()</code>, <code>setMargin()</code>ç­‰ã€‚</li><li><strong>äº‹ä»¶å¤„ç†æ–¹æ³•</strong>ï¼šç”¨äºæ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œå¦‚<code>setOnAction()</code>, <code>setOnMouseClicked()</code>ç­‰ã€‚</li></ol><blockquote><p>æ ·å¼ï¼ˆCSSï¼‰</p></blockquote><p>JavaFX å…è®¸ä½¿ç”¨CSSæ¥è®¾ç½®æ§ä»¶çš„æ ·å¼ï¼Œç±»ä¼¼äºåœ¨Webå¼€å‘ä¸­ä½¿ç”¨CSSã€‚ä½ å¯ä»¥ä½¿ç”¨CSSæ¥æ§åˆ¶æ§ä»¶çš„å¤–è§‚ï¼Œå¦‚é¢œè‰²ã€å­—ä½“ã€è¾¹è·ã€èƒŒæ™¯ç­‰ã€‚</p><ol><li><strong>å†…è”æ ·å¼</strong>ï¼šç›´æ¥åœ¨Javaä»£ç ä¸­è®¾ç½®æ§ä»¶çš„æ ·å¼ï¼Œå¦‚<code>button.setStyle(&quot;-fx-background-color: blue;&quot;)</code>ã€‚</li><li><strong>å¤–éƒ¨æ ·å¼è¡¨</strong>ï¼šåˆ›å»ºä¸€ä¸ªCSSæ–‡ä»¶ï¼Œå¹¶åœ¨JavaFXåº”ç”¨ä¸­å¼•ç”¨å®ƒï¼Œå¦‚<code>scene.getStylesheets().add(&quot;path/to/stylesheet.css&quot;)</code>ã€‚</li></ol><p>åœ¨CSSæ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰ç±»ä¼¼äºä»¥ä¸‹çš„æ ·å¼è§„åˆ™ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.button</span> &#123;<br>    -fx-<span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;<br>    -fx-<span class="hljs-attribute">background-color</span>: <span class="hljs-number">#FF5733</span>;<br>&#125;<br><br><span class="hljs-selector-class">.label</span> &#123;<br>    -fx-<span class="hljs-attribute">font-family</span>: <span class="hljs-string">&quot;Arial&quot;</span>;<br>    -fx-text-fill: <span class="hljs-number">#333333</span>;<br>&#125;<br><br><span class="hljs-comment">/* ä¸ºå…·æœ‰ç‰¹å®šIDçš„æ§ä»¶è®¾ç½®æ ·å¼ */</span><br><span class="hljs-selector-id">#myButton</span> &#123;<br>    -fx-<span class="hljs-attribute">border-color</span>: black;<br>    -fx-<span class="hljs-attribute">border-width</span>: <span class="hljs-number">2px</span>;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>ä¸€äº›é«˜çº§ç‰¹æ€§</p></blockquote><p>é™¤äº†åŸºæœ¬çš„æ§ä»¶ã€äº‹ä»¶å’Œæ ·å¼ï¼ŒJavaFXè¿˜æä¾›äº†ä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼š</p><ol><li><strong>åŠ¨ç”»å’Œç‰¹æ•ˆ</strong>ï¼šJavaFXæä¾›äº†åŠ¨ç”»APIï¼Œå¦‚<code>Timeline</code>, <code>Transition</code>ç­‰ï¼Œä»¥åŠå„ç§ç‰¹æ•ˆå¦‚<code>DropShadow</code>, <code>Reflection</code>ç­‰ã€‚</li><li><strong>2Då’Œ3Då›¾å½¢</strong>ï¼šå¯ä»¥åˆ›å»º2Då’Œ3Då›¾å½¢ï¼Œæ”¯æŒå›¾å½¢å˜æ¢ã€ç›¸æœºè§†è§’ç­‰ã€‚</li><li><strong>å¤šåª’ä½“æ”¯æŒ</strong>ï¼šæ”¯æŒæ’­æ”¾éŸ³é¢‘å’Œè§†é¢‘ï¼Œå¤„ç†åª’ä½“æµç­‰ã€‚</li><li><strong>FXML</strong>ï¼šä¸€ç§åŸºäºXMLçš„è¯­è¨€ï¼Œç”¨äºå£°æ˜å¼åœ°æ„å»ºç”¨æˆ·ç•Œé¢ï¼Œå°†ç•Œé¢è®¾è®¡ä¸åº”ç”¨é€»è¾‘åˆ†ç¦»ã€‚</li></ol><p>JavaFXæä¾›çš„è¿™äº›ç‰¹æ€§å’Œå·¥å…·ä½¿å¾—å¼€å‘ä¸°å¯Œçš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæˆä¸ºå¯èƒ½ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒåˆ›å»ºç°ä»£åŒ–ä¸”æ˜“äºç»´æŠ¤çš„ç”¨æˆ·ç•Œé¢ã€‚</p><p>é€šè¿‡ç»“åˆä½¿ç”¨è¿™äº›ç»„ä»¶ã€äº‹ä»¶ã€æ–¹æ³•å’Œæ ·å¼ï¼Œå¯ä»¥åˆ›å»ºå‡ºæ—¢ç¾è§‚åˆåŠŸèƒ½å¼ºå¤§çš„åº”ç”¨ç¨‹åºã€‚</p><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://articles.zsxq.com/id_04g0ezlrsuje.html">https://articles.zsxq.com/id_04g0ezlrsuje.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
      <category>JavaFx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>JavaFx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»¿æ¡Œé¢ç‰ˆå¾®ä¿¡èŠå¤©</title>
    <link href="/2024/01/15/%E4%BB%BF%E6%A1%8C%E9%9D%A2%E7%89%88%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9/"/>
    <url>/2024/01/15/%E4%BB%BF%E6%A1%8C%E9%9D%A2%E7%89%88%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9/</url>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ é¡¹ç›®åœ°å€ï¼š  <a href="https://wx.zsxq.com/dweb2/index/columns/48411118851818">https://wx.zsxq.com/dweb2/index/columns/48411118851818</a></p><p>é¡¹ç›®åœ°å€ï¼š</p><ul><li><a href="https://gitcode.net/KnowledgePlanet/Netty/IM">https://gitcode.net/KnowledgePlanet/Netty/IM</a></li></ul><h3 id="1ã€é¡¹ç›®ä»‹ç»"><a href="#1ã€é¡¹ç›®ä»‹ç»" class="headerlink" title="1ã€é¡¹ç›®ä»‹ç»"></a>1ã€é¡¹ç›®ä»‹ç»</h3><p>åŠŸèƒ½ï¼šä»¿æ¡Œé¢ç‰ˆå¾®ä¿¡èŠå¤©</p><p>æŠ€æœ¯æ ˆï¼šJavaFxã€Netty4.xã€SpringBootã€Mysql</p><h3 id="2ã€è¿è¡Œé¡¹ç›®"><a href="#2ã€è¿è¡Œé¡¹ç›®" class="headerlink" title="2ã€è¿è¡Œé¡¹ç›®"></a>2ã€è¿è¡Œé¡¹ç›®</h3><p>ä¸‹è½½é¡¹ç›®ä¸­çš„ä¸‰ä¸ªé¡¹ç›®ï¼Œå…ˆåŠ è½½å¹¶installï¼Œé¡ºåºåˆ†åˆ«æ˜¯ï¼šitstack-naive-chat-server â†’ itstack-naive-chat-ui  â†’ itstack-naive-chat-client</p><p>ç›´æ¥å¯åŠ¨ Applicatioin ç±»å°±è¡Œï¼Œæ”¹ä¸€ä¸‹æ•°æ®åº“è¿æ¥é…ç½®ã€‚</p><h3 id="3ã€UIç«¯"><a href="#3ã€UIç«¯" class="headerlink" title="3ã€UIç«¯"></a>3ã€UIç«¯</h3><p>ä»è¿™ä¸€ç« å¼€å§‹ä»‹ç»ä¸€ä¸‹å®ç°çš„åŠŸèƒ½ï¼Œå¹¶ç»“åˆæ–‡æ¡£è¿›è¡Œé˜è¿°ã€‚</p><p>UI ç«¯æ˜¯ä½¿ç”¨ JavaFx æ¥è¿›è¡Œæ„å»ºçš„ä¸€ä¸ªæ¡Œé¢åº”ç”¨ï¼Œä¸»è¦çš„é¡µé¢æ˜¯åŒ…æ‹¬ç­‰ç™»å½•ç•Œé¢ã€èŠå¤©ç•Œé¢ã€å¯¹è¯å¼¹å‡ºæ¡†ã€å¥½å‹æ (å‚è€ƒæ¡Œé¢å¾®ä¿¡é¡µé¢å¸ƒå±€ï¼‰ã€‚</p><p>å»ºè®®å…ˆæŒ‰ç…§å­¦ä¹ é¡¹ç›®åœ°å€ä¸­çš„ ä¸šåŠ¡é¡¹ç›® â†’ IM å®æˆ˜ï¼šNetty+JavaFxå®æˆ˜ï¼šä»¿æ¡Œé¢ç‰ˆå¾®ä¿¡èŠå¤©  â†’ è¯¾ç¨‹ç›®å½• â†’ ç¬¬ä¸€ç«  UI å¼€å‘</p><p>å…¨éƒ¨å…ˆè‡ªå·±çœ‹ä¸€é</p><p>UI  ç«¯æ˜¯é¡¹ç›®å·¥ç¨‹çœ‹å…·ä½“ä½¿ç”¨æ˜¯æ„å»ºåï¼Œæ‰“æˆä¸€ä¸ª Jar åŒ…ï¼Œä¾›å®¢æˆ·ç«¯å¼•å…¥ä¾èµ–ä½¿ç”¨ï¼›è¾¾åˆ° UI ä¸ ä¸šåŠ¡åˆ†ç¦»ã€‚</p><h3 id="4ã€æ¶æ„è®¾è®¡"><a href="#4ã€æ¶æ„è®¾è®¡" class="headerlink" title="4ã€æ¶æ„è®¾è®¡"></a>4ã€æ¶æ„è®¾è®¡</h3><p>ä½¿ç”¨åˆ°äº†å››å±‚æ¶æ„æ¨¡å‹DDD</p><ul><li>åº”ç”¨å±‚ Application</li><li>é¢†åŸŸå±‚ domain</li><li>åŸºç¡€å±‚ infrastructrue</li><li>æ¥å£å±‚ interfaces</li></ul><p>å°†ä»£ç å·¥ç¨‹è¿›è¡Œäº†ä¸€å®šçš„åˆ†å±‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401161506299.png" alt="image.png"></p><h3 id="5ã€åŠŸèƒ½å®ç°"><a href="#5ã€åŠŸèƒ½å®ç°" class="headerlink" title="5ã€åŠŸèƒ½å®ç°"></a>5ã€åŠŸèƒ½å®ç°</h3><p>ä¸»è¦åŠŸèƒ½ï¼šç™»å½•ã€æ·»åŠ å¥½å‹ã€å¯¹è¯é€šçŸ¥ã€æ¶ˆæ¯å‘é€ã€æ–­çº¿é‡è¿ã€‚</p><h3 id="6ã€äºŒæ¬¡å¼€å‘"><a href="#6ã€äºŒæ¬¡å¼€å‘" class="headerlink" title="6ã€äºŒæ¬¡å¼€å‘"></a>6ã€äºŒæ¬¡å¼€å‘</h3><p>åœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿›è¡Œä¸€å®šå†…å®¹çš„æ”¹é€ ï¼š to be continedâ€¦.</p>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è·å–æœ¬åœ°æœåŠ¡è®¿é—®ç¬¬ä¸‰æ–¹æ¥å£çš„IPåœ°å€</title>
    <link href="/2024/01/14/%E8%8E%B7%E5%8F%96%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8E%A5%E5%8F%A3%E7%9A%84IP%E5%9C%B0%E5%9D%80/"/>
    <url>/2024/01/14/%E8%8E%B7%E5%8F%96%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8E%A5%E5%8F%A3%E7%9A%84IP%E5%9C%B0%E5%9D%80/</url>
    
    <content type="html"><![CDATA[<p>æœ‰ä¸€ç§æ¯”è¾ƒç®€å•çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨è®¿é—®ï¼Œå‘ä¸€ä¸ªè¿”å›è¯·æ±‚è€…IPåœ°å€çš„API å‘èµ·è¯·æ±‚ã€‚</p><p>æ¯”å¦‚ <code>httpbin.org/ip</code> å‘é€è¯·æ±‚</p><p>æˆ–è€…è®¿é—®ï¼š<code>ifconfig.me</code></p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>network</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>chatgptæ¥å£è°ƒç”¨</title>
    <link href="/2024/01/14/chatgpt%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8/"/>
    <url>/2024/01/14/chatgpt%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒå¼€æºé¡¹ç›®ï¼š</p><ul><li><a href="https://github.com/suimz/chatgpt-web-java">https://github.com/suimz/chatgpt-web-java</a></li><li><a href="https://github.com/PlexPt/chatgpt-java/tree/main">https://github.com/PlexPt/chatgpt-java/tree/main</a></li></ul><p>å®˜ç½‘æ–‡æ¡£ï¼š <a href="https://platform.openai.com/docs/guides/text-generation/chat-completions-api">https://platform.openai.com/docs/guides/text-generation/chat-completions-api</a></p><h3 id="1ã€æœ€ç®€å•ä½¿ç”¨"><a href="#1ã€æœ€ç®€å•ä½¿ç”¨" class="headerlink" title="1ã€æœ€ç®€å•ä½¿ç”¨"></a>1ã€æœ€ç®€å•ä½¿ç”¨</h3><p>è¿™é‡Œçš„ä»£ç å‚è€ƒçš„æ˜¯ï¼š <a href="https://github.com/PlexPt/chatgpt-java/tree/main">https://github.com/PlexPt/chatgpt-java/tree/main</a></p><p>åŒæ—¶è¯¥é¡¹ç›®çš„ readme.md æœ‰ä»‹ç»æ–‡æ¡£å†…å®¹ï¼Œå»ºè®®å»çœ‹ä¸€ä¸‹</p><p>ç¤ºä¾‹ç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-comment">//å›½å†…éœ€è¦ä»£ç†</span><br>  <span class="hljs-type">Proxy</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> Proxys.http(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">1081</span>);<br> <span class="hljs-comment">//socks5 ä»£ç†</span><br><span class="hljs-comment">// Proxy proxy = Proxys.socks5(&quot;127.0.0.1&quot;, 1080);</span><br><br>  <span class="hljs-type">ChatGPT</span> <span class="hljs-variable">chatGPT</span> <span class="hljs-operator">=</span> ChatGPT.builder()<br>            .apiKey(<span class="hljs-string">&quot;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&quot;</span>)<br>            .proxy(proxy)<br>            .apiHost(<span class="hljs-string">&quot;https://api.openai.com/&quot;</span>) <span class="hljs-comment">//åå‘ä»£ç†åœ°å€</span><br>            .build()<br>            .init();<br>            <br>    <span class="hljs-type">String</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> chatGPT.chat(<span class="hljs-string">&quot;å†™ä¸€æ®µä¸ƒè¨€ç»å¥è¯—ï¼Œé¢˜ç›®æ˜¯ï¼šç«é”…ï¼&quot;</span>);<br>    System.out.println(res);<br></code></pre></td></tr></table></figure><p>ä»–è¿™é‡Œç”¨äº†ä¸€ä¸ªåå‘ä»£ç†ï¼Œæˆ‘è¿™é‡Œé‡‡ç”¨çš„ç­–ç•¥æ˜¯ä½¿ç”¨é˜¿é‡Œäº‘çš„å‡½æ•°è®¡ç®—FCæ¥è¿›è¡Œä»£ç† <a href="https://api.openai.com/">https://api.openai.com/</a> è¿™ä¸ªè®¿é—®åœ°å€ï¼›ä¸Šé¢è¿™ç§æ–¹å¼æ˜¯éœ€è¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs abnf">ChatGPT chatGPT <span class="hljs-operator">=</span> ChatGPT.builder()<br>          .apiKey(<span class="hljs-string">&quot;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&quot;</span>)<br>          .apiHost(<span class="hljs-string">&quot;https://openai-proxy-openai-proxy-xxxxxxx.run/&quot;</span>) //é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—çš„ä»£ç†åœ°å€<br>          .build()<br>          .init()<span class="hljs-comment">;</span><br>          <br>  String res <span class="hljs-operator">=</span> chatGPT.chat(<span class="hljs-string">&quot;å†™ä¸€æ®µä¸ƒè¨€ç»å¥è¯—ï¼Œé¢˜ç›®æ˜¯ï¼šç«é”…ï¼&quot;</span>)<span class="hljs-comment">;</span><br>  System.out.println(res)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>å…¶ä»–å†…å®¹å¯ä»¥çœ‹ä¸€ä¸‹é¡¹ç›®ä»£ç </p><p>to be continedâ€¦</p>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>java</tag>
      
      <tag>chatgpt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é˜¿é‡Œé€šä¹‰åƒé—®API</title>
    <link href="/2024/01/14/%E9%98%BF%E9%87%8C%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AEAPI/"/>
    <url>/2024/01/14/%E9%98%BF%E9%87%8C%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AEAPI/</url>
    
    <content type="html"><![CDATA[<p>æ¥å£å®˜ç½‘æ–‡æ¡£åœ°å€ï¼š <a href="https://help.aliyun.com/zh/dashscope/developer-reference/api-details">https://help.aliyun.com/zh/dashscope/developer-reference/api-details</a></p><h3 id="1ã€ç”³è¯·API-KEY"><a href="#1ã€ç”³è¯·API-KEY" class="headerlink" title="1ã€ç”³è¯·API-KEY"></a>1ã€ç”³è¯·API-KEY</h3><p>ä¸ªäººå®é™…ä½¿ç”¨çš„æ—¶å€™è¿™ä¸€æ­¥æ¯”è¾ƒç®€å•ï¼Œæœ€è¿‘æ˜¯å…è´¹å¼€é€šçš„ï¼ˆ20240114ï¼‰</p><p>å¼€é€šåœ°å€ï¼š <a href="https://dashscope.console.aliyun.com/apiKey">https://dashscope.console.aliyun.com/apiKey</a></p><h3 id="2ã€ä½¿ç”¨é€šä¹‰åƒé—®"><a href="#2ã€ä½¿ç”¨é€šä¹‰åƒé—®" class="headerlink" title="2ã€ä½¿ç”¨é€šä¹‰åƒé—®"></a>2ã€ä½¿ç”¨é€šä¹‰åƒé—®</h3><p>ç”³è¯· API_KEY ä¹‹åï¼Œè¿›è¡Œä¸‹è¿°æ“ä½œï¼š</p><p>å®‰è£…æœ€æ–°ç‰ˆSDK: </p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240114102643.png" alt="image.png"></p><p>è¿™ä¸ªç‰ˆæœ¬å¿…é¡»è¦å†™æ˜ç¡®ä¸€ç‚¹ï¼Œä»–è¿™æ ·å†™æœ‰ç‚¹é—®é¢˜ï¼Œå…ˆå»é˜¿é‡Œäº‘ä»“åº“æŸ¥æ‰¾ä¸€ä¸‹ï¼š <a href="https://developer.aliyun.com/mvn/search">https://developer.aliyun.com/mvn/search</a></p><p>æœç´¢ï¼š dashscope-sdk-java</p><p>åœ¨é¡¹ç›®ä¸­å¼•å…¥è¿™ä¸ªä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/dashscope-sdk-java --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dashscope-sdk-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åé¢ä½¿ç”¨ç›´æ¥çœ‹ä¸€ä¸‹å®˜ç½‘ï¼ŒAPI è°ƒç”¨æ–‡æ¡£ï¼š <a href="https://help.aliyun.com/zh/dashscope/developer-reference/api-details">https://help.aliyun.com/zh/dashscope/developer-reference/api-details</a></p><p>ä½¿ç”¨çš„æ—¶å€™éœ€è¦ä½¿ç”¨ä¸€ä¸‹ç¯å¢ƒå˜é‡</p><p>å®˜ç½‘çš„å‡ ç§æ–¹å¼ï¼š <a href="https://help.aliyun.com/zh/dashscope/developer-reference/api-key-settings">https://help.aliyun.com/zh/dashscope/developer-reference/api-key-settings</a></p><p>çœ‹äº†ä¸€ä¸‹å‡ ç§æ–¹å¼ï¼Œè¿˜æ˜¯å»ºè®®ç¬¬ä¸€ç§æ¥è¿›è¡Œæ“ä½œã€‚</p><h4 id="ç¯å¢ƒå˜é‡è®¾ç½®"><a href="#ç¯å¢ƒå˜é‡è®¾ç½®" class="headerlink" title="ç¯å¢ƒå˜é‡è®¾ç½®"></a>ç¯å¢ƒå˜é‡è®¾ç½®</h4><p>é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½® API-KEY ï¼ˆLinuxç³»ç»Ÿå»ºè®®ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> DASHSCOPE_API_KEY=<span class="hljs-string">&quot;YOUR_DASHSCOPE_API_KEY&quot;</span><br></code></pre></td></tr></table></figure><p>windows ç³»ç»Ÿ</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> <span class="hljs-attribute">DASHSCOPE_API_KEY</span>=<span class="hljs-string">&quot;YOUR_DASHSCOPE_API_KEY&quot;</span><br><br><span class="hljs-comment">#æŸ¥çœ‹ç¯å¢ƒå˜é‡</span><br>echo %DASHSCOPE_API_KEY% <br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç çš„æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.alibaba.dashscope.utils.Constants;<br>Constants.apiKey=<span class="hljs-string">&quot;YOUR_DASHSCOPE_API_KEY&quot;</span>;<br></code></pre></td></tr></table></figure><h4 id="ä¾èµ–å¼•å…¥"><a href="#ä¾èµ–å¼•å…¥" class="headerlink" title="ä¾èµ–å¼•å…¥"></a>ä¾èµ–å¼•å…¥</h4><p>ä¸ªäººå®é™…ä½¿ç”¨çš„æ—¶å€™å¼•å…¥äº†ä¸‰ä¸ªä¾èµ–ï¼Œæ³¨æ„ä¸€ä¸‹å®é™…ä½¿ç”¨æƒ…å†µ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/dashscope-sdk-java --&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>dashscope-sdk-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-comment">&lt;!--okhttp3 ä¾èµ–--&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.9.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-comment">&lt;!-- Other dependencies --&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.code.gson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>gson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- ä½¿ç”¨æœ€æ–°çš„ç¨³å®šç‰ˆæˆ–è€…ä½ æ‰€éœ€è¦çš„ç‰ˆæœ¬ --&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="æµ‹è¯•ç±»"><a href="#æµ‹è¯•ç±»" class="headerlink" title="æµ‹è¯•ç±»"></a>æµ‹è¯•ç±»</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">package com.tsmyk.wechatproject.wechat.utils;<br><br><span class="hljs-keyword">import</span> com.alibaba.dashscope.aigc.generation.Generation;<br><span class="hljs-keyword">import</span> com.alibaba.dashscope.aigc.generation.GenerationResult;<br><span class="hljs-keyword">import</span> com.alibaba.dashscope.aigc.generation.models.QwenParam;<br><span class="hljs-keyword">import</span> com.alibaba.dashscope.common.Message;<br><span class="hljs-keyword">import</span> com.alibaba.dashscope.common.MessageManager;<br><span class="hljs-keyword">import</span> com.alibaba.dashscope.common.<span class="hljs-keyword">Role</span>;<br><span class="hljs-keyword">import</span> com.alibaba.dashscope.<span class="hljs-keyword">exception</span>.ApiException;<br><span class="hljs-keyword">import</span> com.alibaba.dashscope.<span class="hljs-keyword">exception</span>.InputRequiredException;<br><span class="hljs-keyword">import</span> com.alibaba.dashscope.<span class="hljs-keyword">exception</span>.NoApiKeyException;<br><span class="hljs-keyword">import</span> com.alibaba.dashscope.utils.JsonUtils;<br><span class="hljs-keyword">import</span> com.alibaba.dashscope.utils.Constants;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @author luoqi</span><br><span class="hljs-comment"> * @File TongYiAPIUtils.java</span><br><span class="hljs-comment"> * @Desc</span><br><span class="hljs-comment"> * @Create 2024/1/14 10:46</span><br><span class="hljs-comment"> * @ChangeList --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> TongYiAPIUtils &#123;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">      * @Description: æµ‹è¯•é€šä¹‰åƒé—®çš„APIè®¿é—®åŸºç¡€ä½¿ç”¨</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">      * @return: void</span><br><span class="hljs-comment">      * @throws</span><br><span class="hljs-comment">      * @author luoqi</span><br><span class="hljs-comment">      * @create: 2024/1/14 10:48</span><br><span class="hljs-comment">      * @ChangeList</span><br><span class="hljs-comment">      * --------------------------------------------------------------------</span><br><span class="hljs-comment">      *Date</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> callWithMessage()<br>            throws NoApiKeyException, ApiException, InputRequiredException &#123;<br>        Generation gen = <span class="hljs-built_in">new</span> Generation();<br>        MessageManager msgManager = <span class="hljs-built_in">new</span> MessageManager(<span class="hljs-number">10</span>);<br>        Message systemMsg =<br>                Message.builder().<span class="hljs-keyword">role</span>(<span class="hljs-keyword">Role</span>.<span class="hljs-keyword">SYSTEM</span>.getValue()).content(&quot;You are a helpful assistant.&quot;).build();<br>        Message userMsg = Message.builder().<span class="hljs-keyword">role</span>(<span class="hljs-keyword">Role</span>.<span class="hljs-keyword">USER</span>.getValue()).content(&quot;å¤¸ä¸€ä¸‹æˆ‘ï¼Œæˆ‘åˆå­¦ä¹ äº†ä¸€ä¼šå‘¢&quot;).build();<br>        msgManager.<span class="hljs-keyword">add</span>(systemMsg);<br>        msgManager.<span class="hljs-keyword">add</span>(userMsg);<br>        QwenParam param =<br>                QwenParam.builder().model(Generation.Models.QWEN_PLUS).messages(msgManager.<span class="hljs-keyword">get</span>())<br>                        .resultFormat(QwenParam.ResultFormat.MESSAGE)<br>                        .topP(<span class="hljs-number">0.8</span>)<br>                        .enableSearch(<span class="hljs-keyword">true</span>)<br>                        .build();<br>        GenerationResult result = gen.<span class="hljs-keyword">call</span>(param);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(result);<br>        msgManager.<span class="hljs-keyword">add</span>(result);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(JsonUtils.toJson(result));<br>        //param.setPrompt(&quot;ç°åœ¨æ—¶é—´æ˜¯ 20:00&quot;);<br>        param.setMessages(msgManager.<span class="hljs-keyword">get</span>());<br>        result = gen.<span class="hljs-keyword">call</span>(param);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(result);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(JsonUtils.toJson(result));<br>    &#125;<br><br><br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args)&#123;<br>        Constants.apiKey=&quot;sk-xxxxxxxxxxxxxxxxx&quot;;<br>        try &#123;<br>            callWithMessage();<br>        &#125; catch (ApiException | NoApiKeyException | InputRequiredException e) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(e.getMessage());<br>        &#125;<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨å‚æ•°çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>chatgpt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nodeå®‰è£…å’Œä¸‹è½½</title>
    <link href="/2024/01/13/node%E5%AE%89%E8%A3%85%E5%92%8C%E4%B8%8B%E8%BD%BD/"/>
    <url>/2024/01/13/node%E5%AE%89%E8%A3%85%E5%92%8C%E4%B8%8B%E8%BD%BD/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€Node-js-ä¸‹è½½å®‰è£…"><a href="#1ã€Node-js-ä¸‹è½½å®‰è£…" class="headerlink" title="1ã€Node.js ä¸‹è½½å®‰è£…"></a>1ã€Node.js ä¸‹è½½å®‰è£…</h3><p>å®˜ç½‘ä¸‹è½½ï¼š <a href="https://nodejs.org/en">https://nodejs.org/en</a></p><p>å®‰è£…åï¼ŒéªŒè¯ä¸€ä¸‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><p>æ‰“å¼€ cmd, è¾“å…¥node -vï¼Œnpm -vï¼Œå‡ºç°å¦‚ä¸‹ç•Œé¢å®‰è£…æˆåŠŸ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231117221300.png" alt="image.png"></p><h3 id="2ã€ç¯å¢ƒé…ç½®"><a href="#2ã€ç¯å¢ƒé…ç½®" class="headerlink" title="2ã€ç¯å¢ƒé…ç½®"></a>2ã€ç¯å¢ƒé…ç½®</h3><blockquote><p>ç¯å¢ƒå˜é‡é…ç½®</p></blockquote><p>æ–°å¢<strong>ç”¨æˆ·å˜é‡</strong>  <code>NODE_PATH</code>ï¼Œå˜é‡å€¼è®¾ç½®ä¸º <code>xxx\nodejs</code></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231117224932.png" alt="image.png"></p><p>ç¼–è¾‘<strong>ç”¨æˆ·å˜é‡</strong>ä¸­çš„ã€Pathã€‘</p><p>ä¿®æ”¹ å˜é‡å <code>Path</code></p><p>å°†é»˜è®¤çš„ C ç›˜ä¸‹ã€Â <code>AppData\Roaming\npm</code>Â ã€‘ä¿®æ”¹æˆ <code>%NODE_PATH%</code></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231117224741.png" alt="image.png"></p><p>è®¾ç½®å®Œåä¹Ÿæ‰“å¼€ cmd, è¾“å…¥ä¸€ä¸‹  node -vï¼Œnpm -v  çœ‹æ˜¯å¦OKã€‚</p><blockquote><p>é…ç½®npmçš„å…¨å±€æ¨¡å—çš„å­˜æ”¾è·¯å¾„ä»¥åŠcacheçš„è·¯å¾„</p></blockquote><p>æ‰¾åˆ°å®‰è£…çš„ç›®å½•ï¼Œåœ¨å®‰è£…ç›®å½•ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹ã€node_globalã€‘å’Œã€node_cacheã€‘</p><p>ä½¿ç”¨ç®¡ç†å‘˜èº«ä»½æ‰“å¼€cmdçª—å£ï¼Œæ‰§è¡Œ</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm<span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span><span class="hljs-built_in"> prefix </span><span class="hljs-string">&quot;xxx\Node.js\node_global&quot;</span><br><br>npm<span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span> cache <span class="hljs-string">&quot;xxx\Node.js\node_cache&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>æ–°å¢ç³»ç»ŸPathå˜é‡</p></blockquote><p>åœ¨ã€ç³»ç»Ÿå˜é‡ã€‘ä¸­é€‰æ‹©ã€Pathã€‘ç‚¹å‡»ã€ç¼–è¾‘ã€‘æ·»åŠ ä½ åˆšæ‰é…ç½®çš„ä¸¤ä¸ªè·¯å¾„ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231117225456.png" alt="image.png"></p><h3 id="3ã€å®‰è£…æ·˜å®é•œåƒ"><a href="#3ã€å®‰è£…æ·˜å®é•œåƒ" class="headerlink" title="3ã€å®‰è£…æ·˜å®é•œåƒ"></a>3ã€å®‰è£…æ·˜å®é•œåƒ</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">npm config set registry https:<span class="hljs-comment">//registry.npm.taobao.org</span><br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹æ˜¯å¦æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm config get registry<br></code></pre></td></tr></table></figure><h3 id="4ã€NVM-å®‰è£…-â˜…"><a href="#4ã€NVM-å®‰è£…-â˜…" class="headerlink" title="4ã€NVM å®‰è£…  â˜…"></a>4ã€NVM å®‰è£…  â˜…</h3><h4 id="window-ä¸‹å®‰è£…"><a href="#window-ä¸‹å®‰è£…" class="headerlink" title="window ä¸‹å®‰è£…"></a>window ä¸‹å®‰è£…</h4><p>ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/coreybutler/nvm-windows/releases">https://github.com/coreybutler/nvm-windows/releases</a></p><p>NVM æ˜¯ä¸€ä¸ª node ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œè¿™é‡Œä¸»è¦æ˜¯ç”±äºå‰ç«¯é¡¹ç›®ä¸­æœ‰æ—¶å€™éœ€è¦çš„ç‰ˆæœ¬ä¸åŒï¼Œéœ€è¦åˆ‡æ¢</p><ul><li><ol><li>ä¸‹è½½ nvm-setup.zip æ–‡ä»¶</li></ol></li><li><ol start="2"><li>å¸è½½ç”µè„‘å®‰è£…çš„ node ï¼Œåœ¨ç¨‹åºä¸åŠŸèƒ½ä¸Šå¸è½½ node ï¼ŒåŒæ—¶åˆ é™¤ä¹‹å‰çš„ç¯å¢ƒå˜é‡</li></ol></li><li>3.è§£å‹æ–‡ä»¶åï¼Œæœ‰ä¸€ä¸ª nvm-setup.exe ï¼Œç‚¹å‡»å®‰è£…</li><li>4.å®‰è£…ä½ éœ€è¦çš„ç‰ˆæœ¬</li><li>5.å¯èƒ½éœ€è¦é‡æ–°å¯åŠ¨ä¸€ä¸‹ä½ çš„ç”µè„‘</li></ul><p>å¸¸ç”¨å‘½ä»¤</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">nvm ls               // æŸ¥çœ‹å·²å®‰è£…<span class="hljs-keyword">node</span><span class="hljs-title">ç‰ˆæœ¬</span><br><span class="hljs-title">nvm</span> install vXX      // å®‰è£…å¯¹åº”vXXç‰ˆæœ¬çš„<span class="hljs-keyword">node</span><br><span class="hljs-title">nvm</span> uninstall vXX    // å¸è½½å¯¹åº”vXXç‰ˆæœ¬çš„<span class="hljs-keyword">node</span><br><span class="hljs-title">nvm</span> use xxx          // é€‰æ‹©ä½¿ç”¨XXXç‰ˆæœ¬<br></code></pre></td></tr></table></figure><p>å®é™…æ“ä½œ</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#å®‰è£…å¹¶åˆ‡æ¢ç‰ˆæœ¬åˆ° 14.21.3ï¼Œå®‰è£…éœ€è¦ä¸€ç‚¹æ—¶é—´</span><br><span class="hljs-attribute">nvm</span> install <span class="hljs-number">14</span>.<span class="hljs-number">21</span>.<span class="hljs-number">3</span><br><span class="hljs-attribute">nvm</span> use <span class="hljs-number">14</span>.<span class="hljs-number">21</span>.<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h4 id="linux-ä¸‹å®‰è£…"><a href="#linux-ä¸‹å®‰è£…" class="headerlink" title="linux ä¸‹å®‰è£…"></a>linux ä¸‹å®‰è£…</h4><blockquote><p>Linux ç³»ç»Ÿä¸‹å®‰è£…</p></blockquote><p>ä¹Ÿæ˜¯éœ€è¦å…ˆä¸‹è½½ä¸€ä¸‹å®‰è£…åŒ…</p><p>åœ°å€ï¼š <a href="https://github.com/nvm-sh/nvm">https://github.com/nvm-sh/nvm</a></p><p>å»ºè®®ç›´æ¥ä¸‹è¿™ä¸ªï¼š <a href="https://github.com/nvm-sh/nvm/archive/refs/tags/v0.38.0.tar.gz">https://github.com/nvm-sh/nvm/archive/refs/tags/v0.38.0.tar.gz</a></p><p>è¿›è¡Œåˆ°å¯¹åº”ç›®å½•å</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-comment">//è¿›å…¥æœåŠ¡å™¨ è§£å‹æ–‡ä»¶æ”¾ç½®ç›®å½•</span><br><span class="hljs-comment">//è§£å‹æ–‡ä»¶åˆ°å½“å‰ç›®å½•</span><br>tar -zxvf nvm-<span class="hljs-number">0.38</span>.<span class="hljs-number">0</span><span class="hljs-selector-class">.tar</span>.gz<br></code></pre></td></tr></table></figure><p>è§£å‹åçš„é…ç½®å‚è€ƒï¼š <a href="https://blog.csdn.net/Siebert_Angers/article/details/129290084">https://blog.csdn.net/Siebert_Angers/article/details/129290084</a></p><p>è¿›å…¥è§£å‹ç›®å½•ç»™å®‰è£…è„šæœ¬åŠ æƒé™æœ€åæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> nvm-0.38.0   <span class="hljs-comment"># è¿›å…¥è§£å‹ç›®å½•</span><br><span class="hljs-built_in">chmod</span> +x nvm.sh    <span class="hljs-comment"># ç»™äºˆå®‰è£…è„šæœ¬æ‰§è¡Œæƒé™</span><br>./nvm.sh    <span class="hljs-comment"># æ‰§è¡Œ</span><br></code></pre></td></tr></table></figure><p>ç¯å¢ƒå˜é‡é…ç½®:</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> /etc/<span class="hljs-keyword">profile</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">NVM_DIR</span>=<span class="hljs-string">&quot;/usr/local/nvm-0.39.1&quot;</span>   # æ›´æ”¹æˆè‡ªå·±çš„è§£å‹ç›®å½•<br>[ -s <span class="hljs-string">&quot;<span class="hljs-variable">$NVM_DIR</span>/nvm.sh&quot;</span> ] &amp;&amp; \. <span class="hljs-string">&quot;<span class="hljs-variable">$NVM_DIR</span>/nvm.sh&quot;</span>  # This loads nvm<br>[ -s <span class="hljs-string">&quot;<span class="hljs-variable">$NVM_DIR</span>/bash_completion&quot;</span> ] &amp;&amp; \. <span class="hljs-string">&quot;<span class="hljs-variable">$NVM_DIR</span>/bash_completion&quot;</span>  # This loads nvm bash_completion<br><span class="hljs-comment"># é•œåƒæºé…ç½®</span><br><span class="hljs-built_in">export</span> <span class="hljs-attribute">NVM_NODEJS_ORG_MIRROR</span>=https://npm.taobao.org/mirrors/node/<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">NVM_IOJS_ORG_MIRROR</span>=http://npm.taobao.org/mirrors/iojs<br></code></pre></td></tr></table></figure><p>åˆ·æ–°é…ç½®ï¼Œä½¿ä¸Šé¢çš„ç¯å¢ƒå˜é‡é…ç½®ç”Ÿæ•ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><p>æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nvm -v</span><br></code></pre></td></tr></table></figure><blockquote><p>é…ç½®npm</p></blockquote><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹è¿œç¨‹ä»“åº“æœ‰å“ªäº›å¯ä»¥å®‰è£…çš„nodejsç‰ˆæœ¬ï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nvm ls-remote</span><br></code></pre></td></tr></table></figure><p>å®‰è£…æŒ‡å®šç‰ˆæœ¬ nodeï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nvm</span> install v14.<span class="hljs-number">16</span><br></code></pre></td></tr></table></figure><p>æŠŠ npm é•œåƒæ›´æ”¹ä¸ºå›½å†…é•œåƒï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm<span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span> <span class="hljs-attribute">sass_binary_site</span>=https://npm.taobao.org/mirrors/node-sass/<br>npm<span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span> <span class="hljs-attribute">phantomjs_cdnurl</span>=https://npm.taobao.org/mirrors/phantomjs/<br>npm<span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span> <span class="hljs-attribute">electron_mirror</span>=https://npm.taobao.org/mirrors/electron/<br>npm<span class="hljs-built_in"> config </span><span class="hljs-built_in">set</span> <span class="hljs-attribute">registry</span>=https://registry.npm.taobao.org<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹é•œåƒé…ç½®ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">npm config ls<br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/m0_62617719/article/details/130423504">https://blog.csdn.net/m0_62617719/article/details/130423504</a></li><li><a href="https://blog.csdn.net/JingYan_Chan/article/details/125405423">https://blog.csdn.net/JingYan_Chan/article/details/125405423</a></li><li><a href="https://blog.csdn.net/MyronCham/article/details/119561972">https://blog.csdn.net/MyronCham/article/details/119561972</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>Node</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>node</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€šè¿‡é˜¿é‡Œäº‘çš„å‡½æ•°è®¡ç®—FCè¿›è¡ŒOpenAIè®¿é—®å›½å†…ä»£ç†</title>
    <link href="/2024/01/13/%E9%80%9A%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E5%87%BD%E6%95%B0%E8%AE%A1%E7%AE%97FC%E8%BF%9B%E8%A1%8COpenAI%E8%AE%BF%E9%97%AE%E5%9B%BD%E5%86%85%E4%BB%A3%E7%90%86/"/>
    <url>/2024/01/13/%E9%80%9A%E8%BF%87%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E5%87%BD%E6%95%B0%E8%AE%A1%E7%AE%97FC%E8%BF%9B%E8%A1%8COpenAI%E8%AE%BF%E9%97%AE%E5%9B%BD%E5%86%85%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€éœ€æ±‚"><a href="#1ã€éœ€æ±‚" class="headerlink" title="1ã€éœ€æ±‚"></a>1ã€éœ€æ±‚</h3><p>éœ€æ±‚æ˜¯é€šè¿‡åå‘ä»£ç†é“¾æ¥ <a href="https://api.openai.com/">https://api.openai.com</a> çš„æ–¹å¼æ¥å®ç°</p><h3 id="2ã€è·å–é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—FC"><a href="#2ã€è·å–é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—FC" class="headerlink" title="2ã€è·å–é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—FC"></a>2ã€è·å–é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—FC</h3><p>éœ€è¦å…ˆè·å–ä¸€ä¸‹é˜¿é‡Œäº‘çš„  <code>AccessKeyId</code>å’Œ<code>AccessKeySecret</code></p><p>åœ¨æ§åˆ¶å°å³ä¸Šè§’è·å–ï¼Œæˆ–è€…é€šè¿‡ä¸‹æ–¹é“¾æ¥è·å–ï¼š   <a href="https://usercenter.console.aliyun.com/#/manage/ak">https://usercenter.console.aliyun.com/#/manage/ak</a></p><p>å‚è€ƒåšå®¢ï¼š <a href="https://blog.csdn.net/xuzhongyi103/article/details/134272331">https://blog.csdn.net/xuzhongyi103/article/details/134272331</a></p><p>éƒ¨ç½²å‚è€ƒæ–‡æ¡£ï¼š <a href="https://help.aliyun.com/zh/fc/developer-reference/install-serverless-devs-and-docker">https://help.aliyun.com/zh/fc/developer-reference/install-serverless-devs-and-docker</a></p><p>ï¼ˆé˜¿é‡Œäº‘æ–‡æ¡£ï¼‰</p><h3 id="3ã€éƒ¨ç½²Serverless-Devs"><a href="#3ã€éƒ¨ç½²Serverless-Devs" class="headerlink" title="3ã€éƒ¨ç½²Serverless Devs"></a>3ã€éƒ¨ç½²Serverless Devs</h3><p>ä»‹ç»ï¼š</p><p>Serverless Devsæ˜¯ä¸€æ¬¾å¤šäº‘çš„å¼€å‘è€…å·¥å…·ï¼Œå¯ä»¥éå¸¸ç®€å•ã€å¿«é€Ÿã€æ–¹ä¾¿åœ°éƒ¨ç½²AWSã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰å¤šä¸ªäº‘å‚å•†çš„å‡½æ•°è®¡ç®—ç­‰ç›¸å…³æœåŠ¡ï¼Œ</p><p>åŒæ—¶å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå¯ä»¥ä¾›ç”¨æˆ·éšæ—¶éšåœ°åœ°è´¡çŒ®ç»„ä»¶ï¼Œä»¥æ»¡è¶³ä¸åŒåœºæ™¯çš„è¯‰æ±‚ã€‚</p><hr><p>éƒ¨ç½²è¿™ä¸ªéœ€è¦å…ˆå®‰è£… Node.js(&gt;&#x3D;10.8.0) çš„ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨ä¸€ä¸‹åŒ…ç®¡ç†å·¥å…· nvm</p><p>éœ€è¦ä¸€å°linuxæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°çš„linuxç³»ç»Ÿï¼Œç”¨äºéƒ¨ç½²Serverless Devs</p><p>è¿™é‡Œè®°å½•ä¸€ä¸‹å®é™…æ“ä½œï¼ˆå‚è€ƒé˜¿é‡Œäº‘æ–‡æ¡£ï¼‰</p><blockquote><p>é€šè¿‡npmåŒ…ç®¡ç†å™¨å®‰è£…</p></blockquote><p>éœ€è¦å…ˆå®‰è£…äº†npm ç¯å¢ƒï¼ŒNode.jsçš„ç‰ˆæœ¬éœ€ä¸ºNode.js 10åŠä»¥ä¸Š</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-comment">#å®‰è£…Serverless Devs</span><br><span class="hljs-built_in">npm</span> install @serverless-devs/s -g<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒéªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">s -v</span><br></code></pre></td></tr></table></figure><p>æˆåŠŸå®‰è£…åçš„æ‰§è¡Œç»“æœç¤ºä¾‹å¦‚ä¸‹:</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">@serverless-devs/s: <span class="hljs-number">3.0</span>.<span class="hljs-number">0</span>, s-home: /root/.s, linux-x64, <span class="hljs-keyword">node</span><span class="hljs-title">-v14</span>.<span class="hljs-number">16.1</span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢è¿™äº›æ­¥éª¤å‚è€ƒçš„æ˜¯åšå®¢å†…å®¹ï¼Œä¾æ¬¡æ‰§è¡Œå³å¯</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment"># æ·»åŠ å¯†é’¥ä¿¡æ¯</span><br>s config add  <br><span class="hljs-comment"># 1. äº‘å‚å•†é€‰æ‹© Alibaba Cloud (alibaba)</span><br><span class="hljs-comment"># 2. å¡«å†™åˆšæ‰è·å–çš„AccessKeyIdã€AccessKeySecret</span><br><span class="hljs-comment"># 3. ä¸ºè¿™ä¸€é…ç½®å–åˆ«åï¼Œä¹Ÿå¯ä»¥ç›´æ¥å›è½¦ï¼Œä½¿ç”¨é»˜è®¤åç§°ï¼Œä¾‹å¦‚å–åä¸ºopenai</span><br><br><span class="hljs-comment"># å®‰è£…openai-proxyä»£ç†åŒ… ç±»ä¼¼dockeré•œåƒæ˜¯ç¬¬ä¸‰æ–¹çš„</span><br>s init openai-proxy-ohyee<br><span class="hljs-comment"># 1. è¯¥ç¬¬ä¸‰æ–¹åŒ…çš„ä»“åº“é“¾æ¥ https://registry.serverless-devs.com/details.html?name=openai-proxy-ohyee</span><br><span class="hljs-comment"># 2. é¡¹ç›®åç§°è‡ªå‘½å ä¾‹å¦‚å–åä¸ºopenai-proxy</span><br><span class="hljs-comment"># 3. åœ°åŸŸé€‰æ‹©us-west-1ï¼ˆç¾è¥¿æµ·å²¸ç¡…è°·ï¼‰</span><br><span class="hljs-comment"># 4. è®¤è¯é…ç½®æ–‡ä»¶é€‰æ‹©ä¸Šä¸€æ­¥å–åˆ«åçš„é‚£ä¸ª</span><br><span class="hljs-comment"># 5. å®Œæˆåï¼Œåœ¨/rootç›®å½•ä¸‹ï¼Œä¼šæœ‰openai-proxyæ–‡ä»¶å¤¹ï¼Œå³è¿™ä¸€æ­¥å–çš„åˆ«åçš„ç›®å½•</span><br><br><span class="hljs-comment"># è¿›å…¥åˆ°è¯¥ç›®å½•</span><br><span class="hljs-keyword">cd</span> <span class="hljs-string">/root/openai-proxy</span><br><br><span class="hljs-comment"># å†è¿›å…¥åˆ°è¯¥ç›®å½•ä¸‹çš„codeç›®å½•</span><br><span class="hljs-keyword">cd</span> <span class="hljs-string">./code</span><br><br><span class="hljs-comment"># æ‰§è¡Œnpmå®‰è£…å‘½ä»¤</span><br>npm i<br><br><span class="hljs-comment"># è¿”å›ä¸Šä¸€å±‚ å³/root/openai-proxyç›®å½•</span><br><span class="hljs-keyword">cd</span> <span class="hljs-string">..</span><br><br><span class="hljs-comment"># æ‰§è¡Œéƒ¨ç½²å‘½ä»¤ - è¯¥å‘½ä»¤ä¼šåœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é‚£è¾¹ç”Ÿæˆå¯¹åº”çš„æœåŠ¡</span><br>s <span class="hljs-keyword">deploy</span>  <span class="hljs-comment"># æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥é€‰æ‹©æœ¬åœ°é…ç½®æˆ–è¿œç¨‹é…ç½® æˆ‘é€‰æ‹©çš„è¿œç¨‹ use remote</span><br></code></pre></td></tr></table></figure><blockquote><p>é˜¿é‡Œäº‘æ§åˆ¶å°æŸ¥çœ‹</p></blockquote><p>éƒ¨ç½²ååˆ°é˜¿é‡Œäº‘çš„å‡½æ•°è®¡ç®—FCä¸­æŸ¥çœ‹ï¼Œæ³¨æ„åˆ‡æ¢ä¸€ä¸‹åœ°å€åˆ°ç¾å›½ç¡…è°·</p><p>ç‚¹å‡»è¿›å…¥å‡½æ•°ç®¡ç†</p><p>ä¸€ç›´ç‚¹å‡»å‡½æ•°è¿›å…¥åˆ°å‡½æ•°è¯¦æƒ…</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240113235819.png" alt="image.png"></p><p>è¯¦æƒ…é‡Œé¢æœ‰ä¸€ä¸ªå…¬ç½‘è®¿é—®åœ°å€</p><p>å°†å®é™…ä½ éœ€è¦çš„ é“¾æ¥è¿›è¡Œæ›¿æ¢å³å¯ï¼š</p><p>æ¯”å¦‚è°ƒç”¨OpenAIçš„ç«¯å£ä¸ºï¼š<code>https://api.openai.com/v1</code>  </p><p>æ›¿æ¢ä¸º<code>https://xxx.run/v1</code>å°±å¯ä»¥äº†</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240114000222.png" alt="image.png"></p><p>é“¾æ¥çš„å…·ä½“è®¿é—®å»ºè®®å…ˆä½¿ç”¨API  è°ƒç”¨å·¥å…·çœ‹ä¸€ä¸‹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
      <category>å‡½æ•°è®¡ç®—FC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>chatgpt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ChatGPTé—®ç­”åŠ©æ‰‹</title>
    <link href="/2024/01/12/ChatGPT%E9%97%AE%E7%AD%94%E5%8A%A9%E6%89%8B/"/>
    <url>/2024/01/12/ChatGPT%E9%97%AE%E7%AD%94%E5%8A%A9%E6%89%8B/</url>
    
    <content type="html"><![CDATA[<p>å‰é¢ä¸€éƒ¨åˆ†å†…å®¹æ˜¯å¼€æºé¡¹ç›® <a href="https://github.com/fuzhengwei/chatbot-api">https://github.com/fuzhengwei/chatbot-api</a> çš„ä¸€äº›å†…å®¹ï¼Œåé¢æ˜¯å¾®ä¿¡API è°ƒç”¨å’Œ é€šä¹‰åƒé—®çš„éƒ¨åˆ†ä½¿ç”¨ä»‹ç»ã€‚</p><p>æœ¬é¡¹ç›®æ¥è‡ªçŸ¥è¯†æ˜Ÿçƒã€Šç å†œä¼šé”ã€‹çš„å¼€æºé¡¹ç›®ã€ChatGPT AI é—®ç­”åŠ©æ‰‹ã€‘</p><p>é¡¹ç›®åœ°å€ï¼š</p><ul><li><a href="https://gitcode.net/fuzhengwei/chatbot-api">https://gitcode.net/fuzhengwei/chatbot-api</a></li><li><a href="https://github.com/fuzhengwei/chatbot-api">https://github.com/fuzhengwei/chatbot-api</a></li></ul><p>æœ¬é¡¹ç›®ä½¿ç”¨åˆ°äº†åŸºæœ¬çš„é¡¹ç›®å·¥ç¨‹æ„å»ºã€SpringBootã€DDDæ¶æ„ã€Githubä»“åº“ä½¿ç”¨ã€çˆ¬è™«æ¥å£ã€é•œåƒæ‰“åŒ…ã€Dockerå®¹å™¨éƒ¨ç½²ã€‚</p><p>æ„å»ºçš„åŸºæœ¬è¿‡ç¨‹è¿™é‡Œè·³è¿‡ï¼Œè¿›å…¥åˆ°å®é™…ä½¿ç”¨å’Œåˆ†æé˜¶æ®µã€‚</p><blockquote><p>ä»‹ç»DDDæ¶æ„</p></blockquote><p>å…ˆä»‹ç»ä¸€ä¸‹ DDD æ¶æ„ï¼ŒDDD æ¶æ„å¯ä»¥æƒ³è±¡ç±»ä¼¼æ˜¯ åœ¨ MVC åˆ†å±‚çš„åŸºç¡€ä¸­å†è¿›è¡Œäº†åˆ†ç±»ï¼Œå°†æœåŠ¡ä¹‹é—´çš„è°ƒç”¨è€¦åˆå‡è½»ã€‚</p><p>DDD ï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ–¹æ³•ï¼Œä¸»è¦å…³æ³¨çš„æ˜¯ä¸šåŠ¡é¢†åŸŸå’Œä¸šåŠ¡é€»è¾‘ã€‚å¼ºè°ƒåŸºäºä¸šåŠ¡æ¨¡å‹æ¥æ„å»ºè½¯ä»¶ï¼Œä½¿å¾—è½¯ä»¶èƒ½å¤Ÿæ›´å¥½åœ°åæ˜ å’Œæ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚</p><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p><ul><li>å°†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘åˆ’åˆ†ä¸ºä¸åŒçš„é¢†åŸŸï¼Œæ¯ä¸ªé¢†åŸŸä»£è¡¨ä¸€ä¸ªä¸šåŠ¡çš„å­é›†ã€‚</li><li>é€šè¿‡ä¸°å¯Œçš„é¢†åŸŸæ¨¡å‹æ¥æ•æ‰ä¸šåŠ¡é¢†åŸŸçš„æ ¸å¿ƒæ¦‚å¿µå’Œé€»è¾‘ã€‚<br> <strong>å®ç°æ–¹å¼</strong>ï¼š</li><li>é€šå¸¸åŒ…æ‹¬å®ä½“ï¼ˆEntitiesï¼‰ã€å€¼å¯¹è±¡ï¼ˆValue Objectsï¼‰ã€é¢†åŸŸæœåŠ¡ï¼ˆDomain Servicesï¼‰ã€èšåˆï¼ˆAggregatesï¼‰å’Œä»“å‚¨ï¼ˆRepositoriesï¼‰ç­‰æ¦‚å¿µã€‚</li><li>DDD è¿˜å¼ºè°ƒé¢†åŸŸå±‚å’Œåº”ç”¨å±‚çš„åˆ†ç¦»ï¼Œç¡®ä¿ä¸šåŠ¡é€»è¾‘çš„ç‹¬ç«‹æ€§ã€‚<br><strong>ç›®çš„</strong>ï¼š</li><li>æä¾›ä¸€ç§æ–¹æ³•è®ºï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œè®¾è®¡å¤æ‚ä¸šåŠ¡ç³»ç»Ÿã€‚</li><li>é€šè¿‡é¢†åŸŸæ¨¡å‹çš„ä¸°å¯Œæ€§æ¥æé«˜è½¯ä»¶çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§</li></ul><p>æ˜Ÿçƒè¯¾ç¨‹å…¥å£ï¼š <a href="https://wx.zsxq.com/dweb2/index/columns/48411118851818">https://wx.zsxq.com/dweb2/index/columns/48411118851818</a></p><p>B ç«™è§†é¢‘åœ°å€ï¼š <a href="https://www.bilibili.com/video/BV1RR4y1b7UQ">https://www.bilibili.com/video/BV1RR4y1b7UQ</a></p><p>å¤§çº²</p><ul><li>é¡¹ç›®è¿è¡Œ</li><li>é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹åˆ†æ</li><li>äºŒå¼€ï¼ˆè®¢é˜…å·ä¿¡æ¯å›å¤ï¼‰å®šæ—¶å‘é€æ¶ˆæ¯</li><li>æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤</li><li>QQæ¶ˆæ¯å›å¤</li><li>å°è¯•å›½å†…çš„å¤§è¯­è¨€æ¨¡å‹</li></ul><h3 id="1ã€é¡¹ç›®è¿è¡Œ"><a href="#1ã€é¡¹ç›®è¿è¡Œ" class="headerlink" title="1ã€é¡¹ç›®è¿è¡Œ"></a>1ã€é¡¹ç›®è¿è¡Œ</h3><p>ä» é¡¹ç›®åœ°å€ <a href="https://gitcode.net/fuzhengwei/chatbot-api">https://gitcode.net/fuzhengwei/chatbot-api</a>  ï¼›</p><h4 id="é¡¹ç›®åŠ è½½"><a href="#é¡¹ç›®åŠ è½½" class="headerlink" title="é¡¹ç›®åŠ è½½"></a>é¡¹ç›®åŠ è½½</h4><p>æ‹‰å–é¡¹ç›®ä»£ç åï¼Œéœ€è¦åœ¨ Maven ä¸‹é¢çš„ Lifecycle ä¸‹å…ˆè¿›è¡Œæ€»ä½“çš„ä¸€ä¸ª clean å† install ï¼›</p><p>install å®Œæˆåå†é‡æ–°åŠ è½½ä¸€ä¸‹ä¾èµ–ï¼›</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240112222113.png" alt="image.png"></p><p>åœ¨è¿›è¡Œä¸Šä¸€æ­¥æ“ä½œçš„æ—¶å€™æœ¬äººå¯¹éƒ¨åˆ†æ¨¡å—å…ˆå¼•ç”¨æ‰“åŒ…åˆ°äº†æœ¬åœ° chatbot-api-commonã€  chatbot-api-domain  ï¼›ä½†è¿™ä¸ªåº”è¯¥ä¸æ˜¯å…³é”®å½±å“å› ç´ ï¼ˆå¯å¿½ç•¥ï¼‰</p><h4 id="é¡¹ç›®ç»“æ„åˆ†æ"><a href="#é¡¹ç›®ç»“æ„åˆ†æ" class="headerlink" title="é¡¹ç›®ç»“æ„åˆ†æ"></a>é¡¹ç›®ç»“æ„åˆ†æ</h4><ul><li>chatbot-api-application<ul><li>ext<ul><li>è¿›è¡Œä»»åŠ¡æ³¨å†ŒæœåŠ¡ï¼Œæ”¯æŒå¤šç»„ä»»åŠ¡é…ç½®</li></ul></li><li>job<ul><li>å®šä¹‰å®šæ—¶ä»»åŠ¡ï¼Œè¿›è¡Œæ£€ç´¢é—®é¢˜å¹¶è¿›è¡ŒAIå›ç­”ï¼ŒAIå›ç­”åè¿›è¡Œé—®é¢˜å›å¤ã€‚</li></ul></li></ul></li><li>chatbot-api-common<ul><li>å…¬å…±æœåŠ¡</li></ul></li><li>chatbot-api-domain<ul><li>é¢†åŸŸæœåŠ¡<ul><li>ai<ul><li>è°ƒç”¨ openai çš„ chatgpt æ¥å£</li></ul></li><li>zsxq<ul><li>queryUnAnsweredQuestionsTopicId  è·å–çŸ¥è¯†æ˜Ÿçƒçš„æœªå›ç­”å†…å®¹</li><li>answer   å›å¤çŸ¥è¯†æ˜Ÿçƒçš„æœªå›ç­”å†…å®¹</li></ul></li></ul></li></ul></li><li>chatbot-api-infrastructure<ul><li>èšåˆ</li></ul></li><li>chatbot-api-interface<ul><li>å¯åŠ¨ç±»</li></ul></li></ul><hr><h3 id="2ã€é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹åˆ†æ"><a href="#2ã€é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹åˆ†æ" class="headerlink" title="2ã€é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹åˆ†æ"></a>2ã€é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹åˆ†æ</h3><p>æ ¹æ®è§†é¢‘æ•™ç¨‹å†…å®¹æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªçŸ¥è¯†æ˜Ÿçƒï¼Œè·å–å…¶ä¸­åˆ†æ â€ç­‰æˆ‘å›ç­”ä¸­çš„ä¿¡æ¯â€ï¼Œä¸è¿‡è¿™é‡ŒçŸ¥è¯†æ˜Ÿçƒå®ƒåˆ›å»ºå…è´¹æ˜Ÿçƒæœ‰é™åˆ¶ï¼Œè€Œåˆ›å»ºæ”¶è´¹æ˜Ÿçƒé™åˆ¶æœ€å°‘æ”¶è´¹50ï¼›</p><p>ä¸‹é¢ä¸»è¦åˆ†æä¸€ä¸‹å…¶é¢†åŸŸæœåŠ¡æ ¸å¿ƒå†…å®¹å®ç°æµç¨‹ã€‚</p><p>æµ‹è¯•åŒ… cn.bugstack.chatbot.api.test ä¸‹ç±»ApiTest æ–¹æ³•åˆ†æ</p><p>è¿™é‡Œå¤§è‡´çš„ä¸€ä¸ªå®ç°æ€è·¯ï¼š</p><p>é¦–å…ˆæ˜¯é€šè¿‡æŸ¥è¯¢â€œæœªå›ç­”é—®é¢˜â€çˆ¬å–çŸ¥è¯†æ˜Ÿçƒçš„æ¥å£ä¿¡æ¯ï¼Œç„¶åæ˜¯é€šè¿‡ chatgpt å›å¤ç›¸å…³å†…å®¹ï¼ˆæ¶‰åŠåˆ°ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯å›ç­”çŸ¥è¯†æ˜Ÿçƒçš„ç›¸å…³é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯è°ƒç”¨ openai çš„ chatgpt æ¥å£è¿”å›æ•°æ®ï¼‰</p><p>è¿™é‡Œæ¥æ‰§è¡Œå›å¤æ“ä½œæ˜¯é€šè¿‡å®šæ—¶ä»»åŠ¡æ¥è¿›è¡Œæ‰§è¡Œçš„ï¼Œåœ¨æ•™ç¨‹è§†é¢‘ï¼š <a href="https://www.bilibili.com/video/BV1XR4y1h7JP/">https://www.bilibili.com/video/BV1XR4y1h7JP/</a></p><p>æåŠåˆ°äº†ä¸€ä¸ªå¤šç»„ä»»åŠ¡æœåŠ¡é…ç½®çš„æŠ€æœ¯å®ç°ï¼Œæ˜¯é€šè¿‡å°†åŒä¸€å¥—æµç¨‹ä½†ä¸åŒçˆ¬å–æ¥å£æ–¹ï¼ˆæ¯”å¦‚ï¼šçŸ¥è¯†æ˜Ÿçƒçš„å¤šä¸ªç¾¤å¯¹åº”å¤šä¸ªé…ç½®)ï¼›to be continedâ€¦</p><h4 id="æŸ¥è¯¢â€œæœªå›ç­”é—®é¢˜â€"><a href="#æŸ¥è¯¢â€œæœªå›ç­”é—®é¢˜â€" class="headerlink" title="æŸ¥è¯¢â€œæœªå›ç­”é—®é¢˜â€"></a>æŸ¥è¯¢â€œæœªå›ç­”é—®é¢˜â€</h4><p>çˆ¬å–çŸ¥è¯†æ˜Ÿçƒçš„æ¥å£ä¿¡æ¯æ“ä½œ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs csharp">@Test<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">query_unanswered_questions</span>() throws IOException</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ HttpClientBuilder åˆ›å»ºä¸€ä¸ª CloseableHttpClient å®ä¾‹ã€‚</span><br>    CloseableHttpClient httpClient = HttpClientBuilder.create().build();<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª HttpGet è¯·æ±‚å¯¹è±¡ï¼ŒURL æŒ‡å‘çŸ¥è¯†æ˜ŸçƒAPIçš„ç‰¹å®šç«¯ç‚¹ã€‚</span><br>    <span class="hljs-comment">// è¿™ä¸ªç«¯ç‚¹ç”¨äºè·å–æŒ‡å®šç¾¤ç»„ä¸­çš„â€œæœªå›ç­”é—®é¢˜â€ã€‚</span><br>    HttpGet <span class="hljs-keyword">get</span> = <span class="hljs-keyword">new</span> HttpGet(<span class="hljs-string">&quot;https://api.zsxq.com/v2/groups/48411118851818/topics?scope=unanswered_questions&amp;count=20&quot;</span>);<br><br>    <span class="hljs-comment">// æ·»åŠ è¯·æ±‚å¤´ã€‚è¿™é‡Œçš„ &quot;cookie&quot; éœ€è¦æ›¿æ¢ä¸ºæœ‰æ•ˆçš„çŸ¥è¯†æ˜Ÿçƒä¸ªäººcookieä¿¡æ¯ï¼Œç”¨äºèº«ä»½éªŒè¯ã€‚</span><br>    <span class="hljs-keyword">get</span>.addHeader(<span class="hljs-string">&quot;cookie&quot;</span>, <span class="hljs-string">&quot;çŸ¥è¯†æ˜Ÿçƒä¸ªäººcookieä¿¡æ¯&quot;</span>);<br><br>    <span class="hljs-comment">// è®¾ç½®è¯·æ±‚çš„å†…å®¹ç±»å‹ä¸º JSONï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†ä¸º UTF-8ã€‚</span><br>    <span class="hljs-keyword">get</span>.addHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json;charset=utf8&quot;</span>);<br><br>    <span class="hljs-comment">// æ‰§è¡Œ HTTP GET è¯·æ±‚å¹¶è·å–å“åº”ã€‚</span><br>    CloseableHttpResponse response = httpClient.execute(<span class="hljs-keyword">get</span>);<br><br>    <span class="hljs-comment">// æ£€æŸ¥å“åº”çŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç ä¸º 200 (HttpStatus.SC_OK)ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚</span><br>    <span class="hljs-keyword">if</span> (response.getStatusLine().getStatusCode() == HttpStatus.SC_OK) &#123;<br>        <span class="hljs-comment">// å°†å“åº”å®ä½“è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚è¿™é€šå¸¸æ˜¯ JSON æ ¼å¼çš„æ•°æ®ã€‚</span><br>        String res = EntityUtils.toString(response.getEntity());<br>        System.<span class="hljs-keyword">out</span>.println(res);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœçŠ¶æ€ç ä¸æ˜¯ 200ï¼Œæ‰“å°å‡ºçŠ¶æ€ç ã€‚</span><br>        <span class="hljs-comment">// è¿™å¯èƒ½è¡¨æ˜è¯·æ±‚å‡ºé”™æˆ–å…¶ä»–é—®é¢˜ã€‚</span><br>        System.<span class="hljs-keyword">out</span>.println(response.getStatusLine().getStatusCode());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šéœ€è¦æ­£ç¡®è®¾ç½®çŸ¥è¯†æ˜Ÿçƒçš„ä¸ªäººcookieä¿¡æ¯æ‰èƒ½æˆåŠŸå‘èµ·è¯·æ±‚ï¼Œä¿¡æ¯ä»æµè§ˆå™¨çš„F12ä¸­æŸ¥çœ‹ã€‚</p><h4 id="å›ç­”ç›¸å…³é—®é¢˜"><a href="#å›ç­”ç›¸å…³é—®é¢˜" class="headerlink" title="å›ç­”ç›¸å…³é—®é¢˜"></a>å›ç­”ç›¸å…³é—®é¢˜</h4><p>ç”¨äºå›ç­”çŸ¥è¯†æ˜Ÿçƒå¹³å°ä¸Šçš„æŸä¸ªç‰¹å®šè¯é¢˜</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs wren">@<span class="hljs-title class_">Test</span><br><span class="hljs-variable">public</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">answer</span>() <span class="hljs-variable">throws</span> <span class="hljs-title class_">IOException</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ HttpClientBuilder åˆ›å»ºä¸€ä¸ª CloseableHttpClient å®ä¾‹ã€‚</span><br>    <span class="hljs-title class_">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">HttpClientBuilder</span>.<span class="hljs-property">create</span>().<span class="hljs-property">build</span>();<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª HttpPost è¯·æ±‚å¯¹è±¡ï¼ŒURL æŒ‡å‘çŸ¥è¯†æ˜ŸçƒAPIçš„ç‰¹å®šç«¯ç‚¹ã€‚</span><br>    <span class="hljs-comment">// è¿™ä¸ªç«¯ç‚¹ç”¨äºå›ç­”ä¸€ä¸ªæŒ‡å®šçš„è¯é¢˜ã€‚</span><br>    <span class="hljs-title class_">HttpPost</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">HttpPost</span>(<span class="hljs-string">&quot;https://api.zsxq.com/v2/topics/412884248251548/answer&quot;</span>);<br><br>    <span class="hljs-comment">// æ·»åŠ è¯·æ±‚å¤´ã€‚è¿™é‡Œçš„ &quot;cookie&quot; éœ€è¦æ›¿æ¢ä¸ºæœ‰æ•ˆçš„çŸ¥è¯†æ˜Ÿçƒä¸ªäººcookieä¿¡æ¯ï¼Œç”¨äºèº«ä»½éªŒè¯ã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">addHeader</span>(<span class="hljs-string">&quot;cookie&quot;</span>, <span class="hljs-string">&quot;çŸ¥è¯†æ˜Ÿçƒä¸ªäººcookieä¿¡æ¯&quot;</span>);<br><br>    <span class="hljs-comment">// è®¾ç½®è¯·æ±‚çš„å†…å®¹ç±»å‹ä¸º JSONï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†ä¸º UTF-8ã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">addHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json;charset=utf8&quot;</span>);<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä½œä¸º POST è¯·æ±‚çš„å‚æ•°ã€‚</span><br>    <span class="hljs-comment">// è¿™é‡Œçš„å‚æ•°åŒ…æ‹¬å›ç­”çš„æ–‡æœ¬ã€å›¾ç‰‡IDï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å’Œæ˜¯å¦é™éŸ³ï¼ˆsilencedï¼‰ã€‚</span><br>    <span class="hljs-title class_">String</span> <span class="hljs-variable">paramJson</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;  <span class="hljs-char escape_">\&quot;</span>req_data<span class="hljs-char escape_">\&quot;</span>: &#123;<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;    <span class="hljs-char escape_">\&quot;</span>text<span class="hljs-char escape_">\&quot;</span>: <span class="hljs-char escape_">\&quot;</span>è‡ªå·±å»ç™¾åº¦ï¼<span class="hljs-char escape_">\\</span>n<span class="hljs-char escape_">\&quot;</span>,<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;    <span class="hljs-char escape_">\&quot;</span>image_ids<span class="hljs-char escape_">\&quot;</span>: [],<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;    <span class="hljs-char escape_">\&quot;</span>silenced<span class="hljs-char escape_">\&quot;</span>: false<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;  &#125;<span class="hljs-char escape_">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>            <span class="hljs-string">&quot;&#125;&quot;</span>;<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª StringEntity æ¥å°è£… JSON å‚æ•°ï¼Œè®¾ç½®å…¶å†…å®¹ç±»å‹å’Œç¼–ç ã€‚</span><br>    <span class="hljs-title class_">StringEntity</span> <span class="hljs-variable">stringEntity</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">StringEntity</span>(<span class="hljs-variable">paramJson</span>, <span class="hljs-title class_">ContentType</span>.<span class="hljs-property">create</span>(<span class="hljs-string">&quot;text/json&quot;</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>));<br><br>    <span class="hljs-comment">// å°†å°è£…å¥½çš„å‚æ•°è®¾ç½®åˆ° POST è¯·æ±‚ä¸­ã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">setEntity</span>(<span class="hljs-variable">stringEntity</span>);<br><br>    <span class="hljs-comment">// æ‰§è¡Œ HTTP POST è¯·æ±‚å¹¶è·å–å“åº”ã€‚</span><br>    <span class="hljs-title class_">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-variable">httpClient</span>.<span class="hljs-property">execute</span>(<span class="hljs-variable">post</span>);<br><br>    <span class="hljs-comment">// æ£€æŸ¥å“åº”çŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç ä¸º 200 (HttpStatus.SC_OK)ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">response</span>.<span class="hljs-property">getStatusLine</span>().<span class="hljs-property">getStatusCode</span>() <span class="hljs-operator">==</span> <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">SC_OK</span>) &#123;<br>        <span class="hljs-comment">// å°†å“åº”å®ä½“è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚è¿™é€šå¸¸æ˜¯ JSON æ ¼å¼çš„æ•°æ®ã€‚</span><br>        <span class="hljs-title class_">String</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">EntityUtils</span>.<span class="hljs-property">toString</span>(<span class="hljs-variable">response</span>.<span class="hljs-property">getEntity</span>());<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-property">println</span>(<span class="hljs-variable">res</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœçŠ¶æ€ç ä¸æ˜¯ 200ï¼Œæ‰“å°å‡ºçŠ¶æ€ç ã€‚</span><br>        <span class="hljs-comment">// è¿™å¯èƒ½è¡¨æ˜è¯·æ±‚å‡ºé”™æˆ–å…¶ä»–é—®é¢˜ã€‚</span><br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-property">println</span>(<span class="hljs-variable">response</span>.<span class="hljs-property">getStatusLine</span>().<span class="hljs-property">getStatusCode</span>());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-ChatGPT-æ¨¡å‹ç”Ÿæˆæ–‡æœ¬"><a href="#ä½¿ç”¨-ChatGPT-æ¨¡å‹ç”Ÿæˆæ–‡æœ¬" class="headerlink" title="ä½¿ç”¨ ChatGPT æ¨¡å‹ç”Ÿæˆæ–‡æœ¬"></a>ä½¿ç”¨ ChatGPT æ¨¡å‹ç”Ÿæˆæ–‡æœ¬</h4><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs wren">@<span class="hljs-title class_">Test</span><br><span class="hljs-variable">public</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">test_chatGPT</span>() <span class="hljs-variable">throws</span> <span class="hljs-title class_">IOException</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ HttpClientBuilder åˆ›å»ºä¸€ä¸ª CloseableHttpClient å®ä¾‹ã€‚</span><br>    <span class="hljs-title class_">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">HttpClientBuilder</span>.<span class="hljs-property">create</span>().<span class="hljs-property">build</span>();<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª HttpPost è¯·æ±‚å¯¹è±¡ï¼ŒURL è®¾ç½®ä¸º OpenAI API çš„åœ°å€ã€‚</span><br>    <span class="hljs-title class_">HttpPost</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">HttpPost</span>(<span class="hljs-string">&quot;https://api.openai.com/v1/completions&quot;</span>);<br><br>    <span class="hljs-comment">// è®¾ç½®è¯·æ±‚å¤´ï¼ŒæŒ‡å®šå†…å®¹ç±»å‹ä¸º JSONã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">addHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>);<br><br>    <span class="hljs-comment">// è®¾ç½®æˆæƒå¤´ã€‚&quot;Bearer è‡ªè¡Œç”³è¯· https://beta.openai.com/overview&quot; éœ€è¦æ›¿æ¢ä¸ºæœ‰æ•ˆçš„æˆæƒä»¤ç‰Œã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">addHeader</span>(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;Bearer è‡ªè¡Œç”³è¯· https://beta.openai.com/overview&quot;</span>);<br><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª JSON å­—ç¬¦ä¸²ä½œä¸ºè¯·æ±‚ä½“ã€‚è¿™é‡ŒæŒ‡å®šæ¨¡å‹ä¸º &quot;text-davinci-003&quot;ï¼Œ</span><br>    <span class="hljs-comment">// æç¤ºè¯ä¸º &quot;å¸®æˆ‘å†™ä¸€ä¸ªjavaå†’æ³¡æ’åº&quot;ï¼Œæ¸©åº¦è®¾ç½®ä¸º0ï¼ˆç”Ÿæˆæ–‡æœ¬çš„ç¡®å®šæ€§æ›´é«˜ï¼‰ï¼Œ</span><br>    <span class="hljs-comment">// å¹¶ä¸”æœ€å¤§ä»¤ç‰Œæ•°è®¾ç½®ä¸º1024ã€‚</span><br>    <span class="hljs-title class_">String</span> <span class="hljs-variable">paramJson</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;<span class="hljs-char escape_">\&quot;</span>model<span class="hljs-char escape_">\&quot;</span>: <span class="hljs-char escape_">\&quot;</span>text-davinci-003<span class="hljs-char escape_">\&quot;</span>, <span class="hljs-char escape_">\&quot;</span>prompt<span class="hljs-char escape_">\&quot;</span>: <span class="hljs-char escape_">\&quot;</span>å¸®æˆ‘å†™ä¸€ä¸ªjavaå†’æ³¡æ’åº<span class="hljs-char escape_">\&quot;</span>, <span class="hljs-char escape_">\&quot;</span>temperature<span class="hljs-char escape_">\&quot;</span>: 0, <span class="hljs-char escape_">\&quot;</span>max_tokens<span class="hljs-char escape_">\&quot;</span>: 1024&#125;&quot;</span>;<br><br>    <span class="hljs-comment">// å°† JSON å‚æ•°å°è£…åˆ°ä¸€ä¸ª StringEntity å¯¹è±¡ä¸­ï¼Œå¹¶è®¾ç½®å…¶å†…å®¹ç±»å‹å’Œç¼–ç ã€‚</span><br>    <span class="hljs-title class_">StringEntity</span> <span class="hljs-variable">stringEntity</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">StringEntity</span>(<span class="hljs-variable">paramJson</span>, <span class="hljs-title class_">ContentType</span>.<span class="hljs-property">create</span>(<span class="hljs-string">&quot;text/json&quot;</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>));<br><br>    <span class="hljs-comment">// å°†å°è£…å¥½çš„å‚æ•°æ·»åŠ åˆ° POST è¯·æ±‚ä¸­ã€‚</span><br>    <span class="hljs-variable">post</span>.<span class="hljs-property">setEntity</span>(<span class="hljs-variable">stringEntity</span>);<br><br>    <span class="hljs-comment">// æ‰§è¡Œ HTTP POST è¯·æ±‚å¹¶è·å–å“åº”ã€‚</span><br>    <span class="hljs-title class_">CloseableHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-variable">httpClient</span>.<span class="hljs-property">execute</span>(<span class="hljs-variable">post</span>);<br><br>    <span class="hljs-comment">// æ£€æŸ¥å“åº”çŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç ä¸º 200 (HttpStatus.SC_OK)ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">response</span>.<span class="hljs-property">getStatusLine</span>().<span class="hljs-property">getStatusCode</span>() <span class="hljs-operator">==</span> <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">SC_OK</span>) &#123;<br>        <span class="hljs-comment">// å°†å“åº”å®ä½“è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°ã€‚è¿™é€šå¸¸æ˜¯ JSON æ ¼å¼çš„æ•°æ®ï¼ŒåŒ…å«ç”±æ¨¡å‹ç”Ÿæˆçš„æ–‡æœ¬ã€‚</span><br>        <span class="hljs-title class_">String</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">EntityUtils</span>.<span class="hljs-property">toString</span>(<span class="hljs-variable">response</span>.<span class="hljs-property">getEntity</span>());<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-property">println</span>(<span class="hljs-variable">res</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœçŠ¶æ€ç ä¸æ˜¯ 200ï¼Œæ‰“å°å‡ºçŠ¶æ€ç ã€‚</span><br>        <span class="hljs-comment">// è¿™å¯èƒ½è¡¨æ˜è¯·æ±‚å‡ºé”™æˆ–å…¶ä»–é—®é¢˜ã€‚</span><br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-property">println</span>(<span class="hljs-variable">response</span>.<span class="hljs-property">getStatusLine</span>().<span class="hljs-property">getStatusCode</span>());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å®šæ—¶ä»»åŠ¡è¿›è¡Œçˆ¬å–é—®é¢˜å¹¶è¿›è¡Œå›å¤"><a href="#å®šæ—¶ä»»åŠ¡è¿›è¡Œçˆ¬å–é—®é¢˜å¹¶è¿›è¡Œå›å¤" class="headerlink" title="å®šæ—¶ä»»åŠ¡è¿›è¡Œçˆ¬å–é—®é¢˜å¹¶è¿›è¡Œå›å¤"></a>å®šæ—¶ä»»åŠ¡è¿›è¡Œçˆ¬å–é—®é¢˜å¹¶è¿›è¡Œå›å¤</h4><p>æ ¸å¿ƒæ–¹æ³•æ˜¯ ChatbotTaskä¸‹é‡å†™çš„ run æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// éšæœºå†³å®šæ˜¯å¦æ‰§è¡Œæ­¤æ¬¡ä»»åŠ¡ã€‚</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextBoolean()) &#123;<br>            logger.info(<span class="hljs-string">&quot;&#123;&#125; éšæœºæ‰“çƒŠä¸­...&quot;</span>, groupName);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// è·å–å½“å‰æ—¶é—´ã€‚</span><br>        <span class="hljs-type">GregorianCalendar</span> <span class="hljs-variable">calendar</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GregorianCalendar</span>();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">hour</span> <span class="hljs-operator">=</span> calendar.get(Calendar.HOUR_OF_DAY);<br><br>        <span class="hljs-comment">// åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨éå·¥ä½œæ—¶é—´ï¼ˆæ™šä¸Š 22 ç‚¹åæˆ–æ—©ä¸Š 7 ç‚¹å‰ï¼‰ã€‚</span><br>        <span class="hljs-keyword">if</span> (hour &gt; <span class="hljs-number">22</span> || hour &lt; <span class="hljs-number">7</span>) &#123;<br>            logger.info(<span class="hljs-string">&quot;&#123;&#125; æ‰“çƒŠæ—¶é—´ä¸å·¥ä½œï¼ŒAI ä¸‹ç­äº†ï¼&quot;</span>, groupName);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 1. æ£€ç´¢é—®é¢˜ï¼šä»æŸ API è·å–æœªå›ç­”çš„é—®é¢˜ã€‚</span><br>        <span class="hljs-type">UnAnsweredQuestionsAggregates</span> <span class="hljs-variable">unAnsweredQuestionsAggregates</span> <span class="hljs-operator">=</span> zsxqApi.queryUnAnsweredQuestionsTopicId(groupId, cookie);<br>        logger.info(<span class="hljs-string">&quot;&#123;&#125; æ£€ç´¢ç»“æœï¼š&#123;&#125;&quot;</span>, groupName, JSON.toJSONString(unAnsweredQuestionsAggregates));<br>        List&lt;Topics&gt; topics = unAnsweredQuestionsAggregates.getResp_data().getTopics();<br><br>        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ£€ç´¢åˆ°æœªå›ç­”çš„é—®é¢˜ã€‚</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == topics || topics.isEmpty()) &#123;<br>            logger.info(<span class="hljs-string">&quot;&#123;&#125; æœ¬æ¬¡æ£€ç´¢æœªæŸ¥è¯¢åˆ°å¾…ä¼šç­”é—®é¢˜&quot;</span>, groupName);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 2. AI å›ç­”ï¼šä½¿ç”¨ AIï¼ˆå¯èƒ½æ˜¯ ChatGPT æˆ–ç±»ä¼¼æœåŠ¡ï¼‰æ¥ç”Ÿæˆå›ç­”ã€‚</span><br>        <span class="hljs-type">Topics</span> <span class="hljs-variable">topic</span> <span class="hljs-operator">=</span> topics.get(topics.size() - <span class="hljs-number">1</span>); <span class="hljs-comment">// å–æœ€åä¸€ä¸ªé—®é¢˜è¿›è¡Œå›ç­”ã€‚</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">answer</span> <span class="hljs-operator">=</span> openAI.doChatGPT(openAiKey, topic.getQuestion().getText().trim());<br><br>        <span class="hljs-comment">// 3. é—®é¢˜å›å¤ï¼šå°† AI ç”Ÿæˆçš„å›ç­”å‘é€å› APIã€‚</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> zsxqApi.answer(groupId, cookie, topic.getTopic_id(), answer, silenced);<br>        logger.info(<span class="hljs-string">&quot;&#123;&#125; ç¼–å·ï¼š&#123;&#125; é—®é¢˜ï¼š&#123;&#125; å›ç­”ï¼š&#123;&#125; çŠ¶æ€ï¼š&#123;&#125;&quot;</span>, groupName, topic.getTopic_id(), topic.getQuestion().getText(), answer, status);<br><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        <span class="hljs-comment">// è®°å½•ä»»ä½•å¼‚å¸¸ã€‚</span><br>        logger.error(<span class="hljs-string">&quot;&#123;&#125; è‡ªåŠ¨å›ç­”é—®é¢˜å¼‚å¸¸&quot;</span>, groupName, e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å¤šç»„ä»»åŠ¡é…ç½®æ“ä½œ"><a href="#å¤šç»„ä»»åŠ¡é…ç½®æ“ä½œ" class="headerlink" title="å¤šç»„ä»»åŠ¡é…ç½®æ“ä½œ"></a>å¤šç»„ä»»åŠ¡é…ç½®æ“ä½œ</h4><p>TaskRegistrarAutoConfig é…ç½®ç±», è¿™ä¸ªç±»æ˜¯ç”¨äºé…ç½®å’Œå®‰æ’ä¸€ç³»åˆ—çš„å®šæ—¶ä»»åŠ¡</p><p>ä¸‹é¢æ˜¯å…¶ä¸­çš„ä¸¤ä¸ªæ–¹æ³•çš„è¯´æ˜å’Œé˜è¿°ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setEnvironment</span>(<span class="hljs-params">Environment environment</span>) &#123;<br>    <span class="hljs-comment">// è®¾ç½®é…ç½®å‰ç¼€ã€‚</span><br>    <span class="hljs-title class_">String</span> prefix = <span class="hljs-string">&quot;chatbot-api.&quot;</span>;<br><br>    <span class="hljs-comment">// ä»ç¯å¢ƒå˜é‡ä¸­è·å–é…ç½®é¡¹ &#x27;chatbot-api.launchList&#x27;ã€‚</span><br>    <span class="hljs-title class_">String</span> launchListStr = environment.<span class="hljs-title function_">getProperty</span>(prefix + <span class="hljs-string">&quot;launchList&quot;</span>);<br><br>    <span class="hljs-comment">// å¦‚æœé…ç½®é¡¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å›ã€‚</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isEmpty</span>(launchListStr)) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-comment">// åˆ†å‰²é…ç½®å­—ç¬¦ä¸²ï¼Œéå†æ¯ä¸ªç»„é”®ã€‚</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> groupKey : launchListStr.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;,&quot;</span>)) &#123;<br>        <span class="hljs-comment">// æ ¹æ®ç»„é”®è·å–ç›¸å…³çš„ä»»åŠ¡ç»„å±æ€§ã€‚</span><br>        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; taskGroupProps = <span class="hljs-title class_">PropertyUtil</span>.<span class="hljs-title function_">handle</span>(environment, prefix + groupKey, <span class="hljs-title class_">Map</span>.<span class="hljs-property">class</span>);<br><br>        <span class="hljs-comment">// å°†ä»»åŠ¡ç»„å±æ€§å­˜å‚¨åœ¨ taskGroupMap ä¸­ã€‚</span><br>        taskGroupMap.<span class="hljs-title function_">put</span>(groupKey, taskGroupProps);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä»åº”ç”¨ç¨‹åºçš„ç¯å¢ƒå˜é‡ä¸­è¯»å–ä»»åŠ¡é…ç½®ã€‚</li><li>å°†é…ç½®å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ï¼Œåˆ†ç»„é”®ï¼‰åˆ†å‰²å¹¶éå†æ¯ä¸ªåˆ†ç»„ã€‚</li><li>å¯¹äºæ¯ä¸ªåˆ†ç»„é”®ï¼Œè·å–å…¶ç›¸å…³å±æ€§å¹¶å­˜å‚¨åœ¨ <code>taskGroupMap</code> ä¸­ã€‚</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-meta">@Override</span><br>public <span class="hljs-keyword">void</span> configureTasks(ScheduledTaskRegistrar taskRegistrar) &#123;<br>    <span class="hljs-comment">// è·å–æ‰€æœ‰ä»»åŠ¡ç»„çš„é”®é›†ã€‚</span><br>    <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; taskGroups = taskGroupMap.keySet();<br><br>    <span class="hljs-comment">// éå†æ¯ä¸ªä»»åŠ¡ç»„çš„é”®ã€‚</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">String</span> groupKey : taskGroups) &#123;<br>        <span class="hljs-comment">// è·å–æ¯ä¸ªä»»åŠ¡ç»„çš„é…ç½®ã€‚</span><br>        <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt; taskGroup = taskGroupMap.<span class="hljs-keyword">get</span>(groupKey);<br><br>        <span class="hljs-comment">// ä»é…ç½®ä¸­æå–ä»»åŠ¡ç›¸å…³ä¿¡æ¯ã€‚</span><br>        <span class="hljs-built_in">String</span> groupName = taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;groupName&quot;</span>).toString();<br>        <span class="hljs-built_in">String</span> groupId = taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;groupId&quot;</span>).toString();<br>        <span class="hljs-built_in">String</span> cookie = taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;cookie&quot;</span>).toString();<br>        <span class="hljs-built_in">String</span> openAiKey = taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;openAiKey&quot;</span>).toString();<br>        <span class="hljs-built_in">String</span> cronExpressionBase64 = taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;cronExpression&quot;</span>).toString();<br><br>        <span class="hljs-comment">// è§£ç  Base64 ç¼–ç çš„ cron è¡¨è¾¾å¼ã€‚</span><br>        <span class="hljs-built_in">String</span> cronExpression = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(Base64.getDecoder().decode(cronExpressionBase64), StandardCharsets.UTF_8);<br><br>        <span class="hljs-comment">// è·å–æ˜¯å¦é™éŸ³çš„å¸ƒå°”å€¼ã€‚</span><br>        boolean silenced = Boolean.parseBoolean(taskGroup.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;silenced&quot;</span>).toString());<br><br>        <span class="hljs-comment">// è®°å½•æ—¥å¿—ä¿¡æ¯ã€‚</span><br>        logger.info(<span class="hljs-string">&quot;åˆ›å»ºä»»åŠ¡ groupNameï¼š&#123;&#125; groupIdï¼š&#123;&#125; cronExpressionï¼š&#123;&#125;&quot;</span>, groupName, groupId, cronExpression);<br><br>        <span class="hljs-comment">// æ·»åŠ å®šæ—¶ä»»åŠ¡ã€‚</span><br>        taskRegistrar.addCronTask(<span class="hljs-keyword">new</span> ChatbotTask(groupName, groupId, cookie, openAiKey, zsxqApi, openAI, silenced), cronExpression);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é…ç½®å’Œå®‰æ’å®šæ—¶ä»»åŠ¡ã€‚</li><li>éå†ä¹‹å‰åœ¨ <code>setEnvironment</code> æ–¹æ³•ä¸­è®¾ç½®çš„ä»»åŠ¡ç»„ã€‚</li><li>ä»æ¯ä¸ªä»»åŠ¡ç»„é…ç½®ä¸­æå–å¿…è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»»åŠ¡åç§°ã€ç¾¤ç»„ IDã€cookieã€OpenAI å¯†é’¥ã€cron è¡¨è¾¾å¼å’Œé™éŸ³æ ‡å¿—ã€‚</li><li>å¯¹ Base64 ç¼–ç çš„ cron è¡¨è¾¾å¼è¿›è¡Œè§£ç ã€‚</li><li>åˆ›å»ºå¹¶å®‰æ’æ¯ä¸ªä»»åŠ¡ï¼Œä½¿ç”¨æå–çš„ä¿¡æ¯åˆå§‹åŒ– <code>ChatbotTask</code> å¹¶å°†å…¶æ·»åŠ åˆ° <code>ScheduledTaskRegistrar</code>ã€‚</li></ul><h4 id="é¡¹ç›®è¿è¡Œ-ğŸ¦…ğŸ¦…"><a href="#é¡¹ç›®è¿è¡Œ-ğŸ¦…ğŸ¦…" class="headerlink" title="é¡¹ç›®è¿è¡Œ ğŸ¦…ğŸ¦…"></a>é¡¹ç›®è¿è¡Œ ğŸ¦…ğŸ¦…</h4><p>ä¸ªäººå……å€¼ openai çš„ key å­˜åœ¨é—®é¢˜ï¼Œè¿™é‡Œæ˜¯ä½¿ç”¨æ·˜å®ç¬¬ä¸‰æ–¹è´­ä¹°çš„ apikey</p><p>to  be continedâ€¦.</p><h3 id="3ã€äºŒå¼€ï¼ˆè®¢é˜…å·ä¿¡æ¯å›å¤ï¼‰å®šæ—¶å‘é€æ¶ˆæ¯"><a href="#3ã€äºŒå¼€ï¼ˆè®¢é˜…å·ä¿¡æ¯å›å¤ï¼‰å®šæ—¶å‘é€æ¶ˆæ¯" class="headerlink" title="3ã€äºŒå¼€ï¼ˆè®¢é˜…å·ä¿¡æ¯å›å¤ï¼‰å®šæ—¶å‘é€æ¶ˆæ¯"></a>3ã€äºŒå¼€ï¼ˆè®¢é˜…å·ä¿¡æ¯å›å¤ï¼‰å®šæ—¶å‘é€æ¶ˆæ¯</h3><p>æœ‰ä¸€ä¸ªå…¬ä¼—å·å®šæ—¶æ¨é€çš„å¼€æºé¡¹ç›®ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ï¼š  <a href="https://gitee.com/love_c/wechatPush?_from=gitee_searc">https://gitee.com/love_c/wechatPush?_from=gitee_searc</a></p><p>å¾®ä¿¡å…¬ä¼—å·å›å¤çš„åšå®¢ï¼š <a href="https://cloud.tencent.com/developer/article/1641549">https://cloud.tencent.com/developer/article/1641549</a></p><p>å…¶åšå®¢å†…å®¹çš„ä»£ç åœ°å€ï¼š <a href="https://github.com/tsmyk0715/wechatproject">https://github.com/tsmyk0715/wechatproject</a> ï¼ˆè¿™ä¸ªé¡¹ç›®è¿˜æ˜¯å››å¹´å‰çš„é¡¹ç›®ï¼‰</p><p>å°è¯•åç»­ä½¿ç”¨ä¸€ä¸‹ WxJava è¿™ä¸ªå¼€æºé¡¹ç›®çš„ç›¸å…³å†…å®¹ ï¼š <a href="https://gitee.com/binary/weixin-java-tools">https://gitee.com/binary/weixin-java-tools</a></p><hr><p>å®é™…è¿è¡Œçš„æ—¶å€™å‘ç°è¿™é‡Œçš„æ¥å£å‚æ•°è¿˜æ˜¯éœ€è¦ä½¿ç”¨æµ‹è¯•å·ï¼Œå¦‚æœä½¿ç”¨ä¸ªäººå·çš„è¯æœ‰æƒé™é™åˆ¶ï¼Œå¾®ä¿¡å¾ˆå¤šæ¥å£ä¸èƒ½ä½¿ç”¨ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚æˆ–è€…ä»¥åæœ‰æœºä¼šæ‹¥æœ‰è‡ªå·±çš„æœåŠ¡å·ã€‚</p><p>æµ‹è¯•å·ç”³è¯·åœ°å€ï¼š <a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login">https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login</a></p><h4 id="å®šåˆ¶åŒ–å‘é€æ¶ˆæ¯æ¨¡æ¿"><a href="#å®šåˆ¶åŒ–å‘é€æ¶ˆæ¯æ¨¡æ¿" class="headerlink" title="å®šåˆ¶åŒ–å‘é€æ¶ˆæ¯æ¨¡æ¿"></a>å®šåˆ¶åŒ–å‘é€æ¶ˆæ¯æ¨¡æ¿</h4><p>wechatPush è¿™ä¸ªå¼€æºé¡¹ç›®ä¸­ä¸»è¦çš„å·¥å…·ç±»æ˜¯ï¼š PushUtil</p><p>è¿™é‡Œè¿›è¡Œéƒ¨åˆ†åˆ†æï¼Œè¯¥å·¥å…·ç±» PushUtil ä¸‹ çš„ push æ–¹æ³•æ˜¯ å®šä¹‰äº†ä¸€ä¸ªå¾®ä¿¡æ¶ˆæ¯æ¨é€çš„æ–¹æ³•ã€‚å®ƒåˆ›å»ºå’Œå‘é€å®šåˆ¶åŒ–çš„æ¨¡æ¿æ¶ˆæ¯ç»™ç‰¹å®šçš„ç”¨æˆ·</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¶ˆæ¯æ¨é€ä¸»è¦ä¸šåŠ¡ä»£ç </span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">push</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª CloseableHttpClient å®ä¾‹ã€‚</span><br>    <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClientBuilder.create().build();<br><br>    <span class="hljs-comment">// æ„å»ºå¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯ã€‚</span><br>    <span class="hljs-type">WxMpTemplateMessage</span> <span class="hljs-variable">templateMessage</span> <span class="hljs-operator">=</span> WxMpTemplateMessage.builder()<br>            .templateId(PushConfigure.getTemplateId())<br>            .build();<br><br>    <span class="hljs-comment">// è®¡ç®—ä¸ç‰¹å®šæ—¥æœŸç›¸å…³çš„å¤©æ•°ï¼Œä¾‹å¦‚æ‹çˆ±çºªå¿µæ—¥ã€‚</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">loveDays</span> <span class="hljs-operator">=</span> MemoryDayUtil.calculationLianAi(PushConfigure.getLoveDate());<br><br>    <span class="hljs-comment">// è®¡ç®—è·ç¦»ç”Ÿæ—¥çš„å¤©æ•°ã€‚</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">birthdays</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (PushConfigure.isUseLunar()) &#123;<br>        <span class="hljs-comment">// å¦‚æœä½¿ç”¨å†œå†ç”Ÿæ—¥ï¼Œè°ƒç”¨ç›¸åº”æ–¹æ³•è®¡ç®—ã€‚</span><br>        birthdays = MemoryDayUtil.calculationBirthdayByLunar(PushConfigure.getBirthday());<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨é˜³å†ç”Ÿæ—¥è®¡ç®—ã€‚</span><br>        birthdays = MemoryDayUtil.calculationBirthday(PushConfigure.getBirthday());<br>    &#125;<br><br>    <span class="hljs-comment">// å‘æ¨¡æ¿æ¶ˆæ¯æ·»åŠ ç›¸å…³æ•°æ®ã€‚</span><br>    templateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">&quot;loveDays&quot;</span>, loveDays + <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;#FF1493&quot;</span>));<br>    templateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">&quot;birthdays&quot;</span>, birthdays + <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;#FFA500&quot;</span>));<br><br>    <span class="hljs-comment">// è·å–å¤©æ°”æ•°æ®ã€‚</span><br>    <span class="hljs-type">Result</span> <span class="hljs-variable">weatherResult</span> <span class="hljs-operator">=</span> WeatherUtil.getWeather();<br>    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">messageAll</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br><br>    <span class="hljs-comment">// å¤„ç†å¤©æ°”æ•°æ®ã€‚</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;0&quot;</span>.equals(weatherResult.getCode())) &#123;<br>        <span class="hljs-comment">// å¦‚æœè·å–å¤©æ°”æ•°æ®å¤±è´¥ï¼Œè®°å½•å¤±è´¥ä¿¡æ¯ã€‚</span><br>        messageAll.append(<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>);<br>        messageAll.append(weatherResult.getMessage());<br>        templateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">&quot;weather&quot;</span>, <span class="hljs-string">&quot;***&quot;</span>, <span class="hljs-string">&quot;#00FFFF&quot;</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœæˆåŠŸè·å–å¤©æ°”æ•°æ®ï¼Œæå–å¹¶æ·»åŠ åˆ°æ¨¡æ¿æ¶ˆæ¯ä¸­ã€‚</span><br>        <span class="hljs-type">Weather</span> <span class="hljs-variable">weather</span> <span class="hljs-operator">=</span> (Weather) weatherResult.getData();<br>        <span class="hljs-comment">// åˆå§‹åŒ–å†œå†æ—¥æœŸå·¥å…·ç±»ã€‚</span><br>        <span class="hljs-type">LunarCalendarFestivalUtils</span> <span class="hljs-variable">festival</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LunarCalendarFestivalUtils</span>();<br>        festival.initLunarCalendarInfo(weather.getDate());<br><br>        <span class="hljs-comment">// å‘æ¨¡æ¿æ¶ˆæ¯ä¸­æ·»åŠ å„ç§å¤©æ°”å’Œæ—¥æœŸä¿¡æ¯ã€‚</span><br>        <span class="hljs-comment">// ... (ä»£ç çœç•¥)</span><br><br>        <span class="hljs-comment">// å¤©è¡Œæ•°æ®æ¥å£è°ƒç”¨ã€‚</span><br>        <span class="hljs-type">Result</span> <span class="hljs-variable">rainbowResult</span> <span class="hljs-operator">=</span> RainbowUtil.getRainbow();<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;200&quot;</span>.equals(rainbowResult.getCode())) &#123;<br>            <span class="hljs-comment">// å¦‚æœå¤©è¡Œæ•°æ®æ¥å£è°ƒç”¨å¤±è´¥ï¼Œè®°å½•å¤±è´¥ä¿¡æ¯ã€‚</span><br>            messageAll.append(<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>);<br>            messageAll.append(rainbowResult.getMessage());<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// æˆåŠŸè·å–å¤©è¡Œæ•°æ®ï¼Œæ·»åŠ åˆ°æ¨¡æ¿æ¶ˆæ¯ã€‚</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> (String) rainbowResult.getData();<br>            data = data.replaceAll(<span class="hljs-string">&quot;\r|\n&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>            templateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">&quot;rainbow&quot;</span>, data, <span class="hljs-string">&quot;#FF69B4&quot;</span>));<br>        &#125;<br><br>        <span class="hljs-comment">// æ ¹æ®ä¸åŒçš„æ—¥æœŸæ¡ä»¶æ·»åŠ å¤‡æ³¨ä¿¡æ¯ã€‚</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">remark</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;â¤&quot;</span>;<br>        <span class="hljs-comment">// ... (å¤„ç†ç‰¹å®šæ—¥æœŸé€»è¾‘çš„ä»£ç )</span><br><br>        templateMessage.addData(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WxMpTemplateData</span>(<span class="hljs-string">&quot;remark&quot;</span>, remark, <span class="hljs-string">&quot;#FF1493&quot;</span>));<br><br>        <span class="hljs-comment">// è¾“å‡ºæ¨¡æ¿æ¶ˆæ¯çš„ JSON è¡¨ç¤ºã€‚</span><br>        System.out.println(templateMessage.toJson());<br><br>        <span class="hljs-comment">// è·å–å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯æœåŠ¡ã€‚</span><br>        <span class="hljs-type">WxMpTemplateMsgService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> getService();<br><br>        <span class="hljs-comment">// è®°å½•å‘é€æˆåŠŸå’Œå¤±è´¥çš„è®¡æ•°ã€‚</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">suc</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">err</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (String userId : PushConfigure.getUserId()) &#123;<br>            templateMessage.setToUser(userId);<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// å‘é€æ¨¡æ¿æ¶ˆæ¯ã€‚</span><br>                service.sendTemplateMsg(templateMessage);<br>                suc += <span class="hljs-number">1</span>;<br>            &#125; <span class="hljs-keyword">catch</span> (WxErrorException e) &#123;<br>                <span class="hljs-comment">// å¦‚æœå‘é€å¤±è´¥ï¼Œè®°å½•å¤±è´¥ä¿¡æ¯ã€‚</span><br>            err += <span class="hljs-number">1</span>;<br>            messageAll.append(suc).append(<span class="hljs-string">&quot;ä¸ªæˆåŠŸ!&quot;</span>);<br>            messageAll.append(err).append(<span class="hljs-string">&quot;ä¸ªå¤±è´¥!&quot;</span>);<br>            messageAll.append(<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>);<br>            messageAll.append(e.getMessage());<br>            <span class="hljs-comment">// è¿”å›æ¨é€ç»“æœã€‚</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ¨é€ç»“æœ:&quot;</span> + messageAll;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// å¦‚æœæ‰€æœ‰æ¶ˆæ¯å‘é€å®Œæ¯•ï¼Œè¿”å›æˆåŠŸæ¨é€çš„ç”¨æˆ·æ•°é‡å’Œæ¶ˆæ¯ã€‚</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æˆåŠŸæ¨é€ç»™&quot;</span> + suc + <span class="hljs-string">&quot;ä¸ªç”¨æˆ·!&quot;</span> + messageAll;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŠŸèƒ½æ¦‚è¿°ï¼š</p><ul><li>æ­¤æ–¹æ³•ä¸»è¦ç”¨äºæ„å»ºå’Œå‘é€å®šåˆ¶åŒ–çš„å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯ã€‚</li><li>å®ƒåŒ…å«å¯¹æ‹çˆ±çºªå¿µæ—¥å’Œç”Ÿæ—¥çš„è®¡ç®—ï¼Œè·å–å¤©æ°”ä¿¡æ¯ï¼Œä»¥åŠè°ƒç”¨å¤©è¡Œæ•°æ®æ¥å£ã€‚</li><li>æ¶ˆæ¯çš„å†…å®¹æ ¹æ®ç‰¹å®šçš„æ—¥æœŸæ¡ä»¶è¿›è¡Œå®šåˆ¶ã€‚</li><li>æœ€åï¼Œè¯¥æ–¹æ³•é€šè¿‡å¾®ä¿¡å…¬ä¼—å·å¹³å°çš„ API å‘é€æ¶ˆæ¯ç»™æŒ‡å®šçš„ç”¨æˆ·åˆ—è¡¨ã€‚</li></ul><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>éœ€è¦æœ‰æ•ˆçš„å¾®ä¿¡å…¬ä¼—å·é…ç½®ä¿¡æ¯ï¼Œå¦‚æ¨¡æ¿ ID å’Œç”¨æˆ· IDã€‚</li><li><code>PushConfigure</code> ç±»ä¸­åº”åŒ…å«æ‰€æœ‰ç›¸å…³çš„é…ç½®ä¿¡æ¯ã€‚</li><li>å¤©æ°”ä¿¡æ¯å’Œå¤©è¡Œæ•°æ®æ¥å£çš„å®ç°ç»†èŠ‚æ²¡æœ‰åœ¨ä»£ç ä¸­ç»™å‡ºï¼Œéœ€è¦å•ç‹¬å®ç°ã€‚</li><li>å¼‚å¸¸å¤„ç†ç”¨äºæ•è·å’Œè®°å½•æ¶ˆæ¯å‘é€è¿‡ç¨‹ä¸­çš„é”™è¯¯ã€‚</li><li>æ­¤æ–¹æ³•åœ¨æˆåŠŸå‘é€æ‰€æœ‰æ¶ˆæ¯åï¼Œè¿”å›ä¸€ä¸ªæ±‡æ€»çš„ç»“æœå­—ç¬¦ä¸²ã€‚</li></ul><h4 id="å¾®ä¿¡æ¶ˆæ¯æ¨é€"><a href="#å¾®ä¿¡æ¶ˆæ¯æ¨é€" class="headerlink" title="å¾®ä¿¡æ¶ˆæ¯æ¨é€"></a>å¾®ä¿¡æ¶ˆæ¯æ¨é€</h4><p>çœ‹äº†ä¸€ä¸‹è°ƒç”¨å…³ç³»ï¼Œå…¶ä¸­æ ¸å¿ƒæ–¹æ³•æ˜¯ï¼š executeInternal</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> &lt;T, E&gt; <span class="hljs-function">T <span class="hljs-title">executeInternal</span><span class="hljs-params">(RequestExecutor&lt;T, E&gt; executor, String uri, E data)</span> <span class="hljs-keyword">throws</span> WxErrorException </span>&#123;<br>    <span class="hljs-comment">// å¤„ç†æ—¥å¿—ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚è„±æ•ã€‚</span><br>    E dataForLog = DataUtils.handleDataWithSecret(data);<br><br>    <span class="hljs-comment">// æ£€æŸ¥ URI æ˜¯å¦é”™è¯¯åœ°åŒ…å« access_tokenï¼Œå¦‚æœåŒ…å«åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</span><br>    <span class="hljs-keyword">if</span> (uri.contains(<span class="hljs-string">&quot;access_token=&quot;</span>)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;uriå‚æ•°ä¸­ä¸å…è®¸æœ‰access_token: &quot;</span> + uri);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// è·å– access tokenï¼Œå¹¶æ„é€ å¸¦æœ‰ access token çš„å®Œæ•´ URIã€‚</span><br>        String accessToken = <span class="hljs-keyword">this</span>.getAccessToken(<span class="hljs-keyword">false</span>);<br>        String uriWithAccessToken = uri + (uri.contains(<span class="hljs-string">&quot;?&quot;</span>) ? <span class="hljs-string">&quot;&amp;&quot;</span> : <span class="hljs-string">&quot;?&quot;</span>) + <span class="hljs-string">&quot;access_token=&quot;</span> + accessToken;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// ä½¿ç”¨ä¼ å…¥çš„ executor æ‰§è¡Œè¯·æ±‚ï¼Œå¹¶è·å–ç»“æœã€‚</span><br>            T result = executor.execute(uriWithAccessToken, data);<br><br>            <span class="hljs-comment">// è®°å½•è¯·æ±‚å’Œå“åº”æ•°æ®åˆ°æ—¥å¿—ã€‚</span><br>            <span class="hljs-keyword">this</span>.log.debug(<span class="hljs-string">&quot;\nã€è¯·æ±‚åœ°å€ã€‘: &#123;&#125;\nã€è¯·æ±‚å‚æ•°ã€‘ï¼š&#123;&#125;\nã€å“åº”æ•°æ®ã€‘ï¼š&#123;&#125;&quot;</span>, <span class="hljs-keyword">new</span> Object[]&#123;uriWithAccessToken, dataForLog, result&#125;);<br>            <span class="hljs-keyword">return</span> result;<br>        &#125; <span class="hljs-keyword">catch</span> (WxErrorException var9) &#123;<br>            <span class="hljs-comment">// å¤„ç†å¾®ä¿¡é”™è¯¯å¼‚å¸¸ã€‚</span><br>            WxError <span class="hljs-keyword">error</span> = var9.getError();<br><br>            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯å› ä¸º access token è¿‡æœŸå¼•èµ·çš„é”™è¯¯ï¼Œå¹¶å°è¯•åˆ·æ–°ã€‚</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">error</span>.getErrorCode() == <span class="hljs-number">42001</span> || <span class="hljs-keyword">error</span>.getErrorCode() == <span class="hljs-number">40001</span> || <span class="hljs-keyword">error</span>.getErrorCode() == <span class="hljs-number">40014</span>) &#123;<br>                <span class="hljs-keyword">this</span>.getWxMpConfigStorage().expireAccessToken();<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.getWxMpConfigStorage().autoRefreshToken()) &#123;<br>                    <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.<span class="hljs-title">execute</span><span class="hljs-params">(executor, uri, data)</span></span>;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment">// å¦‚æœé”™è¯¯ç ä¸ä¸º0ï¼Œè®°å½•é”™è¯¯å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">error</span>.getErrorCode() != <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">this</span>.log.<span class="hljs-keyword">error</span>(<span class="hljs-string">&quot;\nã€è¯·æ±‚åœ°å€ã€‘: &#123;&#125;\nã€è¯·æ±‚å‚æ•°ã€‘ï¼š&#123;&#125;\nã€é”™è¯¯ä¿¡æ¯ã€‘ï¼š&#123;&#125;&quot;</span>, <span class="hljs-keyword">new</span> Object[]&#123;uriWithAccessToken, dataForLog, <span class="hljs-keyword">error</span>&#125;);<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> WxErrorException(<span class="hljs-keyword">error</span>, var9);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException var10) &#123;<br>            <span class="hljs-comment">// å¤„ç† IO å¼‚å¸¸ã€‚</span><br>            <span class="hljs-keyword">this</span>.log.<span class="hljs-keyword">error</span>(<span class="hljs-string">&quot;\nã€è¯·æ±‚åœ°å€ã€‘: &#123;&#125;\nã€è¯·æ±‚å‚æ•°ã€‘ï¼š&#123;&#125;\nã€å¼‚å¸¸ä¿¡æ¯ã€‘ï¼š&#123;&#125;&quot;</span>, <span class="hljs-keyword">new</span> Object[]&#123;uriWithAccessToken, dataForLog, var10.getMessage()&#125;);<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> WxErrorException(WxError.builder().errorMsg(var10.getMessage()).build(), var10);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…·ä½“çš„è°ƒç”¨å…³ç³»æœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹é¡¹ç›®ä»£ç ã€‚</p><h4 id="å¤©æ°”æŸ¥è¯¢"><a href="#å¤©æ°”æŸ¥è¯¢" class="headerlink" title="å¤©æ°”æŸ¥è¯¢"></a>å¤©æ°”æŸ¥è¯¢</h4><p>é€šè¿‡ç™¾åº¦åœ°å›¾å¼€å‘å¹³å°è·å–å½“åœ°å¤©æ°”ï¼Œéœ€è¦ç”³è¯·æˆä¸ºå¼€å‘è€…ï¼š <a href="https://lbsyun.baidu.com/apiconsole/center">https://lbsyun.baidu.com/apiconsole/center</a></p><p>å›½å†…å¤©æ°”æŸ¥è¯¢ï¼š <a href="https://lbs.baidu.com/faq/api?title=webapi/weather/base">https://lbs.baidu.com/faq/api?title=webapi/weather/base</a></p><p>ç”¨æˆ·å¯é€šè¿‡è¡Œæ”¿åŒºåˆ’ä»£ç æŸ¥è¯¢å®æ—¶å¤©æ°”ä¿¡æ¯åŠæœªæ¥5å¤©å¤©æ°”é¢„æŠ¥ã€‚</p><p>api æœåŠ¡åœ°å€ï¼š </p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>api.map.baidu.com<span class="hljs-regexp">/weather/</span>v1/?district_id=<span class="hljs-number">222405</span>&amp;data_type=all&amp;ak=ä½ çš„ak  <br><span class="hljs-regexp">//</span>GETè¯·æ±‚<br></code></pre></td></tr></table></figure><p>éœ€è¦å…ˆè·å–åˆ° Access Key </p><p>åœ¨æ§åˆ¶å°ç®¡ç† â†’  åº”ç”¨ç®¡ç† â†’ æˆ‘çš„åº”ç”¨ï¼š <a href="https://lbs.baidu.com/apiconsole/key/create">https://lbs.baidu.com/apiconsole/key/create</a></p><p>éœ€è¦åˆ›å»ºä¸€ä¸ªåº”ç”¨æ‰èƒ½çœ‹åˆ° AK</p><p>æœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œé€šè¿‡IPåœ°å€è·å–é‚®æ”¿ç¼–ç : <a href="https://blog.51cto.com/u_16175454/7185643">https://blog.51cto.com/u_16175454/7185643</a></p><p>ä½†å®é™…å¹¶ä¸æ˜¯é‚®æ”¿ç¼–ç ï¼Œè€Œæ˜¯çœ‹ä¸€ä¸‹å®˜ç½‘æ–‡æ¡£ç»™çš„IDç¼–å·ã€‚</p><p>å®˜ç½‘æœ‰ä¸€ä»½æ–‡æ¡£ <a href="https://lbs.baidu.com/faq/api?title=webapi/weather/base">https://lbs.baidu.com/faq/api?title=webapi/weather/base</a>   ï¼Œ</p><p>å¯ä»¥ä¸‹è½½çœ‹ä¸€ä¸‹ï¼šå¹¿å· 440100  æ·±åœ³ 440300</p><p>è®¾ç½®IPè®¿é—®ç™½åå•ï¼š  å»ºè®®ç›´æ¥è®¾ç½®  0.0.0.0&#x2F;0 </p><p>ç”±äºä¸æ˜¯å…¬ç½‘è®¿é—®ï¼Œè®¾ç½®çš„IPåº”è¯¥æ˜¯æœ‰ç‚¹é—®é¢˜ã€‚</p><h4 id="â€å½©è™¹å±â€œæ¥å£"><a href="#â€å½©è™¹å±â€œæ¥å£" class="headerlink" title="â€å½©è™¹å±â€œæ¥å£"></a>â€å½©è™¹å±â€œæ¥å£</h4><p>è°ƒç”¨çš„ç¬¬ä¸‰æ–¹æ¥å£ï¼Œå¤©èšæ•°è¡Œå¹³å°çš„</p><p>æ¥å£åœ°å€ï¼š <a href="https://www.tianapi.com/apiview/181">https://www.tianapi.com/apiview/181</a></p><p>è®¿é—®éœ€è¦å¯†é’¥ï¼š <a href="https://www.tianapi.com/console/">https://www.tianapi.com/console/</a></p><p>æ§åˆ¶å° â†’ å®‰å…¨ç®¡ç†</p><p>å®é™…ä½¿ç”¨çš„æ—¶å€™ä»–è¿™ä¸ªç¬¬ä¸‰æ–¹æ¥å£çš„ IP ç™½åå•æœ‰é‡åˆ°å‘ï¼Œè®¾ç½®ä¸ç”Ÿæ•ˆï¼Œæ–°å¢ä¹‹åï¼›</p><p>åé¢ä¸æ–­å°è¯•ä¹‹åå‘ç°ä½ å……å€¼ä»–çš„ å¯†é’¥Key å¥½åƒæ‰åˆ·æ–°ç”Ÿæ•ˆäº†ã€‚</p><h4 id="ç¼–è¾‘æ¨¡æ¿"><a href="#ç¼–è¾‘æ¨¡æ¿" class="headerlink" title="ç¼–è¾‘æ¨¡æ¿"></a>ç¼–è¾‘æ¨¡æ¿</h4><p>æœ€åæ¨é€çš„æ—¶å€™ç”¨åˆ°äº†ä¸€ä¸ªæ¨¡æ¿IDï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµ‹è¯•å¾®ä¿¡å…¬ä¼—å·è¿™é‡Œç¼–è¾‘ä¸€ä¸‹æ¨¡æ¿</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">ä½ å¥½ï¼Œä»Šå¤©æ˜¯</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">date.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">å†œå†</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">lunar.DATA</span>&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">festival.DATA</span>&#125;&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">remark.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">ä½ æ‰€åœ¨çš„åŸå¸‚ä½ç½®:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">city.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">å½“å‰å¤©æ°”:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">weather.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">æœ€ä½æ°”æ¸©: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">low.DATA</span>&#125;&#125;</span><span class="language-xml">åº¦</span><br><span class="language-xml">æœ€é«˜æ°”æ¸©: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">high.DATA</span>&#125;&#125;</span><span class="language-xml">åº¦</span><br><span class="language-xml">é£åŠ›: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">wc_day.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml">é£å‘: </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">wd_day.DATA</span>&#125;&#125;</span><span class="language-xml"></span><br><span class="language-xml"></span><br><span class="language-xml">å­¦ä¹ æ‰“å¡~</span><br><span class="language-xml">è¯·å¼€å§‹ä»Šå¤©æ™šä¸Šçš„å­¦ä¹ å§ï¼</span><br><span class="language-xml">ä»Šå¤©æ˜¯æ‰“å¡çš„ç¬¬</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">loveDays.DATA</span>&#125;&#125;</span><span class="language-xml">å¤©</span><br><span class="language-xml">è·ç¦»ä¸€å¹´è¿˜å‰©ä¸‹</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">birthdays.DATA</span>&#125;&#125;</span><span class="language-xml">å¤©</span><br><span class="language-xml">Encourage:</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">rainbow.DATA</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è‡ªå®šä¹‰æ¨¡æ¿åè¿›è¡Œæäº¤ï¼Œå¤åˆ¶æäº¤åçš„ æ¨¡æ¿IDï¼Œæ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­</p><p>userID ä¹Ÿæ˜¯ç›´æ¥å¯ä»¥åœ¨å…¬ä¼—å·å¹³å°çš„åˆ—è¡¨å¯ä»¥çœ‹åˆ°</p><p>è°ƒç”¨æµ‹è¯•åœ°å€ï¼š <a href="http://localhost/test">http://localhost/test</a></p><h4 id="å®šæ—¶æ¨é€"><a href="#å®šæ—¶æ¨é€" class="headerlink" title="å®šæ—¶æ¨é€"></a>å®šæ—¶æ¨é€</h4><p>å»ºç«‹äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡é…ç½®ç±»</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> com.tsmyk.wechatproject.wechat.scheduled;<br><br><span class="hljs-keyword">import</span> com.tsmyk.wechatproject.wechat.utils.PushMessageUtils;<br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.<span class="hljs-keyword">annotation</span>.EnableScheduling;<br><span class="hljs-keyword">import</span> org.springframework.scheduling.<span class="hljs-keyword">annotation</span>.Scheduled;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Task å®šæ—¶ä»»åŠ¡</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> cws</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/8/22 21:42</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@EnableScheduling</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> &#123;<br>    <span class="hljs-comment">// å®šæ—¶ä»»åŠ¡</span><br>    <span class="hljs-meta">@Scheduled(cron = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;wechat.cron&#125;</span>&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> void goodMorning() &#123;<br>        PushMessageUtils.push();;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4ã€æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤"><a href="#4ã€æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤" class="headerlink" title="4ã€æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤"></a>4ã€æ¥æ”¶å¾®ä¿¡æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤</h3><p>é¡¹ç›®åœ°å€ï¼š <a href="https://github.com/tsmyk0715/wechatproject">https://github.com/tsmyk0715/wechatproject</a></p><h4 id="é¡¹ç›®ä»‹ç»-ğŸ¦ŒğŸ¦ŒğŸ¦Œ"><a href="#é¡¹ç›®ä»‹ç»-ğŸ¦ŒğŸ¦ŒğŸ¦Œ" class="headerlink" title="é¡¹ç›®ä»‹ç»  ğŸ¦ŒğŸ¦ŒğŸ¦Œ"></a>é¡¹ç›®ä»‹ç»  ğŸ¦ŒğŸ¦ŒğŸ¦Œ</h4><p>å…ˆç”³è¯·ä¸€ä¸ªè®¢é˜…å·ï¼Œç™»é™†åœ°å€ï¼š <a href="https://mp.weixin.qq.com/cgi-bin/loginpage?t=wxm2-login&lang=zh_CN">https://mp.weixin.qq.com/cgi-bin/loginpage?t=wxm2-login&amp;lang=zh_CN</a></p><p>æˆæƒä¿¡æ¯åœ¨ è®¾ç½®ä¸å¼€å‘ â†’ åŸºæœ¬é…ç½®ï¼ˆç”³è¯·æˆä¸ºå¼€å‘è€…ï¼‰</p><p>ä¹Ÿå¯ä»¥è¿›å…¥åˆ°è¿™ä¸ªæµ‹è¯•å¾®ä¿¡å…¬ä¼—å·åœ°å€ï¼š <a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login">https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login</a></p><p>æµ‹è¯•ä¸€ä¸‹è·å–ç”¨æˆ·æ¶ˆæ¯å¹¶è¿›è¡Œå›å¤</p><p>ä¸‹è½½è¯¥é¡¹ç›®ï¼š <a href="https://github.com/tsmyk0715/wechatproject">https://github.com/tsmyk0715/wechatproject</a> </p><h5 id="é¡¹ç›®åˆ†æ"><a href="#é¡¹ç›®åˆ†æ" class="headerlink" title="é¡¹ç›®åˆ†æ"></a>é¡¹ç›®åˆ†æ</h5><p>è¿™ä¸ªé¡¹ç›®æ˜¯ä½¿ç”¨çš„ å¼€æºå·¥å…· <code>weixin-java-mp</code> è¿›è¡Œå¼€å‘çš„</p><p>åŒæ—¶ä½ éœ€è¦è·å–åˆ°å¾®ä¿¡å‘ä½ å‘é€æ¶ˆæ¯ï¼Œå› æ­¤éœ€è¦å†…ç½‘ç©¿é€ä¸€ä¸‹ï¼Œå°†æœ¬åœ°çš„è®¿é—®æ˜ å°„åˆ°å…¬ç½‘ã€‚â€˜</p><p>è¿™ä¸ªé¡¹ç›®ç›¸å½“äºäº†ä½ å¯¹è‡ªå·±çš„å¾®ä¿¡å·æœåŠ¡è¿›è¡Œä¸ªæ€§åŒ–æ“ä½œï¼Œå…³é”®æ“ä½œæ˜¯é€šè¿‡å…³è”å¾®ä¿¡æ¥å£æ¥è¿›è¡Œå®ç°çš„ã€‚</p><p>ç¬¬ä¸‰ç« çš„å­¦ä¹ å†…å®¹å»ºè®®å­¦ä¹ ä¸€ä¸‹å®ƒçš„æ¨¡æ¿åŒ–æ“ä½œå’Œå®šæ—¶å‘é€æ“ä½œã€‚</p><p>è¿™ä¸ªé¡¹ç›®å€¼å¾—å­¦ä¹ è¿˜æŒºå¤šå†…å®¹çš„ï¼Œå¾®ä¿¡å¹³å°åœ¨åç»­çš„ä½¿ç”¨åº”è¯¥æ˜¯æ¯”è¾ƒé¢‘ç¹çš„ï¼Œåç»­ä¹Ÿå¯ä»¥å­¦ä¹  WxJava ç­‰å†…å®¹ã€‚</p><p>æ¥å£å‚æ•°é…ç½®å»ºè®®ä½¿ç”¨æµ‹è¯•å·ã€‚</p><h5 id="é…ç½®IPç™½åå•"><a href="#é…ç½®IPç™½åå•" class="headerlink" title="é…ç½®IPç™½åå•"></a>é…ç½®IPç™½åå•</h5><p>åœ¨å…¬ä¼—å·çš„åŸºæœ¬é…ç½®é‡Œé¢çš„ IP ç™½åå•ï¼Œéœ€è¦é…ç½®ä¸€ä¸‹ä½ çš„æœåŠ¡å™¨IP</p><h5 id="è·å–access-token"><a href="#è·å–access-token" class="headerlink" title="è·å–access_token"></a>è·å–access_token</h5><p>è¿™ä¸ªæ˜¯å¾®ä¿¡æ¥å£ä¸­çš„å…¶ä¸­ä¸€ä¸ªæ¥å£ï¼Œéœ€è¦è·å–åˆ°å…¶ä»–æ¥å£ä¿¡æ¯éœ€è¦ç”¨åˆ°è¿™ä¸ªä¿¡æ¯</p><p>å¾®ä¿¡å…¬ä¼—å·å¼€å‘è€…æ–‡æ¡£ï¼š <a href="https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html">https://developers.weixin.qq.com/doc/offiaccount/Getting_Started/Overview.html</a></p><p>ä»€ä¹ˆæ˜¯ <code>access_token</code>? å®˜ç½‘çš„ä»‹ç»å¦‚ä¸‹ï¼š</p><p><code>access_token</code>æ˜¯å…¬ä¼—å·çš„å…¨å±€å”¯ä¸€æ¥å£è°ƒç”¨å‡­æ®ï¼Œå…¬ä¼—å·è°ƒç”¨å„æ¥å£æ—¶éƒ½éœ€ä½¿ç”¨<code>access_token</code>ã€‚å¼€å‘è€…éœ€è¦è¿›è¡Œå¦¥å–„ä¿å­˜ã€‚<code>access_token</code>çš„å­˜å‚¨è‡³å°‘è¦ä¿ç•™512ä¸ªå­—ç¬¦ç©ºé—´ã€‚<code>access_token</code>çš„æœ‰æ•ˆæœŸç›®å‰ä¸º<code>2</code>ä¸ªå°æ—¶ï¼Œéœ€å®šæ—¶åˆ·æ–°ï¼Œé‡å¤è·å–å°†å¯¼è‡´ä¸Šæ¬¡è·å–çš„access_tokenå¤±æ•ˆã€‚</p><p>è·å– <code>access_token</code> çš„æ¥å£æ¯æ—¥è°ƒç”¨æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ‰€ä»¥ä¸æ˜¯æ¯æ¬¡è°ƒç”¨æ¥å£éƒ½é‡æ–°è·å–<code>access_token</code>ï¼Œè€Œæ˜¯è·å–åˆ°ä¹‹åç¼“å­˜èµ·æ¥ï¼Œç¼“å­˜å¤±æ•ˆä¹‹åå†å»é‡æ–°è·å–å³åˆ·æ–°ã€‚</p><p>è·å–è¿™ä¸ªä¿¡æ¯éœ€è¦è°ƒç”¨å¾®ä¿¡çš„ç¬¬ä¸‰æ–¹APIæ¥å£è·å–</p><ol><li>æ¥å£åœ°å€ä¸ºï¼š</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">httpsè¯·æ±‚æ–¹å¼: <br><br><span class="hljs-attr">https</span>:<span class="hljs-comment">//api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET</span><br></code></pre></td></tr></table></figure><p><strong>å‚æ•°è¯´æ˜</strong></p><table><thead><tr><th>å‚æ•°</th><th>æ˜¯å¦å¿…é¡»</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>grant_type</td><td>æ˜¯</td><td>è·å–access_tokenå¡«å†™client_credential</td></tr><tr><td>appid</td><td>æ˜¯</td><td>ç¬¬ä¸‰æ–¹ç”¨æˆ·å”¯ä¸€å‡­è¯</td></tr><tr><td>secret</td><td>æ˜¯</td><td>ç¬¬ä¸‰æ–¹ç”¨æˆ·å”¯ä¸€å‡­è¯å¯†é’¥ï¼Œå³appsecret</td></tr><tr><td>è¿”å›çš„æ˜¯JSONæ ¼å¼çš„æŠ¥æ–‡ï¼š</td><td></td><td></td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<span class="hljs-string">&quot;access_token&quot;</span>:<span class="hljs-string">&quot;ACCESS_TOKEN&quot;</span>,<span class="hljs-string">&quot;expires_in&quot;</span>:<span class="hljs-number">7200</span>&#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®ï¼š</p><h5 id="è·å–ç”¨æˆ·æ¶ˆæ¯"><a href="#è·å–ç”¨æˆ·æ¶ˆæ¯" class="headerlink" title="è·å–ç”¨æˆ·æ¶ˆæ¯"></a>è·å–ç”¨æˆ·æ¶ˆæ¯</h5><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è·å–å…³æ³¨è€…çš„åˆ—è¡¨ï¼Œå…³æ³¨è€…çš„ä¿¡æ¯ç­‰ã€‚</p><p><strong>è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼š</strong></p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">WechatController</span> </span>&#123;<br>    <span class="hljs-comment">/** æ—¥å¿— */</span><br>    <span class="hljs-keyword">private</span> Logger logger = LoggerFactory.getLogger(getClass());<br>    <span class="hljs-comment">/** å·¥å…·ç±» */</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> WechatUtils wechatUtils;<br><br>    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">&quot;getUserInfo&quot;</span>)<br>    <span class="hljs-keyword">public</span> void getUserInfo() &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            WxMpUserList userList = wechatUtils.getUserList();<br>            <span class="hljs-keyword">if</span> (userList == <span class="hljs-literal">null</span> || userList.getOpenIds().isEmpty()) &#123;<br>                logger.warn(<span class="hljs-string">&quot;å…³æ³¨è€…openIdåˆ—è¡¨ä¸ºç©º&quot;</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            List&lt;<span class="hljs-keyword">String</span>&gt; openIds = userList.getOpenIds();<br>            logger.info(<span class="hljs-string">&quot;å…³æ³¨è€…openIdåˆ—è¡¨ = &#123;&#125;&quot;</span>, openIds.toString());<br><br>            <span class="hljs-keyword">String</span> openId = openIds.<span class="hljs-keyword">get</span>(<span class="hljs-number">0</span>);<br>            logger.info(<span class="hljs-string">&quot;å¼€å§‹è·å– &#123;&#125; çš„åŸºæœ¬ä¿¡æ¯&quot;</span>, openId);<br>            WxMpUser userInfo = wechatUtils.getUserInfo(openId);<br>            <span class="hljs-keyword">if</span> (userInfo == <span class="hljs-literal">null</span>) &#123;<br>                logger.warn(<span class="hljs-string">&quot;è·å– &#123;&#125; çš„åŸºæœ¬ä¿¡æ¯ä¸ºç©º&quot;</span>, openId);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <span class="hljs-keyword">String</span> city = userInfo.getCity();<br>            <span class="hljs-keyword">String</span> nickname = userInfo.getNickname();<br>            logger.info(<span class="hljs-string">&quot;&#123;&#125; çš„æ˜µç§°ä¸ºï¼š&#123;&#125;, åŸå¸‚ä¸ºï¼š&#123;&#125;&quot;</span>, openId, nickname, city);<br>        &#125; <span class="hljs-keyword">catch</span> (WxErrorException e) &#123;<br>            logger.error(<span class="hljs-string">&quot;è·å–ç”¨æˆ·æ¶ˆæ¯å¤±è´¥&quot;</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯"><a href="#æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯" class="headerlink" title="æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯"></a><strong>æ¥æ”¶ç”¨æˆ·å‘é€çš„æ¶ˆæ¯</strong></h5><p>å½“å¾®ä¿¡ç”¨æˆ·å‘å…¬ä¼—å·å‘é€æ¶ˆæ¯æ—¶ï¼Œå¾®ä¿¡æœåŠ¡å™¨ä¼šé€šè¿‡å…¬ä¼—å·åå°é…ç½®çš„URLæŠŠä¿¡æ¯å‘é€åˆ°æˆ‘ä»¬åå°çš„æ¥å£ä¸Šï¼Œæ³¨æ„æ­¤æ—¶çš„è¯·æ±‚æ ¼å¼ä¸º <code>POST</code>è¯·æ±‚ï¼Œå‘é€è¿‡æ¥çš„æ¶ˆæ¯æŠ¥æ–‡æ ¼å¼æ˜¯XMLæ ¼å¼çš„ï¼Œæ¯ç§æ¶ˆæ¯ç±»å‹çš„XMLæ ¼å¼ä¸ä¸€æ ·ã€‚</p><p>è¿™é‡Œè·³è¿‡ï¼Œå…·ä½“å†…å®¹çœ‹ä¸€ä¸‹å¼€æºé¡¹ç›®çš„ä»£ç ã€‚</p><h5 id="å“åº”å¾®ä¿¡å‘å‡ºçš„è¯·æ±‚æ¶ˆæ¯"><a href="#å“åº”å¾®ä¿¡å‘å‡ºçš„è¯·æ±‚æ¶ˆæ¯" class="headerlink" title="å“åº”å¾®ä¿¡å‘å‡ºçš„è¯·æ±‚æ¶ˆæ¯"></a>å“åº”å¾®ä¿¡å‘å‡ºçš„è¯·æ±‚æ¶ˆæ¯</h5><p>æ¥å£æ–‡æ¡£ï¼š <a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html">https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html</a></p><p>å¾®ä¿¡è¦æ±‚å“åº”ä¿¡æ¯å¿…é¡»è¦åœ¨äº”ç§’å†…ï¼Œå› æ­¤å®é™…è°ƒç”¨ API çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªæ—¶é—´å†²çªã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240114222207.png" alt="image.png"></p><h4 id="é¡¹ç›®è¿è¡Œ"><a href="#é¡¹ç›®è¿è¡Œ" class="headerlink" title="é¡¹ç›®è¿è¡Œ"></a>é¡¹ç›®è¿è¡Œ</h4><p>é€šè¿‡ä½ è·å–çš„æµ‹è¯•å·çš„ appidã€appsecretã€token ä¿¡æ¯ï¼Œé…ç½®å·å†…ç½‘ç©¿é€ï¼ˆè·å–åˆ°å¾®ä¿¡å‘é€çš„æ¶ˆæ¯ï¼‰</p><p>å°±å¯ä»¥å¯åŠ¨è¿™ä¸ªé¡¹ç›®äº†ï¼Œå¯åŠ¨ç±»ï¼š WechatprojectApplication</p><h3 id="5ã€QQæ¶ˆæ¯å›å¤"><a href="#5ã€QQæ¶ˆæ¯å›å¤" class="headerlink" title="5ã€QQæ¶ˆæ¯å›å¤"></a>5ã€QQæ¶ˆæ¯å›å¤</h3><p>æ—¢ç„¶éƒ½äº†è§£åˆ°è¿™é‡Œäº†ï¼Œä¸å¦‚ä¹Ÿçœ‹ä¸€ä¸‹QQæ¶ˆæ¯æ˜¯å¦èƒ½è‡ªåŠ¨è·å–å¹¶é—®ç­”ã€‚</p><p>to be continedâ€¦</p><h3 id="6ã€å°è¯•å›½å†…çš„å¤§è¯­è¨€æ¨¡å‹"><a href="#6ã€å°è¯•å›½å†…çš„å¤§è¯­è¨€æ¨¡å‹" class="headerlink" title="6ã€å°è¯•å›½å†…çš„å¤§è¯­è¨€æ¨¡å‹"></a>6ã€å°è¯•å›½å†…çš„å¤§è¯­è¨€æ¨¡å‹</h3><p>å›½å¤–çš„è¿™ä¸ªå°é”å¯¹å¤§é™†ä¹ŸçœŸçš„æ¶å¿ƒï¼Œä»£ç†æœåŠ¡ç­‰ä¹Ÿå¾ˆéš¾å—ï¼›</p><p>ä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹å›½å†…çš„ ç™¾åº¦æ–‡å¿ƒä¸€è¨€ã€è®¯é£æ˜Ÿç«ã€é˜¿é‡Œé€šä¹‰åƒé—®ç­‰ã€‚</p><ul><li><a href="https://yiyan.baidu.com/">https://yiyan.baidu.com/</a></li><li><a href="https://passport.xfyun.cn/login">https://passport.xfyun.cn/login</a></li><li><a href="https://tongyi.aliyun.com/">https://tongyi.aliyun.com/</a></li></ul><p>åç»­è€ƒè™‘ä½¿ç”¨é€šä¹‰åƒé—®ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>java</tag>
      
      <tag>chatgpt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>obsidianå¸¸ç”¨æ’ä»¶ä½¿ç”¨è®°å½•</title>
    <link href="/2024/01/12/obsidian%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"/>
    <url>/2024/01/12/obsidian%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p>æ’ä»¶åŠŸèƒ½</p><ul><li>å¯¼å‡º pdf å¸¦ä¸Šç›®å½•</li></ul><hr><h4 id="1ã€å¯¼å‡º-pdf-å¸¦ä¸Šç›®å½•"><a href="#1ã€å¯¼å‡º-pdf-å¸¦ä¸Šç›®å½•" class="headerlink" title="1ã€å¯¼å‡º pdf å¸¦ä¸Šç›®å½•"></a>1ã€å¯¼å‡º pdf å¸¦ä¸Šç›®å½•</h4><p>ä½¿ç”¨ better-export-pdf å¯¼å‡º pdf å¸¦ä¸Šç›®å½•</p><p>è¿™ä¸ªæ’ä»¶éœ€è¦ä¸‹è½½ä½¿ç”¨ï¼Œä¸‹è½½åœ°å€ï¼š  <a href="https://github.com/l1xnan/obsidian-better-export-pdf/releases">https://github.com/l1xnan/obsidian-better-export-pdf/releases</a></p><p>ä¸‹è½½å¯¹åº”çš„ obsidian-better-export-pdf.zip æ–‡ä»¶å³å¯ã€‚</p><p>å‚è€ƒï¼š <a href="https://pkmer.cn/Pkmer-Docs/10-obsidian/obsidian%E7%A4%BE%E5%8C%BA%E6%8F%92%E4%BB%B6/better-export-pdf/">https://pkmer.cn/Pkmer-Docs/10-obsidian/obsidian%E7%A4%BE%E5%8C%BA%E6%8F%92%E4%BB%B6/better-export-pdf/</a></p><hr><h4 id="2ã€æ’ä»¶-ProZen"><a href="#2ã€æ’ä»¶-ProZen" class="headerlink" title="2ã€æ’ä»¶ ProZen"></a>2ã€æ’ä»¶ ProZen</h4><p>æ’ä»¶å¸‚åœºä¸‹è½½åï¼Œéœ€è¦è®¾ç½®ä¸€ä¸‹å¿«æ·é”®ï¼Œç„¶åä½¿ç”¨å¿«æ·é”®è¿›è¡Œåˆ‡æ¢æ“ä½œ</p>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>obsidian</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>centos7ç³»ç»Ÿ_å¸¸ç”¨æ“ä½œ</title>
    <link href="/2024/01/12/centos7%E7%B3%BB%E7%BB%9F_%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    <url>/2024/01/12/centos7%E7%B3%BB%E7%BB%9F_%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€é˜²ç«å¢™"><a href="#1ã€é˜²ç«å¢™" class="headerlink" title="1ã€é˜²ç«å¢™"></a>1ã€é˜²ç«å¢™</h3><blockquote><p>æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</p></blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">firewall-cmd <span class="hljs-comment">--state</span><br></code></pre></td></tr></table></figure><p>å¸¸ç”¨æ“ä½œ</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl stop firewalld   <span class="hljs-comment"># å…³é—­é˜²ç«å¢™</span><br><span class="hljs-params">system</span>ctl start firewalld  <span class="hljs-comment"># å¯åŠ¨é˜²ç«å¢™</span><br>firewall-cmd --reload      <span class="hljs-comment"># é‡å¯é˜²ç«å¢™</span><br><span class="hljs-params">system</span>ctl disable firewalld  <span class="hljs-comment"># ç¦ç”¨é˜²ç«å¢™</span><br></code></pre></td></tr></table></figure><blockquote><p>å¼€æ”¾é˜²ç«å¢™ç«¯å£</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --query-port=80/tcp   <span class="hljs-comment">#ç«¯å£å¼€æ”¾æƒ…å†µ</span></span><br>firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --permanent --list-ports  <span class="hljs-comment">#æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£</span></span><br><br><span class="hljs-comment">#å¼€æ”¾ç«¯å£</span><br>firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --permanent --add-port=8080/tcp</span><br>firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --permanent --add-port=8083-8085/tcp</span><br><br><span class="hljs-comment">#å…³é—­ç«¯å£</span><br>firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --permanent --remove-port=8083-8085/tcp</span><br></code></pre></td></tr></table></figure><p>ç«¯å£å¼€æ”¾åå»ºè®®é‡å¯ä¸€ä¸‹é˜²ç«å¢™</p><h3 id="2ã€æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€"><a href="#2ã€æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€" class="headerlink" title="2ã€æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€"></a>2ã€æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€</h3><p>å¸¸ç”¨çš„Linuxå‘½ä»¤ï¼š</p><h4 id="CPUä½¿ç”¨æƒ…å†µ"><a href="#CPUä½¿ç”¨æƒ…å†µ" class="headerlink" title="CPUä½¿ç”¨æƒ…å†µ"></a>CPUä½¿ç”¨æƒ…å†µ</h4><ol><li><p><strong>top</strong>:</p><ul><li><code>top</code> å‘½ä»¤ç”¨äºå®æ—¶æ˜¾ç¤ºç³»ç»Ÿä¸­å„ä¸ªè¿›ç¨‹çš„èµ„æºå ç”¨çŠ¶å†µã€‚</li><li>å®ƒæ˜¾ç¤ºçš„ä¿¡æ¯åŒ…æ‹¬ç³»ç»Ÿè¿è¡Œæ—¶é—´ã€å½“å‰ç™»å½•ç”¨æˆ·æ•°ã€ç³»ç»Ÿè´Ÿè½½ã€è¿›ç¨‹æ€»æ•°ã€CPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ç­‰ã€‚</li></ul></li><li><p><strong>vmstat</strong>:</p><ul><li><code>vmstat</code>ï¼ˆVirtual Memory Statisticsï¼‰å‘½ä»¤ç”¨äºå±•ç¤ºè™šæ‹Ÿå†…å­˜ã€è¿›ç¨‹ã€CPUæ´»åŠ¨ç­‰ä¿¡æ¯ã€‚</li><li>ä¾‹å¦‚ï¼š<code>vmstat 1 5</code> æ¯1ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œå…±æ˜¾ç¤º5æ¬¡æ•°æ®ã€‚</li></ul></li></ol><h4 id="å†…å­˜ä½¿ç”¨æƒ…å†µ"><a href="#å†…å­˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="å†…å­˜ä½¿ç”¨æƒ…å†µ"></a>å†…å­˜ä½¿ç”¨æƒ…å†µ</h4><ol><li><p><strong>free</strong>:</p><ul><li><code>free</code> å‘½ä»¤ç”¨äºæ˜¾ç¤ºç³»ç»Ÿçš„ç©ºé—²ã€ä½¿ç”¨ä¸­å’Œäº¤æ¢å†…å­˜çš„ä¿¡æ¯ã€‚</li><li>ä¾‹å¦‚ï¼š<code>free -h</code> æ˜¾ç¤ºæ˜“äºé˜…è¯»çš„æ ¼å¼ã€‚</li></ul></li><li><p><strong>htop</strong>:</p><ul><li><code>htop</code> æ˜¯ <code>top</code> å‘½ä»¤çš„ä¸€ä¸ªå¢å¼ºç‰ˆæœ¬ï¼Œæä¾›äº†æ›´å¤šä¿¡æ¯ï¼Œç•Œé¢æ›´å‹å¥½ã€‚</li><li>å®ƒéœ€è¦åœ¨æŸäº›Linuxå‘è¡Œç‰ˆä¸Šå•ç‹¬å®‰è£…ã€‚</li></ul></li></ol><h4 id="ç£ç›˜ä½¿ç”¨æƒ…å†µ"><a href="#ç£ç›˜ä½¿ç”¨æƒ…å†µ" class="headerlink" title="ç£ç›˜ä½¿ç”¨æƒ…å†µ"></a>ç£ç›˜ä½¿ç”¨æƒ…å†µ</h4><ol><li><p><strong>df</strong>:</p><ul><li><code>df</code>ï¼ˆDisk Freeï¼‰å‘½ä»¤ç”¨äºæ˜¾ç¤ºç³»ç»Ÿä¸­æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„æ€»ç©ºé—´ã€å·²ç”¨ç©ºé—´å’Œå¯ç”¨ç©ºé—´ã€‚</li><li>ä¾‹å¦‚ï¼š<code>df -h</code> æ˜¾ç¤ºæ˜“äºé˜…è¯»çš„æ ¼å¼ã€‚</li></ul></li><li><p><strong>du</strong>:</p><ul><li><code>du</code>ï¼ˆDisk Usageï¼‰å‘½ä»¤ç”¨äºæ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•å ç”¨çš„ç£ç›˜ç©ºé—´ã€‚</li><li>ä¾‹å¦‚ï¼š<code>du -sh /path/to/directory</code> æ˜¾ç¤ºæŒ‡å®šç›®å½•çš„æ€»ç©ºé—´å ç”¨ã€‚</li></ul></li></ol><h4 id="ç½‘ç»œä½¿ç”¨æƒ…å†µ"><a href="#ç½‘ç»œä½¿ç”¨æƒ…å†µ" class="headerlink" title="ç½‘ç»œä½¿ç”¨æƒ…å†µ"></a>ç½‘ç»œä½¿ç”¨æƒ…å†µ</h4><ol><li><strong>netstat</strong>:<ul><li><code>netstat</code> å‘½ä»¤ç”¨äºæ˜¾ç¤ºç½‘ç»œè¿æ¥ã€è·¯ç”±è¡¨ã€æ¥å£ç»Ÿè®¡ç­‰ç½‘ç»œä¿¡æ¯ã€‚</li><li>ä¾‹å¦‚ï¼š<code>netstat -tulnp</code> æ˜¾ç¤ºæ‰€æœ‰ç›‘å¬ç«¯å£ã€‚</li></ul></li><li><strong>ss</strong>:<ul><li><code>ss</code>ï¼ˆSocket Statisticsï¼‰å‘½ä»¤æ˜¯ <code>netstat</code> çš„ä¸€ä¸ªç°ä»£æ›¿ä»£å“ï¼Œç”¨äºæ˜¾ç¤ºå¥—æ¥å­—ç»Ÿè®¡ä¿¡æ¯ã€‚</li><li>ä¾‹å¦‚ï¼š<code>ss -tuln</code> æ˜¾ç¤ºç›‘å¬ç«¯å£ã€‚</li></ul></li></ol><h4 id="ç³»ç»Ÿæ´»åŠ¨å’Œæ€§èƒ½"><a href="#ç³»ç»Ÿæ´»åŠ¨å’Œæ€§èƒ½" class="headerlink" title="ç³»ç»Ÿæ´»åŠ¨å’Œæ€§èƒ½"></a>ç³»ç»Ÿæ´»åŠ¨å’Œæ€§èƒ½</h4><ol><li><strong>sar</strong>:<ul><li><code>sar</code> å‘½ä»¤ç”¨äºæ”¶é›†ã€æŠ¥å‘Šæˆ–ä¿å­˜ç³»ç»Ÿæ´»åŠ¨ä¿¡æ¯ï¼Œå®ƒæ˜¯sysstatåŒ…çš„ä¸€éƒ¨åˆ†ã€‚</li><li>ä¾‹å¦‚ï¼š<code>sar -u 1 5</code> æ¯ç§’æŠ¥å‘Šä¸€æ¬¡CPUä½¿ç”¨æƒ…å†µï¼Œå…±æŠ¥å‘Š5æ¬¡ã€‚</li></ul></li><li><strong>iostat</strong>:<ul><li><code>iostat</code> å‘½ä»¤ç”¨äºæ˜¾ç¤ºCPUç»Ÿè®¡ä¿¡æ¯å’Œæ‰€æœ‰åˆ†åŒºçš„I&#x2F;Oç»Ÿè®¡ä¿¡æ¯ã€‚</li><li>å®ƒæœ‰åŠ©äºç›‘æ§ç³»ç»Ÿçš„è¾“å…¥&#x2F;è¾“å‡ºè®¾å¤‡è´Ÿè½½ã€‚</li></ul></li></ol><h3 id="3ã€å¸¸ç”¨çš„-shell-å‘½ä»¤"><a href="#3ã€å¸¸ç”¨çš„-shell-å‘½ä»¤" class="headerlink" title="3ã€å¸¸ç”¨çš„ shell å‘½ä»¤"></a>3ã€å¸¸ç”¨çš„ shell å‘½ä»¤</h3><h4 id="æ–‡ä»¶å’Œç›®å½•æ“ä½œ"><a href="#æ–‡ä»¶å’Œç›®å½•æ“ä½œ" class="headerlink" title="æ–‡ä»¶å’Œç›®å½•æ“ä½œ"></a>æ–‡ä»¶å’Œç›®å½•æ“ä½œ</h4><ul><li><code>ls</code>ï¼šåˆ—å‡ºç›®å½•å†…å®¹ã€‚å¸¸ç”¨é€‰é¡¹åŒ…æ‹¬<code>-l</code>ï¼ˆé•¿æ ¼å¼åˆ—å‡ºï¼‰ã€<code>-a</code>ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰ã€‚</li><li><code>cd &lt;directory&gt;</code>ï¼šåˆ‡æ¢å½“å‰ç›®å½•åˆ°æŒ‡å®šç›®å½•ã€‚</li><li><code>pwd</code>ï¼šæ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ã€‚</li><li><code>mkdir &lt;directory&gt;</code>ï¼šåˆ›å»ºæ–°ç›®å½•ã€‚</li><li><code>rmdir &lt;directory&gt;</code>ï¼šåˆ é™¤ç©ºç›®å½•ã€‚</li><li><code>rm &lt;file&gt;</code>ï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚ä½¿ç”¨<code>-r</code>é€‰é¡¹é€’å½’åˆ é™¤ç›®å½•ã€‚</li><li><code>cp &lt;source&gt; &lt;destination&gt;</code>ï¼šå¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ã€‚ä½¿ç”¨<code>-r</code>é€‰é¡¹å¤åˆ¶ç›®å½•ã€‚</li><li><code>mv &lt;source&gt; &lt;destination&gt;</code>ï¼šç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ï¼Œæˆ–é‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚</li></ul><h4 id="æ–‡æœ¬æ–‡ä»¶æ“ä½œ"><a href="#æ–‡æœ¬æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡æœ¬æ–‡ä»¶æ“ä½œ"></a>æ–‡æœ¬æ–‡ä»¶æ“ä½œ</h4><ul><li><code>cat &lt;file&gt;</code>ï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹ã€‚</li><li><code>more &lt;file&gt;</code>ã€<code>less &lt;file&gt;</code>ï¼šåˆ†é¡µæŸ¥çœ‹æ–‡ä»¶å†…å®¹ã€‚</li><li><code>grep &lt;pattern&gt; &lt;file&gt;</code>ï¼šåœ¨æ–‡ä»¶ä¸­æœç´¢ä¸æ¨¡å¼åŒ¹é…çš„è¡Œã€‚å¸¸ä¸ç®¡é“<code>|</code>é…åˆä½¿ç”¨ã€‚</li><li><code>sed &lt;script&gt; &lt;file&gt;</code>ï¼šå¯¹æ–‡ä»¶æ‰§è¡Œæµç¼–è¾‘ã€‚</li><li><code>awk &lt;program&gt; &lt;file&gt;</code>ï¼šå¼ºå¤§çš„æ–‡æœ¬å¤„ç†å·¥å…·ï¼Œç”¨äºæ¨¡å¼æ‰«æå’Œå¤„ç†ã€‚</li></ul><h4 id="ç³»ç»Ÿä¿¡æ¯å’Œç®¡ç†"><a href="#ç³»ç»Ÿä¿¡æ¯å’Œç®¡ç†" class="headerlink" title="ç³»ç»Ÿä¿¡æ¯å’Œç®¡ç†"></a>ç³»ç»Ÿä¿¡æ¯å’Œç®¡ç†</h4><ul><li><code>top</code>ï¼šæ˜¾ç¤ºç³»ç»Ÿè¿è¡Œçš„è¿›ç¨‹å’Œèµ„æºå ç”¨ï¼ŒåŠ¨æ€æ›´æ–°ã€‚</li><li><code>ps &lt;options&gt;</code>ï¼šæŠ¥å‘Šå½“å‰ç³»ç»Ÿçš„è¿›ç¨‹çŠ¶æ€ã€‚å¸¸ç”¨<code>ps aux</code>æŸ¥çœ‹æ‰€æœ‰è¿è¡Œä¸­çš„è¿›ç¨‹ã€‚</li><li><code>kill &lt;PID&gt;</code>ï¼šç»ˆæ­¢æŒ‡å®šPIDï¼ˆè¿›ç¨‹IDï¼‰çš„è¿›ç¨‹ã€‚</li><li><code>df &lt;options&gt;</code>ï¼šæ˜¾ç¤ºç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚<code>-h</code>é€‰é¡¹ä»¥æ˜“è¯»çš„æ–¹å¼æ˜¾ç¤ºã€‚</li><li><code>du &lt;options&gt; &lt;directory/file&gt;</code>ï¼šæ˜¾ç¤ºç›®å½•æˆ–æ–‡ä»¶çš„ç£ç›˜ä½¿ç”¨æƒ…å†µã€‚<code>-h</code>é€‰é¡¹ä»¥æ˜“è¯»çš„æ–¹å¼æ˜¾ç¤ºã€‚</li><li><code>free</code>ï¼šæ˜¾ç¤ºå†…å­˜ä½¿ç”¨æƒ…å†µã€‚</li></ul><h4 id="ç½‘ç»œç›¸å…³"><a href="#ç½‘ç»œç›¸å…³" class="headerlink" title="ç½‘ç»œç›¸å…³"></a>ç½‘ç»œç›¸å…³</h4><ul><li><code>ping &lt;host&gt;</code>ï¼šæµ‹è¯•åˆ°ä¸»æœºçš„ç½‘ç»œè¿é€šæ€§ã€‚</li><li><code>ifconfig</code>ï¼šæ˜¾ç¤ºæˆ–é…ç½®ç½‘ç»œæ¥å£ï¼ˆåœ¨ä¸€äº›ç³»ç»Ÿä¸­å¯èƒ½éœ€è¦ä½¿ç”¨<code>ip addr show</code>ï¼‰ã€‚</li><li><code>netstat &lt;options&gt;</code>ï¼šæ˜¾ç¤ºç½‘ç»œè¿æ¥ã€è·¯ç”±è¡¨ã€æ¥å£ç»Ÿè®¡ç­‰ç½‘ç»œä¿¡æ¯ã€‚</li><li><code>curl &lt;URL&gt;</code>ï¼šå‘½ä»¤è¡Œä¸‹çš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œæ”¯æŒHTTPã€HTTPSç­‰å¤šç§åè®®ã€‚</li><li><code>wget &lt;URL&gt;</code>ï¼šå‘½ä»¤è¡Œä¸‹çš„ç½‘ç»œä¸‹è½½å·¥å…·ï¼Œæ”¯æŒHTTPã€HTTPSå’ŒFTPã€‚</li></ul><h4 id="æƒé™å’Œç”¨æˆ·ç®¡ç†"><a href="#æƒé™å’Œç”¨æˆ·ç®¡ç†" class="headerlink" title="æƒé™å’Œç”¨æˆ·ç®¡ç†"></a>æƒé™å’Œç”¨æˆ·ç®¡ç†</h4><ul><li><code>chmod &lt;mode&gt; &lt;file/directory&gt;</code>ï¼šæ”¹å˜æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚</li><li><code>chown &lt;user&gt;:&lt;group&gt; &lt;file/directory&gt;</code>ï¼šæ”¹å˜æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…å’Œæ‰€å±ç»„ã€‚</li><li><code>su &lt;user&gt;</code>ï¼šåˆ‡æ¢å½“å‰ç”¨æˆ·èº«ä»½åˆ°å¦ä¸€ä¸ªç”¨æˆ·ã€‚</li><li><code>sudo &lt;command&gt;</code>ï¼šä»¥è¶…çº§ç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚</li></ul><h4 id="å‹ç¼©ä¸è§£å‹"><a href="#å‹ç¼©ä¸è§£å‹" class="headerlink" title="å‹ç¼©ä¸è§£å‹"></a>å‹ç¼©ä¸è§£å‹</h4><ul><li><code>tar &lt;options&gt; &lt;filename.tar&gt; &lt;directory or files&gt;</code>ï¼šæ‰“åŒ…å’Œè§£åŒ…<code>.tar</code>æ–‡ä»¶ã€‚å¸¸ç”¨é€‰é¡¹æœ‰<code>-c</code>ï¼ˆåˆ›å»ºå½’æ¡£ï¼‰ã€<code>-x</code>ï¼ˆè§£å‹ï¼‰ã€<code>-z</code>ï¼ˆgzipå‹ç¼©ï¼‰ã€<code>-v</code>ï¼ˆæ˜¾ç¤ºè¿‡ç¨‹ï¼‰ã€<code>-f</code>ï¼ˆæŒ‡å®šæ–‡ä»¶åï¼‰ã€‚</li><li><code>gzip &lt;file&gt;</code>ã€<code>gunzip &lt;file.gz&gt;</code>ï¼šå‹ç¼©å’Œè§£å‹<code>.gz</code>æ–‡ä»¶ã€‚</li><li><code>zip &lt;archive.zip&gt; &lt;files&gt;</code>ã€<code>unzip &lt;archive.zip&gt;</code>ï¼šå‹ç¼©å’Œè§£å‹<code>.zip</code>æ–‡ä»¶ã€‚</li></ul><p>è¿™äº›å‘½ä»¤åªæ˜¯Shellå‘½ä»¤çš„ä¸€å°éƒ¨åˆ†ï¼Œä½†å®ƒä»¬æ˜¯æ—¥å¸¸ä½¿ç”¨ä¸­æœ€åŸºæœ¬å’Œæœ€å¸¸è§çš„ã€‚ç†Ÿç»ƒæŒæ¡è¿™äº›å‘½ä»¤ï¼Œå¯ä»¥å¤§å¤§æé«˜åœ¨Linuxæˆ–Unixç¯å¢ƒä¸‹çš„å·¥ä½œæ•ˆç‡ã€‚</p><h3 id="4ã€å¸¸ç”¨å‘½ä»¤"><a href="#4ã€å¸¸ç”¨å‘½ä»¤" class="headerlink" title="4ã€å¸¸ç”¨å‘½ä»¤"></a>4ã€å¸¸ç”¨å‘½ä»¤</h3><h4 id="æœç´¢æ–‡ä»¶"><a href="#æœç´¢æ–‡ä»¶" class="headerlink" title="æœç´¢æ–‡ä»¶"></a>æœç´¢æ–‡ä»¶</h4><p>å¯ä»¥åœ¨æŒ‡å®šç›®å½•åŠå…¶å­ç›®å½•ä¸‹æœç´¢ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#æ ¹ç›®å½•ä¸‹æœç´¢æ–‡ä»¶</span><br><span class="hljs-built_in">find</span> / -type f -name <span class="hljs-string">&quot;è‹¦æ¶©è„š.wld&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerå…¥é—¨_Dockerçš„åŸºæœ¬ä½¿ç”¨</title>
    <link href="/2024/01/12/Docker%E5%85%A5%E9%97%A8_Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/01/12/Docker%E5%85%A5%E9%97%A8_Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€å®‰è£…-Dockeræ“ä½œ-centosç³»åˆ—å®‰è£…"><a href="#1ã€å®‰è£…-Dockeræ“ä½œ-centosç³»åˆ—å®‰è£…" class="headerlink" title="1ã€å®‰è£… Dockeræ“ä½œ (centosç³»åˆ—å®‰è£…)"></a>1ã€å®‰è£… Dockeræ“ä½œ (centosç³»åˆ—å®‰è£…)</h3><p>å®‰è£…æ“ä½œ</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">yum install -<span class="hljs-keyword">y</span> yum-utils<br><br>yum-config-manager --<span class="hljs-built_in">add</span>-repo http://mirrors.aliyun.<span class="hljs-keyword">com</span>/docker-<span class="hljs-keyword">ce</span>/linux/centos/docker-<span class="hljs-keyword">ce</span>.repo<br><br><br>yum install docker-<span class="hljs-keyword">ce</span> docker-<span class="hljs-keyword">ce</span>-cli containerd.io<br></code></pre></td></tr></table></figure><p>å¯åŠ¨docerå¹¶è®¾ç½®å¼€æœºè‡ªå¯</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl start docker<br><br><span class="hljs-params">system</span>ctl enable docker<br></code></pre></td></tr></table></figure><p>dockeré…ç½®åŠ é€Ÿåº¦</p><p>ä¿®æ”¹ &#x2F;etc&#x2F;docker&#x2F;daemon.json æ–‡ä»¶å¹¶æ·»åŠ ä¸Š registry-mirrors é”®å€¼ï¼›æ³¨å†Œé˜¿é‡Œäº‘ï¼Œå¯è·å–è‡ªå·±çš„åŠ é€Ÿå™¨</p><p>å®¹å™¨é•œåƒæœåŠ¡ â†’  å®¹å™¨åŠ é€Ÿå™¨</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;. <br>    <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://registry.docker-cn.com&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><p>dockerå®‰è£…éªŒè¯</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">docker <span class="hljs-comment">--version</span><br></code></pre></td></tr></table></figure><h3 id="2ã€docker-composeå®‰è£…"><a href="#2ã€docker-composeå®‰è£…" class="headerlink" title="2ã€docker-composeå®‰è£…"></a>2ã€docker-composeå®‰è£…</h3><p>Compose æ˜¯ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚é€šè¿‡ Composeï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ YML æ–‡ä»¶æ¥é…ç½®åº”ç”¨ç¨‹åºéœ€è¦çš„æ‰€æœ‰æœåŠ¡ã€‚</p><p>ä½¿ç”¨ä¸€ä¸ªå‘½ä»¤ï¼Œå°±å¯ä»¥ä» YML æ–‡ä»¶é…ç½®ä¸­åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡</p><blockquote><p>å®‰è£…æ“ä½œ</p></blockquote><p>å…ˆéœ€è¦ä¸‹è½½ä¸€ä¸‹äºŒè¿›åˆ¶æ–‡ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/docker/</span>compose<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v2.5.0/</span>docker-compose-linux-x86_64<br></code></pre></td></tr></table></figure><p>æ”¾å…¥&#x2F;usr&#x2F;local&#x2F;bin&#x2F; è·¯å¾„ä¸‹å¹¶é‡æ–°å‘½åæ·»åŠ å¯æ‰§è¡Œæƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> docker-compose-linux-x86_64 docker-compose<br><span class="hljs-built_in">chmod</span> +x docker-compose<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä¹Ÿå¯ä»¥æ¨èçœ‹ä¸€ä¸‹</p><p>å°†è„šæœ¬ä¸‹è½½ï¼Œé˜¿é‡Œäº‘çš„ä¸‹è½½é€Ÿåº¦è¾ƒå¿«ï¼Œæ¨èé€‚ç”¨</p><p><a href="https://mirrors.aliyun.com/docker-toolbox/linux/compose/1.21.2/">https://mirrors.aliyun.com/docker-toolbox/linux/compose/1.21.2/</a></p><p>æŠŠè„šæœ¬æ”¾åœ¨&#x2F;usr&#x2F;local&#x2F;bin&#x2F;ä¸‹.åå­—ä¸ºdocker-compose ,åŠ æ‰§è¡Œæƒé™ ï¼Œdocker-composeå‘½ä»¤å°±æœ‰äº†</p><h3 id="3ã€docker-å®‰è£…-redis-æ“ä½œ"><a href="#3ã€docker-å®‰è£…-redis-æ“ä½œ" class="headerlink" title="3ã€docker å®‰è£… redis æ“ä½œ"></a>3ã€docker å®‰è£… redis æ“ä½œ</h3><p>å®‰è£… Redis ä½¿ç”¨ Docker æ˜¯ä¸€ä¸ªéå¸¸ç®€å•ä¸”å¿«æ·çš„è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯é€šè¿‡ Docker å®‰è£…å’Œè¿è¡Œ Redis çš„åŸºæœ¬æ­¥éª¤ï¼š</p><ol><li><p><strong>æ‹‰å– Redis é•œåƒ</strong>ï¼š é¦–å…ˆï¼Œä½ éœ€è¦ä» Docker Hub æ‹‰å–æœ€æ–°çš„ Redis é•œåƒã€‚æ‰“å¼€å‘½ä»¤è¡Œç•Œé¢ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><p> <code>docker pull redis</code></p><p> è¿™ä¸ªå‘½ä»¤ä¼šä» Docker Hub ä¸‹è½½æœ€æ–°çš„ Redis é•œåƒã€‚</p></li><li><p><strong>è¿è¡Œ Redis å®¹å™¨</strong>ï¼š æ¥ç€ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ª Redis å®¹å™¨ï¼š</p><p> <code>docker run --name redis -d redis</code></p><p> è¿™é‡Œï¼Œ<code>--name redis</code> è®¾ç½®å®¹å™¨çš„åç§°ä¸º <code>some-redis</code>ã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦æ›´æ”¹è¿™ä¸ªåç§°ã€‚<code>-d</code> å‚æ•°è¡¨ç¤ºå®¹å™¨å°†åœ¨åå°è¿è¡Œã€‚</p></li><li><p><strong>æš´éœ²å’Œæ˜ å°„ç«¯å£</strong>ï¼ˆå¯é€‰ï¼‰ï¼š å¦‚æœä½ æ‰“ç®—ä»å®¿ä¸»æœºå¤–éƒ¨è®¿é—® Redisï¼Œä½ éœ€è¦æ˜ å°„ç«¯å£ã€‚Redis é»˜è®¤ç«¯å£æ˜¯ <code>6379</code>ï¼Œæ‰€ä»¥ä½ å¯ä»¥è¿™æ ·æ˜ å°„ç«¯å£ï¼š</p><p> <code>docker run --name redis -d -p 6379:6379 redis</code></p><p> <code>-p 6379:6379</code> è¡¨ç¤ºå°†å®¹å™¨çš„ 6379 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 6379 ç«¯å£ã€‚</p></li><li><p><strong>è®¿é—® Redis</strong>ï¼š ä¸€æ—¦ Redis å®¹å™¨åœ¨è¿è¡Œï¼Œä½ å¯ä»¥é€šè¿‡ Redis å®¢æˆ·ç«¯æˆ–ä»»ä½•æ”¯æŒ Redis çš„ç¨‹åºè®¿é—®å®ƒã€‚å¦‚æœä½ åªæ˜¯åœ¨æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œå’Œè®¿é—® Redisï¼Œä½ å¯ä»¥é€šè¿‡ <code>localhost:6379</code> æ¥è®¿é—®å®ƒã€‚</p></li><li><p><strong>ä½¿ç”¨ Redis CLI è¿›è¡Œäº¤äº’</strong>ï¼ˆå¯é€‰ï¼‰ï¼š å¦‚æœä½ æƒ³è¦é€šè¿‡ Redis å‘½ä»¤è¡Œç•Œé¢ä¸ Redis å®¹å™¨äº¤äº’ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›å…¥ Redis å®¹å™¨ï¼š</p><p> <code>docker exec -it some-redis redis-cli</code></p></li></ol><p>å°ç»“ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker pull redis<br>docker <span class="hljs-keyword">run</span><span class="language-bash"> --name redis -d -p 6379:6379 redis</span><br>firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --permanent --add-port=6379/tcp</span><br>firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --reload      <span class="hljs-comment"># é‡å¯é˜²ç«å¢™</span></span><br></code></pre></td></tr></table></figure><h3 id="4ã€docker-çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤-ğŸ¦Œ"><a href="#4ã€docker-çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤-ğŸ¦Œ" class="headerlink" title="4ã€docker çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤   ğŸ¦Œ"></a>4ã€docker çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤   ğŸ¦Œ</h3><p>å¸¸ç”¨çš„Dockerå‘½ä»¤ï¼š</p><h4 id="å®¹å™¨ç®¡ç†"><a href="#å®¹å™¨ç®¡ç†" class="headerlink" title="å®¹å™¨ç®¡ç†"></a>å®¹å™¨ç®¡ç†</h4><p>1ã€ <strong>å¯åŠ¨å®¹å™¨</strong>:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker run <span class="hljs-selector-attr">[OPTIONS]</span> IMAGE <span class="hljs-selector-attr">[COMMAND]</span> <span class="hljs-selector-attr">[ARG...]</span><br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š<code>docker run -d -p 80:80 nginx</code> ä¼šä»¥å®ˆæŠ¤æ€è¿è¡Œä¸€ä¸ªnginxå®¹å™¨ï¼Œå¹¶å°†æœ¬æœºçš„80ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„80ç«¯å£ã€‚</p><p>2ã€<strong>åˆ—å‡ºå®¹å™¨</strong>:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> ps<span class="hljs-meta"> [OPTIONS]</span><br></code></pre></td></tr></table></figure><ul><li>åªæ˜¾ç¤ºè¿è¡Œä¸­çš„å®¹å™¨ï¼š<code>docker ps</code></li><li>æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬æœªè¿è¡Œçš„ï¼‰ï¼š<code>docker ps -a</code></li></ul><p>3ã€ <strong>åœæ­¢å®¹å™¨</strong>:</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">docker stop <span class="hljs-comment">[OPTIONS]</span> <span class="hljs-keyword">CONTAINER</span> <span class="hljs-comment">[CONTAINER...]</span><br></code></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼š<code>docker stop my_container</code> åœæ­¢åä¸º <code>my_container</code> çš„å®¹å™¨ã€‚</li></ul><p>4ã€<strong>åˆ é™¤å®¹å™¨</strong>:</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">docker rm <span class="hljs-comment">[OPTIONS]</span> <span class="hljs-keyword">CONTAINER</span> <span class="hljs-comment">[CONTAINER...]</span><br></code></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼š<code>docker rm my_container</code> åˆ é™¤åä¸º <code>my_container</code> çš„å®¹å™¨ã€‚</li></ul><p>5ã€<strong>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</strong>:</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">docker logs <span class="hljs-comment">[OPTIONS]</span> <span class="hljs-keyword">CONTAINER</span><br></code></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼š<code>docker logs my_container</code> æŸ¥çœ‹åä¸º <code>my_container</code> çš„å®¹å™¨çš„æ—¥å¿—ã€‚</li></ul><p>6ã€é‡å¯ docker å®¹å™¨</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">docker restart <span class="hljs-comment">[OPTIONS]</span> <span class="hljs-keyword">CONTAINER</span> <span class="hljs-comment">[CONTAINER...]</span><br></code></pre></td></tr></table></figure><p>å¦‚æœä½ çš„å®¹å™¨åç§°æ˜¯ <code>my_container</code>ï¼Œé‚£ä¹ˆé‡å¯è¿™ä¸ªå®¹å™¨çš„å‘½ä»¤å°†æ˜¯ï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker restart my_container</span><br></code></pre></td></tr></table></figure><h4 id="é•œåƒç®¡ç†"><a href="#é•œåƒç®¡ç†" class="headerlink" title="é•œåƒç®¡ç†"></a>é•œåƒç®¡ç†</h4><p>1ã€<strong>åˆ—å‡ºé•œåƒ</strong>:</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">docker images <span class="hljs-comment">[OPTIONS]</span> <span class="hljs-comment">[REPOSITORY<span class="hljs-comment">[:TAG]</span>]</span><br></code></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼š<code>docker images</code> åˆ—å‡ºæ‰€æœ‰æœ¬åœ°é•œåƒã€‚</li></ul><p>2ã€<strong>æ‹‰å–é•œåƒ</strong>:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">docker pull [<span class="hljs-title class_">OPTIONS</span>] <span class="hljs-title class_">NAME</span>[<span class="hljs-symbol">:TAG|</span><span class="hljs-variable">@DIGEST</span>]<br></code></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼š<code>docker pull nginx</code> æ‹‰å–æœ€æ–°çš„nginxé•œåƒã€‚</li></ul><p>3ã€<strong>æ„å»ºé•œåƒ</strong>:</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">docker build [OPTIONS] PATH |<span class="hljs-string"> URL </span>|<span class="hljs-string"> -</span><br></code></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼š<code>docker build -t my_image .</code> ä¼šæ ¹æ®å½“å‰ç›®å½•ä¸‹çš„ <code>Dockerfile</code> æ„å»ºä¸€ä¸ªåä¸º <code>my_image</code> çš„é•œåƒã€‚</li></ul><p>4ã€ <strong>åˆ é™¤é•œåƒ</strong>:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker rmi <span class="hljs-selector-attr">[OPTIONS]</span> IMAGE <span class="hljs-selector-attr">[IMAGE...]</span><br></code></pre></td></tr></table></figure><ul><li>ä¾‹å¦‚ï¼š<code>docker rmi my_image</code> åˆ é™¤åä¸º <code>my_image</code> çš„é•œåƒã€‚</li></ul><h4 id="ç½‘ç»œç®¡ç†"><a href="#ç½‘ç»œç®¡ç†" class="headerlink" title="ç½‘ç»œç®¡ç†"></a>ç½‘ç»œç®¡ç†</h4><ol><li><p><strong>åˆ—å‡ºç½‘ç»œ</strong>:<br> <code>docker network ls</code></p></li><li><p><strong>åˆ›å»ºç½‘ç»œ</strong>:<br> <code>docker network create [OPTIONS] NETWORK</code></p><ul><li>ä¾‹å¦‚ï¼š<code>docker network create my_network</code> åˆ›å»ºä¸€ä¸ªåä¸º <code>my_network</code> çš„ç½‘ç»œã€‚</li></ul></li><li><p><strong>åˆ é™¤ç½‘ç»œ</strong>:</p><p> <code>docker network rm NETWORK</code></p><ul><li>ä¾‹å¦‚ï¼š<code>docker network rm my_network</code> åˆ é™¤åä¸º <code>my_network</code> çš„ç½‘ç»œã€‚</li></ul></li></ol><h4 id="å·ç®¡ç†"><a href="#å·ç®¡ç†" class="headerlink" title="å·ç®¡ç†"></a>å·ç®¡ç†</h4><ol><li><p><strong>åˆ›å»ºå·</strong>:<br> <code>docker volume create [OPTIONS] [VOLUME]</code></p><ul><li>ä¾‹å¦‚ï¼š<code>docker volume create my_volume</code> åˆ›å»ºä¸€ä¸ªåä¸º <code>my_volume</code> çš„å·ã€‚</li></ul></li><li><p><strong>åˆ—å‡ºå·</strong>:<br> <code>docker volume ls</code></p></li><li><p><strong>åˆ é™¤å·</strong>:</p><p> <code>docker volume rm VOLUME</code></p><ul><li>ä¾‹å¦‚ï¼š<code>docker volume rm my_volume</code> åˆ é™¤åä¸º <code>my_volume</code> çš„å·ã€‚</li></ul></li></ol><h4 id="å…¶ä»–å¸¸ç”¨å‘½ä»¤"><a href="#å…¶ä»–å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å…¶ä»–å¸¸ç”¨å‘½ä»¤"></a>å…¶ä»–å¸¸ç”¨å‘½ä»¤</h4><ol><li><p><strong>æŸ¥çœ‹Dockerç‰ˆæœ¬</strong>:<br> <code>docker version</code></p></li><li><p><strong>æŸ¥çœ‹Dockerç³»ç»Ÿä¿¡æ¯</strong>:<br> <code>docker info</code></p></li><li><p><strong>æŸ¥çœ‹å®¹å™¨&#x2F;é•œåƒ&#x2F;å·ç­‰çš„è¯¦ç»†ä¿¡æ¯</strong>:</p><p> <code>docker inspect NAME|ID</code></p></li></ol><h3 id="5ã€docker-å®‰è£…-Mysql-æ“ä½œ"><a href="#5ã€docker-å®‰è£…-Mysql-æ“ä½œ" class="headerlink" title="5ã€docker å®‰è£… Mysql æ“ä½œ"></a>5ã€docker å®‰è£… Mysql æ“ä½œ</h3><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨Dockerå®‰è£…å’Œè¿è¡ŒMySQL 5.7å’Œ8.0ç‰ˆæœ¬çš„æ­¥éª¤ï¼š</p><blockquote><ol><li><strong>è¿è¡ŒMySQL 5.7</strong></li></ol></blockquote><ol><li><p><strong>æ‹‰å–MySQL 5.7é•œåƒ</strong>:</p><p> <code>docker pull mysql:5.7</code></p></li><li><p><strong>å¯åŠ¨MySQL 5.7å®¹å™¨</strong>:</p></li></ol><p>ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ä¸€ä¸ªåä¸º <code>mysql57</code> çš„MySQL 5.7å®¹å™¨ï¼Œè®¾ç½®rootå¯†ç ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ä¸º<code>yourpassword</code>ï¼‰ï¼Œå¹¶æ˜ å°„ç«¯å£3306ï¼ˆæˆ–é€‰æ‹©å…¶ä»–æœªä½¿ç”¨çš„ç«¯å£ï¼‰åˆ°å®¿ä¸»æœºã€‚<br>åŒæ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªæ•°æ®å·æ¥æŒä¹…åŒ–MySQLæ•°æ®ã€‚</p><p><code>docker run --name mysql57 -e MYSQL_ROOT_PASSWORD=yourpassword -p 3306:3306 -d mysql:5.7</code></p><ul><li>å¦‚æœéœ€è¦æŒä¹…åŒ–æ•°æ®åˆ°ç‰¹å®šè·¯å¾„ï¼Œå¯ä»¥æ·»åŠ  <code>-v</code> å‚æ•°ï¼Œå¦‚:</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run --name mysql57 -e MYSQL_ROOT_PASSWORD=yourpassword -p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> -v /my/own/datadir:/var/lib/mysql -d mysql:<span class="hljs-number">5</span>.<span class="hljs-number">7</span><br></code></pre></td></tr></table></figure><blockquote><ol start="2"><li><strong>è¿è¡ŒMySQL 8.0</strong></li></ol></blockquote><ol><li><p><strong>æ‹‰å–MySQL 8.0é•œåƒ</strong>:</p><p> <code>docker pull mysql:8.0</code></p></li><li><p><strong>å¯åŠ¨MySQL 8.0å®¹å™¨</strong>:</p></li></ol><ul><li>ç”±äºMySQL 5.7å·²ç»ä½¿ç”¨äº†3306ç«¯å£ï¼Œæ‰€ä»¥å¯¹äºMySQL 8.0ï¼Œä½ éœ€è¦æ˜ å°„åˆ°å®¿ä¸»æœºçš„å¦ä¸€ä¸ªç«¯å£ï¼Œä¾‹å¦‚3307ã€‚</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run --name mysql8 -e MYSQL_ROOT_PASSWORD=yourpassword -p <span class="hljs-number">3307</span>:<span class="hljs-number">3306</span> -d mysql:<span class="hljs-number">8</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><ul><li>åŒæ ·ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šæ•°æ®å·æ¥æŒä¹…åŒ–MySQL 8.0çš„æ•°æ®ã€‚</li><li><code>mysql:8.0</code> æŒ‡çš„æ˜¯Dockeré•œåƒçš„åç§°å’Œæ ‡ç­¾ã€‚åœ¨è¿™é‡Œï¼Œ<code>mysql</code> æ˜¯é•œåƒçš„åç§°ï¼Œ<code>8.0</code> æ˜¯é•œåƒçš„æ ‡ç­¾ï¼Œå®ƒæŒ‡å®šäº†MySQLçš„å…·ä½“ç‰ˆæœ¬ã€‚</li></ul><ol start="3"><li><p><strong>éªŒè¯å’Œè¿æ¥</strong></p></li><li><p><strong>éªŒè¯å®¹å™¨è¿è¡ŒçŠ¶æ€</strong>:</p><p> <code>docker ps</code></p></li><li><p><strong>è¿æ¥åˆ°MySQLå®¹å™¨</strong>:</p></li></ol><p>ä½¿ç”¨Dockerå†…ç½®çš„å‘½ä»¤è¡Œæˆ–è€…ä½¿ç”¨ä»»ä½•MySQLå®¢æˆ·ç«¯è¿æ¥åˆ°æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼Œè¦è¿æ¥åˆ°MySQL 5.7å®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ï¼š<br><code>docker exec -it mysql57 mysql -uroot -pyourpassword</code></p><ul><li>å¯¹äºMySQL 8.0ï¼Œè¿æ¥å‘½ä»¤ç±»ä¼¼ï¼Œåªæ˜¯å®¹å™¨åç§°ä¸åŒã€‚</li></ul><blockquote><p>æ³¨æ„äº‹é¡¹</p></blockquote><ul><li>æ›¿æ¢ä¸Šè¿°å‘½ä»¤ä¸­çš„ <code>yourpassword</code> ä¸ºä½ è‡ªå·±çš„å¼ºå¯†ç ã€‚</li><li>å¦‚æœä½ ä½¿ç”¨äº†è‡ªå®šä¹‰æ•°æ®å·è·¯å¾„ï¼ˆå¦‚ <code>/my/own/datadir</code>ï¼‰ï¼Œç¡®ä¿è¯¥è·¯å¾„åœ¨å®¿ä¸»æœºä¸Šå­˜åœ¨ï¼Œå¹¶ä¸”Dockeræœ‰æƒé™è®¿é—®ã€‚</li><li>MySQL 8.0 é»˜è®¤ä½¿ç”¨äº†æ›´å¼ºçš„å¯†ç åŠ å¯†ç­–ç•¥ï¼ˆcaching_sha2_passwordï¼‰ï¼ŒæŸäº›å®¢æˆ·ç«¯å¯èƒ½éœ€è¦æ›´æ–°æˆ–é…ç½®ä»¥æ”¯æŒæ–°çš„åŠ å¯†æ–¹å¼ã€‚</li></ul><hr><h3 id="6ã€docker-å®‰è£…-nginx"><a href="#6ã€docker-å®‰è£…-nginx" class="headerlink" title="6ã€docker å®‰è£… nginx"></a>6ã€docker å®‰è£… nginx</h3><p>å‚è€ƒ: <a href="https://blog.csdn.net/BThinker/article/details/123507820">https://blog.csdn.net/BThinker/article/details/123507820</a></p><p>ä¸‹é¢æ˜¯å…ˆè¿è¡Œæœ€æ–°ç‰ˆæœ¬çš„ Nginx ,ç„¶åå°†æœåŠ¡ä¸‹çš„æ–‡ä»¶å¤åˆ¶ä¸€ä»½åˆ°æŒ‚è½½ç›®å½•,ç„¶ååˆ é™¤å®¹å™¨,é‡å¯è¿è¡Œçš„ä¸€ä¸ªæ“ä½œã€‚</p><p>åé¢çš„ä¸€äº›ç›®å½•å’Œé…ç½®æŸ¥çœ‹å°±å¯ä»¥ç›´æ¥åœ¨ç›®å½• home&#x2F;nginx&#x2F; æŸ¥çœ‹ç›¸å…³å†…å®¹.</p><p>å¯ä»¥é€‰æ‹©ä¸‹è½½æŒ‡å®šç‰ˆæœ¬ï¼Œæˆ–è€…æœ€æ–°ç‰ˆæœ¬</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker pull nginx</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºNginxé…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºæŒ‚è½½ç›®å½•</span><br><span class="hljs-built_in">mkdir</span> -p /home/nginx/conf<br><span class="hljs-built_in">mkdir</span> -p /home/nginx/log<br><span class="hljs-built_in">mkdir</span> -p /home/nginx/html<br></code></pre></td></tr></table></figure><p>å¯åŠ¨å‰éœ€è¦å…ˆåˆ›å»ºNginxå¤–éƒ¨æŒ‚è½½çš„é…ç½®æ–‡ä»¶ï¼ˆ &#x2F;home&#x2F;nginx&#x2F;conf&#x2F;nginx.confï¼‰</p><p>ä¹‹æ‰€ä»¥è¦å…ˆåˆ›å»º , æ˜¯å› ä¸ºNginxæœ¬èº«å®¹å™¨åªå­˜åœ¨&#x2F;etc&#x2F;nginx ç›®å½• , æœ¬èº«å°±ä¸åˆ›å»º nginx.conf æ–‡ä»¶<br>å½“æœåŠ¡å™¨å’Œå®¹å™¨éƒ½ä¸å­˜åœ¨ nginx.conf æ–‡ä»¶æ—¶, æ‰§è¡Œå¯åŠ¨å‘½ä»¤çš„æ—¶å€™ dockerä¼šå°†nginx.conf ä½œä¸ºç›®å½•åˆ›å»º , è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ ã€‚</p><blockquote><p>å®¹å™¨ä¸­çš„nginx.confæ–‡ä»¶å’Œconf.dæ–‡ä»¶å¤¹å¤åˆ¶åˆ°å®¿ä¸»æœº</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># ç”Ÿæˆå®¹å™¨</span><br>docker run --name nginx -p <span class="hljs-number">9001</span>:<span class="hljs-number">80</span> -d nginx<br><span class="hljs-comment"># å°†å®¹å™¨nginx.confæ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœº</span><br>docker cp nginx:<span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/nginx.conf /</span>home<span class="hljs-regexp">/nginx/</span>conf/nginx.conf<br><span class="hljs-comment"># å°†å®¹å™¨conf.dæ–‡ä»¶å¤¹ä¸‹å†…å®¹å¤åˆ¶åˆ°å®¿ä¸»æœº</span><br>docker cp nginx:<span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/conf.d /</span>home<span class="hljs-regexp">/nginx/</span>conf/conf.d<br><span class="hljs-comment"># å°†å®¹å™¨ä¸­çš„htmlæ–‡ä»¶å¤¹å¤åˆ¶åˆ°å®¿ä¸»æœº</span><br>docker cp nginx:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html <span class="hljs-regexp">/home/</span>nginx/<br></code></pre></td></tr></table></figure><p>åˆ›å»º Nginx å®¹å™¨å¹¶è¿è¡Œ</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># ç›´æ¥æ‰§è¡Œdocker rm nginxæˆ–è€…ä»¥å®¹å™¨idæ–¹å¼å…³é—­å®¹å™¨</span><br><span class="hljs-comment"># æ‰¾åˆ°nginxå¯¹åº”çš„å®¹å™¨id</span><br>docker <span class="hljs-built_in">ps</span> <span class="hljs-literal">-a</span><br><span class="hljs-comment"># å…³é—­è¯¥å®¹å™¨</span><br>docker stop nginx<br><span class="hljs-comment"># åˆ é™¤è¯¥å®¹å™¨</span><br>docker <span class="hljs-built_in">rm</span> nginx<br> <br><span class="hljs-comment"># åˆ é™¤æ­£åœ¨è¿è¡Œçš„nginxå®¹å™¨</span><br>docker <span class="hljs-built_in">rm</span> <span class="hljs-operator">-f</span> nginx<br></code></pre></td></tr></table></figure><p>å¯åŠ¨å‘½ä»¤</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy">docker run \<br>-p <span class="hljs-number">9002</span>:<span class="hljs-number">80</span> \<br>--name nginx \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/conf/</span>nginx.<span class="hljs-attr">conf:</span><span class="hljs-regexp">/etc/</span>nginx/nginx.conf \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/conf/</span>conf.<span class="hljs-attr">d:</span><span class="hljs-regexp">/etc/</span>nginx/conf.d \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/log:/</span><span class="hljs-keyword">var</span><span class="hljs-regexp">/log/</span>nginx \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/html:/</span>usr<span class="hljs-regexp">/share/</span>nginx/html \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/shareFile/</span>:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>shareFile \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/ssl:/</span>etc<span class="hljs-regexp">/nginx/</span>ssl \<br>-d <span class="hljs-attr">nginx:</span>latest<br></code></pre></td></tr></table></figure><p>å•è¡Œæ¨¡å¼</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">docker run -p <span class="hljs-number">9002</span>:<span class="hljs-number">80</span> --name nginx -v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/conf/</span>nginx.<span class="hljs-attr">conf:</span><span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/nginx.conf -v /</span>home<span class="hljs-regexp">/nginx/</span>conf<span class="hljs-regexp">/conf.d:/</span>etc<span class="hljs-regexp">/nginx/</span>conf.d -v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/log:/</span><span class="hljs-keyword">var</span><span class="hljs-regexp">/log/</span>nginx -v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/html:/</span>usr<span class="hljs-regexp">/share/</span>nginx/html -d <span class="hljs-attr">nginx:</span>latest<br></code></pre></td></tr></table></figure><p>æµ‹è¯•è®¿é—®:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//IP:9002/</span><br></code></pre></td></tr></table></figure><p>é‡å¯å®¹å™¨æ“ä½œ:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># é‡å¯å®¹å™¨</span><br><span class="hljs-attribute">docker</span> restart nginx<br></code></pre></td></tr></table></figure><h3 id="7ã€Docker-éƒ¨ç½²å¾®æœåŠ¡é¡¹ç›®-ğŸ’£"><a href="#7ã€Docker-éƒ¨ç½²å¾®æœåŠ¡é¡¹ç›®-ğŸ’£" class="headerlink" title="7ã€Docker éƒ¨ç½²å¾®æœåŠ¡é¡¹ç›®  ğŸ’£"></a>7ã€Docker éƒ¨ç½²å¾®æœåŠ¡é¡¹ç›®  ğŸ’£</h3><p>ä¸»è¦è®²è¿°éƒ¨ç½²åç«¯æœåŠ¡</p><ul><li>1ã€è®²é¡¹ç›®è¿›è¡Œ maven æ‰“åŒ…ä¸º Jar åŒ…</li><li>2ã€ç¼–å†™ Dockerfile ç”¨äºæ„å»ºé•œåƒ</li><li>3ã€å°† jar åŒ… ä»¥åŠ Dockerfile ä¸Šä¼ åˆ° æœåŠ¡å™¨ï¼Œå°½é‡ç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œç®¡ç†æ–¹ä¾¿ã€‚æ¯ä¸€ä¸ªæ–‡ä»¶å¤¹å¯¹åº”ä¸€ä¸ªæœåŠ¡çš„ jaråŒ…ä»¥åŠ Dockerfile</li><li>4ã€æ„å»ºDockeré•œåƒï¼Œè¿è¡ŒDockerå®¹å™¨</li></ul><p>éœ€è¦å•ç‹¬å»å®é™…è·‘ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œæœ‰ç©ºæä¸€ä¸‹è˜‘è‡é¡¹ç›®çš„ docker éƒ¨ç½² to be continedâ€¦.</p><p>service_cms</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># åŸºç¡€é•œåƒ</span><br><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span><br><span class="hljs-comment"># ç¯å¢ƒå˜é‡</span><br><span class="hljs-keyword">ENV</span> APP_HOME=/apps<br><span class="hljs-comment"># åˆ›å»ºå®¹å™¨é»˜è®¤è¿›å…¥çš„ç›®å½•</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> <span class="hljs-variable">$APP_HOME</span></span><br><span class="hljs-comment"># å¤åˆ¶jaråŒ…åˆ°å®¹å™¨ä¸­</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./service_cms-0.0.1-SNAPSHOT.jar ./service_cms.jar</span><br><span class="hljs-comment"># æš´éœ²ç«¯å£</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8004</span><br><span class="hljs-comment"># å¯åŠ¨å‘½ä»¤(å¯åŠ¨Spring Bootåº”ç”¨)</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-jar&quot;</span>,<span class="hljs-string">&quot;-Xms100m&quot;</span>,<span class="hljs-string">&quot;-Xmx100m&quot;</span>]</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;service_cms.jar&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>service_edu</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> openjdk:<span class="hljs-number">8</span><br><span class="hljs-keyword">ENV</span> APP_HOME=/apps<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> <span class="hljs-variable">$APP_HOME</span></span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./service_edu-0.0.1-SNAPSHOT.jar ./service_edu.jar</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8001</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-jar&quot;</span>,<span class="hljs-string">&quot;-Xms100m&quot;</span>,<span class="hljs-string">&quot;-Xmx100m&quot;</span>]</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;service_edu.jar&quot;</span>]</span><br></code></pre></td></tr></table></figure><hr><h3 id="8ã€Docker-é…ç½®é•œåƒæº"><a href="#8ã€Docker-é…ç½®é•œåƒæº" class="headerlink" title="8ã€Docker é…ç½®é•œåƒæº"></a>8ã€Docker é…ç½®é•œåƒæº</h3><p>é…ç½®æ–‡ä»¶  &#x2F;etc&#x2F;docker&#x2F;daemon.json</p><p>æ·»åŠ å†…å®¹</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br>  <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;https://hub-mirror.c.163.com&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¦ä½¿ç”¨å¤šä¸ªé•œåƒæºï¼Œå¯ä»¥åœ¨Â <code>&quot;registry-mirrors&quot;</code>Â æ•°ç»„ä¸­æ·»åŠ å¤šä¸ªé•œåƒæºåœ°å€ï¼Œä»¥è‹±æ–‡é€—å·åˆ†éš”ã€‚</p><p>ä¿å­˜é…ç½®æ–‡ä»¶ï¼Œé‡å¯ Docker æœåŠ¡</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">sudo systemctl restart docker</span><br></code></pre></td></tr></table></figure><p>å¸¸è§çš„é•œåƒæº</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">ç½‘æ˜“äº‘ Docker é•œåƒï¼š<span class="hljs-keyword">https</span>://hub-mirror.c<span class="hljs-number">.163</span>.com<br>ç™¾åº¦äº‘ Docker é•œåƒï¼š<span class="hljs-keyword">https</span>://mirror.baidubce.com<br>é˜¿é‡Œäº‘ Docker é•œåƒï¼ˆéœ€è¦ä½¿ç”¨é˜¿é‡Œè´¦å·è‡ªè¡Œåˆ›å»ºä¸“å±é•œåƒä»“åº“ï¼‰ï¼š<span class="hljs-keyword">https</span>://<span class="hljs-literal">cr</span>.console.aliyun.com/<br>DaoCloud Docker é•œåƒï¼ˆé…ç½®æ–‡æ¡£ï¼‰ï¼š<span class="hljs-keyword">http</span>://f1361db2.m.daocloud.io<br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/qq_45868731/article/details/131743699">https://blog.csdn.net/qq_45868731/article/details/131743699</a></li><li><a href="https://blog.csdn.net/ninimino/article/details/113388745">https://blog.csdn.net/ninimino/article/details/113388745</a></li><li><a href="https://blog.csdn.net/weixin_45821811/article/details/116211724">https://blog.csdn.net/weixin_45821811/article/details/116211724</a></li><li><a href="https://blog.csdn.net/aetawt/article/details/128999752">https://blog.csdn.net/aetawt/article/details/128999752</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBooté¡¹ç›®éƒ¨ç½²æ–¹æ¡ˆ</title>
    <link href="/2024/01/11/SpringBoot%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/"/>
    <url>/2024/01/11/SpringBoot%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€äº›å¸¸ç”¨æ“ä½œï¼š</p><h3 id="1ã€profilesæŒ‡å®šä¸åŒç¯å¢ƒçš„é…ç½®"><a href="#1ã€profilesæŒ‡å®šä¸åŒç¯å¢ƒçš„é…ç½®" class="headerlink" title="1ã€profilesæŒ‡å®šä¸åŒç¯å¢ƒçš„é…ç½®"></a>1ã€profilesæŒ‡å®šä¸åŒç¯å¢ƒçš„é…ç½®</h3><p>ä¸€èˆ¬ç”¨äºåŒºåˆ«ä¸åŒçš„ç¯å¢ƒï¼Œå¸¸è§çš„ å¼€å‘ã€æµ‹è¯•ã€æ­£å¼</p><p>ç¯å¢ƒåŒºåˆ†é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><p>é€šè¿‡application.ymlä¸­ç¼–ç æŒ‡å®šÂ <code>profile.active=uat</code>Â æ–¹å¼æŒ‡å®š</p></li><li><p>é€šè¿‡mvnä¸­profilesæ¥åŒºåˆ†ä¸åŒç¯å¢ƒå¯¹åº”çš„é…ç½®æ–‡ä»¶å¤¹ï¼Œäººå·¥å¯ä»¥æ‰‹åŠ¨åœ¨ideaå‹¾é€‰ç”Ÿæˆä¸åŒç¯å¢ƒçš„åŒ…(æ¨è)</p></li></ul><h4 id="application-yml-ç¼–ç æŒ‡å®š"><a href="#application-yml-ç¼–ç æŒ‡å®š" class="headerlink" title="application.yml ç¼–ç æŒ‡å®š"></a>application.yml ç¼–ç æŒ‡å®š</h4><p>ç•¥</p><h4 id="mvn-â†’-profiles-åŒºåˆ†"><a href="#mvn-â†’-profiles-åŒºåˆ†" class="headerlink" title="mvn â†’ profiles åŒºåˆ†"></a>mvn â†’ profiles åŒºåˆ†</h4><p>åœ¨mvnä¸­é…ç½®å¦‚ä¸‹å†…å®¹</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>node<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">&lt;!--ä¼ é€’ç»™è„šæœ¬çš„å‚æ•°å€¼--&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">activeProfile</span>&gt;</span>node<span class="hljs-tag">&lt;/<span class="hljs-name">activeProfile</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">package-name</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;scripts_packageName&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">package-name</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">boot-main</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;scripts_bootMain&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">boot-main</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">activeByDefault</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">activeByDefault</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>node1<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">activeProfile</span>&gt;</span>node1<span class="hljs-tag">&lt;/<span class="hljs-name">activeProfile</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">package-name</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;scripts_packageName&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">package-name</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">boot-main</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;scripts_bootMain&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">boot-main</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>node2<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">activeProfile</span>&gt;</span>node2<span class="hljs-tag">&lt;/<span class="hljs-name">activeProfile</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">package-name</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;scripts_packageName&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">package-name</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">boot-main</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;scripts_bootMain&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">boot-main</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>  </span><br><span class="language-xml">Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªè§£é‡Š</p><p><strong>èŠ‚ç‚¹ç²—è§£ï¼š</strong></p><p><strong>idï¼š</strong>Â ç”¨æ¥æŒ‡å®šä¸åŒç¯å¢ƒé…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•:</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401110850243.png" alt="image.png"></p><p>è€Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåœ¨ç»™å®šçš„é…ç½®ä¸­ï¼Œå®šä¹‰äº†ä¸‰ä¸ª <code>profile</code>ï¼Œåˆ†åˆ«æ˜¯ <code>node</code>, <code>node1</code>, å’Œ <code>node2</code>ã€‚æ¯ä¸ª <code>profile</code> ä¸­å®šä¹‰äº†ä¸€äº› <code>properties</code>ï¼Œè¿™äº›å±æ€§å¯ä»¥åœ¨æ„å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨</p><p><strong>propertiesï¼š</strong>Â </p><p>è¯¥èŠ‚ç‚¹ä¸­çš„èŠ‚ç‚¹æ˜¯å¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œä¸Šé¢ä»£ç ä¸­çš„package-nameèŠ‚ç‚¹å€¼å¯ä»¥åœ¨å¦å¤–çš„assembly.xmlæˆ–è€…shellè„šæœ¬æ–‡ä»¶ä¸­é€šè¿‡<code>$&#123;package-name&#125;</code>è·å–åˆ°ï¼Œå¦‚ä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401110851350.png" alt="image.png"></p><p><strong>activeByDefaultï¼š</strong>Â æŒ‡å®šé»˜è®¤ç¯å¢ƒé…ç½®æ–‡ä»¶å¤¹</p><p>â†‘ çœ‹äº†ä¸€ä¸‹å¤§æ¦‚çš„è§£é‡Šï¼Œè¿™é‡Œçš„ç”¨æ³•å¤§æ¦‚æ˜¯åœ¨ pom ä¾èµ–é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸‹å¯¹åº”çš„ profile çš„èŠ‚ç‚¹ id ï¼›å¹¶é…ç½®å¯¹åº”æ–‡ä»¶å¤¹ï¼ˆåœ¨ profiles æ–‡ä»¶å¤¹ä¸‹ï¼‰</p><p>é€šè¿‡ä¸åŒçš„æ–‡ä»¶å¤¹å¯¹åº”ä¸åŒçš„ yml é…ç½®æ–‡ä»¶</p><p>ç„¶ååœ¨æ‰“åŒ…æˆ–è€…è¿è¡Œçš„æ—¶å€™é€šè¿‡ ç±»ä¼¼è¿™ç§å‘½ä»¤æ¥æ“ä½œ <code>mvn clean install -Pnode1</code>  ï¼›å…·ä½“å¾…å®è·µä¸€ä¸‹ã€‚</p><h3 id="2ã€maven-assembly-pluginæ‰“-å‘å¸ƒå‹ç¼©åŒ…"><a href="#2ã€maven-assembly-pluginæ‰“-å‘å¸ƒå‹ç¼©åŒ…" class="headerlink" title="2ã€maven-assembly-pluginæ‰“  å‘å¸ƒå‹ç¼©åŒ…"></a>2ã€maven-assembly-pluginæ‰“  å‘å¸ƒå‹ç¼©åŒ…</h3><p>å…ˆè®°å½•ä¸€ä¸‹ï¼Œå…·ä½“æ²¡ç”¨è¿‡ï¼Œæš‚æ—¶ä¸å¤ªæ¸…æ¥š</p><p>å…·ä½“å†…å®¹çœ‹å‚è€ƒé“¾æ¥ï¼š <a href="https://mp.weixin.qq.com/s/yGPnk-bTkcBUiVq2FZsrBQ">https://mp.weixin.qq.com/s/yGPnk-bTkcBUiVq2FZsrBQ</a></p><p>to be continedâ€¦.</p><p>åç»­å†…å®¹å¾…å®é™…éƒ¨ç½²çš„æ—¶å€™ä½¿ç”¨ä¸€ä¸‹ï¼Œå†è¿›è¡Œè®°å½•</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://mp.weixin.qq.com/s/yGPnk-bTkcBUiVq2FZsrBQ">https://mp.weixin.qq.com/s/yGPnk-bTkcBUiVq2FZsrBQ</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>springboot</tag>
      
      <tag>Build</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è˜‘è‡åšå®¢é¡¹ç›®_Day05</title>
    <link href="/2024/01/08/%E8%98%91%E8%8F%87%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE_Day05/"/>
    <url>/2024/01/08/%E8%98%91%E8%8F%87%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE_Day05/</url>
    
    <content type="html"><![CDATA[<h4 id="1ã€é‚®ä»¶åŠŸèƒ½"><a href="#1ã€é‚®ä»¶åŠŸèƒ½" class="headerlink" title="1ã€é‚®ä»¶åŠŸèƒ½"></a>1ã€é‚®ä»¶åŠŸèƒ½</h4><p>ç•¥ï¼Œåç»­å®é™…è¿è¡Œçœ‹ä¸€ä¸‹å¹¶è¿›è¡Œåˆ†æã€‚</p><p>ç±»ï¼š RabbitMqUtilã€SendMailUtilsã€SmsUtil</p><p>é€šè¿‡è¿™ä¸ªå·¥å…·ç±»æ¥è¿›è¡Œå‘é€é‚®ä»¶ã€‚</p><h4 id="2ã€åˆ‡é¢ï¼šé™åˆ¶è¯·æ±‚è®¿é—®"><a href="#2ã€åˆ‡é¢ï¼šé™åˆ¶è¯·æ±‚è®¿é—®" class="headerlink" title="2ã€åˆ‡é¢ï¼šé™åˆ¶è¯·æ±‚è®¿é—®"></a>2ã€åˆ‡é¢ï¼šé™åˆ¶è¯·æ±‚è®¿é—®</h4><p>å»ºè®®å’Œ [[è˜‘è‡åšå®¢é¡¹ç›®_Day04#1ã€è‡ªå®šä¹‰æ³¨è§£<code>AvoidRepeatableCommit</code>çš„ä½¿ç”¨]] è¿™éƒ¨åˆ†å†…å®¹ä¸€èµ·çœ‹</p><p><code>RequestLimitAspect</code> ç±»æ˜¯ä¸€ä¸ªSpring AOPåˆ‡é¢ï¼Œç”¨äºé™åˆ¶æ¥å£è¯·æ±‚çš„é¢‘ç‡ã€‚è¿™ä¸ªåˆ‡é¢é€šè¿‡Rediså®ç°è¯·æ±‚çš„è®¡æ•°å’Œæ—¶é—´é™åˆ¶ã€‚</p><p>ä¸‹é¢æ˜¯å¯¹è¿™ä¸ªåˆ‡é¢ç±»å®ç°çš„è¯¦ç»†è§£é‡Šå’Œæ³¨é‡Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@RefreshScope</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestLimitAspect</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">POINT</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;execution(* com.moxi.mogublog.web.restapi..*.*(..))&quot;</span>;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisUtil redisUtil;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RequestLimitConfig requestLimitConfig;<br><br>    <span class="hljs-meta">@Pointcut(POINT)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pointcut</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç¯ç»•é€šçŸ¥ï¼šç”¨äºåœ¨æ–¹æ³•æ‰§è¡Œå‰åè¿›è¡Œè¯·æ±‚é™åˆ¶çš„æ£€æŸ¥ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> point è¿æ¥ç‚¹ï¼Œæä¾›å¯¹æ‹¦æˆªæ–¹æ³•çš„è®¿é—®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ–¹æ³•æ‰§è¡Œç»“æœ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Throwable å¯èƒ½æŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Around(&quot;pointcut()&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint point)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-keyword">if</span> (requestLimitConfig.getStart()) &#123;<br>            <span class="hljs-type">ServletRequestAttributes</span> <span class="hljs-variable">attribute</span> <span class="hljs-operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();<br>            <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> attribute.getRequest();<br><br>            <span class="hljs-comment">// è·å–IPå’Œè¯·æ±‚è·¯å¾„</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> IpUtils.getIpAddr(request);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> request.getRequestURL().toString();<br><br>            <span class="hljs-comment">// è·å–æ–¹æ³•åç§°</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> point.getSignature().getName();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> RedisConf.REQUEST_LIMIT + RedisConf.SEGMENTATION + ip + RedisConf.SEGMENTATION + methodName;<br><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">currentMethod</span> <span class="hljs-operator">=</span> AspectUtil.INSTANCE.getMethod(point);<br><br>            <span class="hljs-comment">// æ£€æŸ¥æ–¹æ³•æ˜¯å¦æœ‰RequestLimitæ³¨è§£</span><br>            <span class="hljs-keyword">if</span> (currentMethod.isAnnotationPresent(RequestLimit.class)) &#123;<br>                <span class="hljs-type">RequestLimit</span> <span class="hljs-variable">requestLimit</span> <span class="hljs-operator">=</span> currentMethod.getAnnotation(RequestLimit.class);<br>                <span class="hljs-type">boolean</span> <span class="hljs-variable">checkResult</span> <span class="hljs-operator">=</span> checkWithRedis(requestLimit.amount(), requestLimit.time(), key);<br>                <span class="hljs-keyword">if</span> (checkResult) &#123;<br>                    log.info(<span class="hljs-string">&quot;requestLimited, [ç”¨æˆ·ip:&#123;&#125;], [è®¿é—®åœ°å€:&#123;&#125;]è¶…è¿‡äº†é™å®šçš„æ¬¡æ•°[&#123;&#125;]æ¬¡&quot;</span>, ip, url, requestLimit.amount());<br>                    <span class="hljs-keyword">return</span> ResultUtil.result(ECode.REQUEST_OVER_LIMIT, <span class="hljs-string">&quot;æ¥å£è¯·æ±‚è¿‡äºé¢‘ç¹&quot;</span>);<br>                &#125;<br>                <span class="hljs-keyword">return</span> point.proceed();<br>            &#125;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">checkResult</span> <span class="hljs-operator">=</span> checkWithRedis(requestLimitConfig.getAmount(), requestLimitConfig.getTime(), key);<br>            <span class="hljs-keyword">if</span> (checkResult) &#123;<br>                log.info(<span class="hljs-string">&quot;requestLimited, [ç”¨æˆ·ip:&#123;&#125;], [è®¿é—®åœ°å€:&#123;&#125;]è¶…è¿‡äº†é™å®šçš„æ¬¡æ•°[&#123;&#125;]æ¬¡&quot;</span>, ip, url, requestLimitConfig.getAmount());<br>                <span class="hljs-keyword">return</span> ResultUtil.result(ECode.REQUEST_OVER_LIMIT, <span class="hljs-string">&quot;æ¥å£è¯·æ±‚è¿‡äºé¢‘ç¹&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> point.proceed();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€šè¿‡Redisè®°å½•å’Œæ£€æŸ¥è¯·æ±‚æ¬¡æ•°ï¼Œå®ç°è¯·æ±‚é™åˆ¶ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> amount å…è®¸çš„æœ€å¤§è¯·æ±‚æ¬¡æ•°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time   æ—¶é—´é™åˆ¶ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    Redisé”®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ˜¯å¦è¶…è¿‡è¯·æ±‚é™åˆ¶</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkWithRedis</span><span class="hljs-params">(<span class="hljs-type">int</span> amount, <span class="hljs-type">long</span> time, String key)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> redisUtil.incrBy(key, <span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">if</span> (count == <span class="hljs-number">1</span>) &#123;<br>            redisUtil.expire(key, time, TimeUnit.MILLISECONDS);<br>        &#125;<br>        <span class="hljs-keyword">return</span> count &gt; amount;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç±»ä¸­ï¼š</p><ol><li><strong>å®šä¹‰åˆ‡ç‚¹</strong>ï¼šé€šè¿‡ <code>@Pointcut</code> å®šä¹‰äº†ä¸€ä¸ªåˆ‡ç‚¹ï¼Œæ‹¦æˆªç‰¹å®šåŒ…ä¸‹çš„æ‰€æœ‰æ–¹æ³•ã€‚</li><li><strong>ç¯ç»•é€šçŸ¥</strong>ï¼š<code>@Around(&quot;pointcut()&quot;)</code> è¡¨æ˜ <code>around</code> æ–¹æ³•ä¼šåœ¨åˆ‡ç‚¹åŒ¹é…çš„æ–¹æ³•æ‰§è¡Œå‰åè¿›è¡Œã€‚</li><li><strong>è¯·æ±‚é™åˆ¶é€»è¾‘</strong>ï¼š<ul><li>è·å–è¯·æ±‚çš„IPåœ°å€å’ŒURLã€‚</li><li>æ„é€ ä¸€ä¸ªRedisé”®ï¼ŒåŸºäºIPåœ°å€å’Œæ–¹æ³•åç§°ã€‚</li><li>æ£€æŸ¥å½“å‰æ–¹æ³•æ˜¯å¦æœ‰ <code>@RequestLimit</code> æ³¨è§£ï¼Œå¦‚æœæœ‰ï¼Œä½¿ç”¨æ³¨è§£ä¸­çš„å‚æ•°è¿›è¡Œè¯·æ±‚é™åˆ¶æ£€æŸ¥ã€‚</li><li>å¦‚æœæ²¡æœ‰è¯¥æ³¨è§£ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å‚æ•°è¿›è¡Œæ£€æŸ¥ã€‚</li><li>ä½¿ç”¨ <code>checkWithRedis</code> æ–¹æ³•æ£€æŸ¥æ˜¯å¦è¶…è¿‡è¯·æ±‚é™åˆ¶ã€‚å¦‚æœè¶…è¿‡ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ã€‚</li></ul></li><li><strong>Redisè®¡æ•°å’Œè¿‡æœŸæ—¶é—´</strong>ï¼š<ul><li><code>checkWithRedis</code> æ–¹æ³•ä½¿ç”¨Redisæ¥è®¡æ•°æ¯ä¸ªè¯·æ±‚çš„é¢‘ç‡</li></ul></li></ol>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaåŸºç¡€_åŸºç¡€å†…å®¹03</title>
    <link href="/2024/01/08/Java%E5%9F%BA%E7%A1%80_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B903/"/>
    <url>/2024/01/08/Java%E5%9F%BA%E7%A1%80_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B903/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€å¼‚å¸¸"><a href="#1ã€å¼‚å¸¸" class="headerlink" title="1ã€å¼‚å¸¸"></a>1ã€å¼‚å¸¸</h3><h4 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401181322703.png" alt="image.png"></p><h5 id="try-catch-finally"><a href="#try-catch-finally" class="headerlink" title="try-catch-finally"></a>try-catch-finally</h5><blockquote><p>try-catch-finally ä¸­å“ªä¸ªéƒ¨åˆ†å¯ä»¥çœç•¥</p></blockquote><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">// ç¤ºä¾‹ï¼štry-catch-finallyç»“æ„</span><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// ä»£ç å—ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¼‚å¸¸</span><br>&#125; <span class="hljs-keyword">catch</span> (ExceptionType1 e) &#123;<br>    <span class="hljs-comment">// å¤„ç†ExceptionType1å¼‚å¸¸</span><br>&#125; <span class="hljs-keyword">catch</span> (ExceptionType2 e) &#123;<br>    <span class="hljs-comment">// å¤„ç†ExceptionType2å¼‚å¸¸</span><br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    <span class="hljs-comment">// æ¸…ç†ä»£ç ï¼Œæ€»æ˜¯ä¼šæ‰§è¡Œ</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨Javaä¸­çš„<code>try-catch-finally</code>å¼‚å¸¸å¤„ç†ç»“æ„ä¸­ï¼š</p><ol><li><strong><code>try</code>å—</strong>:<ul><li>ä¸å¯çœç•¥ã€‚å¿…é¡»æœ‰<code>try</code>å—ï¼Œå› ä¸ºå®ƒå®šä¹‰äº†å¯èƒ½äº§ç”Ÿå¼‚å¸¸çš„ä»£ç æ®µã€‚</li></ul></li><li><strong><code>catch</code>å—</strong>:<ul><li>å¯ä»¥çœç•¥ï¼Œä½†å¦‚æœçœç•¥<code>catch</code>å—ï¼Œå¿…é¡»æœ‰<code>finally</code>å—ã€‚</li><li>å¦‚æœ<code>try</code>å—ä¸­çš„ä»£ç å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œé€šå¸¸éœ€è¦è‡³å°‘ä¸€ä¸ª<code>catch</code>å—æ¥å¤„ç†è¿™äº›å¼‚å¸¸ã€‚</li></ul></li><li><strong><code>finally</code>å—</strong>:<ul><li>å¯ä»¥çœç•¥ï¼Œä½†å¦‚æœçœç•¥<code>finally</code>å—ï¼Œå¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ª<code>catch</code>å—ã€‚</li><li><code>finally</code>å—ç”¨äºæ‰§è¡Œæ¸…ç†æ“ä½œï¼Œæ— è®ºæ˜¯å¦æ•è·åˆ°å¼‚å¸¸ï¼Œ<code>finally</code>å—æ€»æ˜¯ä¼šæ‰§è¡Œã€‚</li></ul></li></ol><p>å› æ­¤ï¼Œå¯ä»¥çœç•¥<code>catch</code>å—æˆ–<code>finally</code>å—ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œä½†ä¸èƒ½ä¸¤ä¸ªéƒ½çœç•¥ã€‚ä½ è‡³å°‘éœ€è¦<code>try</code>å’Œ<code>catch</code>ï¼Œæˆ–è€…<code>try</code>å’Œ<code>finally</code>ç»„åˆã€‚</p><hr><h4 id="Checked-Exception-å’Œ-Unchecked-Exception"><a href="#Checked-Exception-å’Œ-Unchecked-Exception" class="headerlink" title="Checked Exception å’Œ Unchecked Exception"></a>Checked Exception å’Œ Unchecked Exception</h4><p><strong>Checked Exception</strong> å³ å—æ£€æŸ¥å¼‚å¸¸ ï¼ŒJava ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå—æ£€æŸ¥å¼‚å¸¸æ²¡æœ‰è¢« <code>catch</code>æˆ–è€…<code>throws</code> å…³é”®å­—å¤„ç†çš„è¯ï¼Œå°±æ²¡åŠæ³•é€šè¿‡ç¼–è¯‘ã€‚</p><p>æ¯”å¦‚ä¸‹é¢è¿™æ®µ IO æ“ä½œçš„ä»£ç ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401181324094.png" alt="image.png"></p><p>é™¤äº†<code>RuntimeException</code>åŠå…¶å­ç±»ä»¥å¤–ï¼Œå…¶ä»–çš„<code>Exception</code>ç±»åŠå…¶å­ç±»éƒ½å±äºå—æ£€æŸ¥å¼‚å¸¸ ã€‚å¸¸è§çš„å—æ£€æŸ¥å¼‚å¸¸æœ‰ï¼šIO ç›¸å…³çš„å¼‚å¸¸ã€<code>ClassNotFoundException</code>ã€<code>SQLException</code>â€¦ã€‚</p><p><strong>Unchecked Exception</strong> å³ <strong>ä¸å—æ£€æŸ¥å¼‚å¸¸</strong> ï¼ŒJava ä»£ç åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ ï¼Œæˆ‘ä»¬å³ä½¿ä¸å¤„ç†ä¸å—æ£€æŸ¥å¼‚å¸¸ä¹Ÿå¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ã€‚</p><p><code>RuntimeException</code> åŠå…¶å­ç±»éƒ½ç»Ÿç§°ä¸ºéå—æ£€æŸ¥å¼‚å¸¸ï¼Œå¸¸è§çš„æœ‰ï¼ˆå»ºè®®è®°ä¸‹æ¥ï¼Œæ—¥å¸¸å¼€å‘ä¸­ä¼šç»å¸¸ç”¨åˆ°ï¼‰ï¼š</p><ul><li><code>NullPointerException</code>(ç©ºæŒ‡é’ˆé”™è¯¯)</li><li><code>IllegalArgumentException</code>(å‚æ•°é”™è¯¯æ¯”å¦‚æ–¹æ³•å…¥å‚ç±»å‹é”™è¯¯)</li><li><code>NumberFormatException</code>ï¼ˆå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æ ¼å¼é”™è¯¯ï¼Œ<code>IllegalArgumentException</code>çš„å­ç±»ï¼‰</li><li><code>ArrayIndexOutOfBoundsException</code>ï¼ˆæ•°ç»„è¶Šç•Œé”™è¯¯ï¼‰</li><li><code>ClassCastException</code>ï¼ˆç±»å‹è½¬æ¢é”™è¯¯ï¼‰</li><li><code>ArithmeticException</code>ï¼ˆç®—æœ¯é”™è¯¯ï¼‰</li><li><code>SecurityException</code> ï¼ˆå®‰å…¨é”™è¯¯æ¯”å¦‚æƒé™ä¸å¤Ÿï¼‰</li><li><code>UnsupportedOperationException</code>(ä¸æ”¯æŒçš„æ“ä½œé”™è¯¯æ¯”å¦‚é‡å¤åˆ›å»ºåŒä¸€ç”¨æˆ·)</li><li>â€¦â€¦</li></ul><h5 id="ç©ºæŒ‡é’ˆå¼‚å¸¸"><a href="#ç©ºæŒ‡é’ˆå¼‚å¸¸" class="headerlink" title="ç©ºæŒ‡é’ˆå¼‚å¸¸"></a>ç©ºæŒ‡é’ˆå¼‚å¸¸</h5><p>ç©ºæŒ‡é’ˆå¼‚å¸¸æ˜¯ä¸å—æ£€æµ‹å¼‚å¸¸ä¸‹è¿è¡ŒæœŸå¼‚å¸¸ä¸­çš„ä¸€ç§ï¼›å½“æˆ‘ä»¬åœ¨å°è¯•ä½¿ç”¨ null å¼•ç”¨çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿ NPEã€‚</p><p>æœ€åŸºç¡€ä¹Ÿæ˜¯æ¯”è¾ƒéœ€è¦æ³¨æ„çš„ä¸€ä¸ªæƒ…å†µæ˜¯å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œåœ¨å­—ç¬¦ä¸²æ¯”è¾ƒçš„æ—¶å€™ï¼Œä¿è¯å¸¸é‡æ”¾å‰é¢</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401311055211.png" alt="image.png"></p><blockquote><p>å¦‚ä½•é¿å…æŒ‡é’ˆå¼‚å¸¸</p></blockquote><ul><li><ol><li>åœ¨ä½¿ç”¨ä¹‹å‰å…ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦ä¸º null</li></ol></li><li><ol start="2"><li>è°ƒç”¨æ–¹æ³•çš„æ—¶å€™è¿›è¡Œå‚æ•°æ£€æŸ¥</li></ol></li><li><ol start="3"><li>åœ¨è®¾è®¡æ–¹æ³•æˆ–è€…API çš„æ—¶å€™ï¼Œå°½é‡ä¸è¦è¿”å› null å€¼ï¼Œè€Œä¸”è¿”å›ä¸€ä¸ªç©ºé›†åˆæˆ–è€…é»˜è®¤å€¼ï¼›</li></ol></li><li><ol start="4"><li>åˆå§‹åŒ–ä½¿ç”¨å­—æ®µï¼Œä¿è¯ä¸ä¸º null</li></ol></li><li><ol start="5"><li>ä½¿ç”¨ Optional</li></ol></li><li><ol start="6"><li>ä½¿ç”¨æ–­è¨€ï¼ˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒï¼‰</li></ol></li></ul><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-comment">// ç¤ºä¾‹ï¼šé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸çš„æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NullPointerAvoidance</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-built_in">String</span>[] args) &#123;<br>        <span class="hljs-built_in">String</span> <span class="hljs-built_in">str</span> = <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-comment">// 1. æ£€æŸ¥æ˜¯å¦ä¸º null</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">str</span> != <span class="hljs-literal">null</span>) &#123;<br>            System.<span class="hljs-property">out</span>.<span class="hljs-property">println</span>(<span class="hljs-built_in">str</span>.<span class="hljs-property">length</span>());<br>        &#125;<br><br>        <span class="hljs-comment">// 2. ä½¿ç”¨Optionalç±»ï¼ˆJava 8+ï¼‰</span><br>        Optional&lt;<span class="hljs-built_in">String</span>&gt; optionalStr = Optional.<span class="hljs-property">ofNullable</span>(<span class="hljs-built_in">str</span>);<br>        optionalStr.<span class="hljs-property">ifPresent</span>(System.<span class="hljs-property">out</span>::<span class="hljs-built_in">println</span>);<br><br>        <span class="hljs-comment">// 3. å®‰å…¨è°ƒç”¨æ–¹æ³•ï¼ˆä¾‹å¦‚ä½¿ç”¨Apache Commons Langï¼‰</span><br>        <span class="hljs-type">int</span> length = StringUtils.<span class="hljs-property">length</span>(<span class="hljs-built_in">str</span>); <span class="hljs-comment">// å®‰å…¨çš„ï¼Œä¸ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸</span><br><br>        <span class="hljs-comment">// 4. ä½¿ç”¨æ–­è¨€ï¼ˆä»…åœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­ï¼‰</span><br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">str</span> != <span class="hljs-literal">null</span> : <span class="hljs-string">&quot;å­—ç¬¦ä¸²ä¸åº”è¯¥ä¸º null&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h4 id="Throwable-ç±»å¸¸ç”¨æ–¹æ³•"><a href="#Throwable-ç±»å¸¸ç”¨æ–¹æ³•" class="headerlink" title="Throwable ç±»å¸¸ç”¨æ–¹æ³•"></a>Throwable ç±»å¸¸ç”¨æ–¹æ³•</h4><ul><li><code>String getMessage()</code>: è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„ç®€è¦æè¿°</li><li><code>String toString()</code>: è¿”å›å¼‚å¸¸å‘ç”Ÿæ—¶çš„è¯¦ç»†ä¿¡æ¯</li><li><code>String getLocalizedMessage()</code>: è¿”å›å¼‚å¸¸å¯¹è±¡çš„æœ¬åœ°åŒ–ä¿¡æ¯ã€‚ä½¿ç”¨ <code>Throwable</code> çš„å­ç±»è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”Ÿæˆæœ¬åœ°åŒ–ä¿¡æ¯ã€‚å¦‚æœå­ç±»æ²¡æœ‰è¦†ç›–è¯¥æ–¹æ³•ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›çš„ä¿¡æ¯ä¸ <code>getMessage()</code>è¿”å›çš„ç»“æœç›¸åŒ</li><li><code>void printStackTrace()</code>: åœ¨æ§åˆ¶å°ä¸Šæ‰“å° <code>Throwable</code> å¯¹è±¡å°è£…çš„å¼‚å¸¸ä¿¡æ¯</li></ul><h3 id="2ã€æ³›å‹"><a href="#2ã€æ³›å‹" class="headerlink" title="2ã€æ³›å‹"></a>2ã€æ³›å‹</h3><h4 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h4><p><strong>Java æ³›å‹ï¼ˆGenericsï¼‰</strong>Â æ˜¯ JDK 5 ä¸­å¼•å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ã€‚</p><p>ä¸€èˆ¬æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼:<strong>æ³›å‹ç±»</strong>ã€<strong>æ³›å‹æ¥å£</strong>ã€<strong>æ³›å‹æ–¹æ³•</strong></p><blockquote><p>æ³›å‹ç±»</p></blockquote><p>å®šä¹‰</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">//æ­¤å¤„Tå¯ä»¥éšä¾¿å†™ä¸ºä»»æ„æ ‡è¯†ï¼Œå¸¸è§çš„å¦‚Tã€Eã€Kã€Vç­‰å½¢å¼çš„å‚æ•°å¸¸ç”¨äºè¡¨ç¤ºæ³›å‹</span><br><span class="hljs-comment">//åœ¨å®ä¾‹åŒ–æ³›å‹ç±»æ—¶ï¼Œå¿…é¡»æŒ‡å®šTçš„å…·ä½“ç±»å‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Generic</span>&lt;<span class="hljs-title">T</span>&gt;&#123;<br><br>    <span class="hljs-keyword">private</span> T key;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Generic</span>(<span class="hljs-params">T key</span>)</span> &#123;<br>        <span class="hljs-keyword">this</span>.key = key;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">getKey</span>()</span>&#123;<br>        <span class="hljs-keyword">return</span> key;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vhdl"><span class="hljs-keyword">Generic</span>&lt;<span class="hljs-built_in">Integer</span>&gt; genericInteger = <span class="hljs-keyword">new</span> <span class="hljs-keyword">Generic</span>&lt;<span class="hljs-built_in">Integer</span>&gt;(<span class="hljs-number">123456</span>);<br></code></pre></td></tr></table></figure><blockquote><p>æ³›å‹æ¥å£</p></blockquote><p>å®šä¹‰</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Generator</span>&lt;<span class="hljs-title">T</span>&gt; &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">method</span>()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°æ³›å‹æ¥å£ï¼Œä¸æŒ‡å®šç±»å‹ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">class</span> <span class="hljs-symbol">GeneratorImpl</span>&lt;<span class="hljs-symbol">T</span>&gt; <span class="hljs-symbol">implements</span> <span class="hljs-symbol">Generator</span>&lt;<span class="hljs-symbol">T</span>&gt;&#123;<br>    @Override<br>    <span class="hljs-keyword">public</span> T method() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°æ³›å‹æ¥å£ï¼ŒæŒ‡å®šç±»å‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GeneratorImpl</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Generator</span>&lt;<span class="hljs-title class_">String</span>&gt;&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">method</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ³›å‹æ–¹æ³•</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt; E &gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">printArray</span>(<span class="hljs-params"> E[] inputArray </span>)</span><br>&#123;<br>      <span class="hljs-keyword">for</span> ( E element : inputArray )&#123;<br>         System.<span class="hljs-keyword">out</span>.printf( <span class="hljs-string">&quot;%s &quot;</span>, element );<br>      &#125;<br>      System.<span class="hljs-keyword">out</span>.println();<br> &#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-operator">//</span> åˆ›å»ºä¸åŒç±»å‹æ•°ç»„ï¼š<span class="hljs-built_in">Integer</span><span class="hljs-operator">,</span> <span class="hljs-variable">Double</span> å’Œ <span class="hljs-built_in">Character</span><br><span class="hljs-built_in">Integer</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> <span class="hljs-variable">intArray</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-number">1</span><span class="hljs-operator">,</span> <span class="hljs-number">2</span><span class="hljs-operator">,</span> <span class="hljs-number">3</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-operator">;</span><br><span class="hljs-built_in">String</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> <span class="hljs-variable">stringArray</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-string">&quot;Hello&quot;</span><span class="hljs-operator">,</span> <span class="hljs-string">&quot;World&quot;</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-operator">;</span><br><span class="hljs-variable">printArray</span><span class="hljs-punctuation">(</span> <span class="hljs-variable">intArray</span>  <span class="hljs-punctuation">)</span><span class="hljs-operator">;</span><br><span class="hljs-variable">printArray</span><span class="hljs-punctuation">(</span> <span class="hljs-variable">stringArray</span>  <span class="hljs-punctuation">)</span><span class="hljs-operator">;</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šé™æ€æ³›å‹æ–¹æ³•æ˜¯æ²¡æœ‰åŠæ³•ä½¿ç”¨ç±»ä¸Šå£°æ˜çš„æ³›å‹çš„ã€‚åªèƒ½ä½¿ç”¨è‡ªå·±å£°æ˜çš„Â <code>&lt;E&gt;</code> ï¼ˆé™æ€æ–¹æ³•çš„åŠ è½½åœ¨ç±»å‰é¢ï¼‰</p></blockquote><h4 id="ç±»å‹æ“¦é™¤ã€é€šé…ç¬¦"><a href="#ç±»å‹æ“¦é™¤ã€é€šé…ç¬¦" class="headerlink" title="ç±»å‹æ“¦é™¤ã€é€šé…ç¬¦"></a>ç±»å‹æ“¦é™¤ã€é€šé…ç¬¦</h4><p>to be continedâ€¦</p><h3 id="3ã€åå°„"><a href="#3ã€åå°„" class="headerlink" title="3ã€åå°„"></a>3ã€åå°„</h3><blockquote><p>åå°„æ˜¯ä»€ä¹ˆ</p></blockquote><p>Javaåå°„æ˜¯ä¸€ç§å¼ºå¤§çš„æœºåˆ¶ï¼Œå®ƒå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶æ£€æŸ¥æˆ–ä¿®æ”¹Javaè™šæ‹Ÿæœºä¸­çš„ç±»çš„è¡Œä¸ºã€‚åŸºæœ¬ä¸Šï¼Œåå°„ä½¿å¾—ç¨‹åºå¯ä»¥æ“ä½œé‚£äº›åœ¨ç¼–è¯‘æ—¶è¿˜ä¸çŸ¥é“çš„ç±»å’Œå¯¹è±¡ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šåƒæˆ‘ä»¬å¸¸ç”¨çš„æ¡†æ¶ Spring&#x2F;Spring Bootã€MyBatis éƒ½å¤§é‡ä½¿ç”¨äº†åŠ¨æ€ä»£ç†ï¼Œè€ŒåŠ¨æ€ä»£ç†çš„å®ç°ä¹Ÿä¾èµ–äºåå°„ã€‚</p><p><strong>ç†è§£Javaåå°„</strong></p><ul><li><strong>åŠ¨æ€æ€§</strong>: åå°„çš„æ ¸å¿ƒæ˜¯åŠ¨æ€æ€§ã€‚å®ƒä½¿å¾—ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€è°ƒç”¨æ–¹æ³•ã€è®¿é—®å­—æ®µï¼Œè€Œä¸å¿…åœ¨ç¼–è¯‘æ—¶å…·ä½“çŸ¥é“ç±»çš„åç§°å’Œæ–¹æ³•ã€‚</li><li><strong>API</strong>: Javaåå°„çš„åŠŸèƒ½ä¸»è¦é€šè¿‡<code>java.lang.Class</code>ç±»åŠ<code>java.lang.reflect</code>åŒ…ä¸­çš„ç±»ï¼ˆå¦‚<code>Method</code>ã€<code>Field</code>ã€<code>Constructor</code>ç­‰ï¼‰æä¾›ã€‚</li><li><strong>ç±»å…ƒæ•°æ®</strong>: åå°„å…è®¸ç¨‹åºè·å–ä»»ä½•ç±»çš„å†…éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„æˆå‘˜æ–¹æ³•ã€å­—æ®µã€æ„é€ å‡½æ•°ã€æ³¨è§£ç­‰ã€‚</li></ul><blockquote><p>ä¸ºä»€ä¹ˆä½ ä½¿ç”¨ Spring çš„æ—¶å€™ ï¼Œä¸€ä¸ª<code>@Component</code>æ³¨è§£å°±å£°æ˜äº†ä¸€ä¸ªç±»ä¸º Spring Bean å‘¢ï¼Ÿä¸ºä»€ä¹ˆä½ é€šè¿‡ä¸€ä¸ª <code>@Value</code>æ³¨è§£å°±è¯»å–åˆ°é…ç½®æ–‡ä»¶ä¸­çš„å€¼å‘¢ï¼Ÿç©¶ç«Ÿæ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„å‘¢ï¼Ÿ</p></blockquote><p>è¿™äº›éƒ½æ˜¯å› ä¸ºä½ å¯ä»¥åŸºäºåå°„åˆ†æç±»ï¼Œç„¶åè·å–åˆ°ç±»&#x2F;å±æ€§&#x2F;æ–¹æ³•&#x2F;æ–¹æ³•çš„å‚æ•°ä¸Šçš„æ³¨è§£ã€‚ä½ è·å–åˆ°æ³¨è§£ä¹‹åï¼Œå°±å¯ä»¥åšè¿›ä¸€æ­¥çš„å¤„ç†ã€‚</p><blockquote><p>åå°„çš„ä¼˜ç¼ºç‚¹ï¼š</p></blockquote><ul><li>ä¼˜ç‚¹ï¼šå¼ºå¤§å’Œçµæ´»</li><li>ç¼ºç‚¹ï¼š<ul><li>æ€§èƒ½å¼€é”€è¾ƒå¤§ï¼Œä½¿ç”¨ä¸å½“å¯èƒ½å¯¼è‡´ä»£ç éš¾ä»¥ç†è§£å’Œç»´æŠ¤</li><li>å¯èƒ½å¸¦æ¥å®‰å…¨é—®é¢˜</li></ul></li></ul><p>åå°„ç›¸å…³å†…å®¹ï¼š</p><p>1ã€å®šä¹‰ï¼š åå°„æœºåˆ¶æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸ªå¯¹è±¡ï¼Œ éƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•ã€‚åœ¨javaä¸­ï¼Œåªè¦ç»™å®šç±»çš„åå­—ï¼Œå°±å¯ä»¥é€šè¿‡åå°„æœºåˆ¶æ¥è·å¾—ç±»çš„æ‰€ æœ‰ä¿¡æ¯ã€‚ è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºJavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚</p><p>å“ªé‡Œä¼šç”¨åˆ°åå°„æœºåˆ¶ï¼Ÿ </p><p>jdbcå°±æ˜¯å…¸å‹çš„åå°„</p><h3 id="4ã€æ³¨è§£"><a href="#4ã€æ³¨è§£" class="headerlink" title="4ã€æ³¨è§£"></a>4ã€æ³¨è§£</h3><h3 id="5ã€SPI"><a href="#5ã€SPI" class="headerlink" title="5ã€SPI"></a>5ã€SPI</h3><blockquote><p>SPI æ˜¯ä»€ä¹ˆä¸œè¥¿</p></blockquote><p>è¦çŸ¥é“å®ƒçš„ä½œç”¨ï¼Œéœ€è¦æ¸…æ¥šä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªæœºåˆ¶ã€‚</p><p>å‚è€ƒï¼š <a href="https://javaguide.cn/java/basis/java-basic-questions-03.html#spi">https://javaguide.cn/java/basis/java-basic-questions-03.html#spi</a></p><p>å‚è€ƒï¼š <a href="https://pdai.tech/md/java/advanced/java-advanced-spi.html">https://pdai.tech/md/java/advanced/java-advanced-spi.html</a></p><p>å¯ä»¥çœ‹ä¸€ä¸‹è¿™å¥è¯ï¼šSPIï¼ˆService Provider Interfaceï¼‰ï¼Œæ˜¯JDKå†…ç½®çš„ä¸€ç§ æœåŠ¡æä¾›å‘ç°æœºåˆ¶ï¼Œå¯ä»¥ç”¨æ¥å¯ç”¨æ¡†æ¶æ‰©å±•å’Œæ›¿æ¢ç»„ä»¶ã€‚</p><p>Java ä¼šæä¾›ä¸€ä¸ªå…¬å¼€çš„æ¥å£ï¼ˆæ ‡å‡†æœåŠ¡æ¥å£ï¼‰ï¼Œç¬¬ä¸‰æ–¹ä¼šæä¾›è¯¥æ¥å£çš„æœåŠ¡å®ç°(ä¸åŒå‚å•†å¯ä»¥é’ˆå¯¹åŒä¸€æ¥å£åšå‡ºä¸åŒçš„å®ç°)</p><p>è€ŒJavaçš„<strong>SPIæœºåˆ¶å¯ä»¥ä¸ºæŸä¸ªæ¥å£å¯»æ‰¾æœåŠ¡å®ç°</strong>ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401311713463.png" alt="image.png"></p><blockquote><p>SPI æ˜¯ä»€ä¹ˆ</p></blockquote><ul><li>SPIæ˜¯ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶ã€‚</li><li>å®ƒå…è®¸æœåŠ¡æä¾›è€…é€šè¿‡é…ç½®æ–‡ä»¶æä¾›æœåŠ¡å®ç°ï¼Œè€ŒæœåŠ¡ä½¿ç”¨è€…å¯ä»¥åŠ è½½è¿™äº›å®ç°</li></ul><blockquote><p>SPI å®ç°åŸç†</p></blockquote><ul><li>Java SPIçš„å®ç°åŸºäº<code>ServiceLoader</code>ç±»ã€‚</li><li>æœåŠ¡æä¾›è€…åœ¨<code>META-INF/services</code>ç›®å½•ä¸‹æä¾›é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­æŒ‡å®šæ¥å£çš„å®ç°ç±»ã€‚</li><li><code>ServiceLoader</code>å¯ä»¥åŠ è½½è¿™äº›å®ç°ã€‚</li></ul><p>å…³äº SPI å¦‚ä½•ä¸ºæŸä¸ªå…¬å¼€çš„æ ‡å‡†æœåŠ¡æ¥å£æ‰¾åˆ°å…¶å®ç°æœåŠ¡ï¼Œå¯ä»¥çœ‹ä¸€ä¸ªç¤ºä¾‹ã€‚</p><blockquote><p>SPIæœºåˆ¶çš„ç®€å•ç¤ºä¾‹</p></blockquote><blockquote><p>ç½‘ä¸Šç¤ºä¾‹ï¼š<a href="https://zhuanlan.zhihu.com/p/28909673">è¿™é‡Œåœ¨æ–°çª—å£æ‰“å¼€</a></p></blockquote><p>æˆ‘ä»¬ç°åœ¨éœ€è¦ä½¿ç”¨ä¸€ä¸ªå†…å®¹æœç´¢æ¥å£ï¼Œæœç´¢çš„å®ç°å¯èƒ½æ˜¯åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„æœç´¢ï¼Œä¹Ÿå¯èƒ½æ˜¯åŸºäºæ•°æ®åº“çš„æœç´¢ã€‚</p><ul><li>å…ˆå®šä¹‰å¥½æ¥å£</li></ul><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">interface</span> <span class="hljs-title">Search</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-keyword">String</span>&gt; searchDoc(<span class="hljs-keyword">String</span> keyword);   <br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ–‡ä»¶æœç´¢å®ç°</li></ul><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">FileSearch</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">Search</span></span></span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-keyword">String</span>&gt; searchDoc(<span class="hljs-keyword">String</span> keyword) &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ–‡ä»¶æœç´¢ &quot;</span>+keyword);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®åº“æœç´¢å®ç°</li></ul><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">DatabaseSearch</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">Search</span></span></span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;<span class="hljs-keyword">String</span>&gt; searchDoc(<span class="hljs-keyword">String</span> keyword) &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ•°æ®æœç´¢ &quot;</span>+keyword);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>resources æ¥ä¸‹æ¥å¯ä»¥åœ¨resourcesä¸‹æ–°å»ºMETA-INF&#x2F;services&#x2F;ç›®å½•ï¼Œç„¶åæ–°å»ºæ¥å£å…¨é™å®šåçš„æ–‡ä»¶ï¼š<code>com.cainiao.ys.spi.learn.Search</code>ï¼Œé‡Œé¢åŠ ä¸Šæˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„å®ç°ç±»</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">com<span class="hljs-selector-class">.cainiao</span><span class="hljs-selector-class">.ys</span><span class="hljs-selector-class">.spi</span><span class="hljs-selector-class">.learn</span>.FileSearch<br></code></pre></td></tr></table></figure><ul><li>æµ‹è¯•æ–¹æ³•</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> TestCase &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) &#123;<br>        ServiceLoader&lt;<span class="hljs-keyword">Search</span>&gt; s = ServiceLoader.<span class="hljs-keyword">load</span>(<span class="hljs-keyword">Search</span>.<span class="hljs-keyword">class</span>);<br>        Iterator&lt;<span class="hljs-keyword">Search</span>&gt; iterator = s.iterator();<br>        <span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>           <span class="hljs-keyword">Search</span> <span class="hljs-keyword">search</span> =  iterator.next();<br>           <span class="hljs-keyword">search</span>.searchDoc(&quot;hello world&quot;);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¾“å‡ºç»“æœï¼šæ–‡ä»¶æœç´¢ hello world</p><p>å¦‚æœåœ¨<code>com.cainiao.ys.spi.learn.Search</code>æ–‡ä»¶é‡Œå†™ä¸Šä¸¤ä¸ªå®ç°ç±»ï¼Œé‚£æœ€åçš„è¾“å‡ºç»“æœå°±æ˜¯ä¸¤è¡Œäº†ã€‚</p><p>è¿™å°±æ˜¯å› ä¸º<code>ServiceLoader.load(Search.class)</code>åœ¨åŠ è½½æŸæ¥å£æ—¶ï¼Œä¼šå»<code>META-INF/services</code>ä¸‹æ‰¾æ¥å£çš„å…¨é™å®šåæ–‡ä»¶ï¼Œå†æ ¹æ®é‡Œé¢çš„å†…å®¹åŠ è½½ç›¸åº”çš„å®ç°ç±»ã€‚</p><p>è¿™å°±æ˜¯spiçš„æ€æƒ³ï¼Œæ¥å£çš„å®ç°ç”±providerå®ç°ï¼Œprovideråªç”¨åœ¨æäº¤çš„jaråŒ…é‡Œçš„<code>META-INF/services</code>ä¸‹æ ¹æ®å¹³å°å®šä¹‰çš„æ¥å£æ–°å»ºæ–‡ä»¶ï¼Œå¹¶æ·»åŠ è¿›ç›¸åº”çš„å®ç°ç±»å†…å®¹å°±å¥½ã€‚</p><h3 id="6ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#6ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="6ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>6ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3><h3 id="7ã€è¯­æ³•ç³–"><a href="#7ã€è¯­æ³•ç³–" class="headerlink" title="7ã€è¯­æ³•ç³–"></a>7ã€è¯­æ³•ç³–</h3><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://javaguide.cn/java/basis/java-basic-questions-03.html">https://javaguide.cn/java/basis/java-basic-questions-03.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>Base</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaåŸºç¡€_åŸºç¡€å†…å®¹02</title>
    <link href="/2024/01/08/Java%E5%9F%BA%E7%A1%80_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B902/"/>
    <url>/2024/01/08/Java%E5%9F%BA%E7%A1%80_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B902/</url>
    
    <content type="html"><![CDATA[<p>æœ¬ç« èŠ‚ä¸»è¦æ˜¯å¯¹äºJavaä¸­å¯¹è±¡çš„ä½¿ç”¨ï¼ŒObject åŸºç±»çš„ä½¿ç”¨ï¼Œä»¥åŠ String ç±»çš„ä½¿ç”¨è¿›è¡Œé˜è¿°ï¼›</p><h3 id="ä¸€ã€é¢å‘å¯¹è±¡åŸºç¡€"><a href="#ä¸€ã€é¢å‘å¯¹è±¡åŸºç¡€" class="headerlink" title="ä¸€ã€é¢å‘å¯¹è±¡åŸºç¡€"></a>ä¸€ã€é¢å‘å¯¹è±¡åŸºç¡€</h3><h4 id="1-1ã€é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«"><a href="#1-1ã€é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«" class="headerlink" title="1.1ã€é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«"></a>1.1ã€é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«</h4><p>ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºè§£å†³é—®é¢˜çš„æ–¹å¼ä¸åŒï¼š</p><ul><li>é¢å‘è¿‡ç¨‹æŠŠè§£å†³é—®é¢˜çš„è¿‡ç¨‹æ‹†æˆä¸€ä¸ªä¸ªæ–¹æ³•ï¼Œé€šè¿‡ä¸€ä¸ªä¸ªæ–¹æ³•çš„æ‰§è¡Œè§£å†³é—®é¢˜ã€‚</li><li>é¢å‘å¯¹è±¡ä¼šå…ˆæŠ½è±¡å‡ºå¯¹è±¡ï¼Œç„¶åç”¨å¯¹è±¡æ‰§è¡Œæ–¹æ³•çš„æ–¹å¼è§£å†³é—®é¢˜ã€‚</li></ul><h4 id="1-2ã€åˆ›å»ºå¯¹è±¡"><a href="#1-2ã€åˆ›å»ºå¯¹è±¡" class="headerlink" title="1.2ã€åˆ›å»ºå¯¹è±¡"></a>1.2ã€åˆ›å»ºå¯¹è±¡</h4><p>new è¿ç®—ç¬¦ï¼Œnew åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼ˆå¯¹è±¡å®ä¾‹åœ¨å †å†…å­˜ä¸­ï¼‰ï¼Œå¯¹è±¡å¼•ç”¨æŒ‡å‘å¯¹è±¡å®ä¾‹ï¼ˆå¯¹è±¡å¼•ç”¨å­˜æ”¾åœ¨æ ˆå†…å­˜ä¸­ï¼‰ã€‚</p><ul><li>ä¸€ä¸ªå¯¹è±¡å¼•ç”¨å¯ä»¥æŒ‡å‘ 0 ä¸ªæˆ– 1 ä¸ªå¯¹è±¡ï¼ˆä¸€æ ¹ç»³å­å¯ä»¥ä¸ç³»æ°”çƒï¼Œä¹Ÿå¯ä»¥ç³»ä¸€ä¸ªæ°”çƒï¼‰ï¼›</li><li>ä¸€ä¸ªå¯¹è±¡å¯ä»¥æœ‰ n ä¸ªå¼•ç”¨æŒ‡å‘å®ƒï¼ˆå¯ä»¥ç”¨ n æ¡ç»³å­ç³»ä½ä¸€ä¸ªæ°”çƒï¼‰ã€‚</li></ul><blockquote><p>å¯¹è±¡çš„ç›¸ç­‰å’Œå¼•ç”¨ç›¸ç­‰çš„åŒºåˆ«</p></blockquote><ul><li>å¯¹è±¡çš„ç›¸ç­‰ä¸€èˆ¬æ¯”è¾ƒçš„æ˜¯å†…å­˜ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚</li><li>å¼•ç”¨ç›¸ç­‰ä¸€èˆ¬æ¯”è¾ƒçš„æ˜¯ä»–ä»¬æŒ‡å‘çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ã€‚</li></ul><p>å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å¯¹è±¡æ˜¯ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œç±»å®šä¹‰äº†å¯¹è±¡çš„çŠ¶æ€ï¼ˆå±æ€§ï¼‰å’Œè¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰</p><p>åˆ›å»ºå¯¹è±¡çš„æ­¥éª¤ï¼š</p><ol><li><strong>å®šä¹‰ç±»</strong>: é¦–å…ˆï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œä½œä¸ºå¯¹è±¡çš„è“å›¾ã€‚ç±»å®šä¹‰äº†å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚</li><li><strong>å£°æ˜å¯¹è±¡</strong>: æ¥ä¸‹æ¥ï¼Œå£°æ˜ä¸€ä¸ªç±»çš„å˜é‡ã€‚è¿™ä¸ªå˜é‡å°†å¼•ç”¨æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</li><li><strong>å®ä¾‹åŒ–å¯¹è±¡</strong>: ä½¿ç”¨ <code>new</code> å…³é”®å­—åˆ›å»ºç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚</li><li><strong>åˆå§‹åŒ–å¯¹è±¡</strong>: é€šè¿‡è°ƒç”¨ç±»çš„æ„é€ å™¨æ¥åˆå§‹åŒ–æ–°åˆ›å»ºçš„å¯¹è±¡</li></ol><p>åˆ›å»ºå¯¹è±¡ç¤ºä¾‹ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">// å®šä¹‰Personç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-type">String</span> name;<br>    <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-built_in">Person</span>(<span class="hljs-type">String</span> name, <span class="hljs-type">int</span> age) &#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>        <span class="hljs-keyword">this</span>.age = age;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// åœ¨å¦ä¸€ä¸ªç±»ä¸­åˆ›å»ºPersonçš„å¯¹è±¡</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>&#123;<br>        <span class="hljs-comment">// åˆ›å»ºPersonå¯¹è±¡</span><br>        Person person = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Person</span>(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">30</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>new Person(&quot;Alice&quot;, 30);</code> åˆ›å»ºäº†ä¸€ä¸ª <code>Person</code> ç±»çš„å®ä¾‹ï¼Œå¹¶ä¸”ç”¨ <code>Alice</code> å’Œ <code>30</code> åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡çš„ <code>name</code> å’Œ <code>age</code> å±æ€§ã€‚</p><h4 id="1-3ã€æ„é€ æ–¹æ³•"><a href="#1-3ã€æ„é€ æ–¹æ³•" class="headerlink" title="1.3ã€æ„é€ æ–¹æ³•"></a>1.3ã€æ„é€ æ–¹æ³•</h4><p>æ„é€ æ–¹æ³•çš„ä½œç”¨ï¼šæ„é€ æ–¹æ³•æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œä¸»è¦ä½œç”¨æ˜¯å®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–å·¥ä½œã€‚</p><p>å¦‚æœæ²¡æœ‰å£°æ˜æ„é€ æ–¹æ³•ï¼Œç±»ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ä¸å¸¦å‚æ•°çš„æ”¹é€ æ–¹æ³•ã€‚</p><p>æ„é€ æ–¹æ³•çš„ç‰¹ç‚¹ï¼š</p><ul><li>åå­—ä¸ç±»åç›¸åŒã€‚</li><li>æ²¡æœ‰è¿”å›å€¼ï¼Œä½†ä¸èƒ½ç”¨ void å£°æ˜æ„é€ å‡½æ•°ã€‚</li><li>ç”Ÿæˆç±»çš„å¯¹è±¡æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€è°ƒç”¨ã€‚</li></ul><p>æ„é€ æ–¹æ³•ä¸èƒ½è¢« overrideï¼ˆé‡å†™ï¼‰,ä½†æ˜¯å¯ä»¥ overloadï¼ˆé‡è½½ï¼‰,æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç±»ä¸­æœ‰å¤šä¸ªæ„é€ å‡½æ•°çš„æƒ…å†µ</p><h4 id="1-4ã€é¢å‘å¯¹è±¡ç‰¹å¾"><a href="#1-4ã€é¢å‘å¯¹è±¡ç‰¹å¾" class="headerlink" title="1.4ã€é¢å‘å¯¹è±¡ç‰¹å¾"></a>1.4ã€é¢å‘å¯¹è±¡ç‰¹å¾</h4><p>é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾ï¼š</p><ul><li>å°è£…</li><li>ç»§æ‰¿</li><li>å¤šæ€</li></ul><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰çš„ä¸‰å¤§ç‰¹å¾æ˜¯å°è£…ã€ç»§æ‰¿å’Œå¤šæ€ã€‚è¿™äº›ç‰¹å¾å…±åŒä¸ºåˆ›å»ºæ¨¡å—åŒ–ã€å¯é‡ç”¨å’Œæ˜“äºç»´æŠ¤çš„ä»£ç æä¾›äº†åŸºç¡€ã€‚</p><table><thead><tr><th>ç‰¹å¾</th><th>æè¿°</th><th>ä¼˜ç‚¹</th></tr></thead><tbody><tr><td>å°è£…</td><td>å°è£…æ˜¯æŠŠæ•°æ®ï¼ˆå±æ€§ï¼‰å’Œè¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰ç»„åˆæˆä¸€ä¸ªå•å…ƒï¼ˆç±»ï¼‰ï¼Œå¹¶å¯¹æ•°æ®çš„è®¿é—®è¿›è¡Œé™åˆ¶å’Œä¿æŠ¤ã€‚åœ¨Javaä¸­ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦ï¼ˆå¦‚<code>private</code>, <code>public</code>ï¼‰æ¥å®ç°ã€‚</td><td>- æé«˜äº†æ•°æ®å®‰å…¨æ€§<br>- å‡å°‘äº†ä»£ç é—´çš„è€¦åˆ<br>- å¢å¼ºäº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</td></tr><tr><td>ç»§æ‰¿</td><td>ç»§æ‰¿æ˜¯ä¸€ç§ä½¿å¾—ä¸€ä¸ªç±»ï¼ˆå­ç±»ï¼‰èƒ½å¤Ÿç»§æ‰¿å¦ä¸€ä¸ªç±»ï¼ˆçˆ¶ç±»ï¼‰çš„å±æ€§å’Œæ–¹æ³•çš„æœºåˆ¶ã€‚å­ç±»å¯ä»¥æ‰©å±•æˆ–ä¿®æ”¹ç»§æ‰¿è‡ªçˆ¶ç±»çš„è¡Œä¸ºã€‚</td><td>- ä¿ƒè¿›äº†ä»£ç çš„é‡ç”¨<br>- å»ºç«‹äº†ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»<br>- æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§</td></tr><tr><td>å¤šæ€</td><td>å¤šæ€æ˜¯æŒ‡å…è®¸ä¸åŒç±»çš„å¯¹è±¡å¯¹åŒä¸€æ¶ˆæ¯ä½œå‡ºå“åº”çš„èƒ½åŠ›ï¼Œå³åŒä¸€æ“ä½œä½œç”¨äºä¸åŒçš„å¯¹è±¡æ—¶å¯ä»¥æœ‰ä¸åŒçš„è§£é‡Šå’Œè¡Œä¸ºã€‚</td><td>- å¢å¼ºäº†ç¨‹åºçš„çµæ´»æ€§å’Œæ‰©å±•æ€§<br>- å…è®¸ä¸åŒç±»çš„å¯¹è±¡è¢«ç»Ÿä¸€å¤„ç†</td></tr></tbody></table><blockquote><p>ç±»æ¯”</p></blockquote><ol><li><strong>å°è£…</strong>: å°±åƒä¸€ä¸ªå’–å•¡æœºï¼Œå®ƒéšè—äº†å†…éƒ¨çš„å¤æ‚æœºæ¢°è¿‡ç¨‹ï¼Œåªæš´éœ²å‡ºç®€å•çš„æ¥å£ï¼ˆæŒ‰é’®ï¼‰ç»™ç”¨æˆ·ä½¿ç”¨ã€‚</li><li><strong>ç»§æ‰¿</strong>: ç±»ä¼¼äºçˆ¶æ¯ä¸å­©å­çš„å…³ç³»ã€‚å­©å­ä¼šç»§æ‰¿çˆ¶æ¯çš„ä¸€äº›ç‰¹å¾ï¼ˆå¦‚çœ¼ç›çš„é¢œè‰²ï¼‰ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‘å±•è‡ªå·±ç‹¬ç‰¹çš„ç‰¹æ€§ï¼ˆå¦‚ä¸åŒçš„èŒä¸šæŠ€èƒ½ï¼‰ã€‚</li><li><strong>å¤šæ€</strong>: å¯ä»¥æ¯”ä½œä¸€ä¸ªé€šç”¨çš„ç”µæºæ’åº§ã€‚ä¸åŒçš„ç”µå™¨ï¼ˆå³ä½¿æ˜¯ä¸åŒç±»å‹çš„ç”µå™¨ï¼‰éƒ½å¯ä»¥æ’å…¥åŒä¸€ä¸ªæ’åº§ï¼Œä½†æ’å…¥åçš„è¡Œä¸ºï¼ˆå¦‚å……ç”µã€è¿è½¬ï¼‰ä¾èµ–äºæ¥å…¥çš„å…·ä½“ç”µå™¨ã€‚</li></ol><h4 id="1-5ã€æ¥å£ä¸æŠ½è±¡ç±»"><a href="#1-5ã€æ¥å£ä¸æŠ½è±¡ç±»" class="headerlink" title="1.5ã€æ¥å£ä¸æŠ½è±¡ç±»"></a>1.5ã€æ¥å£ä¸æŠ½è±¡ç±»</h4><blockquote><p>æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«</p></blockquote><ul><li>é¦–å…ˆæ˜¯ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Œæ¥å£å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œç±»åªèƒ½ç»§æ‰¿å•ä¸ªï¼›</li><li>ç„¶åæ›´å¤šçš„æ˜¯ç”¨æ³•ä¸Šé¢çš„åŒºåˆ«ï¼šæ¥å£æ˜¯ä¸€ä¸ªåè®®ï¼Œå¼ºè°ƒåŠŸèƒ½çš„ç›¸ä¼¼æ€§ï¼ˆç›¸åŒçš„è¡Œä¸ºï¼‰ï¼›æŠ½é—²ç±»å¼ºè°ƒçš„æ˜¯ç±»ä¹‹é—´çš„å…±æ€§ï¼ˆå…¬å…±ç±»ç»“æ„ï¼‰ã€‚</li></ul><hr><p>æ¥å£ï¼ˆInterfacesï¼‰å’ŒæŠ½è±¡ç±»ï¼ˆAbstract Classesï¼‰æ˜¯ç”¨äºå®ç°æŠ½è±¡å±‚æ¬¡çš„ä¸¤ç§ä¸»è¦æ–¹å¼ã€‚</p><p>å®ƒä»¬éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œä½†åœ¨ç”¨æ³•å’Œç›®çš„ä¸Šå­˜åœ¨ä¸€äº›å…³é”®åŒºåˆ«ã€‚</p><blockquote><p>å¯¹æ¯”</p></blockquote><table><thead><tr><th>ç‰¹å¾</th><th>æ¥å£ï¼ˆInterfacesï¼‰</th><th>æŠ½è±¡ç±»ï¼ˆAbstract Classesï¼‰</th></tr></thead><tbody><tr><td>å®ä¾‹åŒ–</td><td>ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ã€‚</td><td>ä¹Ÿä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ã€‚</td></tr><tr><td>æ–¹æ³•å®šä¹‰</td><td>å¯ä»¥æœ‰é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•ã€‚æ‰€æœ‰æ–¹æ³•é»˜è®¤ä¸ºpublicã€‚ä¸éœ€è¦ä½¿ç”¨<code>abstract</code>å…³é”®å­—ã€‚</td><td>å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ï¼ˆæ²¡æœ‰å®ç°ä½“çš„æ–¹æ³•ï¼‰å’ŒéæŠ½è±¡æ–¹æ³•ã€‚æŠ½è±¡æ–¹æ³•ä½¿ç”¨<code>abstract</code>å…³é”®å­—ã€‚</td></tr><tr><td>å±æ€§å®šä¹‰</td><td>åªèƒ½å®šä¹‰å¸¸é‡ï¼ˆé»˜è®¤ä¸ºpublic static finalï¼‰ã€‚</td><td>å¯ä»¥åŒ…å«éå¸¸é‡å­—æ®µï¼Œä¸”è¿™äº›å­—æ®µå¯ä»¥æœ‰å„ç§è®¿é—®æ§åˆ¶ã€‚</td></tr><tr><td>å®ç°&#x2F;æ‰©å±•</td><td>ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚</td><td>ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ã€‚</td></tr><tr><td>æ„é€ å™¨</td><td>ä¸èƒ½æœ‰æ„é€ å™¨ã€‚</td><td>å¯ä»¥æœ‰æ„é€ å™¨ã€‚</td></tr><tr><td>å¤šé‡ç»§æ‰¿çš„æ”¯æŒ</td><td>æ”¯æŒï¼ˆä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼‰ã€‚</td><td>ä¸æ”¯æŒï¼ˆä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼‰ã€‚</td></tr><tr><td>é»˜è®¤æ–¹æ³•</td><td>Java 8ä¹‹åï¼Œæ¥å£å¯ä»¥æœ‰é»˜è®¤æ–¹æ³•ï¼ˆæœ‰æ–¹æ³•ä½“ï¼‰ã€‚</td><td>æŠ½è±¡ç±»å¯ä»¥æœ‰å…·æœ‰å®ç°çš„æ–¹æ³•ã€‚</td></tr><tr><td>è®¿é—®ä¿®é¥°ç¬¦é™åˆ¶</td><td>æ¥å£ä¸­çš„æ–¹æ³•é»˜è®¤æ˜¯publicçš„ï¼Œå±æ€§é»˜è®¤æ˜¯public static finalçš„ã€‚</td><td>æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å’Œå±æ€§å¯ä»¥æœ‰å¤šç§è®¿é—®ä¿®é¥°ç¬¦ã€‚</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>å½“å„ä¸ªå®ç°ä¹‹é—´æ²¡æœ‰å…±äº«çš„ä»£ç ï¼Œä½†éœ€è¦å…±åŒéµå®ˆæŸäº›è§„åˆ™ï¼ˆæ–¹æ³•ï¼‰æ—¶ä½¿ç”¨ã€‚</td><td>å½“å„ä¸ªå®ç°ä¹‹é—´æœ‰å¤§é‡å…±äº«çš„ä»£ç æˆ–å±æ€§æ—¶ä½¿ç”¨ã€‚</td></tr></tbody></table><p>ç±»æ¯”</p><ol><li><strong>æ¥å£</strong>: å°±åƒä¸€ä¸ªæ ‡å‡†æˆ–åè®®ï¼Œå®ƒå®šä¹‰äº†è§„èŒƒï¼Œä½†ä¸æä¾›å®Œæ•´çš„å®ç°ã€‚å°±åƒç”µå™¨çš„æ’å¤´å’Œæ’åº§çš„æ ‡å‡†ï¼Œåˆ¶é€ å•†éœ€è¦æŒ‰ç…§è¿™ä¸ªæ ‡å‡†åˆ¶é€ äº§å“ã€‚</li><li><strong>æŠ½è±¡ç±»</strong>: å¯ä»¥çœ‹ä½œæ˜¯åŠæˆå“ï¼Œå®ƒå®šä¹‰äº†ä¸€äº›åŸºæœ¬åŠŸèƒ½å’Œç»“æ„ï¼Œä½†ç•™ä¸‹äº†ä¸€äº›ç©ºç™½ï¼ˆæŠ½è±¡æ–¹æ³•ï¼‰ä¾›ç»§æ‰¿å®ƒçš„å­ç±»å®Œæˆã€‚</li></ol><h4 id="1-6ã€æ·±æ‹·è´ä¸æµ…æ‹·è´ï¼Œå¼•ç”¨æ‹·è´"><a href="#1-6ã€æ·±æ‹·è´ä¸æµ…æ‹·è´ï¼Œå¼•ç”¨æ‹·è´" class="headerlink" title="1.6ã€æ·±æ‹·è´ä¸æµ…æ‹·è´ï¼Œå¼•ç”¨æ‹·è´"></a>1.6ã€æ·±æ‹·è´ä¸æµ…æ‹·è´ï¼Œå¼•ç”¨æ‹·è´</h4><p>åŒºåˆ«ï¼š</p><ul><li><strong>æµ…æ‹·è´</strong>ï¼šæµ…æ‹·è´ä¼šåœ¨å †ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆåŒºåˆ«äºå¼•ç”¨æ‹·è´çš„ä¸€ç‚¹ï¼‰ï¼Œä¸è¿‡ï¼Œå¦‚æœåŸå¯¹è±¡å†…éƒ¨çš„å±æ€§æ˜¯å¼•ç”¨ç±»å‹çš„è¯ï¼Œæµ…æ‹·è´ä¼šç›´æ¥å¤åˆ¶å†…éƒ¨å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´æ‹·è´å¯¹è±¡å’ŒåŸå¯¹è±¡å…±ç”¨åŒä¸€ä¸ªå†…éƒ¨å¯¹è±¡ã€‚</li><li><strong>æ·±æ‹·è´</strong>ï¼šæ·±æ‹·è´ä¼šå®Œå…¨å¤åˆ¶æ•´ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬è¿™ä¸ªå¯¹è±¡æ‰€åŒ…å«çš„å†…éƒ¨å¯¹è±¡</li></ul><p>å¯¹æ¯”</p><table><thead><tr><th>ç±»å‹</th><th>æè¿°</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>æµ…æ‹·è´</td><td>åªå¤åˆ¶å¯¹è±¡çš„åŸºæœ¬ç±»å‹å­—æ®µå’Œå¼•ç”¨ç±»å‹å­—æ®µçš„å¼•ç”¨ï¼Œä¸å¤åˆ¶å¼•ç”¨å¯¹è±¡æœ¬èº«ã€‚</td><td>ä¸¤ä¸ªå¯¹è±¡å…±äº«å¼•ç”¨ç±»å‹çš„æˆå‘˜ã€‚</td></tr><tr><td>æ·±æ‹·è´</td><td>å¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹å­—æ®µï¼Œå¼•ç”¨ç±»å‹çš„å¯¹è±¡ä¹Ÿä¼šè¢«å¤åˆ¶ã€‚</td><td>ä¸¤ä¸ªå¯¹è±¡å®Œå…¨ç‹¬ç«‹ï¼Œä¸å…±äº«ä»»ä½•æˆå‘˜ã€‚</td></tr><tr><td>å¼•ç”¨æ‹·è´</td><td>åªå¤åˆ¶å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸å¤åˆ¶å¯¹è±¡æœ¬èº«ã€‚</td><td>ä¸¤ä¸ªå¼•ç”¨æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œä»»ä½•ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜éƒ½ä¼šå½±å“åˆ°å¦ä¸€ä¸ªã€‚</td></tr></tbody></table><p> ç±»æ¯”</p><ul><li><strong>æµ…æ‹·è´</strong>: å°±åƒæ‹æ‘„ä¸€å¼ ç”»ä½œçš„ç…§ç‰‡ï¼Œä½ å¾—åˆ°çš„æ˜¯ç”»ä½œçš„è¡¨é¢å¤åˆ¶å“ï¼Œä½†å®ƒä»ç„¶è¿æ¥ç€åŸæ¥çš„ç”»ã€‚</li><li><strong>æ·±æ‹·è´</strong>: å°±åƒå¤åˆ¶ä¸€ä¸ªç”»ä½œçš„æ¯ä¸€ç¬”ç»†èŠ‚æ¥åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç”»ä½œï¼Œå®Œå…¨ç‹¬ç«‹äºåŸä½œã€‚</li><li><strong>å¼•ç”¨æ‹·è´</strong>: å°±åƒç»™åˆ«äººç”»ä½œçš„ä¸€ä¸ªæŒ‡å‘åœ°å€ï¼Œä¸¤äººçœ‹çš„æ˜¯åŒä¸€å¹…ç”»ã€‚</li></ul><p>å›¾æè¿°ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240109211507.png" alt="image.png"></p><h4 id="1-7ã€å†…éƒ¨ç±»"><a href="#1-7ã€å†…éƒ¨ç±»" class="headerlink" title="1.7ã€å†…éƒ¨ç±»"></a>1.7ã€å†…éƒ¨ç±»</h4><blockquote><p>ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»</p></blockquote><p>å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»å†…éƒ¨çš„ç±»ã€‚åœ¨Javaä¸­ï¼Œå†…éƒ¨ç±»ä¸»è¦ç”¨äºå°†ä¸€äº›é€»è¾‘å¯†åˆ‡ç›¸å…³çš„ç±»ç»„ç»‡åœ¨ä¸€èµ·ï¼Œä»è€Œæä¾›æ›´å¥½çš„å°è£…å’Œç»´æŠ¤æ€§ã€‚</p><p>å†…éƒ¨ç±»æä¾›äº†ä¸€ç§å¼ºå¤§çš„æ–¹å¼æ¥ç»„ç»‡å’Œå°è£…å¤æ‚çš„é€»è¾‘ï¼Œä½†åŒæ—¶ä¹Ÿå¢åŠ äº†ä»£ç çš„å¤æ‚æ€§ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨å†…éƒ¨ç±»æ—¶åº”è¯¥æƒè¡¡å…¶å¸¦æ¥çš„å¥½å¤„å’Œå¤æ‚æ€§ã€‚</p><p><strong>åŸºæœ¬æ¦‚å¿µ</strong>:</p><ul><li>å†…éƒ¨ç±»å¯ä»¥è®¿é—®å…¶å¤–éƒ¨ç±»çš„æˆå‘˜ï¼ŒåŒ…æ‹¬ç§æœ‰æˆå‘˜ã€‚</li><li>å†…éƒ¨ç±»çš„å¯¹è±¡ä¸å…¶å¤–éƒ¨ç±»çš„å¯¹è±¡ä¹‹é—´å­˜åœ¨è”ç³»ã€‚</li></ul><blockquote><p>å†…éƒ¨ç±»çš„ç±»å‹</p></blockquote><ul><li><strong>æˆå‘˜å†…éƒ¨ç±»</strong>ï¼ˆéé™æ€å†…éƒ¨ç±»ï¼‰ï¼šå®šä¹‰åœ¨å¤–éƒ¨ç±»çš„æˆå‘˜ä½ç½®ï¼Œéœ€è¦å¤–éƒ¨ç±»çš„å®ä¾‹æ¥åˆ›å»ºã€‚</li><li><strong>é™æ€å†…éƒ¨ç±»</strong>ï¼šç”¨<code>static</code>ä¿®é¥°çš„å†…éƒ¨ç±»ï¼Œä¸éœ€è¦å¤–éƒ¨ç±»çš„å®ä¾‹å°±å¯ä»¥åˆ›å»ºã€‚</li><li><strong>å±€éƒ¨å†…éƒ¨ç±»</strong>ï¼šå®šä¹‰åœ¨æ–¹æ³•å†…çš„ç±»ï¼Œåªåœ¨è¯¥æ–¹æ³•çš„ä½œç”¨åŸŸå†…å¯è§å’Œå¯ç”¨ã€‚</li><li><strong>åŒ¿åå†…éƒ¨ç±»</strong>ï¼šæ²¡æœ‰åå­—çš„å±€éƒ¨å†…éƒ¨ç±»ï¼Œé€šå¸¸ç”¨äºåˆ›å»ºé‚£äº›åªéœ€è¦ä¸€æ¬¡ä½¿ç”¨çš„ç±»å®ä¾‹ã€‚</li></ul><p>è¯¦ç»†ä¸€äº›çš„è§£é‡Šï¼š</p><p><strong>æˆå‘˜å†…éƒ¨ç±»</strong>:</p><ul><li>å®šä¹‰åœ¨å¤–éƒ¨ç±»çš„æˆå‘˜ä½ç½®ã€‚</li><li>å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ŒåŒ…æ‹¬ç§æœ‰æˆå‘˜ã€‚</li><li>éœ€è¦å¤–éƒ¨ç±»çš„å®ä¾‹æ¥åˆ›å»ºã€‚</li><li>è¯­æ³•ï¼š<code>OuterClass.InnerClass innerObject = outerObject.new InnerClass();</code></li></ul><p><strong>é™æ€å†…éƒ¨ç±»</strong>:</p><ul><li>ç”¨<code>static</code>ä¿®é¥°ï¼Œæ˜¯å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ã€‚</li><li>å¯ä»¥ä¸ä¾èµ–äºå¤–éƒ¨ç±»å®ä¾‹è¢«åˆ›å»ºã€‚</li><li>åªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ã€‚</li><li>è¯­æ³•ï¼š<code>OuterClass.StaticInnerClass innerObject = new OuterClass.StaticInnerClass();</code></li></ul><p><strong>å±€éƒ¨å†…éƒ¨ç±»</strong>:</p><ul><li>å®šä¹‰åœ¨æ–¹æ³•å†…éƒ¨ã€‚</li><li>åªèƒ½åœ¨å®šä¹‰å®ƒçš„æ–¹æ³•ä¸­è¢«ä½¿ç”¨ã€‚</li><li>å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜å’Œæ–¹æ³•å†…çš„finalå±€éƒ¨å˜é‡ã€‚</li></ul><p><strong>åŒ¿åå†…éƒ¨ç±»</strong>:</p><ul><li>æ²¡æœ‰åç§°çš„å±€éƒ¨å†…éƒ¨ç±»ã€‚</li><li>é€šå¸¸ç”¨äºå®ç°æ¥å£æˆ–ç»§æ‰¿æŠ½è±¡ç±»çš„ä¸´æ—¶éœ€æ±‚ã€‚</li><li>è¯­æ³•ï¼š<code>new InterfaceName() &#123; /* å®ç° */ &#125;</code> æˆ– <code>new ClassName() &#123; /* æ‰©å±• */ &#125;</code>ã€‚</li></ul><blockquote><p>ä½¿ç”¨ç¤ºä¾‹</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// ç¤ºä¾‹ï¼šæˆå‘˜å†…éƒ¨ç±»ã€é™æ€å†…éƒ¨ç±»ã€å±€éƒ¨å†…éƒ¨ç±»å’ŒåŒ¿åå†…éƒ¨ç±»çš„ä½¿ç”¨</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title">OuterClass</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String outerField = <span class="hljs-string">&quot;Outer&quot;</span>;<br><br>    <span class="hljs-comment">// æˆå‘˜å†…éƒ¨ç±»</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title">MemberInnerClass</span> &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">display</span>()</span> &#123;<br>            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Member Inner Class: &quot;</span> + outerField);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// é™æ€å†…éƒ¨ç±»</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StaticInnerClass</span> &#123;<br>        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">display</span>()</span> &#123;<br>            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Static Inner Class&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test</span>()</span> &#123;<br>        <span class="hljs-comment">// å±€éƒ¨å†…éƒ¨ç±»</span><br>        <span class="hljs-keyword">class</span> <span class="hljs-title">LocalInnerClass</span> &#123;<br>            <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">display</span>()</span> &#123;<br>                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Local Inner Class: &quot;</span> + outerField);<br>            &#125;<br>        &#125;<br><br>        LocalInnerClass localInner = <span class="hljs-keyword">new</span> LocalInnerClass();<br>        localInner.display();<br>    &#125;<br><br>    <span class="hljs-comment">// åŒ¿åå†…éƒ¨ç±»</span><br>    <span class="hljs-function">Runnable <span class="hljs-title">getRunnable</span>()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Runnable() &#123;<br>            @Override<br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> &#123;<br>                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Anonymous Inner Class&quot;</span>);<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        OuterClass outer = <span class="hljs-keyword">new</span> OuterClass();<br><br>        <span class="hljs-comment">// ä½¿ç”¨æˆå‘˜å†…éƒ¨ç±»</span><br>        OuterClass.MemberInnerClass memberInner = outer.<span class="hljs-function"><span class="hljs-keyword">new</span> <span class="hljs-title">MemberInnerClass</span>()</span>;<br>        memberInner.display();<br><br>        <span class="hljs-comment">// ä½¿ç”¨é™æ€å†…éƒ¨ç±»</span><br>        OuterClass.StaticInnerClass staticInner = <span class="hljs-keyword">new</span> OuterClass.StaticInnerClass();<br>        staticInner.display();<br><br>        <span class="hljs-comment">// ä½¿ç”¨å±€éƒ¨å†…éƒ¨ç±»</span><br>        outer.test();<br><br>        <span class="hljs-comment">// ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»</span><br>        Runnable runnable = outer.getRunnable();<br>        runnable.run();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="åŒ¿åå†…éƒ¨ç±»"><a href="#åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»"></a>åŒ¿åå†…éƒ¨ç±»</h5><p>å‚è€ƒï¼š <a href="https://www.cnblogs.com/nerxious/archive/2013/01/25/2876489.html">https://www.cnblogs.com/nerxious/archive/2013/01/25/2876489.html</a></p><p>ä¸€èˆ¬ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»æ˜¯ç”¨æ¥ç®€åŒ–ä»£ç ç¼–å†™ï¼ŒåŒ¿åå†…éƒ¨ç±»ä¸€èˆ¬åªä½¿ç”¨ä¸€æ¬¡</p><p>å¦‚ä½•ä½¿ç”¨ï¼šä½¿ç”¨åŒ¿åå†…éƒ¨ç±»éœ€è¦ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»æˆ–å®ç°ä¸€ä¸ªæ¥å£</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">//å½“ä¸ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„æƒ…å†µ</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">eat</span>()</span>;<br>&#125;<br> <br><span class="hljs-keyword">class</span> <span class="hljs-title">Child</span> <span class="hljs-title">extends</span> <span class="hljs-title">Person</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">eat</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;eat something&quot;</span>);<br>    &#125;<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        Person p = <span class="hljs-keyword">new</span> Child();<br>        p.eat();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//å½“ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„æƒ…å†µ</span><br><span class="hljs-comment">//åŒ¿åå†…éƒ¨ç±»çš„åŸºæœ¬å®ç°</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">eat</span>()</span>;<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        Person p = <span class="hljs-keyword">new</span> Person() &#123;<br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">eat</span>()</span> &#123;<br>                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;eat something&quot;</span>);<br>            &#125;<br>        &#125;;<br>        p.eat();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//åœ¨æ¥å£ä¸Šä½¿ç”¨åŒ¿åå†…éƒ¨ç±»</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title">Person</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">eat</span>()</span>;<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        Person p = <span class="hljs-keyword">new</span> Person() &#123;<br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">eat</span>()</span> &#123;<br>                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;eat something&quot;</span>);<br>            &#125;<br>        &#125;;<br>        p.eat();<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">//Threadç±»çš„åŒ¿åå†…éƒ¨ç±»å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        Thread t = <span class="hljs-keyword">new</span> Thread() &#123;<br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) &#123;<br>                    System.<span class="hljs-keyword">out</span>.print(i + <span class="hljs-string">&quot; &quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;;<br>        t.start();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//Runnableæ¥å£çš„åŒ¿åå†…éƒ¨ç±»å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        Runnable r = <span class="hljs-keyword">new</span> Runnable() &#123;<br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> &#123;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) &#123;<br>                    System.<span class="hljs-keyword">out</span>.print(i + <span class="hljs-string">&quot; &quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;;<br>        Thread t = <span class="hljs-keyword">new</span> Thread(r);<br>        t.start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="äºŒã€Object"><a href="#äºŒã€Object" class="headerlink" title="äºŒã€Object"></a>äºŒã€Object</h3><h4 id="2-1-Object-ç±»çš„å¸¸ç”¨æ–¹æ³•"><a href="#2-1-Object-ç±»çš„å¸¸ç”¨æ–¹æ³•" class="headerlink" title="2.1 Object ç±»çš„å¸¸ç”¨æ–¹æ³•"></a>2.1 Object ç±»çš„å¸¸ç”¨æ–¹æ³•</h4><p>Object ç±»æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼Œæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ã€‚å®ƒä¸»è¦æä¾›äº†ä»¥ä¸‹ 11 ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * native æ–¹æ³•ï¼Œç”¨äºè¿”å›å½“å‰è¿è¡Œæ—¶å¯¹è±¡çš„ Class å¯¹è±¡ï¼Œä½¿ç”¨äº† final å…³é”®å­—ä¿®é¥°ï¼Œæ•…ä¸å…è®¸å­ç±»é‡å†™ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> Class&lt;?&gt; <span class="hljs-title function_">getClass</span>()<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * native æ–¹æ³•ï¼Œç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä¸»è¦ä½¿ç”¨åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ¯”å¦‚ JDK ä¸­çš„HashMapã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span>()<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨äºæ¯”è¾ƒ 2 ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ï¼ŒString ç±»å¯¹è¯¥æ–¹æ³•è¿›è¡Œäº†é‡å†™ä»¥ç”¨äºæ¯”è¾ƒå­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span>(<span class="hljs-built_in">Object</span> obj)<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * native æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå¹¶è¿”å›å½“å‰å¯¹è±¡çš„ä¸€ä»½æ‹·è´ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">native</span> <span class="hljs-built_in">Object</span> <span class="hljs-title function_">clone</span>() <span class="hljs-keyword">throws</span> CloneNotSupportedException<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¿”å›ç±»çš„åå­—å®ä¾‹çš„å“ˆå¸Œç çš„ 16 è¿›åˆ¶çš„å­—ç¬¦ä¸²ã€‚å»ºè®® Object æ‰€æœ‰çš„å­ç±»éƒ½é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">String</span> <span class="hljs-title function_">toString</span>()<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚å”¤é†’ä¸€ä¸ªåœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„çº¿ç¨‹(ç›‘è§†å™¨ç›¸å½“äºå°±æ˜¯é”çš„æ¦‚å¿µ)ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åªä¼šä»»æ„å”¤é†’ä¸€ä¸ªã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notify</span>()<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * native æ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚è·Ÿ notify ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyAll</span>()<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * nativeæ–¹æ³•ï¼Œå¹¶ä¸”ä¸èƒ½é‡å†™ã€‚æš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚æ³¨æ„ï¼šsleep æ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œè€Œ wait æ–¹æ³•é‡Šæ”¾äº†é” ï¼Œtimeout æ˜¯ç­‰å¾…æ—¶é—´ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wait</span>(<span class="hljs-type">long</span> timeout) <span class="hljs-keyword">throws</span> InterruptedException<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¤šäº† nanos å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºé¢å¤–æ—¶é—´ï¼ˆä»¥çº³ç§’ä¸ºå•ä½ï¼ŒèŒƒå›´æ˜¯ 0-999999ï¼‰ã€‚ æ‰€ä»¥è¶…æ—¶çš„æ—¶é—´è¿˜éœ€è¦åŠ ä¸Š nanos çº³ç§’ã€‚ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wait</span>(<span class="hljs-type">long</span> timeout, <span class="hljs-type">int</span> nanos) <span class="hljs-keyword">throws</span> InterruptedException<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è·Ÿä¹‹å‰çš„2ä¸ªwaitæ–¹æ³•ä¸€æ ·ï¼Œåªä¸è¿‡è¯¥æ–¹æ³•ä¸€ç›´ç­‰å¾…ï¼Œæ²¡æœ‰è¶…æ—¶æ—¶é—´è¿™ä¸ªæ¦‚å¿µ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wait</span>() <span class="hljs-keyword">throws</span> InterruptedException<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å®ä¾‹è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ—¶å€™è§¦å‘çš„æ“ä½œ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finalize</span>() <span class="hljs-keyword">throws</span> Throwable &#123; &#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯Javaä¸­ <code>Object</code> ç±»çš„å¸¸ç”¨æ–¹æ³•çš„æ€»ç»“ï¼ŒåŒ…æ‹¬æ¯ä¸ªæ–¹æ³•çš„åŠŸèƒ½å’Œç‰¹æ€§ï¼š</p><table><thead><tr><th>æ–¹æ³•ç­¾å</th><th>è¿”å›ç±»å‹</th><th>æè¿°</th><th>ç‰¹æ€§</th></tr></thead><tbody><tr><td><code>public final native Class&lt;?&gt; getClass()</code></td><td><code>Class&lt;?&gt;</code></td><td>è¿”å›å½“å‰è¿è¡Œæ—¶å¯¹è±¡çš„Classå¯¹è±¡ã€‚</td><td>ä½¿ç”¨ <code>final</code> å’Œ <code>native</code> å…³é”®å­—ï¼Œä¸èƒ½è¢«å­ç±»é‡å†™</td></tr><tr><td><code>public native int hashCode()</code></td><td>int</td><td>è¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä¸»è¦ç”¨äºå“ˆå¸Œè¡¨ã€‚</td><td><code>native</code> æ–¹æ³•ï¼Œé€šå¸¸ä¸ <code>equals()</code> æ–¹æ³•ä¸€èµ·ä½¿ç”¨ã€‚</td></tr><tr><td><code>public boolean equals(Object obj)</code></td><td>boolean</td><td>æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ã€‚Stringç±»é‡å†™äº†æ­¤æ–¹æ³•æ¥æ¯”è¾ƒå­—ç¬¦ä¸²å€¼ã€‚</td><td>å¯è¢«å­ç±»é‡å†™ä»¥æä¾›ç›¸ç­‰æ€§é€»è¾‘ã€‚</td></tr><tr><td><code>protected native Object clone()</code></td><td>Object</td><td>åˆ›å»ºå¹¶è¿”å›å½“å‰å¯¹è±¡çš„ä¸€ä»½æ‹·è´ã€‚</td><td><code>native</code> æ–¹æ³•ï¼Œç±»å¿…é¡»å®ç° <code>Cloneable</code> æ¥å£æ‰èƒ½ä½¿ç”¨æ­¤æ–¹æ³•ã€‚</td></tr><tr><td><code>public String toString()</code></td><td>String</td><td>è¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œé€šå¸¸åŒ…æ‹¬ç±»åå’Œå“ˆå¸Œç çš„16è¿›åˆ¶å­—ç¬¦ä¸²ã€‚</td><td>å»ºè®®æ‰€æœ‰å­ç±»é‡å†™æ­¤æ–¹æ³•ã€‚</td></tr><tr><td><code>public final native void notify()</code></td><td>void</td><td>å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚</td><td>ä½¿ç”¨ <code>final</code> å’Œ <code>native</code> å…³é”®å­—ï¼Œä¸èƒ½è¢«å­ç±»é‡å†™ã€‚</td></tr><tr><td><code>public final native void notifyAll()</code></td><td>void</td><td>å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚</td><td>ä½¿ç”¨ <code>final</code> å’Œ <code>native</code> å…³é”®å­—ï¼Œä¸èƒ½è¢«å­ç±»é‡å†™ã€‚</td></tr><tr><td><code>public final native void wait(long timeout)</code></td><td>void</td><td>ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>notify()</code> æˆ– <code>notifyAll()</code>ï¼Œæˆ–è¶…æ—¶ã€‚</td><td>ä½¿ç”¨ <code>final</code> å’Œ <code>native</code> å…³é”®å­—ï¼Œä¸èƒ½è¢«å­ç±»é‡å†™ã€‚é‡Šæ”¾å¯¹è±¡çš„é”ã€‚</td></tr><tr><td><code>public final void wait(long timeout, int nanos)</code></td><td>void</td><td>ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>notify()</code> æˆ– <code>notifyAll()</code>ï¼Œæˆ–è¶…æ—¶åŠ é¢å¤–çº³ç§’ã€‚</td><td>ä½¿ç”¨ <code>final</code> å…³é”®å­—ï¼Œä¸èƒ½è¢«å­ç±»é‡å†™ã€‚é‡Šæ”¾å¯¹è±¡çš„é”ã€‚</td></tr><tr><td><code>public final void wait()</code></td><td>void</td><td>ä½¿å½“å‰çº¿ç¨‹æ— é™æœŸç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>notify()</code> æˆ– <code>notifyAll()</code>ã€‚</td><td>ä½¿ç”¨ <code>final</code> å…³é”®å­—ï¼Œä¸èƒ½è¢«å­ç±»é‡å†™ã€‚é‡Šæ”¾å¯¹è±¡çš„é”ã€‚</td></tr><tr><td><code>protected void finalize()</code></td><td>void</td><td>åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶è§¦å‘çš„æ“ä½œã€‚</td><td>åœ¨Java 9ä¸­è¢«å¼ƒç”¨ï¼Œä½†å­ç±»å¯ä»¥é‡å†™ä»¥è¿›è¡Œæ¸…ç†æ“ä½œã€‚</td></tr></tbody></table><p>è¿™äº›æ–¹æ³•æä¾›äº†å¯¹è±¡è¡Œä¸ºçš„åŸºæœ¬æ¡†æ¶ï¼Œä»å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†åˆ°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚</p><h4 id="2-2-å’Œ-equals-çš„åŒºåˆ«"><a href="#2-2-å’Œ-equals-çš„åŒºåˆ«" class="headerlink" title="2.2 &#x3D;&#x3D; å’Œ equals() çš„åŒºåˆ«"></a>2.2 &#x3D;&#x3D; å’Œ equals() çš„åŒºåˆ«</h4><p>&#x3D;&#x3D;Â å¯¹äºåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„ä½œç”¨æ•ˆæœæ˜¯ä¸åŒçš„ï¼š</p><ul><li>å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ï¼Œ&#x3D;&#x3D;Â æ¯”è¾ƒçš„æ˜¯å€¼ã€‚</li><li>å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹æ¥è¯´ï¼Œ&#x3D;&#x3D;Â æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</li></ul><p>åœ¨Javaä¸­ï¼Œ&#x3D;&#x3D; è¿ç®—ç¬¦å’Œ<code>equals()</code>æ–¹æ³•ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ï¼Œä½†å®ƒä»¬åœ¨æ¯”è¾ƒæ–¹å¼ä¸Šæœ‰æœ¬è´¨çš„ä¸åŒã€‚</p><blockquote><p>&#x3D;&#x3D; è¿ç®—ç¬¦</p></blockquote><ol><li><p><strong>ç”¨é€”</strong>: ä¸»è¦ç”¨äºæ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼å’Œå¼•ç”¨ç±»å‹çš„åœ°å€ã€‚</p></li><li><p><strong>å¯¹åŸºæœ¬ç±»å‹</strong>: æ¯”è¾ƒä¸¤ä¸ªåŸºæœ¬ç±»å‹çš„å€¼æ˜¯å¦ç›¸åŒï¼ˆä¾‹å¦‚ï¼Œ<code>int</code>, <code>char</code>, <code>double</code>ç­‰ï¼‰ã€‚</p></li><li><p><strong>å¯¹å¼•ç”¨ç±»å‹</strong>: æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä½ç½®ã€‚</p></li></ol><blockquote><p><code>equals()</code> æ–¹æ³•</p></blockquote><ol><li><p><strong>ç”¨é€”</strong>: ä¸»è¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æˆ–çŠ¶æ€æ˜¯å¦ç›¸ç­‰ã€‚</p></li><li><p><strong>é»˜è®¤è¡Œä¸º</strong>: åœ¨ <code>Object</code> ç±»ä¸­å®šä¹‰çš„ <code>equals()</code> æ–¹æ³•é»˜è®¤è¡Œä¸ºä¸  &#x3D;&#x3D; ç›¸åŒï¼Œå³æ¯”è¾ƒå¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</p></li><li><p><strong>é‡å†™</strong>: å¤šæ•°ç±»ï¼Œå¦‚ <code>String</code>, <code>Date</code> ç­‰ï¼Œéƒ½é‡å†™äº† <code>equals()</code> æ–¹æ³•æ¥è¿›è¡Œé€»è¾‘æ¯”è¾ƒï¼Œå³æ¯”è¾ƒå¯¹è±¡çš„å†…å®¹è€Œä¸æ˜¯å†…å­˜åœ°å€ã€‚</p></li></ol><blockquote><p>è¡¨æ ¼æ¯”è¾ƒ</p></blockquote><table><thead><tr><th>ç‰¹æ€§</th><th>&#x3D;&#x3D; è¿ç®—ç¬¦</th><th><code>equals()</code> æ–¹æ³•</th></tr></thead><tbody><tr><td>æ¯”è¾ƒç±»å‹</td><td>åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ &#x2F; å¼•ç”¨ç±»å‹çš„å†…å­˜åœ°å€</td><td>å¯¹è±¡å†…å®¹ï¼ˆå¯é‡å†™ï¼‰</td></tr><tr><td>é»˜è®¤è¡Œä¸º</td><td>æ¯”è¾ƒå†…å­˜åœ°å€ï¼ˆå¯¹äºå¼•ç”¨ç±»å‹ï¼‰</td><td>åœ¨ <code>Object</code> ç±»ä¸­ä¹Ÿæ˜¯æ¯”è¾ƒå†…å­˜åœ°å€</td></tr><tr><td>å¯é‡å†™æ€§</td><td>ä¸å¯é‡å†™</td><td>å¯ä»¥é‡å†™ä»¥æä¾›è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>å½“éœ€è¦æ£€æŸ¥ä¸¤ä¸ªå˜é‡æ˜¯å¦æŒ‡å‘ç›¸åŒçš„å¯¹è±¡æ—¶ä½¿ç”¨</td><td>å½“éœ€è¦æ£€æŸ¥ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦åœ¨é€»è¾‘ä¸Šç›¸ç­‰æ—¶ä½¿ç”¨</td></tr><tr><td>ä¾‹å­</td><td><code>a == b</code>ï¼ˆå¯¹äºåŸºæœ¬ç±»å‹æˆ–æ£€æŸ¥ä¸¤ä¸ªå¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€å¯¹è±¡ï¼‰</td><td><code>a.equals(b)</code>ï¼ˆå¯¹äºæ£€æŸ¥ä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼‰</td></tr></tbody></table><blockquote><p>ç±»æ¯”</p></blockquote><ul><li><p><strong>&#x3D;&#x3D; è¿ç®—ç¬¦</strong>: å°±åƒæ£€æŸ¥ä¸¤å¼ åç‰‡ä¸Šçš„åœ°å€æ˜¯å¦ä¸€æ ·ï¼Œå³ä½¿ä¸¤å¼ åç‰‡å±äºåŒä¸€äººï¼Œä½†å¦‚æœåœ°å€ä¸åŒï¼Œç»“æœå°±æ˜¯ä¸ç›¸ç­‰ã€‚</p></li><li><p><strong><code>equals()</code> æ–¹æ³•</strong>: å°±åƒæ¯”è¾ƒä¸¤ä¸ªäººçš„é¢è²Œï¼Œå³ä½¿ä»–ä»¬ä½åœ¨ä¸åŒçš„åœ°æ–¹ï¼ˆä¸åŒçš„å†…å­˜åœ°å€ï¼‰ï¼Œåªè¦é¢è²Œç›¸åŒï¼ˆå†…å®¹ç›¸åŒï¼‰ï¼Œå°±è®¤ä¸ºä»–ä»¬ç›¸ç­‰ã€‚</p></li></ul><p>æ‰©å±•çš„ä¸€äº›é—®é¢˜ï¼š</p><p>to be conteindâ€¦</p><h4 id="2-3-hashCode-æœ‰ä»€ä¹ˆç”¨"><a href="#2-3-hashCode-æœ‰ä»€ä¹ˆç”¨" class="headerlink" title="2.3 hashCode æœ‰ä»€ä¹ˆç”¨"></a>2.3 hashCode æœ‰ä»€ä¹ˆç”¨</h4><p><code>hashCode()</code>Â çš„ä½œç”¨æ˜¯è·å–å“ˆå¸Œç ï¼ˆ<code>int</code>Â æ•´æ•°ï¼‰ï¼Œä¹Ÿç§°ä¸ºæ•£åˆ—ç ã€‚è¿™ä¸ªå“ˆå¸Œç çš„ä½œç”¨æ˜¯ç¡®å®šè¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½®ã€‚</p><p><code>hashCode()</code> å®šä¹‰åœ¨ JDK çš„ <code>Object</code> ç±»ä¸­ï¼Œè¿™å°±æ„å‘³ç€ Java ä¸­çš„ä»»ä½•ç±»éƒ½åŒ…å«æœ‰ <code>hashCode()</code> å‡½æ•°ã€‚å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<code>Object</code> çš„ <code>hashCode()</code> æ–¹æ³•æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”¨ C è¯­è¨€æˆ– C++ å®ç°çš„ã€‚</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span></span>;<br></code></pre></td></tr></table></figure><p>æ•£åˆ—è¡¨å­˜å‚¨çš„æ˜¯é”®å€¼å¯¹(key-value)ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š<strong>èƒ½æ ¹æ®â€œé”®â€å¿«é€Ÿçš„æ£€ç´¢å‡ºå¯¹åº”çš„â€œå€¼â€ã€‚è¿™å…¶ä¸­å°±åˆ©ç”¨åˆ°äº†æ•£åˆ—ç ï¼ï¼ˆå¯ä»¥å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€è¦çš„å¯¹è±¡ï¼‰</strong></p><p>hashCode() å’Œ  equals() æ–¹æ³•</p><ul><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„<code>hashCode</code> å€¼ç›¸ç­‰ï¼Œé‚£è¿™ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç›¸ç­‰ï¼ˆå“ˆå¸Œç¢°æ’ï¼‰ã€‚</li><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„<code>hashCode</code> å€¼ç›¸ç­‰å¹¶ä¸”<code>equals()</code>æ–¹æ³•ä¹Ÿè¿”å› <code>true</code>ï¼Œæˆ‘ä»¬æ‰è®¤ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ã€‚</li><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„<code>hashCode</code> å€¼ä¸ç›¸ç­‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è®¤ä¸ºè¿™ä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ã€‚</li></ul><blockquote><p>ä¸ºä»€ä¹ˆé‡å†™ equals() æ—¶å¿…é¡»é‡å†™ hashCode() æ–¹æ³•ï¼Ÿ</p></blockquote><p>å› ä¸ºä¸¤ä¸ªç›¸ç­‰çš„å¯¹è±¡çš„ <code>hashCode</code> å€¼å¿…é¡»æ˜¯ç›¸ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ <code>equals</code> æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼Œé‚£è¿™ä¸¤ä¸ªå¯¹è±¡çš„ <code>hashCode</code> å€¼ä¹Ÿè¦ç›¸ç­‰ã€‚</p><p>å¦‚æœé‡å†™ <code>equals()</code> æ—¶æ²¡æœ‰é‡å†™ <code>hashCode()</code> æ–¹æ³•çš„è¯å°±å¯èƒ½ä¼šå¯¼è‡´ <code>equals</code> æ–¹æ³•åˆ¤æ–­æ˜¯ç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œ<code>hashCode</code> å€¼å´ä¸ç›¸ç­‰ã€‚</p><p><strong>æ€è€ƒ</strong>ï¼šé‡å†™ <code>equals()</code> æ—¶æ²¡æœ‰é‡å†™ <code>hashCode()</code> æ–¹æ³•çš„è¯ï¼Œä½¿ç”¨ <code>HashMap</code> å¯èƒ½ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚</p><p>å¦‚æœæ²¡æœ‰é‡å†™å“ˆå¸Œå‡½æ•°çš„è¯ï¼Œä¸¤ä¸ªé”®è·å–å“ˆå¸Œè¡¨ä½ç½®ç´¢å¼•å¯èƒ½ä¼šä¸å¯¹ï¼Œé€ æˆä¸€äº›ç°è±¡ï¼Œæ¯”å¦‚ï¼šåœ¨é›†åˆä¸­æŸ¥æ‰¾å¯¹è±¡æ—¶å¯èƒ½ä¼šå¤±è´¥ï¼Œå³ä½¿è¯¥å¯¹è±¡å·²ç»å­˜åœ¨ï¼›å³ä½¿ä½¿ç”¨ä¸€ä¸ªé€»è¾‘ä¸Šç›¸ç­‰çš„é”®å»æŸ¥æ‰¾ï¼Œä¹Ÿå¯èƒ½æ— æ³•æ‰¾åˆ°å¯¹åº”çš„å€¼ï¼Œå¯¼è‡´æ•°æ®è®¿é—®ä¸Šçš„é—®é¢˜ç­‰ã€‚</p><blockquote><p>æ•£åˆ—è¡¨</p></blockquote><p>æ•£åˆ—è¡¨ï¼ˆHash tableï¼Œä¹Ÿå«å“ˆå¸Œè¡¨ï¼‰ï¼Œæ˜¯æ ¹æ®é”®ï¼ˆKeyï¼‰è€Œç›´æ¥è®¿é—®åœ¨å­˜å‚¨å™¨å­˜å‚¨ä½ç½®çš„æ•°æ®ç»“æ„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒé€šè¿‡è®¡ç®—å‡ºä¸€ä¸ªé”®å€¼çš„å‡½æ•°ï¼Œå°†æ‰€éœ€æŸ¥è¯¢çš„æ•°æ®æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®©äººè®¿é—®ï¼Œè¿™åŠ å¿«äº†æŸ¥æ‰¾é€Ÿåº¦ã€‚</p><p>è¿™ä¸ªæ˜ å°„å‡½æ•°ç§°åšæ•£åˆ—å‡½æ•°ï¼Œå­˜æ”¾è®°å½•çš„æ•°ç»„ç§°åšæ•£åˆ—è¡¨ã€‚</p><p>ä¸€ä¸ªé€šä¿—çš„ä¾‹å­æ˜¯ï¼Œ</p><p>ä¸ºäº†æŸ¥æ‰¾ç”µè¯ç°¿ä¸­æŸäººçš„å·ç ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæŒ‰ç…§äººåé¦–å­—æ¯é¡ºåºæ’åˆ—çš„è¡¨ï¼ˆå³å»ºç«‹äººå x åˆ°é¦–å­—æ¯ F(x) çš„ä¸€ä¸ªå‡½æ•°å…³ç³»ï¼‰ï¼Œåœ¨é¦–å­—æ¯ä¸ºWçš„è¡¨ä¸­æŸ¥æ‰¾â€œç‹â€å§“çš„ç”µè¯å·ç ï¼Œæ˜¾ç„¶æ¯”ç›´æ¥æŸ¥æ‰¾å°±è¦å¿«å¾—å¤šã€‚è¿™é‡Œä½¿ç”¨äººåä½œä¸ºå…³é”®å­—ï¼Œâ€œå–é¦–å­—æ¯â€æ˜¯è¿™ä¸ªä¾‹å­ä¸­æ•£åˆ—å‡½æ•°çš„å‡½æ•°æ³•åˆ™ F( )ï¼Œå­˜æ”¾é¦–å­—æ¯çš„è¡¨å¯¹åº”æ•£åˆ—è¡¨ã€‚å…³é”®å­—å’Œå‡½æ•°æ³•åˆ™ç†è®ºä¸Šå¯ä»¥ä»»æ„ç¡®å®šã€‚</p><blockquote><p>å“ˆå¸Œè¡¨</p></blockquote><p>å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰å…¶å®ä¹Ÿå«æ•£åˆ—è¡¨ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚</p><p>å“ˆå¸Œè¡¨æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåªä¸è¿‡æ•°ç»„å­˜æ”¾çš„æ˜¯å•ä¸€çš„æ•°æ®ï¼Œè€Œå“ˆå¸Œè¡¨ä¸­å­˜æ”¾çš„æ˜¯é”®å€¼å¯¹ï¼ˆkey - value pairï¼‰</p><p>key é€šè¿‡å“ˆå¸Œå‡½æ•°ï¼ˆhash functionï¼‰å¾—åˆ°æ•°ç»„çš„ç´¢å¼•ï¼Œè¿›è€Œå­˜å–ç´¢å¼•ä½ç½®çš„å€¼ã€‚</p><p>ä¸åŒçš„ key é€šè¿‡å“ˆå¸Œå‡½æ•°å¯èƒ½å¾—åˆ°ç›¸åŒçš„ç´¢å¼•å€¼ï¼Œæ­¤æ—¶ï¼Œäº§ç”Ÿäº†å“ˆå¸Œç¢°æ’ã€‚</p><p>é€šè¿‡åœ¨æ•°ç»„ä¸­æ’å…¥é“¾è¡¨æˆ–è€…äºŒå‰æ ‘ï¼Œå¯ä»¥è§£å†³å“ˆå¸Œç¢°æ’é—®é¢˜ã€‚</p><hr><h3 id="ä¸‰ã€String"><a href="#ä¸‰ã€String" class="headerlink" title="ä¸‰ã€String"></a>ä¸‰ã€String</h3><h4 id="3-1-Stringã€StringBufferã€StringBuilder-çš„åŒºåˆ«ï¼Ÿ"><a href="#3-1-Stringã€StringBufferã€StringBuilder-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3.1  Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«ï¼Ÿ"></a>3.1  Stringã€StringBufferã€StringBuilder çš„åŒºåˆ«ï¼Ÿ</h4><table><thead><tr><th>ç‰¹æ€§</th><th><code>String</code></th><th><code>StringBuffer</code></th><th><code>StringBuilder</code></th></tr></thead><tbody><tr><td>å¯å˜æ€§</td><td>ä¸å¯å˜</td><td>å¯å˜</td><td>å¯å˜</td></tr><tr><td>çº¿ç¨‹å®‰å…¨</td><td>æ˜¯</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>æ€§èƒ½</td><td>è¾ƒä½ï¼ˆå¯¹äºé¢‘ç¹ä¿®æ”¹ï¼‰</td><td>é«˜ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</td><td>é«˜ï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰</td></tr><tr><td>ç”¨é€”</td><td>æ–‡æœ¬ä¸é¢‘ç¹æ”¹å˜æ—¶</td><td>å¤šçº¿ç¨‹ä¸­æ–‡æœ¬é¢‘ç¹æ”¹å˜</td><td>å•çº¿ç¨‹ä¸­æ–‡æœ¬é¢‘ç¹æ”¹å˜</td></tr></tbody></table><p>String æ˜¯é€šè¿‡ final è¿›è¡Œä¿®é¥°çš„ï¼Œæˆ‘ä»¬æ¯æ¬¡å¯¹<code>String</code>å¯¹è±¡çš„ä¿®æ”¹å®é™…éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„<code>String</code>å¯¹è±¡ã€‚</p><p><code>StringBuffer</code>å’Œ<code>StringBuilder</code>çš„é»˜è®¤å®¹é‡å¤§å°éƒ½æ˜¯16ä¸ªå­—ç¬¦ã€‚</p><h4 id="3-2-String-ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„"><a href="#3-2-String-ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„" class="headerlink" title="3.2 String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„"></a>3.2 String ä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„</h4><p><code>String</code> çœŸæ­£ä¸å¯å˜æœ‰ä¸‹é¢å‡ ç‚¹åŸå› ï¼š</p><ol><li>ä¿å­˜å­—ç¬¦ä¸²çš„æ•°ç»„è¢« <code>final</code> ä¿®é¥°ä¸”ä¸ºç§æœ‰çš„ï¼Œå¹¶ä¸”<code>String</code> ç±»æ²¡æœ‰æä¾›&#x2F;æš´éœ²ä¿®æ”¹è¿™ä¸ªå­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚</li><li><code>String</code> ç±»è¢« <code>final</code> ä¿®é¥°å¯¼è‡´å…¶ä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¿›è€Œé¿å…äº†å­ç±»ç ´å <code>String</code> ä¸å¯å˜</li></ol><h4 id="3-3-å­—ç¬¦ä¸²æ‹¼æ¥ç”¨â€œ-â€-è¿˜æ˜¯-StringBuilder"><a href="#3-3-å­—ç¬¦ä¸²æ‹¼æ¥ç”¨â€œ-â€-è¿˜æ˜¯-StringBuilder" class="headerlink" title="3.3  å­—ç¬¦ä¸²æ‹¼æ¥ç”¨â€œ+â€ è¿˜æ˜¯ StringBuilder?"></a>3.3  å­—ç¬¦ä¸²æ‹¼æ¥ç”¨â€œ+â€ è¿˜æ˜¯ StringBuilder?</h4><p>Java è¯­è¨€æœ¬èº«å¹¶ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼Œâ€œ+â€å’Œâ€œ+&#x3D;â€æ˜¯ä¸“é—¨ä¸º String ç±»é‡è½½è¿‡çš„è¿ç®—ç¬¦ï¼Œä¹Ÿæ˜¯ Java ä¸­ä»…æœ‰çš„ä¸¤ä¸ªé‡è½½è¿‡çš„è¿ç®—ç¬¦ã€‚</p><p>åœ¨JDK8ä¸­ï¼Œå­—ç¬¦ä¸²å¯¹è±¡é€šè¿‡â€œ+â€çš„å­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ <code>StringBuilder</code> è°ƒç”¨ <code>append()</code> æ–¹æ³•å®ç°çš„ï¼Œæ‹¼æ¥å®Œæˆä¹‹åè°ƒç”¨ <code>toString()</code> å¾—åˆ°ä¸€ä¸ª <code>String</code> å¯¹è±¡ ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨å¾ªç¯å†…ä½¿ç”¨â€œ+â€è¿›è¡Œå­—ç¬¦ä¸²çš„æ‹¼æ¥çš„è¯ï¼Œå­˜åœ¨æ¯”è¾ƒæ˜æ˜¾çš„ç¼ºé™·ï¼š<strong>ç¼–è¯‘å™¨ä¸ä¼šåˆ›å»ºå•ä¸ª <code>StringBuilder</code> ä»¥å¤ç”¨ï¼Œä¼šå¯¼è‡´åˆ›å»ºè¿‡å¤šçš„ <code>StringBuilder</code> å¯¹è±¡</strong>ã€‚</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-type">String</span> str1 = <span class="hljs-string">&quot;he&quot;</span>;<br><span class="hljs-type">String</span> str2 = <span class="hljs-string">&quot;llo&quot;</span>;<br><span class="hljs-type">String</span> str3 = <span class="hljs-string">&quot;world&quot;</span>;<br><span class="hljs-type">String</span> str4 = str1 + str2 + str3;<br></code></pre></td></tr></table></figure><p>å¯¹åº”å­—èŠ‚ç </p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401101412356.png" alt="image.png"></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-type">String</span>[] arr = &#123;<span class="hljs-string">&quot;he&quot;</span>, <span class="hljs-string">&quot;llo&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>&#125;;<br><span class="hljs-type">String</span> s = <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br>    s += arr[i];<br>&#125;<br>System.out.<span class="hljs-built_in">println</span>(s);<br></code></pre></td></tr></table></figure><p><code>StringBuilder</code>Â å¯¹è±¡æ˜¯åœ¨å¾ªç¯å†…éƒ¨è¢«åˆ›å»ºçš„ï¼Œè¿™æ„å‘³ç€æ¯å¾ªç¯ä¸€æ¬¡å°±ä¼šåˆ›å»ºä¸€ä¸ªÂ <code>StringBuilder</code>Â å¯¹è±¡</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401101412821.png" alt="image.png"></p><p>å¦‚æœç›´æ¥ä½¿ç”¨Â <code>StringBuilder</code>Â å¯¹è±¡è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥çš„è¯ï¼Œå°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">String</span>[] arr = &#123;<span class="hljs-string">&quot;he&quot;</span>, <span class="hljs-string">&quot;llo&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>&#125;;<br>StringBuilder s = <span class="hljs-keyword">new</span> <span class="hljs-type">StringBuilder</span>();<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">String</span> value : <span class="hljs-type">arr</span>) &#123;<br>    s.append(value);<br>&#125;<br>System.out.println(s);<br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401101413874.png" alt="image.png"></p><p>è€Œåœ¨ JDK9ä¸­ï¼Œå­—ç¬¦ä¸²ç›¸åŠ  â€œ+â€ æ”¹ä¸ºäº†ç”¨åŠ¨æ€æ–¹æ³•Â <code>makeConcatWithConstants()</code>Â æ¥å®ç°ï¼Œè€Œä¸æ˜¯å¤§é‡çš„Â <code>StringBuilder</code>ï¼›è¿™ä¹Ÿæ„å‘³ç€ JDK 9 ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒä½¿ç”¨â€œ+â€ è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ã€‚</p><h4 id="3-4-String-equals-å’Œ-Object-equals-æœ‰ä½•åŒºåˆ«"><a href="#3-4-String-equals-å’Œ-Object-equals-æœ‰ä½•åŒºåˆ«" class="headerlink" title="3.4  String#equals() å’Œ Object#equals() æœ‰ä½•åŒºåˆ«"></a>3.4  String#equals() å’Œ Object#equals() æœ‰ä½•åŒºåˆ«</h4><p><code>String</code>Â ä¸­çš„Â <code>equals</code>Â æ–¹æ³•æ˜¯è¢«é‡å†™è¿‡çš„ï¼Œæ¯”è¾ƒçš„æ˜¯ String å­—ç¬¦ä¸²çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚Â <code>Object</code>Â çš„Â <code>equals</code>Â æ–¹æ³•æ˜¯æ¯”è¾ƒçš„å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</p><h4 id="3-5-å­—ç¬¦ä¸²å¸¸é‡æ± -ğŸ"><a href="#3-5-å­—ç¬¦ä¸²å¸¸é‡æ± -ğŸ" class="headerlink" title="3.5 å­—ç¬¦ä¸²å¸¸é‡æ±    ğŸ"></a>3.5 å­—ç¬¦ä¸²å¸¸é‡æ±    ğŸ</h4><p><strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong>Â æ˜¯ JVM ä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²ï¼ˆString ç±»ï¼‰ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»ºã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf">// åœ¨å †ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡â€abâ€œ<br>// å°†å­—ç¬¦ä¸²å¯¹è±¡â€abâ€œçš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­<br>String aa <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ab&quot;</span><span class="hljs-comment">;</span><br>// ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€abâ€œçš„å¼•ç”¨<br>String bb <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ab&quot;</span><span class="hljs-comment">;</span><br>System.out.println(aa<span class="hljs-operator">=</span><span class="hljs-operator">=</span>bb)<span class="hljs-comment">;// true</span><br></code></pre></td></tr></table></figure><blockquote><p>è¯´ä¸€ä¸‹å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨JVMä¸­çš„ä½ç½®</p></blockquote><p>å­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯è¢«å­˜æ”¾åœ¨æ–¹æ³•åŒºè¿™ä¸ªä½ç½®ï¼›æ–¹æ³•åŒº 1.7 ä¹‹å‰æ˜¯å«æ°¸ä¹…ä»£ï¼›1.8 ä¹‹åæ˜¯å«å…ƒç©ºé—´ï¼ˆå­˜æ”¾åœ¨æœ¬åœ°å†…å­˜ï¼‰</p><p>è¯´ä¸€ä¸‹ æ–¹æ³•åŒºå’Œ å †çš„åŒºåˆ«ï¼Œä¸»è¦è¯´ä¸€ä¸‹å­˜æ”¾å†…å®¹çš„å·®åˆ«ï¼š</p><ul><li>æ–¹æ³•åŒºï¼š<ul><li>å­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</li><li>æ–¹æ³•åŒºå­˜å‚¨ç±»ç»“æ„ï¼ˆå¦‚è¿è¡Œæ—¶å¸¸é‡æ± ã€å­—æ®µã€æ–¹æ³•æ•°æ®ï¼‰ç­‰ã€‚</li></ul></li><li>å †ï¼šå­˜å‚¨å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ï¼Œæ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œä¹Ÿæ˜¯Javaåº”ç”¨æœ€å¤§çš„å†…å­˜æ¶ˆè€—åŒºåŸŸã€‚</li></ul><hr><p>æœ€è¿‘ä¹Ÿçœ‹åˆ°äº†å­—ç¬¦ä¸²å¸¸é‡æ± çš„ç›¸å…³æ¦‚å¿µï¼Œé€šè¿‡ç›´æ¥èµ‹å€¼çš„æ–¹å¼åˆ›å»ºçš„Stirng å­—ç¬¦ä¸²æ˜¯å­˜æ”¾åœ¨äº†å¸¸é‡æ± çš„ä½ç½®ï¼›</p><p>è€Œé€šè¿‡ new çš„æ–¹å¼æ˜¯æ”¾åˆ°äº† å †å†…å­˜ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// ç¤ºä¾‹ï¼šStringçš„åˆ›å»ºæ–¹å¼</span><br><span class="hljs-built_in">String</span> s1 = <span class="hljs-string">&quot;a&quot;</span>;  <span class="hljs-comment">// å­—ç¬¦ä¸²å¸¸é‡æ± </span><br><span class="hljs-built_in">String</span> s2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(<span class="hljs-string">&quot;a&quot;</span>);  <span class="hljs-comment">// å †å†…å­˜</span><br></code></pre></td></tr></table></figure><p>å½“æ‚¨åœ¨Javaä¸­ä½¿ç”¨<code>String s = &quot;a&quot;;</code>å’Œ<code>String s = new String(&quot;a&quot;);</code>è¿™ä¸¤ç§æ–¹å¼åˆ›å»ºå­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä»¬åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼ä¸åŒã€‚</p><ol><li><strong><code>String s = &quot;a&quot;;</code></strong>:<ul><li>è¿™ç§æ–¹å¼åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡å­˜å‚¨åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚</li><li>å­—ç¬¦ä¸²å¸¸é‡æ± ä½äºJavaå †å†…å­˜ä¸­ï¼Œä½†å®ƒæ˜¯ä¸€å—ç‰¹æ®Šçš„å­˜å‚¨åŒºåŸŸï¼Œä¸“é—¨ç”¨äºå­˜æ”¾å­—ç¬¦ä¸²å¸¸é‡ã€‚</li><li>å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± å·²ç»åŒ…å«äº†ä¸€ä¸ªç­‰äº<code>&quot;a&quot;</code>çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆ<code>s1</code>å°†æŒ‡å‘è¿™ä¸ªå·²å­˜åœ¨çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚</li></ul></li><li><strong><code>String s = new String(&quot;a&quot;);</code></strong>:<ul><li>è¿™ç§æ–¹å¼åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡å­˜å‚¨åœ¨å †å†…å­˜ä¸­ã€‚</li><li>ä½¿ç”¨<code>new</code>å…³é”®å­—ä¼šå¼ºåˆ¶åœ¨å †å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„<code>String</code>å¯¹è±¡ï¼Œå³ä½¿å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²ã€‚</li><li>è¿™æ„å‘³ç€å³ä½¿å†…å®¹ç›¸åŒï¼Œ<code>s2</code>ä¹Ÿæ˜¯ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚</li></ul></li></ol><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡çš„æ–¹å¼ï¼ˆå¦‚<code>&quot;a&quot;</code>ï¼‰ï¼Œè¿™æ ·å¯ä»¥æ›´æœ‰æ•ˆåœ°åˆ©ç”¨Javaçš„å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œæé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜å¼€é”€ã€‚ä½¿ç”¨<code>new String(&quot;a&quot;)</code>çš„æ–¹å¼ä¸»è¦åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œå½“ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªä¸å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å†…å®¹ç›¸åŒä½†æ˜¯ç‹¬ç«‹çš„å¯¹è±¡æ—¶ã€‚</p><h4 id="3-6-String-s1-new-String-â€œabcâ€-è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡-ğŸ•"><a href="#3-6-String-s1-new-String-â€œabcâ€-è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡-ğŸ•" class="headerlink" title="3.6 String s1 &#x3D; new String(â€œabcâ€);è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡  ğŸ•"></a>3.6 String s1 &#x3D; new String(â€œabcâ€);è¿™å¥è¯åˆ›å»ºäº†å‡ ä¸ªå­—ç¬¦ä¸²å¯¹è±¡  ğŸ•</h4><p>ä¼šåˆ›å»º 1 æˆ– 2 ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚</p><p>to be continedâ€¦</p><h4 id="3-7-intern-æ–¹æ³•"><a href="#3-7-intern-æ–¹æ³•" class="headerlink" title="3.7 intern æ–¹æ³•"></a>3.7 intern æ–¹æ³•</h4><p><code>String.intern()</code>Â æ˜¯ä¸€ä¸ª nativeï¼ˆæœ¬åœ°ï¼‰æ–¹æ³•ï¼Œå…¶ä½œç”¨æ˜¯å°†æŒ‡å®šçš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­</p><p>to be continedâ€¦</p><h4 id="3-8-String-ç±»å‹çš„å˜é‡å’Œå¸¸é‡åšâ€œ-â€è¿ç®—æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ"><a href="#3-8-String-ç±»å‹çš„å˜é‡å’Œå¸¸é‡åšâ€œ-â€è¿ç®—æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ" class="headerlink" title="3.8 String ç±»å‹çš„å˜é‡å’Œå¸¸é‡åšâ€œ+â€è¿ç®—æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ"></a>3.8 String ç±»å‹çš„å˜é‡å’Œå¸¸é‡åšâ€œ+â€è¿ç®—æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ</h4><p>to be continedâ€¦</p><h4 id="3-9-ç¼–ç è½¬æ¢"><a href="#3-9-ç¼–ç è½¬æ¢" class="headerlink" title="3.9  ç¼–ç è½¬æ¢"></a>3.9  ç¼–ç è½¬æ¢</h4><p>å…ˆç›´æ¥çœ‹æ“ä½œç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-comment">// ç¤ºä¾‹ï¼šStringå­—ç¬¦ä¸²çš„ç¼–ç è½¬æ¢</span><br><span class="hljs-keyword">String</span> originalStr = <span class="hljs-string">&quot;Hello, ä¸–ç•Œ&quot;</span>;  <span class="hljs-comment">// å‡è®¾è¿™æ˜¯UTF-8ç¼–ç çš„å­—ç¬¦ä¸²</span><br>byte[] bytes;<br><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// å°†å­—ç¬¦ä¸²ä»UTF-8è½¬æ¢ä¸ºISO-8859-1</span><br>    bytes = originalStr.getBytes(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>    <span class="hljs-keyword">String</span> <span class="hljs-keyword">new</span><span class="hljs-type">Str</span> = <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>(bytes, <span class="hljs-string">&quot;ISO-8859-1&quot;</span>);<br><br>    <span class="hljs-comment">// å°†å­—ç¬¦ä¸²ä»ISO-8859-1è½¬å›UTF-8</span><br>    bytes = <span class="hljs-keyword">new</span><span class="hljs-type">Str</span>.getBytes(<span class="hljs-string">&quot;ISO-8859-1&quot;</span>);<br>    <span class="hljs-keyword">String</span> finalStr = <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>(bytes, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>&#125; <span class="hljs-keyword">catch</span> (UnsupportedEncodingException e) &#123;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²ï¼ˆ<code>String</code>ï¼‰çš„ç¼–ç è½¬æ¢æ“ä½œæ­¥éª¤ï¼š</p><ul><li>å°†<code>String</code>è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„<ul><li>ä½¿ç”¨<code>String</code>çš„<code>getBytes(String charsetName)</code>æ–¹æ³•ï¼Œ<code>charsetName</code>æ˜¯ç›®æ ‡ç¼–ç æ ¼å¼ï¼Œå¦‚â€UTF-8â€ã€â€ISO-8859-1â€ç­‰</li></ul></li><li>ä»å­—èŠ‚æ•°ç»„é‡æ–°åˆ›å»º<code>String</code><ul><li>ä½¿ç”¨<code>new String(byte[] bytes, String charsetName)</code>æ„é€ å‡½æ•°</li></ul></li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„å­—ç¬¦éƒ½å¯ä»¥åœ¨ä¸åŒçš„ç¼–ç ä¹‹é—´æ— æŸè½¬æ¢ã€‚ä¾‹å¦‚ï¼Œå°†åŒ…å«ä¸­æ–‡å­—ç¬¦çš„å­—ç¬¦ä¸²ä»UTF-8è½¬æ¢ä¸ºISO-8859-1å¯èƒ½ä¼šä¸¢å¤±ä¿¡æ¯ï¼Œå› ä¸ºISO-8859-1ç¼–ç ä¸æ”¯æŒä¸­æ–‡å­—ç¬¦ã€‚å› æ­¤ï¼Œåœ¨è¿›è¡Œç¼–ç è½¬æ¢æ—¶ï¼Œåº”ç¡®ä¿ç›®æ ‡ç¼–ç èƒ½å¤Ÿæ”¯æŒæºå­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦ã€‚</p><p>æ­¤å¤–ï¼Œå¤„ç†ç¼–ç è½¬æ¢æ—¶è¿˜éœ€è¦æ³¨æ„<code>UnsupportedEncodingException</code>å¼‚å¸¸ï¼Œè¿™ç§å¼‚å¸¸ä¼šåœ¨æŒ‡å®šäº†ä¸æ”¯æŒçš„å­—ç¬¦é›†æ—¶æŠ›å‡ºã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”é€‚å½“å¤„ç†æˆ–æŠ›å‡ºè¿™ç§å¼‚å¸¸ã€‚</p><h4 id="3-10-å­—ç¬¦ä¸²å·¥å…·ç±»-StringUtils"><a href="#3-10-å­—ç¬¦ä¸²å·¥å…·ç±»-StringUtils" class="headerlink" title="3.10  å­—ç¬¦ä¸²å·¥å…·ç±» StringUtils"></a>3.10  å­—ç¬¦ä¸²å·¥å…·ç±» StringUtils</h4><blockquote><p>å­—ç¬¦ä¸²å·¥å…·ç±» isEmpty å’Œ isBlank çš„åŒºåˆ«</p></blockquote><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-comment">// ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²å·¥å…·ç±»ä¸­çš„ isEmpty å’Œ isBlank æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringUtils</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span>(<span class="hljs-built_in">String</span> <span class="hljs-built_in">str</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span> == <span class="hljs-literal">null</span> || <span class="hljs-built_in">str</span>.<span class="hljs-property">length</span>() == <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isBlank</span>(<span class="hljs-built_in">String</span> <span class="hljs-built_in">str</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span> == <span class="hljs-literal">null</span> || <span class="hljs-built_in">str</span>.<span class="hljs-property">trim</span>().<span class="hljs-property">length</span>() == <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>isEmpty æ–¹æ³•ä¼šæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸º null ä»¥åŠé•¿åº¦ä¸º 0 ;isEmpty(â€œ â€œ)  â†’  false</li><li>isBlank æ–¹æ³•ä¼šæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸º null ä»¥åŠæ˜¯å¦æ˜¯ç©ºå­—ç¬¦ä¸²; isBlank(â€œ â€œ)  â†’  true</li></ul><hr><h3 id="å››ã€å¸¸ç”¨API"><a href="#å››ã€å¸¸ç”¨API" class="headerlink" title="å››ã€å¸¸ç”¨API"></a>å››ã€å¸¸ç”¨API</h3><h4 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h4><p>æšä¸¾ç±»æ˜¯JDK1.5å¼•å…¥çš„ä¸€ä¸ªç±»å‹</p><p>å‚è€ƒï¼š </p><ul><li><a href="https://javaniuniu.com/java/enums/01">https://javaniuniu.com/java/enums/01</a></li><li><a href="https://blog.csdn.net/qq_27093465/article/details/52180865">https://blog.csdn.net/qq_27093465/article/details/52180865</a></li></ul><blockquote><p>æšä¸¾ç±»å¸¸é‡</p></blockquote><p>æšä¸¾æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„class, ç›¸å½“äºè¢« final staticä¿®é¥°ï¼Œæ˜¯ä¸èƒ½è¢«ç»§æ‰¿çš„ï¼›åŒæ—¶æ‰€æœ‰çš„æšä¸¾éƒ½ç»§æ‰¿è‡ªjava.lang.Enumç±»ï¼Œ<br>ç”±äºJava ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œæ‰€ä»¥æšä¸¾å¯¹è±¡ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»çš„</p><p>æœ€ç®€å•çš„ä½¿ç”¨æ–¹æ³•æ˜¯æŠŠç›¸å…³çš„å¸¸é‡åˆ†ç»„åˆ°ä¸€ä¸ªæšä¸¾ç±»å‹é‡Œï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> Color &#123;  <br>  RED, GREEN, <span class="hljs-keyword">BLANK</span>, YELLOW  <br>&#125; <br></code></pre></td></tr></table></figure><p>åŒæ—¶ switch  æ˜¯æ”¯æŒ æšä¸¾ç±»å‹çš„å‚æ•°çš„ï¼Œä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„ç”¨æ³•ï¼›</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹å‘æšä¸¾ä¸­æ·»åŠ æ–°æ–¹æ³•ç­‰ç”¨æ³•ï¼Œè¦†ç›–æšä¸¾æ–¹æ³•ç­‰æ“ä½œã€‚</p><p>to be continedâ€¦</p><p>å†™æ³•è§„èŒƒå»ºè®®ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401311026670.png" alt="image.png"></p><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/java/basis/java-basic-questions-02.html">https://javaguide.cn/java/basis/java-basic-questions-02.html</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%93%88%E5%B8%8C%E8%A1%A8">https://zh.wikipedia.org/wiki/%E5%93%88%E5%B8%8C%E8%A1%A8</a></li><li><a href="https://www.cnblogs.com/Steven-HU/p/14505316.html">https://www.cnblogs.com/Steven-HU/p/14505316.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>Base</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaåŸºç¡€_åŸºç¡€å†…å®¹01</title>
    <link href="/2024/01/07/Java%E5%9F%BA%E7%A1%80_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B901/"/>
    <url>/2024/01/07/Java%E5%9F%BA%E7%A1%80_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B901/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€åŸºç¡€æ¦‚å¿µå’Œå¸¸è¯†"><a href="#ä¸€ã€åŸºç¡€æ¦‚å¿µå’Œå¸¸è¯†" class="headerlink" title="ä¸€ã€åŸºç¡€æ¦‚å¿µå’Œå¸¸è¯†"></a>ä¸€ã€åŸºç¡€æ¦‚å¿µå’Œå¸¸è¯†</h3><h4 id="1-1ã€Javaè¯­è¨€çš„ç‰¹ç‚¹"><a href="#1-1ã€Javaè¯­è¨€çš„ç‰¹ç‚¹" class="headerlink" title="1.1ã€Javaè¯­è¨€çš„ç‰¹ç‚¹"></a>1.1ã€Javaè¯­è¨€çš„ç‰¹ç‚¹</h4><p>æ¯”è¾ƒå¤šçš„ç‰¹ç‚¹ï¼Œç›®å‰ Java ä¸­åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­çœŸæ­£å¼ºå¤§çš„æ˜¯Java çš„ç”Ÿæ€ï¼›</p><p>ä¸”æŠ€æœ¯æ˜¯æœåŠ¡äºä¸šåŠ¡çš„ï¼Œå°±ä¸šç‡å’Œä½¿ç”¨ç‡åœ¨å›½å†…å æ¯”è¾ƒå¤§ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>å¹³å°æ— å…³æ€§</li><li>é¢å‘å¯¹è±¡ï¼ˆå°è£…ã€ç»§æ‰¿ã€å¤šæ€ï¼‰</li><li>æ”¯æŒå¤šçº¿ç¨‹</li><li>å¯é æ€§</li><li>å®‰å…¨æ€§</li><li>â€¦â€¦</li></ul><h4 id="1-2ã€Java-SE-vs-Java-EE"><a href="#1-2ã€Java-SE-vs-Java-EE" class="headerlink" title="1.2ã€Java SE  vs Java EE"></a>1.2ã€Java SE  vs Java EE</h4><p>Java SE ï¼ˆJava Platformï¼ŒStandard Editionï¼‰ æ˜¯ Java çš„åŸºç¡€ç‰ˆæœ¬ï¼ŒJava EE  ï¼ˆJava Platform, Enterprise Edition ï¼‰æ˜¯ Java çš„é«˜çº§ç‰ˆæœ¬ã€‚</p><blockquote><p>åŸºæœ¬ä»‹ç»ï¼š</p></blockquote><p>Java SEæ˜¯Javaç¼–ç¨‹è¯­è¨€çš„æ ‡å‡†ç‰ˆï¼Œå®ƒæä¾›äº†Javaè¯­è¨€çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><strong>åŸºæœ¬è¯­è¨€ç‰¹æ€§</strong>ï¼šå¦‚å˜é‡ã€æ•°ç»„ã€å¾ªç¯ã€æ¡ä»¶è¯­å¥ç­‰ã€‚</li><li><strong>æ ¸å¿ƒç±»åº“</strong>ï¼šæä¾›äº†åŸºç¡€çš„ç±»åº“ï¼ŒåŒ…æ‹¬æ•°æ®ç±»å‹ã€æ•°å­¦å‡½æ•°ã€æ–‡ä»¶å¤„ç†ã€ç½‘ç»œç¼–ç¨‹ã€å¹¶å‘ç¼–ç¨‹ç­‰ã€‚</li><li><strong>å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰</strong>: å¦‚AWTï¼ˆAbstract Window Toolkitï¼‰å’ŒSwingã€‚</li><li><strong>Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰</strong>: Javaç¨‹åºçš„è¿è¡Œç¯å¢ƒã€‚</li><li><strong>å·¥å…·</strong>: å¦‚ç¼–è¯‘å™¨ï¼ˆjavacï¼‰ï¼Œè§£é‡Šå™¨ï¼ˆjavaï¼‰ï¼Œæ‰“åŒ…å·¥å…·ï¼ˆjarï¼‰ç­‰ã€‚</li></ul><p>Java EEæ˜¯Javaçš„ä¼ä¸šç‰ˆï¼Œå®ƒåœ¨Java SEçš„åŸºç¡€ä¸Šå¢åŠ äº†ç”¨äºæ„å»ºå¤§å‹ä¼ä¸šçº§åº”ç”¨çš„åŠŸèƒ½ã€‚Java EEåŒ…æ‹¬ï¼š</p><ul><li><strong>æ‰©å±•çš„ç±»åº“</strong>: åœ¨Java SEçš„åŸºç¡€ä¸Šæä¾›äº†é¢å¤–çš„ç±»åº“å’ŒAPIï¼Œç”¨äºä¼ä¸šçº§åº”ç”¨å¼€å‘ã€‚</li><li><strong>æœåŠ¡å™¨ç«¯æŠ€æœ¯</strong>: å¦‚Servletsã€JavaServer Pagesï¼ˆJSPï¼‰ã€Enterprise JavaBeansï¼ˆEJBï¼‰ç­‰ã€‚</li><li><strong>WebæœåŠ¡</strong>: æ”¯æŒåˆ›å»ºå’Œæ¶ˆè´¹WebæœåŠ¡ã€‚</li><li><strong>æŒä¹…åŒ–API</strong>: å¦‚Java Persistence APIï¼ˆJPAï¼‰ã€‚</li><li><strong>åˆ†å¸ƒå¼è®¡ç®—</strong>: æ”¯æŒæ„å»ºå¤§å‹ã€åˆ†å¸ƒå¼çš„å¤šå±‚åº”ç”¨ã€‚</li><li><strong>é›†æˆæŠ€æœ¯</strong>: å¦‚JMSï¼ˆJava Message Serviceï¼‰å’ŒJavaMailã€‚</li></ul><blockquote><p>æ€»ç»“</p></blockquote><ul><li><strong>Java SE</strong> æä¾›äº†Javaè¯­è¨€çš„åŸºç¡€ï¼Œæ›´é€‚åˆå¼€å‘æ¡Œé¢åº”ç”¨ç¨‹åºæˆ–ç®€å•çš„æœåŠ¡å™¨åº”ç”¨ç¨‹åº</li><li><strong>Java EE</strong> åœ¨Java SEçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¼ä¸šçº§ç‰¹æ€§ï¼Œæ›´é€‚åˆå¼€å‘å¤æ‚çš„ä¼ä¸šçº§åº”ç”¨ç¨‹åºæˆ– Web åº”ç”¨ç¨‹åº</li></ul><h4 id="1-3ã€JVM-vs-JDK-vs-JRE"><a href="#1-3ã€JVM-vs-JDK-vs-JRE" class="headerlink" title="1.3ã€JVM vs JDK  vs  JRE"></a>1.3ã€JVM vs JDK  vs  JRE</h4><ul><li>Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰æ˜¯è¿è¡Œ Java å­—èŠ‚ç çš„è™šæ‹Ÿæœº</li><li>JDK ï¼ˆJava Development Kitï¼‰æ˜¯å®Œæ•´çš„Javaè½¯ä»¶å¼€å‘å·¥å…·åŒ…</li><li>JREï¼ˆJava Runtime Environmentï¼‰ æ˜¯ Java è¿è¡Œæ—¶ç¯å¢ƒ</li></ul><p>JDK &gt;  JRE  &gt;  JVM</p><p>å…³ç³»å¯ä»¥çœ‹è¿™å¼ å›¾ï¼š<br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401081433625.png" alt="image.png"></p><hr><p><strong>JVM å¹¶ä¸æ˜¯åªæœ‰ä¸€ç§ï¼åªè¦æ»¡è¶³ JVM è§„èŒƒï¼Œæ¯ä¸ªå…¬å¸ã€ç»„ç»‡æˆ–è€…ä¸ªäººéƒ½å¯ä»¥å¼€å‘è‡ªå·±çš„ä¸“å± JVMã€‚</strong> </p><p>æˆ‘ä»¬å¹³æ—¶æ¥è§¦åˆ°çš„ HotSpot VM ä»…ä»…æ˜¯æ˜¯ JVM è§„èŒƒçš„ä¸€ç§å®ç°ã€‚</p><p>é™¤äº†æˆ‘ä»¬å¹³æ—¶æœ€å¸¸ç”¨çš„ HotSpot VM å¤–ï¼Œè¿˜æœ‰ J9 VMã€Zing VMã€JRockit VM ç­‰ JVM ã€‚</p><p>JDKï¼ˆJava Development Kitï¼‰ï¼Œå®ƒæ˜¯åŠŸèƒ½é½å…¨çš„ Java SDKï¼Œæ˜¯æä¾›ç»™å¼€å‘è€…ä½¿ç”¨ï¼Œèƒ½å¤Ÿåˆ›å»ºå’Œç¼–è¯‘ Java ç¨‹åºçš„å¼€å‘å¥—ä»¶ã€‚å®ƒåŒ…å«äº† JREï¼ŒåŒæ—¶è¿˜åŒ…å«äº†ç¼–è¯‘ java æºç çš„ç¼–è¯‘å™¨ javac ä»¥åŠä¸€äº›å…¶ä»–å·¥å…·æ¯”å¦‚ javadocï¼ˆæ–‡æ¡£æ³¨é‡Šå·¥å…·ï¼‰ã€jdbï¼ˆè°ƒè¯•å™¨ï¼‰ã€jconsoleï¼ˆåŸºäº JMX çš„å¯è§†åŒ–ç›‘æ§â¼¯å…·ï¼‰ã€javapï¼ˆåç¼–è¯‘å·¥å…·ï¼‰ç­‰ç­‰ã€‚</p><p>JREï¼ˆJava Runtime Environmentï¼‰ æ˜¯ Java è¿è¡Œæ—¶ç¯å¢ƒã€‚å®ƒæ˜¯è¿è¡Œå·²ç¼–è¯‘ Java ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰å†…å®¹çš„é›†åˆï¼Œä¸»è¦åŒ…æ‹¬ Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰ã€Java åŸºç¡€ç±»åº“ï¼ˆClass Libraryï¼‰ã€‚</p><h4 id="1-4ã€JIT"><a href="#1-4ã€JIT" class="headerlink" title="1.4ã€JIT"></a>1.4ã€JIT</h4><p>ç•¥</p><h4 id="1-5ã€ç¼–è¯‘ä¸è§£é‡Š"><a href="#1-5ã€ç¼–è¯‘ä¸è§£é‡Š" class="headerlink" title="1.5ã€ç¼–è¯‘ä¸è§£é‡Š"></a>1.5ã€ç¼–è¯‘ä¸è§£é‡Š</h4><p>é«˜çº§ç¼–ç¨‹è¯­è¨€æŒ‰ç…§ç¨‹åºçš„æ‰§è¡Œæ–¹å¼åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>ç¼–è¯‘å‹ï¼šç¼–è¯‘å‹è¯­è¨€open in new window ä¼šé€šè¿‡ç¼–è¯‘å™¨open in new windowå°†æºä»£ç ä¸€æ¬¡æ€§ç¿»è¯‘æˆå¯è¢«è¯¥å¹³å°æ‰§è¡Œçš„æœºå™¨ç ã€‚<ul><li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç¼–è¯‘è¯­è¨€çš„æ‰§è¡Œé€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œå¼€å‘æ•ˆç‡æ¯”è¾ƒä½ã€‚å¸¸è§çš„ç¼–è¯‘æ€§è¯­è¨€æœ‰ Cã€C++ã€Goã€Rust ç­‰ç­‰ã€‚</li></ul></li><li>è§£é‡Šå‹ï¼šè§£é‡Šå‹è¯­è¨€open in new windowä¼šé€šè¿‡è§£é‡Šå™¨open in new windowä¸€å¥ä¸€å¥çš„å°†ä»£ç è§£é‡Šï¼ˆinterpretï¼‰ä¸ºæœºå™¨ä»£ç åå†æ‰§è¡Œã€‚<ul><li>è§£é‡Šå‹è¯­è¨€å¼€å‘æ•ˆç‡æ¯”è¾ƒå¿«ï¼Œæ‰§è¡Œé€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚å¸¸è§çš„è§£é‡Šæ€§è¯­è¨€æœ‰ Pythonã€JavaScriptã€PHP ç­‰ç­‰</li></ul></li></ul><blockquote><p>ä¸ºä»€ä¹ˆè¯´ Java è¯­è¨€â€œç¼–è¯‘ä¸è§£é‡Šå¹¶å­˜â€ï¼Ÿ  â†’   å…ˆç¼–è¯‘ åè§£é‡Š</p></blockquote><p>è¿™æ˜¯å› ä¸º Java è¯­è¨€æ—¢å…·æœ‰ç¼–è¯‘å‹è¯­è¨€çš„ç‰¹å¾ï¼Œä¹Ÿå…·æœ‰è§£é‡Šå‹è¯­è¨€çš„ç‰¹å¾ã€‚</p><p>å› ä¸º Java ç¨‹åºè¦ç»è¿‡å…ˆç¼–è¯‘ï¼Œåè§£é‡Šä¸¤ä¸ªæ­¥éª¤ï¼Œç”± Java ç¼–å†™çš„ç¨‹åºéœ€è¦å…ˆç»è¿‡ç¼–è¯‘æ­¥éª¤ï¼Œç”Ÿæˆå­—èŠ‚ç ï¼ˆ.class æ–‡ä»¶ï¼‰ï¼Œè¿™ç§å­—èŠ‚ç å¿…é¡»ç”± Java è§£é‡Šå™¨æ¥è§£é‡Šæ‰§è¡Œã€‚</p><h4 id="1-6ã€AOT"><a href="#1-6ã€AOT" class="headerlink" title="1.6ã€AOT"></a>1.6ã€AOT</h4><p>ç•¥</p><h4 id="1-7ã€Oracle-JDK-vs-OpenJDK"><a href="#1-7ã€Oracle-JDK-vs-OpenJDK" class="headerlink" title="1.7ã€Oracle JDK vs OpenJDK"></a>1.7ã€Oracle JDK vs OpenJDK</h4><p>JDK åŸæ¥æ˜¯ SUN å…¬å¸å¼€å‘çš„ï¼Œåæ¥ SUN å…¬å¸åˆå–ç»™äº† Oracle å…¬å¸;  åŸæ¥çš„ SUN å…¬å¸æŠŠ JDK ç»™å¼€æºäº†ï¼› Oracle å…¬å¸å°±ç±»ä¼¼å¼€äº†ä¸€ä¸ªåˆ†æ”¯ï¼Œåšäº†ä¸€ä¸ªé—­æºç‰ˆæœ¬ã€‚</p><blockquote><p>åŒºåˆ«ï¼š</p></blockquote><p> OpenJDK</p><ol><li><strong>å¼€æº</strong>ï¼šOpenJDKæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„Java SEå¹³å°å®ç°ï¼Œå®ƒæ˜¯è‡ªç”±è½¯ä»¶å¹¶ä¸”å…¬å¼€å‘å¸ƒã€‚å®ƒæ˜¯Oracle JDKçš„åŸºç¡€ã€‚</li><li><strong>ç¤¾åŒºé©±åŠ¨</strong>ï¼šç”±å¼€æºç¤¾åŒºç»´æŠ¤å’Œæ›´æ–°ã€‚å®ƒé€šå¸¸æ˜¯æœ€å…ˆè·å¾—æœ€æ–°è¯­è¨€ç‰¹æ€§å’Œä¿®å¤çš„ç‰ˆæœ¬ã€‚</li><li><strong>è®¸å¯è¯</strong>ï¼šä½¿ç”¨GPLï¼ˆé€šç”¨å…¬å…±è®¸å¯è¯ï¼‰v2è®¸å¯è¯ï¼Œå¸¦æœ‰Classpathä¾‹å¤–ï¼Œå…è®¸ä¸å—GPLé™åˆ¶åœ°ä½¿ç”¨ç±»åº“ã€‚</li><li><strong>æ›´æ–°</strong>ï¼šé€šå¸¸æ›´åŠ é¢‘ç¹åœ°è·å¾—æ›´æ–°å’Œè¡¥ä¸ã€‚</li><li><strong>å¹¿æ³›ä½¿ç”¨</strong>ï¼šç”±äºå…¶å¼€æºæ€§è´¨ï¼Œè¢«å¹¿æ³›ç”¨äºå„ç§ç¯å¢ƒï¼ŒåŒ…æ‹¬å•†ä¸šåº”ç”¨ã€‚</li></ol><p>Oracle JDK</p><ol><li><strong>Oracleå®˜æ–¹ç‰ˆæœ¬</strong>ï¼šOracle JDKæ˜¯ç”±Oracleå…¬å¸æä¾›çš„Java SEå¹³å°çš„å®˜æ–¹å®ç°ã€‚å®ƒåŸºäºOpenJDKï¼Œå¹¶åŒ…å«äº†ä¸€äº›é™„åŠ ç»„ä»¶ã€‚</li><li><strong>å•†ä¸šç”¨é€”è®¸å¯è´¹</strong>ï¼šOracle JDKçš„æ—©æœŸç‰ˆæœ¬å…è´¹ç”¨äºä¸ªäººå’Œå¼€å‘ç”¨é€”ï¼Œä½†ä»JDK 11å¼€å§‹ï¼ŒOracleæ›´æ”¹äº†è®¸å¯ç­–ç•¥ï¼Œå¯¹äºå•†ä¸šç”¨é€”æˆ–ç”Ÿäº§ç¯å¢ƒä¸­çš„ä½¿ç”¨éœ€è¦ä»˜è´¹ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–å’Œé™„åŠ ç‰¹æ€§</strong>ï¼šOracle JDKå¯èƒ½åŒ…æ‹¬ä¸€äº›ä¸“æœ‰çš„æ€§èƒ½å¢å¼ºå’Œå…¶ä»–ç‰¹æ€§ï¼Œå¦‚JRockitæˆ–Mission Controlã€‚</li><li><strong>æ”¯æŒ</strong>ï¼šOracleæä¾›ä¸“ä¸šçš„é•¿æœŸæ”¯æŒæœåŠ¡ï¼Œé€‚åˆä¼ä¸šç”¨æˆ·ã€‚</li><li><strong>æ›´æ–°é¢‘ç‡</strong>ï¼šOracle JDKçš„æ›´æ–°å¯èƒ½ä¸å¦‚OpenJDKé¢‘ç¹ï¼Œä½†æ›´ç¨³å®šï¼Œç»è¿‡äº†æ›´ä¸¥æ ¼çš„æµ‹è¯•ã€‚</li></ol><blockquote><p>æ€»ç»“</p></blockquote><ul><li><strong>OpenJDK</strong> æ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºçš„JDKç‰ˆæœ¬ï¼Œé€‚ç”¨äºéœ€è¦å…è´¹ã€å¼€æºè§£å†³æ–¹æ¡ˆçš„åœºæ™¯ã€‚</li><li><strong>Oracle JDK</strong> æä¾›äº†ä¸€äº›é™„åŠ ç‰¹æ€§å’Œä¸“ä¸šæ”¯æŒï¼Œé€‚ç”¨äºéœ€è¦ç¨³å®šæ”¯æŒå’Œä¼ä¸šçº§ç‰¹æ€§çš„å•†ä¸šåº”ç”¨ã€‚</li></ul><h4 id="1-8ã€Java-å’Œ-C-çš„åŒºåˆ«"><a href="#1-8ã€Java-å’Œ-C-çš„åŒºåˆ«" class="headerlink" title="1.8ã€Java å’Œ C++ çš„åŒºåˆ«?"></a>1.8ã€Java å’Œ C++ çš„åŒºåˆ«?</h4><p>ç¨å¾®è®°ä¸€ä¸‹ã€‚</p><p>è™½ç„¶ï¼ŒJava å’Œ C++ éƒ½æ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œéƒ½æ”¯æŒå°è£…ã€ç»§æ‰¿å’Œå¤šæ€ï¼Œä½†æ˜¯ï¼Œå®ƒä»¬è¿˜æ˜¯æœ‰æŒºå¤šä¸ç›¸åŒçš„åœ°æ–¹ï¼š</p><ul><li>Java ä¸æä¾›æŒ‡é’ˆæ¥ç›´æ¥è®¿é—®å†…å­˜ï¼Œç¨‹åºå†…å­˜æ›´åŠ å®‰å…¨</li><li>Java çš„ç±»æ˜¯å•ç»§æ‰¿çš„ï¼ŒC++ æ”¯æŒå¤šé‡ç»§æ‰¿ï¼›è™½ç„¶ Java çš„ç±»ä¸å¯ä»¥å¤šç»§æ‰¿ï¼Œä½†æ˜¯æ¥å£å¯ä»¥å¤šç»§æ‰¿ã€‚</li><li>Java æœ‰è‡ªåŠ¨å†…å­˜ç®¡ç†åƒåœ¾å›æ”¶æœºåˆ¶(GC)ï¼Œä¸éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨é‡Šæ”¾æ— ç”¨å†…å­˜ã€‚</li><li>C ++åŒæ—¶æ”¯æŒæ–¹æ³•é‡è½½å’Œæ“ä½œç¬¦é‡è½½ï¼Œä½†æ˜¯ Java åªæ”¯æŒæ–¹æ³•é‡è½½ï¼ˆæ“ä½œç¬¦é‡è½½å¢åŠ äº†å¤æ‚æ€§ï¼Œè¿™ä¸ Java æœ€åˆçš„è®¾è®¡æ€æƒ³ä¸ç¬¦ï¼‰</li><li>â€¦â€¦.</li></ul><h3 id="äºŒã€åŸºæœ¬è¯­æ³•"><a href="#äºŒã€åŸºæœ¬è¯­æ³•" class="headerlink" title="äºŒã€åŸºæœ¬è¯­æ³•"></a>äºŒã€åŸºæœ¬è¯­æ³•</h3><h4 id="2-1-æ³¨é‡Š"><a href="#2-1-æ³¨é‡Š" class="headerlink" title="2.1 æ³¨é‡Š"></a>2.1 æ³¨é‡Š</h4><ol><li><strong>å•è¡Œæ³¨é‡Š</strong>ï¼šé€šå¸¸ç”¨äºè§£é‡Šæ–¹æ³•å†…æŸå•è¡Œä»£ç çš„ä½œç”¨ã€‚</li><li><strong>å¤šè¡Œæ³¨é‡Š</strong>ï¼šé€šå¸¸ç”¨äºè§£é‡Šä¸€æ®µä»£ç çš„ä½œç”¨ã€‚</li><li><strong>æ–‡æ¡£æ³¨é‡Š</strong>ï¼šé€šå¸¸ç”¨äºç”Ÿæˆ Java å¼€å‘æ–‡æ¡£ã€‚</li></ol><h4 id="2-2-æ ‡è¯†ç¬¦å’Œå…³é”®å­—"><a href="#2-2-æ ‡è¯†ç¬¦å’Œå…³é”®å­—" class="headerlink" title="2.2 æ ‡è¯†ç¬¦å’Œå…³é”®å­—"></a>2.2 æ ‡è¯†ç¬¦å’Œå…³é”®å­—</h4><p>åœ¨æˆ‘ä»¬ç¼–å†™ç¨‹åºçš„æ—¶å€™ï¼Œéœ€è¦å¤§é‡åœ°ä¸ºç¨‹åºã€ç±»ã€å˜é‡ã€æ–¹æ³•ç­‰å–åå­—ï¼Œäºæ˜¯å°±æœ‰äº† <strong>æ ‡è¯†ç¬¦</strong> ã€‚ç®€å•æ¥è¯´ï¼Œ <strong>æ ‡è¯†ç¬¦å°±æ˜¯ä¸€ä¸ªåå­—</strong> ã€‚</p><p>æœ‰ä¸€äº›æ ‡è¯†ç¬¦ï¼ŒJava è¯­è¨€å·²ç»èµ‹äºˆäº†å…¶ç‰¹æ®Šçš„å«ä¹‰ï¼Œåªèƒ½ç”¨äºç‰¹å®šçš„åœ°æ–¹ï¼Œè¿™äº›ç‰¹æ®Šçš„æ ‡è¯†ç¬¦å°±æ˜¯ <strong>å…³é”®å­—</strong> ã€‚ç®€å•æ¥è¯´ï¼Œ<strong>å…³é”®å­—æ˜¯è¢«èµ‹äºˆç‰¹æ®Šå«ä¹‰çš„æ ‡è¯†ç¬¦</strong> ã€‚</p><blockquote><p>å…³é”®å­—</p></blockquote><table><thead><tr><th>åˆ†ç±»</th><th>å…³é”®å­—</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>è®¿é—®æ§åˆ¶</td><td>private</td><td>protected</td><td>public</td><td></td><td></td><td></td><td></td></tr><tr><td>ç±»ï¼Œæ–¹æ³•å’Œå˜é‡ä¿®é¥°ç¬¦</td><td>abstract</td><td>class</td><td>extends</td><td>final</td><td>implements</td><td>interface</td><td>native</td></tr><tr><td></td><td>new</td><td>static</td><td>strictfp</td><td>synchronized</td><td>transient</td><td>volatile</td><td>enum</td></tr><tr><td>ç¨‹åºæ§åˆ¶</td><td>break</td><td>continue</td><td>return</td><td>do</td><td>while</td><td>if</td><td>else</td></tr><tr><td></td><td>for</td><td>instanceof</td><td>switch</td><td>case</td><td>default</td><td>assert</td><td></td></tr><tr><td>é”™è¯¯å¤„ç†</td><td>try</td><td>catch</td><td>throw</td><td>throws</td><td>finally</td><td></td><td></td></tr><tr><td>åŒ…ç›¸å…³</td><td>import</td><td>package</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>åŸºæœ¬ç±»å‹</td><td>boolean</td><td>byte</td><td>char</td><td>double</td><td>float</td><td>int</td><td>long</td></tr><tr><td></td><td>short</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>å˜é‡å¼•ç”¨</td><td>super</td><td>this</td><td>void</td><td></td><td></td><td></td><td></td></tr><tr><td>ä¿ç•™å­—</td><td>goto</td><td>const</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><blockquote><p>Tipsï¼šæ‰€æœ‰çš„å…³é”®å­—éƒ½æ˜¯å°å†™çš„ï¼Œåœ¨ IDE ä¸­ä¼šä»¥ç‰¹æ®Šé¢œè‰²æ˜¾ç¤ºã€‚</p><p><code>default</code> è¿™ä¸ªå…³é”®å­—å¾ˆç‰¹æ®Šï¼Œæ—¢å±äºç¨‹åºæ§åˆ¶ï¼Œä¹Ÿå±äºç±»ï¼Œæ–¹æ³•å’Œå˜é‡ä¿®é¥°ç¬¦ï¼Œè¿˜å±äºè®¿é—®æ§åˆ¶ã€‚</p></blockquote><ul><li>åœ¨ç¨‹åºæ§åˆ¶ä¸­ï¼Œå½“åœ¨ <code>switch</code> ä¸­åŒ¹é…ä¸åˆ°ä»»ä½•æƒ…å†µæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>default</code> æ¥ç¼–å†™é»˜è®¤åŒ¹é…çš„æƒ…å†µã€‚</li><li>åœ¨ç±»ï¼Œæ–¹æ³•å’Œå˜é‡ä¿®é¥°ç¬¦ä¸­ï¼Œä» JDK8 å¼€å§‹å¼•å…¥äº†é»˜è®¤æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ <code>default</code> å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªæ–¹æ³•çš„é»˜è®¤å®ç°ã€‚</li><li>åœ¨è®¿é—®æ§åˆ¶ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•å‰æ²¡æœ‰ä»»ä½•ä¿®é¥°ç¬¦ï¼Œåˆ™é»˜è®¤ä¼šæœ‰ä¸€ä¸ªä¿®é¥°ç¬¦ <code>default</code>ï¼Œä½†æ˜¯è¿™ä¸ªä¿®é¥°ç¬¦åŠ ä¸Šäº†å°±ä¼šæŠ¥é”™ã€‚</li></ul><p>âš ï¸ æ³¨æ„ï¼šè™½ç„¶ <code>true</code>, <code>false</code>, å’Œ <code>null</code> çœ‹èµ·æ¥åƒå…³é”®å­—ä½†å®é™…ä¸Šä»–ä»¬æ˜¯å­—é¢å€¼ï¼ŒåŒæ—¶ä½ ä¹Ÿä¸å¯ä»¥ä½œä¸ºæ ‡è¯†ç¬¦æ¥ä½¿ç”¨ã€‚</p><h4 id="2-3-è‡ªå¢è‡ªå‡è¿ç®—ç¬¦"><a href="#2-3-è‡ªå¢è‡ªå‡è¿ç®—ç¬¦" class="headerlink" title="2.3 è‡ªå¢è‡ªå‡è¿ç®—ç¬¦"></a>2.3 è‡ªå¢è‡ªå‡è¿ç®—ç¬¦</h4><div style="background-color: #ecf0f1; color: #34495e; padding: 15px; border: 2px solid #bdc3c7; border-radius: 5px;">  <strong>ç¬¦å·åœ¨å‰å°±å…ˆåŠ /å‡ï¼Œç¬¦å·åœ¨åå°±ååŠ /å‡</strong></div><p>Javaä¸­çš„è‡ªå¢ï¼ˆ<code>++</code>ï¼‰å’Œè‡ªå‡ï¼ˆ<code>--</code>ï¼‰è¿ç®—ç¬¦æ˜¯å¸¸ç”¨çš„ä¸€å…ƒè¿ç®—ç¬¦ï¼Œç”¨äºå¢åŠ æˆ–å‡å°‘å˜é‡çš„å€¼ã€‚</p><blockquote><p>è‡ªå¢è¿ç®—ç¬¦ï¼ˆ<code>++</code>ï¼‰</p></blockquote><p>è‡ªå¢è¿ç®—ç¬¦<code>++</code>ç”¨äºå°†å˜é‡çš„å€¼å¢åŠ 1ã€‚å®ƒæœ‰ä¸¤ç§å½¢å¼ï¼š</p><ol><li><p><strong>å‰ç¼€è‡ªå¢</strong>ï¼š<code>++var</code>ã€‚åœ¨è¡¨è¾¾å¼æ±‚å€¼ä¹‹å‰å¢åŠ å˜é‡çš„å€¼ã€‚</p><ul><li>ä¾‹å¦‚ï¼š</li><li><code>int a = 5; int b = ++a; // å…ˆå°†aå¢åŠ 1ï¼Œå˜æˆ6ï¼Œç„¶åå°†açš„å€¼èµ‹ç»™bï¼Œbä¹Ÿæ˜¯6</code></li></ul></li><li><p><strong>åç¼€è‡ªå¢</strong>ï¼š<code>var++</code>ã€‚åœ¨è¡¨è¾¾å¼æ±‚å€¼ä¹‹åå¢åŠ å˜é‡çš„å€¼ã€‚</p><ul><li>ä¾‹å¦‚ï¼š</li><li><code>int a = 5; int b = a++; // å…ˆå°†açš„å€¼èµ‹ç»™bï¼Œbæ˜¯5ï¼Œç„¶åaå¢åŠ 1ï¼Œå˜æˆ6</code></li></ul></li></ol><blockquote><p>è‡ªå‡è¿ç®—ç¬¦ï¼ˆ<code>--</code>ï¼‰</p></blockquote><p>è‡ªå‡è¿ç®—ç¬¦<code>--</code>ç”¨äºå°†å˜é‡çš„å€¼å‡å°‘1ã€‚å®ƒåŒæ ·æœ‰ä¸¤ç§å½¢å¼ï¼š</p><ol><li><p><strong>å‰ç¼€è‡ªå‡</strong>ï¼š<code>--var</code>ã€‚åœ¨è¡¨è¾¾å¼æ±‚å€¼ä¹‹å‰å‡å°‘å˜é‡çš„å€¼ã€‚</p><ul><li>ä¾‹å¦‚ï¼š</li><li><code>int a = 5; int b = --a; // å…ˆå°†aå‡å°‘1ï¼Œå˜æˆ4ï¼Œç„¶åå°†açš„å€¼èµ‹ç»™bï¼Œbä¹Ÿæ˜¯4</code></li></ul></li><li><p><strong>åç¼€è‡ªå‡</strong>ï¼š<code>var--</code>ã€‚åœ¨è¡¨è¾¾å¼æ±‚å€¼ä¹‹åå‡å°‘å˜é‡çš„å€¼ã€‚</p><ul><li>ä¾‹å¦‚ï¼š</li><li><code>int a = 5; int b = a--; // å…ˆå°†açš„å€¼èµ‹ç»™bï¼Œbæ˜¯5ï¼Œç„¶åaå‡å°‘1ï¼Œå˜æˆ4</code></li></ul></li></ol><blockquote><p>ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹</p></blockquote><ul><li>è¿™äº›è¿ç®—ç¬¦é€šå¸¸ç”¨åœ¨å¾ªç¯å’Œç®€å•çš„æ•°å€¼æ“ä½œä¸­ã€‚</li><li>é€‰æ‹©å‰ç¼€è¿˜æ˜¯åç¼€å½¢å¼å–å†³äºä½ å¸Œæœ›åœ¨è¡¨è¾¾å¼å…¶ä»–éƒ¨åˆ†ä½¿ç”¨å˜é‡çš„å“ªä¸ªå€¼ï¼ˆå¢åŠ æˆ–å‡å°‘å‰çš„å€¼ï¼Œè¿˜æ˜¯å¢åŠ æˆ–å‡å°‘åçš„å€¼ï¼‰ã€‚</li><li>åœ¨å•ç‹¬ä½¿ç”¨æ—¶ï¼ˆä¸ä½œä¸ºæ›´å¤§è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œå‰ç¼€å’Œåç¼€å½¢å¼çš„æ•ˆæœæ˜¯ç›¸åŒçš„ã€‚</li></ul><blockquote><p>è¿›é˜¶é—®é¢˜</p></blockquote><p>è€ƒè™‘ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">int i</span> = 1; <br><span class="hljs-attribute">int j</span> = i++ + ++i;<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ j çš„å€¼æ˜¯å¤šå°‘ï¼Ÿ</p><p><strong>åˆ†æï¼š</strong></p><p>ç»™å®šä»£ç åˆ†æ</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">int i</span> = 1; <br><span class="hljs-attribute">int j</span> = i++ + ++i;<br></code></pre></td></tr></table></figure><ol><li><strong>ç¬¬ä¸€ä¸ªæ“ä½œ - <code>i++</code></strong> (åç¼€è‡ªå¢): è¿™ä¸ªæ“ä½œé¦–å…ˆè¿”å›<code>i</code>çš„å½“å‰å€¼ï¼Œç„¶å<code>i</code>çš„å€¼å¢åŠ 1ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªè¡¨è¾¾å¼çš„è¿™ä¸€éƒ¨åˆ†ï¼Œ<code>i</code>çš„å€¼è¢«è§†ä¸º1ï¼Œä½†ä¹‹å<code>i</code>å˜æˆäº†2ã€‚</li><li><strong>ç¬¬äºŒä¸ªæ“ä½œ - <code>++i</code></strong> (å‰ç¼€è‡ªå¢): åœ¨æ‰§è¡Œè¿™ä¸ªæ“ä½œæ—¶ï¼Œ<code>i</code>å·²ç»æ˜¯2äº†ã€‚ç°åœ¨ï¼Œç”±äºæ˜¯å‰ç¼€è‡ªå¢ï¼Œ<code>i</code>é¦–å…ˆè¢«å¢åŠ 1ï¼Œå˜æˆ3ï¼Œç„¶åè¿™ä¸ªå€¼è¢«ç”¨äºè¡¨è¾¾å¼ã€‚æ‰€ä»¥ï¼Œè¿™ä¸€éƒ¨åˆ†çš„å€¼æ˜¯3ã€‚</li><li><strong>ç»“æœ</strong>: ç»“åˆè¿™ä¸¤éƒ¨åˆ†ï¼Œ<code>j = 1 + 3</code>ï¼Œæ‰€ä»¥<code>j</code>çš„æœ€ç»ˆå€¼æ˜¯4ã€‚</li></ol><p>å…³é”®ç‚¹</p><ul><li>åç¼€è‡ªå¢(<code>i++</code>)å…ˆè¿”å›å½“å‰å€¼ï¼Œç„¶åå¢åŠ ã€‚</li><li>å‰ç¼€è‡ªå¢(<code>++i</code>)å…ˆå¢åŠ ï¼Œç„¶åè¿”å›å¢åŠ åçš„å€¼ã€‚</li><li>åœ¨åŒ…å«å¤šä¸ªè‡ªå¢&#x2F;è‡ªå‡æ“ä½œçš„å¤åˆè¡¨è¾¾å¼ä¸­ï¼Œç†è§£æ±‚å€¼çš„é¡ºåºéå¸¸é‡è¦ã€‚</li></ul><h4 id="2-4-ç§»ä½è¿ç®—ç¬¦"><a href="#2-4-ç§»ä½è¿ç®—ç¬¦" class="headerlink" title="2.4 ç§»ä½è¿ç®—ç¬¦"></a>2.4 ç§»ä½è¿ç®—ç¬¦</h4><ul><li><code>&lt;&lt;</code> :å·¦ç§»è¿ç®—ç¬¦ï¼Œå‘å·¦ç§»è‹¥å¹²ä½ï¼Œé«˜ä½ä¸¢å¼ƒï¼Œä½ä½è¡¥é›¶ã€‚<code>x &lt;&lt; 1</code>,ç›¸å½“äº x ä¹˜ä»¥ 2(ä¸æº¢å‡ºçš„æƒ…å†µä¸‹)ã€‚</li><li><code>&gt;&gt;</code> :å¸¦ç¬¦å·å³ç§»ï¼Œå‘å³ç§»è‹¥å¹²ä½ï¼Œé«˜ä½è¡¥ç¬¦å·ä½ï¼Œä½ä½ä¸¢å¼ƒã€‚æ­£æ•°é«˜ä½è¡¥ 0,è´Ÿæ•°é«˜ä½è¡¥ 1ã€‚<code>x &gt;&gt; 1</code>,ç›¸å½“äº x é™¤ä»¥ 2ã€‚</li><li><code>&gt;&gt;&gt;</code> :æ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥ 0 è¡¥é½ã€‚</li></ul><h4 id="2-5-continueã€break-å’Œ-return-çš„åŒºåˆ«"><a href="#2-5-continueã€break-å’Œ-return-çš„åŒºåˆ«" class="headerlink" title="2.5 continueã€break å’Œ return çš„åŒºåˆ«"></a>2.5 continueã€break å’Œ return çš„åŒºåˆ«</h4><p>å…³é”®è¯ï¼š</p><ol><li><code>continue</code>ï¼šæŒ‡è·³å‡ºå½“å‰çš„è¿™ä¸€æ¬¡å¾ªç¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚</li><li><code>break</code>ï¼šæŒ‡è·³å‡ºæ•´ä¸ªå¾ªç¯ä½“ï¼Œç»§ç»­æ‰§è¡Œå¾ªç¯ä¸‹é¢çš„è¯­å¥ã€‚</li></ol><p><code>return</code> ç”¨äºè·³å‡ºæ‰€åœ¨æ–¹æ³•ï¼Œç»“æŸè¯¥æ–¹æ³•çš„è¿è¡Œã€‚return ä¸€èˆ¬æœ‰ä¸¤ç§ç”¨æ³•ï¼š</p><ol><li><code>return;</code>ï¼šç›´æ¥ä½¿ç”¨ return ç»“æŸæ–¹æ³•æ‰§è¡Œï¼Œç”¨äºæ²¡æœ‰è¿”å›å€¼å‡½æ•°çš„æ–¹æ³•</li><li><code>return value;</code>ï¼šreturn ä¸€ä¸ªç‰¹å®šå€¼ï¼Œç”¨äºæœ‰è¿”å›å€¼å‡½æ•°çš„æ–¹æ³•</li></ol><hr><h4 id="2-6-switch-case"><a href="#2-6-switch-case" class="headerlink" title="2.6  switch case"></a>2.6  switch case</h4><p>è¯­æ³•</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">switch</span>(<span class="hljs-keyword">expression</span>)&#123;<br>    <span class="hljs-keyword">case</span> value :<br>       <span class="hljs-comment">//è¯­å¥</span><br>       <span class="hljs-keyword">break</span>; <span class="hljs-comment">//å¯é€‰</span><br>    <span class="hljs-keyword">case</span> value :<br>       <span class="hljs-comment">//è¯­å¥</span><br>       <span class="hljs-keyword">break</span>; <span class="hljs-comment">//å¯é€‰</span><br>    <span class="hljs-comment">//ä½ å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„caseè¯­å¥</span><br>    <span class="hljs-keyword">default</span> : <span class="hljs-comment">//å¯é€‰</span><br>       <span class="hljs-comment">//è¯­å¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>switch caseç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå˜é‡ä¸ä¸€ç³»åˆ—å€¼ä¸­æŸä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ¯ä¸ªå€¼ç§°ä¸ºä¸€ä¸ªåˆ†æ”¯</p><p>ä½¿ç”¨è§„åˆ™ï¼š</p><ul><li>switchè¯­å¥ä¸­å˜é‡ç±»å‹å¯ä»¥æ˜¯ï¼šbyteã€shortã€intã€charã€‚ä»Java SE 7å¼€å§‹ï¼Œswitchæ”¯æŒStringç±»å‹ï¼ŒåŒæ—¶caseå¿…é¡»ä¸ºå­—ç¬¦ä¸²å¸¸é‡</li><li>switchè¯­å¥å¯ä»¥æ‹¥æœ‰å¤šä¸ªcaseï¼Œæ¯ä¸ªcaseåé¢è·Ÿä¸€ä¸ªè¦æ¯”è¾ƒçš„å€¼å’Œå†’å·</li><li>caseè¯­å¥ä¸­çš„å€¼çš„æ•°æ®ç±»å‹å¿…é¡»ä¸å˜é‡çš„æ•°æ®ç±»å‹ç›¸åŒ</li><li>å½“å˜é‡çš„å€¼ä¸caseè¯­å¥çš„å€¼ç›¸ç­‰ï¼Œcaseè¯­å¥ä¹‹åçš„è¯­å¥å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°å‡ºç°breakè¯­å¥æ‰ä¼šè·³å‡ºswitch</li><li>å½“é‡åˆ°breakæ—¶ï¼Œswitchç»ˆæ­¢ã€‚ç¨‹åºè·³è½¬åˆ°switchåé¢çš„è¯­å¥æ‰§è¡Œã€‚caseä¸å¿…é¡»è¦åŒ…å«breakã€‚å¦‚æœæ²¡æœ‰breakå‡ºç°ï¼Œç¨‹åºä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡caseï¼Œç›´åˆ°å‡ºç°break</li><li>switchå¯ä»¥åŒ…å«ä¸€ä¸ªdefaultåˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯æ˜¯switchçš„æœ€åä¸€ä¸ªåˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯å¯ä»¥åœ¨ä»»ä½•ä½ç½®ï¼Œä½†å»ºè®®å†™åœ¨æœ€åã€‚defaultåœ¨æ²¡æœ‰caseçš„å€¼å’Œå˜é‡ç›¸ç­‰æ—¶æ‰§è¡Œã€‚defaultä¸éœ€è¦break</li></ul><blockquote><p>switch case æ”¯æŒå“ªå‡ ç§æ•°æ®ç±»å‹</p></blockquote><p>åœ¨Javaä¸­ï¼Œ<code>switch</code>è¯­å¥æ”¯æŒä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š</p><ol><li><strong>æ•´æ•°ç±»å‹</strong>:<ul><li>åŒ…æ‹¬<code>byte</code>ã€<code>short</code>ã€<code>int</code>ä»¥åŠå®ƒä»¬çš„åŒ…è£…ç±»<code>Byte</code>ã€<code>Short</code>ã€<code>Integer</code>ã€‚</li><li><code>char</code>å’Œ<code>Character</code>ä¹Ÿè¢«æ”¯æŒï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥è¢«è½¬æ¢ä¸ºæ•´æ•°ç±»å‹ã€‚</li></ul></li><li><strong>æšä¸¾ç±»å‹</strong> (<code>enum</code>):<ul><li>å¯ä»¥ä½¿ç”¨æšä¸¾ç±»å‹çš„å¸¸é‡ä½œä¸º<code>case</code>æ ‡ç­¾ã€‚</li></ul></li><li><strong>å­—ç¬¦ä¸²ç±»å‹</strong> (<code>String</code>):<ul><li>ä»Java 7å¼€å§‹ï¼Œ<code>switch</code>è¯­å¥æ”¯æŒå­—ç¬¦ä¸²ç±»å‹ã€‚</li><li>å­—ç¬¦ä¸²æ¯”è¾ƒæ˜¯åŸºäºå­—ç¬¦ä¸²çš„å†…å®¹è€Œä¸æ˜¯å¼•ç”¨ã€‚</li></ul></li><li><strong>Java 12 å¼•å…¥çš„æ–°ç‰¹æ€§</strong>:<ul><li>ä»Java 12å¼€å§‹ï¼Œ<code>switch</code>è¡¨è¾¾å¼æ”¯æŒæ›´å¤šçš„æ•°æ®ç±»å‹å’Œæ›´çµæ´»çš„ä½¿ç”¨æ–¹å¼ï¼ˆä½œä¸ºé¢„è§ˆç‰¹æ€§ï¼‰ã€‚</li></ul></li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>long</code>ã€<code>float</code>ã€<code>double</code>åŠå…¶åŒ…è£…ç±»ä¸è¢«<code>switch</code>è¯­å¥æ”¯æŒã€‚æ­¤å¤–ï¼Œ<code>switch</code>è¯­å¥ä¸­çš„<code>case</code>æ ‡ç­¾å¿…é¡»ä½¿ç”¨å¸¸é‡è¡¨è¾¾å¼ï¼Œä¸èƒ½ä½¿ç”¨å˜é‡ã€‚</p><p><code>switch</code>è¯­å¥çš„è¿™ç§ç±»å‹é™åˆ¶ä¸»è¦æ˜¯å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œå› ä¸º<code>switch</code>é€šå¸¸æ˜¯é€šè¿‡æ•´æ•°è·³è½¬è¡¨å®ç°çš„ï¼Œè¿™ä½¿å¾—<code>switch</code>è¯­å¥åœ¨å¤„ç†æ•´æ•°ç±»å‹æ—¶éå¸¸é«˜æ•ˆã€‚ä½¿ç”¨æšä¸¾å’Œå­—ç¬¦ä¸²åˆ™æ˜¯ä¸ºäº†æä¾›æ›´å¤šçš„ç¼–ç¨‹ä¾¿åˆ©ã€‚</p><hr><h3 id="ä¸‰ã€åŸºæœ¬æ•°æ®ç±»å‹"><a href="#ä¸‰ã€åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="ä¸‰ã€åŸºæœ¬æ•°æ®ç±»å‹"></a>ä¸‰ã€åŸºæœ¬æ•°æ®ç±»å‹</h3><h4 id="3-1ã€Java-ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹"><a href="#3-1ã€Java-ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="3.1ã€Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹"></a>3.1ã€Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹</h4><table><thead><tr><th>ç±»å‹</th><th>åŸºç¡€ç±»å‹</th><th>é»˜è®¤å€¼</th><th>å ç”¨ç©ºé—´å¤§å°</th><th>ä½æ•°</th><th>å–å€¼èŒƒå›´</th><th>å¯¹åº”åŒ…è£…ç±»å‹</th></tr></thead><tbody><tr><td>æ•°å­—ç±»å‹</td><td>byte</td><td>0</td><td>1å­—èŠ‚</td><td>8</td><td>-128 ~ 127</td><td>Byte</td></tr><tr><td>æ•°å­—ç±»å‹</td><td>short</td><td>0</td><td>2å­—èŠ‚</td><td>16</td><td>-32768ï¼ˆ-2^15ï¼‰ ~ 32767ï¼ˆ2^15 - 1ï¼‰</td><td>Short</td></tr><tr><td>æ•°å­—ç±»å‹</td><td>int</td><td>0</td><td>4å­—èŠ‚</td><td>16</td><td>-2147483648 ~ 2147483647</td><td>Integer</td></tr><tr><td>æ•°å­—ç±»å‹</td><td>long</td><td>0L</td><td>8å­—èŠ‚</td><td>32</td><td>-9223372036854775808ï¼ˆ-2^63ï¼‰ ~ 9223372036854775807ï¼ˆ2^63 -1ï¼‰</td><td>Long</td></tr><tr><td>æ•°å­—ç±»å‹</td><td>float</td><td>0.0f</td><td>4å­—èŠ‚</td><td>23</td><td>1.4E-45 ~ 3.4028235E38</td><td>Float</td></tr><tr><td>æ•°å­—ç±»å‹</td><td>double</td><td>0.0d</td><td>8å­—èŠ‚</td><td>64</td><td>4.9E-324 ~ 1.7976931348623157E308</td><td>Double</td></tr><tr><td>å­—ç¬¦ç±»å‹</td><td>char</td><td>â€˜\u0000â€™ï¼ˆå³ç©ºå­—ç¬¦ï¼‰</td><td>2å­—èŠ‚ï¼ˆä½¿ç”¨Unicodeç¼–ç ï¼‰</td><td>16</td><td>0 ~ 65535ï¼ˆ2^16 - 1ï¼‰</td><td>Character</td></tr><tr><td>å¸ƒå°”ç±»å‹</td><td>boolean</td><td>false</td><td>1å­—èŠ‚</td><td>1</td><td>trueã€false</td><td>Boolean</td></tr></tbody></table><p>è¡¥å……ä¸€ä¸‹è®¡ç®—æœºå­˜å‚¨å­—èŠ‚ç›¸å…³çš„çŸ¥è¯†ï¼š</p><ol><li><strong>ä½ï¼ˆBitï¼‰</strong>:<ul><li>è®¡ç®—æœºä¸­æ•°æ®çš„æœ€å°å•ä½ã€‚</li><li>ä¸€ä¸ªä½å¯ä»¥è¡¨ç¤ºä¸€ä¸ªäºŒè¿›åˆ¶å€¼ï¼Œå³0æˆ–1ã€‚</li></ul></li><li><strong>å­—èŠ‚ï¼ˆByteï¼‰</strong>:<ul><li>å¸¸ç”¨çš„æ•°æ®å­˜å‚¨å•ä½ã€‚</li><li>1å­—èŠ‚ &#x3D; 8ä½ã€‚</li><li>ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®ç±»å‹å ç”¨1å­—èŠ‚ï¼Œé‚£ä¹ˆå®ƒå®é™…ä¸Šå¯ä»¥å­˜å‚¨8ä½äºŒè¿›åˆ¶ä¿¡æ¯ã€‚</li></ul></li></ol><h4 id="3-2-åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹"><a href="#3-2-åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹" class="headerlink" title="3.2 åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹"></a>3.2 åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹</h4><blockquote><p>åŒºåˆ«</p></blockquote><ul><li><strong>ç”¨é€”</strong>ï¼šé™¤äº†å®šä¹‰ä¸€äº›å¸¸é‡å’Œå±€éƒ¨å˜é‡ä¹‹å¤–ï¼Œæˆ‘ä»¬åœ¨å…¶ä»–åœ°æ–¹æ¯”å¦‚æ–¹æ³•å‚æ•°ã€å¯¹è±¡å±æ€§ä¸­å¾ˆå°‘ä¼šä½¿ç”¨åŸºæœ¬ç±»å‹æ¥å®šä¹‰å˜é‡ã€‚å¹¶ä¸”ï¼ŒåŒ…è£…ç±»å‹å¯ç”¨äºæ³›å‹ï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸å¯ä»¥ã€‚</li><li><strong>å­˜å‚¨æ–¹å¼</strong>ï¼šåŸºæœ¬æ•°æ®ç±»å‹çš„å±€éƒ¨å˜é‡å­˜æ”¾åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­çš„å±€éƒ¨å˜é‡è¡¨ä¸­ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„æˆå‘˜å˜é‡ï¼ˆæœªè¢« <code>static</code> ä¿®é¥° ï¼‰å­˜æ”¾åœ¨ Java è™šæ‹Ÿæœºçš„å †ä¸­ã€‚åŒ…è£…ç±»å‹å±äºå¯¹è±¡ç±»å‹ï¼Œæˆ‘ä»¬çŸ¥é“å‡ ä¹æ‰€æœ‰å¯¹è±¡å®ä¾‹éƒ½å­˜åœ¨äºå †ä¸­ã€‚</li><li><strong>å ç”¨ç©ºé—´</strong>ï¼šç›¸æ¯”äºåŒ…è£…ç±»å‹ï¼ˆå¯¹è±¡ç±»å‹ï¼‰ï¼Œ åŸºæœ¬æ•°æ®ç±»å‹å ç”¨çš„ç©ºé—´å¾€å¾€éå¸¸å°ã€‚</li><li><strong>é»˜è®¤å€¼</strong>ï¼šæˆå‘˜å˜é‡åŒ…è£…ç±»å‹ä¸èµ‹å€¼å°±æ˜¯ <code>null</code> ï¼Œè€ŒåŸºæœ¬ç±»å‹æœ‰é»˜è®¤å€¼ä¸”ä¸æ˜¯ <code>null</code>ã€‚</li><li><strong>æ¯”è¾ƒæ–¹å¼</strong>ï¼š</li></ul><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">æ¯”è¾ƒæ–¹å¼<br><br>å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ï¼Œ`==`Â æ¯”è¾ƒçš„æ˜¯å€¼ã€‚å¯¹äºåŒ…è£…æ•°æ®ç±»å‹æ¥è¯´ï¼Œ`==`Â æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚æ‰€æœ‰æ•´å‹åŒ…è£…ç±»å¯¹è±¡ä¹‹é—´å€¼çš„æ¯”è¾ƒï¼Œå…¨éƒ¨ä½¿ç”¨Â `equals()`Â æ–¹æ³•ã€‚<br></code></pre></td></tr></table></figure><blockquote><p>ç‰¹ç‚¹</p></blockquote><ol><li><strong>å¯¹è±¡ç‰¹æ€§</strong>ï¼šåŒ…è£…ç±»å‹æ˜¯å¯¹è±¡ï¼Œå¯ä»¥è°ƒç”¨å„ç§æ–¹æ³•ï¼Œä¾‹å¦‚<code>Integer.parseInt()</code>ã€‚</li><li><strong>å¯ç”¨äºæ³›å‹</strong>ï¼šåœ¨é›†åˆç±»ç­‰ä½¿ç”¨æ³›å‹çš„åœºåˆï¼Œåªèƒ½ä½¿ç”¨å¯¹è±¡ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨åŒ…è£…ç±»å‹ã€‚</li><li><strong>å¯è¡¨ç¤ºç©ºå€¼</strong>ï¼šå¯ä»¥è¡¨ç¤ºä¸º<code>null</code>ï¼Œè€ŒåŸºæœ¬ç±»å‹ä¸èƒ½ã€‚</li><li><strong>å †å†…å­˜</strong>ï¼šå¯¹è±¡é€šå¸¸å­˜å‚¨åœ¨å †ä¸Šï¼Œè¿™å¯èƒ½å¯¼è‡´å¤„ç†ç¨æ…¢äºåŸºæœ¬ç±»å‹ã€‚</li><li><strong>è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±</strong>ï¼šJavaæä¾›è‡ªåŠ¨å°†åŸºæœ¬ç±»å‹è½¬æ¢ä¸ºåŒ…è£…ç±»å‹ï¼ˆè£…ç®±ï¼‰å’Œå°†åŒ…è£…ç±»å‹è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹ï¼ˆæ‹†ç®±ï¼‰çš„åŠŸèƒ½ã€‚</li></ol><blockquote><p>æ¯”è¾ƒå’Œé€‰æ‹©</p></blockquote><ul><li>ä½¿ç”¨åŸºæœ¬æ•°æ®ç±»å‹æ—¶ï¼Œå¦‚æœå…³æ³¨æ€§èƒ½å’Œå†…å­˜ï¼Œå¹¶ä¸”ä¸éœ€è¦å¯¹è±¡çš„ç‰¹æ€§ï¼Œæ¯”å¦‚åœ¨å¤§é‡æ•°å€¼è®¡ç®—ä¸­ã€‚</li><li>ä½¿ç”¨åŒ…è£…ç±»å‹æ—¶ï¼Œå¦‚æœéœ€è¦å¯¹è±¡çš„ç‰¹æ€§ï¼Œæ¯”å¦‚åœ¨ä½¿ç”¨é›†åˆç±»ã€éœ€è¦è¡¨ç¤ºç©ºå€¼æˆ–ä½¿ç”¨æ³›å‹æ—¶ã€‚</li></ul><h4 id="3-3-åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶"><a href="#3-3-åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶" class="headerlink" title="3.3 åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶"></a>3.3 åŒ…è£…ç±»å‹çš„ç¼“å­˜æœºåˆ¶</h4><p>Javaä¸­çš„æŸäº›åŒ…è£…ç±»å®ç°äº†ä¸€ä¸ªç§°ä¸ºâ€œç¼“å­˜æœºåˆ¶â€çš„ç‰¹æ€§ï¼Œä¸»è¦æ˜¯ä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜ä½¿ç”¨ã€‚è¿™ä¸€æœºåˆ¶æœ€å¸¸è§äº<code>Integer</code>å’Œå…¶ä»–å‡ ç§æ•°å­—ç±»å‹çš„åŒ…è£…ç±»ä¸­ã€‚æˆ‘ä»¬æ¥è¯¦ç»†æ¢è®¨è¿™ä¸€ç‚¹ã€‚</p><blockquote><p>åŒ…è£…ç±»å‹ç¼“å­˜æœºåˆ¶çš„æ¦‚è¿°</p></blockquote><ol><li><strong>Integerç¼“å­˜</strong>: Javaçš„<code>Integer</code>ç±»ç¼“å­˜äº†ä»<code>-128</code>åˆ°<code>127</code>ä¹‹é—´çš„æ•´æ•°ã€‚è¿™æ„å‘³ç€åœ¨è¿™ä¸ªèŒƒå›´å†…çš„æ•´æ•°ä¼šè¢«é¢„å…ˆåˆ›å»ºå¹¶ç¼“å­˜ã€‚å½“ä»£ç éœ€è¦è¿™äº›å€¼çš„åŒ…è£…å®ä¾‹æ—¶ï¼Œä¼šé‡ç”¨å·²ç»åˆ›å»ºçš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡ã€‚</li><li><strong>å…¶ä»–ç±»å‹</strong>: ç±»ä¼¼çš„ç¼“å­˜æœºåˆ¶ä¹Ÿé€‚ç”¨äº<code>Byte</code>, <code>Short</code>, <code>Long</code>, <code>Character</code>ç­‰åŒ…è£…ç±»ã€‚ä½†å…·ä½“çš„ç¼“å­˜èŒƒå›´å¯èƒ½ä¸åŒã€‚ä¾‹å¦‚ï¼Œ<code>Byte</code>ç¼“å­˜äº†æ‰€æœ‰å¯èƒ½çš„å€¼ï¼ˆä»<code>-128</code>åˆ°<code>127</code>ï¼‰ï¼Œè€Œ<code>Character</code>ç¼“å­˜äº†ä»<code>\u0000</code>åˆ°<code>\u007F</code>çš„å­—ç¬¦ã€‚</li></ol><blockquote><p>ç¼“å­˜æœºåˆ¶çš„å·¥ä½œåŸç†</p></blockquote><p>å½“ä½ é€šè¿‡<code>valueOf</code>æ–¹æ³•ï¼ˆè¿™æ˜¯è‡ªåŠ¨è£…ç®±èƒŒåä½¿ç”¨çš„æ–¹æ³•ï¼‰æˆ–è€…ç›´æ¥ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡æ—¶ï¼ŒJavaä¼šé¦–å…ˆæ£€æŸ¥å…¶å€¼æ˜¯å¦åœ¨ç¼“å­˜èŒƒå›´å†…ã€‚å¦‚æœæ˜¯ï¼Œå®ƒä¼šä»ç¼“å­˜ä¸­è¿”å›ç›¸åº”çš„å¯¹è±¡å®ä¾‹ï¼›å¦‚æœä¸æ˜¯ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡å®ä¾‹ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">Integer a <span class="hljs-operator">=</span> <span class="hljs-number">100</span><span class="hljs-comment">;  // ä½¿ç”¨ç¼“å­˜</span><br>Integer b <span class="hljs-operator">=</span> <span class="hljs-number">100</span><span class="hljs-comment">;  // é‡ç”¨ç›¸åŒçš„å¯¹è±¡</span><br>Integer c <span class="hljs-operator">=</span> <span class="hljs-number">200</span><span class="hljs-comment">;  // åˆ›å»ºæ–°çš„å¯¹è±¡å®ä¾‹ï¼Œå› ä¸º200ä¸åœ¨ç¼“å­˜èŒƒå›´å†…</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>a</code>å’Œ<code>b</code>å¼•ç”¨çš„æ˜¯å†…å­˜ä¸­ç›¸åŒçš„<code>Integer</code>å¯¹è±¡ï¼Œå› ä¸º100åœ¨ç¼“å­˜èŒƒå›´å†…ã€‚</p><blockquote><p>ç¼“å­˜æœºåˆ¶çš„å¥½å¤„</p></blockquote><ul><li><strong>æ€§èƒ½æå‡</strong>ï¼šé€šè¿‡å‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºï¼Œæé«˜äº†æ€§èƒ½ã€‚</li><li><strong>å†…å­˜ä¼˜åŒ–</strong>ï¼šå‡å°‘äº†å†…å­˜çš„å ç”¨ï¼Œå› ä¸ºå…±äº«äº†ç›¸åŒçš„å¯¹è±¡ã€‚</li></ul><blockquote><p>ä½¿ç”¨æ—¶çš„æ³¨æ„äº‹é¡¹</p></blockquote><ul><li>å½“æ¯”è¾ƒåŒ…è£…ç±»å‹çš„å€¼æ—¶ï¼Œåº”è¯¥ä½¿ç”¨<code>equals</code>æ–¹æ³•è€Œä¸æ˜¯&#x3D;&#x3D; è¿ç®—ç¬¦ï¼Œå› ä¸º &#x3D;&#x3D; æ¯”è¾ƒçš„æ˜¯å¼•ç”¨ï¼Œè€Œä¸æ˜¯å€¼ã€‚ä½†åœ¨ç¼“å­˜èŒƒå›´å†…ï¼Œä½¿ç”¨ &#x3D;&#x3D; å¯èƒ½ä¼šè¯¯å¯¼ä½ è®¤ä¸ºæ¯”è¾ƒçš„æ˜¯å€¼ã€‚</li><li>åœ¨å¤„ç†å¤§é‡çš„æ•´æ•°è¿ç®—æ—¶ï¼Œè¦æ„è¯†åˆ°è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±å¯èƒ½ä¼šå¼•å…¥é¢å¤–çš„æ€§èƒ½å¼€é”€</li></ul><hr><p>Java åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»å‹çš„å¤§éƒ¨åˆ†éƒ½ç”¨åˆ°äº†ç¼“å­˜æœºåˆ¶æ¥æå‡æ€§èƒ½ã€‚</p><p><code>Byte</code>,<code>Short</code>,<code>Integer</code>,<code>Long</code> è¿™ 4 ç§åŒ…è£…ç±»é»˜è®¤åˆ›å»ºäº†æ•°å€¼ <strong>[-128ï¼Œ127]</strong> çš„ç›¸åº”ç±»å‹çš„ç¼“å­˜æ•°æ®ï¼Œ</p><p><code>Character</code> åˆ›å»ºäº†æ•°å€¼åœ¨ <strong>[0,127]</strong> èŒƒå›´çš„ç¼“å­˜æ•°æ®ï¼Œ</p><p><code>Boolean</code> ç›´æ¥è¿”å› <code>True</code> or <code>False</code>ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé—®é¢˜ï¼šä¸‹é¢çš„ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ <code>true</code> è¿˜æ˜¯ <code>false</code> å‘¢ï¼Ÿ</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">Integer i1 <span class="hljs-operator">=</span> <span class="hljs-number">40</span><span class="hljs-comment">;</span><br>Integer i2 <span class="hljs-operator">=</span> new Integer(<span class="hljs-number">40</span>)<span class="hljs-comment">;</span><br>System.out.println(i1<span class="hljs-operator">=</span><span class="hljs-operator">=</span>i2)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><code>Integer i1=40</code> è¿™ä¸€è¡Œä»£ç ä¼šå‘ç”Ÿè£…ç®±ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™è¡Œä»£ç ç­‰ä»·äº <code>Integer i1=Integer.valueOf(40)</code> ã€‚</p><p>å› æ­¤ï¼Œ<code>i1</code> ç›´æ¥ä½¿ç”¨çš„æ˜¯ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚è€Œ<code>Integer i2 = new Integer(40)</code> ä¼šç›´æ¥åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p><p>å› æ­¤ï¼Œç­”æ¡ˆæ˜¯ <code>false</code> ã€‚</p><p>è®°ä½ï¼š<strong>æ‰€æœ‰æ•´å‹åŒ…è£…ç±»å¯¹è±¡ä¹‹é—´å€¼çš„æ¯”è¾ƒï¼Œå…¨éƒ¨ä½¿ç”¨ equals æ–¹æ³•æ¯”è¾ƒ</strong>ã€‚</p><div style="background-color: #ecf0f1; color: #34495e; padding: 15px; border: 2px solid #bdc3c7; border-radius: 5px;">  <strong>è®°ä½ï¼š</strong> æ‰€æœ‰æ•´å‹åŒ…è£…ç±»å¯¹è±¡ä¹‹é—´å€¼çš„æ¯”è¾ƒï¼Œå…¨éƒ¨ä½¿ç”¨ equals æ–¹æ³•æ¯”è¾ƒ</div><p> <img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240108224809.png" alt="image.png"></p><h5 id="å¸¸é‡æ± æŠ€æœ¯"><a href="#å¸¸é‡æ± æŠ€æœ¯" class="headerlink" title="å¸¸é‡æ± æŠ€æœ¯"></a>å¸¸é‡æ± æŠ€æœ¯</h5><p>çœ‹åˆ°ä¸€ä¸ªæ¦‚å¿µï¼Œå³å°†è¿™ä¸ªç¼“å­˜æœºåˆ¶ä¹Ÿç§°ä¸ºå¸¸é‡æ± æŠ€æœ¯ï¼›è§£é‡Šå¯ä»¥çœ‹ä¸‹é¢çš„å†…å®¹ï¼š</p><p>Javaä¸­çš„åŒ…è£…ç±»å‹ï¼ˆå¦‚<code>Integer</code>ã€<code>Long</code>ã€<code>Byte</code>ã€<code>Character</code>ã€<code>Short</code>ç­‰ï¼‰ä½¿ç”¨äº†å¸¸é‡æ± æŠ€æœ¯ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºï¼Œæé«˜ç©ºé—´å’Œæ—¶é—´æ•ˆç‡ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-comment">// ç¤ºä¾‹ï¼šä½¿ç”¨Integerçš„å¸¸é‡æ± </span><br><span class="hljs-keyword">Integer</span> a = <span class="hljs-number">127</span>;  <span class="hljs-comment">// ä½¿ç”¨å¸¸é‡æ± </span><br><span class="hljs-keyword">Integer</span> b = <span class="hljs-number">127</span>;  <span class="hljs-comment">// åŒæ ·ä½¿ç”¨å¸¸é‡æ± ï¼Œaå’ŒbæŒ‡å‘ç›¸åŒçš„å¯¹è±¡</span><br><br><span class="hljs-keyword">Integer</span> c = <span class="hljs-number">128</span>;  <span class="hljs-comment">// è¶…å‡ºå¸¸é‡æ± èŒƒå›´ï¼Œåˆ›å»ºæ–°çš„Integerå¯¹è±¡</span><br><span class="hljs-keyword">Integer</span> d = <span class="hljs-number">128</span>;  <span class="hljs-comment">// åŒæ ·åˆ›å»ºæ–°çš„Integerå¯¹è±¡ï¼Œcå’ŒdæŒ‡å‘ä¸åŒçš„å¯¹è±¡</span><br></code></pre></td></tr></table></figure><p>å¸¸é‡æ± çš„ä¸€äº›ç›¸å…³å†…å®¹ï¼š</p><ol><li><strong>å¸¸é‡æ± </strong>:<ul><li>å¸¸é‡æ± æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­˜å‚¨åŒºåŸŸï¼Œç”¨äºå­˜å‚¨åŒ…è£…ç±»çš„å¸¸ç”¨å¯¹è±¡ã€‚</li><li>åœ¨Javaä¸­ï¼Œ<code>Byte</code>ã€<code>Short</code>ã€<code>Integer</code>ã€<code>Long</code>ã€<code>Character</code>è¿™äº›ç±»çš„å¯¹è±¡æœ‰å¸¸é‡æ± ã€‚</li></ul></li><li><strong>Integerå¸¸é‡æ± èŒƒå›´</strong>:<ul><li>å¯¹äº<code>Integer</code>ï¼Œå¸¸é‡æ± çš„èŒƒå›´é»˜è®¤æ˜¯ä»-128åˆ°127ã€‚</li><li>å½“ä½ åˆ›å»ºä¸€ä¸ªåœ¨è¿™ä¸ªèŒƒå›´å†…çš„<code>Integer</code>å¯¹è±¡æ—¶ï¼ŒJavaä¼šç›´æ¥ä»å¸¸é‡æ± ä¸­è¿”å›å·²å­˜åœ¨çš„å¯¹è±¡è€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li></ul></li><li><strong>è¶…å‡ºå¸¸é‡æ± èŒƒå›´</strong>:<ul><li>å¦‚æœåˆ›å»ºçš„å¯¹è±¡è¶…å‡ºäº†å¸¸é‡æ± çš„èŒƒå›´ï¼ŒJavaä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li></ul></li><li><strong>èŠ‚çœå†…å­˜</strong>:<ul><li>ç”±äºå¸¸é‡æ± çš„ä½¿ç”¨ï¼Œç›¸åŒçš„æ•°å€¼ä¼šæŒ‡å‘ç›¸åŒçš„å¯¹è±¡ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸ŠèŠ‚çœäº†å†…å­˜ã€‚</li></ul></li><li><strong><code>Character</code>å¸¸é‡æ± èŒƒå›´</strong>:<ul><li>å¯¹äº<code>Character</code>ï¼Œå¸¸é‡æ± çš„èŒƒå›´æ˜¯ä»<code>\u0000</code>åˆ°<code>\u007F</code>ï¼ˆå³0åˆ°127ï¼‰ã€‚</li></ul></li><li><strong>è‡ªåŠ¨è£…ç®±</strong>:<ul><li>å½“ä½ å°†åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢ä¸ºåŒ…è£…ç±»æ—¶ï¼ŒJavaä¼šè‡ªåŠ¨ä½¿ç”¨å¸¸é‡æ± ï¼ˆå¦‚æœå€¼åœ¨å¸¸é‡æ± çš„èŒƒå›´å†…ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºè‡ªåŠ¨è£…ç®±ã€‚</li></ul></li><li><strong>æ³¨æ„äº‹é¡¹</strong>:<ul><li>åœ¨æ¯”è¾ƒåŒ…è£…ç±»å‹å¯¹è±¡æ—¶ï¼Œåº”è¯¥ä½¿ç”¨<code>equals</code>æ–¹æ³•è€Œä¸æ˜¯&#x3D;&#x3D; ï¼Œå› ä¸º &#x3D;&#x3D; æ¯”è¾ƒçš„æ˜¯å¼•ç”¨ï¼Œè€Œä¸æ˜¯å€¼ã€‚ä½†åœ¨å¸¸é‡æ± èŒƒå›´å†…ï¼Œ &#x3D;&#x3D; å¯ä»¥æ­£å¸¸å·¥ä½œå› ä¸ºå¼•ç”¨æŒ‡å‘ç›¸åŒçš„å¯¹è±¡ã€‚</li></ul></li></ol><p>å¸¸é‡æ± æŠ€æœ¯æ˜¯Javaä¸­ä¸€ç§é‡è¦çš„å†…å­˜ä¼˜åŒ–æ‰‹æ®µï¼Œå®ƒåœ¨å¤„ç†å¤§é‡çš„åŒ…è£…ç±»å‹å¯¹è±¡æ—¶å°¤ä¸ºæœ‰æ•ˆã€‚</p><h4 id="3-4-è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±"><a href="#3-4-è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±" class="headerlink" title="3.4 è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±"></a>3.4 è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±</h4><ul><li><strong>è£…ç®±</strong>ï¼šå°†åŸºæœ¬ç±»å‹ç”¨å®ƒä»¬å¯¹åº”çš„å¼•ç”¨ç±»å‹åŒ…è£…èµ·æ¥ï¼›</li><li><strong>æ‹†ç®±</strong>ï¼šå°†åŒ…è£…ç±»å‹è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼›</li></ul><p>å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç¤ºä¾‹ï¼šè‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±</span><br><span class="hljs-type">Integer</span> <span class="hljs-variable">boxed</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">// è‡ªåŠ¨è£…ç®±ï¼Œç›¸å½“äº Integer.valueOf(10)</span><br><span class="hljs-type">int</span> <span class="hljs-variable">unboxed</span> <span class="hljs-operator">=</span> boxed; <span class="hljs-comment">// è‡ªåŠ¨æ‹†ç®±ï¼Œç›¸å½“äº boxed.intValue()</span><br></code></pre></td></tr></table></figure><p><strong>è‡ªåŠ¨è£…ç®±ï¼ˆAutoboxingï¼‰</strong>:</p><ul><li>å½“éœ€è¦ä¸€ä¸ªåŒ…è£…ç±»å‹çš„å¯¹è±¡æ—¶ï¼ŒJavaä¼šè‡ªåŠ¨å°†åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢ä¸ºå¯¹åº”çš„åŒ…è£…ç±»å‹ã€‚</li><li>è¿™æ˜¯é€šè¿‡è°ƒç”¨åŒ…è£…ç±»çš„é™æ€<code>valueOf</code>æ–¹æ³•å®ç°çš„ã€‚</li><li>ä¾‹å¦‚ï¼Œå½“ä½ å†™<code>Integer boxed = 10;</code>æ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯<code>Integer boxed = Integer.valueOf(10);</code>ã€‚</li></ul><p><strong>è‡ªåŠ¨æ‹†ç®±ï¼ˆUnboxingï¼‰</strong>:</p><ul><li>å½“éœ€è¦ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼æ—¶ï¼ŒJavaä¼šè‡ªåŠ¨å°†åŒ…è£…ç±»å‹çš„å¯¹è±¡è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ã€‚</li><li>è¿™æ˜¯é€šè¿‡è°ƒç”¨åŒ…è£…ç±»å¯¹è±¡çš„<code>xxxValue</code>æ–¹æ³•å®ç°çš„ï¼ˆä¾‹å¦‚ï¼Œ<code>intValue</code>ã€<code>doubleValue</code>ç­‰ï¼‰ã€‚</li><li>ä¾‹å¦‚ï¼Œå½“ä½ å†™<code>int unboxed = boxed;</code>æ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯<code>int unboxed = boxed.intValue();</code>ã€‚</li></ul><p><strong>æ³¨æ„äº‹é¡¹</strong>:</p><ul><li><strong>ç©ºæŒ‡é’ˆå¼‚å¸¸</strong>ï¼šè‡ªåŠ¨æ‹†ç®±å¯èƒ½å¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å¦‚æœåŒ…è£…ç±»å‹çš„å¼•ç”¨ä¸º<code>null</code>ï¼Œåœ¨è‡ªåŠ¨æ‹†ç®±æ—¶ä¼šå°è¯•è°ƒç”¨<code>null</code>çš„<code>xxxValue</code>æ–¹æ³•ï¼Œä»è€ŒæŠ›å‡º<code>NullPointerException</code>ã€‚</li><li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šè™½ç„¶è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±å¾ˆæ–¹ä¾¿ï¼Œä½†åœ¨æ€§èƒ½æ•æ„Ÿçš„åœºæ™¯ä¸‹åº”å½“è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºè£…ç®±å’Œæ‹†ç®±æ“ä½œæ¶‰åŠé¢å¤–çš„å¯¹è±¡åˆ›å»ºå’Œæ–¹æ³•è°ƒç”¨ã€‚</li></ul><p>è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±è®©å¼€å‘è€…å¯ä»¥æ›´åŠ è‡ªç„¶åœ°ç¼–å†™ä»£ç ï¼Œæ— éœ€æ˜¾å¼åœ°åœ¨åŸºæœ¬æ•°æ®ç±»å‹å’ŒåŒ…è£…ç±»å‹ä¹‹é—´è½¬æ¢ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦äº†è§£å…¶èƒŒåçš„åŸç†å’Œæ½œåœ¨é™·é˜±ã€‚</p><h5 id="å¯èƒ½å¯¼è‡´NPEçš„è‡ªåŠ¨æ‹†ç®±"><a href="#å¯èƒ½å¯¼è‡´NPEçš„è‡ªåŠ¨æ‹†ç®±" class="headerlink" title="å¯èƒ½å¯¼è‡´NPEçš„è‡ªåŠ¨æ‹†ç®±"></a>å¯èƒ½å¯¼è‡´NPEçš„è‡ªåŠ¨æ‹†ç®±</h5><p>NPE æŒ‡çš„æ˜¯ç©ºæŒ‡é’ˆå¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç¤ºä¾‹ï¼šå¯èƒ½å¯¼è‡´NPEçš„è‡ªåŠ¨æ‹†ç®±</span><br><span class="hljs-type">Integer</span> <span class="hljs-variable">myInteger</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">myInt</span> <span class="hljs-operator">=</span> myInteger; <span class="hljs-comment">// è‡ªåŠ¨æ‹†ç®±æ—¶å¯èƒ½æŠ›å‡ºNullPointerException</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°æˆ‘ä»¬ä¹Ÿè®²åˆ°ï¼Œå¦‚æœåŒ…è£…ç±»å‹çš„å¼•ç”¨ä¸º<code>null</code>ï¼Œåœ¨è‡ªåŠ¨æ‹†ç®±æ—¶ä¼šå°è¯•è°ƒç”¨<code>null</code>çš„<code>xxxValue</code>æ–¹æ³•ï¼Œä»è€ŒæŠ›å‡º<code>NullPointerException</code>ã€‚</p><p>è¯´ä¸€ä¸‹è¿™ç§æƒ…å†µå¦‚ä½•å¤„ç†ï¼š</p><p><strong>å¤„ç†æ–¹æ³•</strong>:</p><ol><li><strong>æ£€æŸ¥ç©ºå€¼</strong>:<ul><li>åœ¨è¿›è¡Œè‡ªåŠ¨æ‹†ç®±ä¹‹å‰ï¼Œå…ˆæ£€æŸ¥åŒ…è£…ç±»å‹çš„å¯¹è±¡æ˜¯å¦ä¸º<code>null</code>ã€‚</li><li>ç¤ºä¾‹ï¼š<code>if (myInteger != null) &#123; myInt = myInteger; &#125;</code></li></ul></li><li><strong>ä½¿ç”¨é»˜è®¤å€¼</strong>:<ul><li>å¦‚æœåŒ…è£…ç±»å‹å¯èƒ½ä¸º<code>null</code>ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼æ¥é¿å…NPEã€‚</li><li>ç¤ºä¾‹ï¼š<code>myInt = (myInteger != null) ? myInteger : defaultValue;</code></li></ul></li><li><strong>é¿å…ä¸å¿…è¦çš„è£…ç®±å’Œæ‹†ç®±</strong>:<ul><li>åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå°½é‡é¿å…ä¸å¿…è¦çš„è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ï¼Œç‰¹åˆ«æ˜¯åœ¨å…³é”®çš„ä¸šåŠ¡é€»è¾‘ä¸­ã€‚</li></ul></li><li><strong>ä½¿ç”¨Optionalç±»</strong>:<ul><li>åœ¨Java 8åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨<code>Optional</code>ç±»æ¥ä¼˜é›…åœ°å¤„ç†å¯èƒ½ä¸º<code>null</code>çš„æƒ…å†µã€‚</li><li>ç¤ºä¾‹ï¼š<code>myInt = Optional.ofNullable(myInteger).orElse(defaultValue);</code></li></ul></li><li><strong>ä»£ç å®¡æŸ¥å’Œæµ‹è¯•</strong>:<ul><li>åœ¨ç¼–ç é˜¶æ®µè¿›è¡Œä¸¥æ ¼çš„ä»£ç å®¡æŸ¥ï¼Œç¡®ä¿å¯¹å¯èƒ½ä¸º<code>null</code>çš„å¯¹è±¡è¿›è¡Œäº†é€‚å½“çš„å¤„ç†ã€‚</li><li>ç¼–å†™å•å…ƒæµ‹è¯•æ¥è¦†ç›–å¯èƒ½äº§ç”ŸNPEçš„åœºæ™¯ã€‚</li></ul></li></ol><h4 id="3-5-æµ®ç‚¹æ•°è¿ç®—ç²¾åº¦ä¸¢å¤±"><a href="#3-5-æµ®ç‚¹æ•°è¿ç®—ç²¾åº¦ä¸¢å¤±" class="headerlink" title="3.5 æµ®ç‚¹æ•°è¿ç®—ç²¾åº¦ä¸¢å¤±"></a>3.5 æµ®ç‚¹æ•°è¿ç®—ç²¾åº¦ä¸¢å¤±</h4><p>çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">float</span> a = <span class="hljs-number">2</span>.<span class="hljs-number">0</span>f - <span class="hljs-number">1</span>.<span class="hljs-number">9</span>f;<br><span class="hljs-attribute">float</span> b = <span class="hljs-number">1</span>.<span class="hljs-number">8</span>f - <span class="hljs-number">1</span>.<span class="hljs-number">7</span>f;<br><span class="hljs-attribute">System</span>.out.println(a);// <span class="hljs-number">0</span>.<span class="hljs-number">100000024</span><br><span class="hljs-attribute">System</span>.out.println(b);// <span class="hljs-number">0</span>.<span class="hljs-number">099999905</span><br><span class="hljs-attribute">System</span>.out.println(a == b);// false<br></code></pre></td></tr></table></figure><p>åŸå› åˆ†æï¼š</p><p>æµ®ç‚¹æ•°è¿ç®—ä¸­çš„ç²¾åº¦ä¸¢å¤±æ˜¯ä¸€ä¸ªåœ¨è®¡ç®—æœºç§‘å­¦ä¸­å¹¿æ³›å­˜åœ¨çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨å•ç²¾åº¦ï¼ˆ<code>float</code>ï¼‰å’ŒåŒç²¾åº¦ï¼ˆ<code>double</code>ï¼‰ç±»å‹æ—¶ã€‚è¿™ä¸ªé—®é¢˜çš„æ ¹æºåœ¨äºæµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„è¡¨ç¤ºæ–¹å¼ã€‚</p><blockquote><p>æµ®ç‚¹æ•°è¡¨ç¤º</p></blockquote><p>æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­é€šå¸¸ä½¿ç”¨IEEE 754æ ‡å‡†è¡¨ç¤ºã€‚è¿™ç§è¡¨ç¤ºæ–¹æ³•æœ‰ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š</p><ol><li><strong>å°¾æ•°ï¼ˆMantissaï¼‰</strong>ï¼šä»£è¡¨æ•°å­—çš„æœ‰æ•ˆæ•°å­—ã€‚</li><li><strong>æŒ‡æ•°ï¼ˆExponentï¼‰</strong>ï¼šå†³å®šå°æ•°ç‚¹çš„ä½ç½®ã€‚</li></ol><p>ç”±äºè¿™ä¸¤ä¸ªéƒ¨åˆ†éƒ½æœ‰å›ºå®šçš„ä½æ•°ï¼Œæ‰€ä»¥åªèƒ½ç²¾ç¡®è¡¨ç¤ºä¸€å®šèŒƒå›´å’Œç²¾åº¦çš„æ•°ã€‚ä¸€äº›æ•°ï¼Œå¦‚åˆ†æ•°<code>1/3</code>æˆ–ç‰¹å®šçš„å°æ•°ï¼Œæ— æ³•è¢«ç²¾ç¡®åœ°è¡¨ç¤ºä¸ºæµ®ç‚¹æ•°ã€‚</p><blockquote><p>ç²¾åº¦ä¸¢å¤±çš„åŸå› </p></blockquote><ol><li><strong>æœ‰é™çš„ä½æ•°</strong>ï¼šç”±äºå°¾æ•°å’ŒæŒ‡æ•°çš„ä½æ•°æ˜¯æœ‰é™çš„ï¼Œå› æ­¤æµ®ç‚¹æ•°ä¸èƒ½ç²¾ç¡®è¡¨ç¤ºæ‰€æœ‰çš„æ•°å€¼ã€‚åœ¨è½¬æ¢å’Œè¿ç®—è¿‡ç¨‹ä¸­ï¼Œä¼šè¿›è¡Œå››èˆäº”å…¥ä»¥é€‚åº”è¿™äº›ä½æ•°ï¼Œä»è€Œå¯¼è‡´ç²¾åº¦ä¸¢å¤±ã€‚</li><li><strong>äºŒè¿›åˆ¶è¡¨ç¤º</strong>ï¼šæŸäº›åè¿›åˆ¶å°æ•°åœ¨äºŒè¿›åˆ¶ä¸‹æ˜¯æ— é™å¾ªç¯å°æ•°ï¼Œæ— æ³•ç²¾ç¡®è¡¨ç¤ºï¼Œä¾‹å¦‚0.1ã€‚</li></ol><p>å®é™…å½±å“</p><p>åœ¨è¿›è¡Œæµ®ç‚¹æ•°è¿ç®—æ—¶ï¼Œå¦‚åŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•å’Œé™¤æ³•ï¼Œè¿™ç§ç²¾åº¦çš„ä¸¢å¤±å¯èƒ½ä¼šç´¯ç§¯ï¼Œå¯¼è‡´æœ€ç»ˆç»“æœä¸é¢„æœŸæœ‰è¾ƒå¤§åå·®ã€‚è¿™åœ¨é‡‘èè®¡ç®—ç­‰éœ€è¦é«˜ç²¾åº¦çš„åœºåˆå°¤ä¸ºé‡è¦ã€‚</p><blockquote><p>è§£å†³æ–¹æ³•</p></blockquote><ol><li><strong>ä½¿ç”¨<code>BigDecimal</code></strong>: åœ¨Javaä¸­ï¼Œ<code>BigDecimal</code>ç±»å¯ä»¥ç”¨äºç²¾ç¡®çš„å°æ•°è¿ç®—ã€‚å®ƒå…è®¸æ§åˆ¶èˆå…¥æ¨¡å¼ï¼Œå¯ä»¥ç”¨äºé‡‘èå’Œç§‘å­¦è®¡ç®—ä¸­ã€‚</li><li><strong>é¿å…ä¸å¿…è¦çš„è¿ç®—</strong>ï¼šå‡å°‘æµ®ç‚¹æ•°è¿ç®—çš„æ•°é‡å¯ä»¥å‡å°‘ç´¯ç§¯è¯¯å·®ã€‚</li><li><strong>ç†è§£å’Œæ¥å—ä¸€å®šçš„è¯¯å·®</strong>ï¼šåœ¨æŸäº›åœºåˆï¼Œå®Œå…¨ç²¾ç¡®çš„ç»“æœå¯èƒ½å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œæ­¤æ—¶ç†è§£å¹¶æ¥å—æµ®ç‚¹è¿ç®—çš„é™åˆ¶æ˜¯åˆç†çš„ã€‚</li></ol><h3 id="å››ã€å˜é‡"><a href="#å››ã€å˜é‡" class="headerlink" title="å››ã€å˜é‡"></a>å››ã€å˜é‡</h3><h4 id="4-1-æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡"><a href="#4-1-æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡" class="headerlink" title="4.1 æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡"></a>4.1 æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡</h4><p>æˆå‘˜å˜é‡ï¼ˆå­—æ®µã€å±æ€§ï¼‰ï¼Œå±€éƒ¨å˜é‡åœ¨å£°æ˜ä½ç½®ã€ä½œç”¨åŸŸã€åˆå§‹åŒ–è¡Œä¸ºç­‰æ–¹é¢æœ‰æ˜¾è‘—çš„ä¸åŒ</p><blockquote><p>æˆå‘˜å˜é‡ï¼ˆMember Variablesï¼‰</p></blockquote><p>æˆå‘˜å˜é‡æ˜¯å®šä¹‰åœ¨ç±»ä¸­çš„å˜é‡ï¼Œå®ƒä»¬æè¿°äº†ç±»çš„å±æ€§æˆ–çŠ¶æ€ã€‚æ ¹æ®æ˜¯å¦ä½¿ç”¨<code>static</code>å…³é”®å­—ï¼Œæˆå‘˜å˜é‡å¯ä»¥è¿›ä¸€æ­¥åˆ†ä¸ºå®ä¾‹å˜é‡å’Œç±»å˜é‡ã€‚</p><ol><li><strong>å®ä¾‹å˜é‡</strong>ï¼šæ²¡æœ‰ç”¨<code>static</code>ä¿®é¥°çš„æˆå‘˜å˜é‡ã€‚æ¯ä¸ªç±»çš„å®ä¾‹éƒ½æœ‰è‡ªå·±çš„ä¸€å¥—å®ä¾‹å˜é‡çš„å‰¯æœ¬ã€‚</li><li><strong>ç±»å˜é‡ï¼ˆé™æ€å˜é‡ï¼‰</strong>ï¼šç”¨<code>static</code>ä¿®é¥°çš„æˆå‘˜å˜é‡ã€‚å®ƒä»¬å±äºç±»æœ¬èº«ï¼Œæ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ä¸ªé™æ€å˜é‡çš„å‰¯æœ¬ã€‚</li></ol><p>ç‰¹ç‚¹</p><ul><li><strong>ä½œç”¨åŸŸ</strong>ï¼šæ•´ä¸ªç±»å†…éƒ¨ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šä¸å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼ˆå®ä¾‹å˜é‡ï¼‰æˆ–ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼ˆé™æ€å˜é‡ï¼‰ç›¸åŒã€‚</li><li><strong>é»˜è®¤å€¼</strong>ï¼šè‡ªåŠ¨åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼ˆå¦‚<code>int</code>ä¸º0ï¼Œå¯¹è±¡å¼•ç”¨ä¸º<code>null</code>ï¼‰ã€‚</li><li><strong>è®¿é—®æ–¹å¼</strong>ï¼šå¯ä»¥é€šè¿‡å¯¹è±¡ï¼ˆå®ä¾‹å˜é‡ï¼‰æˆ–ç±»åï¼ˆé™æ€å˜é‡ï¼‰è®¿é—®ã€‚</li></ul><blockquote><p>å±€éƒ¨å˜é‡ï¼ˆLocal Variablesï¼‰</p></blockquote><p>å±€éƒ¨å˜é‡æ˜¯åœ¨æ–¹æ³•å†…ã€æ„é€ å™¨å†…æˆ–ä»£ç å—å†…å®šä¹‰çš„å˜é‡ã€‚</p><p><strong>ç‰¹ç‚¹</strong></p><ul><li><strong>ä½œç”¨åŸŸ</strong>ï¼šä»…é™äºå®ƒä»¬è¢«å£°æ˜çš„æ–¹æ³•ã€æ„é€ å™¨æˆ–ä»£ç å—å†…ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šä»å£°æ˜å¼€å§‹åˆ°æ–¹æ³•ã€æ„é€ å™¨æˆ–ä»£ç å—æ‰§è¡Œå®Œæ¯•æ—¶ç»“æŸã€‚</li><li><strong>åˆå§‹åŒ–</strong>ï¼šä¸ä¼šè‡ªåŠ¨åˆå§‹åŒ–ï¼Œå¿…é¡»åœ¨ä½¿ç”¨å‰æ˜¾å¼åˆå§‹åŒ–ã€‚</li><li><strong>å†…å­˜ä½ç½®</strong>ï¼šé€šå¸¸å­˜å‚¨åœ¨æ ˆä¸Šã€‚</li></ul><blockquote><p>æ¯”è¾ƒ</p></blockquote><table><thead><tr><th>ç‰¹æ€§</th><th>æˆå‘˜å˜é‡</th><th>å±€éƒ¨å˜é‡</th></tr></thead><tbody><tr><td>å£°æ˜ä½ç½®</td><td>ç±»ä½“å†…éƒ¨</td><td>æ–¹æ³•ã€æ„é€ å™¨æˆ–ä»£ç å—å†…</td></tr><tr><td>ä½œç”¨åŸŸ</td><td>æ•´ä¸ªç±»å†…éƒ¨</td><td>ä»…é™äºå£°æ˜å®ƒä»¬çš„å—å†…</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>å®ä¾‹å˜é‡ï¼šéšå¯¹è±¡å­˜åœ¨ï¼›é™æ€å˜é‡ï¼šéšç±»å­˜åœ¨</td><td>éšæ–¹æ³•ã€æ„é€ å™¨æˆ–ä»£ç å—æ‰§è¡Œå®Œæ¯•è€Œç»“æŸ</td></tr><tr><td>åˆå§‹åŒ–</td><td>è‡ªåŠ¨åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼</td><td>å¿…é¡»æ˜¾å¼åˆå§‹åŒ–</td></tr><tr><td>å†…å­˜ä½ç½®</td><td>å †ï¼ˆå®ä¾‹å˜é‡ï¼‰æˆ–æ–¹æ³•åŒºï¼ˆé™æ€å˜é‡ï¼‰</td><td>æ ˆ</td></tr></tbody></table><h4 id="4-2-é™æ€å˜é‡"><a href="#4-2-é™æ€å˜é‡" class="headerlink" title="4.2 é™æ€å˜é‡"></a>4.2 é™æ€å˜é‡</h4><p>ç•¥</p><h4 id="4-3-å­—ç¬¦å‹å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡"><a href="#4-3-å­—ç¬¦å‹å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡" class="headerlink" title="4.3 å­—ç¬¦å‹å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡"></a>4.3 å­—ç¬¦å‹å¸¸é‡å’Œå­—ç¬¦ä¸²å¸¸é‡</h4><p>å­—ç¬¦å‹å¸¸é‡ï¼ˆCharacter Constantsï¼‰å’Œå­—ç¬¦ä¸²å¸¸é‡ï¼ˆString Constantsï¼‰ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ï¼š</p><table><thead><tr><th>ç‰¹æ€§</th><th>å­—ç¬¦å‹å¸¸é‡ï¼ˆCharacter Constantsï¼‰</th><th>å­—ç¬¦ä¸²å¸¸é‡ï¼ˆString Constantsï¼‰</th></tr></thead><tbody><tr><td>å¼•å·ç±»å‹</td><td>å•å¼•å·ï¼ˆâ€™ï¼‰</td><td>åŒå¼•å·ï¼ˆâ€ï¼‰</td></tr><tr><td>å†…å®¹</td><td>ä»…åŒ…å«å•ä¸ªå­—ç¬¦</td><td>å¯åŒ…å«é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td></tr><tr><td>ç±»å‹</td><td>åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ<code>char</code>ï¼‰</td><td>ç±»ï¼ˆ<code>String</code>ï¼‰</td></tr><tr><td>å­˜å‚¨å¤§å°</td><td>16ä½ï¼ˆ2å­—èŠ‚ï¼‰Unicodeå­—ç¬¦</td><td>å–å†³äºå­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>å¯å˜æ€§</td><td>ä¸é€‚ç”¨</td><td>ä¸å¯å˜ï¼ˆä¸€æ—¦åˆ›å»ºï¼Œå†…å®¹ä¸å¯æ›´æ”¹ï¼‰</td></tr><tr><td>ç¤ºä¾‹</td><td><code>&#39;A&#39;</code>, <code>&#39;1&#39;</code>, <code>&#39;\n&#39;</code></td><td><code>&quot;Hello&quot;</code>, <code>&quot;123&quot;</code>, <code>&quot;&quot;</code></td></tr></tbody></table><h3 id="äº”ã€æ–¹æ³•"><a href="#äº”ã€æ–¹æ³•" class="headerlink" title="äº”ã€æ–¹æ³•"></a>äº”ã€æ–¹æ³•</h3><h4 id="5-1-ä»€ä¹ˆæ˜¯æ–¹æ³•"><a href="#5-1-ä»€ä¹ˆæ˜¯æ–¹æ³•" class="headerlink" title="5.1  ä»€ä¹ˆæ˜¯æ–¹æ³•"></a>5.1  ä»€ä¹ˆæ˜¯æ–¹æ³•</h4><p>ç•¥</p><h4 id="5-2-æ–¹æ³•çš„è¿”å›å€¼"><a href="#5-2-æ–¹æ³•çš„è¿”å›å€¼" class="headerlink" title="5.2 æ–¹æ³•çš„è¿”å›å€¼"></a>5.2 æ–¹æ³•çš„è¿”å›å€¼</h4><p>æ ¹æ®æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å’Œå‚æ•°ç±»å‹ï¼Œæ–¹æ³•å¯ä»¥åˆ†ä¸ºå‡ ç§ä¸åŒçš„ç±»åˆ«ã€‚</p><p>åŒºåˆ«ï¼š</p><table><thead><tr><th>ç±»åˆ«</th><th>è¿”å›å€¼ç±»å‹</th><th>å‚æ•°ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>æ— è¿”å›å€¼æ— å‚æ•°</td><td><code>void</code></td><td>æ— å‚æ•°</td><td>è¿™ç±»æ–¹æ³•ä¸è¿”å›ä»»ä½•å€¼ï¼Œä¹Ÿä¸æ¥å—ä»»ä½•å‚æ•°ã€‚</td></tr><tr><td>æ— è¿”å›å€¼æœ‰å‚æ•°</td><td><code>void</code></td><td>æœ‰å‚æ•°</td><td>è¿™ç±»æ–¹æ³•ä¸è¿”å›å€¼ï¼Œä½†æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚</td></tr><tr><td>æœ‰è¿”å›å€¼æ— å‚æ•°</td><td>é<code>void</code></td><td>æ— å‚æ•°</td><td>è¿™ç±»æ–¹æ³•è¿”å›ä¸€ä¸ªå€¼ï¼Œä½†ä¸æ¥å—ä»»ä½•å‚æ•°ã€‚</td></tr><tr><td>æœ‰è¿”å›å€¼æœ‰å‚æ•°</td><td>é<code>void</code></td><td>æœ‰å‚æ•°</td><td>è¿™ç±»æ–¹æ³•æ—¢è¿”å›ä¸€ä¸ªå€¼ï¼Œåˆæ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚</td></tr></tbody></table><blockquote><p>ä¾‹å­</p></blockquote><ol><li><strong>æ— è¿”å›å€¼æ— å‚æ•°</strong></li></ol><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f1</span>()</span> &#123;<br>    <span class="hljs-comment">//......</span><br>&#125;<br><span class="hljs-comment">// ä¸‹é¢è¿™ä¸ªæ–¹æ³•ä¹Ÿæ²¡æœ‰è¿”å›å€¼ï¼Œè™½ç„¶ç”¨åˆ°äº† return</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">f</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> a</span>)</span> &#123;<br>    <span class="hljs-keyword">if</span> (...) &#123;<br>        <span class="hljs-comment">// è¡¨ç¤ºç»“æŸæ–¹æ³•çš„æ‰§è¡Œ,ä¸‹æ–¹çš„è¾“å‡ºè¯­å¥ä¸ä¼šæ‰§è¡Œ</span><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    System.<span class="hljs-keyword">out</span>.println(a);<br>&#125;<br></code></pre></td></tr></table></figure><ol start="2"><li><p><strong>æ— è¿”å›å€¼æœ‰å‚æ•°</strong></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-function"><span class="hljs-title">public</span></span> void f2(<span class="hljs-keyword">Parameter</span> 1, ..., <span class="hljs-keyword">Parameter</span> <span class="hljs-comment">n) &#123;</span><br>    <span class="hljs-comment">//......</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>æœ‰è¿”å›å€¼æ— å‚æ•°</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">f3</span>()</span> &#123;<br>    <span class="hljs-comment">//......</span><br>    <span class="hljs-keyword">return</span> x;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>æœ‰è¿”å›å€¼æœ‰å‚æ•°</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title">f4</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> a * b;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="5-3-é™æ€æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•"><a href="#5-3-é™æ€æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•" class="headerlink" title="5.3 é™æ€æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•"></a>5.3 é™æ€æ–¹æ³•ä¸å®ä¾‹æ–¹æ³•</h4><blockquote><p>åŒºåˆ«</p></blockquote><p>é™æ€æ–¹æ³•ï¼ˆStatic Methodsï¼‰</p><ol><li><strong>å®šä¹‰</strong>: ä½¿ç”¨<code>static</code>å…³é”®å­—å®šä¹‰ã€‚</li><li><strong>è°ƒç”¨æ–¹å¼</strong>: å¯ä»¥é€šè¿‡ç±»åç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦åˆ›å»ºç±»çš„å¯¹è±¡ã€‚</li><li><strong>è®¿é—®</strong>: åªèƒ½ç›´æ¥è®¿é—®ç±»çš„é™æ€æˆå‘˜ï¼ˆå˜é‡å’Œæ–¹æ³•ï¼‰ã€‚ä¸èƒ½ç›´æ¥è®¿é—®å®ä¾‹æˆå‘˜ã€‚</li><li><strong>ç”¨é€”</strong>: å¸¸ç”¨äºä¸ä¾èµ–äºå¯¹è±¡çŠ¶æ€çš„å·¥å…·æˆ–å¸®åŠ©æ–¹æ³•ã€‚</li></ol><p>å®ä¾‹æ–¹æ³•ï¼ˆInstance Methodsï¼‰</p><ol><li><strong>å®šä¹‰</strong>: æ²¡æœ‰<code>static</code>å…³é”®å­—ï¼Œå±äºç±»çš„å®ä¾‹ã€‚</li><li><strong>è°ƒç”¨æ–¹å¼</strong>: éœ€è¦åˆ›å»ºç±»çš„å¯¹è±¡ï¼Œé€šè¿‡å¯¹è±¡è°ƒç”¨ã€‚</li><li><strong>è®¿é—®</strong>: å¯ä»¥è®¿é—®ç±»çš„å®ä¾‹æˆå‘˜ï¼ˆå˜é‡å’Œæ–¹æ³•ï¼‰ä»¥åŠé™æ€æˆå‘˜ã€‚</li><li><strong>ç”¨é€”</strong>: é€šå¸¸ç”¨äºæ“ä½œæˆ–è®¿é—®å¯¹è±¡çš„å®ä¾‹æ•°æ®ã€‚</li></ol><blockquote><p>æ¯”è¾ƒ</p></blockquote><table><thead><tr><th>ç‰¹æ€§</th><th>é™æ€æ–¹æ³•</th><th>å®ä¾‹æ–¹æ³•</th></tr></thead><tbody><tr><td>å®šä¹‰</td><td>ä½¿ç”¨ <code>static</code> å…³é”®å­—</td><td>æ²¡æœ‰ <code>static</code> å…³é”®å­—</td></tr><tr><td>è°ƒç”¨æ–¹å¼</td><td>é€šè¿‡ç±»åè°ƒç”¨ï¼ˆä¾‹å¦‚ <code>ClassName.method()</code>ï¼‰</td><td>é€šè¿‡å¯¹è±¡å®ä¾‹è°ƒç”¨ï¼ˆä¾‹å¦‚ <code>object.method()</code>ï¼‰</td></tr><tr><td>è®¿é—®ç±»çš„æˆå‘˜</td><td>åªèƒ½è®¿é—®é™æ€æˆå‘˜</td><td>å¯è®¿é—®å®ä¾‹æˆå‘˜å’Œé™æ€æˆå‘˜</td></tr><tr><td>å¯¹è±¡çŠ¶æ€ä¾èµ–</td><td>ä¸ä¾èµ–å¯¹è±¡çŠ¶æ€</td><td>ä¾èµ–æˆ–å¯è®¿é—®å¯¹è±¡çŠ¶æ€</td></tr><tr><td>å…¸å‹ç”¨é€”</td><td>å·¥å…·æ–¹æ³•ã€è®¡ç®—æ–¹æ³•ã€æ— éœ€å¯¹è±¡çŠ¶æ€çš„æ“ä½œ</td><td>æ“ä½œæˆ–è®¿é—®å¯¹è±¡çš„å®ä¾‹æ•°æ®</td></tr></tbody></table><blockquote><p>ç±»æ¯”</p></blockquote><ul><li><strong>é™æ€æ–¹æ³•</strong>: å°±åƒæ˜¯å¤§å­¦çš„å…¬å…±å›¾ä¹¦é¦†ï¼Œæ‰€æœ‰å­¦ç”Ÿï¼ˆç±»çš„å®ä¾‹ï¼‰éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†å®ƒä¸å±äºä»»ä½•ä¸€ä¸ªå­¦ç”Ÿã€‚</li><li><strong>å®ä¾‹æ–¹æ³•</strong>: å°±åƒå­¦ç”Ÿçš„ä¸ªäººç¬”è®°æœ¬ï¼Œæ¯ä¸ªå­¦ç”Ÿéƒ½æœ‰è‡ªå·±çš„ç¬”è®°æœ¬ï¼Œå¯ä»¥åœ¨å…¶ä¸­å†™ä¸‹è‡ªå·±çš„ç¬”è®°ï¼ˆå®ä¾‹æ•°æ®ï¼‰ï¼Œå¹¶ä¸”æ¯ä¸ªç¬”è®°æœ¬éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚</li></ul><hr><blockquote><p>é™æ€æ–¹æ³•ä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜</p></blockquote><p>ä¸»è¦åŸå› å¦‚ä¸‹ï¼š</p><ol><li>é™æ€æ–¹æ³•æ˜¯å±äºç±»çš„ï¼Œåœ¨ç±»åŠ è½½çš„æ—¶å€™å°±ä¼šåˆ†é…å†…å­˜ï¼Œå¯ä»¥é€šè¿‡ç±»åç›´æ¥è®¿é—®ã€‚è€Œéé™æ€æˆå‘˜å±äºå®ä¾‹å¯¹è±¡ï¼Œåªæœ‰åœ¨å¯¹è±¡å®ä¾‹åŒ–ä¹‹åæ‰å­˜åœ¨ï¼Œéœ€è¦é€šè¿‡ç±»çš„å®ä¾‹å¯¹è±¡å»è®¿é—®ã€‚</li><li>åœ¨ç±»çš„éé™æ€æˆå‘˜ä¸å­˜åœ¨çš„æ—¶å€™é™æ€æ–¹æ³•å°±å·²ç»å­˜åœ¨äº†ï¼Œæ­¤æ—¶è°ƒç”¨åœ¨å†…å­˜ä¸­è¿˜ä¸å­˜åœ¨çš„éé™æ€æˆå‘˜ï¼Œå±äºéæ³•æ“ä½œ</li></ol><h4 id="5-4-é‡è½½å’Œé‡å†™"><a href="#5-4-é‡è½½å’Œé‡å†™" class="headerlink" title="5.4 é‡è½½å’Œé‡å†™"></a>5.4 é‡è½½å’Œé‡å†™</h4><p>é‡è½½ï¼šï¼ˆåŒä¸€ä¸ªç±»ä¸­çš„æ“ä½œï¼‰</p><p>å‘ç”Ÿåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼ˆæˆ–è€…çˆ¶ç±»å’Œå­ç±»ä¹‹é—´ï¼‰ï¼Œæ–¹æ³•åå¿…é¡»ç›¸åŒï¼Œå‚æ•°ç±»å‹ä¸åŒã€ä¸ªæ•°ä¸åŒã€é¡ºåºä¸åŒï¼Œæ–¹æ³•è¿”å›å€¼å’Œè®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä¸åŒã€‚</p><p>é‡å†™ï¼šï¼ˆå­ç±»å¯¹çˆ¶ç±»çš„æ“ä½œï¼‰</p><p>é‡å†™å‘ç”Ÿåœ¨è¿è¡ŒæœŸï¼Œæ˜¯å­ç±»å¯¹çˆ¶ç±»çš„å…è®¸è®¿é—®çš„æ–¹æ³•çš„å®ç°è¿‡ç¨‹è¿›è¡Œé‡æ–°ç¼–å†™ã€‚</p><ol><li>æ–¹æ³•åã€å‚æ•°åˆ—è¡¨å¿…é¡»ç›¸åŒï¼Œå­ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹åº”æ¯”çˆ¶ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹æ›´å°æˆ–ç›¸ç­‰ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸èŒƒå›´å°äºç­‰äºçˆ¶ç±»ï¼Œè®¿é—®ä¿®é¥°ç¬¦èŒƒå›´å¤§äºç­‰äºçˆ¶ç±»ã€‚</li><li>å¦‚æœçˆ¶ç±»æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦ä¸º <code>private/final/static</code> åˆ™å­ç±»å°±ä¸èƒ½é‡å†™è¯¥æ–¹æ³•ï¼Œä½†æ˜¯è¢« <code>static</code> ä¿®é¥°çš„æ–¹æ³•èƒ½å¤Ÿè¢«å†æ¬¡å£°æ˜ã€‚</li><li>æ„é€ æ–¹æ³•æ— æ³•è¢«é‡å†™</li></ol><table><thead><tr><th>ç‰¹æ€§</th><th>é‡è½½ (Overloading)</th><th>é‡å†™ (Overriding)</th></tr></thead><tbody><tr><td>æ‰€åœ¨ä½ç½®</td><td>åŒä¸€ä¸ªç±»ä¸­</td><td>å­ç±»ä¸­</td></tr><tr><td>æ–¹æ³•å</td><td>å¿…é¡»ç›¸åŒ</td><td>å¿…é¡»ç›¸åŒ</td></tr><tr><td>å‚æ•°åˆ—è¡¨</td><td>å¿…é¡»ä¸åŒï¼ˆæ•°é‡ã€ç±»å‹æˆ–é¡ºåºï¼‰</td><td>å¿…é¡»ç›¸åŒ</td></tr><tr><td>è¿”å›ç±»å‹</td><td>å¯ä»¥ä¸åŒ</td><td>å¿…é¡»ä¸è¢«é‡å†™çš„æ–¹æ³•å…¼å®¹</td></tr><tr><td>è®¿é—®ä¿®é¥°ç¬¦</td><td>å¯ä»¥ä¸åŒ</td><td>ä¸èƒ½æ¯”çˆ¶ç±»æ–¹æ³•æ›´ä¸¥æ ¼</td></tr><tr><td>æŠ›å‡ºçš„å¼‚å¸¸</td><td>å¯ä»¥ä¸åŒ</td><td>ä¸èƒ½æŠ›å‡ºæ–°çš„æ£€æŸ¥å¼‚å¸¸æˆ–æ›´å¹¿æ³›çš„æ£€æŸ¥å¼‚å¸¸</td></tr><tr><td>å®ç°ç›®çš„</td><td>å¢åŠ åŒä¸€æ“ä½œçš„çµæ´»æ€§</td><td>å®ç°è¿è¡Œæ—¶å¤šæ€ï¼Œæä¾›ç‰¹å®šçš„å®ç°</td></tr></tbody></table><h5 id="é‡è½½å’Œé‡å†™-02"><a href="#é‡è½½å’Œé‡å†™-02" class="headerlink" title="é‡è½½å’Œé‡å†™_02"></a>é‡è½½å’Œé‡å†™_02</h5><blockquote><p>é‡è½½å’Œé‡å†™çš„åŒºåˆ«</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// ç¤ºä¾‹ï¼šé‡è½½å’Œé‡å†™çš„åŒºåˆ«</span><br><span class="hljs-keyword">class</span> <span class="hljs-title">ParentClass</span> &#123;<br>    <span class="hljs-comment">// æ–¹æ³•é‡å†™</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">display</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Parent display()&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title">ChildClass</span> <span class="hljs-title">extends</span> <span class="hljs-title">ParentClass</span> &#123;<br>    <span class="hljs-comment">// æ–¹æ³•é‡å†™</span><br>    @Override<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">display</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Child display()&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// æ–¹æ³•é‡è½½</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">display</span>(<span class="hljs-params">String message</span>)</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Child display() with Message: &quot;</span> + message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>é‡è½½ï¼ˆOverloadingï¼‰</strong>:</p><ul><li>å‘ç”Ÿåœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚</li><li>æŒ‡çš„æ˜¯ä¸€ä¸ªç±»ä¸­æœ‰å¤šä¸ªåŒåæ–¹æ³•ï¼Œä½†å®ƒä»¬çš„å‚æ•°åˆ—è¡¨ä¸åŒï¼ˆå‚æ•°çš„æ•°é‡ã€ç±»å‹æˆ–è€…é¡ºåºä¸åŒï¼‰ã€‚</li><li>ä¸æ–¹æ³•çš„è¿”å›ç±»å‹ã€è®¿é—®ä¿®é¥°ç¬¦æ— å…³ã€‚</li><li>ç¼–è¯‘æ—¶å¤šæ€ï¼šæ–¹æ³•è°ƒç”¨æ˜¯æ ¹æ®æ–¹æ³•ç­¾åï¼ˆæ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ï¼‰åœ¨ç¼–è¯‘æ—¶ç¡®å®šçš„ã€‚</li></ul><p><strong>é‡å†™ï¼ˆOverridingï¼‰</strong>:</p><ul><li>å‘ç”Ÿåœ¨çˆ¶å­ç±»ä¹‹é—´ã€‚</li><li>å­ç±»æä¾›äº†ä¸€ä¸ªå…·æœ‰ç›¸åŒåç§°ã€è¿”å›ç±»å‹åŠå‚æ•°åˆ—è¡¨çš„æ–¹æ³•ï¼Œç”¨ä»¥é‡å†™ï¼ˆè¦†ç›–ï¼‰çˆ¶ç±»ä¸­çš„ç›¸åº”æ–¹æ³•ã€‚</li><li>è®¿é—®æƒé™ä¸èƒ½æ¯”çˆ¶ç±»ä¸­è¢«é‡å†™çš„æ–¹æ³•æ›´ä¸¥æ ¼ã€‚</li><li>è¿è¡Œæ—¶å¤šæ€ï¼šå…·ä½“è°ƒç”¨å“ªä¸ªæ–¹æ³•æ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹ç¡®å®šçš„ã€‚</li><li>å¿…é¡»ä¿æŒä¸€è‡´çš„å¼‚å¸¸å£°æ˜ï¼ˆæˆ–ä¸å£°æ˜å¼‚å¸¸ï¼‰ã€‚</li></ul><p>è¿™ä¸¤ç§æœºåˆ¶æ˜¯Javaå®ç°å¤šæ€æ€§çš„é‡è¦æ‰‹æ®µã€‚é‡è½½å…è®¸åŒä¸€ä¸ªç±»ä¸­å®šä¹‰åŠŸèƒ½ç›¸ä¼¼ä½†å‚æ•°ä¸åŒçš„æ–¹æ³•ï¼Œè€Œé‡å†™åˆ™å…è®¸å­ç±»æ”¹å˜æˆ–æ‰©å±•ä»çˆ¶ç±»ç»§æ‰¿çš„è¡Œä¸º.</p><blockquote><p>é‡è½½ä¸æ–¹æ³•çš„è¿”å›ç±»å‹ã€è®¿é—®ä¿®é¥°ç¬¦æ— å…³</p></blockquote><p>åœ¨Javaä¸­ï¼Œæ–¹æ³•é‡è½½ï¼ˆOverloadingï¼‰çš„å®šä¹‰æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªç±»ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªåŒåæ–¹æ³•ï¼Œåªè¦å®ƒä»¬çš„å‚æ•°åˆ—è¡¨ä¸åŒå³å¯ã€‚è¿™é‡Œçš„â€œå‚æ•°åˆ—è¡¨ä¸åŒâ€å¯ä»¥æ˜¯å‚æ•°çš„æ•°é‡ã€ç±»å‹æˆ–è€…å‚æ•°é¡ºåºçš„ä¸åŒã€‚</p><p>å½“æåˆ°â€œä¸æ–¹æ³•çš„è¿”å›ç±»å‹ã€è®¿é—®ä¿®é¥°ç¬¦æ— å…³â€æ—¶ï¼Œæ„æ€æ˜¯ï¼š</p><ol><li><strong>è¿”å›ç±»å‹æ— å…³</strong>:<ul><li>é‡è½½çš„æ–¹æ³•å¯ä»¥æœ‰ä¸åŒçš„è¿”å›ç±»å‹ã€‚æ–¹æ³•çš„è¿”å›ç±»å‹ä¸æ˜¯é‡è½½è€ƒè™‘çš„å› ç´ ã€‚</li><li>æ¯”å¦‚ï¼Œä½ å¯ä»¥æœ‰ä¸€ä¸ªè¿”å›<code>void</code>çš„<code>display()</code>æ–¹æ³•å’Œä¸€ä¸ªè¿”å›<code>String</code>çš„<code>display(String message)</code>æ–¹æ³•ã€‚</li></ul></li><li><strong>è®¿é—®ä¿®é¥°ç¬¦æ— å…³</strong>:<ul><li>é‡è½½çš„æ–¹æ³•å¯ä»¥æœ‰ä¸åŒçš„è®¿é—®æƒé™ï¼ˆå¦‚<code>public</code>ã€<code>private</code>ç­‰ï¼‰ã€‚</li><li>é‡è½½ä»…ä»…å…³æ³¨äºæ–¹æ³•çš„åç§°å’Œå‚æ•°åˆ—è¡¨ã€‚</li></ul></li></ol><p>è¿™æ„å‘³ç€ï¼Œå½“ä½ é‡è½½ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œä½ å¯ä»¥æ”¹å˜å®ƒçš„è¿”å›ç±»å‹å’Œè®¿é—®ä¿®é¥°ç¬¦ï¼Œä½†è¿™ä¸ä¼šå½±å“åˆ°é‡è½½çš„æœ¬è´¨ã€‚é‡è½½å®Œå…¨æ˜¯åŸºäºæ–¹æ³•çš„å‚æ•°åˆ—è¡¨çš„ã€‚é‡è½½æä¾›äº†ä¸€ç§ä¾¿åˆ©ï¼Œä½¿å¾—ä½ å¯ä»¥ç”¨åŒä¸€ä¸ªæ–¹æ³•åæ¥å®šä¹‰åšç›¸ä¼¼äº‹æƒ…ä½†å‚æ•°ä¸åŒçš„æ–¹æ³•ã€‚</p><h4 id="5-5-å¯å˜é•¿å‚æ•°"><a href="#5-5-å¯å˜é•¿å‚æ•°" class="headerlink" title="5.5 å¯å˜é•¿å‚æ•°"></a>5.5 å¯å˜é•¿å‚æ•°</h4><p>ç•¥</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/java/basis/java-basic-questions-01.html">https://javaguide.cn/java/basis/java-basic-questions-01.html</a></li><li><a href="https://www.yuque.com/snailclimb/mf2z3k/gre6gr">https://www.yuque.com/snailclimb/mf2z3k/gre6gr</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>Base</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Excel å¤§æ‰¹é‡å¯¼å…¥å¯¼å‡ºæ“ä½œä¼˜åŒ–</title>
    <link href="/2024/01/05/Excel%20%E5%A4%A7%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E6%93%8D%E4%BD%9C%E4%BC%98%E5%8C%96/"/>
    <url>/2024/01/05/Excel%20%E5%A4%A7%E6%89%B9%E9%87%8F%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E6%93%8D%E4%BD%9C%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€Java-ä¸­çš„æµè¡Œåº“"><a href="#1ã€Java-ä¸­çš„æµè¡Œåº“" class="headerlink" title="1ã€Java ä¸­çš„æµè¡Œåº“"></a>1ã€Java ä¸­çš„æµè¡Œåº“</h3><p>Java å¯¹ Excel çš„å¸¸ç”¨æ“ä½œé€šå¸¸æ¶‰åŠè¯»å–ã€åˆ›å»ºã€ç¼–è¾‘å’Œä¿å­˜ Excel æ–‡ä»¶ã€‚</p><p>è¿™äº›æ“ä½œä¸»è¦é€šè¿‡ Apache POI å’Œ jExcelAPI è¿™ä¸¤ä¸ªæµè¡Œçš„åº“æ¥å®ç°ã€‚Apache POI æ”¯æŒè€å¼çš„ Excel XLS æ ¼å¼å’Œè¾ƒæ–°çš„ XLSX æ ¼å¼ï¼Œè€Œ jExcelAPI ä¸»è¦ç”¨äºå¤„ç† XLS æ–‡ä»¶ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ“ä½œç¤ºä¾‹ï¼š</p><h4 id="Apache-POI"><a href="#Apache-POI" class="headerlink" title="Apache POI"></a>Apache POI</h4><p>Apache POI æ˜¯å¤„ç† Microsoft Office æ–‡æ¡£çš„æµè¡Œ Java åº“ï¼Œç‰¹åˆ«æ˜¯ Excel æ–‡æ¡£ï¼ˆåŒ…æ‹¬ XLS å’Œ XLSX æ ¼å¼ï¼‰ã€‚</p><p>POI æä¾›äº†ä¸åŒçš„æ¨¡å‹æ¥å¤„ç† Excel æ–‡æ¡£ï¼Œä¸»è¦åŒ…æ‹¬ HSSFï¼ˆç”¨äº <code>.xls</code> æ ¼å¼ï¼‰ã€XSSFï¼ˆç”¨äº <code>.xlsx</code> æ ¼å¼ï¼‰ä»¥åŠ SXSSFï¼ˆç”¨äºå¤„ç†å¤§å‹ <code>.xlsx</code> æ–‡ä»¶çš„æ‰©å±•ç‰ˆæœ¬ï¼‰ã€‚åœ¨å¤„ç† <code>.xlsx</code> æ ¼å¼æ–‡ä»¶æ—¶ï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯ XSSF å’Œ SXSSFã€‚</p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- åŸºæœ¬ä¾èµ–ï¼Œä»…æ“ä½œ xls æ ¼å¼åªéœ€å¼•å…¥æ­¤ä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.poi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>poi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.14<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- ä½¿ç”¨ xlsx æ ¼å¼éœ€è¦é¢å¤–å¼•å…¥æ­¤ä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.poi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>poi-ooxml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.14<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ¼”ç¤ºä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ruoyi.luoqi.excel;<br><br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Cell;<br><span class="hljs-keyword">import</span> org.apache.poi.ss.usermodel.Row;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;<br><span class="hljs-keyword">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> luoqi</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> ApachePOITestOperation.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/3 15:18</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApachePOITestOperation</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            writeExcel();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readExcel</span><span class="hljs-params">()</span>  <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;path/to/excel.xlsx&quot;</span>));<br>        <span class="hljs-type">XSSFWorkbook</span> <span class="hljs-variable">workbook</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XSSFWorkbook</span>(file);<br>        <span class="hljs-comment">//è¯»å–å·¥ä½œè¡¨</span><br>        <span class="hljs-type">XSSFSheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> workbook.getSheetAt(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">//éå†è¡Œä¸å•å…ƒæ ¼</span><br>        <span class="hljs-keyword">for</span> (Row row : sheet) &#123;<br>            <span class="hljs-keyword">for</span> (Cell cell : row) &#123;<br>                <span class="hljs-keyword">switch</span> (cell.getCellType()) &#123;<br>                    <span class="hljs-keyword">case</span> STRING: System.out.print(cell.getStringCellValue() + <span class="hljs-string">&quot; &quot;</span>);<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> NUMERIC: System.out.print(cell.getNumericCellValue() + <span class="hljs-string">&quot; &quot;</span>);<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">case</span> BOOLEAN: System.out.print(cell.getBooleanCellValue() + <span class="hljs-string">&quot; &quot;</span>);<br>                        <span class="hljs-keyword">break</span>;<br>                    <span class="hljs-keyword">default</span>:<br>                &#125;<br>            &#125;<br>            System.out.println();<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeExcel</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">//åˆ›å»º Excel æ–‡ä»¶</span><br>        <span class="hljs-type">XSSFWorkbook</span> <span class="hljs-variable">workbook</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XSSFWorkbook</span>();<br>        <span class="hljs-type">XSSFSheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> workbook.createSheet(<span class="hljs-string">&quot;Name of the Sheet&quot;</span>);<br>        <span class="hljs-comment">//åˆ›å»ºè¡Œå’Œå•å…ƒæ ¼</span><br>        <span class="hljs-type">Row</span> <span class="hljs-variable">row</span> <span class="hljs-operator">=</span> sheet.createRow(<span class="hljs-number">0</span>);<br>        <span class="hljs-type">Cell</span> <span class="hljs-variable">cell</span> <span class="hljs-operator">=</span> row.createCell(<span class="hljs-number">0</span>);<br>        cell.setCellValue(<span class="hljs-string">&quot;Cell Value&quot;</span>);<br>        <span class="hljs-comment">//ä¿å­˜ Excel æ“ä½œ</span><br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;path/to/excel2.xlsx&quot;</span>));<br>        workbook.write(out);<br>        out.close();<br>        workbook.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="jExcelAPI"><a href="#jExcelAPI" class="headerlink" title="jExcelAPI"></a>jExcelAPI</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sourceforge.jexcelapi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jxl<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ¼”ç¤ºä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ruoyi.luoqi.excel;<br><span class="hljs-keyword">import</span> jxl.Cell;<br><span class="hljs-keyword">import</span> jxl.Sheet;<br><span class="hljs-keyword">import</span> jxl.Workbook;<br><span class="hljs-keyword">import</span> jxl.read.biff.BiffException;<br><span class="hljs-keyword">import</span> jxl.write.Label;<br><span class="hljs-keyword">import</span> jxl.write.WritableSheet;<br><span class="hljs-keyword">import</span> jxl.write.WritableWorkbook;<br><span class="hljs-keyword">import</span> jxl.write.WriteException;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> luoqi</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> jExcelAPITestOpeartion.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/3 15:56</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JExcelAPITestOpeartion</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">JExcelAPITestOpeartion</span> <span class="hljs-variable">jExcelAPITestOpeartion</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JExcelAPITestOpeartion</span>();<br>            jExcelAPITestOpeartion.readExcel();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (BiffException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">readExcel</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, BiffException &#123;<br>        <span class="hljs-comment">//è¯»å–Excel æ“ä½œ</span><br>        <span class="hljs-type">Workbook</span> <span class="hljs-variable">workbook</span> <span class="hljs-operator">=</span> Workbook.getWorkbook(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;path/to/excel.xls&quot;</span>));<br>        <span class="hljs-comment">//è¯»å–å·¥ä½œè¡¨</span><br>        <span class="hljs-type">Sheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> workbook.getSheet(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">//è¯»å–å†…å®¹</span><br>        <span class="hljs-type">Cell</span> <span class="hljs-variable">cell</span> <span class="hljs-operator">=</span> sheet.getCell(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> cell.getContents();<br>        System.out.println(content);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeExcel</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, WriteException &#123;<br>        <span class="hljs-type">WritableWorkbook</span> <span class="hljs-variable">workbook</span> <span class="hljs-operator">=</span> Workbook.createWorkbook(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;path/to/excel.xls&quot;</span>));<br>        <span class="hljs-type">WritableSheet</span> <span class="hljs-variable">sheet</span> <span class="hljs-operator">=</span> workbook.createSheet(<span class="hljs-string">&quot;Sheet Name&quot;</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-type">Label</span> <span class="hljs-variable">label</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Label</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;Content&quot;</span>);<br>        sheet.addCell(label);<br>        workbook.write();<br>        workbook.close();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€Excelçš„å­˜å‚¨æ ¼å¼"><a href="#2ã€Excelçš„å­˜å‚¨æ ¼å¼" class="headerlink" title="2ã€Excelçš„å­˜å‚¨æ ¼å¼"></a>2ã€Excelçš„å­˜å‚¨æ ¼å¼</h3><p>å‚è€ƒï¼š <a href="https://albenw.github.io/posts/d093ca4e/">https://albenw.github.io/posts/d093ca4e/</a></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240404004217.png" alt="image.png"></p><p>Excelçš„å­˜å‚¨æ ¼å¼</p><ul><li>XLS<ul><li>XLSä¸€ä¸ªSheetæœ€å¤šä¹Ÿåªèƒ½æœ‰ 65535 è¡Œæ•°æ®</li><li>æ¯ä¸ªSheetæœ€å¤šåªèƒ½æœ‰ 256 åˆ—ï¼ˆä»Aåˆ°IVï¼‰</li></ul></li><li>XLSXï¼ˆåº•å±‚ä½¿ç”¨xmlå­˜å‚¨ï¼‰<ul><li>ä¸€ä¸ªSheetæœ€å¤šå¯ä»¥æœ‰ 1048576 è¡Œæ•°æ®</li><li>æ¯ä¸ªSheetæœ€å¤šå¯ä»¥æœ‰ 16384 åˆ—ï¼ˆä»Aåˆ°XFDï¼‰</li><li>æ–‡ä»¶å¤§å°æ›´å°</li></ul></li></ul><h4 id="å¯¼å‡ºä¼˜åŒ–"><a href="#å¯¼å‡ºä¼˜åŒ–" class="headerlink" title="å¯¼å‡ºä¼˜åŒ–"></a>å¯¼å‡ºä¼˜åŒ–</h4><p>å»ºè®®å¯ä»¥é‡‡ç”¨ï¼š SXSSFWorkbook æ–¹å¼ã€‚</p><h4 id="å¯¼å…¥ä¼˜åŒ–"><a href="#å¯¼å…¥ä¼˜åŒ–" class="headerlink" title="å¯¼å…¥ä¼˜åŒ–"></a>å¯¼å…¥ä¼˜åŒ–</h4><p>å®˜ç½‘ç¤ºä¾‹ï¼š  <a href="https://poi.apache.org/components/spreadsheet/how-to.html">https://poi.apache.org/components/spreadsheet/how-to.html</a></p><p>POIå¯¹å¯¼å…¥åˆ†ä¸º3ç§æ¨¡å¼ï¼Œç”¨æˆ·æ¨¡å¼ User Modelï¼Œäº‹ä»¶æ¨¡å¼ Event Modelï¼Œè¿˜æœ‰ Event User Modelã€‚</p><ul><li>POIå¯¹XLSæ”¯æŒ Event Model</li><li>POIå¯¹ XLSX æ”¯æŒ Event Model å’Œ Event User Model</li></ul><p>é»˜è®¤é‡‡ç”¨ï¼š</p><p>Apache POI åœ¨å¤„ç† <code>.xlsx</code> æ–‡ä»¶æ—¶é»˜è®¤é‡‡ç”¨çš„æ˜¯ User Modelï¼Œå®ƒæä¾›äº†æ›´ç›´è§‚ã€æ›´çµæ´»çš„æ–¹å¼æ¥å¤„ç† Excel æ–‡ä»¶ï¼Œä½†ä»£ä»·æ˜¯è¾ƒé«˜çš„å†…å­˜æ¶ˆè€—ã€‚å½“å¤„ç†å¤§å‹æ–‡ä»¶æˆ–éœ€è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Event Model æˆ– Event User Modelï¼Œå°½ç®¡è¿™éœ€è¦æ›´å¤æ‚çš„å®ç°é€»è¾‘ã€‚</p><p>å…·ä½“å®ç°çš„è¯ï¼Œå¯èƒ½ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œéœ€è¦è‡ªå®šä¹‰ä¸€äº›ç›¸å…³çš„é…ç½®å’Œå¤„ç†ã€‚</p><hr><h3 id="3ã€EasyExcel"><a href="#3ã€EasyExcel" class="headerlink" title="3ã€EasyExcel"></a>3ã€EasyExcel</h3><p>å¯¹äºå¯¼å…¥çš„ä¸€äº›ä¼˜åŒ–æ“ä½œï¼š</p><p>å‡†å¤‡ç¯å¢ƒï¼š</p><ul><li>ä½¿ç”¨ .xlsx æ–‡ä»¶</li><li>å¯¼å…¥çš„æ—¶å€™éœ€è¦è¿›è¡Œæ•°æ®æ ¡éªŒ<ul><li>æ•°æ®æ ¡éªŒæœ‰ä¸¤ç§ï¼š<ul><li>å­—æ®µé•¿åº¦ã€å­—æ®µæ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒç­‰ï¼Œå†…å­˜å†…æ ¡éªŒä¸å­˜åœ¨å¤–éƒ¨æ•°æ®äº¤äº’ã€‚å¯¹æ€§èƒ½å½±å“è¾ƒå°ã€‚</li><li>æ•°æ®é‡å¤æ€§æ ¡éªŒ(éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œååˆ†å½±å“æ€§èƒ½)ã€‚</li></ul></li></ul></li><li>æ ¡éªŒå®Œæˆåï¼Œè¿›è¡Œæ•°æ®å¯¼å…¥æ“ä½œã€‚<ul><li>è¿™é‡Œçš„ç¯å¢ƒæ˜¯ï¼šæ•°æ®åº“ä½¿ç”¨ MySQL 5.7ï¼Œæœªåˆ†åº“åˆ†è¡¨ï¼Œè¿æ¥æ± ä½¿ç”¨ Druid</li></ul></li></ul><p>è¿­ä»£è®°å½•ï¼š</p><ul><li><ol><li>POI + é€è¡ŒæŸ¥è¯¢æ ¡å¯¹ + é€è¡Œæ’å…¥</li></ol></li><li><ol start="2"><li>EasyPOI + ç¼“å­˜æ•°æ®åº“æŸ¥è¯¢æ“ä½œ + æ‰¹é‡æ’å…¥</li></ol></li><li><ol start="3"><li>EasyExcel + ç¼“å­˜æ•°æ®åº“æŸ¥è¯¢æ“ä½œ + æ‰¹é‡æ’å…¥</li></ol></li></ul><h4 id="ä¼˜åŒ–å»ºè®®"><a href="#ä¼˜åŒ–å»ºè®®" class="headerlink" title="ä¼˜åŒ–å»ºè®®"></a>ä¼˜åŒ–å»ºè®®</h4><p>æå‡Excelå¯¼å…¥é€Ÿåº¦çš„æ–¹æ³•ï¼š</p><ul><li>ä½¿ç”¨æ›´å¿«çš„ Excel è¯»å–æ¡†æ¶(æ¨èä½¿ç”¨é˜¿é‡Œ EasyExcel)ã€‚</li><li>å¯¹äºéœ€è¦<strong>ä¸æ•°æ®åº“äº¤äº’çš„æ ¡éªŒ</strong>ã€æŒ‰ç…§ä¸šåŠ¡é€»è¾‘é€‚å½“çš„ä½¿ç”¨ç¼“å­˜ã€‚ç”¨ç©ºé—´æ¢æ—¶é—´ã€‚</li><li>ä½¿ç”¨ values( ),( ),( ) æ‹¼æ¥é•¿ SQL ä¸€æ¬¡æ’å…¥å¤šè¡Œæ•°æ®ã€‚</li><li>ä½¿ç”¨å¤šçº¿ç¨‹æ’å…¥æ•°æ®ï¼Œåˆ©ç”¨æ‰ç½‘ç»œIOç­‰å¾…æ—¶é—´(æ¨èä½¿ç”¨å¹¶è¡Œæµï¼Œç®€å•æ˜“ç”¨)ã€‚</li><li>é¿å…åœ¨å¾ªç¯ä¸­æ‰“å°æ— ç”¨çš„æ—¥å¿—ã€‚</li></ul><hr><p>è¿™é‡Œæ˜¯ä½¿ç”¨çš„ è‹¥ä¾ åˆ†ç¦»ç‰ˆè¿›è¡ŒäºŒæ¬¡æ”¹é€ </p><p>å•ç‹¬æ–°å¢äº†ä¸€ä¸ªé¡µé¢ï¼Œç”¨äºå¯¼å…¥æ“ä½œ</p><p>å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>easyexcel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…·ä½“æ“ä½œ</p><ul><li>1ã€å®šä¹‰å®ä½“ç±»</li><li>2ã€å®šä¹‰å­—å…¸è½¬æ¢ï¼ˆå¦‚æœéœ€è¦ï¼Œå¯¼å‡ºæˆ–è€…å¯¼å…¥æ“ä½œï¼‰</li><li>3ã€å®šä¹‰å¯¼å…¥å’Œå¯¼å‡ºæ¥å£ï¼ˆæœ€ç®€å•ï¼‰</li><li>4ã€è€ƒè™‘å¦‚ä½•è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶é€šè¿‡ä¸åŒç¤ºä¾‹å»æŒæ¡å…·ä½“ä½¿ç”¨ã€‚</li></ul><p>å‚è€ƒï¼š <a href="https://zhuanlan.zhihu.com/p/641135306">https://zhuanlan.zhihu.com/p/641135306</a></p><p>å®ä½“ç±»ï¼š</p><p>è¿™é‡Œå®šä¹‰ä¸€ä¸ªè½¦è¾†è®¢å•çš„ä¿¡æ¯</p><p>å…ˆè¿›è¡Œæ•°æ®åº“è¡¨è®¾è®¡ï¼Œå†åšå®ä½“ç±»çš„æ˜ å°„å…³ç³»ï¼Œè¿™é‡Œä¸ä½¿ç”¨å‰ç«¯ï¼Œå°±ä½¿ç”¨åç«¯æ¥å£è¿›è¡Œæµ‹è¯•æ“ä½œã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs">è®¢å•å·<br>è®¢å•çŠ¶æ€<br>ä¸‹å•æ—¶é—´<br>æ’åºå·<br>VINå·<br></code></pre></td></tr></table></figure><p>åˆ›å»ºè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> orders (<br>    order_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    order_status <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    order_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    sort_number <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    vin_number <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    <span class="hljs-keyword">PRIMARY</span> KEY (order_id)<br>);<br></code></pre></td></tr></table></figure><p>é€šè¿‡è‹¥ä»¥çš„ä»£ç ç”Ÿæˆï¼Œç”Ÿæˆä¸€ä¸‹åç«¯çš„ä»£ç </p><p>ç»†èŠ‚æ–‡ä»¶è¿™é‡Œè·³è¿‡</p><ul><li>Orders</li><li>OrdersController</li><li>IOrdersService</li><li>OrdersServiceImpl</li><li>OrdersMapper</li><li>OrdersMapper.xml</li></ul><h4 id="æµ‹è¯•æ‰¹é‡æ’å…¥æ“ä½œ"><a href="#æµ‹è¯•æ‰¹é‡æ’å…¥æ“ä½œ" class="headerlink" title="æµ‹è¯•æ‰¹é‡æ’å…¥æ“ä½œ"></a>æµ‹è¯•æ‰¹é‡æ’å…¥æ“ä½œ</h4><p>OrdersExcelOpertaion</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ruoyi.luoqi.excel;<br><span class="hljs-keyword">import</span> com.ruoyi.system.domain.Orders;<br><span class="hljs-keyword">import</span> com.ruoyi.system.service.IOrdersService;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Date;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Random;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> luoqi</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> OrdersDataInsertOpertaion.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/5 10:08</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrdersDataInsertOpertaion</span> &#123;<br><br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> IOrdersService ordersService;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSomeServiceMethod</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">startNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">endNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br>        <span class="hljs-comment">//è®¡ç®—è€—æ—¶</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> startNum;i&lt;= endNum ;i ++)&#123;<br>            <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>            orders.setOrderId(String.valueOf(i));<br>            orders.setOrderStatus(<span class="hljs-string">&quot;20&quot;</span>);<br>            orders.setSortNumber((<span class="hljs-type">long</span>) i);<br>            orders.setVinNumber(getRandomSeventeenLength());<br>            orders.setOrderTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            ordersService.insertOrders(orders);<br>        &#125;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(<span class="hljs-string">&quot;æ–¹æ³•æ‰§è¡Œè€—æ—¶: &quot;</span> + (endTime - startTime) + <span class="hljs-string">&quot; æ¯«ç§’&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSomeServiceMethodBatch</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè®¢å•åˆ—è¡¨ç”¨äºæ‰¹é‡æ’å…¥</span><br>        List&lt;Orders&gt; ordersList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">startNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">2001</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">endNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;<br>        <span class="hljs-comment">//è®¡ç®—è€—æ—¶</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> startNum;i&lt;= endNum ;i ++)&#123;<br>            <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>            orders.setOrderId(String.valueOf(i));<br>            orders.setOrderStatus(<span class="hljs-string">&quot;20&quot;</span>);<br>            orders.setSortNumber((<span class="hljs-type">long</span>) i);<br>            orders.setVinNumber(getRandomSeventeenLength());<br>            orders.setOrderTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            ordersList.add(orders);<br>        &#125;<br>        ordersService.insertOrdersList(ordersList);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(<span class="hljs-string">&quot;æ–¹æ³•æ‰§è¡Œè€—æ—¶: &quot;</span> + (endTime - startTime) + <span class="hljs-string">&quot; æ¯«ç§’&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSomeServiceMethodBatchUpdate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//MySQLé»˜è®¤çš„æœ€å¤§åŒ…å¤§å°æ˜¯4MBï¼ˆå¯é€šè¿‡max_allowed_packetå‚æ•°è°ƒæ•´ï¼‰ï¼Œè¿™æ„å‘³ç€ä¸€æ¬¡æ‰¹é‡æ’å…¥æ“ä½œçš„æ•°æ®æ€»é‡ä¸èƒ½è¶…è¿‡è¿™ä¸ªé™åˆ¶</span><br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè®¢å•åˆ—è¡¨ç”¨äºæ‰¹é‡æ’å…¥</span><br>        List&lt;Orders&gt; ordersList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">startNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">10001</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">endNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">20000</span>;<br>        <span class="hljs-comment">//è®¡ç®—è€—æ—¶</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> startNum;i&lt;= endNum ;i ++)&#123;<br>            <span class="hljs-type">Orders</span> <span class="hljs-variable">orders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();<br>            orders.setOrderId(String.valueOf(i));<br>            orders.setOrderStatus(<span class="hljs-string">&quot;20&quot;</span>);<br>            orders.setSortNumber((<span class="hljs-type">long</span>) i);<br>            orders.setVinNumber(getRandomSeventeenLength());<br>            orders.setOrderTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            ordersList.add(orders);<br>        &#125;<br>        <span class="hljs-comment">//æ‰¹é‡å¤§å°çš„æ§åˆ¶çœ‹å®é™…æƒ…å†µï¼Œä¸€æ–¹é¢è¦è€ƒè™‘å®é™…æ’å…¥å¤§å°ï¼ˆåŒ…æ‹¬æ•°æ®å¤æ‚çš„ç¨‹åº¦ï¼‰ï¼Œå¦ä¸€æ–¹é¢è¿˜è¦è€ƒè™‘ç½‘ç»œã€æ•°æ®åº“ç­‰çš„å½±å“</span><br>        ordersService.batchInsert(ordersList,<span class="hljs-number">1000</span>);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        System.out.println(<span class="hljs-string">&quot;æ–¹æ³•æ‰§è¡Œè€—æ—¶: &quot;</span> + (endTime - startTime) + <span class="hljs-string">&quot; æ¯«ç§’&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRandomSeventeenLength</span><span class="hljs-params">()</span>  &#123;<br>        <span class="hljs-type">Random</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-number">17</span>);<br><br>        <span class="hljs-comment">// å®šä¹‰å¯èƒ½å‡ºç°çš„å­—ç¬¦é›†</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">characters</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">17</span>; i++) &#123;<br>            <span class="hljs-comment">// éšæœºé€‰æ‹©ä¸€ä¸ªå­—ç¬¦</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> random.nextInt(characters.length());<br>            sb.append(characters.charAt(index));<br>        &#125;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">randomString</span> <span class="hljs-operator">=</span> sb.toString();<br>        <span class="hljs-keyword">return</span> randomString;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç‰¹æ„è¯´ä¸€ä¸‹è¿™ä¸ªåˆ†é…æ’å…¥è¿™é‡Œï¼Œè¿™é‡Œæ˜¯åœ¨ service æ·»åŠ äº†ä¸€ä¸‹äº‹åŠ¡æ§åˆ¶</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs arduino">@Override  <br>@<span class="hljs-function">Transactional  </span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">batchInsert</span><span class="hljs-params">(List&lt;Orders&gt; allOrders, <span class="hljs-type">int</span> batchSize)</span> </span>&#123;  <br>    <span class="hljs-comment">// åˆ†æ‰¹å¤„ç†æ•°æ®  </span><br>    <span class="hljs-type">int</span> totalSize = allOrders.<span class="hljs-built_in">size</span>();  <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; totalSize; i += batchSize) &#123;  <br>        <span class="hljs-type">int</span> end = Math.<span class="hljs-built_in">min</span>(totalSize, i + batchSize);  <br>        List&lt;Orders&gt; batchList = allOrders.<span class="hljs-built_in">subList</span>(i, end);  <br>        <span class="hljs-comment">// æ‰§è¡Œæ‰¹é‡æ’å…¥  </span><br>        ordersMapper.<span class="hljs-built_in">insertOrdersList</span>(batchList);  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•æ•°æ®æ·»åŠ çš„æƒ…å†µ</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">éå†æ’å…¥1000æ¡æ•°æ®ï¼Œæ–¹æ³•æ‰§è¡Œè€—æ—¶</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1465 æ¯«ç§’</span><br><br><span class="hljs-attribute">æ‰¹é‡æ’å…¥1000æ¡æ•°æ®ï¼Œæ–¹æ³•æ‰§è¡Œè€—æ—¶</span><span class="hljs-punctuation">:</span> <span class="hljs-string">205 æ¯«ç§’</span><br><br><span class="hljs-attribute">æ‰¹é‡æ’å…¥8000æ¡æ•°æ®ï¼Œæ–¹æ³•æ‰§è¡Œè€—æ—¶</span><span class="hljs-punctuation">:</span> <span class="hljs-string">699 æ¯«ç§’</span><br><br><span class="hljs-attribute">åˆ†æ‰¹é‡æ’å…¥ 10000æ¡æ•°æ®ï¼Œæ¯æ¬¡æ’å…¥1000æ¡ï¼Œæ–¹æ³•æ‰§è¡Œè€—æ—¶</span><span class="hljs-punctuation">:</span> <span class="hljs-string">650 æ¯«ç§’</span><br><br><span class="hljs-attribute">åˆ†æ‰¹é‡æ’å…¥ 20000æ¡æ•°æ®ï¼Œæ¯æ¬¡æ’å…¥1000æ¡ï¼Œæ–¹æ³•æ‰§è¡Œè€—æ—¶</span><span class="hljs-punctuation">:</span> <span class="hljs-string">875 æ¯«ç§’</span><br></code></pre></td></tr></table></figure><p>åˆ†æ‰¹é‡çš„æƒ…å†µä¸‹çš„ç¡®ä¼šå¥½å¾ˆå¤š</p><h4 id="è‡ªå®šä¹‰å¯¼å‡º-Excel-æ³¨è§£"><a href="#è‡ªå®šä¹‰å¯¼å‡º-Excel-æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰å¯¼å‡º Excel æ³¨è§£"></a>è‡ªå®šä¹‰å¯¼å‡º Excel æ³¨è§£</h4><p>åœ¨å®é™…ä½¿ç”¨åˆ° è‹¥ä¾ çš„åˆ†ç¦»ç‰ˆé¡¹ç›®çš„æ—¶å€™ï¼Œä»–è¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨ easyexcel ï¼Œä»ç„¶ä½¿ç”¨çš„æ˜¯ poi ï¼Œç„¶åä½¿ç”¨äº† è‡ªå®šä¹‰æ³¨è§£çš„æ–¹å¼ã€‚</p><p>SysLogininfor  å¾…åˆ†æ</p><p>to be continedâ€¦.</p><h4 id="EasyExcel-çš„ä¸€äº›åŸºç¡€æ“ä½œ"><a href="#EasyExcel-çš„ä¸€äº›åŸºç¡€æ“ä½œ" class="headerlink" title="EasyExcel çš„ä¸€äº›åŸºç¡€æ“ä½œ"></a>EasyExcel çš„ä¸€äº›åŸºç¡€æ“ä½œ</h4><p>å¸¸ç”¨çš„ä¸€äº›æ³¨è§£å±æ€§ï¼Œä¸€èˆ¬åœ¨ domain ç±»ä¸Šä½¿ç”¨</p><ul><li><strong>@ExcelPropertyï¼š</strong>Â æ ¸å¿ƒæ³¨è§£ï¼Œvalueå±æ€§å¯ç”¨æ¥è®¾ç½®è¡¨å¤´åç§°ï¼Œconverterå±æ€§å¯ä»¥ç”¨æ¥è®¾ç½®ç±»å‹è½¬æ¢å™¨ï¼›</li><li><strong>@ColumnWidthï¼š</strong>Â ç”¨äºè®¾ç½®è¡¨æ ¼åˆ—çš„å®½åº¦ï¼›</li><li><strong>@DateTimeFormatï¼š</strong>Â ç”¨äºè®¾ç½®æ—¥æœŸè½¬æ¢æ ¼å¼ï¼›</li><li><strong>@NumberFormatï¼š</strong>Â ç”¨äºè®¾ç½®æ•°å­—è½¬æ¢æ ¼å¼ã€‚</li></ul><p>å»ºè®®çœ‹ä¸€ä¸‹å®˜ç½‘çš„ç¤ºä¾‹ï¼š <a href="https://easyexcel.opensource.alibaba.com/">https://easyexcel.opensource.alibaba.com</a></p><p>Order</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs typescript">package com.<span class="hljs-property">ruoyi</span>.<span class="hljs-property">system</span>.<span class="hljs-property">domain</span>;<br><br><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Date</span>;<br><br><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">excel</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">ExcelIgnore</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">excel</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">ExcelProperty</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">excel</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">format</span>.<span class="hljs-property">DateTimeFormat</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">excel</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">write</span>.<span class="hljs-property">style</span>.<span class="hljs-property">ColumnWidth</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">fasterxml</span>.<span class="hljs-property">jackson</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">JsonFormat</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">ruoyi</span>.<span class="hljs-property">system</span>.<span class="hljs-property">domain</span>.<span class="hljs-property">converter</span>.<span class="hljs-property">OrderStatusConverter</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">commons</span>.<span class="hljs-property">lang3</span>.<span class="hljs-property">builder</span>.<span class="hljs-property">ToStringBuilder</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">commons</span>.<span class="hljs-property">lang3</span>.<span class="hljs-property">builder</span>.<span class="hljs-property">ToStringStyle</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">ruoyi</span>.<span class="hljs-property">common</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Excel</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">ruoyi</span>.<span class="hljs-property">common</span>.<span class="hljs-property">core</span>.<span class="hljs-property">domain</span>.<span class="hljs-property">BaseEntity</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> <span class="hljs-variable">luoqi</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> Orders.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/5 9:47</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Orders</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final long serialVersionUID = 1L;<br><br>    <span class="hljs-meta">@ExcelProperty</span>(value = <span class="hljs-string">&quot;è®¢å•ID&quot;</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> orderId;<br><br>    <span class="hljs-comment">//Excelçš„åˆ—æè¿°, å­—å…¸è½¬æ¢ï¼šconverter , converter = OrderStatusConverter.class</span><br>    <span class="hljs-meta">@ExcelProperty</span>(value = <span class="hljs-string">&quot;è®¢å•çŠ¶æ€&quot;</span>, converter = <span class="hljs-title class_">OrderStatusConverter</span>.<span class="hljs-property">class</span>)<br>    <span class="hljs-comment">//åˆ—å®½</span><br>    <span class="hljs-meta">@ColumnWidth</span>(<span class="hljs-number">20</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> orderStatus;<br><br>    <span class="hljs-meta">@ExcelProperty</span>(<span class="hljs-string">&quot;è®¢å•æ—¶é—´&quot;</span>)<br>    <span class="hljs-comment">//æ—¥æœŸè½¬æ¢æ ¼å¼</span><br>    <span class="hljs-meta">@DateTimeFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Date</span> orderTime;<br><br>    <span class="hljs-meta">@ExcelProperty</span>(<span class="hljs-string">&quot;æ’åºå·&quot;</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Long</span> sortNumber;<br><br>    <span class="hljs-meta">@ExcelProperty</span>(<span class="hljs-string">&quot;VINå·&quot;</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> vinNumber;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setOrderId</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderId</span>)<br>    &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">orderId</span> = orderId;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getOrderId</span>(<span class="hljs-params"></span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> orderId;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setOrderStatus</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderStatus</span>)<br>    &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">orderStatus</span> = orderStatus;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getOrderStatus</span>(<span class="hljs-params"></span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> orderStatus;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setOrderTime</span>(<span class="hljs-params"><span class="hljs-built_in">Date</span> orderTime</span>)<br>    &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">orderTime</span> = orderTime;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Date</span> <span class="hljs-title function_">getOrderTime</span>(<span class="hljs-params"></span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> orderTime;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setSortNumber</span>(<span class="hljs-params">Long sortNumber</span>)<br>    &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortNumber</span> = sortNumber;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Long</span> <span class="hljs-title function_">getSortNumber</span>(<span class="hljs-params"></span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> sortNumber;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setVinNumber</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> vinNumber</span>)<br>    &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">vinNumber</span> = vinNumber;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getVinNumber</span>(<span class="hljs-params"></span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> vinNumber;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">toString</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToStringBuilder</span>(<span class="hljs-variable language_">this</span>,<span class="hljs-title class_">ToStringStyle</span>.<span class="hljs-property">MULTI_LINE_STYLE</span>)<br>                .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;orderId&quot;</span>, <span class="hljs-title function_">getOrderId</span>())<br>                .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;orderStatus&quot;</span>, <span class="hljs-title function_">getOrderStatus</span>())<br>                .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;orderTime&quot;</span>, <span class="hljs-title function_">getOrderTime</span>())<br>                .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;sortNumber&quot;</span>, <span class="hljs-title function_">getSortNumber</span>())<br>                .<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;vinNumber&quot;</span>, <span class="hljs-title function_">getVinNumber</span>())<br>                .<span class="hljs-title function_">toString</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¿™ä¸ªç±»å¯¼å‡ºçš„æ—¶å€™é‡åˆ°ä¸€ä¸ªå‘ï¼Œå»ºè®®ä¸è¦ç»§æ‰¿å­ç±»ï¼Œå¯¼å‡ºæ˜¯å¯¼å‡ºæ‰€æœ‰å­—æ®µï¼Œé™¤éä½ å­—æ®µä¸Šæ˜¾ç¤ºå¿½ç•¥</p><p>OrderStatusConverter</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs typescript">package com.<span class="hljs-property">ruoyi</span>.<span class="hljs-property">system</span>.<span class="hljs-property">domain</span>.<span class="hljs-property">converter</span>;<br><br><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">excel</span>.<span class="hljs-property">converters</span>.<span class="hljs-property">Converter</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">excel</span>.<span class="hljs-property">converters</span>.<span class="hljs-property">ReadConverterContext</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">excel</span>.<span class="hljs-property">converters</span>.<span class="hljs-property">WriteConverterContext</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">excel</span>.<span class="hljs-property">enums</span>.<span class="hljs-property">CellDataTypeEnum</span>;<br><span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">excel</span>.<span class="hljs-property">metadata</span>.<span class="hljs-property">data</span>.<span class="hljs-property">WriteCellData</span>;<br><br><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">HashMap</span>;<br><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> <span class="hljs-variable">luoqi</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@File</span> OrderStatusConverter.java</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Desc</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Create</span> 2024/4/5 11:25</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@ChangeList</span> --------------------------------------------------------------------</span><br><span class="hljs-comment"> * Date                          Editor                     ChangeReason</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderStatusConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Converter</span>&lt;<span class="hljs-title class_">String</span>&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; statusToDescriptionMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; descriptionToStatusMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        statusToDescriptionMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;00&quot;</span>, <span class="hljs-string">&quot;åˆå§‹åŒ–&quot;</span>);<br>        statusToDescriptionMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;05&quot;</span>, <span class="hljs-string">&quot;æ’åº&quot;</span>);<br>        statusToDescriptionMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;10&quot;</span>, <span class="hljs-string">&quot;VINç”Ÿæˆ&quot;</span>);<br>        statusToDescriptionMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;15&quot;</span>, <span class="hljs-string">&quot;å±•å¼€&quot;</span>);<br>        statusToDescriptionMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;20&quot;</span>, <span class="hljs-string">&quot;å‘å¸ƒ&quot;</span>);<br>        statusToDescriptionMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;25&quot;</span>, <span class="hljs-string">&quot;åœ¨åˆ¶&quot;</span>);<br>        statusToDescriptionMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;30&quot;</span>, <span class="hljs-string">&quot;ä¸‹çº¿&quot;</span>);<br><br>        descriptionToStatusMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;åˆå§‹åŒ–&quot;</span>, <span class="hljs-string">&quot;00&quot;</span>);<br>        descriptionToStatusMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;æ’åº&quot;</span>, <span class="hljs-string">&quot;05&quot;</span>);<br>        descriptionToStatusMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;VINç”Ÿæˆ&quot;</span>, <span class="hljs-string">&quot;10&quot;</span>);<br>        descriptionToStatusMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;å±•å¼€&quot;</span>, <span class="hljs-string">&quot;15&quot;</span>);<br>        descriptionToStatusMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;å‘å¸ƒ&quot;</span>, <span class="hljs-string">&quot;20&quot;</span>);<br>        descriptionToStatusMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;åœ¨åˆ¶&quot;</span>, <span class="hljs-string">&quot;25&quot;</span>);<br>        descriptionToStatusMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">&quot;ä¸‹çº¿&quot;</span>, <span class="hljs-string">&quot;30&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Class</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">supportJavaTypeKey</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">String</span>.<span class="hljs-property">class</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">CellDataTypeEnum</span> <span class="hljs-title function_">supportExcelTypeKey</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">CellDataTypeEnum</span>.<span class="hljs-property">STRING</span>;<br>    &#125;<br><br>    <span class="hljs-comment">//å¯¼å…¥æ—¶è¿›è¡Œç±»å‹è½¬æ¢æ“ä½œ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">convertToJavaData</span>(<span class="hljs-params">ReadConverterContext&lt;?&gt; context</span>) &#123;<br>        <span class="hljs-title class_">String</span> description = context.<span class="hljs-title function_">getReadCellData</span>().<span class="hljs-title function_">getStringValue</span>();<br>        <span class="hljs-keyword">return</span> descriptionToStatusMap.<span class="hljs-title function_">getOrDefault</span>(description, <span class="hljs-string">&quot;æœªçŸ¥çŠ¶æ€ç &quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//å¯¼å‡ºæ—¶è¿›è¡Œç±»å‹è½¬æ¢æ“ä½œ</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">WriteCellData</span>&lt;?&gt; <span class="hljs-title function_">convertToExcelData</span>(<span class="hljs-params">WriteConverterContext&lt;<span class="hljs-built_in">String</span>&gt; context</span>) &#123;<br>        <span class="hljs-title class_">String</span> description = statusToDescriptionMap.<span class="hljs-title function_">getOrDefault</span>(context.<span class="hljs-title function_">getValue</span>(), <span class="hljs-string">&quot;æœªçŸ¥çŠ¶æ€&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WriteCellData</span>&lt;&gt;(description);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs gradle">@SpringBootTest  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> OrdersExcelOpertaion &#123;  <br>  <br>    @Autowired  <br>    <span class="hljs-keyword">private</span> IOrdersService ordersService;  <br>  <br>    @Test  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> exportOrderExcel2() &#123;  <br>            Orders orders = <span class="hljs-keyword">new</span> Orders();  <br>            orders.setSortNumber(<span class="hljs-number">789</span>L);  <br>            List&lt;Orders&gt; list = ordersService.selectOrdersList(orders);  <br>            String fileName = <span class="hljs-string">&quot;path/to/orderExcel2.xlsx&quot;</span>;  <br>            EasyExcel.<span class="hljs-keyword">write</span>(fileName, Orders.<span class="hljs-keyword">class</span>)  <br>                    .head(Orders.<span class="hljs-keyword">class</span>)  <br>                    .sheet(<span class="hljs-string">&quot;ç”¨æˆ·åˆ—è¡¨&quot;</span>)  <br>                    .doWrite(list);  <br>    &#125;  <br>  <br>  <br>    @Test  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> importOrderExcel2() &#123;  <br>        <span class="hljs-keyword">try</span> &#123;  <br>            FileInputStream <span class="hljs-keyword">file</span> = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-keyword">new</span> <span class="hljs-keyword">File</span>(<span class="hljs-string">&quot;path/to/orderExcel2.xlsx&quot;</span>));  <br>            List&lt;Orders&gt; ordersList = EasyExcel.<span class="hljs-keyword">read</span>(<span class="hljs-keyword">file</span>)  <br>                    .head(Orders.<span class="hljs-keyword">class</span>)  <br>                    .sheet()  <br>                    .doReadSync();  <br>            <span class="hljs-keyword">for</span>(Orders orders:ordersList)  <br>            &#123;  <br>                System.out.<span class="hljs-keyword">println</span>(orders);  <br>            &#125;  <br>            <span class="hljs-comment">//è¯»å–åè¿›è¡Œå­˜æ”¾  </span><br>            ordersService.batchInsert(ordersList,<span class="hljs-number">100</span>);  <br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;  <br>            System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;æ‰§è¡Œå¼‚å¸¸&quot;</span>);  <br>        &#125;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯åœ¨ controller ç±»ä¸Š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/export2/order&quot;</span>)  <br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">exportOrderExcel</span>(<span class="hljs-params">HttpServletResponse response</span>) &#123;  <br>    <span class="hljs-keyword">try</span> &#123;  <br>        <span class="hljs-title class_">Orders</span> orders = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Orders</span>();  <br>        orders.<span class="hljs-title function_">setSortNumber</span>(789L);  <br>        <span class="hljs-comment">//è¿™ä¸ªæ–¹æ³•ç”¨äºè®¾ç½®å“åº”å¤´ï¼Œä»¥ä¾¿å‘ŠçŸ¥æµè§ˆå™¨è¦ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ªå“åº”ã€‚  </span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setExcelResponseProp</span>(response, <span class="hljs-string">&quot;ç”¨æˆ·åˆ—è¡¨&quot;</span>);  <br>        <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Orders</span>&gt; list = ordersService.<span class="hljs-title function_">selectOrdersList</span>(orders);  <br>        <span class="hljs-title class_">EasyExcel</span>.<span class="hljs-title function_">write</span>(response.<span class="hljs-title function_">getOutputStream</span>())  <br>                .<span class="hljs-title function_">head</span>(<span class="hljs-title class_">Orders</span>.<span class="hljs-property">class</span>)  <br>                .<span class="hljs-title function_">excelType</span>(<span class="hljs-title class_">ExcelTypeEnum</span>.<span class="hljs-property">XLSX</span>)  <br>                .<span class="hljs-title function_">sheet</span>(<span class="hljs-string">&quot;ç”¨æˆ·åˆ—è¡¨&quot;</span>)  <br>                .<span class="hljs-title function_">doWrite</span>(list);  <br>    &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">IOException</span> e) &#123;  <br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);  <br>    &#125;  <br>&#125;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setExcelResponseProp</span>(<span class="hljs-params">HttpServletResponse response, <span class="hljs-built_in">String</span> fileName</span>) &#123;  <br>    <span class="hljs-keyword">try</span> &#123;  <br>        <span class="hljs-comment">// é˜²æ­¢ä¸­æ–‡ä¹±ç   </span><br>        fileName = <span class="hljs-title class_">URLEncoder</span>.<span class="hljs-title function_">encode</span>(fileName, <span class="hljs-title class_">StandardCharsets</span>.<span class="hljs-property">UTF_8</span>.<span class="hljs-title function_">name</span>());  <br>    &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">UnsupportedEncodingException</span> e) &#123;  <br>        <span class="hljs-comment">// æ—¥å¿—è®°å½•é”™è¯¯æˆ–å…¶ä»–å¤„ç†  </span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;æ–‡ä»¶åç¼–ç å¤±è´¥&quot;</span>, e);  <br>    &#125;  <br>  <br>    <span class="hljs-comment">// è®¾ç½®å“åº”ç±»å‹  </span><br>    response.<span class="hljs-title function_">setContentType</span>(<span class="hljs-string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span>);  <br>    <span class="hljs-comment">// è®¾ç½®æ–‡ä»¶å  </span><br>    response.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Content-disposition&quot;</span>, <span class="hljs-string">&quot;attachment;filename=&quot;</span> + fileName);  <br>    <span class="hljs-comment">// é˜²æ­¢æµè§ˆå™¨ç¼“å­˜  </span><br>    response.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Pragma&quot;</span>, <span class="hljs-string">&quot;no-cache&quot;</span>);  <br>    response.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Cache-Control&quot;</span>, <span class="hljs-string">&quot;no-cache&quot;</span>);  <br>    response.<span class="hljs-title function_">setDateHeader</span>(<span class="hljs-string">&quot;Expires&quot;</span>, <span class="hljs-number">0</span>);  <br>&#125;  <br>  <br><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">&quot;/import2/order&quot;</span>)  <br><span class="hljs-keyword">public</span> <span class="hljs-title class_">AjaxResult</span> <span class="hljs-title function_">importOrderExcel</span>(<span class="hljs-params"><span class="hljs-meta">@RequestPart</span>(value = <span class="hljs-string">&quot;file&quot;</span>) MultipartFile file</span>) &#123;  <br>    <span class="hljs-keyword">try</span> &#123;  <br>        <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Orders</span>&gt; ordersList = <span class="hljs-title class_">EasyExcel</span>.<span class="hljs-title function_">read</span>(file.<span class="hljs-title function_">getInputStream</span>())  <br>                .<span class="hljs-title function_">head</span>(<span class="hljs-title class_">Orders</span>.<span class="hljs-property">class</span>)  <br>                .<span class="hljs-title function_">sheet</span>()  <br>                .<span class="hljs-title function_">doReadSync</span>();  <br>        <span class="hljs-keyword">for</span>(<span class="hljs-title class_">Orders</span> <span class="hljs-attr">orders</span>:ordersList)  <br>        &#123;  <br>            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(orders);  <br>        &#125;  <br>        <span class="hljs-comment">//è¯»å–åè¿›è¡Œå­˜æ”¾  </span><br>        ordersService.<span class="hljs-title function_">batchInsert</span>(ordersList,<span class="hljs-number">100</span>);  <br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">success</span>(ordersList);  <br>    &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">IOException</span> e) &#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">error</span>();  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>æœ¬äººä½¿ç”¨çš„æ˜¯ apifox </p><p>å¯¼å‡ºæ“ä½œï¼ˆé€‰æ‹©å‘é€å¹¶ä¸‹è½½ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240405161551.png" alt="image.png"></p><p>å¯¼å…¥æ“ä½œï¼ˆä¸»è¦æ˜¯ body è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240405161626.png" alt="image.png"></p><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul><li>1ã€çœ‹å®˜ç½‘ï¼Œå»çœ‹ç¤ºä¾‹</li><li>2ã€ä¸»è¦æ˜¯æŒæ¡ä¸€äº›ä¼˜åŒ–æ‰‹æ®µ</li></ul><p>åŒ…æ‹¬ï¼š</p><ul><li>ä½¿ç”¨æ›´å¿«çš„ Excel è¯»å–æ¡†æ¶(æ¨èä½¿ç”¨é˜¿é‡Œ EasyExcel)ã€‚</li><li>å¯¹äºéœ€è¦<strong>ä¸æ•°æ®åº“äº¤äº’çš„æ ¡éªŒ</strong>ã€æŒ‰ç…§ä¸šåŠ¡é€»è¾‘é€‚å½“çš„ä½¿ç”¨ç¼“å­˜ã€‚ç”¨ç©ºé—´æ¢æ—¶é—´ã€‚</li><li>ä½¿ç”¨ values( ),( ),( ) æ‹¼æ¥é•¿ SQL ä¸€æ¬¡æ’å…¥å¤šè¡Œæ•°æ®ã€‚</li><li>ä½¿ç”¨å¤šçº¿ç¨‹æ’å…¥æ•°æ®ï¼Œåˆ©ç”¨æ‰ç½‘ç»œIOç­‰å¾…æ—¶é—´(æ¨èä½¿ç”¨å¹¶è¡Œæµï¼Œç®€å•æ˜“ç”¨)ã€‚</li><li>é¿å…åœ¨å¾ªç¯ä¸­æ‰“å°æ— ç”¨çš„æ—¥å¿—ã€‚</li></ul><p>è®²ä¸€ä¸‹ç¬¬å››ç‚¹ï¼š</p><p>åœ¨å¤„ç†å¤§é‡æ•°æ®å¯¼å…¥æ•°æ®åº“æ—¶ï¼Œç½‘ç»œI&#x2F;Oç­‰å¾…æ—¶é—´ï¼ˆç‰¹åˆ«æ˜¯åœ¨åˆ†å¸ƒå¼æ•°æ®åº“ç¯å¢ƒä¸­ï¼‰å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</p><p>ä¸ºäº†å‡å°‘è¿™äº›ç­‰å¾…æ—¶é—´å¹¶æé«˜æ•°æ®å¤„ç†é€Ÿåº¦ï¼Œå¯ä»¥é‡‡ç”¨å¤šçº¿ç¨‹æˆ–å¹¶è¡Œå¤„ç†æŠ€æœ¯æ¥å¹¶å‘æ‰§è¡Œæ•°æ®æ’å…¥æ“ä½œã€‚Java 8å¼•å…¥çš„å¹¶è¡Œæµï¼ˆParallel Streamsï¼‰æä¾›äº†ä¸€ç§ç®€å•è€Œå¼ºå¤§çš„æ–¹å¼æ¥åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚</p><blockquote><p>ä½¿ç”¨å¹¶è¡Œæµè¿›è¡Œæ•°æ®æ’å…¥</p></blockquote><p>å¹¶è¡Œæµåˆ©ç”¨äº†Javaçš„<code>ForkJoinPool</code>ï¼Œå®ƒå°†ä¸€ä¸ªå¤§ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°ä»»åŠ¡ï¼Œè¿™äº›å°ä»»åŠ¡è¢«åˆ†å‘åˆ°çº¿ç¨‹æ± ä¸­çš„ä¸åŒçº¿ç¨‹ä¸Šå¹¶è¡Œæ‰§è¡Œï¼Œæœ€åå°†ç»“æœåˆå¹¶ã€‚è¿™ä½¿å¾—å¹¶è¡Œæµç‰¹åˆ«é€‚åˆè¿›è¡Œæ‰¹é‡æ•°æ®å¤„ç†å’Œæ’å…¥æ“ä½œã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨å¹¶è¡Œæµè¿›è¡Œæ•°æ®æ’å…¥ä¼˜åŒ–çš„ç¤ºä¾‹ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><br>@Test<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSomeServiceMethodBatchUpdateByForkJoin</span>()</span> &#123;<br>    <span class="hljs-comment">//MySQLé»˜è®¤çš„æœ€å¤§åŒ…å¤§å°æ˜¯4MBï¼ˆå¯é€šè¿‡max_allowed_packetå‚æ•°è°ƒæ•´ï¼‰ï¼Œè¿™æ„å‘³ç€ä¸€æ¬¡æ‰¹é‡æ’å…¥æ“ä½œçš„æ•°æ®æ€»é‡ä¸èƒ½è¶…è¿‡è¿™ä¸ªé™åˆ¶</span><br>    <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè®¢å•åˆ—è¡¨ç”¨äºæ‰¹é‡æ’å…¥</span><br>    List&lt;Orders&gt; ordersList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>    <span class="hljs-built_in">int</span> startNum = <span class="hljs-number">40001</span>;<br>    <span class="hljs-built_in">int</span> endNum = <span class="hljs-number">60000</span>;<br>    <span class="hljs-comment">//è®¡ç®—è€—æ—¶</span><br>    <span class="hljs-built_in">long</span> startTime = System.currentTimeMillis();<br>    <span class="hljs-keyword">for</span>(<span class="hljs-built_in">int</span> i = startNum;i&lt;= endNum ;i ++)&#123;<br>        Orders orders = <span class="hljs-keyword">new</span> Orders();<br>        orders.setOrderId(String.valueOf(i));<br>        orders.setOrderStatus(<span class="hljs-string">&quot;20&quot;</span>);<br>        orders.setSortNumber((<span class="hljs-built_in">long</span>) i);<br>        orders.setVinNumber(getRandomSeventeenLength());<br>        orders.setOrderTime(<span class="hljs-keyword">new</span> Date());<br>        ordersList.<span class="hljs-keyword">add</span>(orders);<br>    &#125;<br>    <span class="hljs-comment">//æ‰¹é‡å¤§å°çš„æ§åˆ¶çœ‹å®é™…æƒ…å†µï¼Œä¸€æ–¹é¢è¦è€ƒè™‘å®é™…æ’å…¥å¤§å°ï¼ˆåŒ…æ‹¬æ•°æ®å¤æ‚çš„ç¨‹åº¦ï¼‰ï¼Œå¦ä¸€æ–¹é¢è¿˜è¦è€ƒè™‘ç½‘ç»œã€æ•°æ®åº“ç­‰çš„å½±å“</span><br>    importData(ordersList);<br>    <span class="hljs-built_in">long</span> endTime = System.currentTimeMillis();<br>    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;æ–¹æ³•æ‰§è¡Œè€—æ—¶: &quot;</span> + (endTime - startTime) + <span class="hljs-string">&quot; æ¯«ç§’&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// è‡ªå®šä¹‰å¹¶è¡Œåº¦</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-built_in">int</span> parallelism = <span class="hljs-number">4</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">importData1</span>(<span class="hljs-params">List&lt;Orders&gt; dataList</span>)</span> &#123;<br>    <span class="hljs-built_in">int</span> batchSize = <span class="hljs-number">1000</span>;<br><br>    <span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰çš„ForkJoinPoolæ¥æ§åˆ¶å¹¶è¡Œæµçš„å¹¶è¡Œåº¦</span><br>    ForkJoinPool customThreadPool = <span class="hljs-keyword">new</span> ForkJoinPool(parallelism);<br>    <span class="hljs-keyword">try</span> &#123;<br>        customThreadPool.submit(() -&gt; &#123;<br>            <span class="hljs-comment">// åˆ†æ‰¹å¤„ç†æ•°æ®ï¼Œä½¿ç”¨å¹¶è¡Œæµè¿›è¡Œæ‰¹é‡æ’å…¥</span><br>            dataList.stream()<br>                    .collect(Collectors.groupingBy(data -&gt; dataList.indexOf(data) / batchSize))<br>                    .values()<br>                    .parallelStream()<br>                    .forEach(batchList -&gt; ordersService.batchInsert(batchList,batchSize));<br>        &#125;).<span class="hljs-keyword">get</span>(); <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span><br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException | ExecutionException e) &#123;<br>        Thread.currentThread().interrupt();<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;Failed to import data in parallel&quot;</span>, e);<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        customThreadPool.shutdown();<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">importData</span>(<span class="hljs-params">List&lt;Orders&gt; dataList</span>)</span> &#123;<br>    <span class="hljs-built_in">int</span> batchSize = <span class="hljs-number">1000</span>;<br><br>    <span class="hljs-comment">// ä½¿ç”¨è‡ªå®šä¹‰çš„ForkJoinPoolæ¥æ§åˆ¶å¹¶è¡Œæµçš„å¹¶è¡Œåº¦</span><br>    ForkJoinPool customThreadPool = <span class="hljs-keyword">new</span> ForkJoinPool(parallelism);<br>    <span class="hljs-keyword">try</span> &#123;<br>        customThreadPool.submit(() -&gt;<br>                <span class="hljs-comment">//æ”¹è¿›ç‚¹ï¼š1ã€ç›´æ¥ä½¿ç”¨æ‰¹æ¬¡ç´¢å¼•ï¼›2ã€é¿å…ä½¿ç”¨ indexOfï¼›3ã€æ•°æ®åˆ†å‰²è€ƒè™‘ä½¿ç”¨å…¶ä»–æ–¹å¼æ›¿ä»£ groupingBy</span><br>                IntStream.range(<span class="hljs-number">0</span>, (dataList.size() + batchSize - <span class="hljs-number">1</span>) / batchSize)<br>                        .parallel()<br>                        .mapToObj(batchNum -&gt; dataList.subList(batchNum * batchSize,<br>                                Math.min(dataList.size(), (batchNum + <span class="hljs-number">1</span>) * batchSize)))<br>                        .forEach(batchList -&gt; ordersService.batchInsert(batchList, batchSize))<br>        ).<span class="hljs-keyword">get</span>(); <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span><br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException | ExecutionException e) &#123;<br>        Thread.currentThread().interrupt();<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;Failed to import data in parallel&quot;</span>, e);<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        customThreadPool.shutdown();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ importData æ–¹æ³•ï¼Œå¯ä»¥åœ¨ åˆ†æ‰¹é‡æ’å…¥ 20000æ¡æ•°æ®ï¼Œæ¯æ¬¡æ’å…¥1000æ¡ï¼Œæ–¹æ³•æ‰§è¡Œè€—æ—¶: 800 æ¯«ç§’ï¼›çš„åŸºç¡€ä¸Šæå‡åˆ° 500æ¯«ç§’å·¦å³ã€‚</p><h3 id="4ã€å¯¼å‡ºä¼˜åŒ–"><a href="#4ã€å¯¼å‡ºä¼˜åŒ–" class="headerlink" title="4ã€å¯¼å‡ºä¼˜åŒ–"></a>4ã€å¯¼å‡ºä¼˜åŒ–</h3><p>ä¸Šæ–‡è™½ç„¶è®²è¿°äº†ä¸€ä¸‹ EasyExcel çš„åŸºç¡€ä½¿ç”¨ï¼Œä»¥åŠå¯¹äºå¯¼å…¥æ“ä½œçš„ä¸€äº›å¸¸è§çš„ä¼˜åŒ–æ‰‹æ®µï¼Œä½†å…³äºå¯¼å…¥ï¼Œå…¶å®è¿˜æœ‰ä¸€äº›å†…å®¹éœ€è¦å»äº†è§£ä¸‹ï¼Œè¿™é‡Œä¸»è¦ä»¥  <a href="https://mp.weixin.qq.com/s/5Ytgq_B8nvgFpU3FNeiyOQ">https://mp.weixin.qq.com/s/5Ytgq_B8nvgFpU3FNeiyOQ</a>  è¿™ç¯‡æ–‡ç« å†…å®¹ï¼Œç„¶åå®é™…å»è¿è¡Œå’Œè·‘ï¼Œçœ‹ä¸€ä¸‹å®é™…çš„æ•ˆæœã€‚</p><p>å…ˆè¿‡ä¸€ä¸‹åŸºæœ¬çš„ä¸€äº›æ€è·¯ï¼Œå®ç°æ”¾ä¸€ä¸‹åé¢</p><ul><li>1ã€ä¾ç„¶æ˜¯ä½¿ç”¨ esayexcel çš„å¼€æºæ¡†æ¶ï¼Œå†…éƒ¨è¿›è¡Œäº†å¾ˆå¤§çš„ä¸€ä¸ªä¼˜åŒ–ï¼Œæ¯”èµ· Poi çš„æ–¹å¼æ¥è¯´ï¼›</li><li>2ã€åŸºæœ¬å¤„ç†æ–¹å¼<ul><li>ä¸€ä¸ªSHEETä¸€æ¬¡æŸ¥è¯¢å¯¼å‡º</li><li>æ•°æ®é‡é€‚ä¸­ï¼ˆ100Wä»¥å†…ï¼‰ï¼šä¸€ä¸ªSHEETåˆ†æ‰¹æŸ¥è¯¢å¯¼å‡º</li><li>æ•°æ®é‡Œå¾ˆå¤§ï¼ˆå‡ ç™¾ä¸‡éƒ½è¡Œï¼‰ï¼šå¤šä¸ªSHEETåˆ†æ‰¹æŸ¥è¯¢å¯¼å‡º</li></ul></li></ul><p>å‚è€ƒï¼š <a href="https://www.cxyxiaowu.com/20723.html">https://www.cxyxiaowu.com/20723.html</a></p><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://albenw.github.io/posts/d093ca4e/">https://albenw.github.io/posts/d093ca4e/</a></li><li><a href="https://www.51cto.com/article/717718.html">https://www.51cto.com/article/717718.html</a></li><li><a href="https://mp.weixin.qq.com/s/5Ytgq_B8nvgFpU3FNeiyOQ">https://mp.weixin.qq.com/s/5Ytgq_B8nvgFpU3FNeiyOQ</a></li><li><a href="https://github.com/alibaba/easyexcel">https://github.com/alibaba/easyexcel</a></li><li><a href="https://www.bilibili.com/video/BV13m4y1p7GJ">https://www.bilibili.com/video/BV13m4y1p7GJ</a></li><li><a href="https://blog.csdn.net/yangxiao_hui/article/details/103262704">https://blog.csdn.net/yangxiao_hui/article/details/103262704</a></li><li><a href="https://zhuanlan.zhihu.com/p/641135306">https://zhuanlan.zhihu.com/p/641135306</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
      <category>ç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>coding</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—_Kafka_åŸºç¡€ä½¿ç”¨</title>
    <link href="/2023/12/30/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_Kafka_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/12/30/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_Kafka_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¤§çº²</p></blockquote><ul><li>Kafka æ˜¯ä»€ä¹ˆ</li><li>Kafka çš„æ ¸å¿ƒæ¦‚å¿µ</li></ul><h3 id="1ã€Kafka-æ˜¯ä»€ä¹ˆ"><a href="#1ã€Kafka-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€Kafka æ˜¯ä»€ä¹ˆ"></a>1ã€Kafka æ˜¯ä»€ä¹ˆ</h3><p>ç•¥</p><h3 id="2ã€Kafka-çš„æ ¸å¿ƒæ¦‚å¿µ"><a href="#2ã€Kafka-çš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="2ã€Kafka çš„æ ¸å¿ƒæ¦‚å¿µ"></a>2ã€Kafka çš„æ ¸å¿ƒæ¦‚å¿µ</h3><p>æ ¸å¿ƒæ¦‚å¿µä¸»è¦æ˜¯ï¼š Producerã€Consumerã€Brokerã€Topicã€Partition</p><p>æœ‰ç‚¹ç±»ä¼¼ RocketMQï¼Œæ¯•ç«ŸRocketMQ çš„è®¾è®¡ä¹‹å¤„æ˜¯å‚è€ƒäº†éƒ¨åˆ† Kafka çš„è®¾è®¡ï¼Œå…¶ä¸­ Kafka æ˜¯æ²¡æœ‰ Queue è¿™ä¸ªæ¦‚å¿µçš„ï¼Œä¸»é¢˜ Topic ä¸‹é¢çš„å®é™…å­˜å‚¨æ•°æ®é‡‡ç”¨çš„æ˜¯ Partion åˆ†åŒºã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231230105605.png" alt="image.png"></p><hr><blockquote><p>kafka å’Œ Zookeeper çš„å…³ç³»</p></blockquote><p>åœ¨ Kafka 2.8 ä¹‹å‰ï¼ŒKafka å…¶é‡åº¦ä¾èµ–äº Zookeeperã€‚</p><p>åœ¨ Kafka 2.8 ä¹‹åï¼Œå¼•å…¥äº†åŸºäº Raft åè®®çš„ KRaft æ¨¡å¼ï¼Œä¸å†ä¾èµ– Zookeeperï¼Œç®€åŒ–äº† Kafka çš„æ¶æ„ã€‚</p><p>Zookeeper çš„ä½œç”¨å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œä½œä¸ºèŠ‚ç‚¹çš„ Broker çš„è·¯ç”±ç®¡ç† å’Œé›†ç¾¤è´Ÿè½½ç­‰åŠŸèƒ½</p><blockquote><p>kafka å’Œ RocketMQ çš„åŒºåˆ«</p></blockquote><p>å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªè§£é‡Š,  å…·ä½“æ›´æ·±å±‚æ¬¡çš„ç†è§£å»ºè®®ä»å®é™…çš„ä»£ç ç¨‹åºæ–¹é¢å…¥æ‰‹å»ç†è§£ã€‚</p><p>Kafka å’Œ RocketMQ éƒ½æ˜¯é«˜æ€§èƒ½çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¹¿æ³›ç”¨äºå¤„ç†å¤§è§„æ¨¡æ•°æ®æµå’Œå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ¶ˆæ¯ä¼ é€’ã€‚</p><p>å°½ç®¡å®ƒä»¬æœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯ Kafka å’Œ RocketMQ ä¸»è¦åŒºåˆ«çš„æ¦‚è¿°ï¼š</p><blockquote><ol><li>è®¾è®¡æ¶æ„</li></ol></blockquote><ul><li><strong>Kafka</strong>ï¼šæœ€åˆç”±LinkedInå¼€å‘ï¼Œé‡ç‚¹æ”¾åœ¨é«˜ååé‡å’Œå¯æ‰©å±•æ€§ä¸Šã€‚Kafka ä½¿ç”¨åˆ†åŒºï¼ˆPartitionï¼‰å’Œå¤åˆ¶ï¼ˆReplicationï¼‰çš„æ¦‚å¿µæ¥ä¿è¯æ¶ˆæ¯çš„å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚</li><li><strong>RocketMQ</strong>ï¼šæœ€åˆç”±é˜¿é‡Œå·´å·´å¼€å‘ï¼Œè®¾è®¡é‡ç‚¹æ˜¯æä¾›æ›´ä¸°å¯Œçš„æ¶ˆæ¯æ¨¡å‹å’ŒæœåŠ¡è´¨é‡ã€‚å®ƒé‡‡ç”¨äº†æ›´å¤æ‚çš„å­˜å‚¨å’Œæ¶ˆæ¯è·¯ç”±æœºåˆ¶ã€‚</li></ul><blockquote><ol start="2"><li>å­˜å‚¨æœºåˆ¶</li></ol></blockquote><ul><li><strong>Kafka</strong>ï¼šé‡‡ç”¨åˆ†å¸ƒå¼ã€å¯ä¼¸ç¼©çš„æ—¥å¿—å­˜å‚¨æœºåˆ¶ã€‚æ¯ä¸ªä¸»é¢˜ï¼ˆTopicï¼‰åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºåœ¨ç‰©ç†ä¸Šå¯¹åº”ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ã€‚</li><li><strong>RocketMQ</strong>ï¼šä½¿ç”¨å•ä¸€çš„ <code>CommitLog</code> æ–‡ä»¶æ¥å­˜å‚¨æ‰€æœ‰ä¸»é¢˜çš„æ¶ˆæ¯ï¼Œç„¶åé€šè¿‡ <code>ConsumeQueue</code> å’Œ <code>IndexFile</code> æ¥ä¸ºæ¶ˆæ¯æä¾›ç´¢å¼•å’Œå¿«é€Ÿè®¿é—®ã€‚</li></ul><blockquote><ol start="3"><li>æ¶ˆæ¯æ¶ˆè´¹æ¨¡å‹</li></ol></blockquote><ul><li><strong>Kafka</strong>ï¼šä¸»è¦æ”¯æŒå‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡åˆ†åŒºåˆ†é…å®ç°ç±»ä¼¼é˜Ÿåˆ—çš„æ¶ˆè´¹æ¨¡å¼ã€‚Kafka å¼ºè°ƒæ¶ˆè´¹è€…çš„æ¦‚å¿µï¼Œæ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£è·Ÿè¸ªè‡ªå·±çš„åç§»é‡ã€‚</li><li><strong>RocketMQ</strong>ï¼šæä¾›æ›´å¤šæ ·çš„æ¶ˆæ¯æ¨¡å‹ï¼ŒåŒ…æ‹¬å‘å¸ƒ-è®¢é˜…ã€ç‚¹å¯¹ç‚¹æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯å’Œå»¶æ—¶æ¶ˆæ¯ç­‰ã€‚</li></ul><blockquote><ol start="4"><li>äº‹åŠ¡æ¶ˆæ¯</li></ol></blockquote><ul><li><strong>Kafka</strong>ï¼šåœ¨è¾ƒæ–°ç‰ˆæœ¬ä¸­å¢åŠ äº†å¯¹äº‹åŠ¡æ¶ˆæ¯çš„æ”¯æŒï¼Œä½†å®ç°ç›¸å¯¹ç®€å•ã€‚</li><li><strong>RocketMQ</strong>ï¼šæä¾›äº†æ›´ä¸ºå¤æ‚å’Œå¼ºå¤§çš„äº‹åŠ¡æ¶ˆæ¯æ”¯æŒã€‚</li></ul><blockquote><ol start="5"><li>æ€§èƒ½å’Œå¯é æ€§</li></ol></blockquote><ul><li><strong>Kafka</strong>ï¼šä»¥å…¶é«˜æ€§èƒ½å’Œé«˜ååé‡è€Œè‘—ç§°ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚</li><li><strong>RocketMQ</strong>ï¼šè™½ç„¶ä¹Ÿæä¾›é«˜æ€§èƒ½å¤„ç†ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½ä¸å¦‚Kafkaé«˜æ•ˆï¼Œå°¤å…¶æ˜¯åœ¨å•ä¸€CommitLogè®¾è®¡ä¸‹ã€‚</li></ul><blockquote><ol start="6"><li>ç¤¾åŒºå’Œç”Ÿæ€</li></ol></blockquote><ul><li><strong>Kafka</strong>ï¼šæœ‰ç€å¹¿æ³›çš„ç¤¾åŒºæ”¯æŒå’Œæˆç†Ÿçš„ç”Ÿæ€ç³»ç»Ÿï¼Œæ˜¯æµæ•°æ®å¤„ç†å’Œå®æ—¶åˆ†æçš„é¦–é€‰ã€‚</li><li><strong>RocketMQ</strong>ï¼šåœ¨ä¸­å›½æœ‰è¾ƒå¼ºçš„ç¤¾åŒºæ”¯æŒï¼Œç‰¹åˆ«æ˜¯åœ¨é˜¿é‡Œå·´å·´åŠå…¶ç”Ÿæ€ç³»ç»Ÿä¸­å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</li></ul><p>é€‰æ‹©Kafkaè¿˜æ˜¯RocketMQï¼Œå–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚</p><p>å¦‚æœéœ€è¦å¤„ç†å¤§è§„æ¨¡çš„æ•°æ®æµï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°æ®åˆ†æå’Œæµå¤„ç†æ–¹é¢ï¼ŒKafkaå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è€Œå¦‚æœéœ€è¦æ›´å¤æ‚çš„æ¶ˆæ¯ç±»å‹å’ŒæœåŠ¡è´¨é‡ï¼Œæˆ–è€…å¯¹äº‹åŠ¡æ¶ˆæ¯æœ‰æ›´é«˜çš„è¦æ±‚ï¼ŒRocketMQå¯èƒ½æ›´é€‚åˆã€‚åœ¨å®é™…é€‰æ‹©æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘å›¢é˜Ÿçš„æŠ€æœ¯æ ˆå…¼å®¹æ€§å’Œå…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ã€‚</p><h3 id="3ã€Kafka-æ¶ˆè´¹é¡ºåºã€æ¶ˆæ¯ä¸¢å¤±å’Œé‡å¤æ¶ˆè´¹"><a href="#3ã€Kafka-æ¶ˆè´¹é¡ºåºã€æ¶ˆæ¯ä¸¢å¤±å’Œé‡å¤æ¶ˆè´¹" class="headerlink" title="3ã€Kafka æ¶ˆè´¹é¡ºåºã€æ¶ˆæ¯ä¸¢å¤±å’Œé‡å¤æ¶ˆè´¹"></a>3ã€Kafka æ¶ˆè´¹é¡ºåºã€æ¶ˆæ¯ä¸¢å¤±å’Œé‡å¤æ¶ˆè´¹</h3><p>to be continedâ€¦..</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/high-performance/message-queue/kafka-questions-01.html">https://javaguide.cn/high-performance/message-queue/kafka-questions-01.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—_RabbitMQ_åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2023/12/28/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RabbitMQ_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2023/12/28/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RabbitMQ_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¤§çº²</p></blockquote><ul><li>RabbitMQæ˜¯ä»€ä¹ˆ</li><li>RabbitMQçš„ç»„æˆéƒ¨åˆ†</li><li>RabbitMQ çš„å·¥ä½œæµç¨‹</li><li>RabbitMQå¹¿æ’­å’Œç›´æ¥æ¨¡å¼ç¤ºä¾‹</li></ul><h3 id="ä¸€ã€åŸºç¡€æ¦‚å¿µ"><a href="#ä¸€ã€åŸºç¡€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºç¡€æ¦‚å¿µ"></a>ä¸€ã€åŸºç¡€æ¦‚å¿µ</h3><p><strong>â€œæ¶ˆæ¯é˜Ÿåˆ—(Message Queue)â€æ˜¯åœ¨æ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­ä¿å­˜æ¶ˆæ¯çš„å®¹å™¨</strong>ã€‚</p><p>MQ çš„æ ¸å¿ƒä½œç”¨ï¼šå‰Šå³°ã€è§£è€¦ã€å¼‚æ­¥</p><h4 id="RabbitMQæ˜¯ä»€ä¹ˆ"><a href="#RabbitMQæ˜¯ä»€ä¹ˆ" class="headerlink" title="RabbitMQæ˜¯ä»€ä¹ˆ"></a>RabbitMQæ˜¯ä»€ä¹ˆ</h4><p>å»ºè®®ç›´æ¥å»å®˜ç½‘çœ‹ä¸€ä¸‹ç›¸å…³æ¦‚å¿µï¼š <a href="https://www.rabbitmq.com/documentation.html">https://www.rabbitmq.com/documentation.html</a></p><blockquote><p>RabbitMQçš„ç‰¹ç‚¹</p></blockquote><p>RabbitMQæ˜¯ä¸€æ¬¾ä½¿ç”¨Erlangè¯­è¨€å¼€å‘çš„ï¼Œå®ç°AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®)çš„å¼€æºæ¶ˆæ¯ä¸­é—´ä»¶ã€‚</p><p>ç‰¹ç‚¹</p><ul><li>å¯é æ€§ã€‚æ”¯æŒæŒä¹…åŒ–ï¼Œä¼ è¾“ç¡®è®¤ï¼Œå‘å¸ƒç¡®è®¤ç­‰ä¿è¯äº†MQçš„å¯é æ€§ã€‚</li><li>çµæ´»çš„åˆ†å‘æ¶ˆæ¯ç­–ç•¥ã€‚è¿™åº”è¯¥æ˜¯RabbitMQçš„ä¸€å¤§ç‰¹ç‚¹ã€‚åœ¨æ¶ˆæ¯è¿›å…¥MQå‰ç”±Exchange(äº¤æ¢æœº)è¿›è¡Œè·¯ç”±æ¶ˆæ¯ã€‚åˆ†å‘æ¶ˆæ¯ç­–ç•¥æœ‰ï¼šç®€å•æ¨¡å¼ã€å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ã€å‘å¸ƒè®¢é˜…æ¨¡å¼ã€è·¯ç”±æ¨¡å¼ã€é€šé…ç¬¦æ¨¡å¼ã€‚</li><li>æ”¯æŒé›†ç¾¤ã€‚å¤šå°RabbitMQæœåŠ¡å™¨å¯ä»¥ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œå½¢æˆä¸€ä¸ªé€»è¾‘Brokerã€‚</li><li>å¤šç§åè®®ã€‚RabbitMQæ”¯æŒå¤šç§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæ¯”å¦‚ STOMPã€MQTT ç­‰ç­‰ã€‚</li><li>æ”¯æŒå¤šç§è¯­è¨€å®¢æˆ·ç«¯ã€‚RabbitMQå‡ ä¹æ”¯æŒæ‰€æœ‰å¸¸ç”¨ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ Javaã€.NETã€Ruby ç­‰ç­‰ã€‚</li><li>å¯è§†åŒ–ç®¡ç†ç•Œé¢ã€‚RabbitMQæä¾›äº†ä¸€ä¸ªæ˜“ç”¨çš„ç”¨æˆ·ç•Œé¢ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥ç›‘æ§å’Œç®¡ç†æ¶ˆæ¯ Brokerã€‚</li><li>æ’ä»¶æœºåˆ¶ã€‚RabbitMQæä¾›äº†è®¸å¤šæ’ä»¶ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶è¿›è¡Œæ‰©å±•ï¼Œä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„æ’ä»¶ã€‚</li></ul><blockquote><p>å®‰è£…å’Œä½¿ç”¨</p></blockquote><ul><li><ol><li>å®‰è£… erlang ç¯å¢ƒ</li></ol></li><li><ol start="2"><li>å®‰è£…RabbitMQæœåŠ¡ç«¯</li></ol></li></ul><h4 id="RabbitMQçš„ç»„æˆéƒ¨åˆ†"><a href="#RabbitMQçš„ç»„æˆéƒ¨åˆ†" class="headerlink" title="RabbitMQçš„ç»„æˆéƒ¨åˆ†"></a>RabbitMQçš„ç»„æˆéƒ¨åˆ†</h4><p>æ ¸å¿ƒæ¦‚å¿µ</p><ul><li>Brokerï¼šæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡è¿›ç¨‹ã€‚æ­¤è¿›ç¨‹åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šExchangeå’ŒQueueã€‚<ul><li>Exchangeï¼šæ¶ˆæ¯é˜Ÿåˆ—äº¤æ¢æœºã€‚<strong>æŒ‰ä¸€å®šçš„è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±è½¬å‘åˆ°æŸä¸ªé˜Ÿåˆ—</strong>ã€‚</li><li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚</li></ul></li><li>Producerï¼šæ¶ˆæ¯ç”Ÿäº§è€…ã€‚ç”Ÿäº§æ–¹å®¢æˆ·ç«¯å°†æ¶ˆæ¯åŒäº¤æ¢æœºè·¯ç”±å‘é€åˆ°é˜Ÿåˆ—ä¸­ã€‚</li><li>Consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ã€‚æ¶ˆè´¹é˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ¶ˆæ¯ã€‚</li></ul><p>å¤§æ¦‚æµç¨‹ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312121056722.png" alt="image.png"></p><ul><li>æ¶ˆæ¯ç”Ÿäº§è€…è¿æ¥åˆ°RabbitMQ Brokerï¼Œåˆ›å»ºconnectionï¼Œå¼€å¯channelã€‚</li><li>ç”Ÿäº§è€…å£°æ˜äº¤æ¢æœºç±»å‹ã€åç§°ã€æ˜¯å¦æŒä¹…åŒ–ç­‰ã€‚</li><li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šæ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ç­‰å±æ€§å’Œ routing keyã€‚</li><li>exchangeæ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œ<strong>æ ¹æ®routing keyè·¯ç”±åˆ°è·Ÿå½“å‰äº¤æ¢æœºç»‘å®šçš„ç›¸åŒ¹é…çš„é˜Ÿåˆ—</strong>é‡Œé¢ã€‚</li><li>æ¶ˆè´¹è€…ç›‘å¬æ¥æ”¶åˆ°æ¶ˆæ¯ä¹‹åå¼€å§‹ä¸šåŠ¡å¤„ç†</li></ul><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">ç”Ÿäº§è€…</span> <span class="hljs-literal">--</span><span class="hljs-title">[</span><span class="hljs-comment">æ¶ˆæ¯</span><span class="hljs-title">]</span><span class="hljs-literal">--</span>&gt; <span class="hljs-comment">äº¤æ¢æœº</span> <span class="hljs-literal">--</span><span class="hljs-title">[</span><span class="hljs-comment">è·¯ç”±</span><span class="hljs-title">]</span><span class="hljs-literal">--</span>&gt; <span class="hljs-comment">é˜Ÿåˆ—</span> <span class="hljs-literal">--</span><span class="hljs-title">[</span><span class="hljs-comment">æ¶ˆè´¹</span><span class="hljs-title">]</span><span class="hljs-literal">--</span>&gt; <span class="hljs-comment">æ¶ˆè´¹è€…</span><br>    <span class="hljs-comment">\                                         /</span><br>     <span class="hljs-comment">\</span><span class="hljs-literal">--</span><span class="hljs-title">[</span><span class="hljs-comment">é€šé“ Channel</span><span class="hljs-title">]</span><span class="hljs-literal">-----------------------</span><span class="hljs-comment">/</span><br></code></pre></td></tr></table></figure><p>é€šé“çš„æ¦‚å¿µï¼š</p><ul><li><strong>å®šä¹‰</strong>ï¼šé€šé“æ˜¯å»ºç«‹åœ¨å®é™…çš„ TCP è¿æ¥å†…çš„ä¸€ä¸ªè½»é‡çº§è¿æ¥ã€‚å®ƒæ˜¯æ‰§è¡Œå¤§å¤šæ•°æ“ä½œï¼ˆå¦‚æ¶ˆæ¯å‘å¸ƒæˆ–æ¶ˆæ¯æ¥æ”¶ï¼‰çš„è·¯å¾„ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šé€šé“æ˜¯å¤šè·¯å¤ç”¨è¿æ¥ä¸­çš„ä¸€ä¸ªç‹¬ç«‹è·¯å¾„ï¼Œå…è®¸å¤šä¸ªé€šé“å…±äº«ä¸€ä¸ª TCP è¿æ¥ï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªé€šé“å»ºç«‹ç‰©ç†è¿æ¥ã€‚è¿™æé«˜äº†èµ„æºåˆ©ç”¨ç‡å’Œé€šä¿¡æ•ˆç‡</li><li>ç”Ÿäº§è€…ä½¿ç”¨é€šé“æ¥å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºï¼Œè€Œæ¶ˆè´¹è€…ä½¿ç”¨é€šé“ä»é˜Ÿåˆ—ä¸­æ¥æ”¶æ¶ˆæ¯ã€‚é€šé“ä½œä¸ºæ¶ˆæ¯ä¼ è¾“çš„é€šé“ï¼Œè¿æ¥äº†ç”Ÿäº§è€…ã€äº¤æ¢æœºå’Œæ¶ˆè´¹è€…ã€‚</li></ul><p>é€šé“æ˜¯ä½œä¸ºæ¶ˆæ¯ä¼ é€’çš„è½½ä½“è´¯ç©¿æ•´ä¸ªè¿‡ç¨‹ã€‚</p><h4 id="RabbitMQ-çš„å·¥ä½œæµç¨‹"><a href="#RabbitMQ-çš„å·¥ä½œæµç¨‹" class="headerlink" title="RabbitMQ çš„å·¥ä½œæµç¨‹"></a>RabbitMQ çš„å·¥ä½œæµç¨‹</h4><h5 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228022307.png" alt="image.png"></p><ul><li>å»ºç«‹è¿æ¥</li><li>ç”Ÿäº§è€…<ul><li>å£°æ˜äº¤æ¢æœºç±»å‹ã€åç§°ã€æ˜¯å¦æŒä¹…åŒ–ç­‰</li><li>å‘é€æ¶ˆæ¯</li></ul></li><li>äº¤æ¢æœº<ul><li>äº¤æ¢æœºæ¥æ”¶æ¶ˆæ¯ï¼Œè¿›è¡Œæ¶ˆæ¯è·¯ç”±</li></ul></li><li>æ¶ˆè´¹è€…<ul><li>è®¢é˜…æ¶ˆæ¯ï¼ˆç›‘å¬é˜Ÿåˆ—ï¼‰</li><li>æ¥æ”¶æ¶ˆæ¯ï¼Œä¸šåŠ¡å¤„ç†</li></ul></li></ul><hr><p>ä¸€ã€æ¶ˆæ¯ç”Ÿäº§</p><ul><li>åˆ›å»ºè¿æ¥<ul><li>ç”Ÿäº§è€…é€šè¿‡å®¢æˆ·ç«¯åº“ä¸RabbitMQæœåŠ¡å™¨ï¼ˆBrokerï¼‰å»ºç«‹è¿æ¥ï¼ˆConnectionï¼‰ï¼Œå¹¶åœ¨è¿æ¥ä¸Šåˆ›å»ºä¸€ä¸ªä¿¡é“ï¼ˆChannelï¼‰ã€‚</li></ul></li><li>åˆ›å»ºæ¶ˆæ¯ï¼ˆå£°æ˜äº¤æ¢æœºï¼ŒæŒ‡å®š routing keyï¼‰<ul><li>ç”Ÿäº§è€…ï¼ˆProducerï¼‰æ˜¯æ¶ˆæ¯çš„å‘é€æ–¹ï¼Œå®ƒåˆ›å»ºåŒ…å«æ•°æ®çš„æ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šä¸€ä¸ª<code>routing key</code>æ¥æè¿°è¿™æ¡æ¶ˆæ¯çš„è·¯ç”±è§„åˆ™ã€‚</li></ul></li><li>å‘é€æ¶ˆæ¯<ul><li>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªæŒ‡å®šçš„äº¤æ¢æœºï¼ˆExchangeï¼‰ï¼Œå¹¶é™„ä¸Š<code>routing key</code>ã€‚äº¤æ¢æœºç±»å‹å’Œ<code>routing key</code>å…±åŒå†³å®šäº†æ¶ˆæ¯çš„è·¯ç”±æ–¹å¼ã€‚</li></ul></li></ul><p>äºŒã€æ¶ˆæ¯è·¯ç”±</p><ul><li>äº¤æ¢æœºæ¥æ”¶æ¶ˆæ¯<ul><li>äº¤æ¢æœºæ ¹æ®è‡ªèº«ç±»å‹ï¼ˆå¦‚Direct, Fanout, Topic, Headersï¼‰å’Œç”Ÿäº§è€…æŒ‡å®šçš„<code>routing key</code>æ¥å†³å®šå¦‚ä½•å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚</li></ul></li><li>è·¯ç”±é˜Ÿåˆ—<ul><li>äº¤æ¢æœºæ ¹æ®ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ï¼ˆQueueï¼‰çš„<code>binding key</code>æ¥å†³å®šæ¶ˆæ¯åº”è¯¥è¢«è·¯ç”±åˆ°å“ªäº›é˜Ÿåˆ—ã€‚</li><li>å¯¹äºDirectå’ŒTopicäº¤æ¢æœºï¼Œè¿™ä¸€è¿‡ç¨‹æ¶‰åŠåˆ°<code>routing key</code>ä¸<code>binding key</code>çš„åŒ¹é…ã€‚</li></ul></li></ul><p>ä¸‰ã€æ¶ˆæ¯å­˜å‚¨</p><ul><li>æ¶ˆæ¯å…¥é˜Ÿ<ul><li>ä¸€æ—¦å†³å®šäº†æ¶ˆæ¯çš„ç›®æ ‡é˜Ÿåˆ—ï¼Œæ¶ˆæ¯å°†è¢«å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«æ¶ˆè´¹ã€‚é˜Ÿåˆ—ä¿è¯äº†æ¶ˆæ¯çš„æœ‰åºæ€§å’Œå†—ä½™å­˜å‚¨ã€‚</li></ul></li><li>æŒä¹…åŒ–ï¼ˆå¯é€‰ï¼‰<ul><li>å¦‚æœé˜Ÿåˆ—è¢«å£°æ˜ä¸ºæŒä¹…åŒ–çš„ï¼Œå¹¶ä¸”æ¶ˆæ¯ä¹Ÿè¢«æ ‡è®°ä¸ºæŒä¹…åŒ–ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šè¢«å†™å…¥ç£ç›˜ï¼Œä»¥ç¡®ä¿å³ä½¿åœ¨RabbitMQé‡å¯åæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li></ul></li></ul><p>å››ã€æ¶ˆæ¯æ¶ˆè´¹</p><ul><li>æ¶ˆè´¹è€…è®¢é˜…é˜Ÿåˆ—<ul><li>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰é€šè¿‡å®¢æˆ·ç«¯åº“ä¸RabbitMQå»ºç«‹è¿æ¥ï¼Œå¹¶åˆ›å»ºä¿¡é“ã€‚ç„¶åå®ƒè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ï¼Œå‡†å¤‡æ¥æ”¶æ¶ˆæ¯ã€‚</li></ul></li><li>æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…<ul><li>RabbitMQå°†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æŒ‰é¡ºåºä¼ é€’ç»™è®¢é˜…è¯¥é˜Ÿåˆ—çš„æ¶ˆè´¹è€…ã€‚</li><li>å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…è®¢é˜…åŒä¸€ä¸ªé˜Ÿåˆ—ï¼ŒRabbitMQå¯ä»¥æŒ‰ç…§è½®è¯¢æˆ–å…¶ä»–ç­–ç•¥åˆ†é…æ¶ˆæ¯ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</li></ul></li><li>æ¶ˆæ¯ç¡®è®¤ <ul><li>æ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯åï¼Œéœ€è¦å‘RabbitMQå‘é€ä¸€ä¸ªç¡®è®¤ï¼ˆACKï¼‰ä¿¡å·ï¼Œè¡¨ç¤ºæ¶ˆæ¯å·²ç»è¢«æ­£ç¡®å¤„ç†ã€‚</li><li>å¦‚æœæ¶ˆè´¹è€…å› ä¸ºæŸäº›åŸå› æ— æ³•å¤„ç†æ¶ˆæ¯ï¼Œå®ƒå¯ä»¥å‘é€æ‹’ç»ï¼ˆNACKï¼‰ä¿¡å·æˆ–ä¸ç¡®è®¤ï¼ˆRejectï¼‰ï¼Œè®©RabbitMQæ ¹æ®é…ç½®è¿›è¡Œæ¶ˆæ¯é‡è¯•æˆ–å°†æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚</li></ul></li></ul><p>äº”ã€æ¶ˆæ¯ç¡®è®¤ä¸é‡è¯•</p><ul><li>æ‰‹åŠ¨ä¸è‡ªåŠ¨ç¡®è®¤<ul><li>æ¶ˆè´¹è€…å¯ä»¥é€‰æ‹©æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯æˆ–é…ç½®è‡ªåŠ¨ç¡®è®¤ã€‚æ‰‹åŠ¨ç¡®è®¤ç»™äºˆæ¶ˆè´¹è€…æ›´å¤§çš„æ§åˆ¶æƒï¼Œä½†éœ€è¦åœ¨æ¶ˆè´¹è€…ä»£ç ä¸­æ˜¾å¼å¤„ç†ã€‚</li></ul></li><li>å¤±è´¥é‡è¯•å’Œæ­»ä¿¡å¤„ç†<ul><li>å¯¹äºå¤„ç†å¤±è´¥çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…å¯ä»¥é€šè¿‡NACKæˆ–Rejectå¹¶è®¾ç½®é‡å…¥é˜Ÿåˆ—æ ‡å¿—æ¥å®ç°é‡è¯•ã€‚æˆ–è€…é€šè¿‡æ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰æœºåˆ¶å°†æ— æ³•å¤„ç†çš„æ¶ˆæ¯è½¬å‘åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚</li></ul></li></ul><h5 id="äº¤æ¢æœºç±»å‹-ğŸš©"><a href="#äº¤æ¢æœºç±»å‹-ğŸš©" class="headerlink" title="äº¤æ¢æœºç±»å‹   ğŸš©"></a>äº¤æ¢æœºç±»å‹   ğŸš©</h5><p>ï¼ˆäº¤æ¢æœº â†’  é˜Ÿåˆ—ï¼‰</p><ul><li>Direct Exchange<ul><li><code>binding key</code> ä¸æ¶ˆæ¯çš„ <code>routing key</code> å®Œå…¨åŒ¹é…é˜Ÿåˆ—</li></ul></li><li>Topic Exchange<ul><li>æ¨¡å¼åŒ¹é…</li></ul></li><li>Fanout Exchange<ul><li>å¹¿æ’­ï¼ˆå¿½ç•¥ <code>routing key</code> ï¼‰</li></ul></li><li>Headers Exchange<ul><li>ä¸ä¾èµ– <code>routing key</code>ï¼Œå¤´éƒ¨å±æ€§åŒ¹é…</li></ul></li></ul><hr><p>RabbitMQ ä¸­æœ€å¸¸ç”¨çš„å‡ ç§äº¤æ¢æœºç±»å‹åŠå…¶åŒºåˆ«ï¼š</p><blockquote><ol><li>Direct Exchangeï¼ˆç›´æ¥äº¤æ¢æœºï¼‰</li></ol></blockquote><ul><li><strong>è¡Œä¸º</strong>ï¼šæ¶ˆæ¯è¢«è·¯ç”±åˆ°é‚£äº› <code>binding key</code> ä¸æ¶ˆæ¯çš„ <code>routing key</code> å®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šéå¸¸é€‚åˆå•æ’­ï¼ˆunicastï¼‰æˆ–å¤šæ’­ï¼ˆmulticastï¼‰è·¯ç”±åœºæ™¯ï¼Œå³ä¸€å¯¹ä¸€æˆ–ä¸€å¯¹å¤šå‘é€ã€‚</li></ul><blockquote><ol start="2"><li>Fanout Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢æœºï¼‰</li></ol></blockquote><ul><li><strong>è¡Œä¸º</strong>ï¼šæ¶ˆæ¯è¢«è·¯ç”±åˆ°æ‰€æœ‰ä¸è¯¥äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—ï¼Œå¿½ç•¥ <code>routing key</code>ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šéå¸¸é€‚åˆå¹¿æ’­æ¶ˆæ¯ï¼Œå¦‚æ—¥å¿—ç³»ç»Ÿï¼Œå…¶ä¸­æ¶ˆæ¯éœ€è¦è¢«å‘é€åˆ°å¤šä¸ªç›®çš„åœ°ã€‚</li></ul><blockquote><ol start="3"><li>Topic Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰</li></ol></blockquote><ul><li><strong>è¡Œä¸º</strong>ï¼šå¯ä»¥æ ¹æ®æ¨¡å¼åŒ¹é… <code>routing keys</code> å’Œ <code>binding keys</code>ï¼ˆæ¨¡å¼ä¸­å¯ä»¥åŒ…å«é€šé…ç¬¦ï¼‰ã€‚<code>routing key</code> ä¸ºç‚¹åˆ†éš”çš„ä¸€ç³»åˆ—å•è¯ï¼Œ<code>binding key</code> ä¸­å¯ä»¥åŒ…å«ç‰¹æ®Šå­—ç¬¦ <code>*</code> å’Œ <code>#</code> æ¥è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼Œå…¶ä¸­ <code>*</code> åŒ¹é…ä¸€ä¸ªå•è¯ï¼Œ<code>#</code> åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå•è¯ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šé€‚ç”¨äºåŒæ—¶éœ€è¦å•æ’­å’Œå¤šæ’­è·¯ç”±é€»è¾‘çš„å¤æ‚è·¯ç”±é…ç½®ã€‚</li></ul><blockquote><ol start="4"><li>Headers Exchangeï¼ˆå¤´éƒ¨äº¤æ¢æœºï¼‰</li></ol></blockquote><ul><li><strong>è¡Œä¸º</strong>ï¼šåŸºäºæ¶ˆæ¯å¤´éƒ¨ï¼ˆheadersï¼‰ä¸­çš„å±æ€§è¿›è¡ŒåŒ¹é…ã€‚ä¸ä¾èµ– <code>routing key</code>ã€‚åŒ¹é…è§„åˆ™å¯ä»¥æ˜¯â€œæ‰€æœ‰â€ï¼ˆ<code>x-match=all</code>ï¼Œå³æ‰€æœ‰å¤´éƒ¨å±æ€§å¿…é¡»åŒ¹é…ï¼‰æˆ–â€œä»»ä½•â€ï¼ˆ<code>x-match=any</code>ï¼Œå³ä»»æ„å¤´éƒ¨å±æ€§åŒ¹é…ï¼‰ã€‚</li><li><strong>ç”¨é€”</strong>ï¼šé€‚ç”¨äºéœ€è¦æ ¹æ®å¤šä¸ªå±æ€§è¿›è¡Œè·¯ç”±å†³ç­–çš„é«˜çº§è·¯ç”±ç­–ç•¥ã€‚</li></ul><blockquote><p>æ€»ç»“</p></blockquote><p>é€‰æ‹©å“ªç§äº¤æ¢æœºç±»å‹ä¸»è¦å–å†³äºä½ çš„å…·ä½“åº”ç”¨åœºæ™¯å’Œæ¶ˆæ¯è·¯ç”±éœ€æ±‚ã€‚</p><p>ç›´æ¥äº¤æ¢æœºé€‚åˆç®€å•çš„å•æ’­è·¯ç”±ï¼Œæ‰‡å‡ºäº¤æ¢æœºé€‚åˆå¹¿æ’­ï¼Œä¸»é¢˜äº¤æ¢æœºé€‚åˆå¤æ‚çš„è·¯ç”±åœºæ™¯ï¼Œè€Œå¤´éƒ¨äº¤æ¢æœºé€‚åˆåŸºäºå¤šå±æ€§çš„è·¯ç”±å†³ç­–ã€‚äº†è§£è¿™äº›äº¤æ¢æœºçš„ç‰¹ç‚¹å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°è®¾è®¡æ¶ˆæ¯è·¯ç”±ç­–ç•¥ï¼Œå¹¶å……åˆ†åˆ©ç”¨ RabbitMQ çš„å¼ºå¤§åŠŸèƒ½ã€‚</p><p>RabbitMQ çš„å¤„ç†æµç¨‹æ˜¯å›´ç»•ç€è¿æ¥ã€äº¤æ¢æœºã€æ¶ˆæ¯å‘é€å’Œæ¶ˆæ¯æ¥æ”¶è¿™å‡ ä¸ªæ ¸å¿ƒç¯èŠ‚å±•å¼€çš„ã€‚</p><h5 id="è·¯ç”±é”®ï¼ˆRouting-Keyï¼‰çš„ä½œç”¨"><a href="#è·¯ç”±é”®ï¼ˆRouting-Keyï¼‰çš„ä½œç”¨" class="headerlink" title="è·¯ç”±é”®ï¼ˆRouting Keyï¼‰çš„ä½œç”¨"></a>è·¯ç”±é”®ï¼ˆRouting Keyï¼‰çš„ä½œç”¨</h5><p>è·¯ç”±é”®æ˜¯æ¶ˆæ¯å‘å¸ƒåˆ° RabbitMQ æ—¶<strong>é™„å¸¦çš„ä¸€ä¸ªå­—ç¬¦ä¸²æ ‡è¯†</strong>ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¸®åŠ©äº¤æ¢æœºå†³å®šå¦‚ä½•è·¯ç”±æ¶ˆæ¯ã€‚</p><p>è¿™é‡Œçš„â€œè·¯ç”±â€æŒ‡çš„æ˜¯å†³å®šæ¶ˆæ¯åº”è¯¥è¢«å‘é€åˆ°å“ªä¸€ä¸ªæˆ–å“ªäº›é˜Ÿåˆ—ã€‚è·¯ç”±é”®çš„å…·ä½“ä½œç”¨å–å†³äºäº¤æ¢æœºçš„ç±»å‹ï¼š</p><ol><li><strong>Direct Exchange</strong>ï¼šäº¤æ¢æœºä¼šå°†æ¶ˆæ¯è·¯ç”±åˆ°é‚£äº› <code>binding key</code> ä¸ <code>routing key</code> å®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—ã€‚</li><li><strong>Topic Exchange</strong>ï¼šå¯ä»¥è¿›è¡Œæ¨¡å¼åŒ¹é…ï¼Œäº¤æ¢æœºä¼šæ ¹æ® <code>routing key</code> å’Œé˜Ÿåˆ—çš„ <code>binding key</code>ï¼ˆå¯ä»¥åŒ…å«é€šé…ç¬¦ï¼‰è¿›è¡ŒåŒ¹é…ã€‚</li><li><strong>Fanout Exchange</strong>ï¼šå¿½ç•¥è·¯ç”±é”®ï¼Œæ¶ˆæ¯ä¼šè¢«å‘é€åˆ°æ‰€æœ‰ç»‘å®šåˆ°è¯¥äº¤æ¢æœºçš„é˜Ÿåˆ—ã€‚</li><li><strong>Headers Exchange</strong>ï¼šä¸ä¾èµ–è·¯ç”±é”®ï¼Œè€Œæ˜¯æ ¹æ®å‘é€çš„æ¶ˆæ¯å¤´éƒ¨ä¸­çš„é”®å€¼å¯¹è¿›è¡ŒåŒ¹é…ã€‚</li></ol><blockquote><p>routing key å’Œ binding key çš„ä½œç”¨</p></blockquote><ul><li><code>routing key</code><ul><li>1ã€ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„æ—¶å€™é™„åŠ çš„ä¸€ä¸ªå­—ç¬¦ä¸²æ ‡è¯†ç¬¦</li><li>2ã€è¿™ä¸ªæ ‡è¯†ç¬¦çš„ä½œç”¨æ˜¯ï¼šæè¿°æ¶ˆæ¯çš„è·¯ç”±è§„åˆ™ï¼Œå†³å®šäº†è¿™ä¸ªæ¶ˆæ¯åº”è¯¥è·¯ç”±åˆ°å“ªä¸ªé˜Ÿåˆ—</li></ul></li><li><code>binding key</code><ul><li>1ã€é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºçš„æ—¶å€™å£°æ˜çš„ä¸€ä¸ªå­—ç¬¦ä¸²æ ‡è¯†ç¬¦</li><li>2ã€è¿™ä¸ªæ ‡è¯†ç¬¦çš„ä½œç”¨å–å†³äºäº¤æ¢æœºçš„ç±»å‹å’Œé¢„æœŸçš„æ¶ˆæ¯è·¯ç”±é€»è¾‘</li></ul></li></ul><p>å•ç‹¬æŠ½ç¦» [[æ¶ˆæ¯é˜Ÿåˆ—_RabbitMQ_åŸºç¡€ä½¿ç”¨#1ã€RabbitMQå¹¿æ’­å’Œç›´æ¥æ¨¡å¼ç¤ºä¾‹]] ä¸­å…³äº Direct Exchange ç›´æ¥äº¤æ¢æœºçš„ä½¿ç”¨å†…å®¹ï¼š</p><p>ç›´æ¥äº¤æ¢æœºæ˜¯ä¸€ç§å°†æ¶ˆæ¯è·¯ç”±åˆ°é‚£äº›<code>binding key</code>ä¸æ¶ˆæ¯çš„<code>routing key</code>å®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—çš„äº¤æ¢æœºã€‚</p><p>RabbitConfig é…ç½®ç±»å†…å®¹</p><p>å£°æ˜ Direct äº¤æ¢æœº</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å£°æ˜Directäº¤æ¢æœº æ”¯æŒæŒä¹…åŒ–.</span><br><span class="hljs-comment"> * é€šè¿‡directExchangeæ–¹æ³•åˆ›å»ºä¸€ä¸ªåä¸ºDIRECT_EXCHANGEçš„Directäº¤æ¢æœºï¼Œå¹¶è®¾ç½®ä¸ºæ”¯æŒæŒä¹…åŒ–ï¼Œè¿™æ„å‘³ç€äº¤æ¢æœºä¼šåœ¨RabbitMQé‡å¯åä¾ç„¶å­˜åœ¨ã€‚</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> the exchange</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Bean(<span class="hljs-string">&quot;directExchange&quot;</span>)</span><br><span class="hljs-keyword">public</span> Exchange directExchange() &#123;<br>    <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(<span class="hljs-string">&quot;DIRECT_EXCHANGE&quot;</span>).durable(<span class="hljs-literal">true</span>).build();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å£°æ˜ä¸€ä¸ªé˜Ÿåˆ— æ”¯æŒæŒä¹…åŒ–.</span><br><span class="hljs-comment"> *directQueueæ–¹æ³•å£°æ˜äº†ä¸€ä¸ªåä¸ºDIRECT_QUEUEçš„é˜Ÿåˆ—ï¼Œå¹¶è®¾ç½®ä¸ºæŒä¹…åŒ–ã€‚</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> the queue</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Bean(<span class="hljs-string">&quot;directQueue&quot;</span>)</span><br><span class="hljs-keyword">public</span> Queue directQueue() &#123;<br>    <span class="hljs-keyword">return</span> QueueBuilder.durable(<span class="hljs-string">&quot;DIRECT_QUEUE&quot;</span>).build();<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é€šè¿‡ç»‘å®šé”® å°†æŒ‡å®šé˜Ÿåˆ—ç»‘å®šåˆ°ä¸€ä¸ªæŒ‡å®šçš„äº¤æ¢æœº .</span><br><span class="hljs-comment"> *directBindingæ–¹æ³•é€šè¿‡BindingBuilderå°†DIRECT_QUEUEé˜Ÿåˆ—ç»‘å®šåˆ°DIRECT_EXCHANGEäº¤æ¢æœºï¼Œç»‘å®šé”®ä¸ºDIRECT_ROUTING_KEYã€‚</span><br><span class="hljs-comment"> * è¿™æ„å‘³ç€åªæœ‰å½“æ¶ˆæ¯çš„routing keyä¸ºDIRECT_ROUTING_KEYæ—¶ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«è·¯ç”±åˆ°DIRECT_QUEUEé˜Ÿåˆ—ã€‚</span><br><span class="hljs-comment"> * @param queue    the queue</span><br><span class="hljs-comment"> * @param exchange the exchange</span><br><span class="hljs-comment"> * @return the binding</span><br><span class="hljs-comment"> */</span><br><span class="hljs-variable">@Bean</span><br>public Binding <span class="hljs-built_in">directBinding</span>(<span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">&quot;directQueue&quot;</span>) Queue queue,<br>                             <span class="hljs-variable">@Qualifier</span>(<span class="hljs-string">&quot;directExchange&quot;</span>) Exchange exchange) &#123;<br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">BindingBuilder</span><span class="hljs-selector-class">.bind</span>(queue)<span class="hljs-selector-class">.to</span>(exchange)<span class="hljs-selector-class">.with</span>(<span class="hljs-string">&quot;DIRECT_ROUTING_KEY&quot;</span>)<span class="hljs-selector-class">.noargs</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å‘é€æµ‹è¯•</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æµ‹è¯•Directæ¨¡å¼.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> p the p</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> the response entity</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">direct</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> p</span>) &#123;<br>    <span class="hljs-title class_">CorrelationData</span> correlationData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorrelationData</span>(<span class="hljs-variable constant_">UUID</span>.<span class="hljs-title function_">randomUUID</span>().<span class="hljs-title function_">toString</span>());<br>    rabbitTemplate.<span class="hljs-title function_">convertAndSend</span>(<span class="hljs-string">&quot;DIRECT_EXCHANGE&quot;</span>, <span class="hljs-string">&quot;DIRECT_ROUTING_KEY&quot;</span>, p, correlationData);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>äº¤æ¢æœºä¸æ¶ˆè´¹è€…ä¹‹é—´çš„ååŒ</p></blockquote><p>äº¤æ¢æœºä¸ç›´æ¥ä¸æ¶ˆè´¹è€…é€šä¿¡æ¥å†³å®šå‘å“ªä¸ªæ¶ˆè´¹è€…å‘é€æ¶ˆæ¯ã€‚</p><p>ç›¸åï¼Œå®ƒä¾èµ–äºé˜Ÿåˆ—å’Œé˜Ÿåˆ—ä¸æ¶ˆè´¹è€…ä¹‹é—´çš„å…³ç³»æ¥å®ç°æ¶ˆæ¯çš„åˆ†å‘ã€‚ä¸‹é¢æ˜¯å®ƒä»¬æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ï¼š</p><ol><li><strong>é˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœº</strong>ï¼šé˜Ÿåˆ—é€šè¿‡ <code>binding key</code>ï¼ˆåœ¨ fanout å’Œ headers äº¤æ¢æœºä¸­ï¼Œè¿™ä¸ª <code>binding key</code> ä¸ä¸€å®šè¢«ä½¿ç”¨ï¼‰ç»‘å®šåˆ°äº¤æ¢æœºã€‚è¿™ä¸ªè¿‡ç¨‹å†³å®šäº†å“ªäº›æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°ç‰¹å®šçš„é˜Ÿåˆ—ã€‚</li><li><strong>æ¶ˆè´¹è€…ç›‘å¬é˜Ÿåˆ—</strong>ï¼šæ¶ˆè´¹è€…é€šè¿‡æ‰“å¼€ä¸€ä¸ªé€šé“å¹¶è®¢é˜…ï¼ˆæˆ–ç›‘å¬ï¼‰ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—æ¥æ¥æ”¶æ¶ˆæ¯ã€‚è¿™æ„å‘³ç€æ¶ˆè´¹è€…å‘Šè¯‰ RabbitMQï¼šâ€œæˆ‘å¯¹è¿™ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ„Ÿå…´è¶£ï¼Œè¯·å°†å®ƒä»¬å‘é€ç»™æˆ‘ã€‚â€</li><li><strong>æ¶ˆæ¯åˆ†å‘</strong>ï¼šå½“æ¶ˆæ¯é€šè¿‡äº¤æ¢æœºè¢«è·¯ç”±åˆ°é˜Ÿåˆ—åï¼ŒRabbitMQ ä¼šå°†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å‘é€ç»™è®¢é˜…è¯¥é˜Ÿåˆ—çš„æ¶ˆè´¹è€…ã€‚è¿™ä¸ªåˆ†å‘è¿‡ç¨‹å¯èƒ½æ˜¯åŸºäºä¸åŒçš„ç­–ç•¥ï¼Œå¦‚è½®è¯¢æˆ–å…¬å¹³è°ƒåº¦ç­‰ã€‚</li></ol><h5 id="æ¶ˆè´¹è€…çš„ç›‘å¬"><a href="#æ¶ˆè´¹è€…çš„ç›‘å¬" class="headerlink" title="æ¶ˆè´¹è€…çš„ç›‘å¬"></a>æ¶ˆè´¹è€…çš„ç›‘å¬</h5><p>å½“æˆ‘ä»¬è¯´æ¶ˆè´¹è€…â€œç›‘å¬â€ä¸€ä¸ªé˜Ÿåˆ—æ—¶ï¼Œå®é™…ä¸Šæ˜¯æŒ‡æ¶ˆè´¹è€…å¼€å¯äº†ä¸€ä¸ªæŒç»­çš„ã€å¼‚æ­¥çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šç­‰å¾…ã€æ¥æ”¶å¹¶å¤„ç†æ¥è‡ªé˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚</p><p>æ¶ˆè´¹è€…é€šè¿‡é€šé“å‘ RabbitMQ æ³¨å†Œå…¶å¯¹ç‰¹å®šé˜Ÿåˆ—çš„å…´è¶£ã€‚ä¸€æ—¦é˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯ï¼ŒRabbitMQ å°±ä¼šå°†æ¶ˆæ¯æ¨é€ç»™æ¶ˆè´¹è€…ã€‚æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šæ ¹æ®è‡ªå·±çš„é€»è¾‘è¿›è¡Œå¤„ç†ã€‚</p><p>æ¶ˆè´¹è€…é€šè¿‡ç›‘å¬é˜Ÿåˆ—æ¥æ¥æ”¶æ¶ˆæ¯ï¼Œäº¤æ¢æœºæœ¬èº«å¹¶ä¸å†³å®šæ¶ˆæ¯å‘é€ç»™å“ªä¸ªæ¶ˆè´¹è€…ï¼Œè¿™æ˜¯ç”±é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¸æ¶ˆè´¹è€…ä¹‹é—´çš„å…³ç³»å†³å®šçš„ã€‚<strong>æ¶ˆè´¹è€…ç›‘å¬æ„å‘³ç€å®ƒä»¬å‡†å¤‡å¥½æ¥æ”¶å’Œå¤„ç†ä»é˜Ÿåˆ—ä¸­æ¥çš„æ¶ˆæ¯ã€‚</strong></p><h3 id="äºŒã€å¸¸è§ç”Ÿäº§é—®é¢˜"><a href="#äºŒã€å¸¸è§ç”Ÿäº§é—®é¢˜" class="headerlink" title="äºŒã€å¸¸è§ç”Ÿäº§é—®é¢˜"></a>äºŒã€å¸¸è§ç”Ÿäº§é—®é¢˜</h3><p>å¸¸è§ç”Ÿäº§é—®é¢˜ä»¥åŠå¦‚ä½•å¤„ç†</p><h4 id="å¦‚ä½•æ¶ˆæ¯ä¸ä¸¢å¤±-ğŸš©"><a href="#å¦‚ä½•æ¶ˆæ¯ä¸ä¸¢å¤±-ğŸš©" class="headerlink" title="å¦‚ä½•æ¶ˆæ¯ä¸ä¸¢å¤±  ğŸš©"></a>å¦‚ä½•æ¶ˆæ¯ä¸ä¸¢å¤±  ğŸš©</h4><p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹éƒ½æœ‰å¯èƒ½å‘ç”Ÿæ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µ</p><ul><li>1ã€æ¶ˆæ¯æœªåˆ°è¾¾äº¤æ¢æœº</li><li>2ã€æ¶ˆæ¯æœªåˆ°è¾¾é˜Ÿåˆ—</li><li>3ã€é˜Ÿåˆ—ä¸­æ¶ˆæ¯ä¸¢å¤±</li><li>4ã€æ¶ˆè´¹è€…æœªæ¥æ”¶åˆ°æ¶ˆæ¯</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402271502394.png" alt="image.png"></p><p>RabbitMQæä¾›äº†å¤šç§æœºåˆ¶æ¥ç¡®ä¿<strong>æ¶ˆæ¯åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±</strong>ï¼Œä¸»è¦é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å®ç°</p><h5 id="ä¸€ã€å‘å¸ƒç¡®è®¤"><a href="#ä¸€ã€å‘å¸ƒç¡®è®¤" class="headerlink" title="ä¸€ã€å‘å¸ƒç¡®è®¤"></a>ä¸€ã€å‘å¸ƒç¡®è®¤</h5><p>å‘å¸ƒç¡®è®¤ï¼ˆPublisher Confirmsï¼‰</p><p>å‘å¸ƒç¡®è®¤æ˜¯RabbitMQæä¾›çš„ä¸€ç§è½»é‡çº§ã€é«˜æ•ˆçš„ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±çš„æœºåˆ¶ï¼Œç›¸æ¯”äº‹åŠ¡æœºåˆ¶æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚ç”Ÿäº§è€…å¯ä»¥åœ¨å‘é€æ¶ˆæ¯åå¼‚æ­¥æ¥æ”¶ä¸€ä¸ªæ¥è‡ªRabbitMQçš„ç¡®è®¤ï¼Œè¡¨æ˜æ¶ˆæ¯å·²è¢«RabbitMQæ­£ç¡®æ¥æ”¶ã€‚å¦‚æœRabbitMQæ²¡æœ‰ç¡®è®¤æ¶ˆæ¯ï¼Œç”Ÿäº§è€…å¯ä»¥é€‰æ‹©é‡è¯•å‘é€æ¶ˆæ¯ã€‚</p><ul><li>å¼€å¯å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œé¦–å…ˆéœ€è¦å°†ä¿¡é“ï¼ˆChannelï¼‰è®¾ç½®ä¸ºå‘å¸ƒç¡®è®¤æ¨¡å¼ï¼ˆ<code>confirmSelect</code>ï¼‰ã€‚</li><li>å‘é€æ¶ˆæ¯åï¼Œé€šè¿‡ç›‘å¬ä¿¡é“ä¸Šçš„ç¡®è®¤å›è°ƒæ¥æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦è¢«æˆåŠŸæ¥æ”¶ã€‚</li></ul><p>å¦‚æœå¼€å¯å‘å¸ƒç¡®è®¤æ¨¡å¼åï¼Œå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºæˆ–è€…é˜Ÿåˆ—å¤±è´¥ä¼šè¿”å›ä¸åŒçš„ä¿¡æ¯ç»™ç”Ÿäº§è€…</p><p>å‘é€å¤±è´¥ä¹‹åçš„å¤„ç†æ–¹å¼ï¼š</p><ul><li>1ã€å›è°ƒæ–¹æ³•å³æ—¶é‡å‘</li><li>2ã€è®°å½•æ—¥å¿—</li><li>3ã€ä¿å­˜åˆ°æ•°æ®åº“è¿›è¡Œå®šæ—¶é‡å‘ï¼Œé‡å‘åä¿®æ”¹æ ‡è¯†æˆ–è€…åˆ é™¤è®°å½•</li></ul><h5 id="äºŒã€æ¶ˆæ¯æŒä¹…åŒ–"><a href="#äºŒã€æ¶ˆæ¯æŒä¹…åŒ–" class="headerlink" title="äºŒã€æ¶ˆæ¯æŒä¹…åŒ–"></a>äºŒã€æ¶ˆæ¯æŒä¹…åŒ–</h5><p>ä¸ºäº†é˜²æ­¢æ¶ˆæ¯ä¸­é—´ä»¶æœåŠ¡å®•æœºé€ æˆçš„æ¶ˆæ¯ä¸¢å¤±ï¼Œå¯ä»¥ä½¿ç”¨æ¶ˆæ¯æŒä¹…åŒ–é¿å…ã€‚</p><p>æ¶ˆæ¯æŒä¹…åŒ–æ˜¯é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ã€‚åœ¨RabbitMQä¸­ï¼Œå¯ä»¥å°†é˜Ÿåˆ—ï¼ˆQueueï¼‰å’Œæ¶ˆæ¯ï¼ˆMessageï¼‰è®¾ç½®ä¸ºæŒä¹…åŒ–ï¼Œä»¥ç¡®ä¿å³ä½¿åœ¨RabbitMQæœåŠ¡å™¨é‡å¯çš„æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p><ul><li><strong>æŒä¹…åŒ–é˜Ÿåˆ—</strong>ï¼šåœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶ï¼Œå°†å…¶å£°æ˜ä¸ºæŒä¹…åŒ–ï¼ˆdurableï¼‰ã€‚è¿™æ ·ï¼Œé˜Ÿåˆ—çš„å…ƒæ•°æ®å’ŒçŠ¶æ€ä¼šè¢«ä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚</li><li><strong>æŒä¹…åŒ–æ¶ˆæ¯</strong>ï¼šå‘é€æ¶ˆæ¯æ—¶ï¼Œå°†æ¶ˆæ¯çš„<code>delivery_mode</code>å±æ€§è®¾ç½®ä¸º<code>2</code>ï¼ˆè¡¨ç¤ºæŒä¹…åŒ–æ¶ˆæ¯ï¼‰ã€‚è¿™æ ·ï¼Œæ¶ˆæ¯ä¼šè¢«å†™å…¥åˆ°ç£ç›˜ä¸Šï¼Œç›´åˆ°è¢«å®Œå…¨æ¶ˆè´¹ã€‚</li></ul><p>æ¶ˆæ¯æŒä¹…åŒ–ï¼šå¦‚æœéœ€è¦å¼€å¯æŒä¹…åŒ–ï¼Œå¯ä»¥å°†äº¤æ¢æœºã€é˜Ÿåˆ—ã€æ¶ˆæ¯éƒ½è¿›è¡ŒæŒä¹…åŒ–æ“ä½œã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402271510090.png" alt="image.png"></p><h5 id="ä¸‰ã€æ¶ˆè´¹è€…ç¡®è®¤"><a href="#ä¸‰ã€æ¶ˆè´¹è€…ç¡®è®¤" class="headerlink" title="ä¸‰ã€æ¶ˆè´¹è€…ç¡®è®¤"></a>ä¸‰ã€æ¶ˆè´¹è€…ç¡®è®¤</h5><p>æ¶ˆè´¹è€…ç¡®è®¤ï¼ˆConsumer Acknowledgementsï¼‰</p><p>ä¸ºäº†é˜²æ­¢é˜Ÿåˆ—åˆ°æ¶ˆè´¹è€…è¿™ä¸€æ­¥ä¸­æ¶ˆæ¯ä¸¢å¤±ï¼Œå¯ä»¥å¼€å¯æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ï¼Œ</p><p>æ¶ˆè´¹è€…ç¡®è®¤ï¼ˆACKï¼‰æœºåˆ¶ç¡®ä¿æ¶ˆæ¯è¢«æ¶ˆè´¹è€…æ­£ç¡®å¤„ç†ã€‚åœ¨æ¶ˆè´¹è€…æˆåŠŸå¤„ç†æ¶ˆæ¯åï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªACKç»™RabbitMQï¼ŒRabbitMQæ”¶åˆ°ACKåä¼šä»é˜Ÿåˆ—ä¸­åˆ é™¤è¯¥æ¶ˆæ¯ã€‚</p><p>å¦‚æœæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯å¤±è´¥ï¼ˆä¾‹å¦‚ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼‰ï¼Œå¯ä»¥å‘é€æ‹’ç»ï¼ˆ<code>nack</code>ï¼‰æˆ–æœªç¡®è®¤ï¼ˆ<code>reject</code>ï¼‰ï¼Œæ ¹æ®é…ç½®ï¼ŒRabbitMQå¯ä»¥é‡æ–°å°†æ¶ˆæ¯æ”¾å›é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…é‡æ–°æ¶ˆè´¹ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402271517763.png" alt="image.png"></p><hr><h6 id="æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶"><a href="#æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶" class="headerlink" title="æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶"></a>æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶</h6><p>è¿™é‡Œå†è®²è¿°ä¸€ä¸‹æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ç›¸å…³çš„å†…å®¹ï¼š</p><p>æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ï¼ˆConsumer Acknowledgementsï¼‰åœ¨RabbitMQä¸­æ˜¯ä¸€ç§ä¿è¯æ¶ˆæ¯è¢«æ­£ç¡®å¤„ç†çš„æœºåˆ¶ã€‚å½“æ¶ˆæ¯ä»é˜Ÿåˆ—ä¼ é€’ç»™æ¶ˆè´¹è€…åï¼Œæ¶ˆè´¹è€…éœ€è¦å¯¹å¤„ç†çš„ç»“æœè¿›è¡Œåé¦ˆã€‚å¦‚æœæ¶ˆæ¯è¢«æˆåŠŸå¤„ç†ï¼Œæ¶ˆè´¹è€…ä¼šå‘é€ä¸€ä¸ªACKï¼ˆAcknowledgementï¼‰ä¿¡å·ç»™RabbitMQï¼Œå‘ŠçŸ¥æ¶ˆæ¯å·²ç»è¢«æˆåŠŸæ¶ˆè´¹ï¼ŒéšåRabbitMQä¼šä»é˜Ÿåˆ—ä¸­åˆ é™¤è¯¥æ¶ˆæ¯ã€‚å¦‚æœæ¶ˆè´¹å¤±è´¥ï¼Œæ¶ˆè´¹è€…å¯ä»¥é€‰æ‹©ä¸å‘é€ACKï¼Œæˆ–è€…æ˜¾å¼åœ°å‘é€NACKï¼ˆnegative acknowledgementï¼‰æˆ–æ‹’ç»ï¼ˆrejectï¼‰ä¿¡å·ï¼Œæ ¹æ®é…ç½®ï¼ŒRabbitMQä¼šç›¸åº”åœ°å¤„ç†è¿™äº›æœªè¢«ç¡®è®¤çš„æ¶ˆæ¯ã€‚</p><p><strong>æ‰€ä»¥è¯´å¦‚æœå¼€å¯äº†è¿™ä¸ªæœºåˆ¶ï¼Œæ¶ˆæ¯åœ¨æœªæ”¶åˆ°åé¦ˆæ¶ˆæ¯å‰æ˜¯ä¼šä¿ç•™åœ¨é˜Ÿåˆ—ä¸­çš„</strong></p><blockquote><p>æ¶ˆè´¹å¤±è´¥çš„å¤„ç†</p></blockquote><p>å½“æ¶ˆè´¹è€…æ¶ˆè´¹å¤±è´¥ï¼Œä¸”æ²¡æœ‰è¿”å›ACKæ—¶ï¼ŒRabbitMQä¼šæ ¹æ®æ¶ˆæ¯çš„é…ç½®æ¥å†³å®šå¦‚ä½•å¤„ç†è¿™æ¡æ¶ˆæ¯ï¼š</p><ol><li><strong>æ¶ˆæ¯é‡æ–°æ’é˜Ÿ</strong>ï¼šå¦‚æœæ¶ˆè´¹è€…å› ä¸ºæŸäº›åŸå› å¤„ç†æ¶ˆæ¯å¤±è´¥ï¼ˆä¾‹å¦‚å¼‚å¸¸é€€å‡ºæˆ–é€»è¾‘é”™è¯¯ï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰å‘é€ACKï¼Œé‚£ä¹ˆRabbitMQé»˜è®¤ä¼šå°†æ¶ˆæ¯é‡æ–°æ”¾å›é˜Ÿåˆ—ä¸­ï¼Œä½ç½®å¯èƒ½åœ¨é˜Ÿåˆ—å¤´éƒ¨æˆ–å°¾éƒ¨ï¼Œè¿™å–å†³äºæ¶ˆæ¯çš„<code>requeue</code>æ ‡å¿—ã€‚å¦‚æœè®¾ç½®ä¸º<code>true</code>ï¼Œæ¶ˆæ¯ä¼šè¢«é‡æ–°æ’é˜Ÿï¼Œç­‰å¾…å…¶ä»–æ¶ˆè´¹è€…æˆ–å†æ¬¡è¢«åŒä¸€æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚</li><li><strong>æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸å¸Œæœ›æ— é™åˆ¶åœ°é‡æ–°å°è¯•å¤„ç†æ¶ˆæ¯ï¼ˆå¯èƒ½ä¼šé€ æˆæ­»å¾ªç¯ï¼‰ã€‚å¯ä»¥é€šè¿‡é…ç½®æ­»ä¿¡é˜Ÿåˆ—æ¥å¤„ç†è¿™äº›â€æ— æ³•å¤„ç†â€çš„æ¶ˆæ¯ã€‚å¦‚æœæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼Œå¹¶ä¸”è¾¾åˆ°äº†æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆè¿™éœ€è¦åœ¨åº”ç”¨é€»è¾‘ä¸­å®ç°é‡è¯•æœºåˆ¶ï¼‰ï¼Œå¯ä»¥é€‰æ‹©å°†æ¶ˆæ¯æ‹’ç»å¹¶é‡æ–°æ’é˜Ÿåˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚æ­»ä¿¡é˜Ÿåˆ—æ˜¯ä¸€ä¸ªæ™®é€šçš„RabbitMQé˜Ÿåˆ—ï¼Œä¸“é—¨ç”¨æ¥æ¥æ”¶è¿™äº›æ— æ³•å¤„ç†çš„æ¶ˆæ¯ï¼Œä¾¿äºåç»­åˆ†æå’Œå¤„ç†ã€‚</li></ol><blockquote><p>å®ç°é‡è¯•æœºåˆ¶</p></blockquote><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸éœ€è¦åœ¨æ¶ˆè´¹è€…ä¾§å®ç°æ¶ˆæ¯æ¶ˆè´¹çš„é‡è¯•æœºåˆ¶ï¼Œè¿™åŒ…æ‹¬ï¼š</p><ul><li><strong>å»¶è¿Ÿé‡è¯•</strong>ï¼šé€šè¿‡é…ç½®æ¶ˆæ¯çš„å»¶è¿Ÿï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨æ¶ˆæ¯TTLå’Œæ­»ä¿¡é˜Ÿåˆ—ï¼‰ï¼Œåœ¨æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥æ—¶å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªå»¶è¿Ÿé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åå†æ¬¡å°è¯•å¤„ç†ã€‚</li><li><strong>é‡è¯•æ¬¡æ•°é™åˆ¶</strong>ï¼šåœ¨æ¶ˆæ¯å±æ€§ä¸­è®°å½•é‡è¯•æ¬¡æ•°ï¼Œæ¯æ¬¡æ¶ˆè´¹å¤±è´¥æ—¶æ›´æ–°è¿™ä¸ªè®¡æ•°å™¨ã€‚å½“é‡è¯•æ¬¡æ•°è¾¾åˆ°é¢„è®¾çš„é˜ˆå€¼åï¼Œå¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—æˆ–è¿›è¡Œå…¶ä»–å¤„ç†ï¼Œä»¥é¿å…æ— é™é‡è¯•ã€‚</li></ul><p>é€šè¿‡è¿™æ ·çš„æœºåˆ¶ï¼Œå¯ä»¥çµæ´»åœ°æ§åˆ¶æ¶ˆæ¯çš„é‡è¯•ç­–ç•¥å’Œå¤±è´¥å¤„ç†ï¼Œç¡®ä¿æ¶ˆæ¯å¯ä»¥è¢«æ­£ç¡®å¤„ç†ï¼ŒåŒæ—¶é¿å…å› é‡è¯•æœºåˆ¶ä¸å½“å¯¼è‡´çš„é—®é¢˜ï¼Œå¦‚æ¶ˆæ¯é¡ºåºæ··ä¹±ã€ç³»ç»Ÿèµ„æºè¿‡åº¦å ç”¨ç­‰ã€‚</p><h5 id="å››ã€æ€»ç»“-ğŸš©"><a href="#å››ã€æ€»ç»“-ğŸš©" class="headerlink" title="å››ã€æ€»ç»“ ğŸš©"></a>å››ã€æ€»ç»“ ğŸš©</h5><p>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±</p><ul><li>å¼€å¯ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶ï¼Œç¡®ä¿ç”Ÿäº§è€…çš„æ¶ˆæ¯èƒ½åˆ°è¾¾é˜Ÿåˆ—</li><li>å¼€å¯æŒä¹…åŒ–åŠŸèƒ½ï¼Œç¡®ä¿æ¶ˆæ¯æœ«æ¶ˆè´¹å‰åœ¨é˜Ÿåˆ—ä¸­ä¸ä¼šä¸¢å¤±</li><li>å¼€å¯æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ä¸ºauto,ç”±springç¡®è®¤æ¶ˆæ¯å¤„ç†æˆåŠŸåå®Œæˆack</li><li>å¼€å¯æ¶ˆè´¹è€…å¤±æ•°é‡è¯•æœºåˆ«ï¼ˆé‡è¯•æ¬¡æ•°ä¸€èˆ¬è®¾ç½®ä¸º3ï¼‰ï¼Œå¤šæ¬¡é‡è¯•å¤±æ•°åå°†æ¶ˆæ¯æŠ•é€’åˆ°å¼‚å¸¸äº¤æ¢æœºï¼Œäº¤ç”±äººå·¥å¤„ç†</li></ul><p>é¢è¯•è€…å›ç­”å‚è€ƒï¼š</p><p>è¦æ±‚ç¡®ä¿æ¶ˆæ¯çš„é«˜å¯ç”¨æƒ…æ™¯ï¼šå®ç°Redis çš„åŒå†™ä¸€è‡´æ€§é‡‡ç”¨äº†RabbitMQ è¿›è¡Œå¼‚æ­¥æ›´æ–°&#x2F;åˆ é™¤æ“ä½œ</p><p>å›ç­”è§ä¸‹ï¼šğŸ‘‡</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402271528430.png" alt="image.png"></p><hr><h4 id="æ¶ˆæ¯é‡å¤æ¶ˆè´¹"><a href="#æ¶ˆæ¯é‡å¤æ¶ˆè´¹" class="headerlink" title="æ¶ˆæ¯é‡å¤æ¶ˆè´¹"></a>æ¶ˆæ¯é‡å¤æ¶ˆè´¹</h4><p>å‡ºç°æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„é—®é¢˜ä¸€èˆ¬æ˜¯åœ¨ç½‘ç»œæŠ–åŠ¨æˆ–è€…æ¶ˆæ¯è€…æŒ‚æ‰ï¼Œç”±äºå¼€å¯äº†æ¶ˆè´¹è€…ç¡®è®¤æœºåˆ¶ï¼Œå¯¼è‡´æ¶ˆæ¯é‡å‘</p><p>ä¸€èˆ¬è§£å†³æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ul><li>ä¸€ç§æ˜¯æ¯æ¡æ¶ˆæ¯è®¾ç½®ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯† ID ä»è€Œé¿å…é‡å‘æ¶ˆè´¹</li><li>ä¹Ÿå¯ä»¥è€ƒè™‘å¹‚ç­‰æ€§è®¾è®¡é—®é¢˜ï¼Œè€ƒè™‘ä½¿ç”¨åˆ†å¸ƒå¼é”ã€æ•°æ®åº“é”ï¼ˆæ‚²è§‚é”ã€ä¹è§‚é”ï¼‰ç­‰ï¼Œä½†é”ä¼šå¯¹æ€§èƒ½æœ‰å½±å“ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦è€ƒè™‘ä½¿ç”¨</li></ul><p>ä¸€èˆ¬å›ç­”å¯ä»¥å€¾å‘å›ç­”ç¬¬ä¸€ç§å›ç­”ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402271532774.png" alt="image.png"></p><p>å‚è€ƒå›ç­”ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402271535282.png" alt="image.png"></p><h4 id="æ­»ä¿¡é˜Ÿåˆ—"><a href="#æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="æ­»ä¿¡é˜Ÿåˆ—"></a>æ­»ä¿¡é˜Ÿåˆ—</h4><h5 id="æ­»ä¿¡äº¤æ¢æœº"><a href="#æ­»ä¿¡äº¤æ¢æœº" class="headerlink" title="æ­»ä¿¡äº¤æ¢æœº"></a>æ­»ä¿¡äº¤æ¢æœº</h5><blockquote><p>ä»€ä¹ˆæ˜¯æ­»ä¿¡äº¤æ¢æœº</p></blockquote><p>æ­»ä¿¡äº¤æ¢æœºï¼ˆDead-Letter Exchange, DLXï¼‰æ˜¯RabbitMQä¸­ç”¨äºå¤„ç†æ— æ³•æ­£å¸¸æŠ•é€’çš„æ¶ˆæ¯çš„ä¸€ç§æœºåˆ¶ã€‚</p><p>å½“æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­å˜æˆæ­»ä¿¡ï¼ˆDead Letterï¼‰åï¼Œå¯ä»¥è¢«è‡ªåŠ¨é‡æ–°è·¯ç”±åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºï¼Œè¿™ä¸ªäº¤æ¢æœºå°±æ˜¯æ‰€è°“çš„æ­»ä¿¡äº¤æ¢æœºã€‚</p><blockquote><p>æ¶ˆæ¯å˜æˆæ­»ä¿¡çš„æƒ…å†µ</p></blockquote><p>æ¶ˆæ¯å˜æˆæ­»ä¿¡çš„æƒ…å†µé€šå¸¸åŒ…æ‹¬ï¼š</p><ol><li>æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆBasic.Reject&#x2F;Basic.Nackï¼‰å¹¶ä¸”è®¾ç½®äº†requeueå‚æ•°ä¸ºfalseï¼Œä¸é‡æ–°å…¥é˜Ÿã€‚</li><li>æ¶ˆæ¯TTLè¿‡æœŸï¼ˆæ¶ˆæ¯è®¾ç½®äº†ç”Ÿå­˜æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æœªè¢«æ¶ˆè´¹ï¼‰ï¼Œè¶…æ—¶æ— äººæ¶ˆè´¹</li><li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ï¼ˆé˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ›´å¤šæ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼‰ï¼Œæœ€æ—©çš„æ¶ˆæ¯å¯èƒ½æˆä¸ºæ­»ä¿¡</li></ol><blockquote><p>é…ç½®æ­»ä¿¡äº¤æ¢æœº</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228055150.png" alt="image.png"></p><p>ä½¿ç”¨æ­»ä¿¡äº¤æ¢æœºéœ€è¦è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š</p><ul><li><strong>å£°æ˜æ­»ä¿¡äº¤æ¢æœº</strong>ï¼šé¦–å…ˆéœ€è¦å£°æ˜ä¸€ä¸ªäº¤æ¢æœºä½œä¸ºæ­»ä¿¡äº¤æ¢æœºï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼ˆDirect, Topic, Fanoutç­‰ï¼‰ã€‚</li><li><strong>å£°æ˜é˜Ÿåˆ—å¹¶æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</strong>ï¼šåœ¨å£°æ˜é˜Ÿåˆ—æ—¶ï¼Œé€šè¿‡argumentså‚æ•°è®¾ç½®<code>x-dead-letter-exchange</code>å±æ€§ä¸ºæ­»ä¿¡äº¤æ¢æœºçš„åç§°ã€‚å¯é€‰åœ°ï¼Œè¿˜å¯ä»¥è®¾ç½®<code>x-dead-letter-routing-key</code>æ¥æŒ‡å®šå‘é€åˆ°æ­»ä¿¡äº¤æ¢æœºçš„æ¶ˆæ¯å°†ä½¿ç”¨çš„è·¯ç”±é”®ã€‚</li><li><strong>ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—</strong>ï¼šå¦‚æœéœ€è¦ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªä¸“é—¨çš„é˜Ÿåˆ—ä½œä¸ºæ­»ä¿¡é˜Ÿåˆ—ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°æ­»ä¿¡äº¤æ¢æœºä¸Šã€‚è¿™æ ·ï¼Œæˆä¸ºæ­»ä¿¡çš„æ¶ˆæ¯å°±ä¼šè¢«è·¯ç”±åˆ°è¿™äº›é˜Ÿåˆ—ä¸­ã€‚</li></ul><blockquote><p>ä½¿ç”¨åœºæ™¯</p></blockquote><ul><li><strong>é”™è¯¯å¤„ç†</strong>ï¼šæ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—å¸¸ç”¨äºé”™è¯¯å¤„ç†ã€‚å½“æ¶ˆæ¯å› ä¸ºæŸç§åŸå› æ— æ³•è¢«æ­£å¸¸æ¶ˆè´¹æ—¶ï¼Œå°†å…¶è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œåç»­å¯ä»¥å¯¹è¿™äº›æ¶ˆæ¯è¿›è¡Œåˆ†æå’Œå¤„ç†ã€‚</li><li><strong>å»¶è¿Ÿæ¶ˆæ¯</strong>ï¼šé€šè¿‡è®¾ç½®æ¶ˆæ¯çš„TTLå’Œæ­»ä¿¡äº¤æ¢æœºï¼Œå¯ä»¥å®ç°å»¶è¿Ÿæ¶ˆæ¯çš„åŠŸèƒ½ã€‚æ¶ˆæ¯é¦–å…ˆè¢«å‘é€åˆ°ä¸€ä¸ªæ™®é€šé˜Ÿåˆ—ä¸­ï¼Œåœ¨è¿‡æœŸåå˜æˆæ­»ä¿¡ï¼Œç„¶åè¢«å‘é€åˆ°æ­»ä¿¡äº¤æ¢æœºï¼Œå¹¶æœ€ç»ˆè·¯ç”±åˆ°æœ€ç»ˆçš„é˜Ÿåˆ—ä¸­è¢«æ¶ˆè´¹ã€‚</li><li><strong>æ¶ˆæ¯é‡è¯•</strong>ï¼šåœ¨å¤„ç†æ¶ˆæ¯æ—¶ï¼Œå¦‚æœå› ä¸ºä¸´æ—¶çš„é—®é¢˜å¯¼è‡´æ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œå¯ä»¥å°†æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡äº¤æ¢æœºï¼Œå†é€šè¿‡ç‰¹å®šçš„é€»è¾‘å°†æ¶ˆæ¯é‡æ–°æŠ•é€’åˆ°åŸé˜Ÿåˆ—æˆ–å¦ä¸€ä¸ªé˜Ÿåˆ—è¿›è¡Œé‡è¯•ã€‚</li></ul><p>ç®€å•ç¤ºä¾‹ï¼ˆåœ¨Spring AMQPä¸­é…ç½®ä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼‰ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_">Queue</span> <span class="hljs-title function_">myQueue</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">QueueBuilder</span>.<span class="hljs-title function_">durable</span>(<span class="hljs-string">&quot;myQueue&quot;</span>) <span class="hljs-comment">//æŒ‡å®šé˜Ÿåˆ—åç§°ï¼Œå¹¶æŒä¹…åŒ–</span><br>    .<span class="hljs-title function_">ttl</span>(<span class="hljs-number">10000</span>)  <span class="hljs-comment">//è®¾ç½®é˜Ÿåˆ—çš„è¶…æ—¶æ—¶é—´ï¼Œ10ç§’</span><br>    <span class="hljs-comment">// è®¾ç½®æ­»ä¿¡äº¤æ¢æœºçš„åç§°ï¼Œå½“æ¶ˆæ¯å˜æˆæ­»ä¿¡åå°†è¢«è·¯ç”±åˆ°æ­¤äº¤æ¢æœº</span><br>            .<span class="hljs-title function_">withArgument</span>(<span class="hljs-string">&quot;x-dead-letter-exchange&quot;</span>, <span class="hljs-string">&quot;myDlxExchange&quot;</span>) <br>            <span class="hljs-comment">// è®¾ç½®æ­»ä¿¡äº¤æ¢æœºçš„è·¯ç”±é”®ï¼ŒæŒ‡å®šæ¶ˆæ¯ä»æ­»ä¿¡äº¤æ¢æœºè·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—æ—¶ä½¿ç”¨çš„è·¯ç”±é”®</span><br>            .<span class="hljs-title function_">withArgument</span>(<span class="hljs-string">&quot;x-dead-letter-routing-key&quot;</span>, <span class="hljs-string">&quot;dlx.routing.key&quot;</span>)<br>            .<span class="hljs-title function_">build</span>();<br>&#125;<br><br>------<br><br><span class="hljs-comment">// å£°æ˜æ­»ä¿¡äº¤æ¢æœº</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_">DirectExchange</span> <span class="hljs-title function_">myDlxExchange</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DirectExchange</span>(<span class="hljs-string">&quot;myDlxExchange&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_">Queue</span> <span class="hljs-title function_">myDlxQueue</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-comment">// ä½¿ç”¨QueueBuilderæ„å»ºä¸€ä¸ªæŒä¹…åŒ–çš„é˜Ÿåˆ—&quot;myDlxQueue&quot;ï¼Œè¿™ä¸ªé˜Ÿåˆ—ç”¨äºæ¥æ”¶æ­»ä¿¡æ¶ˆæ¯</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">QueueBuilder</span>.<span class="hljs-title function_">durable</span>(<span class="hljs-string">&quot;myDlxQueue&quot;</span>).<span class="hljs-title function_">build</span>();<br>&#125;<br><br><span class="hljs-comment">// å°†æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šåˆ°æ­»ä¿¡äº¤æ¢æœº</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_">Binding</span> <span class="hljs-title function_">myDlxBinding</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-comment">// ä½¿ç”¨ BindingBuilder å°†æ­»ä¿¡é˜Ÿåˆ—&quot;myDlxQueue&quot;ç»‘å®šåˆ°æ­»ä¿¡äº¤æ¢æœº&quot;myDlxExchange&quot; </span><br><span class="hljs-comment">// ç»‘å®šé”®ä¸º&quot;dlx.routing.key&quot;ï¼Œè¡¨ç¤ºåªæœ‰è·¯ç”±é”®åŒ¹é…æ­¤å€¼çš„æ¶ˆæ¯æ‰ä¼šè¢«è·¯ç”±åˆ°&quot;myDlxQueue&quot;é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">BindingBuilder</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-title function_">myDlxQueue</span>()).<span class="hljs-title function_">to</span>(<span class="hljs-title function_">myDlxExchange</span>()).<span class="hljs-title function_">with</span>(<span class="hljs-string">&quot;dlx.routing.key&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé…ç½®å£°æ˜äº†ä¸€ä¸ªé˜Ÿåˆ—<code>myQueue</code>å’Œä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœº<code>myDlxExchange</code>ï¼Œä»¥åŠä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—<code>myDlxQueue</code>ã€‚å½“<code>myQueue</code>ä¸­çš„æ¶ˆæ¯å˜æˆæ­»ä¿¡åï¼Œå®ƒä»¬ä¼šè¢«è·¯ç”±åˆ°<code>myDlxQueue</code>ä¸­ã€‚</p><p>æ€»ä¹‹ï¼Œæ­»ä¿¡äº¤æ¢æœºæä¾›äº†ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼æ¥å¤„ç†RabbitMQä¸­æ— æ³•æ­£å¸¸æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿæ›´åŠ å¥å£®å’Œå¯é ã€‚</p><h5 id="TTL"><a href="#TTL" class="headerlink" title="TTL"></a>TTL</h5><p>TTLï¼ˆTime-To-Liveï¼‰æ˜¯ä¸€ç§è®¾ç½®æ•°æ®å­˜æ´»æ—¶é—´çš„æœºåˆ¶ï¼Œåœ¨RabbitMQä¸­ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶æ¶ˆæ¯æˆ–é˜Ÿåˆ—çš„å­˜æ´»æ—¶é—´ã€‚</p><p>å¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯TTLç»“æŸä»æœªæ¶ˆè´¹ï¼Œåˆ™ä¼šå˜ä¸ºæ­»ä¿¡ï¼Œ ttl è¶…æ—¶åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ul><li>1ã€æ¶ˆæ¯æ‰€åœ¨çš„é˜Ÿåˆ—è®¾ç½®äº†å­˜æ´»æ—¶é—´</li><li>2ã€æ¶ˆæ¯æœ¬èº«è®¾ç½®äº†å­˜æ´»æ—¶é—´</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228055549.png" alt="image.png"></p><blockquote><p>æ¶ˆæ¯TTL</p></blockquote><ul><li><strong>æ¶ˆæ¯TTL</strong>æ˜¯æŒ‡ä¸€æ¡æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­å¯ä»¥å­˜æ´»çš„æœ€å¤§æ—¶é—´ã€‚å¦‚æœæ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­çš„å­˜æ´»æ—¶é—´è¶…è¿‡äº†è®¾ç½®çš„TTLï¼Œå®ƒå°†å˜æˆæ­»ä¿¡ï¼ˆDead Letterï¼‰ã€‚å¯¹äºæœªåŠæ—¶æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œè¿™æ˜¯ä¸€ç§æœ‰æ•ˆçš„è¿‡æœŸç­–ç•¥ã€‚</li><li>åœ¨RabbitMQä¸­ï¼Œæ¶ˆæ¯TTLå¯ä»¥åœ¨å‘é€æ¶ˆæ¯æ—¶é€šè¿‡è®¾ç½®æ¶ˆæ¯å±æ€§ä¸­çš„<code>expiration</code>å­—æ®µæ¥æŒ‡å®šï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚ä¾‹å¦‚ï¼Œå°†<code>expiration</code>è®¾ç½®ä¸º<code>60000</code>ï¼Œæ„å‘³ç€æ¶ˆæ¯çš„TTLä¸º60ç§’ã€‚</li></ul><p>ç¤ºä¾‹ä»£ç ï¼š</p><p>è®¾ç½®æ¶ˆæ¯TTL</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs haxe">AMQP.BasicProperties props = <span class="hljs-keyword">new</span> <span class="hljs-type">AMQP</span>.BasicProperties.Builder()<br>        .expiration(<span class="hljs-string">&quot;60000&quot;</span>) <span class="hljs-comment">// æ¶ˆæ¯TTLè®¾ç½®ä¸º60000æ¯«ç§’ï¼ˆ60ç§’ï¼‰</span><br>        .build();<br>channel.basicPublish(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;myQueue&quot;</span>, props, message.getBytes());<br></code></pre></td></tr></table></figure><blockquote><p>é˜Ÿåˆ—TTL</p></blockquote><ul><li><strong>é˜Ÿåˆ—TTL</strong>æ˜¯æŒ‡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯çš„ç»Ÿä¸€å­˜æ´»æ—¶é—´ã€‚ä¸åŒäºä¸ºæ¯æ¡æ¶ˆæ¯å•ç‹¬è®¾ç½®TTLï¼Œé˜Ÿåˆ—TTLä¸ºé˜Ÿåˆ—ä¸­æ‰€æœ‰æ¶ˆæ¯è®¾å®šäº†ç»Ÿä¸€çš„æœ€å¤§å­˜æ´»æ—¶é—´ã€‚</li><li>é˜Ÿåˆ—TTLæ˜¯åœ¨å£°æ˜é˜Ÿåˆ—æ—¶é€šè¿‡é˜Ÿåˆ—çš„<code>arguments</code>å‚æ•°è®¾ç½®çš„ï¼Œä½¿ç”¨<code>x-message-ttl</code>å±æ€§æ¥æŒ‡å®šï¼Œå•ä½ä¹Ÿæ˜¯æ¯«ç§’ã€‚</li></ul><p>è®¾ç½®é˜Ÿåˆ—TTL</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt; args = <span class="hljs-keyword">new</span> HashMap&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Object</span>&gt;();<br>args.put(<span class="hljs-string">&quot;x-message-ttl&quot;</span>, <span class="hljs-number">60000</span>); <span class="hljs-comment">// é˜Ÿåˆ—ä¸­æ‰€æœ‰æ¶ˆæ¯çš„TTLè®¾ç½®ä¸º60000æ¯«ç§’ï¼ˆ60ç§’ï¼‰</span><br>channel.queueDeclare(<span class="hljs-string">&quot;myQueue&quot;</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, args);<br></code></pre></td></tr></table></figure><hr><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>å¦‚æœé˜Ÿåˆ—å’Œæ¶ˆæ¯éƒ½è®¾ç½®äº†TTLï¼Œä»¥è¾ƒçŸ­çš„é‚£ä¸ªTTLä¸ºå‡†ã€‚</li><li>è®¾ç½®äº†TTLçš„æ¶ˆæ¯ï¼Œå¦‚æœåœ¨TTLåˆ°æœŸæ—¶è¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä¼šè¢«RabbitMQè‡ªåŠ¨ä¸¢å¼ƒæˆ–å‘é€åˆ°è®¾ç½®çš„æ­»ä¿¡äº¤æ¢æœºã€‚</li><li>æ¶ˆæ¯çš„TTLä»å®ƒè¢«æ¨é€åˆ°é˜Ÿåˆ—çš„é‚£ä¸€åˆ»å¼€å§‹è®¡ç®—ï¼Œè€Œä¸æ˜¯ä»å®ƒè¢«æ¶ˆè´¹è€…æ¥æ”¶çš„é‚£ä¸€åˆ»å¼€å§‹ã€‚</li></ul><hr><h4 id="å»¶è¿Ÿé˜Ÿåˆ—-ğŸš©-ğŸ’£"><a href="#å»¶è¿Ÿé˜Ÿåˆ—-ğŸš©-ğŸ’£" class="headerlink" title="å»¶è¿Ÿé˜Ÿåˆ—  ğŸš© ğŸ’£"></a>å»¶è¿Ÿé˜Ÿåˆ—  ğŸš© ğŸ’£</h4><p>RabbitMQ çš„å»¶è¿Ÿé˜Ÿåˆ—æ˜¯é€šè¿‡æ­»ä¿¡äº¤æ¢æœº + TTL ï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰æ¥å®ç°çš„ï¼›</p><ul><li>å»¶è¿Ÿé˜Ÿåˆ—ï¼šè¿›å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯ä¼šè¢«å»¶è¿Ÿæ¶ˆè´¹çš„é˜Ÿåˆ—</li></ul><p>å»¶è¿Ÿé˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯è¾ƒå¤šï¼Œæ¯”å¦‚ï¼šè¶…å¸‚è®¢å•ã€é™æ—¶ä¼˜æƒ ã€å®šæ—¶å‘å¸ƒç­‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402271543252.png" alt="image.png"></p><hr><p>åœ¨ RabbitMQ ä¸­ï¼Œå»¶è¿Ÿé˜Ÿåˆ—çš„ä½¿ç”¨æ˜¯æœ‰ä¸€ä¸ªæ’ä»¶ï¼šå«åšï¼šDelayExchange</p><p>åœ°å€åœ¨å®˜æ–¹æ’ä»¶ç¤¾åŒº</p><p>æ’ä»¶ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/rabbitmq/rabbitmq-delayed-message-exchange">https://github.com/rabbitmq/rabbitmq-delayed-message-exchange</a></p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228060325.png" alt="image.png"></p><hr><blockquote><p>é¢è¯•é¢˜ï¼šRabbitMQ ä¸­å»¶è¿Ÿé˜Ÿåˆ—æœ‰äº†è§£è¿‡å—ï¼Ÿ</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228060447.png" alt="image.png"></p><p>å‚è€ƒå›ç­”ï¼š</p><p>ä¸»è¦è¿˜æ˜¯å›´ç»•äº†æ­»ä¿¡é˜Ÿåˆ—çš„äº§ç”Ÿ + TTL æœºåˆ¶</p><p>æ€ä¹ˆå®ç°çš„å’Œå…·ä½“ä½¿ç”¨åœºæ™¯æ„Ÿè§‰éœ€è¦çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œåé¢çœ‹äº† to be continedâ€¦.</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228060500.png" alt="image.png"></p><h4 id="æ¶ˆæ¯å †ç§¯"><a href="#æ¶ˆæ¯å †ç§¯" class="headerlink" title="æ¶ˆæ¯å †ç§¯"></a>æ¶ˆæ¯å †ç§¯</h4><blockquote><p>é¢è¯•é¢˜ï¼šRabbitQM å¦‚æœæœ‰100ä¸‡æ¶ˆæ¯å †ç§¯åœ¨MQï¼Œå¦‚ä½•è§£å†³ï¼ˆæ¶ˆæ¯å †ç§¯æ€ä¹ˆè§£å†³ï¼‰</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228060721.png" alt="image.png"></p><p>è§£å†³æ¶ˆæ¯å †ç§¯æœ‰ä¸‰ç§ç§æ€è·¯ï¼š</p><ul><li>å¢åŠ æ›´å¤šæ¶ˆè´¹è€…ï¼Œæé«˜æ¶ˆè´¹é€Ÿåº¦</li><li>åœ¨æ¶ˆè´¹è€…å†…å¼€å¯çº¿ç¨‹æ± åŠ å¿«æ¶ˆæ¯å¤„ç†é€Ÿåº¦</li><li>æ‰©å¤§é˜Ÿåˆ—å®¹ç§¯ï¼Œæé«˜å †ç§¯ä¸Šé™ï¼Œé‡‡ç”¨æƒ°æ€§é˜Ÿåˆ—<ul><li>åœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™å¯ä»¥è®¾ç½®å±æ€§x-queue-modeä¸ºlazy,å³ä¸ºæƒ°æ€§é˜Ÿåˆ—</li><li>åŸºäºç£ç›˜å­˜å‚¨ï¼Œæ¶ˆæ¯ä¸Šé™é«˜</li><li>æ€§èƒ½æ¯”è¾ƒç¨³å®šï¼Œä½†åŸºäºç£ç›˜å­˜å‚¨ï¼Œå—é™äºç£ç›˜ IO,æ—¶æ•ˆæ€§ä¼šé™ä½<br>Â·<br>å‚è€ƒå›ç­”ï¼š</li></ul></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228061038.png" alt="image.png"></p><h5 id="æƒ°æ€§é˜Ÿåˆ—"><a href="#æƒ°æ€§é˜Ÿåˆ—" class="headerlink" title="æƒ°æ€§é˜Ÿåˆ—"></a>æƒ°æ€§é˜Ÿåˆ—</h5><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228060819.png" alt="image.png"></p><h3 id="ä¸‰ã€é«˜å¯ç”¨æœºåˆ¶"><a href="#ä¸‰ã€é«˜å¯ç”¨æœºåˆ¶" class="headerlink" title="ä¸‰ã€é«˜å¯ç”¨æœºåˆ¶"></a>ä¸‰ã€é«˜å¯ç”¨æœºåˆ¶</h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨é›†ç¾¤æ¥ä¿è¯é«˜å¯ç”¨æ€§</p><p>åˆ†ä¸ºï¼šæ™®é€šé›†ç¾¤ã€é•œåƒé›†ç¾¤ã€ä»²è£é›†ç¾¤</p><h4 id="æ™®é€šé›†ç¾¤"><a href="#æ™®é€šé›†ç¾¤" class="headerlink" title="æ™®é€šé›†ç¾¤"></a>æ™®é€šé›†ç¾¤</h4><p>ç”Ÿäº§ç¯å¢ƒä¸€èˆ¬ä¸ä½¿ç”¨æ™®é€šé›†ç¾¤</p><p>æ™®é€šé›†ç¾¤ï¼Œæˆ–è€…å«æ ‡å‡†é›†ç¾¤ï¼ˆclassic cluster ï¼‰ï¼Œå…·å¤‡ä¸‹åˆ—ç‰¹å¾ï¼š</p><ul><li>ä¼šåœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹é—´å…±äº«éƒ¨åˆ†æ•°æ®ï¼ŒåŒ…æ‹¬ï¼šäº¤æ¢æœºã€é˜Ÿåˆ—å…ƒä¿¡æ¯ã€‚ä¸åŒ…å«é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li><li>å½“è®¿é—®é›†ç¾¤æŸèŠ‚ç‚¹æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸åœ¨è¯¥èŠ‚ç‚¹ï¼Œä¼šä»æ•°æ®æ‰€åœ¨èŠ‚ç‚¹ä¼ é€’åˆ°å½“å‰èŠ‚ç‚¹å¹¶è¿”å›</li><li>é˜Ÿåˆ—æ‰€åœ¨èŠ‚ç‚¹å®•æœºï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±</li></ul><h4 id="é•œåƒé›†ç¾¤"><a href="#é•œåƒé›†ç¾¤" class="headerlink" title="é•œåƒé›†ç¾¤"></a>é•œåƒé›†ç¾¤</h4><p>é•œåƒé›†ç¾¤ï¼šæœ¬è´¨æ˜¯ä¸»ä»æ¨¡å¼ï¼Œå…·å¤‡ä¸‹é¢çš„ç‰¹å¾ï¼š</p><ul><li>äº¤æ¢æœºã€é˜Ÿåˆ—ã€é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šåœ¨å„ä¸ª mq çš„é•œåƒèŠ‚ç‚¹ä¹‹é—´åŒæ­¥å¤‡ä»½ã€‚</li><li>åˆ›å»ºé˜Ÿåˆ—çš„èŠ‚ç‚¹è¢«ç§°ä¸ºè¯¥é˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹ï¼Œå¤‡ä»½åˆ°çš„å…¶å®ƒèŠ‚ç‚¹å«åšè¯¥é˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹ã€‚</li><li>ä¸€ä¸ªé˜Ÿåˆ—çš„ä¸»èŠ‚ç‚¹å¯èƒ½æ˜¯å¦ä¸€ä¸ªé˜Ÿåˆ—çš„é•œåƒèŠ‚ç‚¹</li><li>æ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¸»èŠ‚ç‚¹å®Œæˆï¼Œç„¶ååŒæ­¥ç»™é•œåƒèŠ‚ç‚¹</li><li>ä¸»å®•æœºåï¼Œé•œåƒèŠ‚ç‚¹ä¼šæ›¿ä»£æˆæ–°çš„ä¸»èŠ‚ç‚¹</li></ul><h4 id="ä»²è£é˜Ÿåˆ—"><a href="#ä»²è£é˜Ÿåˆ—" class="headerlink" title="ä»²è£é˜Ÿåˆ—"></a>ä»²è£é˜Ÿåˆ—</h4><p>ä»²è£é˜Ÿåˆ—ï¼šä»²è£é˜Ÿåˆ—æ˜¯3.8ç‰ˆæœ¬ä»¥åæ‰æœ‰çš„æ–°åŠŸèƒ½ï¼Œç”¨æ¥æ›¿ä»£é•œåƒé˜Ÿåˆ—ï¼Œå…·å¤‡ä¸‹åˆ—ç‰¹å¾ï¼š</p><ul><li>ä¸é•œåƒé˜Ÿåˆ—ä¸€æ ·ï¼Œéƒ½æ˜¯ä¸»ä»æ¨¡å¼ï¼Œæ”¯æŒä¸»ä»æ•°æ®åŒæ­¥</li><li>ä½¿ç”¨éå¸¸ç®€å•ï¼Œæ²¡æœ‰å¤æ‚çš„é…ç½®</li><li>ä¸»ä»åŒæ­¥åŸºäºRaftåè®®ï¼Œå¼ºä¸€è‡´<br>Â·</li></ul><blockquote><p>é¢è¯•é¢˜å›ç­”ï¼šRabbitMQ çš„é«˜å¯ç”¨æœºåˆ¶æœ‰äº†è§£è¿‡å—</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228061905.png" alt="image.png"></p><p>å‚è€ƒå›ç­”ï¼›</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240228061948.png" alt="image.png"></p><hr><p>å‚è€ƒ</p><ul><li><a href="https://www.rabbitmq.com/documentation.html">https://www.rabbitmq.com/documentation.html</a></li><li><a href="https://developer.aliyun.com/article/769883">https://developer.aliyun.com/article/769883</a></li><li><a href="https://blog.csdn.net/CherryChenieth/article/details/124767155">https://blog.csdn.net/CherryChenieth/article/details/124767155</a></li><li><a href="https://javaguide.cn/high-performance/message-queue/rabbitmq-questions.html">https://javaguide.cn/high-performance/message-queue/rabbitmq-questions.html</a></li><li><a href="https://www.bilibili.com/video/BV1yT411H7YK">https://www.bilibili.com/video/BV1yT411H7YK</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>MQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fluidä¸»é¢˜</title>
    <link href="/2023/12/26/Fluid%E4%B8%BB%E9%A2%98/"/>
    <url>/2023/12/26/Fluid%E4%B8%BB%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>to be continedâ€¦</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://hexo.fluid-dev.com/docs/start/">https://hexo.fluid-dev.com/docs/start/</a></li><li><a href="https://hexo.fluid-dev.com/">https://hexo.fluid-dev.com/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>é™æ€é¡µ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¡†æ¶å­¦ä¹ _MyBatis-Plusä½¿ç”¨</title>
    <link href="/2023/12/25/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0_MyBatis-Plus%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/12/25/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0_MyBatis-Plus%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>to be continedâ€¦</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://caochenlei.blog.csdn.net/article/details/108809902">https://caochenlei.blog.csdn.net/article/details/108809902</a></li><li><a href="https://caochenlei.blog.csdn.net/article/details/108281646?spm=1001.2014.3001.5502&ydreferer=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NDkwNDU3Lz90eXBlPWJsb2c=">https://caochenlei.blog.csdn.net/article/details/108281646?spm=1001.2014.3001.5502&amp;ydreferer=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM4NDkwNDU3Lz90eXBlPWJsb2c%3D</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>MyBatis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®åº“_åŸºç¡€çŸ¥è¯†</title>
    <link href="/2023/12/24/%E6%95%B0%E6%8D%AE%E5%BA%93_%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <url>/2023/12/24/%E6%95%B0%E6%8D%AE%E5%BA%93_%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<p>æ•°æ®åº“åŸºç¡€çŸ¥è¯†åŒ…å«äº†æ•°æ®åº“è®¾è®¡ã€ç®¡ç†å’Œæ“ä½œçš„æ ¸å¿ƒæ¦‚å¿µã€‚</p><p>å¸¸è§çš„ä¸€äº›æ¦‚å¿µğŸ‘‡</p><p>æœ‰å…´è¶£ç™¾åº¦äº†è§£ä¸‹ï¼Œæˆ–è€…é€šè¿‡å‚è€ƒé“¾æ¥æ‰©å±•ä¸€ä¸‹ç›¸å…³å†…å®¹</p><ul><li>æ•°æ®åº“å’Œæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰</li><li>æ•°æ®æ¨¡å‹ï¼ˆå…³ç³»æ¨¡å‹ä¸éå…³ç³»æ¨¡å‹ï¼‰</li><li>æ•°æ®åº“è®¾è®¡<ul><li>ERå›¾</li><li>æ•°æ®åº“èŒƒå¼</li></ul></li><li>å…ƒç»„, ç , å€™é€‰ç , ä¸»ç , å¤–ç , ä¸»å±æ€§, éä¸»å±æ€§</li><li>ä¸»é”®å’Œå¤–é”®</li><li>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨å¤–é”®ä¸çº§è”</li><li>å­˜å‚¨è¿‡ç¨‹</li><li>æ•°æ®åº“è®¾è®¡</li><li>å­—ç¬¦é›†</li></ul><h4 id="SQLï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰"><a href="#SQLï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰" class="headerlink" title="SQLï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰"></a>SQLï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰</h4><ul><li><strong>æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰</strong>ï¼šå®šä¹‰æ•°æ®åº“ç»“æ„ï¼ŒåŒ…æ‹¬CREATEã€ALTERã€DROPç­‰å‘½ä»¤ã€‚</li><li><strong>æ•°æ®æ“çºµè¯­è¨€ï¼ˆDMLï¼‰</strong>ï¼šç”¨äºæ•°æ®è®¿é—®å’Œå¤„ç†ï¼ŒåŒ…æ‹¬INSERTã€UPDATEã€DELETEã€SELECTç­‰å‘½ä»¤ã€‚</li><li><strong>æ•°æ®æ§åˆ¶è¯­è¨€ï¼ˆDCLï¼‰</strong>ï¼šç”¨äºæƒé™å’Œäº‹åŠ¡æ§åˆ¶ï¼ŒåŒ…æ‹¬GRANTã€REVOKEã€BEGIN TRANSACTIONç­‰ã€‚</li></ul><h4 id="dropã€delete-ä¸-truncate-åŒºåˆ«"><a href="#dropã€delete-ä¸-truncate-åŒºåˆ«" class="headerlink" title="dropã€delete ä¸ truncate åŒºåˆ«?"></a>dropã€delete ä¸ truncate åŒºåˆ«?</h4><ul><li>drop           ç§»é™¤æ•´ä¸ªè¡¨ç»“æ„ï¼ŒåŒ…æ‹¬å…¶æ•°æ®å’Œè¡¨å®šä¹‰     ä¸èƒ½å›æ»šï¼ˆDDL)</li><li>delete         åˆ é™¤è¡¨ä¸­çš„ä¸€è¡Œæˆ–å¤šè¡Œè®°å½•      èƒ½å›æ»š(DML)</li><li>truncate      åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰è®°å½•    ä¸èƒ½å›æ»šï¼ˆDDL)</li></ul><p>æ‰§è¡Œé€Ÿåº¦ï¼šä¸€èˆ¬æ¥è¯´ï¼š<code>drop</code>Â &gt;Â <code>truncate</code>Â &gt;Â <code>delete</code></p><p>åœ¨MySQLä¸­ï¼Œ<code>DROP</code>ã€<code>DELETE</code>å’Œ<code>TRUNCATE</code>éƒ½æ˜¯ç”¨äºç§»é™¤æ•°æ®çš„å‘½ä»¤ï¼Œä½†å®ƒä»¬åœ¨ç”¨æ³•å’Œå½±å“ä¸Šæœ‰æ˜æ˜¾çš„åŒºåˆ«ï¼š</p><blockquote><ol><li>DELETE</li></ol></blockquote><ul><li><strong>ç”¨é€”</strong>ï¼š<code>DELETE</code>ç”¨äºåˆ é™¤è¡¨ä¸­çš„ä¸€è¡Œæˆ–å¤šè¡Œè®°å½•ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>å¯ä»¥å¸¦æœ‰<code>WHERE</code>å­å¥ï¼Œæä¾›äº†æ¡ä»¶åˆ é™¤çš„åŠŸèƒ½ã€‚</li><li>å½±å“çš„è¡Œæ•°ä¼šè®°å½•åœ¨äº‹åŠ¡æ—¥å¿—ä¸­ï¼Œå› æ­¤å¯ä»¥å›æ»šã€‚</li><li>è§¦å‘å™¨ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ä¼šè¢«æ¿€æ´»ã€‚</li><li>è¾ƒæ…¢ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ é™¤å¤§é‡æ•°æ®æ—¶ï¼Œå› ä¸ºå®ƒé€è¡Œåˆ é™¤ã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š<code>DELETE FROM table_name WHERE condition;</code></li></ul><blockquote><ol start="2"><li>TRUNCATE</li></ol></blockquote><ul><li><strong>ç”¨é€”</strong>ï¼š<code>TRUNCATE</code>ç”¨äºåˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>ä¸èƒ½å¸¦æœ‰<code>WHERE</code>å­å¥ï¼Œå®ƒæ€»æ˜¯åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚</li><li>æ‰§è¡Œé€Ÿåº¦æ¯”<code>DELETE</code>å¿«ï¼Œå› ä¸ºå®ƒä¸é€è¡Œåˆ é™¤æ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥ç§»é™¤æ•°æ®é¡µã€‚</li><li>ä¸è®°å½•è¯¦ç»†çš„äº‹åŠ¡æ—¥å¿—ï¼Œåªè®°å½•é‡å»ºç©ºè¡¨çš„æ“ä½œï¼Œå› æ­¤æ— æ³•å›æ»šï¼ˆåœ¨æŸäº›æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œ<code>TRUNCATE</code>æ˜¯äº‹åŠ¡å®‰å…¨çš„ï¼Œå¹¶ä¸”å¯ä»¥å›æ»šï¼‰ã€‚</li><li>é‡ç½®è¡¨çš„è‡ªå¢è®¡æ•°å™¨ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</li><li>ä¸è§¦å‘è§¦å‘å™¨ã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š<code>TRUNCATE TABLE table_name;</code></li></ul><blockquote><ol start="3"><li>DROP</li></ol></blockquote><ul><li><strong>ç”¨é€”</strong>ï¼š<code>DROP</code>ç”¨äºç§»é™¤æ•´ä¸ªè¡¨ç»“æ„ï¼ŒåŒ…æ‹¬å…¶æ•°æ®å’Œè¡¨å®šä¹‰ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<ul><li>åˆ é™¤è¡¨çš„ç»“æ„åŠå…¶æ•°æ®ï¼Œé‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚</li><li>ä¸èƒ½å›æ»šï¼ˆä¸€æ—¦æ‰§è¡Œï¼Œè¡¨å°±å®Œå…¨æ¶ˆå¤±äº†ï¼‰ã€‚</li><li>ä¸è§¦å‘è§¦å‘å™¨ã€‚</li><li>åœ¨åˆ é™¤å¤§é‡æ•°æ®ä¸”ä¸å†éœ€è¦è¯¥è¡¨æ—¶ä½¿ç”¨ã€‚</li></ul></li><li><strong>ç¤ºä¾‹</strong>ï¼š<code>DROP TABLE table_name;</code></li></ul><blockquote><p>æ€»ç»“</p></blockquote><ul><li><strong>åˆ é™¤æ•°æ®è¡Œ</strong>ï¼šå¦‚æœéœ€è¦åˆ é™¤éƒ¨åˆ†æ•°æ®è¡Œï¼Œä½¿ç”¨<code>DELETE</code>ã€‚è‹¥éœ€åˆ é™¤æ‰€æœ‰æ•°æ®è¡Œä¸”è¡¨ç»“æ„ä»éœ€ä¿ç•™ï¼Œä½¿ç”¨<code>TRUNCATE</code>ã€‚</li><li><strong>åˆ é™¤è¡¨</strong>ï¼šå¦‚æœè¦åˆ é™¤æ•´ä¸ªè¡¨åŠå…¶æ•°æ®ï¼Œä½¿ç”¨<code>DROP</code>ã€‚</li><li><strong>æ€§èƒ½è€ƒè™‘</strong>ï¼šå½“å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œ<code>TRUNCATE</code>æ¯”<code>DELETE</code>æ›´é«˜æ•ˆã€‚</li><li><strong>äº‹åŠ¡å’Œå›æ»š</strong>ï¼š<code>DELETE</code>æ“ä½œå¯ä»¥å›æ»šï¼Œè€Œ<code>TRUNCATE</code>å’Œ<code>DROP</code>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¸èƒ½ã€‚</li></ul><p>é€‰æ‹©ä½¿ç”¨å“ªä¸ªå‘½ä»¤å–å†³äºå…·ä½“çš„éœ€æ±‚ï¼Œå¦‚æ˜¯å¦éœ€è¦ä¿ç•™è¡¨ç»“æ„ã€æ˜¯å¦éœ€è¦æ¡ä»¶åˆ é™¤æˆ–æ˜¯å¦å…³æ³¨æ€§èƒ½ä¼˜åŒ–ã€‚</p><h4 id="æ•°æ®åº“è®¾è®¡é€šå¸¸åˆ†ä¸ºå“ªå‡ æ­¥"><a href="#æ•°æ®åº“è®¾è®¡é€šå¸¸åˆ†ä¸ºå“ªå‡ æ­¥" class="headerlink" title="æ•°æ®åº“è®¾è®¡é€šå¸¸åˆ†ä¸ºå“ªå‡ æ­¥?"></a>æ•°æ®åº“è®¾è®¡é€šå¸¸åˆ†ä¸ºå“ªå‡ æ­¥?</h4><ol><li><strong>éœ€æ±‚åˆ†æ</strong> : åˆ†æç”¨æˆ·çš„éœ€æ±‚ï¼ŒåŒ…æ‹¬æ•°æ®ã€åŠŸèƒ½å’Œæ€§èƒ½éœ€æ±‚ã€‚</li><li><strong>æ¦‚å¿µç»“æ„è®¾è®¡</strong> : ä¸»è¦é‡‡ç”¨ E-R æ¨¡å‹è¿›è¡Œè®¾è®¡ï¼ŒåŒ…æ‹¬ç”» E-R å›¾ã€‚</li><li><strong>é€»è¾‘ç»“æ„è®¾è®¡</strong> : é€šè¿‡å°† E-R å›¾è½¬æ¢æˆè¡¨ï¼Œå®ç°ä» E-R æ¨¡å‹åˆ°å…³ç³»æ¨¡å‹çš„è½¬æ¢ã€‚</li><li><strong>ç‰©ç†ç»“æ„è®¾è®¡</strong> : ä¸»è¦æ˜¯ä¸ºæ‰€è®¾è®¡çš„æ•°æ®åº“é€‰æ‹©åˆé€‚çš„å­˜å‚¨ç»“æ„å’Œå­˜å–è·¯å¾„ã€‚</li><li><strong>æ•°æ®åº“å®æ–½</strong> : åŒ…æ‹¬ç¼–ç¨‹ã€æµ‹è¯•å’Œè¯•è¿è¡Œã€‚</li><li><strong>æ•°æ®åº“çš„è¿è¡Œå’Œç»´æŠ¤</strong> : ç³»ç»Ÿçš„è¿è¡Œä¸æ•°æ®åº“çš„æ—¥å¸¸ç»´æŠ¤</li></ol><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/database/basis.html">https://javaguide.cn/database/basis.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»Javaæ„å»ºçº¿ç¨‹çš„æ–¹å¼åˆ°çº¿ç¨‹æ± ThreadPoolExecutoræºç å‰–æ</title>
    <link href="/2023/12/21/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_ThreadPoolExecutor_2/"/>
    <url>/2023/12/21/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_ThreadPoolExecutor_2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¤§çº²</p></blockquote><ul><li>Java æ„å»ºçº¿ç¨‹çš„æ–¹å¼</li><li>çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°</li><li>çº¿ç¨‹æ± çš„æ‰§è¡Œæµç¨‹</li><li>çº¿ç¨‹æ± å±æ€§æ ‡è¯†</li><li>çº¿ç¨‹æ± çš„ execute æ–¹æ³•æ‰§è¡Œ</li><li>Worker çš„å°è£…</li></ul><blockquote><p>ä»Javaæ„å»ºçº¿ç¨‹çš„æ–¹å¼åˆ°çº¿ç¨‹æ± ThreadPoolExecutoræºç å‰–æ</p></blockquote><h3 id="ä¸€ã€Java-æ„å»ºçº¿ç¨‹çš„æ–¹å¼ï¼ˆå¸¸è¯†ï¼‰"><a href="#ä¸€ã€Java-æ„å»ºçº¿ç¨‹çš„æ–¹å¼ï¼ˆå¸¸è¯†ï¼‰" class="headerlink" title="ä¸€ã€Java æ„å»ºçº¿ç¨‹çš„æ–¹å¼ï¼ˆå¸¸è¯†ï¼‰"></a>ä¸€ã€Java æ„å»ºçº¿ç¨‹çš„æ–¹å¼ï¼ˆå¸¸è¯†ï¼‰</h3><ul><li>ç»§æ‰¿ Thread</li><li>å®ç° Runnable</li><li>å®ç° Callable</li><li>çº¿ç¨‹æ± æ–¹å¼ï¼ˆJavaæä¾›äº†æ„å»ºçº¿ç¨‹æ± çš„æ–¹å¼ï¼‰<ul><li>Javaæä¾›äº† Executors å¯ä»¥å»åˆ›å»ºï¼ˆè§„èŒƒä¸­ä¸å…è®¸ä½¿ç”¨è¿™ç§æ–¹å¼åˆ›å»ºçº¿ç¨‹æ± ï¼Œè¿™ç§æ–¹å¼å¯¹çº¿ç¨‹çš„æ§åˆ¶ç²’åº¦æ¯”è¾ƒä½ï¼‰</li><li>æ¨èæ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </li></ul></li></ul><h3 id="äºŒã€çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°ï¼ˆå¸¸è¯†ï¼‰"><a href="#äºŒã€çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°ï¼ˆå¸¸è¯†ï¼‰" class="headerlink" title="äºŒã€çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°ï¼ˆå¸¸è¯†ï¼‰"></a>äºŒã€çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°ï¼ˆå¸¸è¯†ï¼‰</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,   <span class="hljs-comment">//æ ¸å¿ƒçº¿ç¨‹æ± </span></span></span><br><span class="hljs-params"><span class="hljs-function">                          <span class="hljs-type">int</span> maximumPoolSize,   <span class="hljs-comment">//æœ€å¤§çº¿ç¨‹æ•°</span></span></span><br><span class="hljs-params"><span class="hljs-function">                          <span class="hljs-type">long</span> keepAliveTime,    <span class="hljs-comment">//æœ€å¤§ç©ºé—²æ—¶é—´</span></span></span><br><span class="hljs-params"><span class="hljs-function">                          TimeUnit unit,         <span class="hljs-comment">//æ—¶é—´å•ä½</span></span></span><br><span class="hljs-params"><span class="hljs-function">                          BlockingQueue&lt;Runnable&gt; workQueue,  <span class="hljs-comment">//é˜»å¡é˜Ÿåˆ—</span></span></span><br><span class="hljs-params"><span class="hljs-function">                          ThreadFactory threadFactory,        <span class="hljs-comment">//çº¿ç¨‹å·¥å‚</span></span></span><br><span class="hljs-params"><span class="hljs-function">                          RejectedExecutionHandler handler)</span> </span>&#123;   <span class="hljs-comment">//æ‹’ç»ç­–ç•¥</span><br></code></pre></td></tr></table></figure><h3 id="ä¸‰ã€çº¿ç¨‹æ± çš„æ‰§è¡Œæµç¨‹ï¼ˆå¸¸è¯†ï¼‰"><a href="#ä¸‰ã€çº¿ç¨‹æ± çš„æ‰§è¡Œæµç¨‹ï¼ˆå¸¸è¯†ï¼‰" class="headerlink" title="ä¸‰ã€çº¿ç¨‹æ± çš„æ‰§è¡Œæµç¨‹ï¼ˆå¸¸è¯†ï¼‰"></a>ä¸‰ã€çº¿ç¨‹æ± çš„æ‰§è¡Œæµç¨‹ï¼ˆå¸¸è¯†ï¼‰</h3><blockquote><p>çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231221203519.png" alt="image.png"></p><p>ä¸ºä»€ä¹ˆè¦å…ˆè¿›é˜»å¡å†å»å°è¯•åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼š</p><p>é¥­åº—ï¼ˆçº¿ç¨‹æ± ï¼‰ - å¨å­ï¼ˆçº¿ç¨‹ï¼‰ - äººå¤šå…ˆæ’é˜Ÿï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰- æ‹›å¨å­ï¼ˆåˆ›å»ºæœ€å¤§çº¿ç¨‹æ•°ï¼‰ - ä»Šæ—¥å®¢æ»¡ï¼ˆæ‹’ç»ç­–ç•¥ï¼‰</p><h3 id="å››ã€çº¿ç¨‹æ± å±æ€§æ ‡è¯†"><a href="#å››ã€çº¿ç¨‹æ± å±æ€§æ ‡è¯†" class="headerlink" title="å››ã€çº¿ç¨‹æ± å±æ€§æ ‡è¯†"></a>å››ã€çº¿ç¨‹æ± å±æ€§æ ‡è¯†</h3><h4 id="4-1-çº¿ç¨‹æ± å±æ€§"><a href="#4-1-çº¿ç¨‹æ± å±æ€§" class="headerlink" title="4.1 çº¿ç¨‹æ± å±æ€§"></a>4.1 çº¿ç¨‹æ± å±æ€§</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ctl æ˜¯ä¸€ä¸ªint ç±»å‹çš„æ•°å€¼ï¼Œè¡¨è¾¾äº†ä¸¤ä¸ªæ„æ€ï¼Œ1ï¼šå£°æ˜å½“å‰çº¿ç¨‹æ± çš„çŠ¶æ€, 2: å£°æ˜çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°</span><br><span class="hljs-comment">//é«˜3ä½æ˜¯ï¼šçº¿ç¨‹æ± çŠ¶æ€</span><br><span class="hljs-comment">//ä½29ä½æ˜¯ï¼š çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸ªæ•°</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">ctl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(ctlOf(RUNNING, <span class="hljs-number">0</span>));  <br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COUNT_BITS</span> <span class="hljs-operator">=</span> Integer.SIZE - <span class="hljs-number">3</span>;  <span class="hljs-comment">//29ï¼Œæ–¹ä¾¿åé¢åšä½è¿ç®—</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CAPACITY</span>   <span class="hljs-operator">=</span> (<span class="hljs-number">1</span> &lt;&lt; COUNT_BITS) - <span class="hljs-number">1</span>;   <span class="hljs-comment">//é€šè¿‡ä½è¿ç®—å¾—å‡ºæœ€å¤§å®¹é‡</span><br>  <br><span class="hljs-comment">// runState is stored in the high-order bits  </span><br><span class="hljs-comment">//çº¿ç¨‹æ± çŠ¶æ€</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">RUNNING</span>    <span class="hljs-operator">=</span> -<span class="hljs-number">1</span> &lt;&lt; COUNT_BITS;  <span class="hljs-comment">//111 ä»£è¡¨çº¿ç¨‹æ± ä¸ºRUNNINGï¼Œä»£è¡¨æ­£å¸¸æ¥æ”¶ä»»åŠ¡</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SHUTDOWN</span>   <span class="hljs-operator">=</span>  <span class="hljs-number">0</span> &lt;&lt; COUNT_BITS;  <span class="hljs-comment">//000 ä»£è¡¨çº¿ç¨‹æ± ä¸º`SHUTDOWN`çŠ¶æ€ï¼Œä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†æ˜¯å†…éƒ¨è¿˜ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œæ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡ä¹Ÿæ­£å¸¸å¤„ç†</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STOP</span>       <span class="hljs-operator">=</span>  <span class="hljs-number">1</span> &lt;&lt; COUNT_BITS;  <span class="hljs-comment">//001  ä»£è¡¨çº¿ç¨‹æ± ä¸º`STOP`çŠ¶æ€ï¼Œä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å»å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼ŒåŒæ—¶ä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TIDYING</span>    <span class="hljs-operator">=</span>  <span class="hljs-number">2</span> &lt;&lt; COUNT_BITS;  <span class="hljs-comment">//010 ä»£è¡¨çº¿ç¨‹æ± ä¸º`TIDYING`çŠ¶æ€ï¼Œè¿‡æ¸¡çš„çŠ¶æ€ï¼Œä»£è¡¨å½“å‰çº¿ç¨‹æ± å³å°†Game Over</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TERMINATED</span> <span class="hljs-operator">=</span>  <span class="hljs-number">3</span> &lt;&lt; COUNT_BITS;  <span class="hljs-comment">//011 ä»£è¡¨çº¿ç¨‹æ± ä¸º`TERMINATED`ï¼Œè¦æ‰§è¡Œterminated(),çœŸçš„å‡‰å‡‰äº†</span><br>  <br><span class="hljs-comment">// Packing and unpacking ctl  </span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">runStateOf</span><span class="hljs-params">(<span class="hljs-type">int</span> c)</span>     &#123; <span class="hljs-keyword">return</span> c &amp; ~CAPACITY; &#125;  <span class="hljs-comment">//å¾—åˆ°çº¿ç¨‹æ± çš„çŠ¶æ€</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">workerCountOf</span><span class="hljs-params">(<span class="hljs-type">int</span> c)</span>  &#123; <span class="hljs-keyword">return</span> c &amp; CAPACITY; &#125;   <span class="hljs-comment">//å¾—åˆ°å½“å‰çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡</span><br></code></pre></td></tr></table></figure><p><code>ThreadPoolExecutor</code>ç±»ä½¿ç”¨äº†ä¸€äº›é«˜çº§çš„ä½æ“ä½œæ¥é«˜æ•ˆåœ°ç®¡ç†çº¿ç¨‹æ± çš„çŠ¶æ€å’Œå·¥ä½œçº¿ç¨‹çš„æ•°é‡ã€‚</p><blockquote><p>æ ¸å¿ƒå˜é‡è§£é‡Š</p></blockquote><ul><li><code>AtomicInteger ctl</code><ul><li>å®é™…å®ƒæ˜¯ä½¿ç”¨äº† <code>AtomicInteger ctl</code> è¿™ä¸ªå˜é‡æ¥è¿›è¡Œå­˜å‚¨çº¿ç¨‹æ± çš„çŠ¶æ€å’Œçº¿ç¨‹æ•°ã€‚åŸå­æ“ä½œä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œå³åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹è¿™ä¸ªå˜é‡çš„ä¿®æ”¹æ˜¯åŸå­æ€§çš„ï¼Œé¿å…äº†ç«æ€æ¡ä»¶ã€‚</li><li>é«˜3ä½æ˜¯ï¼šçº¿ç¨‹æ± çŠ¶æ€</li><li>ä½29ä½æ˜¯ï¼š çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸ªæ•°</li></ul></li><li><code>COUNT_BITS</code><ul><li>ç”¨äºè®¡ç®—å’Œå­˜å‚¨çº¿ç¨‹æ•°é‡çš„ä½æ•°ã€‚å®ƒæ˜¯<code>Integer.SIZE</code>ï¼ˆJavaä¸­æ•´æ•°çš„ä½æ•°ï¼Œé€šå¸¸æ˜¯32ä½ï¼‰å‡å»3ã€‚</li><li>29ï¼Œæ–¹ä¾¿åé¢åšä½è¿ç®—;3ä½ç”¨äºè¡¨ç¤ºçº¿ç¨‹æ± çŠ¶æ€</li></ul></li><li><code>CAPACITY</code><ul><li>è¡¨ç¤ºçš„æœ€å¤§çº¿ç¨‹æ•°ã€‚å®ƒé€šè¿‡å°†1å·¦ç§»<code>COUNT_BITS</code>ä½ç„¶åå‡1æ¥è®¡ç®—ã€‚</li><li>ç±»ä¼¼ 100000000 - 1 &#x3D; 011111111111 è¿™ç§ï¼Œæ˜¯å¸¸è§çš„ä½è¿ç®—çš„ä¸€ç§è¡¨ç¤ºæ–¹å¼</li></ul></li></ul><blockquote><p>çº¿ç¨‹æ± çŠ¶æ€</p></blockquote><p>çº¿ç¨‹æ± çš„çŠ¶æ€è¢«å­˜å‚¨åœ¨<code>ctl</code>çš„é«˜ä½ã€‚è¿™äº›çŠ¶æ€åŒ…æ‹¬ï¼š</p><ul><li><strong><code>RUNNING</code></strong><ul><li>111</li><li>çº¿ç¨‹æ± å¯ä»¥æ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥å¤„ç†æ’é˜Ÿçš„ä»»åŠ¡ã€‚</li></ul></li><li><strong><code>SHUTDOWN</code></strong><ul><li>000</li><li>ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä½†æ˜¯å¯ä»¥å¤„ç†æ’é˜Ÿçš„ä»»åŠ¡ã€‚</li></ul></li><li><strong><code>STOP</code></strong><ul><li>001</li><li>ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä¸å¤„ç†æ’é˜Ÿçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸­æ–­æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡ã€‚</li></ul></li><li><strong><code>TIDYING</code></strong><ul><li>010</li><li>æ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»ˆæ­¢ï¼ŒworkerCountï¼ˆæ´»åŠ¨çº¿ç¨‹æ•°ï¼‰ä¸ºé›¶ï¼Œçº¿ç¨‹æ± æ­£åœ¨è½¬æ¢åˆ°çŠ¶æ€<code>TERMINATED</code>ã€‚</li></ul></li><li><strong><code>TERMINATED</code></strong><ul><li>011</li><li><code>terminated()</code>æ–¹æ³•å·²ç»å®Œæˆ</li></ul></li></ul><blockquote><p>ä½æ“ä½œæ–¹æ³•</p></blockquote><ul><li><strong><code>runStateOf(int c)</code></strong>: æå–<code>ctl</code>ä¸­çš„çŠ¶æ€éƒ¨åˆ†ã€‚</li><li><strong><code>workerCountOf(int c)</code></strong>: æå–<code>ctl</code>ä¸­çš„å·¥ä½œçº¿ç¨‹æ•°éƒ¨åˆ†ã€‚</li><li><strong><code>ctlOf(int rs, int wc)</code></strong>: å°†è¿è¡ŒçŠ¶æ€å’Œå·¥ä½œçº¿ç¨‹æ•°ç»„åˆæˆä¸€ä¸ª<code>ctl</code>å€¼</li></ul><h4 id="4-2-çº¿ç¨‹æ± çŠ¶æ€å˜åŒ–"><a href="#4-2-çº¿ç¨‹æ± çŠ¶æ€å˜åŒ–" class="headerlink" title="4.2 çº¿ç¨‹æ± çŠ¶æ€å˜åŒ–"></a>4.2 çº¿ç¨‹æ± çŠ¶æ€å˜åŒ–</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231222005453.png" alt="image.png"></p><h3 id="äº”ã€çº¿ç¨‹æ± çš„-execute-æ–¹æ³•æ‰§è¡Œ"><a href="#äº”ã€çº¿ç¨‹æ± çš„-execute-æ–¹æ³•æ‰§è¡Œ" class="headerlink" title="äº”ã€çº¿ç¨‹æ± çš„ execute æ–¹æ³•æ‰§è¡Œ"></a>äº”ã€çº¿ç¨‹æ± çš„ execute æ–¹æ³•æ‰§è¡Œ</h3><p>åœ¨Javaçš„<code>ThreadPoolExecutor</code>ç±»ä¸­ï¼Œ<code>execute</code>æ–¹æ³•æ˜¯ç”¨äºæäº¤ä»»åŠ¡çš„å…³é”®æ–¹æ³•ã€‚</p><p>å®ƒå†³å®šå¦‚ä½•å°†ä¸€ä¸ªæ–°çš„<code>Runnable</code>ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ã€‚</p><h4 id="execute-æ–¹æ³•"><a href="#execute-æ–¹æ³•" class="headerlink" title="execute æ–¹æ³•"></a>execute æ–¹æ³•</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span>(<span class="hljs-params">Runnable command</span>)</span> &#123;<br>    <span class="hljs-comment">// æ£€æŸ¥æäº¤çš„ä»»åŠ¡ä¸æ˜¯null</span><br>    <span class="hljs-keyword">if</span> (command == <span class="hljs-literal">null</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br><br>    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹æ± çŠ¶æ€å’Œå·¥ä½œçº¿ç¨‹æ•°</span><br>    <span class="hljs-built_in">int</span> c = ctl.<span class="hljs-keyword">get</span>();<br><br>    <span class="hljs-comment">// å¦‚æœå½“å‰å·¥ä½œçº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°</span><br>    <span class="hljs-keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;<br>        <span class="hljs-comment">// å°è¯•æ·»åŠ ä¸€ä¸ªæ–°å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡</span><br>        <span class="hljs-keyword">if</span> (addWorker(command, <span class="hljs-literal">true</span>))<br>            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// å¦‚æœæˆåŠŸï¼Œç›´æ¥è¿”å›</span><br>        <span class="hljs-comment">// å¦‚æœæ·»åŠ å·¥ä½œçº¿ç¨‹å¤±è´¥ï¼Œé‡æ–°è·å–çº¿ç¨‹æ± çŠ¶æ€</span><br>        c = ctl.<span class="hljs-keyword">get</span>();<br>    &#125;<br><br>    <span class="hljs-comment">// å¦‚æœçº¿ç¨‹æ± å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä¸”ä»»åŠ¡èƒ½è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­</span><br>    <span class="hljs-keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;<br>        <span class="hljs-comment">// é‡æ–°æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€</span><br>        <span class="hljs-built_in">int</span> recheck = ctl.<span class="hljs-keyword">get</span>();<br>        <span class="hljs-comment">// å¦‚æœçº¿ç¨‹æ± ä¸å†è¿è¡Œï¼Œå¹¶ä¸”èƒ½ä»é˜Ÿåˆ—ä¸­ç§»é™¤ä»»åŠ¡ï¼Œåˆ™æ‹’ç»ä»»åŠ¡</span><br>        <span class="hljs-keyword">if</span> (!isRunning(recheck) &amp;&amp; <span class="hljs-keyword">remove</span>(command))<br>            reject(command);<br>        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ´»åŠ¨çš„å·¥ä½œçº¿ç¨‹ï¼Œåˆ™æ·»åŠ ä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (workerCountOf(recheck) == <span class="hljs-number">0</span>)<br>            addWorker(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>);<br>    &#125;<br>    <span class="hljs-comment">// å¦‚æœä»»åŠ¡ä¸èƒ½è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œå°è¯•åˆ›å»ºä¸€ä¸ªæ–°å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!addWorker(command, <span class="hljs-literal">false</span>))<br>        reject(command); <span class="hljs-comment">// å¦‚æœåˆ›å»ºå¤±è´¥ï¼Œåˆ™æ‹’ç»ä»»åŠ¡</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°æ­¥éª¤ï¼š</p><ol><li><strong>å‚æ•°æ£€æŸ¥</strong>: é¦–å…ˆæ£€æŸ¥ä¼ å…¥çš„<code>Runnable</code>å¯¹è±¡ä¸æ˜¯<code>null</code>ã€‚</li><li><strong>å·¥ä½œçº¿ç¨‹æ•°é‡æ£€æŸ¥</strong>: å¦‚æœå½“å‰å·¥ä½œçº¿ç¨‹çš„æ•°é‡å°äºæ ¸å¿ƒçº¿ç¨‹æ•°<code>corePoolSize</code>ï¼Œå°è¯•ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li><li><strong>ä»»åŠ¡é˜Ÿåˆ—å¤„ç†</strong>: å¦‚æœå½“å‰çº¿ç¨‹æ•°å·²ç»è¾¾åˆ°æˆ–è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæˆ–è€…æ–°å·¥ä½œçº¿ç¨‹çš„åˆ›å»ºå¤±è´¥ï¼Œåˆ™å°è¯•å°†ä»»åŠ¡åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</li><li><strong>çŠ¶æ€é‡æ–°æ£€æŸ¥</strong>: åœ¨æˆåŠŸå°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—åï¼Œéœ€è¦å†æ¬¡æ£€æŸ¥çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œç¡®ä¿çº¿ç¨‹æ± ä»åœ¨è¿è¡Œã€‚å¦‚æœçº¿ç¨‹æ± çŠ¶æ€æ”¹å˜ï¼ˆä¾‹å¦‚ï¼Œè¢«å…³é—­äº†ï¼‰ï¼Œåˆ™å°è¯•ç§»é™¤åˆšåŠ å…¥çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</li><li><strong>æ— æ´»åŠ¨çº¿ç¨‹å¤„ç†</strong>: å¦‚æœä»»åŠ¡è¢«æˆåŠŸåŠ å…¥é˜Ÿåˆ—ï¼Œä½†æ²¡æœ‰æ´»åŠ¨çš„å·¥ä½œçº¿ç¨‹å¯ä»¥å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œè¿™æ—¶ä¼šå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹ã€‚</li><li><strong>æ‹’ç»ç­–ç•¥</strong>: å¦‚æœæ— æ³•å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ï¼Œä¸”æ— æ³•åˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼Œæœ€åçš„é€‰é¡¹æ˜¯æ‹’ç»ä»»åŠ¡ã€‚</li></ol><h4 id="addWorker-æ–¹æ³•"><a href="#addWorker-æ–¹æ³•" class="headerlink" title="addWorker æ–¹æ³•"></a>addWorker æ–¹æ³•</h4><p>åœ¨Javaçš„<code>ThreadPoolExecutor</code>ç±»ä¸­ï¼Œ<code>addWorker</code>æ–¹æ³•æ˜¯ç”¨äºå‘çº¿ç¨‹æ± ä¸­æ·»åŠ æ–°çš„å·¥ä½œçº¿ç¨‹çš„å…³é”®æ–¹æ³•ã€‚</p><p>å®ƒåœ¨å¤„ç†æ–°ä»»åŠ¡æˆ–è€…éœ€è¦å¢åŠ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æ—¶è¢«è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addWorker</span><span class="hljs-params">(Runnable firstTask, <span class="hljs-type">boolean</span> core)</span> &#123;<br>    retry:<br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹æ± çš„æ§åˆ¶çŠ¶æ€</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> ctl.get();<br>        <span class="hljs-comment">// è·å–è¿è¡ŒçŠ¶æ€</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> runStateOf(c);<br><br>        <span class="hljs-comment">// æ£€æŸ¥çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯å¦å…è®¸æ·»åŠ æ–°çš„å·¥ä½œçº¿ç¨‹</span><br>        <span class="hljs-comment">// ä»…åœ¨ä»¥ä¸‹æƒ…å†µè¿”å›falseï¼š</span><br>        <span class="hljs-comment">// 1. çº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNä»¥ä¸Šï¼ˆä¸åŒ…æ‹¬SHUTDOWNï¼‰ä¸”ä¸æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶ï¼š</span><br>        <span class="hljs-comment">//    - çŠ¶æ€ä¸ºSHUTDOWN</span><br>        <span class="hljs-comment">//    - firstTaskä¸ºnull</span><br>        <span class="hljs-comment">//    - å·¥ä½œé˜Ÿåˆ—ä¸ä¸ºç©º</span><br>        <span class="hljs-keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp;<br>            !(rs == SHUTDOWN &amp;&amp;<br>              firstTask == <span class="hljs-literal">null</span> &amp;&amp;<br>              !workQueue.isEmpty()))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br><br>        <span class="hljs-comment">// æ— é™å¾ªç¯ï¼Œå°è¯•å¢åŠ å·¥ä½œçº¿ç¨‹çš„æ•°é‡</span><br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">wc</span> <span class="hljs-operator">=</span> workerCountOf(c);<br>            <span class="hljs-comment">// æ£€æŸ¥å½“å‰å·¥ä½œçº¿ç¨‹æ•°æ˜¯å¦è¶…è¿‡äº†æœ€å¤§å®¹é‡æˆ–è®¾ç½®çš„é˜ˆå€¼</span><br>            <span class="hljs-comment">// å¦‚æœè¶…è¿‡å®¹é‡æˆ–è€…è¶…è¿‡corePoolSize/maximumPoolSizeï¼Œåˆ™è¿”å›false</span><br>            <span class="hljs-keyword">if</span> (wc &gt;= CAPACITY ||<br>                wc &gt;= (core ? corePoolSize : maximumPoolSize))<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            <span class="hljs-comment">// ä½¿ç”¨CASæ“ä½œå¢åŠ å·¥ä½œçº¿ç¨‹è®¡æ•°</span><br>            <span class="hljs-comment">// å¦‚æœCASæˆåŠŸï¼Œè·³å‡ºretryæ ‡ç­¾ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œ</span><br>            <span class="hljs-keyword">if</span> (compareAndIncrementWorkerCount(c))<br>                <span class="hljs-keyword">break</span> retry;<br>            <span class="hljs-comment">// å¦‚æœCASå¤±è´¥ï¼Œé‡æ–°è¯»å–ctl</span><br>            c = ctl.get(); <br>            <span class="hljs-comment">// å¦‚æœè¿è¡ŒçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œé‡æ–°å¼€å§‹å¤–å±‚å¾ªç¯</span><br>            <span class="hljs-keyword">if</span> (runStateOf(c) != rs)<br>                <span class="hljs-keyword">continue</span> retry;<br>            <span class="hljs-comment">// å¦‚æœCASå¤±è´¥ä½†è¿è¡ŒçŠ¶æ€æ²¡æœ‰å˜åŒ–ï¼Œç»§ç»­å°è¯•å†…å±‚å¾ªç¯çš„CASæ“ä½œ</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// æ·»åŠ å·¥ä½œçº¿ç¨‹çš„è¿‡ç¨‹</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">workerStarted</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">workerAdded</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-type">Worker</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹</span><br>        w = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(firstTask);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> w.thread;<br>        <span class="hljs-comment">// å¦‚æœæˆåŠŸåˆ›å»ºçº¿ç¨‹</span><br>        <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">mainLock</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.mainLock;<br>            mainLock.lock();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// åœ¨æŒæœ‰é”çš„æƒ…å†µä¸‹å†æ¬¡æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€</span><br>                <span class="hljs-type">int</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> runStateOf(ctl.get());<br><br>                <span class="hljs-comment">// å¦‚æœçº¿ç¨‹æ± çŠ¶æ€å…è®¸æ·»åŠ å·¥ä½œçº¿ç¨‹ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°å·¥ä½œé›†åˆä¸­</span><br>                <span class="hljs-keyword">if</span> (rs &lt; SHUTDOWN ||<br>                    (rs == SHUTDOWN &amp;&amp; firstTask == <span class="hljs-literal">null</span>)) &#123;<br>                    <span class="hljs-comment">// æ£€æŸ¥çº¿ç¨‹æ˜¯å¦å·²ç»å¯åŠ¨ï¼ˆé¢„é˜²å¼‚å¸¸æƒ…å†µï¼‰</span><br>                    <span class="hljs-keyword">if</span> (t.isAlive()) <br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalThreadStateException</span>();<br>                    workers.add(w);<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> workers.size();<br>                    <span class="hljs-comment">// æ›´æ–°è®°å½•çš„æœ€å¤§æ± å¤§å°</span><br>                    <span class="hljs-keyword">if</span> (s &gt; largestPoolSize)<br>                        largestPoolSize = s;<br>                    workerAdded = <span class="hljs-literal">true</span>;<br>                &#125;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-comment">// é‡Šæ”¾é”</span><br>                mainLock.unlock();<br>            &#125;<br>            <span class="hljs-comment">// å¦‚æœæˆåŠŸæ·»åŠ å·¥ä½œçº¿ç¨‹ï¼Œåˆ™å¯åŠ¨è¯¥çº¿ç¨‹</span><br>            <span class="hljs-keyword">if</span> (workerAdded) &#123;<br>                t.start();<br>                workerStarted = <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœå·¥ä½œçº¿ç¨‹æœªèƒ½æˆåŠŸå¯åŠ¨ï¼Œå¤„ç†å¤±è´¥æƒ…å†µ</span><br>        <span class="hljs-keyword">if</span> (!workerStarted)<br>            addWorkerFailed(w);<br>    &#125;<br>    <span class="hljs-comment">// è¿”å›å·¥ä½œçº¿ç¨‹æ˜¯å¦æˆåŠŸå¯åŠ¨</span><br>    <span class="hljs-keyword">return</span> workerStarted;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ç°æ­¥éª¤ï¼š</p><ol><li><strong>çŠ¶æ€æ£€æŸ¥</strong>: é¦–å…ˆæ£€æŸ¥çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œç¡®å®šæ˜¯å¦å¯ä»¥æ·»åŠ æ–°çš„å·¥ä½œçº¿ç¨‹ã€‚å¦‚æœçº¿ç¨‹æ± æ­£åœ¨å…³é—­ï¼Œå¹¶ä¸”æ¡ä»¶ä¸å…è®¸æ·»åŠ å·¥ä½œçº¿ç¨‹ï¼ˆä¾‹å¦‚ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œåˆ™ç›´æ¥è¿”å›<code>false</code>ã€‚</li><li><strong>å¢åŠ å·¥ä½œçº¿ç¨‹æ•°</strong>: ä½¿ç”¨ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œé€šè¿‡CASï¼ˆCompare-And-Swapï¼‰æ“ä½œå°è¯•å¢åŠ å·¥ä½œçº¿ç¨‹è®¡æ•°ã€‚å¦‚æœCASæ“ä½œæˆåŠŸï¼Œè·³å‡ºå¾ªç¯ï¼›å¦‚æœå¤±è´¥ï¼Œé‡æ–°å°è¯•ã€‚</li><li><strong>åˆ›å»ºå’Œå¯åŠ¨å·¥ä½œçº¿ç¨‹</strong>: åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Worker</code>å¯¹è±¡ï¼Œå¹¶å°è¯•å¯åŠ¨å…¶çº¿ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠè·å–ä¸€ä¸ªå…¨å±€é”ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li><li><strong>çº¿ç¨‹æ± çŠ¶æ€å†æ¬¡æ£€æŸ¥</strong>: åœ¨é”å†…éƒ¨å†æ¬¡æ£€æŸ¥çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œä»¥ç¡®ä¿åœ¨è·å–é”çš„è¿‡ç¨‹ä¸­çŠ¶æ€æ²¡æœ‰æ”¹å˜ã€‚</li><li><strong>æ·»åŠ åˆ°å·¥ä½œé›†åˆ</strong>: å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå°†æ–°çš„<code>Worker</code>æ·»åŠ åˆ°å·¥ä½œçº¿ç¨‹é›†åˆä¸­ï¼Œå¹¶æ›´æ–°è®°å½•çš„æœ€å¤§æ± å¤§å°ã€‚</li><li><strong>å¯åŠ¨çº¿ç¨‹</strong>: å°è¯•å¯åŠ¨çº¿ç¨‹ã€‚å¦‚æœå¯åŠ¨æˆåŠŸï¼Œè¿”å›<code>true</code>ï¼›å¦åˆ™ï¼Œåœ¨<code>finally</code>å—ä¸­å¤„ç†å¯åŠ¨å¤±è´¥çš„æƒ…å†µã€‚</li></ol><p><code>addWorker</code>æ–¹æ³•çš„å®ç°ä½“ç°äº†çº¿ç¨‹æ± å¦‚ä½•æœ‰æ•ˆåœ°ç®¡ç†çº¿ç¨‹çš„åˆ›å»ºå’Œæ·»åŠ ã€‚</p><p>ä½¿ç”¨CASæ“ä½œä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œè€ŒåŒé‡æ£€æŸ¥ï¼ˆåœ¨æ–¹æ³•å¼€å§‹å’ŒæŒæœ‰é”æ—¶ï¼‰ç¡®ä¿äº†å³ä½¿åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¹Ÿèƒ½æ­£ç¡®åœ°ç®¡ç†çº¿ç¨‹æ± çš„çŠ¶æ€ã€‚</p><h3 id="å…­ã€Worker-çš„å°è£…"><a href="#å…­ã€Worker-çš„å°è£…" class="headerlink" title="å…­ã€Worker çš„å°è£…"></a>å…­ã€Worker çš„å°è£…</h3><p>åœ¨Javaçš„<code>ThreadPoolExecutor</code>ç±»ä¸­ï¼Œ<code>Worker</code>æ˜¯ä¸€ä¸ªå…³é”®çš„å†…éƒ¨ç±»ï¼Œå®ƒå°è£…äº†çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹çš„è¡Œä¸ºå’Œå±æ€§ã€‚</p><p><code>Worker</code>ç±»ç»§æ‰¿è‡ª<code>AbstractQueuedSynchronizer</code>ï¼Œæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºé”å’Œå…¶ä»–åŒæ­¥ç»„ä»¶çš„æ¡†æ¶</p><h4 id="ThreadPoolExecutorå†…éƒ¨ç±»Workerçš„æ„é€ å‡½æ•°"><a href="#ThreadPoolExecutorå†…éƒ¨ç±»Workerçš„æ„é€ å‡½æ•°" class="headerlink" title="ThreadPoolExecutorå†…éƒ¨ç±»Workerçš„æ„é€ å‡½æ•°"></a><code>ThreadPoolExecutor</code>å†…éƒ¨ç±»<code>Worker</code>çš„æ„é€ å‡½æ•°</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">Worker(Runnable firstTask) &#123;<br>    <span class="hljs-comment">// è®¾ç½®Workerçš„çŠ¶æ€ä¸º-1ï¼Œæš‚æ—¶é˜»æ­¢çº¿ç¨‹ä¸­æ–­</span><br>    <span class="hljs-comment">// è¿™æ˜¯ä¸ºäº†é˜²æ­¢åœ¨WorkerçœŸæ­£å¼€å§‹è¿è¡Œå‰è¢«ä¸­æ–­</span><br>    setState(-<span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">// å°†ä¼ å…¥çš„ä»»åŠ¡ï¼ˆå¯èƒ½ä¸ºnullï¼‰è®¾ç½®ä¸ºWorkerçš„ç¬¬ä¸€ä¸ªä»»åŠ¡</span><br>    <span class="hljs-comment">// è¿™ä¸ªä»»åŠ¡å°†æ˜¯Workeråˆ›å»ºåæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªä»»åŠ¡</span><br>    <span class="hljs-keyword">this</span>.firstTask = firstTask;<br><br>    <span class="hljs-comment">// ä½¿ç”¨çº¿ç¨‹æ± çš„çº¿ç¨‹å·¥å‚åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶å°†å½“å‰Workerä½œä¸ºä»»åŠ¡ä¼ é€’ç»™è¿™ä¸ªæ–°çº¿ç¨‹</span><br>    <span class="hljs-comment">// è¿™é‡Œï¼ŒWorkerè‡ªèº«å®é™…ä¸Šæ˜¯ä¸€ä¸ªRunnableï¼Œå› ä¸ºå®ƒå®ç°äº†Runnableæ¥å£</span><br>    <span class="hljs-keyword">this</span>.thread = getThreadFactory().newThread(<span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç åˆ†æï¼š</p><ol><li><strong>æš‚æ—¶ç¦ç”¨ä¸­æ–­</strong>: <code>setState(-1)</code>è®¾ç½®Workerçš„çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç”¨äºæ§åˆ¶çº¿ç¨‹çš„ä¸­æ–­ã€‚è®¾ç½®ä¸º-1æ„å‘³ç€åœ¨<code>runWorker</code>æ–¹æ³•çœŸæ­£å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œçº¿ç¨‹ä¸åº”è¢«ä¸­æ–­ã€‚è¿™æ˜¯ä¸€ä¸ªé¢„é˜²æªæ–½ï¼Œä»¥ç¡®ä¿Workeråœ¨å¼€å§‹æ‰§è¡Œå…¶ä»»åŠ¡å‰ä¸ä¼šè¢«æ„å¤–ä¸­æ–­ã€‚</li><li><strong>è®¾ç½®ç¬¬ä¸€ä¸ªä»»åŠ¡</strong>: <code>this.firstTask = firstTask</code>å°†ä¼ å…¥çš„ä»»åŠ¡èµ‹å€¼ç»™Workerçš„<code>firstTask</code>å±æ€§ã€‚è¿™ä¸ªä»»åŠ¡æ˜¯Workerå°†è¦æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚å¦‚æœè¿™ä¸ªå€¼æ˜¯<code>null</code>ï¼ŒWorkerå°†ä»çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚</li><li><strong>åˆ›å»ºæ–°çº¿ç¨‹</strong>: <code>this.thread = getThreadFactory().newThread(this)</code>è°ƒç”¨çº¿ç¨‹å·¥å‚æ¥åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶å°†å½“å‰Workerä½œä¸ºè¿è¡Œä»»åŠ¡ä¼ é€’ã€‚ç”±äºWorkerå®ç°äº†<code>Runnable</code>æ¥å£ï¼Œå®ƒå¯ä»¥è¢«çº¿ç¨‹ç›´æ¥æ‰§è¡Œã€‚çº¿ç¨‹å·¥å‚æ˜¯çº¿ç¨‹æ± çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œç”¨äºå®šåˆ¶çº¿ç¨‹åˆ›å»ºè¿‡ç¨‹ï¼ˆä¾‹å¦‚è®¾ç½®çº¿ç¨‹åç§°ã€ä¼˜å…ˆçº§ç­‰ï¼‰ã€‚</li></ol><h4 id="runWorker-æ–¹æ³•"><a href="#runWorker-æ–¹æ³•" class="headerlink" title="runWorker æ–¹æ³•"></a>runWorker æ–¹æ³•</h4><p>å®šä¹‰äº†çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ï¼ˆ<code>Worker</code>ï¼‰å¦‚ä½•æ‰§è¡Œä»»åŠ¡</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> runWorker(Worker w) &#123;<br>    <span class="hljs-comment">// è·å–å½“å‰æ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„çº¿ç¨‹</span><br>    Thread wt = Thread.currentThread();<br>    <span class="hljs-comment">// ä»Workerè·å–ç¬¬ä¸€ä¸ªä»»åŠ¡</span><br>    Runnable <span class="hljs-keyword">task</span> = w.firstTask;<br>    <span class="hljs-comment">// è®¾ç½®Workerçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ä¸ºnull</span><br>    w.firstTask = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-comment">// é‡Šæ”¾Workerä¸Šçš„é”ï¼Œå…è®¸ä¸­æ–­</span><br>    w.unlock(); <br><br>    <span class="hljs-comment">// æ ‡è®°æ˜¯å¦å¼‚å¸¸å®Œæˆä»»åŠ¡</span><br>    <span class="hljs-keyword">boolean</span> completedAbruptly = <span class="hljs-keyword">true</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// å½“æœ‰ä»»åŠ¡æ‰§è¡Œæˆ–è€…èƒ½ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–åˆ°ä»»åŠ¡æ—¶ï¼Œç»§ç»­å¾ªç¯</span><br>        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">task</span> != <span class="hljs-keyword">null</span> || (<span class="hljs-keyword">task</span> = getTask()) != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-comment">// é”å®šWorkerï¼Œä»¥å¼€å§‹æ‰§è¡Œä»»åŠ¡</span><br>            w.lock();<br>            <span class="hljs-comment">// å¦‚æœçº¿ç¨‹æ± æ­£åœ¨åœæ­¢ï¼Œç¡®ä¿çº¿ç¨‹è¢«ä¸­æ–­ï¼›</span><br>            <span class="hljs-comment">// å¦‚æœä¸æ˜¯ï¼Œåˆ™ç¡®ä¿çº¿ç¨‹ä¸è¢«ä¸­æ–­ã€‚è¿™éœ€è¦åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹é‡æ–°æ£€æŸ¥ä»¥å¤„ç†shutdownNowç«äº‰çŠ¶æ€</span><br>            <span class="hljs-keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||<br>                 (Thread.interrupted() &amp;&amp;<br>                  runStateAtLeast(ctl.get(), STOP))) &amp;&amp;<br>                !wt.isInterrupted())<br>                wt.interrupt();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// åœ¨æ‰§è¡Œä»»åŠ¡å‰çš„é’©å­æ–¹æ³•</span><br>                beforeExecute(wt, <span class="hljs-keyword">task</span>);<br>                Throwable thrown = <span class="hljs-keyword">null</span>;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-comment">// è¿è¡Œä»»åŠ¡</span><br>                    <span class="hljs-keyword">task</span>.run();<br>                &#125; <span class="hljs-keyword">catch</span> (RuntimeException x) &#123;<br>                    thrown = x; <span class="hljs-keyword">throw</span> x;<br>                &#125; <span class="hljs-keyword">catch</span> (Error x) &#123;<br>                    thrown = x; <span class="hljs-keyword">throw</span> x;<br>                &#125; <span class="hljs-keyword">catch</span> (Throwable x) &#123;<br>                    thrown = x; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(x);<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    <span class="hljs-comment">// åœ¨æ‰§è¡Œä»»åŠ¡åçš„é’©å­æ–¹æ³•</span><br>                    afterExecute(<span class="hljs-keyword">task</span>, thrown);<br>                &#125;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-comment">// ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ¸…ç†å·¥ä½œ</span><br>                <span class="hljs-keyword">task</span> = <span class="hljs-keyword">null</span>;<br>                w.completedTasks++;<br>                w.unlock();<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// å¦‚æœæ­£å¸¸é€€å‡ºå¾ªç¯ï¼Œè®¾ç½®completedAbruptlyä¸ºfalse</span><br>        completedAbruptly = <span class="hljs-keyword">false</span>;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-comment">// å¤„ç†Workeré€€å‡º</span><br>        processWorkerExit(w, completedAbruptly);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œæ­¥éª¤ï¼š</p><ol><li><strong>åˆå§‹åŒ–</strong>: é¦–å…ˆè·å–å½“å‰çº¿ç¨‹å’ŒWorkerä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚è§£é”Workerä»¥å…è®¸çº¿ç¨‹ä¸­æ–­ã€‚</li><li><strong>ä»»åŠ¡æ‰§è¡Œå¾ªç¯</strong>: æ–¹æ³•è¿›å…¥ä¸€ä¸ªå¾ªç¯ï¼Œä¸æ–­æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœWorkerçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ä¸ºç©ºï¼Œåˆ™å°è¯•ä»çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–æ–°çš„ä»»åŠ¡ã€‚</li><li><strong>ä¸­æ–­ç®¡ç†</strong>: åœ¨æ¯æ¬¡ä»»åŠ¡æ‰§è¡Œå‰ï¼Œæ£€æŸ¥çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå¦‚æœéœ€è¦ï¼Œæ ¹æ®çº¿ç¨‹æ± çš„çŠ¶æ€æ¥å†³å®šæ˜¯å¦ä¸­æ–­å½“å‰çº¿ç¨‹ã€‚</li><li><strong>ä»»åŠ¡æ‰§è¡Œ</strong>: å®é™…æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶å¤„ç†ä»»ä½•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ã€‚åŒæ—¶ï¼Œæ‰§è¡Œé’©å­æ–¹æ³•<code>beforeExecute</code>å’Œ<code>afterExecute</code>ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥ç”¨äºåœ¨ä»»åŠ¡æ‰§è¡Œå‰ååšä¸€äº›å‡†å¤‡å’Œæ¸…ç†å·¥ä½œã€‚</li><li><strong>ä»»åŠ¡å®Œæˆåå¤„ç†</strong>: æ›´æ–°å®Œæˆä»»åŠ¡çš„è®¡æ•°ï¼Œæ¸…ç†å˜é‡ï¼Œè§£é”Workerã€‚</li><li><strong>å¼‚å¸¸å¤„ç†ä¸é€€å‡º</strong>: å¦‚æœä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸å¯¼è‡´çº¿ç¨‹æ„å¤–ç»“æŸï¼Œ<code>completedAbruptly</code>æ ‡è®°ä¼šä¿æŒä¸º<code>true</code>ã€‚åœ¨æœ€åçš„<code>finally</code>å—ä¸­ï¼Œè°ƒç”¨<code>processWorkerExit</code>æ¥å¤„ç†Workerçš„é€€å‡ºï¼Œè¿™å¯èƒ½åŒ…æ‹¬æ›¿æ¢è¿™ä¸ªWorkeræˆ–è€…æ ¹æ®å½“å‰çº¿ç¨‹æ± çŠ¶æ€è¿›è¡Œå…¶ä»–å¤„ç†ã€‚</li></ol><hr><p>å‚è€ƒ</p><ul><li><a href="https://www.bilibili.com/video/BV1244y1n7bz">https://www.bilibili.com/video/BV1244y1n7bz</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>Thread</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>thread</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—_RocketMQ_å®‰è£…ä¸ä½¿ç”¨</title>
    <link href="/2023/12/21/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RocketMQ_%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/12/21/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RocketMQ_%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>ä¸‹è½½åœ°å€ï¼š <a href="https://rocketmq.apache.org/download/">https://rocketmq.apache.org/download/</a></p><p>è¿™é‡Œä¸‹è½½ 4.8.0 ç‰ˆæœ¬ï¼š<a href="https://rocketmq.apache.org/release-notes/2020/12/21/4.8.0">Release Notes - Apache RocketMQ - Version 4.8.0 | RocketMQ</a></p><p>é€‰æ‹©Binary è¿›è¡Œä¸‹è½½ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312211150403.png" alt="image.png"></p><blockquote><p>NameServer</p></blockquote><p>æ³¨å†Œä¸­å¿ƒï¼Œç”¨äºç®¡ç† Broker</p><blockquote><p>Broker</p></blockquote><p>ç”¨æ¥ä¿æŒ Topic ä¸»é¢˜çš„ä¿¡æ¯ï¼Œæ¥æ”¶ç”Ÿäº§è€…çš„æ¶ˆæ¯ã€‚</p><h4 id="æ­å»ºå¯è§†åŒ–ç›‘æ§å¹³å°"><a href="#æ­å»ºå¯è§†åŒ–ç›‘æ§å¹³å°" class="headerlink" title="æ­å»ºå¯è§†åŒ–ç›‘æ§å¹³å°"></a>æ­å»ºå¯è§†åŒ–ç›‘æ§å¹³å°</h4><p>rocketmq-dashboardæ˜¯RocketMQçš„ä¸€ä¸ªæ‹“å±•å¼€æºé¡¹ç›®ï¼Œå¯ä»¥å¯¹MQè¿›è¡Œå¯è§†åŒ–ç›‘æ§ã€‚ </p><p>ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/apache/rocketmq-dashboard">https://github.com/apache/rocketmq-dashboard</a></p><h4 id="RocketMQçš„åŸºæœ¬ä½¿ç”¨"><a href="#RocketMQçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="RocketMQçš„åŸºæœ¬ä½¿ç”¨"></a>RocketMQçš„åŸºæœ¬ä½¿ç”¨</h4><h3 id="å®‰è£…æ“ä½œ"><a href="#å®‰è£…æ“ä½œ" class="headerlink" title="å®‰è£…æ“ä½œ"></a>å®‰è£…æ“ä½œ</h3><h4 id="ä½¿ç”¨-docker-çš„æ–¹å¼è¿›è¡Œå®‰è£…-rocketmq"><a href="#ä½¿ç”¨-docker-çš„æ–¹å¼è¿›è¡Œå®‰è£…-rocketmq" class="headerlink" title="ä½¿ç”¨ docker çš„æ–¹å¼è¿›è¡Œå®‰è£… rocketmq"></a>ä½¿ç”¨ docker çš„æ–¹å¼è¿›è¡Œå®‰è£… rocketmq</h4><p>å‚è€ƒï¼š <a href="https://blog.csdn.net/qq_43600166/article/details/136187969">https://blog.csdn.net/qq_43600166/article/details/136187969</a></p><p>æ‹‰å–æœ€æ–°é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull rocketmqinc/rocketmq<br></code></pre></td></tr></table></figure><h5 id="nameserver"><a href="#nameserver" class="headerlink" title="nameserver"></a>nameserver</h5><p><strong>åˆ›å»º nameserver æ•°æ®å­˜å‚¨ç›®å½•</strong></p><p><strong>rocketMQ</strong>Â åˆ†ä¸º<strong>nameserver</strong>å’Œ<strong>broker</strong>ä¸¤éƒ¨åˆ†ï¼Œåœ¨å¯åŠ¨æ—¶åº”è¯¥å…ˆå¯åŠ¨<strong>nameserver</strong>ï¼Œå› æ­¤æˆ‘ä»¬ç°åœ¨å…ˆåˆ›å»º<strong>nameserver</strong>çš„æ—¥å¿—å’Œæ•°æ®å­˜æ”¾ç›®å½•ã€‚è¿™ä¸ªç›®å½•å¯ç”±æˆ‘ä»¬è‡ªå·±å®šä¹‰è·¯å¾„ï¼Œè¿™é‡Œæˆ‘å°†å…¶æ”¾åˆ°dataè·¯å¾„ä¸‹:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mkdir -p <span class="hljs-regexp">/data/</span>namesrv<span class="hljs-regexp">/logs /</span>data<span class="hljs-regexp">/namesrv/</span>store<br></code></pre></td></tr></table></figure><p>logs:æ˜¯nameserverçš„æ—¥å¿—ç›®å½•ï¼Œstore:æ˜¯nameserverçš„æ•°æ®ç›®å½•</p><p><strong>æ„å»ºnamesrvå®¹å™¨å¹¶å¯åŠ¨</strong></p><p>æŒ‚è½½æ—¥å¿—å’Œæ•°æ®è·¯å¾„ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨<strong>nameserver</strong></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">run</span><span class="language-bash"> -d  --restart=always --name rmqnamesrv -p 9876:9876  -v  /data/namesrv/logs:/root/logs  -v /data/namesrv/store:/root/store  -e <span class="hljs-string">&quot;MAX_POSSIBLE_HEAP=100000000&quot;</span>  rocketmqinc/rocketmq sh mqnamesrv</span><br></code></pre></td></tr></table></figure><h5 id="broker"><a href="#broker" class="headerlink" title="broker"></a>broker</h5><p><strong>åˆ›å»ºbrokeræ•°æ®å­˜å‚¨è·¯å¾„</strong>  </p><p>åœ¨æ“ä½œè¿™æ­¥ä¹‹å‰ï¼Œæˆ‘ä»¬å·²ç»å°†<strong>nameserver</strong>å¯åŠ¨æˆåŠŸï¼Œåˆ™æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¦ä¸º<strong>broker</strong>åˆ›å»ºæ•°æ®æŒ‚è½½ç›®å½•å’Œé…ç½®æ–‡ä»¶ï¼Œä»¥ç¡®ä¿<strong>broker</strong>èƒ½å¤ŸæˆåŠŸå¯åŠ¨ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">mkdir -p <span class="hljs-regexp">/data/</span>broker<span class="hljs-regexp">/logs  /</span>data<span class="hljs-regexp">/broker/</span>store <span class="hljs-regexp">/data/</span>broker/conf<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> /data/broker/<span class="hljs-keyword">conf</span><br><span class="hljs-keyword">vi</span> broker.<span class="hljs-keyword">conf</span><br></code></pre></td></tr></table></figure><p>broker.conf</p><blockquote><p>å°†ä¿¡æ¯å¤åˆ¶åˆ°broker.confæ–‡ä»¶ä¸­ï¼Œæ³¨æ„ä¿®æ”¹ brokerIP1ï¼Œæ”¹ä¸ºæ‚¨æœåŠ¡å™¨çš„IPåœ°å€ï¼ï¼ï¼ï¼è¯·æ³¨æ„ä¿®æ”¹ namesrvAddrï¼Œæ”¹ä¸ºæ‚¨n ameserver çš„IPåœ°å€ï¼ï¼ï¼ï¼</p></blockquote><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="hljs-comment"># contributor license agreements.  See the NOTICE file distributed with</span><br><span class="hljs-comment"># this work for additional information regarding copyright ownership.</span><br><span class="hljs-comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="hljs-comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="hljs-comment"># the License.  You may obtain a copy of the License at</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#     http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#  Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment">#  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment">#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment">#  See the License for the specific language governing permissions and</span><br><span class="hljs-comment">#  limitations under the License.</span><br><br><br><span class="hljs-comment"># æ‰€å±é›†ç¾¤åå­—</span><br><span class="hljs-attr">brokerClusterName</span>=DefaultCluster<br><span class="hljs-comment"># broker åå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·ï¼Œå¦‚æœåœ¨ broker-a.properties ä½¿ç”¨: broker-a,</span><br><span class="hljs-comment"># åœ¨ broker-b.properties ä½¿ç”¨: broker-b</span><br><span class="hljs-attr">brokerName</span>=broker-a<br><span class="hljs-comment"># 0 è¡¨ç¤º Masterï¼Œ&gt; 0 è¡¨ç¤º Slave</span><br><span class="hljs-attr">brokerId</span>=<span class="hljs-number">0</span><br><span class="hljs-comment"># nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²</span><br><span class="hljs-attr">namesrvAddr</span>=rmqserver01:<span class="hljs-number">9876</span><br><span class="hljs-comment"># å¯åŠ¨IP,å¦‚æœ docker æŠ¥ com.alibaba.rocketmq.remoting.exception.RemotingConnectException: connect to &lt;192.168.0.120:10909&gt; failed</span><br><span class="hljs-comment"># è§£å†³æ–¹å¼1 åŠ ä¸Šä¸€å¥ producer.setVipChannelEnabled(false);ï¼Œè§£å†³æ–¹å¼2 brokerIP1 è®¾ç½®å®¿ä¸»æœºIPï¼Œä¸è¦ä½¿ç”¨docker å†…éƒ¨IP</span><br><span class="hljs-comment">#producer.setVipChannelEnabled=false</span><br><span class="hljs-attr">brokerIP1</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">101.220</span><br><br><span class="hljs-comment"># åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°</span><br><span class="hljs-attr">defaultTopicQueueNums</span>=<span class="hljs-number">4</span><br><span class="hljs-comment"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»º Topicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­ ï¼ï¼ï¼è¿™é‡Œä»”ç»†çœ‹æ˜¯ falseï¼Œfalseï¼Œfalse</span><br><span class="hljs-attr">autoCreateTopicEnable</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment"># æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="hljs-attr">autoCreateSubscriptionGroup</span>=<span class="hljs-literal">true</span><br><span class="hljs-comment"># Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£</span><br><span class="hljs-attr">listenPort</span>=<span class="hljs-number">10911</span><br><span class="hljs-comment"># åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨4ç‚¹</span><br><span class="hljs-attr">deleteWhen</span>=<span class="hljs-number">04</span><br><span class="hljs-comment"># æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤48å°æ—¶</span><br><span class="hljs-attr">fileReservedTime</span>=<span class="hljs-number">120</span><br><span class="hljs-comment"># commitLog æ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G</span><br><span class="hljs-attr">mapedFileSizeCommitLog</span>=<span class="hljs-number">1073741824</span><br><span class="hljs-comment"># ConsumeQueue æ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜ 30W æ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´</span><br><span class="hljs-attr">mapedFileSizeConsumeQueue</span>=<span class="hljs-number">300000</span><br><span class="hljs-comment"># destroyMapedFileIntervalForcibly=120000</span><br><span class="hljs-comment"># redeleteHangedFileInterval=120000</span><br><span class="hljs-comment"># æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´</span><br><span class="hljs-attr">diskMaxUsedSpaceRatio</span>=<span class="hljs-number">88</span><br><span class="hljs-comment"># å­˜å‚¨è·¯å¾„</span><br><span class="hljs-comment"># storePathRootDir=/home/ztztdata/rocketmq-all-4.1.0-incubating/store</span><br><span class="hljs-comment"># commitLog å­˜å‚¨è·¯å¾„</span><br><span class="hljs-comment"># storePathCommitLog=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/commitlog</span><br><span class="hljs-comment"># æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨</span><br><span class="hljs-comment"># storePathConsumeQueue=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/consumequeue</span><br><span class="hljs-comment"># æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„</span><br><span class="hljs-comment"># storePathIndex=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/index</span><br><span class="hljs-comment"># checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="hljs-comment"># storeCheckpoint=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/checkpoint</span><br><span class="hljs-comment"># abort æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="hljs-comment"># abortFile=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/abort</span><br><span class="hljs-comment"># é™åˆ¶çš„æ¶ˆæ¯å¤§å°</span><br><span class="hljs-attr">maxMessageSize</span>=<span class="hljs-number">65536</span><br><span class="hljs-comment"># flushCommitLogLeastPages=4</span><br><span class="hljs-comment"># flushConsumeQueueLeastPages=2</span><br><span class="hljs-comment"># flushCommitLogThoroughInterval=10000</span><br><span class="hljs-comment"># flushConsumeQueueThoroughInterval=60000</span><br><span class="hljs-comment"># Broker çš„è§’è‰²</span><br><span class="hljs-comment"># - ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="hljs-comment"># - SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="hljs-comment"># - SLAVE</span><br><span class="hljs-attr">brokerRole</span>=ASYNC_MASTER<br><span class="hljs-comment"># åˆ·ç›˜æ–¹å¼</span><br><span class="hljs-comment"># - ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="hljs-comment"># - SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br><span class="hljs-attr">flushDiskType</span>=ASYNC_FLUSH<br><span class="hljs-comment"># å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="hljs-comment"># sendMessageThreadPoolNums=128</span><br><span class="hljs-comment"># æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="hljs-comment"># pullMessageThreadPoolNums=128</span><br></code></pre></td></tr></table></figure><p>åˆšåˆšæˆ‘ä»¬å·²ç»åˆ›å»ºäº†<strong>broker</strong>çš„æŒ‚è½½ç›®å½•å’Œé…ç½®æ–‡ä»¶ï¼Œæ­¤æ—¶å‡†å¤‡å·¥ä½œå°±å·²ç»å®Œæˆï¼Œå¯ä»¥æ‰§è¡Œä¸€ä¸‹å‘½ä»¤å¯åŠ¨<strong>broker</strong>å®¹å™¨ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">docker <span class="hljs-keyword">run</span><span class="language-bash"> -d --restart=always --name rmqbroker01  --<span class="hljs-built_in">link</span> rmqnamesrv:namesrv -p 10911:10911 -p 10909:10909  -v /data/broker/logs:/root/logs -v /data/broker/store:/root/store  -v  /data/broker/conf/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf  -e <span class="hljs-string">&quot;NAMESRV_ADDR=192.168.56.105:9876&quot;</span>  -e <span class="hljs-string">&quot;MAX_POSSIBLE_HEAP=200000000&quot;</span>  rocketmqinc/rocketmq sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf </span><br></code></pre></td></tr></table></figure><ul><li>-e â€œNAMESRV_ADDR&#x3D;namesrv:9876â€ æŒ‡å®šnamesrvçš„åœ°å€ä¸ºæœ¬æœºnamesrvçš„ipåœ°å€:9876</li></ul><h4 id="rocketmq-consoleå¯è§†åŒ–ç•Œé¢"><a href="#rocketmq-consoleå¯è§†åŒ–ç•Œé¢" class="headerlink" title="rocketmq-consoleå¯è§†åŒ–ç•Œé¢"></a>rocketmq-consoleå¯è§†åŒ–ç•Œé¢</h4><p>è¿›è¡Œæ‹‰å–æ“ä½œ</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#æ‹‰å–æ“ä½œ</span><br>docker pull pangliang/rocketmq-console-ng<br><br><span class="hljs-comment">#æ„å»ºå¹¶å¯åŠ¨</span><br><br>docker <span class="hljs-built_in">run</span> -d <span class="hljs-attribute">--restart</span>=always --name rmqadmin -e <span class="hljs-string">&quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.56.105:9876 -Dcom.rocketmqsendMessageWithVIPChannel=false   -Duser.timezone=&#x27;Asia/Shanghai&#x27;&quot;</span> -v /etc/localtime:/etc/localtime  -p 9999:8080  pangliang/rocketmq-console-ng<br><br>docker <span class="hljs-built_in">run</span> -d <span class="hljs-attribute">--restart</span>=always --name rmqadmin -e <span class="hljs-string">&quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.56.105:9876 -Dcom.rocketmqsendMessageWithVIPChannel=false&quot;</span>  -p 9999:8080  pangliang/rocketmq-console-ng<br><br></code></pre></td></tr></table></figure><p>ğŸ‘† å°†ä¿¡æ¯Drocketmq.namesrv.addråé¢çš„IPåœ°å€æ”¹ä¸ºæ‚¨çš„nameserver IPåœ°å€ï¼ï¼ï¼Drocketmq.namesrv.addråé¢çš„IPåœ°å€æ”¹ä¸ºæ‚¨çš„nameserver IPåœ°å€ï¼ï¼ï¼</p><p><strong>é€šè¿‡è®¿é—®9999ç«¯å£æŸ¥çœ‹rocketmq-consoleæ˜¯å¦å¯åŠ¨æˆåŠŸ</strong></p><p>è¿æ¥æœ‰ç‚¹é—®é¢˜</p><p>ä¸»è¦çš„æ§åˆ¶å°æŠ¥é”™æ—¥å¿—</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml">[<span class="hljs-number">2024-04-18 22:16:21.035</span>] <span class="hljs-string">ERROR</span> <span class="hljs-string">op=global_exception_handler_print_error</span><br><span class="hljs-attr">org.apache.rocketmq.console.exception.ServiceException:</span> <span class="hljs-string">This</span> <span class="hljs-string">date</span> <span class="hljs-string">have&#x27;t</span> <span class="hljs-string">data!</span><br>[<span class="hljs-number">2024-04-18 22:16:31.707</span>]  <span class="hljs-attr">INFO closeChannel:</span> <span class="hljs-string">close</span> <span class="hljs-string">the</span> <span class="hljs-string">connection</span> <span class="hljs-string">to</span> <span class="hljs-string">remote</span> <span class="hljs-string">address[]</span> <span class="hljs-attr">result:</span> <span class="hljs-literal">true</span><br>[<span class="hljs-number">2024-04-18 22:16:31.724</span>] <span class="hljs-string">ERROR</span> <span class="hljs-string">Unexpected</span> <span class="hljs-string">error</span> <span class="hljs-string">occurred</span> <span class="hljs-string">in</span> <span class="hljs-string">scheduled</span> <span class="hljs-string">task.</span><br><span class="hljs-attr">java.lang.RuntimeException: org.apache.rocketmq.remoting.exception.RemotingConnectException:</span> <span class="hljs-string">connect</span> <span class="hljs-string">to</span> <span class="hljs-string">&lt;null&gt;</span> <span class="hljs-string">failed</span><br><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ª <code>This date have&#39;t data!</code>  æ”¹ä¸€ä¸‹æœåŠ¡å™¨æ—¥æœŸ</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># æŸ¥çœ‹æ—¥æœŸ</span><br><span class="hljs-built_in">date</span><br><span class="hljs-comment"># æ—¶é—´åŒæ­¥ï¼š</span><br>$ yum install ntpdate -y<br>$ ntpdate <span class="hljs-built_in">time</span>.windows.com<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªæŠ¥é”™å‚è€ƒè¿™ä¸ªï¼š <a href="https://blog.csdn.net/bwp3830201/article/details/125682825">https://blog.csdn.net/bwp3830201/article/details/125682825</a> ï¼ˆé˜¿é‡Œäº‘æœåŠ¡æœ¬èº«å®‰å…¨ç­–ç•¥é—®é¢˜ï¼‰</p><p>è¿™é‡Œå®é™…æ“ä½œæ˜¯å°†è™šæ‹Ÿæœºçš„é˜²ç«å¢™å…³é—­äº†ï¼Œå¹¶è¿›è¡Œäº†é‡å¯æ“ä½œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">å…³é—­é˜²ç«å¢™ï¼š<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">systemctl stop firewalld</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">systemctl <span class="hljs-built_in">disable</span> firewalld</span><br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/xianren95/article/details/121924194">https://blog.csdn.net/xianren95/article/details/121924194</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java8æ–°ç‰¹æ€§</title>
    <link href="/2023/12/20/Java8%E6%96%B0%E7%89%B9%E6%80%A7/"/>
    <url>/2023/12/20/Java8%E6%96%B0%E7%89%B9%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<ul><li>æ¥å£ä¸­é»˜è®¤æ–¹æ³•ä¸é™æ€æ–¹æ³•</li><li>å‡½æ•°å¼æ¥å£ï¼ˆFunctional Interfaceï¼‰</li><li>Lambdaè¡¨è¾¾å¼ï¼ˆLambda Expressionsï¼‰</li><li>æµAPIï¼ˆStreams APIï¼‰</li><li>Optional ç±»</li><li>æ–°çš„æ—¥æœŸæ—¶é—´APIï¼ˆNew Date-Time APIï¼‰</li></ul><h3 id="1ã€æ¥å£ä¸­é»˜è®¤æ–¹æ³•ä¸é™æ€æ–¹æ³•"><a href="#1ã€æ¥å£ä¸­é»˜è®¤æ–¹æ³•ä¸é™æ€æ–¹æ³•" class="headerlink" title="1ã€æ¥å£ä¸­é»˜è®¤æ–¹æ³•ä¸é™æ€æ–¹æ³•"></a>1ã€æ¥å£ä¸­é»˜è®¤æ–¹æ³•ä¸é™æ€æ–¹æ³•</h3><p>åœ¨Java 8ä¹‹å‰ï¼Œæ¥å£åªèƒ½æœ‰æ–¹æ³•å£°æ˜ï¼Œè€Œä¸èƒ½æœ‰æ–¹æ³•å®ç°ã€‚è¿™æ„å‘³ç€ä¸€æ—¦æ¥å£è¢«æ›´æ”¹ï¼ˆæ¯”å¦‚æ·»åŠ æ–°æ–¹æ³•ï¼‰ï¼Œæ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»éƒ½å¿…é¡»éšä¹‹ä¿®æ”¹ä»¥å®ç°æ–°æ·»åŠ çš„æ–¹æ³•ã€‚</p><p>Java 8å¼•å…¥çš„<code>default</code>å’Œ<code>static</code>æ–¹æ³•æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><blockquote><p><code>default</code> æ–¹æ³•</p></blockquote><ul><li><p><strong>ä½œç”¨</strong>: <code>default</code>æ–¹æ³•å…è®¸æˆ‘ä»¬åœ¨æ¥å£ä¸­æ·»åŠ æœ‰å…·ä½“å®ç°çš„éæŠ½è±¡æ–¹æ³•ã€‚è¿™æ„å‘³ç€å®ç°æ¥å£çš„ç±»å¯ä»¥ä¸ç”¨å®ç°è¿™äº›<code>default</code>æ–¹æ³•ã€‚</p></li><li><p><strong>ç”¨é€”</strong>: è¿™å¯¹äºå‘ç°æœ‰æ¥å£æ·»åŠ æ–°åŠŸèƒ½éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒä¸ä¼šç ´åå®ç°è¯¥æ¥å£çš„ç°æœ‰ç±»çš„åŠŸèƒ½ã€‚</p></li><li><p><strong>ç±»æ¯”</strong>: æƒ³è±¡ä¸€ä¸‹ï¼Œæœ‰ä¸€ä¸ªæ ‡å‡†çš„å»ºç­‘è“å›¾ï¼ˆæ¥å£ï¼‰ã€‚çªç„¶ï¼Œéœ€è¦åœ¨æ‰€æœ‰è¿™æ ·çš„å»ºç­‘ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼ˆæ¯”å¦‚ä¸­å¤®ä¾›æš–ï¼‰ã€‚<code>default</code>æ–¹æ³•å°±åƒæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ä¸­å¤®ä¾›æš–ç³»ç»Ÿè®¾è®¡ï¼Œå¯ä»¥ç›´æ¥åŠ å…¥åˆ°ç°æœ‰çš„è“å›¾ä¸­ï¼Œè€Œä¸éœ€è¦é‡æ–°è®¾è®¡æ•´ä¸ªå»ºç­‘ã€‚</p></li></ul><blockquote><p><code>static</code> æ–¹æ³•</p></blockquote><ul><li><p><strong>ä½œç”¨</strong>: <code>static</code>æ–¹æ³•å…è®¸æˆ‘ä»¬åœ¨æ¥å£ä¸­æ·»åŠ é™æ€æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å¯ä»¥ç›´æ¥é€šè¿‡æ¥å£æ¥è°ƒç”¨ï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªæ¥å£çš„å®ä¾‹ã€‚</p></li><li><p><strong>ç”¨é€”</strong>: <code>static</code>æ–¹æ³•é€šå¸¸ç”¨äºæä¾›ä¸€äº›ä¸æ¥å£ç›¸å…³çš„å·¥å…·æ–¹æ³•ã€‚</p></li><li><p><strong>ç±»æ¯”</strong>: å¦‚æœæ¥å£æ˜¯ä¸€ç§æœåŠ¡çš„æ ‡å‡†ï¼ˆæ¯”å¦‚é‚®å¯„æœåŠ¡ï¼‰ï¼Œé‚£ä¹ˆ<code>static</code>æ–¹æ³•å°±åƒæ˜¯å¯ä»¥ç›´æ¥ä»æœåŠ¡æ ‡å‡†æœ¬èº«è·å¾—çš„é¢å¤–å¸®åŠ©æˆ–å·¥å…·ï¼Œå¦‚ä¸€ä¸ªåœ¨çº¿é‚®èµ„è®¡ç®—å™¨ã€‚</p></li></ul><p>å…·ä½“ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-title class_"><span class="hljs-keyword">interface</span> <span class="hljs-title">MyInterface</span> </span>&#123;<br>    <span class="hljs-comment">// ä¸€ä¸ªé»˜è®¤æ–¹æ³•</span><br>    <span class="hljs-keyword">default</span> void <span class="hljs-keyword">new</span><span class="hljs-type">Method</span>() &#123;<br>        System.out.println(<span class="hljs-string">&quot;This is a default method&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// ä¸€ä¸ªé™æ€æ–¹æ³•</span><br>    <span class="hljs-keyword">static</span> void anotherNewMethod() &#123;<br>        System.out.println(<span class="hljs-string">&quot;This is a static method&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å®ç°æ¥å£çš„ç±»</span><br><span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">MyInterface</span></span> </span>&#123;<br>    <span class="hljs-comment">// ä¸éœ€è¦å®ç°newMethod()</span><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) &#123;<br>        MyClass myClass = <span class="hljs-keyword">new</span> <span class="hljs-type">MyClass</span>();<br>        myClass.<span class="hljs-keyword">new</span><span class="hljs-type">Method</span>(); <span class="hljs-comment">// è°ƒç”¨é»˜è®¤æ–¹æ³•</span><br><br>        MyInterface.anotherNewMethod(); <span class="hljs-comment">// ç›´æ¥è°ƒç”¨æ¥å£çš„é™æ€æ–¹æ³•</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyClass</code>å®ç°äº†<code>MyInterface</code>ä½†æ²¡æœ‰å®ç°<code>newMethod()</code>æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªé»˜è®¤æ–¹æ³•ã€‚</p><p>åŒæ—¶ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡<code>MyInterface</code>è°ƒç”¨é™æ€æ–¹æ³•<code>anotherNewMethod()</code>ã€‚</p><hr><p>æœ‰ä¸€ç§æƒ…å†µéœ€è¦é‡å†™ default çš„æ¥å£æ–¹æ³•ï¼Œæ³¨æ„ä¸€ä¸‹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">InterfaceNew</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sm</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;interfaceæä¾›çš„æ–¹å¼å®ç°&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sm2</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;interfaceæä¾›çš„æ–¹å¼å®ç°&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-literal">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title">def</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;interface defaultæ–¹æ³•&quot;</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-literal">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title">def2</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;interface default2æ–¹æ³•&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//é¡»è¦å®ç°ç±»é‡å†™</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">f</span>()</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">InterfaceNew1</span> &#123;<br>    <span class="hljs-function"><span class="hljs-literal">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title">def</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;InterfaceNew1 defaultæ–¹æ³•&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæœ‰ä¸€ä¸ªç±»æ—¢å®ç°äº† <code>InterfaceNew</code> æ¥å£åˆå®ç°äº† <code>InterfaceNew1</code>æ¥å£ï¼Œå®ƒä»¬éƒ½æœ‰<code>def()</code>ï¼Œå¹¶ä¸” <code>InterfaceNew</code> æ¥å£å’Œ <code>InterfaceNew1</code>æ¥å£æ²¡æœ‰ç»§æ‰¿å…³ç³»çš„è¯ï¼Œè¿™æ—¶å°±å¿…é¡»é‡å†™<code>def()</code>ã€‚</p><p>ä¸ç„¶çš„è¯ï¼Œç¼–è¯‘çš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InterfaceNewImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InterfaceNew</span> , <span class="hljs-title class_">InterfaceNew1</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>        <span class="hljs-title class_">InterfaceNewImpl</span> interfaceNew = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterfaceNewImpl</span>();<br>        interfaceNew.<span class="hljs-title function_">def</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">def</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-title class_">InterfaceNew1</span>.<span class="hljs-property">super</span>.<span class="hljs-title function_">def</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"></span>) &#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><blockquote><p>Java8ä¸­ï¼Œæ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«</p></blockquote><ul><li>interface å’Œ class çš„åŒºåˆ«ï¼Œä¸»è¦æœ‰ï¼š<ul><li>æ¥å£å¤šå®ç°ï¼Œç±»å•ç»§æ‰¿</li><li>æ¥å£çš„æ–¹æ³•æ˜¯ public abstract ä¿®é¥°ï¼Œå˜é‡æ˜¯ public static final ä¿®é¥°ã€‚ abstract class å¯ä»¥ç”¨å…¶ä»–ä¿®é¥°ç¬¦</li></ul></li><li>interface çš„æ–¹æ³•æ˜¯<strong>æ›´åƒæ˜¯ä¸€ä¸ªæ‰©å±•æ’ä»¶</strong>ã€‚è€Œ abstract class çš„æ–¹æ³•æ˜¯è¦ç»§æ‰¿çš„ã€‚</li></ul><p>interface æ–°å¢<code>default</code>å’Œ<code>static</code>ä¿®é¥°çš„æ–¹æ³•ï¼Œä¸ºäº†è§£å†³æ¥å£çš„ä¿®æ”¹ä¸ç°æœ‰çš„å®ç°ä¸å…¼å®¹çš„é—®é¢˜ï¼Œå¹¶ä¸æ˜¯ä¸ºäº†è¦æ›¿ä»£<code>abstract class</code>ã€‚</p><h3 id="2ã€å‡½æ•°å¼æ¥å£ï¼ˆFunctional-Interfaceï¼‰"><a href="#2ã€å‡½æ•°å¼æ¥å£ï¼ˆFunctional-Interfaceï¼‰" class="headerlink" title="2ã€å‡½æ•°å¼æ¥å£ï¼ˆFunctional Interfaceï¼‰"></a>2ã€å‡½æ•°å¼æ¥å£ï¼ˆFunctional Interfaceï¼‰</h3><p>å‡½æ•°å¼æ¥å£ï¼ˆFunctional Interfaceï¼‰æ˜¯Java 8å¼•å…¥çš„ä¸€ä¸ª<strong>é‡è¦æ¦‚å¿µ</strong>ï¼Œå®ƒæ˜¯Javaå¯¹å‡½æ•°å¼ç¼–ç¨‹æ”¯æŒçš„ä¸€éƒ¨åˆ†ã€‚</p><blockquote><p>å®šä¹‰</p></blockquote><p>å‡½æ•°å¼æ¥å£<strong>æ˜¯åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£</strong>ã€‚å°½ç®¡æ¥å£å¯ä»¥åŒ…å«å¤šä¸ªé»˜è®¤æ–¹æ³•ã€é™æ€æ–¹æ³•ï¼Œ<strong>ä½†åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</strong>ã€‚è¿™ç§æ¥å£çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ä¸Lambdaè¡¨è¾¾å¼ç»“åˆä½¿ç”¨ã€‚</p><blockquote><p><code>@FunctionalInterface</code> æ³¨è§£</p></blockquote><p>è™½ç„¶ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†é€šå¸¸ä¼šä½¿ç”¨<code>@FunctionalInterface</code>æ³¨è§£æ¥æ ‡è®°å‡½æ•°å¼æ¥å£ã€‚è¿™ä¸ªæ³¨è§£æœ‰åŠ©äºç¼–è¯‘å™¨è¯†åˆ«æ„å›¾ï¼Œå¹¶åœ¨æ¥å£ä¸æ˜¯æœ‰æ•ˆçš„å‡½æ•°å¼æ¥å£æ—¶ç”Ÿæˆç¼–è¯‘æ—¶é”™è¯¯ã€‚</p><blockquote><p>å‡½æ•°å¼æ¥å£ç¤ºä¾‹ï¼š</p></blockquote><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-title class_"><span class="hljs-keyword">interface</span> <span class="hljs-title">Greeting</span> </span>&#123;<br>    <span class="hljs-keyword">String</span> sayHello(<span class="hljs-keyword">String</span> name);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ª<code>Greeting</code>æ¥å£å®šä¹‰äº†ä¸€ä¸ªæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°å¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚</p><p>ç”±äºå®ƒåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚</p><blockquote><p>ä½¿ç”¨åœºæ™¯</p></blockquote><p>å‡½æ•°å¼æ¥å£åœ¨Java 8ä¸­å¼•å…¥Lambdaè¡¨è¾¾å¼æ—¶å˜å¾—éå¸¸é‡è¦ã€‚Lambdaè¡¨è¾¾å¼æä¾›äº†ä¸€ç§ç®€æ´çš„æ–¹å¼æ¥å®ç°å‡½æ•°å¼æ¥å£ï¼Œä»è€Œä½¿ä»£ç æ›´ç®€æ´ã€æ›´æ˜“è¯»ã€‚</p><p>å¯ä»¥å°†å‡½æ•°å¼æ¥å£æƒ³è±¡æˆä¸€ç§ç‰¹æ®Šçš„å·¥å…·å¥—ä»¶ã€‚è¿™ä¸ªå¥—ä»¶é‡Œåªæœ‰ä¸€ä¸ªå·¥å…·æ§½ï¼ˆæŠ½è±¡æ–¹æ³•ï¼‰ï¼Œä½†ä½ å¯ä»¥ä»¥å¤šç§æ–¹å¼ï¼ˆLambdaè¡¨è¾¾å¼ã€æ–¹æ³•å¼•ç”¨ï¼‰å¡«å……è¿™ä¸ªæ§½ã€‚è¿™å°±åƒæ˜¯ä¸€ä¸ªå¯å®šåˆ¶çš„å·¥å…·ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦æ’å…¥ä¸åŒçš„åŠŸèƒ½ã€‚</p><p>å‡½æ•°å¼æ¥å£åœ¨Javaä¸­çš„å¾ˆå¤šåœ°æ–¹éƒ½æœ‰ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</p><ul><li>åœ¨<code>java.util.function</code>åŒ…ä¸­ï¼ŒJava 8å¼•å…¥äº†ä¸€ç³»åˆ—æ ‡å‡†çš„å‡½æ•°å¼æ¥å£ï¼Œå¦‚<code>Predicate&lt;T&gt;</code>ã€<code>Function&lt;T,R&gt;</code>ã€<code>Consumer&lt;T&gt;</code>ç­‰ã€‚</li><li>åœ¨é›†åˆæ¡†æ¶ä¸­ï¼Œå®ƒä»¬è¢«ç”¨äºç®€åŒ–è¿­ä»£ã€è¿‡æ»¤å’Œè½¬æ¢æ“ä½œã€‚</li><li>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œä¾‹å¦‚ä½¿ç”¨<code>Runnable</code>æˆ–<code>Callable</code>æ¥å£ã€‚</li></ul><h3 id="3ã€Lambda-è¡¨è¾¾å¼"><a href="#3ã€Lambda-è¡¨è¾¾å¼" class="headerlink" title="3ã€Lambda è¡¨è¾¾å¼"></a>3ã€Lambda è¡¨è¾¾å¼</h3><p>Lambdaè¡¨è¾¾å¼æ˜¯Java 8ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æ–°ç‰¹æ€§ï¼Œå®ƒä¸ºJavaå¸¦æ¥äº†ä¸€ç§ç®€æ´çš„æ–¹å¼æ¥è¡¨ç¤ºå‡½æ•°å¼æ¥å£çš„å®ä¾‹ã€‚</p><p>Lambdaè¡¨è¾¾å¼ä¸»è¦ç”¨äºæä¾›ä¸€ç§ç®€æ´ã€è¡¨è¾¾å¼é£æ ¼çš„æ–¹æ³•æ¥è¡¨ç¤ºå¯ä»¥ä¼ é€’çš„åŒ¿åå‡½æ•°ã€‚è¿™ç§è¡¨è¾¾æ–¹å¼éå¸¸é€‚åˆåˆ›å»ºç®€çŸ­çš„ã€åªä½¿ç”¨ä¸€æ¬¡çš„æ–¹æ³•ç‰ˆæœ¬ã€‚</p><h4 id="è¯­æ³•æ ¼å¼"><a href="#è¯­æ³•æ ¼å¼" class="headerlink" title="è¯­æ³•æ ¼å¼"></a>è¯­æ³•æ ¼å¼</h4><blockquote><p>è¯­æ³•æ ¼å¼</p></blockquote><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-function"><span class="hljs-params">(parameters)</span> -&gt;</span> expression æˆ–<br><span class="hljs-function"><span class="hljs-params">(parameters)</span> -&gt;</span>&#123; statements; &#125;<br></code></pre></td></tr></table></figure><ul><li>parameters<ul><li>ä¸æ–¹æ³•å®šä¹‰ä¸­çš„å‚æ•°åˆ—è¡¨ç±»ä¼¼ã€‚å¯¹äºå•ä¸ªå‚æ•°ï¼Œå¯ä»¥çœç•¥æ‹¬å·</li></ul></li><li><code>-&gt;</code><ul><li>Lambdaè¡¨è¾¾å¼çš„æ ¸å¿ƒï¼Œç”¨äºåˆ†éš”å‚æ•°åˆ—è¡¨å’ŒLambdaä½“</li></ul></li><li><strong>Lambdaä½“</strong><ul><li>å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼æˆ–ä¸€ä¸ªä»£ç å—ã€‚è¡¨è¾¾å¼ä½“ä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œè€Œä»£ç å—å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªè¯­å¥ã€‚</li></ul></li></ul><h4 id="ç®€æ˜“ç¤ºä¾‹"><a href="#ç®€æ˜“ç¤ºä¾‹" class="headerlink" title="ç®€æ˜“ç¤ºä¾‹"></a>ç®€æ˜“ç¤ºä¾‹</h4><blockquote><p>ä½¿ç”¨ç¤ºä¾‹</p></blockquote><p>Lambdaè¡¨è¾¾å¼é€šå¸¸ä¸å‡½æ•°å¼æ¥å£ä¸€èµ·ä½¿ç”¨ã€‚å‡½æ•°å¼æ¥å£æ˜¯åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œè¿™æ„å‘³ç€Lambdaè¡¨è¾¾å¼å¯ä»¥ä¸ºè¯¥æŠ½è±¡æ–¹æ³•æä¾›å®ç°ã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„å‡½æ•°å¼æ¥å£ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">StringOperation</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getLength</span><span class="hljs-params">(String s)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è¿™æ ·å®ç°ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">StringOperation operation = <span class="hljs-keyword">new</span> StringOperation() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getLength</span><span class="hljs-params">(String s)</span> </span>&#123;<br>        <span class="hljs-function"><span class="hljs-keyword">return</span> s.<span class="hljs-title">length</span><span class="hljs-params">()</span></span>;<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç®€åŒ–ï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">StringOperation operation <span class="hljs-operator">=</span> s -&gt; s.length()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h4 id="æ›¿ä»£åŒ¿åå†…éƒ¨ç±»"><a href="#æ›¿ä»£åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="æ›¿ä»£åŒ¿åå†…éƒ¨ç±»"></a>æ›¿ä»£åŒ¿åå†…éƒ¨ç±»</h4><p>å¹³æ—¶å¼€å‘ç»å¸¸ä¼šç”¨åˆ° Runnable æ¥å£ã€Comparator æ¥å£ã€Listener æ¥å£ è¿™ä¸‰ä¸ªæ¥å£ï¼Œä¸‹é¢åˆ†åˆ«å°±çœ‹ä¸€ä¸‹ä»–ä»¬çš„ä½¿ç”¨ç¤ºä¾‹ã€‚</p><blockquote><p>Runnable æ¥å£</p></blockquote><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">new</span> Thread(<span class="hljs-built_in">new</span> Runnable() &#123;<br>            @Override<br>            <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> run() &#123;<br>                <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;The runable now is using!&quot;);<br>            &#125;<br>&#125;).<span class="hljs-keyword">start</span>();<br>//ç”¨lambda<br><span class="hljs-built_in">new</span> Thread(() -&gt; <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(&quot;It&#x27;s a lambda function!&quot;)).<span class="hljs-keyword">start</span>();<br></code></pre></td></tr></table></figure><blockquote><p>Comparator æ¥å£</p></blockquote><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">List&lt;<span class="hljs-type">Integer</span>&gt; strings = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br><br>Collections.sort(strings, <span class="hljs-built_in">new</span> Comparator&lt;<span class="hljs-type">Integer</span>&gt;() &#123;<br>@Override<br><span class="hljs-built_in">public</span> <span class="hljs-type">int</span> compare(<span class="hljs-type">Integer</span> o1, <span class="hljs-type">Integer</span> o2) &#123;<br>    <span class="hljs-keyword">return</span> o1 - o2;&#125;<br>&#125;);<br><br>//Lambda<br>Collections.sort(strings, (<span class="hljs-type">Integer</span> o1, <span class="hljs-type">Integer</span> o2) -&gt; o1 - o2);<br>//åˆ†è§£å¼€<br>Comparator&lt;<span class="hljs-type">Integer</span>&gt; comparator = (<span class="hljs-type">Integer</span> o1, <span class="hljs-type">Integer</span> o2) -&gt; o1 - o2;<br>Collections.sort(strings, comparator);<br></code></pre></td></tr></table></figure><blockquote><p>Listener æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">JButton</span> <span class="hljs-variable">button</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JButton</span>();<br>button.addItemListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ItemListener</span>() &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">itemStateChanged</span><span class="hljs-params">(ItemEvent e)</span> &#123;<br>   e.getItem();<br>&#125;<br>&#125;);<br><span class="hljs-comment">//lambda</span><br>button.addItemListener(e -&gt; e.getItem());<br></code></pre></td></tr></table></figure><h4 id="é›†åˆä¸Šä½¿ç”¨"><a href="#é›†åˆä¸Šä½¿ç”¨" class="headerlink" title="é›†åˆä¸Šä½¿ç”¨"></a>é›†åˆä¸Šä½¿ç”¨</h4><blockquote><p>åœ¨é›†åˆä¸Šçš„åº”ç”¨</p></blockquote><p>Lambdaè¡¨è¾¾å¼ç‰¹åˆ«é€‚åˆç”¨åœ¨é›†åˆçš„æ“ä½œä¸Šï¼Œæ¯”å¦‚<code>forEach</code>ã€<code>map</code>ã€<code>filter</code>ç­‰æ–¹æ³•ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">List&lt;String&gt; list = Arrays.asList(&quot;Java&quot;, &quot;Python&quot;, &quot;C++&quot;);<br><br>// ä½¿ç”¨Lambdaè¡¨è¾¾å¼è¿­ä»£<br>list.<span class="hljs-keyword">forEach</span>(element -&gt; <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(element));<br><br>// ä½¿ç”¨Lambdaè¡¨è¾¾å¼å’ŒStream APIè¿›è¡Œè¿‡æ»¤<br>list.stream()<br>    .<span class="hljs-keyword">filter</span>(s -&gt; s.startsWith(&quot;J&quot;))<br>    .<span class="hljs-keyword">forEach</span>(<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>::println);<br><br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-type">void</span> lamndaFor() &#123;<br>        List&lt;String&gt; strings = Arrays.asList(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;);<br>        //ä¼ ç»Ÿ<span class="hljs-keyword">foreach</span><br>        <span class="hljs-keyword">for</span> (String s : strings) &#123;<br>            <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(s);<br>        &#125;<br>        //Lambda <span class="hljs-keyword">foreach</span><br>        strings.<span class="hljs-keyword">forEach</span>((s) -&gt; <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(s));<br>        //<span class="hljs-keyword">or</span><br>        strings.<span class="hljs-keyword">forEach</span>(<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>::println);<br> //map<br>        Map&lt;<span class="hljs-type">Integer</span>, String&gt; map = <span class="hljs-built_in">new</span> HashMap&lt;&gt;();<br>        map.<span class="hljs-keyword">forEach</span>((k,v)-&gt;<span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(v));<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•çš„å¼•ç”¨"><a href="#æ–¹æ³•çš„å¼•ç”¨" class="headerlink" title="æ–¹æ³•çš„å¼•ç”¨"></a>æ–¹æ³•çš„å¼•ç”¨</h4><p>Java 8 å…è®¸ä½¿ç”¨Â <code>::</code>Â å…³é”®å­—æ¥ä¼ é€’æ–¹æ³•æˆ–è€…æ„é€ å‡½æ•°å¼•ç”¨ï¼Œæ— è®ºå¦‚ä½•ï¼Œè¡¨è¾¾å¼è¿”å›çš„ç±»å‹å¿…é¡»æ˜¯ functional-interfaceã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LambdaClassSuper</span> &#123;<br>    LambdaInterface <span class="hljs-title function_">sf</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LambdaClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LambdaClassSuper</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LambdaInterface <span class="hljs-title function_">staticF</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> LambdaInterface <span class="hljs-title function_">f</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//1.è°ƒç”¨é™æ€å‡½æ•°ï¼Œè¿”å›ç±»å‹å¿…é¡»æ˜¯functional-interface</span><br>        <span class="hljs-type">LambdaInterface</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> LambdaClass::staticF;<br><br>        <span class="hljs-comment">//2.å®ä¾‹æ–¹æ³•è°ƒç”¨</span><br>        <span class="hljs-type">LambdaClass</span> <span class="hljs-variable">lambdaClass</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaClass</span>();<br>        <span class="hljs-type">LambdaInterface</span> <span class="hljs-variable">lambdaInterface</span> <span class="hljs-operator">=</span> lambdaClass::f;<br><br>        <span class="hljs-comment">//3.è¶…ç±»ä¸Šçš„æ–¹æ³•è°ƒç”¨</span><br>        <span class="hljs-type">LambdaInterface</span> <span class="hljs-variable">superf</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>::sf;<br><br>        <span class="hljs-comment">//4. æ„é€ æ–¹æ³•è°ƒç”¨</span><br>        <span class="hljs-type">LambdaInterface</span> <span class="hljs-variable">tt</span> <span class="hljs-operator">=</span> LambdaClassSuper::<span class="hljs-keyword">new</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®¿é—®å˜é‡</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>;<br>Collections.sort(<span class="hljs-built_in">string</span>s, (Integer o1, Integer o2) -&gt; o1 - i);<br><span class="hljs-comment">//i =3;</span><br></code></pre></td></tr></table></figure><p>lambda è¡¨è¾¾å¼å¯ä»¥å¼•ç”¨å¤–è¾¹å˜é‡ï¼Œä½†æ˜¯è¯¥å˜é‡é»˜è®¤æ‹¥æœ‰ final å±æ€§ï¼Œä¸èƒ½è¢«ä¿®æ”¹ï¼Œå¦‚æœä¿®æ”¹ï¼Œç¼–è¯‘æ—¶å°±æŠ¥é”™ã€‚</p><p>to be continedâ€¦â€¦</p><h3 id="4ã€Stream"><a href="#4ã€Stream" class="headerlink" title="4ã€Stream"></a>4ã€Stream</h3><blockquote><p>Stream æ˜¯ä»€ä¹ˆ</p></blockquote><p>java æ–°å¢äº† <code>java.util.stream</code> åŒ…ï¼Œå®ƒå’Œä¹‹å‰çš„æµå¤§åŒå°å¼‚ã€‚ä¹‹å‰æ¥è§¦æœ€å¤šçš„æ˜¯èµ„æºæµï¼Œæ¯”å¦‚<code>java.io.FileInputStream</code>ï¼Œé€šè¿‡æµæŠŠæ–‡ä»¶ä»ä¸€ä¸ªåœ°æ–¹è¾“å…¥åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œå®ƒåªæ˜¯å†…å®¹æ¬è¿å·¥ï¼Œå¯¹æ–‡ä»¶å†…å®¹ä¸åšä»»ä½• CRUDã€‚</p><p><code>Stream</code>ä¾ç„¶ä¸å­˜å‚¨æ•°æ®ï¼Œä¸åŒçš„æ˜¯å®ƒå¯ä»¥æ£€ç´¢(Retrieve)å’Œé€»è¾‘å¤„ç†é›†åˆæ•°æ®ã€åŒ…æ‹¬ç­›é€‰ã€æ’åºã€ç»Ÿè®¡ã€è®¡æ•°ç­‰ã€‚å¯ä»¥æƒ³è±¡æˆæ˜¯ Sql è¯­å¥ã€‚</p><p>å®ƒçš„æºæ•°æ®å¯ä»¥æ˜¯ <code>Collection</code>ã€<code>Array</code> ç­‰ã€‚ç”±äºå®ƒçš„æ–¹æ³•å‚æ•°éƒ½æ˜¯å‡½æ•°å¼æ¥å£ç±»å‹ï¼Œæ‰€ä»¥ä¸€èˆ¬å’Œ Lambda é…åˆä½¿ç”¨ã€‚</p><blockquote><p>æµç±»å‹</p></blockquote><ol><li>stream ä¸²è¡Œæµ</li><li>parallelStream å¹¶è¡Œæµï¼Œå¯å¤šçº¿ç¨‹æ‰§è¡Œ</li></ol><h4 id="Stream-å¸¸ç”¨æ–¹æ³•"><a href="#Stream-å¸¸ç”¨æ–¹æ³•" class="headerlink" title="Stream å¸¸ç”¨æ–¹æ³•"></a>Stream å¸¸ç”¨æ–¹æ³•</h4><ul><li><code>stream()</code>, <code>parallelStream()</code></li><li><code>filter()</code></li><li><code>findAny()</code> <code>findFirst()</code></li><li><code>sort</code></li><li><code>forEach</code> void</li><li><code>map(), reduce()</code></li><li><code>flatMap()</code> - å°†å¤šä¸ªStreamè¿æ¥æˆä¸€ä¸ªStream</li><li><code>collect(Collectors.toList())</code></li><li><code>distinct</code>, <code>limit</code></li><li><code>count</code></li><li><code>min</code>, <code>max</code>, <code>summaryStatistics</code></li></ul><h3 id="5ã€Optional"><a href="#5ã€Optional" class="headerlink" title="5ã€Optional"></a>5ã€Optional</h3><p>å‚è€ƒï¼š <a href="https://javaguide.cn/java/new-features/java8-common-new-features.html#optional">https://javaguide.cn/java/new-features/java8-common-new-features.html#optional</a></p><p><code>Optional</code>æ˜¯Java 8å¼•å…¥çš„ä¸€ä¸ªå®¹å™¨ç±»ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªå€¼å¯èƒ½å­˜åœ¨æˆ–ä¸å­˜åœ¨ã€‚å®ƒæä¾›äº†ä¸€ç§æ›´ä¼˜é›…çš„æ–¹æ³•æ¥å¤„ç†å¯ç©ºå€¼ï¼Œä»è€Œå‡å°‘<code>NullPointerException</code>çš„é£é™©ã€‚</p><p>to be continedâ€¦</p><h3 id="6ã€Date-Time-API"><a href="#6ã€Date-Time-API" class="headerlink" title="6ã€Date-Time API"></a>6ã€Date-Time API</h3><p>to be continedâ€¦.</p><hr><p>å‚è€ƒ</p><ul><li><a href="http://moxi159753.gitee.io/learningnotes/#/">http://moxi159753.gitee.io/learningnotes/#/</a></li><li><a href="https://www.pdai.tech/md/interview/x-interview.html#_6-1-java-8-%E7%89%B9%E6%80%A7">https://www.pdai.tech/md/interview/x-interview.html#_6-1-java-8-%E7%89%B9%E6%80%A7</a></li><li><a href="https://javaguide.cn/java/new-features/java8-common-new-features.html">https://javaguide.cn/java/new-features/java8-common-new-features.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>JDK8</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootå­¦ä¹ _SpringBoot è‡ªåŠ¨è£…é…åŸç†</title>
    <link href="/2023/12/19/SpringBoot%E5%AD%A6%E4%B9%A0_SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86/"/>
    <url>/2023/12/19/SpringBoot%E5%AD%A6%E4%B9%A0_SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€ä»€ä¹ˆæ˜¯Spring-Boot-çš„è‡ªåŠ¨è£…é…"><a href="#1ã€ä»€ä¹ˆæ˜¯Spring-Boot-çš„è‡ªåŠ¨è£…é…" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯Spring Boot çš„è‡ªåŠ¨è£…é…"></a>1ã€ä»€ä¹ˆæ˜¯Spring Boot çš„è‡ªåŠ¨è£…é…</h3><h4 id="åŸºç¡€ä»‹ç»"><a href="#åŸºç¡€ä»‹ç»" class="headerlink" title="åŸºç¡€ä»‹ç»"></a>åŸºç¡€ä»‹ç»</h4><blockquote><p>é¢è¯•é¢˜ï¼šè®²è¿°ä¸€ä¸‹Spring Boot çš„è‡ªåŠ¨è£…é…åŸç†ã€‚</p></blockquote><p>Spring Boot çš„è‡ªåŠ¨è£…é…åŸç†åŸºäº Spring æ¡†æ¶çš„ä¾èµ–æ³¨å…¥å’Œæ¡ä»¶æ³¨å†Œç‰¹æ€§ï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„â€œå¯åŠ¨å™¨â€ï¼ˆstartersï¼‰å’Œè‡ªåŠ¨é…ç½®ï¼ˆauto-configurationï¼‰ç±»ç®€åŒ–äº†é…ç½®è¿‡ç¨‹ã€‚</p><p>Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†æ¶‰åŠåˆ°äº†å‡ ä¸ªå…³é”®æ ¸å¿ƒæ¦‚å¿µï¼š@SpringBootApplicationæ³¨è§£ã€æ¡ä»¶æ³¨è§£<code>@Conditional...</code>ã€<code>spring.factories</code>æ–‡ä»¶ã€è‡ªåŠ¨é…ç½®ç±»<code>@Configuration</code></p><p>åŸç†ç®€è¿°ï¼š</p><ul><li>å½“Springåº”ç”¨å¯åŠ¨æ—¶ï¼Œ<code>@EnableAutoConfiguration</code>æ³¨è§£è§¦å‘äº†ä¸€ä¸ªè‡ªåŠ¨é…ç½®çš„è¿‡ç¨‹ã€‚</li><li>è¿™ä¸ªè¿‡ç¨‹ä»<code>classpath</code>ä¸­çš„<code>META-INF/spring.factories</code>æ–‡ä»¶ä¸­è¯»å–å¹¶åŠ è½½æ‰€æœ‰å¯ç”¨çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</li><li>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»å¯ä»¥æ ¹æ®æ¡ä»¶ï¼ˆæ¯”å¦‚classpathä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªç±»ã€æ˜¯å¦å­˜åœ¨æŸä¸ªbeanã€æŸä¸ªå±æ€§æ˜¯å¦æœ‰ç‰¹å®šçš„å€¼ç­‰ï¼‰å†³å®šé…ç½®æ˜¯å¦åº”ç”¨ã€‚</li><li>å¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œç›¸åº”çš„é…ç½®è¢«åº”ç”¨ï¼ˆæ¯”å¦‚åˆ›å»ºä¸€ä¸ªbeanã€æ·»åŠ å±æ€§å€¼ç­‰ï¼‰ã€‚</li></ul><p>è¿™ç§è‡ªåŠ¨é…ç½®æœºåˆ¶å¤§å¤§ç®€åŒ–äº†Springåº”ç”¨çš„é…ç½®ï¼Œå°¤å…¶æ˜¯åœ¨æ„å»ºç‹¬ç«‹çš„ã€ç”Ÿäº§çº§åˆ«çš„Springåº”ç”¨æ—¶ã€‚</p><hr><p>å…ˆäº†è§£ä¸€ä¸‹è‡ªåŠ¨è£…é…ç±»ä¸»è¦ç”¨çš„æ³¨è§£å’Œè‡ªåŠ¨é…ç½®ç±»ï¼Œäº†è§£å…¶æ¦‚å¿µï¼Œå¹¶ç»§ç»­å¾€ä¸‹è¿›è¡Œå­¦ä¹ ã€‚</p><p>Spring Boot çš„è‡ªåŠ¨è£…é…åŸç†æ˜¯åŸºäº Spring æ¡†æ¶çš„ä¾èµ–æ³¨å…¥å’Œæ¡ä»¶è£…é…ç‰¹æ€§ã€‚</p><p>è‡ªåŠ¨è£…é…ä¸»è¦é€šè¿‡ <code>@EnableAutoConfiguration</code> æ³¨è§£å’Œä¸€ç³»åˆ—çš„è‡ªåŠ¨é…ç½®ç±» (<code>*AutoConfiguration</code> ç±») æ¥å®ç°ã€‚</p><p>ä»¥ä¸‹æ˜¯ä»æºç è§’åº¦å¯¹å…¶åŸç†çš„è§£æï¼š</p><blockquote><ol><li>@EnableAutoConfiguration</li></ol></blockquote><ul><li><code>@EnableAutoConfiguration</code> æ³¨è§£æ˜¯ Spring Boot è‡ªåŠ¨è£…é…çš„å…¥å£ã€‚å®ƒé€šå¸¸ä¸ <code>@SpringBootApplication</code> æ³¨è§£ä¸€èµ·ä½¿ç”¨ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶è¢«æ¿€æ´»ã€‚</li><li>è¯¥æ³¨è§£èƒŒåä½¿ç”¨äº† <code>@Import</code> æ³¨è§£æ¥å¯¼å…¥ <code>EnableAutoConfigurationImportSelector</code> ç±»ï¼Œè¿™æ˜¯å¯åŠ¨è‡ªåŠ¨è£…é…çš„å…³é”®ã€‚</li></ul><blockquote><ol start="2"><li>EnableAutoConfigurationImportSelector</li></ol></blockquote><ul><li><code>EnableAutoConfigurationImportSelector</code> å®ç°äº† <code>ImportSelector</code> æ¥å£ï¼Œè´Ÿè´£é€‰æ‹©éœ€è¦å¯¼å…¥çš„é…ç½®ç±»ã€‚</li><li>å®ƒè¯»å– <code>META-INF/spring.factories</code> æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œè¿™ä¸ªæ–‡ä»¶åˆ—å‡ºäº†æ‰€æœ‰å¯ç”¨çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</li><li>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»éƒ½æ˜¯ä»¥æ¡ä»¶æ³¨è§£ï¼ˆå¦‚ <code>@ConditionalOnClass</code>ã€<code>@ConditionalOnBean</code>ï¼‰æ ‡æ³¨çš„ï¼Œè¿™äº›æ³¨è§£ç¡®ä¿åªæœ‰åœ¨ç‰¹å®šæ¡ä»¶æ»¡è¶³æ—¶ï¼Œç›¸å…³é…ç½®æ‰ä¼šè¢«åº”ç”¨ã€‚</li></ul><blockquote><ol start="3"><li>æ¡ä»¶æ³¨è§£</li></ol></blockquote><ul><li>æ¡ä»¶æ³¨è§£æ˜¯ Spring Framework çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼ŒSpring Boot åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº†è‡ªåŠ¨è£…é…ã€‚</li><li><code>@Conditional</code> æ³¨è§£å®¶æ—ï¼ˆæ¯”å¦‚ <code>@ConditionalOnClass</code>ã€<code>@ConditionalOnMissingBean</code>ï¼‰å…è®¸åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶ï¼Œæ‰æ‰§è¡ŒæŸäº›æ“ä½œï¼ˆå¦‚å®ä¾‹åŒ– Beanï¼‰ã€‚</li><li>è¿™äº›æ³¨è§£ç¡®ä¿äº†åªæœ‰å½“ç›¸å…³çš„ç±»å­˜åœ¨äºç±»è·¯å¾„ä¸Šã€æˆ–è€…æŸä¸ª Bean å°šæœªå®šä¹‰æ—¶ï¼Œå¯¹åº”çš„è‡ªåŠ¨é…ç½®ç±»æ‰ä¼šè¢«æ¿€æ´»ã€‚</li></ul><blockquote><ol start="4"><li>è‡ªåŠ¨é…ç½®ç±» (<code>*AutoConfiguration</code>)</li></ol></blockquote><ul><li>è‡ªåŠ¨é…ç½®ç±»é€šå¸¸å‘½åä¸º <code>*AutoConfiguration</code>ï¼Œå®ƒä»¬åŒ…å«äº†ä¸€ç³»åˆ—çš„ Bean å®šä¹‰å’Œæ¡ä»¶é€»è¾‘ã€‚</li><li>è¿™äº›ç±»åˆ©ç”¨ Spring çš„ä¾èµ–æ³¨å…¥ç‰¹æ€§ï¼Œå®šä¹‰äº†å¦‚ä½•åˆ›å»ºå’Œé…ç½® Beanï¼Œä»è€Œç®€åŒ–äº†è®¸å¤šå¸¸è§åœºæ™¯çš„é…ç½®å·¥ä½œã€‚</li><li>ä¾‹å¦‚ï¼Œ<code>DataSourceAutoConfiguration</code> å¯ä»¥åœ¨ç±»è·¯å¾„ä¸Šæ£€æµ‹åˆ°æ•°æ®åº“è¿æ¥æ± å®ç°æ—¶è‡ªåŠ¨é…ç½®æ•°æ®æºï¼ˆDataSourceï¼‰ã€‚</li></ul><p>ç¤ºä¾‹ï¼šDataSourceAutoConfiguration</p><p>ä»¥ <code>DataSourceAutoConfiguration</code> ä¸ºä¾‹ï¼Œå±•ç¤ºè‡ªåŠ¨é…ç½®ç±»çš„å…¸å‹ç»“æ„ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><span class="hljs-variable">@ConditionalOnClass</span>(&#123;DataSource.class, EmbeddedDatabaseType.class&#125;)<br>public class DataSourceAutoConfiguration &#123;<br><br>    <span class="hljs-comment">// ...çœç•¥å…¶ä»–ä»£ç ...</span><br><br>    <span class="hljs-variable">@Configuration</span><br>    <span class="hljs-variable">@Conditional</span>(DataSourceAutoConfiguration.DataSourceAvailableCondition.class)<br>    public static class DataSourceConfiguration &#123;<br>        <span class="hljs-comment">// Bean å®šä¹‰å’Œé…ç½®</span><br>    &#125;<br><br>    <span class="hljs-comment">// ...çœç•¥å…¶ä»–ä»£ç ...</span><br><br>    static class DataSourceAvailableCondition extends SpringBootCondition &#123;<br>        <span class="hljs-comment">// æ¡ä»¶åˆ¤æ–­é€»è¾‘</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>å°ç»“</p></blockquote><p>Spring Boot çš„è‡ªåŠ¨è£…é…æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„è‡ªåŠ¨é…ç½®ç±»ä»¥åŠæ¡ä»¶æ³¨è§£å®ç°çš„ã€‚</p><p>è¿™äº›è‡ªåŠ¨é…ç½®ç±»ä½äºåº”ç”¨çš„ç±»è·¯å¾„ä¸Šï¼Œå¹¶åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶è¢« <code>@EnableAutoConfiguration</code> æ³¨è§£æ¿€æ´»ã€‚</p><p>è¿™ç§æœºåˆ¶æå¤§åœ°ç®€åŒ–äº† Spring åº”ç”¨çš„é…ç½®è¿‡ç¨‹ï¼Œå…è®¸å¼€å‘è€…ä»¥æœ€å°‘çš„åŠªåŠ›å®ç°å¼ºå¤§çš„åŠŸèƒ½ã€‚</p><hr><h4 id="ä»€ä¹ˆæ˜¯-SpringBoot-çš„è‡ªåŠ¨é…ç½®ï¼ˆè§†é¢‘å­¦ä¹ ï¼‰"><a href="#ä»€ä¹ˆæ˜¯-SpringBoot-çš„è‡ªåŠ¨é…ç½®ï¼ˆè§†é¢‘å­¦ä¹ ï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯ SpringBoot çš„è‡ªåŠ¨é…ç½®ï¼ˆè§†é¢‘å­¦ä¹ ï¼‰"></a>ä»€ä¹ˆæ˜¯ SpringBoot çš„è‡ªåŠ¨é…ç½®ï¼ˆè§†é¢‘å­¦ä¹ ï¼‰</h4><p>è§†é¢‘åœ°å€å­¦ä¹ ï¼š <a href="https://www.bilibili.com/video/BV1NY411P7VX">https://www.bilibili.com/video/BV1NY411P7VX</a></p><blockquote><p>ä»€ä¹ˆæ˜¯ SpringBoot çš„è‡ªåŠ¨é…ç½®</p></blockquote><p>Spring è‡ªåŠ¨é…ç½®ï¼Œè‹±æ–‡æ˜¯ Auto-Configuratioin</p><ul><li>ä»–æ˜¯æŒ‡åŸºäºå¼•å…¥çš„ä¾èµ– Jar åŒ…ï¼Œå¯¹ SpringBoot åº”ç”¨è¿›è¡Œè‡ªåŠ¨é…ç½®</li><li>å®ƒä¸º SpringBoot æ¡†æ¶çš„ â€œ å¼€ç®±å³ç”¨â€ æä¾›äº†åŸºç¡€æ”¯æ’‘ã€‚</li></ul><p>åŒæ—¶éœ€è¦åŒºåˆ«ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li>è‡ªåŠ¨é…ç½®ï¼š Auto-Configuration</li><li>è‡ªåŠ¨è£…é…ï¼š Autowire</li></ul><p>æœ¯è¯­ï¼šâ€œé…ç½®ç±»â€</p><p>é…ç½®ç±»çš„è‹±æ–‡æ˜¯ Configuration </p><ul><li>å¹¿ä¹‰çš„â€œé…ç½®ç±»â€<ul><li>è¢«æ³¨è§£ @Component ç›´æ¥æˆ–é—´æ¥ä¿®é¥°çš„æŸä¸ªç±»</li><li>è¿™ä¸ªæŒ‡çš„æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ Spring ç»„ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬äº† @Configuratioin ç±»</li></ul></li><li>ç‹­ä¹‰çš„â€œé…ç½®ç±»â€<ul><li>ç‰¹æŒ‡è¢«æ³¨è§£ @Configration æ‰€ä¿®é¥°çš„æŸä¸ªç±»</li><li>åˆç§°ä¸º @Configuration ç±»</li></ul></li></ul><p>é…ç½®ç±»ç¤ºä¾‹ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261517334.png" alt="image.png"></p><p>SpringBoot è‡ªåŠ¨é…ç½®çš„å®ä¾‹ï¼š</p><p>å®ä¾‹ï¼šRedis çš„è‡ªåŠ¨é…ç½®</p><ul><li><ol><li>å¼•å…¥ä¾èµ–</li></ol></li><li><ol start="2"><li>é…ç½®Redis æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯</li></ol></li><li><ol start="3"><li>ç›´æ¥ä½¿ç”¨ RedisTempate æˆ– StringRedis Template ç­‰å¯¹è±¡</li></ol></li></ul><p>SpringBoot å¯åŠ¨æµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261518878.png" alt="image.png"></p><p>run æ–¹æ³•ç®€æ˜“ç‰ˆæµç¨‹ç¤ºä¾‹ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261519947.png" alt="image.png"></p><p>è¿™é‡Œå¯¹äºç¬¬ä¸‰æ­¥ processConfigurationClasses è¿›è¡Œè®²è§£é˜è¿°ï¼ˆä»£ç è¿›è¡Œäº†éƒ¨åˆ†ç®€åŒ–ï¼Œä¸»è¦ç†è§£ä¸€ä¸‹é€»è¾‘ï¼‰ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261521277.png" alt="image.png"></p><p>parse æ–¹æ³•</p><ul><li><ol><li>æˆ‘ä»¬ä¼šä»å¯åŠ¨ç±»çš„ @ComponentScan æ³¨è§£å¼€å§‹å¤„ç†ï¼Œä¼šå…ˆæ ¹æ® @ComponentScan æ³¨è§£ä¸‹é…ç½®å†…å®¹ï¼Œæ‰«ææŒ‡å®šçš„ package ï¼Œå¾—åˆ°ä¸€ç³»åˆ—çš„é…ç½®ç±»ï¼›ç„¶åè¿›è¡Œé€’å½’å¤„ç†</li></ol></li><li><ol start="2"><li>æ¥ç€ä¼šå¤„ç†æ³¨è§£ @Import ï¼›å¯¼å…¥ä¸€ç³»åˆ—é…ç½®ç±»åï¼Œå†è¿›è¡Œé€’å½’å¤„ç†</li></ol></li><li><ol start="3"><li>æœ€åï¼Œæ˜¯è§£æé…ç½®ç±»ä¸­çš„ @Bean æ–¹æ³•ï¼Œä»¥åŠä¹‹å‰å¯¼å…¥çš„ BeanDefinition æ³¨å†Œå™¨</li></ol></li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261522420.png" alt="image.png"></p><p>é€’å½’è¿‡ç¨‹å›¾è§£ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261526019.png" alt="image.png"></p><p>æ³¨è§£ @ComponentScan å’Œ @Import çš„ä½¿ç”¨å»ºè®®å•ç‹¬å»ç¨å¾®çœ‹ä¸€ä¸‹</p><p>æ³¨è§£ Import çš„å¸¸ç”¨çš„å‡ ç§ç”¨æ³•ï¼š</p><ul><li>ç¤ºä¾‹1ï¼š æ³¨è§£@Import å¯¼å…¥æ™®é€šç±»</li><li>ç¤ºä¾‹2ï¼š æ³¨è§£@Import å¯¼å…¥æ¥å£ ImportSelector å®ç°ç±»</li><li>ç¤ºä¾‹3ï¼š å¯¼å…¥æ¥å£ ImportBeanDefinitionRegistrar å®ç°ç±»</li></ul><hr><p>æ€»ç»“ä¸€ä¸‹ SpringBoot åŠ è½½é…ç½®ç±»çš„æ–¹å¼</p><ul><li>ä½¿ç”¨æ³¨è§£ @ComponentScan</li><li>ä½¿ç”¨æ³¨è§£ @Import<ul><li>å¯¼å…¥æ™®é€šç±»</li><li>å¯¼å…¥æ¥å£ ImportSelector å®ç°ç±»</li><li>å¯¼å…¥æ¥å£ ImportBeanDefinitionRegistrar å®ç°ç±»</li></ul></li></ul><p>ä»ä¸Šé¢çš„å‡ ç§é…ç½®æ–¹å¼ä¸­çš„å…·ä½“ä½¿ç”¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœè¦å®ç°è‡ªåŠ¨å¯¼å…¥é…ç½®ç±»ï¼Œéœ€è¦ä½¿ç”¨ æ³¨è§£ @Import +  å¯¼å…¥æ¥å£ ImportSelector å®ç°ç±» çš„æ–¹å¼æ¥å®ç°ï¼ˆå…¶ä»–å‡ ç§éƒ½ä¸å¤ªé€‚åˆï¼‰ï¼›</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä» æ³¨è§£ @SpringBootApplication çœ‹ä¸€ä¸‹è¿™ä¸ªå…·ä½“çš„ä½¿ç”¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261534577.png" alt="image.png"></p><blockquote><p>å¦‚ä½•å®ç°ç±» AutoConfigurationImportSelector</p></blockquote><ul><li>SpringFactories æœºåˆ¶<ul><li>Java SPI æœºåˆ¶çš„å»¶ä¼¸å’Œæ‰©å±•</li><li>Spring æ¡†æ¶çš„åŸºç¡€æœºåˆ¶ï¼Œåœ¨ Spring ä»¥åŠ SpringBoot æºç ä¸­åˆ°å¤„å¯è§</li><li>å¯ä»¥åŸºäºå®ƒæ¥å®ç° SpringBoot çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½</li></ul></li></ul><p>SpringFactories æœºåˆ¶çš„æ ¸å¿ƒé€»è¾‘æ˜¯ä» classpath ä¸­è¯»å–åˆ° æ‰€æœ‰ Jar åŒ…ä¸­çš„é…ç½®æ–‡ä»¶ META-IF&#x2F;spring.factoriesï¼Œç„¶åæ ¹æ®æŒ‡å®šçš„ key ä»é…ç½®æ–‡ä»¶ä¸­è§£æå‡ºå¯¹åº”çš„ value å€¼</p><blockquote><p>SpringFactories ä¸ SPI æœºåˆ¶çš„å¯¹æ¯”</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261538309.png" alt="image.png"></p><blockquote><p>ç±» AutoConfigurationImportSelector  çš„å…³é”®æºç </p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isEnabled(annotationMetadata)) &#123;<br>        <span class="hljs-keyword">return</span> NO_IMPORTS;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader.loadMetadata(<span class="hljs-keyword">this</span>.beanClassLoader);<br>        <span class="hljs-comment">//SpringBoot è‡ªåŠ¨é…ç½®çš„å…¥å£æ–¹æ³•</span><br>        AutoConfigurationImportSelector.AutoConfigurationEntry autoConfigurationEntry = <br>                <span class="hljs-keyword">this</span>.getAutoConfigurationEntry(autoConfigurationMetadata, annotationMetadata);<br>        <span class="hljs-keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ getAutoConfigurationEntry æ–¹æ³•æ˜¯è‡ªåŠ¨é…ç½®çš„å…¥å£</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">protected</span> AutoConfigurationImportSelector.AutoConfigurationEntry getAutoConfigurationEntry(AutoConfigurationMetadata autoConfigurationMetadata, AnnotationMetadata annotationMetadata) &#123;  <br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isEnabled(annotationMetadata)) &#123;  <br>        <span class="hljs-keyword">return</span> EMPTY_ENTRY;  <br>    &#125; <span class="hljs-keyword">else</span> &#123;  <br>        <span class="hljs-comment">//1. è·å– annotationMetadata çš„æ³¨è§£ @EnableAutoConfiguration çš„å±æ€§</span><br>        AnnotationAttributes attributes = <span class="hljs-keyword">this</span>.getAttributes(annotationMetadata);  <br>        <span class="hljs-comment">//2. ä»èµ„æºæ–‡ä»¶ spring.factories ä¸­è·å– EnableAutoConfiguration å¯¹åº”çš„æ‰€æœ‰çš„ç±»</span><br>        List&lt;String&gt; configurations = <span class="hljs-keyword">this</span>.getCandidateConfigurations(annotationMetadata, attributes);  <br>        configurations = <span class="hljs-keyword">this</span>.removeDuplicates(configurations);  <br>        <span class="hljs-comment">//3. é€šè¿‡åœ¨æ³¨è§£ @EnableAutoConfiguration è®¾ç½® exclued çš„ç›¸å…³å±æ€§ï¼Œå¯ä»¥æ’é™¤æŒ‡å®šçš„è‡ªåŠ¨é…ç½®ç±»</span><br>        Set&lt;String&gt; exclusions = <span class="hljs-keyword">this</span>.getExclusions(annotationMetadata, attributes);  <br>        <span class="hljs-keyword">this</span>.checkExcludedClasses(configurations, exclusions);  <br>        configurations.removeAll(exclusions);  <br>        <span class="hljs-comment">//4. æ ¹æ®æ³¨è§£ @Conditional æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ’é™¤æŸäº›è‡ªåŠ¨é…ç½®ç±»</span><br>        configurations = <span class="hljs-keyword">this</span>.filter(configurations, autoConfigurationMetadata);  <br>        <span class="hljs-comment">//5. è§¦å‘ AutoConfiguration å¯¼å…¥çš„ç›¸å…³äº‹ä»¶</span><br>        <span class="hljs-keyword">this</span>.fireAutoConfigurationImportEvents(configurations, exclusions);  <br>        <span class="hljs-keyword">return</span> new AutoConfigurationImportSelector.AutoConfigurationEntry(configurations, exclusions);  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ç¬¬äºŒæ­¥ getCandidateConfigurations  æ–¹æ³•æ˜¯ åŸºäº SpringFactories æœºåˆ¶ï¼Œæ¥è·å–ç¬¬ä¸‰æ–¹ Jar åŒ…ä¸­çš„æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»çš„æ–¹æ³•</p><p>æ³¨æ„åˆ°ä»é…ç½®æ–‡ä»¶è·å–è‡ªåŠ¨é…ç½®ç±»æ—¶ä½¿ç”¨çš„ key æ˜¯ç±» EnableAutoConfiguration çš„å…¨é™å®šç±»å</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">protected</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-title function_">getCandidateConfigurations</span>(<span class="hljs-params">AnnotationMetadata metadata, AnnotationAttributes attributes</span>) &#123;  <br><span class="hljs-comment">// é€šè¿‡ SpringFactories æœºåˆ¶ï¼Œä»é…ç½®æ–‡ä»¶ spring.factories ä¸­æ‰¾åˆ°æ‰€æœ‰çš„é…ç½®ç±»</span><br>    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; configurations = <span class="hljs-title class_">SpringFactoriesLoader</span>.<span class="hljs-title function_">loadFactoryNames</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getSpringFactoriesLoaderFactoryClass</span>(), <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getBeanClassLoader</span>());  <br>    <span class="hljs-title class_">Assert</span>.<span class="hljs-title function_">notEmpty</span>(configurations, <span class="hljs-string">&quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;</span>);  <br>    <span class="hljs-keyword">return</span> configurations;  <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ€»ç»“ä¸€ä¸‹ AutoConfigurationImportSelector çš„æ³¨è§£æµç¨‹</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261548596.png" alt="image.png"></p><blockquote><p>æ³¨è§£ @Conditional</p></blockquote><p>Spring æ¡†æ¶æä¾›äº†ä¸€ç³»åˆ—å¸¸ç”¨çš„ Confitional æ‰©å±•æ³¨è§£ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261549713.png" alt="image.png"></p><blockquote><p>å°ç»“</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261549082.png" alt="image.png"></p><blockquote><p>SpringBoot è‡ªåŠ¨é…ç½®å®ä¾‹- Redis</p></blockquote><p>ä»¥ spring-boot-starter-data-redis  ä¸ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- spring data redis --&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å¯¹åº”çš„ pom æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å¯¹åº”çš„ ä¾èµ–é¡¹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261556211.png" alt="image.png"></p><p>åœ¨ spring-boot-autoconfigure é¡¹ç›®ä¸­æŸ¥çœ‹é…ç½®æ–‡ä»¶ä»¥åŠæºç ï¼š</p><ul><li>å…ˆæŸ¥çœ‹ é¡¹ç›®ä¸­çš„ META-IF&#x2F;spring.factories é…ç½®æ–‡ä»¶</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261557230.png" alt="image.png"></p><ul><li>æ¥å£æŸ¥çœ‹å…¶ä¸­çš„è‡ªåŠ¨é…ç½®ç±»ä¹‹ä¸€ RedisAutoConfiguration</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261558233.png" alt="image.png"></p><h4 id="Spring-Bootè‡ªåŠ¨é…ç½®åŸç†æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå°ç¨‹åºï¼‰"><a href="#Spring-Bootè‡ªåŠ¨é…ç½®åŸç†æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå°ç¨‹åºï¼‰" class="headerlink" title="Spring Bootè‡ªåŠ¨é…ç½®åŸç†æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå°ç¨‹åºï¼‰"></a>Spring Bootè‡ªåŠ¨é…ç½®åŸç†æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå°ç¨‹åºï¼‰</h4><blockquote><p>è‡ªåŠ¨é…ç½®åŸç†</p></blockquote><p>Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†æ˜¯é€šè¿‡<strong>æ¡ä»¶åŒ–é…ç½®</strong>å’ŒSpringçš„<strong>æ³¨è§£æœºåˆ¶</strong>æ¥å®ç°çš„ï¼Œå½“åº”ç”¨å¯åŠ¨æ—¶ï¼ŒSpring Bootä¼šè‡ªåŠ¨æ‰«æåº”ç”¨ä¸­çš„ä¾èµ–ï¼Œæ ¹æ®ä¾èµ–è‡ªåŠ¨é…ç½®Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿å¼€ç®±å³ç”¨ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261616336.png" alt="image.png"></p><blockquote><p>Spring Bootè‡ªåŠ¨é…ç½®çš„å…³é”®æ­¥éª¤ï¼š</p></blockquote><ul><li>Spring Bootä¼šæ‰«æåº”ç”¨ä¸­çš„æ‰€æœ‰ç±»è·¯å¾„ä¸‹çš„META-lNF&#x2F;spring.factoriesæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†Spring Bootè‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒã€‚</li><li>Spring Bootå°†è¯»å–åˆ°çš„è‡ªåŠ¨é…ç½®ç±»åŠ è½½åˆ°Springåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™äº›è‡ªåŠ¨é…ç½®ç±»éƒ½å®ç°äº†AutoConfiguration è‡ªåŠ¨é…ç½®æ¥å£ã€‚</li><li>Spring Bootæ ¹æ®æ¡ä»¶è¿›è¡Œè‡ªåŠ¨é…ç½®ï¼Œå®ƒä¼šæ£€æŸ¥ä¸€äº›æ¡ä»¶ï¼Œå¦‚æœè¿™äº›æ¡ä»¶æ»¡è¶³ï¼Œåˆ™å¯ç”¨ç›¸åº”çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</li><li>Spring Bootè‡ªåŠ¨é…ç½®ç±»ä¼šå‘Springå®¹å™¨ä¸­æ·»åŠ éœ€è¦çš„Beanå®šä¹‰å’Œç»„ä»¶ï¼Œè¿™äº›Beanå®šä¹‰å’Œç»„ä»¶æ˜¯æ ¹æ®åº”ç”¨çš„é…ç½®å’ŒSpring Bootçš„é»˜è®¤å€¼åˆ›å»ºçš„ã€‚</li><li>Spring Bootè¿˜æä¾›äº†ä¸€äº› Starter ä¾èµ–ï¼Œè¿™äº› Starter ä¾èµ–åŒ…å«äº†ä¸€äº›å¸¸ç”¨çš„åº“å’Œæ¡†æ¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´æ–¹ä¾¿åœ°è¿›è¡Œå¼€å‘ã€‚è¿™äº›Starterä¾èµ–ä¼šè‡ªåŠ¨å¼•å…¥ç›¸å…³çš„ä¾èµ–ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ›´å¿«åœ°è¿›è¡Œå¼€å‘ã€‚</li></ul><blockquote><p>è‡ªåŠ¨é…ç½®åŠ è½½æºç </p></blockquote><p>Spring Bootçš„è‡ªåŠ¨é…ç½®æ³¨è§£æ˜¯@EnableAutoConfiguration,  ä»æ³¨è§£ä¸Šé¢çš„@Importçš„ç±»å¯ä»¥æ‰¾åˆ°ä¸‹é¢è‡ªåŠ¨åŠ è½½è‡ªåŠ¨é…ç½®çš„æ˜ å°„ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs swift">org.springframework.core.io.support.<span class="hljs-type">SpringFactoriesLoader</span>.loadFactoryNames(<span class="hljs-type">Class</span>&lt;?&gt; factoryType, <span class="hljs-meta">@Nullable</span> <span class="hljs-type">ClassLoader</span> classLoader)<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt; loadFactoryNames(<span class="hljs-type">Class</span>&lt;?&gt; factoryType, <span class="hljs-meta">@Nullable</span> <span class="hljs-type">ClassLoader</span> classLoader)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ä¼šåŠ è½½ç±»è·¯å¾„åŠæ‰€æœ‰jaråŒ…ä¸‹META-INF&#x2F;spring.factoriesé…ç½®ä¸­æ˜ å°„çš„è‡ªåŠ¨é…ç½®çš„ç±»ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">META</span>-<span class="hljs-keyword">INF</span>/spring.factories<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹Spring Bootè‡ªå¸¦çš„è‡ªåŠ¨é…ç½®çš„åŒ…ï¼šspring-boot-autoconfigure-Xxx.RELEASE.jar,</p><p>æ‰“å¼€å…¶ä¸­çš„META-lNF&#x2F;spring.factoriesæ–‡ä»¶ä¼šæ‰¾åˆ°è‡ªåŠ¨é…ç½®çš„æ˜ å°„ã€‚</p><p>ç¤ºä¾‹ï¼šæ•°æ®æºè‡ªåŠ¨é…ç½®çš„å®ç°æ³¨è§£</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@ConditionalOnClass</span>(&#123;DataSource.class, EmbeddedDatabaseType.class&#125;)  <br><span class="hljs-variable">@EnableConfigurationProperties</span>(&#123;DataSourceProperties.class&#125;)  <br><span class="hljs-variable">@Import</span>(&#123;DataSourcePoolMetadataProvidersConfiguration.class, DataSourceInitializationConfiguration.class&#125;)  <br>public class DataSourceAutoConfiguration&#123;<br>...<br>&#125;<br></code></pre></td></tr></table></figure><p>@Configurationå’Œ@ConditionalOnClasså°±æ˜¯è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒï¼Œé¦–å…ˆå®ƒå¾—æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå…¶æ¬¡æ ¹æ®ç±»è·¯å¾„ä¸‹æ˜¯å¦æœ‰è¿™ä¸ªç±»å»è‡ªåŠ¨é…ç½®ã€‚</p><blockquote><p>ç‰ˆæœ¬å·®å¼‚</p></blockquote><p>è‡ªåŠ¨é…ç½®åŠ è½½æºç ï¼Œä¸åŒçš„çš„ç‰ˆæœ¬å¯èƒ½å¤§æœ‰ä¸åŒï¼Œå°¤å…¶åœ¨Spring Boot2.7.xåŠ3.xä¸­ï¼Œ</p><p>SpringBoot 2.7 + æ–°å˜åŒ–</p><p>Spring Boot 2.7 ä¸­çš„è‡ªåŠ¨é…ç½®æ³¨å†Œæœ‰äº†ä¸€ä¸ªæ¯”è¾ƒå¤§çš„è°ƒæ•´ï¼Œä¹‹å‰éƒ½æ˜¯å†™åœ¨æ–‡ä»¶ META-INF&#x2F;spring.factories ä¸­ï¼›</p><p>ç°åœ¨æ”¹åäº†ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">META-INF/spring/org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.autoconfigure</span><span class="hljs-selector-class">.AutoConfiguration</span>.imports<br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261628810.png" alt="image.png"></p><p>å¦å¤–æ ¼å¼ä¹Ÿå˜äº†ï¼ŒSpring Boot 2.7 ä¸­ç›´æ¥æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼ˆç¼–å†™æ ¼å¼æ¯”ä¹‹å‰æ–¹ä¾¿å¾ˆå¤šï¼‰ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261629632.png" alt="image.png"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š åœ¨ 2.7 x ä¸­ï¼Œè™½ç„¶ META-INF&#x2F;spring.factories  è¢«æ ‡è¯†åºŸå¼ƒä¸­ï¼Œä½†æ˜¯ä¸ºäº†å‘åå…¼å®¹ï¼Œåœ¨ 2.7 x ä»ç„¶æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œåç»­ä¼šè¢«å½»åº•åˆ é™¤ï¼Œå»ºè®®ä½¿ç”¨æ–°çš„è§„èŒƒã€‚</p><p><strong>Spring Boot 3.0 æ–°å˜åŒ–</strong></p><p>æœ€æ–°Spring Boot3.0ä¸­ï¼Œè€çš„è‡ªåŠ¨é…ç½®æ–‡ä»¶META-NF&#x2F;spring.factorieså·²ç»æ­£å¼è¢«åºŸé™¤äº†ï¼Œè™½ç„¶é…ç½®æ–‡ä»¶è¿˜åœ¨ï¼Œä½†ä»…ä¿ç•™ç³»ç»Ÿçº§çš„ç»„ä»¶æ³¨å†Œï¼Œä¸å†ä½œä¸ºåº”ç”¨çº§çš„è‡ªåŠ¨é…ç½®ç±»åŠ è½½äº†ï¼Œ</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå·²ç»ä¸èƒ½å†æ³¨å†Œè‡ªå®šä¹‰çš„è‡ªåŠ¨é…ç½®ç±»äº†ï¼Œå¿…é¡»ä½¿ç”¨æ–°çš„è‡ªåŠ¨é…ç½®æ–‡ä»¶è§„èŒƒè¿›è¡Œæ³¨å†Œã€‚</p><hr><h3 id="2ã€è§£è¯»-SpringBootApplication-æ³¨è§£ï¼ˆç¬¬ä¸€ç‰ˆï¼‰"><a href="#2ã€è§£è¯»-SpringBootApplication-æ³¨è§£ï¼ˆç¬¬ä¸€ç‰ˆï¼‰" class="headerlink" title="2ã€è§£è¯»@SpringBootApplication æ³¨è§£ï¼ˆç¬¬ä¸€ç‰ˆï¼‰"></a>2ã€è§£è¯»@SpringBootApplication æ³¨è§£ï¼ˆç¬¬ä¸€ç‰ˆï¼‰</h3><p>ä¸Šè¿°å†…å®¹ä¹Ÿè°ˆè®ºåˆ° æ¡ä»¶æ³¨è§£æ˜¯ Spring Framework çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼ŒSpring Boot åœ¨å…¶åŸºç¡€ä¸Šï¼Œé€šè¿‡ SPI çš„æ–¹å¼ï¼Œåšäº†è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œå¹¶è¿›è€Œå®ç°äº†è‡ªåŠ¨è£…é…ã€‚</p><blockquote><p>æˆ‘ä»¬ä»å¯åŠ¨ç±»å¼€å§‹äº†è§£å…¶è‡ªåŠ¨è£…é…åŸç†</p></blockquote><p>æœ¬åœ°çš„ç‰ˆæœ¬æ˜¯ï¼šorg.springframework.boot:spring-boot-autoconfigure:2.2.5.RELEASE</p><h4 id="2-1-SpringBootApplication"><a href="#2-1-SpringBootApplication" class="headerlink" title="2.1  SpringBootApplication"></a>2.1  SpringBootApplication</h4><p>@SpringBootApplicationæ³¨è§£æ˜¯æ”¾ç½®åœ¨ Spring Boot åº”ç”¨çš„ä¸»ç±»ä¸Šï¼Œæ³¨è§£çš„ä½œç”¨æ˜¯å¯ç”¨ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨é…ç½®ã€‚</p><p>æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªå¯åŠ¨ç±»ï¼Œè¿›å…¥å…¶æ³¨è§£ä»£ç ï¼Œ</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Target</span>(ElementType.TYPE) <span class="hljs-comment">// æ³¨è§£ä½œç”¨äºç±»å‹ä¸Šï¼ˆæ¯”å¦‚ç±»ã€æ¥å£ï¼‰</span><br><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME) <span class="hljs-comment">// æ³¨è§£åœ¨è¿è¡Œæ—¶æœ‰æ•ˆ</span><br><span class="hljs-variable">@Documented</span> <span class="hljs-comment">// å°†æ­¤æ³¨è§£åŒ…å«åœ¨ Javadoc ä¸­</span><br><span class="hljs-variable">@Inherited</span> <span class="hljs-comment">// æ³¨è§£å¯ä»¥è¢«ç»§æ‰¿</span><br><span class="hljs-variable">@SpringBootConfiguration</span> <span class="hljs-comment">// ç‰¹æ®Šçš„@Configurationï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ª Spring Boot é…ç½®ç±»</span><br><span class="hljs-variable">@EnableAutoConfiguration</span> <span class="hljs-comment">// å¯ç”¨ Spring Boot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶</span><br><span class="hljs-comment">//å¯ç”¨ç»„ä»¶æ‰«æï¼Œè®© Spring è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œåº”ç”¨ä¸­çš„ Beansã€‚é€šå¸¸ï¼Œå®ƒä¼šæ‰«æä¸ä¸»ç±»ç›¸åŒçš„åŒ…ä»¥åŠå­åŒ…ä¸­çš„ç»„ä»¶ã€‚</span><br><span class="hljs-comment">//`excludeFilters` å±æ€§ç”¨äºæ’é™¤æŸäº›ç±»å‹çš„ç»„ä»¶ï¼Œè¿™é‡Œç‰¹åˆ«æ’é™¤äº† `TypeExcludeFilter` å’Œ `AutoConfigurationExcludeFilter` ç±»å‹çš„ç»„ä»¶</span><br><span class="hljs-variable">@ComponentScan</span>(<br>    excludeFilters = &#123;<br>        <span class="hljs-variable">@Filter</span>(<br>            type = FilterType.CUSTOM,<br>            classes = &#123;TypeExcludeFilter.class&#125;<br>        ),<br>        <span class="hljs-variable">@Filter</span>(<br>            type = FilterType.CUSTOM,<br>            classes = &#123;AutoConfigurationExcludeFilter.class&#125;<br>        )<br>    &#125;<br>) <br>public <span class="hljs-variable">@interface</span> SpringBootApplication &#123;<br>    <span class="hljs-comment">// ... å…¶ä»–å±æ€§å®šä¹‰ ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-2-EnableAutoConfiguration"><a href="#2-2-EnableAutoConfiguration" class="headerlink" title="2.2 EnableAutoConfiguration"></a>2.2 EnableAutoConfiguration</h4><blockquote><p>ä½œç”¨</p></blockquote><p><code>@EnableAutoConfiguration</code> æ˜¯ Spring Boot çš„æ ¸å¿ƒæ³¨è§£ä¹‹ä¸€ï¼Œç”¨äºå¯åŠ¨è‡ªåŠ¨é…ç½®çš„æœºåˆ¶ã€‚è¿™ä¸ªæ³¨è§£é€šè¿‡ <code>@Import</code> æ³¨è§£å¯¼å…¥ <code>AutoConfigurationImportSelector</code>ï¼Œåè€…è´Ÿè´£æ ¹æ®æ¡ä»¶é€‰æ‹©å’Œåº”ç”¨è‡ªåŠ¨é…ç½®ç±»ã€‚</p><blockquote><p>ä»£ç </p></blockquote><p><code>@EnableAutoConfiguration</code>Â æ˜¯å®ç°è‡ªåŠ¨è£…é…çš„é‡è¦æ³¨è§£ï¼Œæˆ‘ä»¬ä»¥è¿™ä¸ªæ³¨è§£ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(ElementType.TYPE)</span> <span class="hljs-comment">// æŒ‡å®šæ³¨è§£å¯ä»¥åº”ç”¨äºç±»å‹çº§åˆ«ï¼ˆç±»ã€æ¥å£ç­‰ï¼‰</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span> <span class="hljs-comment">// æ³¨è§£åœ¨è¿è¡Œæ—¶æœ‰æ•ˆ</span><br><span class="hljs-meta">@Documented</span> <span class="hljs-comment">// æ³¨è§£å°†è¢«åŒ…å«åœ¨javadocä¸­</span><br><span class="hljs-meta">@Inherited</span> <span class="hljs-comment">// æ³¨è§£å¯ä»¥è¢«å­ç±»ç»§æ‰¿</span><br><span class="hljs-meta">@AutoConfigurationPackage</span> <span class="hljs-comment">// è‡ªåŠ¨é…ç½®åŒ…ï¼Œå°†ä¸»é…ç½®ç±»çš„åŒ…è§†ä¸ºè‡ªåŠ¨é…ç½®åŒ…</span><br><span class="hljs-meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span> <span class="hljs-comment">// å¯¼å…¥AutoConfigurationImportSelector</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration &#123;<br>    <br>    <span class="hljs-comment">// ç”¨äºè¦†ç›–è‡ªåŠ¨é…ç½®æ˜¯å¦å¯ç”¨çš„å±æ€§</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;spring.boot.enableautoconfiguration&quot;</span>;<br><br>    <span class="hljs-comment">// æ’é™¤ç‰¹å®šçš„è‡ªåŠ¨é…ç½®ç±»</span><br>    Class&lt;?&gt;[] exclude() <span class="hljs-keyword">default</span> &#123;&#125;;<br><br>    <span class="hljs-comment">// é€šè¿‡åç§°æ’é™¤ç‰¹å®šçš„è‡ªåŠ¨é…ç½®ç±»</span><br>    String[] excludeName() <span class="hljs-keyword">default</span> &#123;&#125;;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨ç¤ºä¾‹</p></blockquote><p>é€šå¸¸ï¼Œæˆ‘ä»¬æ˜¯ä¸ä¼šæ˜¾å¼åœ°ä½¿ç”¨ <code>@EnableAutoConfiguration</code>ï¼Œå®ƒå·²ç»åŒ…å«åœ¨ <code>@SpringBootApplication</code> æ³¨è§£ä¸­ã€‚</p><p>ä½†å¦‚æœéœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><span class="hljs-variable">@EnableAutoConfiguration</span>(exclude = &#123;DataSourceAutoConfiguration.class&#125;)<br>public class MyConfiguration &#123;<br>    <span class="hljs-comment">// é…ç½®å†…å®¹</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œ<code>@EnableAutoConfiguration</code> æ³¨è§£ç”¨äºå¯åŠ¨è‡ªåŠ¨é…ç½®ï¼Œä½†æ’é™¤äº†ç‰¹å®šçš„è‡ªåŠ¨é…ç½®ç±» <code>DataSourceAutoConfiguration</code>ã€‚</p><hr><h4 id="2-3-AutoConfigurationImportSelector"><a href="#2-3-AutoConfigurationImportSelector" class="headerlink" title="2.3 AutoConfigurationImportSelector"></a>2.3 AutoConfigurationImportSelector</h4><p><code>AutoConfigurationImportSelector</code> æ˜¯ Spring Boot è‡ªåŠ¨è£…é…æœºåˆ¶çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚è¿™ä¸ªç±»å®ç°äº†å¤šä¸ª Spring æ¡†æ¶çš„æ¥å£ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨å¯åŠ¨æ—¶é€‰æ‹©å’Œæ³¨å†Œè‡ªåŠ¨é…ç½®ç±»ã€‚</p><p>å…ˆçœ‹ä¸€ä¸‹è¿™ä¸ªç±» <code>AutoConfigurationImportSelector</code>çš„ç»§æ‰¿ä½“ç³»ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">AutoConfigurationImportSelector</span> <span class="hljs-symbol">implements</span> <span class="hljs-symbol">DeferredImportSelector, <span class="hljs-symbol">BeanClassLoaderAware</span>, <span class="hljs-symbol">ResourceLoaderAware</span>, <span class="hljs-symbol">BeanFactoryAware</span>, <span class="hljs-symbol">EnvironmentAware</span>, <span class="hljs-symbol">Ordered</span></span> &#123;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">DeferredImportSelector</span> <span class="hljs-symbol">extends</span> <span class="hljs-symbol">ImportSelector</span> &#123;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">ImportSelector</span> &#123;<br>    String[] selectImports(AnnotationMetadata var1);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¸¤å±‚ç»§æ‰¿å…³ç³»å¯ä»¥çœ‹å‡º <code>AutoConfigurationImportSelector</code> ç±»å®ç°äº† <code>ImportSelector</code>æ¥å£ï¼Œè¿™æ„å‘³ç€å®ƒå®ç°äº†è¿™ä¸ªæ¥å£ä¸­çš„ <code>selectImports</code>æ–¹æ³•ï¼Œ</p><p><code>selectImports</code> æ–¹æ³•æ˜¯ <code>AutoConfigurationImportSelector</code> ç±»çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œç”¨äºæ ¹æ®å½“å‰çš„åº”ç”¨ä¸Šä¸‹æ–‡ç¯å¢ƒé€‰æ‹©åˆé€‚çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</p><p>ä»¥ä¸‹æ˜¯å¯¹è¿™ä¸ªæ–¹æ³•çš„ä»£ç æ³¨é‡Šè§£é‡Šï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;<br>    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å¯ç”¨è‡ªåŠ¨é…ç½®</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isEnabled(annotationMetadata)) &#123;<br>        <span class="hljs-comment">// å¦‚æœè‡ªåŠ¨é…ç½®æ²¡æœ‰å¯ç”¨ï¼Œåˆ™ä¸å¯¼å…¥ä»»ä½•é…ç½®</span><br>        <span class="hljs-keyword">return</span> NO_IMPORTS;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// åŠ è½½è‡ªåŠ¨é…ç½®çš„å…ƒæ•°æ®</span><br>        AutoConfigurationMetadata autoConfigurationMetadata = AutoConfigurationMetadataLoader.loadMetadata(<span class="hljs-keyword">this</span>.beanClassLoader);<br><br>        <span class="hljs-comment">// è·å–è‡ªåŠ¨é…ç½®æ¡ç›®ï¼ˆå³è‡ªåŠ¨é…ç½®ç±»çš„åˆ—è¡¨ï¼‰</span><br>        AutoConfigurationImportSelector.AutoConfigurationEntry autoConfigurationEntry = <br>                <span class="hljs-keyword">this</span>.getAutoConfigurationEntry(autoConfigurationMetadata, annotationMetadata);<br><br>        <span class="hljs-comment">// å°†è‡ªåŠ¨é…ç½®ç±»è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ•°ç»„å¹¶è¿”å›</span><br>        <span class="hljs-comment">// è¿™äº›ç±»åå°†è¢« Spring å®¹å™¨è¿›ä¸€æ­¥å¤„ç†ï¼Œä»¥å®ç°è‡ªåŠ¨é…ç½®</span><br>        <span class="hljs-keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ–¹æ³•è§£é‡Š</p></blockquote><ol><li><strong>isEnabled æ–¹æ³•</strong>:<ul><li>æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†è‡ªåŠ¨é…ç½®ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡æ£€æŸ¥æŸä¸ªç‰¹å®šçš„å±æ€§æˆ–æ¡ä»¶æ¥å†³å®šçš„ã€‚å¦‚æœè‡ªåŠ¨é…ç½®è¢«ç¦ç”¨ï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œæ„å‘³ç€ä¸è¿›è¡Œä»»ä½•è‡ªåŠ¨é…ç½®ã€‚</li></ul></li><li><strong>åŠ è½½è‡ªåŠ¨é…ç½®å…ƒæ•°æ®</strong>:<ul><li>ä½¿ç”¨ <code>AutoConfigurationMetadataLoader</code> åŠ è½½è‡ªåŠ¨é…ç½®çš„å…ƒæ•°æ®ã€‚è¿™äº›å…ƒæ•°æ®é€šå¸¸ä» <code>META-INF/spring.factories</code> æ–‡ä»¶ä¸­è¯»å–ï¼Œå…¶ä¸­åˆ—å‡ºäº†æ‰€æœ‰å¯ç”¨çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</li></ul></li><li><strong>è·å–è‡ªåŠ¨é…ç½®æ¡ç›®</strong>:<ul><li><code>getAutoConfigurationEntry</code> æ–¹æ³•æ ¹æ®å½“å‰çš„åº”ç”¨ä¸Šä¸‹æ–‡ç¯å¢ƒå’Œå·²åŠ è½½çš„å…ƒæ•°æ®ç¡®å®šå“ªäº›è‡ªåŠ¨é…ç½®ç±»åº”è¯¥è¢«æ¿€æ´»ã€‚è¿™æ¶‰åŠåˆ°ä¸€ç³»åˆ—æ¡ä»¶åŒ¹é…ï¼Œä¾‹å¦‚æ£€æŸ¥ç±»è·¯å¾„ä¸Šæ˜¯å¦å­˜åœ¨ç‰¹å®šçš„ç±»ã€‚</li></ul></li><li><strong>è¿”å›è‡ªåŠ¨é…ç½®ç±»çš„åç§°</strong>:<ul><li>æœ€åï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«åº”è¯¥æ¿€æ´»çš„è‡ªåŠ¨é…ç½®ç±»åç§°çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚Spring å®¹å™¨éšåå°†ä½¿ç”¨è¿™äº›ç±»åæ¥å®ä¾‹åŒ–ç›¸åº”çš„ Bean å®šä¹‰ã€‚</li></ul></li></ol><h4 id="2-4-getAutoConfigurationEntry"><a href="#2-4-getAutoConfigurationEntry" class="headerlink" title="2.4 getAutoConfigurationEntry"></a>2.4 getAutoConfigurationEntry</h4><p>é‡ç‚¹å…³æ³¨ä¸€ä¸‹<code>getAutoConfigurationEntry()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦èŒè´£æ˜¯æ”¶é›†æ‰€æœ‰åº”è¯¥è¢«æ¿€æ´»çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå¹¶æ ¹æ®ç»™å®šçš„æ¡ä»¶æ¥ç­›é€‰å’Œæ’é™¤æŸäº›é…ç½®ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">protected</span> AutoConfigurationImportSelector.AutoConfigurationEntry getAutoConfigurationEntry(<br>    AutoConfigurationMetadata autoConfigurationMetadata, AnnotationMetadata annotationMetadata) &#123;<br>    <br>    <span class="hljs-comment">// æ£€æŸ¥è‡ªåŠ¨é…ç½®æ˜¯å¦è¢«å¯ç”¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„é…ç½®æ¡ç›®</span><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isEnabled(annotationMetadata)) &#123;<br>        <span class="hljs-keyword">return</span> EMPTY_ENTRY;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// è·å–æ³¨è§£çš„å±æ€§</span><br>        AnnotationAttributes attributes = <span class="hljs-keyword">this</span>.getAttributes(annotationMetadata);<br>        <br>        <span class="hljs-comment">// è·å–æ‰€æœ‰å€™é€‰çš„é…ç½®ç±»</span><br>        List&lt;String&gt; configurations = <span class="hljs-keyword">this</span>.getCandidateConfigurations(annotationMetadata, attributes);<br>        <br>        <span class="hljs-comment">// ç§»é™¤é‡å¤çš„é…ç½®</span><br>        configurations = <span class="hljs-keyword">this</span>.removeDuplicates(configurations);<br>        <br>        <span class="hljs-comment">// è·å–éœ€è¦æ’é™¤çš„é…ç½®ç±»</span><br>        Set&lt;String&gt; exclusions = <span class="hljs-keyword">this</span>.getExclusions(annotationMetadata, attributes);<br>        <br>        <span class="hljs-comment">// æ£€æŸ¥æ’é™¤çš„ç±»æ˜¯å¦çœŸçš„å­˜åœ¨äºå€™é€‰é…ç½®ä¸­ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸å¦‚æœæœ‰çš„è¯</span><br>        <span class="hljs-keyword">this</span>.checkExcludedClasses(configurations, exclusions);<br>        <br>        <span class="hljs-comment">// ä»å€™é€‰é…ç½®ä¸­ç§»é™¤æ’é™¤çš„é…ç½®</span><br>        configurations.removeAll(exclusions);<br>        <br>        <span class="hljs-comment">// è¿‡æ»¤é…ç½®ï¼Œå¯èƒ½ä½¿ç”¨æ¡ä»¶æœåŠ¡ç­‰è¿›ä¸€æ­¥ç­›é€‰é…ç½®</span><br>        configurations = <span class="hljs-keyword">this</span>.filter(configurations, autoConfigurationMetadata);<br>        <br>        <span class="hljs-comment">// è§¦å‘è‡ªåŠ¨é…ç½®å¯¼å…¥ç›¸å…³äº‹ä»¶</span><br>        <span class="hljs-keyword">this</span>.fireAutoConfigurationImportEvents(configurations, exclusions);<br>        <br>        <span class="hljs-comment">// è¿”å›ä¸€ä¸ªæ–°çš„ AutoConfigurationEntry å¯¹è±¡ï¼ŒåŒ…å«æœ€ç»ˆç¡®å®šçš„é…ç½®ç±»å’Œæ’é™¤çš„ç±»</span><br>        <span class="hljs-keyword">return</span> new AutoConfigurationImportSelector.AutoConfigurationEntry(configurations, exclusions);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ–¹æ³•è§£é‡Š</p><ol><li><strong>isEnabled</strong>:<ul><li>æ£€æŸ¥æ˜¯å¦åœ¨æ³¨è§£å…ƒæ•°æ®ä¸­è®¾ç½®äº†å¯ç”¨è‡ªåŠ¨é…ç½®çš„å±æ€§ã€‚</li></ul></li></ol><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">protected</span> boolean isEnabled(AnnotationMetadata metadata) &#123;  <br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getClass() == AutoConfigurationImportSelector.<span class="hljs-keyword">class</span> ? (<span class="hljs-built_in">Boolean</span>)<span class="hljs-keyword">this</span>.getEnvironment().getProperty(<span class="hljs-string">&quot;spring.boot.enableautoconfiguration&quot;</span>, <span class="hljs-built_in">Boolean</span>.<span class="hljs-keyword">class</span>, <span class="hljs-literal">true</span>) : <span class="hljs-literal">true</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>isEnabled</code> æ–¹æ³•ä¼šåˆ¤æ–­è‡ªåŠ¨è£…é…å¼€å…³æ˜¯å¦æ‰“å¼€ã€‚</p><p>é»˜è®¤<code>spring.boot.enableautoconfiguration=true</code>ï¼Œå¯åœ¨ <code>application.properties</code> æˆ– <code>application.yml</code> ä¸­è®¾ç½®</p><ol start="2"><li><strong>getAttributes</strong>:<ul><li>æå–æ³¨è§£å…ƒæ•°æ®ä¸­çš„å±æ€§ï¼Œè¿™äº›å±æ€§å¯èƒ½ä¼šå½±å“è‡ªåŠ¨é…ç½®çš„é€‰æ‹©ã€‚</li><li>ç”¨äºè·å–<code>EnableAutoConfiguration</code>æ³¨è§£ä¸­çš„Â <code>exclude</code>Â å’ŒÂ <code>excludeName</code></li></ul></li><li><strong>getCandidateConfigurations</strong>:<ul><li>è·å–éœ€è¦è‡ªåŠ¨è£…é…çš„æ‰€æœ‰é…ç½®ç±»ï¼Œè¯»å–<code>META-INF/spring.factories</code></li></ul></li></ol><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">spring-<span class="hljs-keyword">boot</span>/spring-<span class="hljs-keyword">boot</span>-project/spring-<span class="hljs-keyword">boot</span>-autoconfigure/src/main/resources/<span class="hljs-keyword">META</span>-<span class="hljs-keyword">INF</span>/spring.factories<br></code></pre></td></tr></table></figure><p>ä¸å…‰æ˜¯å•ä¸ªä¾èµ–ä¸‹çš„<code>META-INF/spring.factories</code>è¢«è¯»å–åˆ°ï¼Œæ‰€æœ‰ Spring Boot Starter ä¸‹çš„<code>META-INF/spring.factories</code>éƒ½ä¼šè¢«è¯»å–åˆ°ã€‚</p><p>ä½ å¯ä»¥çœ‹ä¸€ä¸‹ druid æ•°æ®åº“è¿æ¥æ± çš„ Spring Boot Starter ï¼Œåœ¨å®ƒé‡Œé¢å°±åˆ›å»ºäº†<code>META-INF/spring.factories</code>æ–‡ä»¶ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231219202949.png" alt="image.png"></p><p>å¦‚æœï¼Œæˆ‘ä»¬è‡ªå·±è¦åˆ›å»ºä¸€ä¸ª Spring Boot Starterï¼Œè¿™ä¸€æ­¥æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><ol start="4"><li><strong>removeDuplicates</strong>:<ul><li>ä¿è¯é…ç½®åˆ—è¡¨ä¸­æ²¡æœ‰é‡å¤çš„æ¡ç›®ã€‚</li></ul></li><li><strong>getExclusions</strong>:<ul><li>è¯»å–æ³¨è§£å…ƒæ•°æ®ï¼Œæ‰¾å‡ºéœ€è¦ä»è‡ªåŠ¨é…ç½®ä¸­æ’é™¤çš„ç±»ã€‚</li></ul></li><li><strong>checkExcludedClasses</strong>:<ul><li>ç¡®ä¿æ’é™¤çš„ç±»æ˜¯å€™é€‰é…ç½®åˆ—è¡¨ä¸­çš„æˆå‘˜ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul></li><li><strong>configurations.removeAll(exclusions)</strong>:<ul><li>å®é™…ä»å€™é€‰é…ç½®åˆ—è¡¨ä¸­ç§»é™¤è¢«æ’é™¤çš„ç±»ã€‚</li></ul></li><li><strong>filter</strong>:<ul><li>ä½¿ç”¨ <code>AutoConfigurationMetadata</code> å¯¹å€™é€‰é…ç½®è¿›è¡Œè¿›ä¸€æ­¥çš„æ¡ä»¶ç­›é€‰ã€‚</li></ul></li><li><strong>fireAutoConfigurationImportEvents</strong>:<ul><li>å‘å¸ƒäº‹ä»¶ï¼Œè¿™å¯èƒ½ä¼šå½±å“åç»­å¤„ç†è¿‡ç¨‹ï¼Œä¾‹å¦‚é€šè¿‡ç›‘å¬å™¨æ¥è¿›ä¸€æ­¥ä¿®æ”¹é…ç½®åˆ—è¡¨ã€‚</li></ul></li><li><strong>è¿”å› AutoConfigurationEntry</strong>:<ul><li>åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª <code>AutoConfigurationEntry</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†æœ€ç»ˆç¡®å®šè¦å¯¼å…¥çš„è‡ªåŠ¨é…ç½®ç±»å’Œå·²æ’é™¤çš„ç±»ã€‚</li></ul></li></ol><p>æˆ‘ä»¬åœ¨å…·ä½“ä½¿ç”¨çš„æ—¶å€™ï¼Œ<code>spring.factories</code>ä¸­ä¼šæœ‰å¾ˆå¤šé…ç½®ï¼Œä½†æ¯æ¬¡å¯åŠ¨å¹¶ä¸æ˜¯å…¨éƒ¨åŠ è½½ï¼›</p><p>æˆ‘ä»¬ä¼šåœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ ConditionalOnxxx æ³¨è§£ï¼Œ<code>@ConditionalOnXXX</code>Â ä¸­çš„æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼Œè¯¥ç±»æ‰ä¼šç”Ÿæ•ˆã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><span class="hljs-comment">// æ£€æŸ¥ç›¸å…³çš„ç±»ï¼šRabbitTemplate å’Œ Channelæ˜¯å¦å­˜åœ¨</span><br><span class="hljs-comment">// å­˜åœ¨æ‰ä¼šåŠ è½½</span><br><span class="hljs-variable">@ConditionalOnClass</span>(&#123; RabbitTemplate.class, Channel.class &#125;)<br><span class="hljs-variable">@EnableConfigurationProperties</span>(RabbitProperties.class)<br><span class="hljs-variable">@Import</span>(RabbitAnnotationDrivenConfiguration.class)<br>public class RabbitAutoConfiguration &#123;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€æ–°å»ºä¸€ä¸ª-starter"><a href="#3ã€æ–°å»ºä¸€ä¸ª-starter" class="headerlink" title="3ã€æ–°å»ºä¸€ä¸ª starter"></a>3ã€æ–°å»ºä¸€ä¸ª starter</h3><h4 id="æµç¨‹ä»‹ç»"><a href="#æµç¨‹ä»‹ç»" class="headerlink" title="æµç¨‹ä»‹ç»"></a>æµç¨‹ä»‹ç»</h4><p>åˆ›å»ºè¿‡ç¨‹ï¼š</p><blockquote><ol><li>åˆ›å»ºé¡¹ç›®ç»“æ„</li></ol></blockquote><p>éœ€è¦åˆ›å»ºä¸€ä¸ª Mavené¡¹ç›®ã€‚</p><p>ä¸ºäº†éµå¾ª Spring Boot Starter å‘½åçº¦å®šï¼Œé¡¹ç›®çš„åç§°é€šå¸¸ä»¥ <code>spring-boot-starter-</code> å¼€å¤´ï¼Œä¾‹å¦‚ <code>spring-boot-starter-myfeature</code>ã€‚</p><blockquote><ol start="2"><li>æ·»åŠ å¿…è¦çš„ä¾èµ–</li></ol></blockquote><p>åœ¨é¡¹ç›®çš„ <code>pom.xml</code> æ–‡ä»¶ä¸­ï¼Œæ·»åŠ  Spring Boot ä»¥åŠå…¶ä»–æ‰€éœ€åº“çš„ä¾èµ–ã€‚</p><p>ç¤ºä¾‹ Maven <code>pom.xml</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- æ·»åŠ å…¶ä»–è‡ªå·± Starter éœ€è¦çš„ä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><ol start="3"><li>åˆ›å»ºè‡ªåŠ¨é…ç½®ç±»</li></ol></blockquote><p>åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®ç±»ï¼Œä½¿ç”¨ <code>@Configuration</code> æ³¨è§£ï¼Œå¹¶æ ¹æ®éœ€è¦ä½¿ç”¨ <code>@Conditional</code> æ³¨è§£æ¥æ¡ä»¶åŒ–é…ç½®ã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Configuration</span><br><span class="hljs-variable">@ConditionalOnClass</span>(MyFeature.class)<br><span class="hljs-variable">@ConditionalOnProperty</span>(prefix = <span class="hljs-string">&quot;myfeature&quot;</span>, name = <span class="hljs-string">&quot;enabled&quot;</span>, havingValue = <span class="hljs-string">&quot;true&quot;</span>, matchIfMissing = true)<br>public class MyFeatureAutoConfiguration &#123;<br><br>    <span class="hljs-variable">@Bean</span><br>    <span class="hljs-variable">@ConditionalOnMissingBean</span><br>    public MyFeature <span class="hljs-built_in">myFeature</span>() &#123;<br>        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">MyFeature</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ol start="4"><li>åˆ›å»º <code>spring.factories</code> æ–‡ä»¶</li></ol></blockquote><p>åœ¨é¡¹ç›®çš„èµ„æºç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª <code>META-INF/spring.factories</code> æ–‡ä»¶ï¼Œå¹¶æŒ‡å®šè‡ªåŠ¨é…ç½®ç±»ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.autoconfigure</span>.EnableAutoConfiguration=\<br>com<span class="hljs-selector-class">.example</span>.MyFeatureAutoConfiguration<br></code></pre></td></tr></table></figure><blockquote><ol start="5"><li>é…ç½®å±æ€§ç±»ï¼ˆå¯é€‰ï¼‰</li></ol></blockquote><p>å¦‚æœä½ çš„ Starter éœ€è¦é…ç½®å±æ€§ï¼Œåˆ›å»ºä¸€ä¸ªå±æ€§ç±»ä½¿ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@ConfigurationProperties(prefix = <span class="hljs-string">&quot;myfeature&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFeatureProperties</span> &#123;<br>    <span class="hljs-keyword">private</span> boolean enabled = <span class="hljs-literal">true</span>;<br>    <span class="hljs-comment">// ... å…¶ä»–å±æ€§å’Œgetter/setter</span><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ol start="6"><li>æµ‹è¯• Starter</li></ol></blockquote><p>åˆ›å»ºä¸€ä¸ªç®€å•çš„ Spring Boot åº”ç”¨æ¥éªŒè¯ Starter æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStarterTestApp</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">MyStarterTestApp</span>.<span class="hljs-property">class</span>, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ol start="7"><li>æ‰“åŒ…å’Œå‘å¸ƒ</li></ol></blockquote><p>ä½¿ç”¨ Maven å°† Starter æ‰“åŒ…ï¼Œå¹¶å‘å¸ƒåˆ° Maven ä¸­å¤®ä»“åº“æˆ–ç§æœ‰ä»“åº“ï¼Œä½¿å¾—å…¶ä»–é¡¹ç›®å¯ä»¥æ·»åŠ ä¾èµ–ä½¿ç”¨ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-string">`mvn clean install`</span><br></code></pre></td></tr></table></figure><p>åŒæ—¶æœ€å¥½ç¼–å†™æ¸…æ™°çš„æ–‡æ¡£ï¼Œè¯´æ˜å¦‚ä½•æ·»åŠ  Starter çš„ä¾èµ–ï¼Œä»¥åŠå¦‚ä½•é…ç½®å’Œä½¿ç”¨æä¾›çš„åŠŸèƒ½ã€‚</p><blockquote><p>æ€»ç»“</p></blockquote><p>Spring Boot é€šè¿‡<code>@EnableAutoConfiguration</code>å¼€å¯è‡ªåŠ¨è£…é…ï¼Œ</p><p>é€šè¿‡ SpringFactoriesLoader æœ€ç»ˆåŠ è½½<code>META-INF/spring.factories</code>ä¸­çš„è‡ªåŠ¨é…ç½®ç±»å®ç°è‡ªåŠ¨è£…é…ï¼Œ</p><p>è‡ªåŠ¨é…ç½®ç±»å…¶å®å°±æ˜¯é€šè¿‡<code>@Conditional</code>æŒ‰éœ€åŠ è½½çš„é…ç½®ç±»ï¼Œæƒ³è¦å…¶ç”Ÿæ•ˆå¿…é¡»å¼•å…¥<code>spring-boot-starter-xxx</code>åŒ…å®ç°èµ·æ­¥ä¾èµ–</p><hr><p>å¸¸è§çš„ä¸€äº›é—®é¢˜ï¼š</p><blockquote><p>SpringBoot çš„ starter å’Œ æ‰“åŒ…ä¸º maven ä¾èµ–æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œåœ¨ä»€ä¹ˆå®é™…ä½¿ç”¨åœºæ™¯ä¸‹ä¼šè€ƒè™‘ä½¿ç”¨ï¼Ÿ</p></blockquote><p>å‰è€… starter æ›´å€¾å‘äºæŸä¸ªç¨‹åºå¯åŠ¨ï¼Œå®ƒå†…éƒ¨æ˜¯åŒ…å«äº† SpringBoot å¯åŠ¨ç±»çš„ï¼Œé€šå¸¸å°è£…äº†ç»Ÿä¸€é…ç½®ï¼Œéšè—äº†å®ç°ç»†èŠ‚ã€‚</p><p>åè€…æ›´å€¾å‘äºæ˜¯æŸä¸€ä¸ªå…¬å…±æœåŠ¡ï¼Œç„¶ååœ¨å¤šä¸ªæ¨¡å—ä¸­å¼•å…¥è¿™ä¸ªä¾èµ–ï¼ˆå¯ä»¥å°†è¿™ä¸ªå…¬å…±æœåŠ¡æ‰“åŒ…ä¸ºä¸€ä¸ª mavne ä¾èµ–ä»¥ä¾›å…¶ä»–æ¨¡å—è°ƒç”¨ï¼‰</p><hr><h4 id="æ‰‹æ’¸ä¸€ä¸ª-Starterï¼ˆè§†é¢‘å­¦ä¹ ï¼‰"><a href="#æ‰‹æ’¸ä¸€ä¸ª-Starterï¼ˆè§†é¢‘å­¦ä¹ ï¼‰" class="headerlink" title="æ‰‹æ’¸ä¸€ä¸ª Starterï¼ˆè§†é¢‘å­¦ä¹ ï¼‰"></a>æ‰‹æ’¸ä¸€ä¸ª Starterï¼ˆè§†é¢‘å­¦ä¹ ï¼‰</h4><p>è§†é¢‘å­¦ä¹ ï¼š <a href="https://www.bilibili.com/video/BV1Zu4116714">https://www.bilibili.com/video/BV1Zu4116714</a></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261636199.png" alt="image.png"></p><blockquote><p>Maven ä¸­çš„å¯é€‰ä¾èµ–</p></blockquote><p>å¯é€‰ä¾èµ–(Optional) çš„ä½œç”¨ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401261638244.png" alt="image.png"></p><blockquote><p>ä» 0 å¼€å§‹ï¼Œæ‰‹æ’¸ä¸€ä¸ª Starter çš„åº”ç”¨å®ä¾‹</p></blockquote><p><strong>åº”ç”¨å®ä¾‹çš„èƒŒæ™¯ä»‹ç»</strong></p><p>åœ¨SpringCloudå¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¾€å¾€éœ€è¦åœ¨AæœåŠ¡ä¸­è°ƒç”¨BæœåŠ¡çš„ã€‚</p><p>ä¾‹å¦‚ï¼Œè¥é”€å¾®æœåŠ¡ ms-marketing éœ€è¦è°ƒç”¨ç”¨æˆ·å¾®æœåŠ¡ ms-user ä¸­çš„æ¥å£ã€‚</p><p>ç—›ç‚¹ï¼š ms-marketing å¦‚ä½• â€œä¸€ç«™å¼â€ åœ°è°ƒç”¨ ms-user ä¸­çš„æ¥å£</p><ul><li>ä¸ç”¨å…³å¿ƒè¢«è°ƒç”¨æ¥å£çš„ uri</li><li>ä¸éœ€è¦è‡ªåŠ¨æ„å»ºè¢«è°ƒç”¨æ¥å£çš„å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹</li></ul><p>æœ€ä½³å®è·µï¼šä½¿ç”¨ SpringBoot çš„è‡ªåŠ¨é…ç½®ï¼Œæ„å»º me-user çš„ Starter</p><p>Gitee åœ°å€ï¼š <a href="https://gitee.com/cnmemset/spring-boot-starter-example/tree/master/ms-user">https://gitee.com/cnmemset/spring-boot-starter-example/tree/master/ms-user</a></p><h5 id="1ã€æ–°å»ºä¸€ä¸ª-Maven-é¡¹ç›®-ms-user"><a href="#1ã€æ–°å»ºä¸€ä¸ª-Maven-é¡¹ç›®-ms-user" class="headerlink" title="1ã€æ–°å»ºä¸€ä¸ª Maven é¡¹ç›® ms-user"></a>1ã€æ–°å»ºä¸€ä¸ª Maven é¡¹ç›® ms-user</h5><p> å…ˆä¸å»ºè®®æ¨¡å—ï¼Œåˆ é™¤å¤šä½™çš„æ–‡ä»¶å¤¹</p><p>å¼•å…¥ä¸€ä¸‹ä¾èµ–ï¼ˆçˆ¶æ¨¡å—ä¾èµ–ç®¡ç†ï¼‰</p><p>pom.xml æ–‡ä»¶å†…å®¹</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.user<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>ms-user-parent<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>ç”¨æˆ·å¾®æœåŠ¡é¡¹ç›®<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">spring.cloud.version</span>&gt;</span>3.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">spring.cloud.version</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;spring.cloud.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;spring.cloud.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ms-user-web<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ms-user-api<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ms-user-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ms-user-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦æ˜¯å¼•å…¥äº†ï¼š spring-cloud-starterã€spring-cloud-starter-openfeign ä¾èµ–</p><p>åŒæ—¶ä½¿ç”¨ properties è¿›è¡Œä¾èµ–ç‰ˆæœ¬ç®¡ç†ï¼Œé€šè¿‡ dependencyManagement æ ‡ç­¾è¿›è¡Œ å¤šæ¨¡å—é¡¹ç›®ä¸­ç®¡ç†ä¾èµ–é¡¹çš„ç‰ˆæœ¬å·å’ŒèŒƒå›´</p><p>çˆ¶ä¾èµ–æ˜¯ spring-boot-starter-parentï¼›æ³¨æ„ä¸€ä¸‹ç‰ˆæœ¬ã€‚</p><h5 id="2ã€æ–°å»ºæ¨¡å—-ms-user-web"><a href="#2ã€æ–°å»ºæ¨¡å—-ms-user-web" class="headerlink" title="2ã€æ–°å»ºæ¨¡å— ms-user-web"></a>2ã€æ–°å»ºæ¨¡å— ms-user-web</h5><p>ms-user-web</p><p>æ–°å»ºå¯åŠ¨ç±»ï¼Œæ·»åŠ ä¸€ä¸ª Controller ç±»</p><p>Application</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript">package cn.<span class="hljs-property">memset</span>.<span class="hljs-property">user</span>.<span class="hljs-property">web</span>;  <br>  <br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;  <br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;  <br>  <br><span class="hljs-meta">@SpringBootApplication</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;  <br>        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">Application</span>.<span class="hljs-property">class</span>, args);  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>UserController</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> cn.memset.user.web.controllers;  <br>  <br><span class="hljs-keyword">import</span> cn.memset.user.api.dto.User;  <br><span class="hljs-keyword">import</span> cn.memset.user.api.feign.UserFeignClient;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;  <br>  <br><span class="hljs-keyword">import</span> java.util.HashMap;  <br><span class="hljs-keyword">import</span> java.util.Map;  <br>  <br><span class="hljs-meta">@RestController  </span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">UserFeignClient</span></span> </span>&#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Long, User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-type">HashMap</span>&lt;&gt;();  <br>  <br>    <span class="hljs-keyword">static</span> &#123;  <br>        users.put(<span class="hljs-number">10000</span>L, <span class="hljs-keyword">new</span> <span class="hljs-type">User</span>(<span class="hljs-number">10000</span>L, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>));  <br>        users.put(<span class="hljs-number">10001</span>L, <span class="hljs-keyword">new</span> <span class="hljs-type">User</span>(<span class="hljs-number">10001</span>L, <span class="hljs-string">&quot;æå››&quot;</span>));  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@Override  </span><br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/get/&#123;userId&#125;&quot;</span>)  <br>    <span class="hljs-keyword">public</span> User getUserById(<span class="hljs-meta">@PathVariable</span>(<span class="hljs-string">&quot;userId&quot;</span>) long userId) &#123;  <br>        <span class="hljs-keyword">return</span> users.<span class="hljs-keyword">get</span>(userId);  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ resources å¯¹åº”æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶ï¼šapplication.ymlã€banner.txtã€logback-spring.xml</p><p>logback-spring.xml</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">springProperty</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;context&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;APP_NAME&quot;</span> <span class="hljs-attr">source</span>=<span class="hljs-string">&quot;spring.application.name&quot;</span> <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- å¼€å‘ç¯å¢ƒçš„æ—¥å¿— --&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_PATH&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;logs&quot;</span>/&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿— --&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prd&quot;</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_PATH&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/var/www/logs/$</span></span></span><span class="hljs-template-variable">&#123;APP_NAME&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">/&quot;</span>/&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- å½“spring-bootæœªæˆåŠŸåŠ è½½çš„æ—¶å€™ï¼Œé»˜è®¤çš„æ—¥å¿—è·¯å¾„ --&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_PATH&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;LOG_PATH:-$&#123;LOG_TEMP:-$&#123;java.io.tmpdir:-/tmp&#125;</span><span class="language-xml"><span class="hljs-tag"><span class="hljs-string">&#125;&#125;&quot;</span>/&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- Console appender --&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CONSOLE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d</span><span class="hljs-template-variable">&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;</span><span class="language-xml"> [%thread] %-5level %logger::%M - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- File appender  --&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-comment">&lt;!-- æŒ‰å¤©å›æ»š daily --&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;LOG_PATH&#125;</span><span class="language-xml">/info-%d</span><span class="hljs-template-variable">&#123;yyyy-MM-dd&#125;</span><span class="language-xml">.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-comment">&lt;!-- æ—¥å¿—æœ€å¤§çš„å†å² 60å¤© --&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>60<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d</span><span class="hljs-template-variable">&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;</span><span class="language-xml"> [%thread] %-5level %logger::%M - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">charset</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">charset</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- å¼€å‘ç¯å¢ƒçš„æ—¥å¿— --&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dev&quot;</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;CONSOLE&quot;</span>/&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;FILE&quot;</span>/&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml">    <span class="hljs-comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒçš„æ—¥å¿— --&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prd&quot;</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;FILE&quot;</span>/&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>banner.txt</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext">   <span class="hljs-bullet">-</span> <span class="hljs-string">` -  </span><br>(*ï¿£(ã‚¨)ï¿£)  <br>   <span class="hljs-bullet">-</span> <span class="hljs-string">  -</span><br></code></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>  <br>  <span class="hljs-attr">servlet:</span>  <br>    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/</span>  <br>    <span class="hljs-attr">session:</span>  <br>      <span class="hljs-attr">timeout:</span> <span class="hljs-number">60</span>  <br><span class="hljs-attr">spring:</span>  <br>  <span class="hljs-attr">jackson:</span>  <br>    <span class="hljs-attr">time-zone:</span> <span class="hljs-string">GMT+8</span>  <br>    <span class="hljs-attr">date-format:</span> <span class="hljs-string">yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss</span>  <br>    <span class="hljs-attr">joda-date-time-format:</span> <span class="hljs-string">yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss</span>  <br>  <span class="hljs-attr">profiles:</span>  <br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span>  <br>  <span class="hljs-attr">application:</span>  <br>    <span class="hljs-attr">name:</span> <span class="hljs-string">ms-user</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨æµ‹è¯•ä¸€ä¸‹è®¿é—®ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://localhost:<span class="hljs-number">8080</span>/get/<span class="hljs-number">10000</span><br></code></pre></td></tr></table></figure><h5 id="3ã€æ–°å»ºæ¨¡å—-ms-user-api"><a href="#3ã€æ–°å»ºæ¨¡å—-ms-user-api" class="headerlink" title="3ã€æ–°å»ºæ¨¡å— ms-user-api"></a>3ã€æ–°å»ºæ¨¡å— ms-user-api</h5><p>pom.xml </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.user<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>  <br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>ms-user-api<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>å¾®æœåŠ¡ms-useræä¾›çš„APIå·¥å…·åº“<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>  <br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªå®ä½“ç±» User</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs arduino">package cn.memset.user.api.dto;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> id;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> name;  <br>  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(<span class="hljs-type">long</span> id, <span class="hljs-type">String</span> name)</span> </span>&#123;  <br>        <span class="hljs-keyword">this</span>.id = id;  <br>        <span class="hljs-keyword">this</span>.name = name;  <br>    &#125;  <br>  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;  <br>        <span class="hljs-keyword">return</span> id;  <br>    &#125;  <br>  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span> </span>&#123;  <br>        <span class="hljs-keyword">this</span>.id = id;  <br>    &#125;  <br>  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;  <br>        <span class="hljs-keyword">return</span> name;  <br>    &#125;  <br>  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(<span class="hljs-type">String</span> name)</span> </span>&#123;  <br>        <span class="hljs-keyword">this</span>.name = name;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªè¿œç¨‹è°ƒç”¨çš„ç±»ï¼šUserFeignClient</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> cn.memset.user.api.feign;  <br>  <br><span class="hljs-keyword">import</span> cn.memset.user.api.dto.User;  <br><span class="hljs-keyword">import</span> org.slf4j.Logger;  <br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;  <br><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FallbackFactory;  <br><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;  <br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PathVariable;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.ResponseBody;  <br>  <br><span class="hljs-meta">@FeignClient(name = <span class="hljs-string">&quot;ms-user&quot;</span>,  </span><br><span class="hljs-meta">        url = <span class="hljs-string">&quot;<span class="hljs-subst">$&#123;cnmemset.ms-user.url:<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8080</span>&#125;</span>&quot;</span>,  </span><br><span class="hljs-meta">        fallbackFactory = UserFeignClient.UserFallbackFactory.class)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserFeignClient</span> &#123;  <br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/get/&#123;userId&#125;&quot;</span>)</span>  <br>    <span class="hljs-meta">@ResponseBody</span>  <br>    <span class="hljs-keyword">public</span> User getUserById(<span class="hljs-meta">@PathVariable(<span class="hljs-string">&quot;userId&quot;</span>)</span> long userId);  <br>  <br>    <span class="hljs-meta">@Component</span>  <br>    <span class="hljs-keyword">public</span> static <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserFallbackFactory</span> <span class="hljs-title">implements</span> <span class="hljs-title">FallbackFactory</span>&lt;<span class="hljs-type">UserFeignClient</span>&gt; &#123;  <br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(UserFallbackFactory.<span class="hljs-keyword">class</span>);  <br>  <br>        <span class="hljs-meta">@Override</span>  <br>        <span class="hljs-keyword">public</span> UserFeignClient create(Throwable cause) &#123;  <br>            <span class="hljs-keyword">return</span> new UserFeignClient() &#123;  <br>                <span class="hljs-meta">@Override</span>  <br>                <span class="hljs-keyword">public</span> User getUserById(long userId) &#123;  <br>                    logger.error(<span class="hljs-string">&quot;è°ƒç”¨ms-userå‘ç”Ÿå¼‚å¸¸ï¼š&quot;</span>, cause);  <br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <br>                &#125;  <br>            &#125;;  <br>        &#125;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>UserFeignMarker</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> cn.memset.user.api.feign;  <br>  <br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">UserFeignMarker</span> </span>&#123;  <br>&#125;<br></code></pre></td></tr></table></figure><h5 id="4ã€æ–°å»ºæ¨¡å—-ms-user-autoconfigure"><a href="#4ã€æ–°å»ºæ¨¡å—-ms-user-autoconfigure" class="headerlink" title="4ã€æ–°å»ºæ¨¡å—  ms-user-autoconfigure"></a>4ã€æ–°å»ºæ¨¡å—  ms-user-autoconfigure</h5><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.user<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>  <br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>ms-user-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>ms-userçš„è‡ªåŠ¨é…ç½®æ¨¡å—<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>  <br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>  <br>    <span class="hljs-comment">&lt;!-- å¿…è¦çš„ä¾èµ– --&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-comment">&lt;!-- å¯é€‰çš„ä¾èµ– --&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.user<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-comment">&lt;!-- ä¸€äº›å¯é€‰çš„ã€ä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨çš„æ³¨è§£è§£æå™¨ --&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-comment">&lt;!-- å•å…ƒæµ‹è¯• --&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ–°å»ºé…ç½®ç±»ï¼šMsUserAutoConfiguration</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> cn.memset.user.autoconfigure;  <br>  <br><span class="hljs-keyword">import</span> cn.memset.user.api.feign.UserFeignClient;  <br><span class="hljs-keyword">import</span> cn.memset.user.api.feign.UserFeignMarker;  <br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnClass;  <br><span class="hljs-keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;  <br><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;  <br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;  <br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Import;  <br>  <br><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>  <br><span class="hljs-meta">@ConditionalOnClass(UserFeignMarker.class)</span>  <br><span class="hljs-meta">@EnableFeignClients(basePackageClasses = UserFeignMarker.class)</span>  <br><span class="hljs-meta">@EnableConfigurationProperties(MsUserConfiguration.class)</span>  <br><span class="hljs-meta">@Import(&#123;UserFeignClient.UserFallbackFactory.class&#125;)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MsUserAutoConfiguration</span> &#123;  <br>  <br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨è§£ä½¿ç”¨è®²è¿°ï¼š</p><ul><li><code>@Configuration</code> æ³¨è§£è¡¨æ˜è¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»</li><li><code>@ConditionalOnClass</code> æ³¨è§£è¡¨ç¤ºæ¡ä»¶é…ç½®ã€‚å½“ç±»è·¯å¾„ä¸Šå­˜åœ¨ç‰¹å®šçš„ç±»æ—¶ï¼Œç›¸å…³çš„é…ç½®æ‰ä¼šç”Ÿæ•ˆã€‚</li><li><code>@EnableFeignClients</code> æ³¨è§£ç”¨äºå¯ç”¨ Feign å®¢æˆ·ç«¯ï¼›<ul><li>é€šè¿‡æŒ‡å®š <code>basePackageClasses</code> æˆ– <code>basePackages</code> å±æ€§ï¼ŒSpring ä¼šåœ¨æŒ‡å®šçš„åŒ…æˆ–ç±»ä¸­æŸ¥æ‰¾ <code>@FeignClient</code> æ³¨è§£ï¼Œå¹¶ä¸ºå®ƒä»¬åˆ›å»ºä»£ç†ã€‚</li><li><code>basePackageClasses = UserFeignMarker.class</code> æŒ‡ç¤º Spring åœ¨ <code>UserFeignMarker</code> æ‰€åœ¨çš„åŒ…ä¸­æŸ¥æ‰¾ <code>@FeignClient</code> æ³¨è§£å¹¶è¿›è¡Œå¤„ç†</li></ul></li><li><code>@EnableConfigurationProperties</code> æ³¨è§£ç”¨äºå¯ç”¨å¯¹ <code>@ConfigurationProperties</code> æ³¨è§£ç±»çš„æ”¯æŒï¼Œè¿™äº›ç±»é€šå¸¸ç”¨äºå®šä¹‰é…ç½®å±æ€§ã€‚</li><li><code>@Import</code> æ³¨è§£ç”¨äºå¯¼å…¥å…¶ä»–é…ç½®ç±»æˆ–ä¸€ç»„ç»„ä»¶ç±»ã€‚</li></ul><p>MsUserConfiguration</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript">package cn.<span class="hljs-property">memset</span>.<span class="hljs-property">user</span>.<span class="hljs-property">autoconfigure</span>;  <br>  <br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">context</span>.<span class="hljs-property">properties</span>.<span class="hljs-property">ConfigurationProperties</span>;  <br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Configuration</span>;  <br>  <br><span class="hljs-meta">@Configuration</span>(proxyBeanMethods = <span class="hljs-literal">false</span>)  <br><span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">&quot;cnmemset.ms-user&quot;</span>)  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MsUserConfiguration</span> &#123;  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * å¾®æœåŠ¡ms-userçš„url  </span><br><span class="hljs-comment">     */</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> url = <span class="hljs-string">&quot;127.0.0.1:8080&quot;</span>;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUrl</span>(<span class="hljs-params"></span>) &#123;  <br>        <span class="hljs-keyword">return</span> url;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setUrl</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> url</span>) &#123;  <br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span> = url;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ resources æ–°å»ºæ–‡ä»¶å¤¹  META-INF</p><p>è¯¥æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶  spring.factories</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># Auto Configure  </span><br>org.springframework.boot.autoconfigure.<span class="hljs-attribute">EnableAutoConfiguration</span>=\  <br>cn.memset.user.autoconfigure.MsUserAutoConfiguration<br></code></pre></td></tr></table></figure><h5 id="5ã€æ–°å»ºæ¨¡å—-ms-user-spring-boot-starter"><a href="#5ã€æ–°å»ºæ¨¡å—-ms-user-spring-boot-starter" class="headerlink" title="5ã€æ–°å»ºæ¨¡å— ms-user-spring-boot-starter"></a>5ã€æ–°å»ºæ¨¡å— ms-user-spring-boot-starter</h5><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.user<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>  <br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>ms-user-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>ms-userçš„è‡ªåŠ¨é…ç½®Starteræ¨¡å—<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>  <br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>  <br>    <span class="hljs-comment">&lt;!-- å¿…éœ€çš„åŸºç¡€çš„ spring-boot çš„ starter ä¾èµ– --&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-comment">&lt;!-- è‡ªåŠ¨é…ç½®æ¨¡å—çš„ä¾èµ– --&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.user<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-comment">&lt;!-- APIæ¨¡å—çš„ä¾èµ– --&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.user<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-comment">&lt;!-- å•å…ƒæµ‹è¯•çš„ä¾èµ– --&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…¶ä»–å†…å®¹ä¸ç”¨æ·»åŠ ã€‚</p><h5 id="6ã€ms-user-é¡¹ç›®æ€»ç»“-ğŸ”º"><a href="#6ã€ms-user-é¡¹ç›®æ€»ç»“-ğŸ”º" class="headerlink" title="6ã€ms-user é¡¹ç›®æ€»ç»“  ğŸ”º"></a>6ã€ms-user é¡¹ç›®æ€»ç»“  ğŸ”º</h5><p>åœ¨ä¸Šè¿°æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªåŸºäº Spring Boot çš„å¾®æœåŠ¡é¡¹ç›® <code>ms-user</code>ï¼Œ</p><p>å®ƒåŒ…æ‹¬äº†å‡ ä¸ªå­æ¨¡å—ï¼Œå¦‚ <code>ms-user-web</code>ã€<code>ms-user-api</code>ã€<code>ms-user-autoconfigure</code> å’Œ <code>ms-user-spring-boot-starter</code>ã€‚</p><ul><li><code>ms-user-web</code>: Webå±‚ï¼Œå¤„ç†HTTPè¯·æ±‚ï¼Œæä¾›RESTfulæœåŠ¡ã€‚<ul><li><code>UserController</code>: æ§åˆ¶å™¨ï¼Œå“åº”<code>/get/&#123;userId&#125;</code>è·¯å¾„çš„è¯·æ±‚ã€‚</li></ul></li><li><code>ms-user-api</code>: APIå±‚ï¼Œå®šä¹‰äº†æœåŠ¡æ¥å£å’Œæ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰ã€‚<ul><li><code>User</code>: ç”¨æˆ·å®ä½“ç±»ï¼Œè¡¨ç¤ºç”¨æˆ·æ•°æ®ã€‚</li><li><code>UserFeignClient</code>: å®šä¹‰äº†ä¸€ä¸ªFeignå®¢æˆ·ç«¯ï¼Œç”¨äºå¾®æœåŠ¡é—´çš„é€šä¿¡ã€‚</li></ul></li><li><code>ms-user-autoconfigure</code>: è‡ªåŠ¨é…ç½®æ¨¡å—ï¼Œç”¨äºé…ç½®é¡¹ç›®ä¸­çš„ç‰¹å®šBeanå’Œå±æ€§ã€‚<ul><li>è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒæ¨¡å—<ul><li>è‡ªåŠ¨é…ç½®ç±»<ul><li><code>MsUserAutoConfiguration</code> ç±»ä½¿ç”¨äº† <code>@ConditionalOnClass</code> å’Œ <code>@EnableFeignClients</code> æ³¨è§£ï¼Œç¡®ä¿åœ¨æ­£ç¡®çš„æ¡ä»¶ä¸‹è‡ªåŠ¨é…ç½® Feign å®¢æˆ·ç«¯ã€‚</li></ul></li><li><code>spring.factories</code> é…ç½®æ–‡ä»¶<ul><li><code>spring.factories</code> æ–‡ä»¶åœ¨ <code>ms-user-autoconfigure</code> æ¨¡å—ä¸­å®šä¹‰äº†è‡ªåŠ¨é…ç½®ç±»ï¼Œç¡®ä¿ Spring Boot èƒ½å¤Ÿè‡ªåŠ¨åŠ è½½é…ç½®ã€‚</li></ul></li><li>æ‰€éœ€çš„é…ç½®é¡¹ï¼ˆé€šè¿‡æ³¨è§£ @EnableConfigurationProperties å’Œ @ConfigurationProperties æ¥å®ç°ï¼‰</li></ul></li><li>å€¼å¾—æ³¨æ„ï¼šä»–å¯é€‰ä¾èµ–äº ms-user-api</li></ul></li><li><code>ms-user-spring-boot-starter</code>: Starteræ¨¡å—ï¼Œä¾¿äºå…¶ä»–æœåŠ¡å¼•å…¥è¯¥æ¨¡å—çš„åŠŸèƒ½ã€‚<ul><li>é€šå¸¸æ˜¯ä¸€ä¸ªç©ºçš„ Jar åŒ…</li><li>å¯¹ä¾èµ–è¿›è¡Œé›†ä¸­ç®¡ç†<ul><li>å¿…è¦æ˜¯ SpringBoot æ ¸å¿ƒ starter</li><li>ms-user-autoconfigure æ¨¡å—</li><li>ms-user-api æ¨¡å—</li></ul></li></ul></li></ul><p>å¦‚æœè¦ä½¿ç”¨ <code>ms-user-spring-boot-starter</code> çš„è¯ï¼Œåªéœ€æ·»åŠ  <code>ms-user-spring-boot-starter</code> ä¾èµ–ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨å¦ä¸€ä¸ª Spring Boot é¡¹ç›®çš„ <code>pom.xml</code> ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.user<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="7ã€æ–°å»ºé¡¹ç›®-ms-marketing"><a href="#7ã€æ–°å»ºé¡¹ç›®-ms-marketing" class="headerlink" title="7ã€æ–°å»ºé¡¹ç›® ms-marketing"></a>7ã€æ–°å»ºé¡¹ç›® ms-marketing</h5><p>çˆ¶ pom.xml</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>ms-marketing-web<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.marketing<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-marketing<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>ms-marketing-parent<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">spring.cloud.version</span>&gt;</span>3.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">spring.cloud.version</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>  </span><br><span class="language-xml">  </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;spring.cloud.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;spring.cloud.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  </span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.10.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  </span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  </span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>  </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h5 id="8ã€æ–°å»ºæ¨¡å—-ms-marketing-web"><a href="#8ã€æ–°å»ºæ¨¡å—-ms-marketing-web" class="headerlink" title="8ã€æ–°å»ºæ¨¡å— ms-marketing-web"></a>8ã€æ–°å»ºæ¨¡å— ms-marketing-web</h5><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-marketing<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.marketing<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>  <br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-marketing-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>ms-marketing-web<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>è¥é”€å¾®æœåŠ¡çš„webåº”ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>  <br>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-comment">&lt;!-- ms-user è‡ªåŠ¨é…ç½®çš„ Starter --&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.user<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>resources æ–‡ä»¶å¤¹ä¸‹æ–°å»º application.ymlã€banner.txtã€logback-spring.xml</p><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <br>  <span class="hljs-attr">port:</span> <span class="hljs-number">12080</span>  <br>  <span class="hljs-attr">servlet:</span>  <br>    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/</span>  <br>    <span class="hljs-attr">session:</span>  <br>      <span class="hljs-attr">timeout:</span> <span class="hljs-number">60</span>  <br><span class="hljs-attr">spring:</span>  <br>  <span class="hljs-attr">jackson:</span>  <br>    <span class="hljs-attr">time-zone:</span> <span class="hljs-string">GMT+8</span>  <br>    <span class="hljs-attr">date-format:</span> <span class="hljs-string">yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss</span>  <br>    <span class="hljs-attr">joda-date-time-format:</span> <span class="hljs-string">yyyy-MM-dd</span> <span class="hljs-string">HH:mm:ss</span>  <br>  <span class="hljs-attr">profiles:</span>  <br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span>  <br>  <span class="hljs-attr">application:</span>  <br>    <span class="hljs-attr">name:</span> <span class="hljs-string">ms-marketing</span>  <br>  <br><span class="hljs-attr">feign:</span>  <br>  <span class="hljs-attr">circuitbreaker:</span>  <br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>  <br>  <br><span class="hljs-attr">cnmemset:</span>  <br>  <span class="hljs-attr">ms-user:</span>  <br>    <span class="hljs-attr">url:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8080</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ å¯åŠ¨ç±»</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript">package cn.<span class="hljs-property">memset</span>.<span class="hljs-property">marketing</span>.<span class="hljs-property">web</span>;  <br>  <br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;  <br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;  <br>  <br><span class="hljs-meta">@SpringBootApplication</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> &#123;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;  <br>        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">Application</span>.<span class="hljs-property">class</span>, args);  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>æ–°å»º Controller ç±»  GreetingController</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> cn.memset.marketing.web.controllers;  <br>  <br><span class="hljs-keyword">import</span> cn.memset.user.api.dto.User;  <br><span class="hljs-keyword">import</span> cn.memset.user.api.feign.UserFeignClient;  <br><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;  <br><span class="hljs-keyword">import</span> org.springframework.util.StringUtils;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PathVariable;  <br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;  <br>  <br><span class="hljs-meta">@RestController</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreetingController</span> &#123;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserFeignClient userFeignClient;  <br>  <br>    <span class="hljs-meta">@Autowired</span>  <br>    <span class="hljs-keyword">public</span> GreetingController(UserFeignClient userFeignClient) &#123;  <br>        <span class="hljs-keyword">this</span>.userFeignClient = userFeignClient;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/hello/&#123;userId&#125;&quot;</span>)</span>  <br>    <span class="hljs-keyword">public</span> String sayHi(<span class="hljs-meta">@PathVariable(<span class="hljs-string">&quot;userId&quot;</span>)</span> long userId) &#123;  <br>        User user = userFeignClient.getUserById(userId);  <br>  <br>        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || !StringUtils.hasLength(user.getName())) &#123;  <br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, åŒ¿åè€…&quot;</span>;  <br>        &#125;  <br>  <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, &quot;</span> + user.getName();  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å­æ¨¡å—ä¸­ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å¼•å…¥  API æ¨¡å—ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- APIæ¨¡å—çš„ä¾èµ– --&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.memset.user<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ms-user-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åŒºåˆ«ï¼š</p><ul><li>å¦‚æœä½ éœ€è¦å¿«é€Ÿå¯åŠ¨å¹¶ä¸”æ„¿æ„æ¥å— Starter æä¾›çš„é»˜è®¤é…ç½®ï¼Œé‚£ä¹ˆå¼•å…¥ <code>ms-user-spring-boot-starter</code> æ˜¯ä¸€ä¸ªå¥½é€‰æ‹©ã€‚</li><li>å¦‚æœä½ éœ€è¦æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œæˆ–è€… Starter åŒ…å«ä½ ä¸éœ€è¦çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨ <code>ms-user-api</code> å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</li></ul><h5 id="9ã€æ³¨è§£è§£æå™¨"><a href="#9ã€æ³¨è§£è§£æå™¨" class="headerlink" title="9ã€æ³¨è§£è§£æå™¨"></a>9ã€æ³¨è§£è§£æå™¨</h5><p>ä¸€äº›å¯é€‰çš„ã€ä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨çš„æ³¨è§£è§£æå™¨</p><p>åœ¨ä¸Šé¢çš„é¡¹ç›®ä¸­ï¼Œæ¨¡å— ms-user-autoconfigure  æœ‰å¼•å…¥è¿‡ä¸‹é¢ä¸¤ä¸ªä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ä¸€äº›å¯é€‰çš„ã€ä½†å¼ºçƒˆå»ºè®®ä½¿ç”¨çš„æ³¨è§£è§£æå™¨ --&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨ Spring Boot ä¸­ï¼Œ<code>spring-boot-configuration-processor</code> å’Œ <code>spring-boot-autoconfigure-processor</code> æ˜¯ä¸¤ç§ç‰¹åˆ«çš„æ³¨è§£å¤„ç†å™¨ã€‚</p><p>å®ƒä»¬åœ¨ç¼–è¯‘é˜¶æ®µå·¥ä½œï¼Œç”¨äºç”Ÿæˆå’Œå¤„ç†æ³¨è§£çš„å…ƒæ•°æ®ã€‚</p><p><code>spring-boot-configuration-processor</code> ä¸»è¦ç”¨äºå¢å¼ºé…ç½®å±æ€§çš„å¼€å‘ä½“éªŒï¼Œè€Œ <code>spring-boot-autoconfigure-processor</code> ç”¨äºä¼˜åŒ– Spring Boot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶ã€‚</p><h6 id="spring-boot-configuration-processor"><a href="#spring-boot-configuration-processor" class="headerlink" title="spring-boot-configuration-processor"></a>spring-boot-configuration-processor</h6><ol><li><p><strong>ä½œç”¨</strong>: <code>spring-boot-configuration-processor</code> æ˜¯ç”¨äºå¤„ç† <code>@ConfigurationProperties</code> æ³¨è§£çš„æ³¨è§£å¤„ç†å™¨ã€‚å®ƒåœ¨ç¼–è¯‘é˜¶æ®µè¿è¡Œï¼Œç”Ÿæˆæœ‰å…³ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£çš„ç±»çš„å…ƒæ•°æ®ã€‚</p></li><li><p><strong>å…ƒæ•°æ®çš„ä½œç”¨</strong>: è¿™äº›å…ƒæ•°æ®ä¸»è¦ç”¨äºä¸¤ä¸ªç›®çš„ï¼š</p><ul><li><strong>æä¾›è‡ªåŠ¨å®Œæˆå’Œæ–‡æ¡£æç¤º</strong>ï¼šå½“ä½ åœ¨ <code>application.properties</code> æˆ– <code>application.yml</code> æ–‡ä»¶ä¸­é…ç½®å±æ€§æ—¶ï¼ŒIDEï¼ˆå¦‚ IntelliJ IDEAï¼‰å¯ä»¥åˆ©ç”¨è¿™äº›å…ƒæ•°æ®æ¥æä¾›è‡ªåŠ¨å®Œæˆå»ºè®®å’Œé…ç½®å±æ€§çš„æ–‡æ¡£è¯´æ˜ã€‚</li><li><strong>æ ¡éªŒæ”¯æŒ</strong>ï¼šè¿™äº›å…ƒæ•°æ®è¿˜å¯ä»¥ç”¨äºåœ¨è¿è¡Œæ—¶éªŒè¯é…ç½®å±æ€§çš„å€¼ï¼Œç¡®ä¿å®ƒä»¬ç¬¦åˆé¢„æœŸçš„æ ¼å¼å’Œçº¦æŸã€‚</li></ul></li><li><p><strong>ä½¿ç”¨æ–¹å¼</strong>: åªéœ€å°† <code>spring-boot-configuration-processor</code> ä½œä¸ºä¾èµ–æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œå®ƒå°±ä¼šåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨å·¥ä½œã€‚</p></li></ol><p>â˜…</p><p>å¦‚æœä½ åœ¨é¡¹ç›®ä¸­å¼•å…¥äº†è¿™ä¸ªä¾èµ–ï¼Œè¿™ä¸ªçš„ä½œç”¨çš„åˆ†ææ³¨è§£</p><p>æ¯”å¦‚åœ¨æ¨¡å— ms-user-autoconfigure ä¸­çš„  MsUserConfiguration ç±»</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Configuration</span>(proxyBeanMethods = <span class="hljs-literal">false</span>)  <br><span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">&quot;cnmemset.ms-user&quot;</span>)  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MsUserConfiguration</span> &#123;  <br>    <span class="hljs-comment">/**  </span><br><span class="hljs-comment">     * å¾®æœåŠ¡ms-userçš„url  </span><br><span class="hljs-comment">     */</span>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> url = <span class="hljs-string">&quot;127.0.0.1:8080&quot;</span>;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUrl</span>(<span class="hljs-params"></span>) &#123;  <br>        <span class="hljs-keyword">return</span> url;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setUrl</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> url</span>) &#123;  <br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span> = url;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ä»–ä¼šè¿›è¡Œåˆ†æ æ³¨è§£   @ConfigurationProperties  è¿›è¡Œç”Ÿæˆäº†é…ç½®é¡¹çš„æè¿°ä¿¡æ¯</p><p>å¹¶å­˜æ”¾åœ¨é…ç½®æ–‡ä»¶ target&#x2F;ms-user-autoconfigure-1.0.0.jar::META&#x2F;INF&#x2F;spring-configuration-metada.json </p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240127203152.png" alt="image.png"></p><p>ä»è€Œ ä½¿å¾— IDEå¯ä»¥è¿›è¡Œè‡ªåŠ¨æç¤ºï¼Œæ–¹ä¾¿å¼€å‘äººå‘˜çš„ä½¿ç”¨ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240127203258.png" alt="image.png"></p><h6 id="spring-boot-autoconfigure-processor"><a href="#spring-boot-autoconfigure-processor" class="headerlink" title="spring-boot-autoconfigure-processor"></a>spring-boot-autoconfigure-processor</h6><ol><li><p><strong>ä½œç”¨</strong>: <code>spring-boot-autoconfigure-processor</code> æ˜¯ç”¨äºå¤„ç† Spring Boot çš„è‡ªåŠ¨é…ç½®ç±»ï¼ˆä½¿ç”¨ <code>@Configuration</code> æ³¨è§£çš„ç±»ï¼‰çš„æ³¨è§£å¤„ç†å™¨ã€‚å®ƒåœ¨ç¼–è¯‘é˜¶æ®µç”Ÿæˆ <code>spring.factories</code> æ–‡ä»¶ä¸­ <code>@Configuration</code> ç±»çš„å…ƒæ•°æ®ã€‚</p></li><li><p><strong>å…ƒæ•°æ®çš„ä½œç”¨</strong>: ç”Ÿæˆçš„å…ƒæ•°æ®æœ‰åŠ©äºä¼˜åŒ– Spring Boot åº”ç”¨ç¨‹åºçš„å¯åŠ¨æ—¶é—´ã€‚è¿™æ˜¯é€šè¿‡å‡å°‘åœ¨ç±»è·¯å¾„ä¸Šè¿›è¡Œçš„æ˜‚è´µçš„æ£€æŸ¥æ¥å®ç°çš„ï¼Œå› ä¸º Spring Boot å¯ä»¥ç›´æ¥æŸ¥æ‰¾ <code>spring.factories</code> æ–‡ä»¶æ¥æ‰¾åˆ°æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»ï¼Œè€Œä¸æ˜¯æ‰«ææ•´ä¸ªç±»è·¯å¾„ã€‚</p></li><li><p><strong>ä½¿ç”¨æ–¹å¼</strong>: ç±»ä¼¼äº <code>spring-boot-configuration-processor</code>ï¼Œå°†å®ƒä½œä¸ºä¾èµ–æ·»åŠ åˆ°ä½ çš„è‡ªåŠ¨é…ç½®æ¨¡å—ä¸­ã€‚</p></li></ol><p>â˜…</p><p> è¯¥ä¾èµ–ä¼šåœ¨ç¼–è¯‘é˜¶æ®µï¼Œè¿›è¡Œåˆ†ææ³¨è§£ @EnableAutoConfiguration</p><p>ç”Ÿæˆæ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»çš„è¿‡æ»¤æ¡ä»¶çš„å…ƒæ•°æ®ï¼›ç„¶åå­˜æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­</p><p>META&#x2F;INF&#x2F;spring-configuration-metada.properties</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240127203650.png" alt="image.png"></p><p>ä»è€Œä½¿å¾— SpringBoot åœ¨å¯åŠ¨çš„æ—¶å€™èƒ½å¿«é€Ÿçš„è¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»ï¼ŒåŠ å¿«å¯åŠ¨é€Ÿåº¦ã€‚</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/system-design/framework/spring/spring-boot-auto-assembly-principles.html">https://javaguide.cn/system-design/framework/spring/spring-boot-auto-assembly-principles.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå­¦ä¹ _Spring_Beançš„ç”Ÿå‘½å‘¨æœŸ</title>
    <link href="/2023/12/18/Spring%E5%AD%A6%E4%B9%A0_Spring_Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    <url>/2023/12/18/Spring%E5%AD%A6%E4%B9%A0_Spring_Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€åŸºç¡€æ¦‚å¿µ"><a href="#ä¸€ã€åŸºç¡€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºç¡€æ¦‚å¿µ"></a>ä¸€ã€åŸºç¡€æ¦‚å¿µ</h3><p>æ¢³ç†ä¸€ä¸‹ å…³äº SpringBean ç”Ÿå‘½å‘¨æœŸçš„ä¸€äº›æ¦‚å¿µå’Œç†è§£ã€‚</p><p>Spring Bean æŒ‡çš„æ˜¯Spring å®¹å™¨ä¸­çš„å¯¹è±¡ï¼Œè¿™é‡Œè®²è¿° Bean çš„ç”Ÿå‘½å‘¨æœŸä¸€èˆ¬æŒ‡çš„æ˜¯ å•ä¾‹ Beanã€‚</p><h4 id="Spring-Bean-çš„å››ä¸ªé˜¶æ®µ"><a href="#Spring-Bean-çš„å››ä¸ªé˜¶æ®µ" class="headerlink" title="Spring Bean çš„å››ä¸ªé˜¶æ®µ"></a>Spring Bean çš„å››ä¸ªé˜¶æ®µ</h4><p>å¦‚æœåªæ˜¯è®²è¿°å››ä¸ªç¬¼ç»Ÿçš„é˜¶æ®µï¼Œé‚£ä¹ˆSpring Bean çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸ºï¼šå®ä¾‹åŒ– Instantiation â†’ å±æ€§èµ‹å€¼ Populate â†’ åˆå§‹åŒ– Initialization  â†’ é”€æ¯ Destructionã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼ŒSpring Bean åœ¨åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œå°±ä»£è¡¨è¿™ä¸ªBean åœ¨å®¹å™¨ä¸­æ˜¯å¯ç”¨çš„ã€‚</p><blockquote><p>åœ¨é¢è¯•é¢˜ä¸­ï¼Œæœ‰å¯èƒ½æœ‰é—®ä¸€ä¸‹æ™®é€šçš„ Java å¯¹è±¡ å’Œ Spring Bean å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸçš„åŒºåˆ«ã€‚</p></blockquote><p>å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªå›ç­”ï¼š</p><p>æ™®é€šJavaå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç”±Javaè¯­è¨€è§„åˆ™æ§åˆ¶çš„ï¼Œä»å¯¹è±¡çš„åˆ›å»ºï¼ˆå®ä¾‹åŒ–ï¼‰å¼€å§‹ï¼Œåˆ°è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ç»“æŸã€‚å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯éå¸¸ç›´æ¥ï¼Œä¸å¯¹è±¡å¼•ç”¨çš„å­˜åœ¨æ—¶é—´ç›´æ¥ç›¸å…³ã€‚</p><p>Spring Beançš„ç”Ÿå‘½å‘¨æœŸæ›´ä¸ºå¤æ‚ï¼Œå› ä¸ºSpringæ¡†æ¶æ§åˆ¶ç€Beançš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚è¿™åŒ…æ‹¬äº†Beançš„åˆ›å»ºã€åˆå§‹åŒ–åçš„å¤„ç†ã€ä»¥åŠé”€æ¯å‰çš„å¤„ç†ã€‚Springé€šè¿‡ä¾èµ–æ³¨å…¥ç®¡ç†Beançš„å±æ€§ï¼Œè¿˜å¯ä»¥é€šè¿‡å®ç°ç‰¹å®šçš„æ¥å£æˆ–é…ç½®å£°æ˜å‘¨æœŸå›è°ƒæ–¹æ³•æ¥åœ¨Beançš„ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒé˜¶æ®µæ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚è¿™ä¸ºåœ¨Beanåˆ›å»ºå’Œé”€æ¯è¿‡ç¨‹ä¸­åŠ å…¥è‡ªå®šä¹‰é€»è¾‘æä¾›äº†æœºä¼šã€‚</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">//</span> æ™®é€šJavaå¯¹è±¡ç”Ÿå‘½å‘¨æœŸ:<br><span class="hljs-string">//</span> 1. å£°æ˜: MyClass obj;<br><span class="hljs-string">//</span> 2. å®ä¾‹åŒ–: obj = new MyClass<span class="hljs-params">()</span>;<br><span class="hljs-string">//</span> 3. ä½¿ç”¨: obj.method<span class="hljs-params">()</span>;<br><span class="hljs-string">//</span> 4. åƒåœ¾å›æ”¶: ä¸å†æœ‰å¼•ç”¨æŒ‡å‘objæ—¶ï¼Œç”±åƒåœ¾å›æ”¶å™¨å›æ”¶<br><br><span class="hljs-string">//</span> Spring Beanç”Ÿå‘½å‘¨æœŸ:<br><span class="hljs-string">//</span> 1. å®ä¾‹åŒ–Bean<br><span class="hljs-string">//</span> 2. è®¾ç½®Beanå±æ€§<br><span class="hljs-string">//</span> 3. å¦‚æœBeanå®ç°äº†BeanNameAwareæ¥å£, è°ƒç”¨<span class="hljs-keyword">set</span>BeanNameæ–¹æ³•<br><span class="hljs-string">//</span> 4. å¦‚æœBeanå®ç°äº†BeanFactoryAwareæ¥å£, è°ƒç”¨<span class="hljs-keyword">set</span>BeanFactoryæ–¹æ³•<br><span class="hljs-string">//</span> 5. å¦‚æœBeanå®ç°äº†ApplicationContextAwareæ¥å£, è°ƒç”¨<span class="hljs-keyword">set</span>ApplicationContextæ–¹æ³•<br><span class="hljs-string">//</span> 6. å¦‚æœå­˜åœ¨ä¸Beanç›¸å…³çš„BeanPostProcessors, è°ƒç”¨postProcessBeforeInitializationæ–¹æ³•<br><span class="hljs-string">//</span> 7. å¦‚æœBeanå®ç°äº†InitializingBeanæ¥å£, è°ƒç”¨afterPropertiesSetæ–¹æ³•<br><span class="hljs-string">//</span> 8. å¦‚æœBeané…ç½®äº†init-method, è°ƒç”¨æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•<br><span class="hljs-string">//</span> 9. å¦‚æœå­˜åœ¨ä¸Beanç›¸å…³çš„BeanPostProcessors, è°ƒç”¨postProcessAfterInitializationæ–¹æ³•<br><span class="hljs-string">//</span> 10. Beanç°åœ¨å¯ä»¥ä½¿ç”¨äº†<br><span class="hljs-string">//</span> 11. å¦‚æœå®¹å™¨å…³é—­, å¦‚æœBeanå®ç°äº†DisposableBeanæ¥å£, è°ƒç”¨destroyæ–¹æ³•<br><span class="hljs-string">//</span> 12. å¦‚æœBeané…ç½®äº†destroy-method, è°ƒç”¨æŒ‡å®šçš„é”€æ¯æ–¹æ³•<br></code></pre></td></tr></table></figure><p>è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><h4 id="Spring-Bean-çš„ç”Ÿå‘½å‘¨æœŸçš„æ‰©å±•ç‚¹"><a href="#Spring-Bean-çš„ç”Ÿå‘½å‘¨æœŸçš„æ‰©å±•ç‚¹" class="headerlink" title="Spring Bean çš„ç”Ÿå‘½å‘¨æœŸçš„æ‰©å±•ç‚¹"></a>Spring Bean çš„ç”Ÿå‘½å‘¨æœŸçš„æ‰©å±•ç‚¹</h4><p>å‰é¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…³äºSpringçš„ç”Ÿå‘½å‘¨æœŸå’ŒJavaå¯¹è±¡åŒºåˆ«çš„å›ç­”æ—¶ï¼Œé‡Œé¢è¿˜è®²è¿°äº†ä¸€äº›å…³äºAwareæ¥å£å’Œ BeanPostProcessors ç­‰å†…å®¹ï¼Œè¿™äº›å…·ä½“çš„ç‚¹å®é™…å°±æ˜¯ä¸ ç”Ÿå‘½å‘¨æœŸçš„æ‰©å±•ç‚¹ç›¸å…³ï¼ˆä¸åŒé˜¶æ®µä¸­é—´è¿›è¡Œçš„æ´»åŠ¨ï¼‰ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥è®²è¿°ä¸€ä¸‹å…·ä½“çš„æ‰©å±•ç‚¹ä½¿ç”¨ã€‚</p><h5 id="Bean-è‡ªèº«çš„æ–¹æ³•"><a href="#Bean-è‡ªèº«çš„æ–¹æ³•" class="headerlink" title="Bean è‡ªèº«çš„æ–¹æ³•"></a>Bean è‡ªèº«çš„æ–¹æ³•</h5><p>åœ¨Beançš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒBeanè‡ªèº«æ˜¯æœ‰ä¸€äº›ç‰¹å®šæ–¹æ³•æ˜¯èƒ½å¤Ÿè¢«è°ƒç”¨çš„ï¼Œä»¥ä¾¿å®Œæˆå…¶ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹ã€‚</p><p>æ¯”å¦‚æ„é€ å‡½æ•°ã€getter&#x2F;setter ä»¥åŠ init-method å’Œ destory-method æ‰€æŒ‡å®šçš„æ–¹æ³•ç­‰ï¼Œè€Œè¿™äº›æ–¹æ³•åˆåˆ†åˆ«å¯¹åº”ç€ä¸Šæ–‡è¯´çš„å››ä¸ªé˜¶æ®µï¼šå®ä¾‹åŒ–ã€å±æ€§èµ‹å€¼ã€åˆå§‹åŒ–å’Œé”€æ¯ã€‚</p><p>è¿™äº›Beanè‡ªèº«çš„æ–¹æ³•ä¸€èˆ¬æ˜¯æˆ‘ä»¬åœ¨é…ç½®Beançš„æ—¶å€™å°±å·²ç»å®šä¹‰å¥½çš„ï¼Œ</p><h5 id="å®¹å™¨çº§åˆ«æ–¹æ³•ï¼ˆBeanPostProcessoræ¥å£ï¼‰"><a href="#å®¹å™¨çº§åˆ«æ–¹æ³•ï¼ˆBeanPostProcessoræ¥å£ï¼‰" class="headerlink" title="å®¹å™¨çº§åˆ«æ–¹æ³•ï¼ˆBeanPostProcessoræ¥å£ï¼‰"></a>å®¹å™¨çº§åˆ«æ–¹æ³•ï¼ˆBeanPostProcessoræ¥å£ï¼‰</h5><p>å°†è¿™ä¸ªå®¹å™¨çº§åˆ«æ–¹æ³•ç†è§£ä¸ºé˜¶æ®µä¸­é—´å®¹å™¨ä¼šè¿›è¡Œçš„ä¸€äº›æ“ä½œï¼Œè¿™äº›æ–¹æ³•ä¸€èˆ¬æ˜¯ BeanPostProcessor çš„ä¸€ç³»åˆ—æ¥å£ã€‚</p><p>åœ¨ä¸Šè¿°è®²åˆ°çš„Bean å››ä¸ªé˜¶æ®µï¼Œåœ¨è¿™å››ä¸ªé˜¶æ®µçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œä¸€äº›å‰ç½®æˆ–è€…åç½®çš„æ“ä½œã€‚</p><p>è¿™äº›æ“ä½œç‹¬ç«‹äº Bean ä¹‹å¤–ï¼Œå¹¶ä¸”ä¼šæ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ï¼Œåœ¨Spring å®¹å™¨åˆ›å»ºBeançš„æ—¶å€™ï¼Œä¼šè¿›è¡Œä¸€äº›å¤„ç†ã€‚</p><h5 id="å·¥å‚åå¤„ç†å™¨æ–¹æ³•ï¼ˆBeanFactoryProcessor-æ¥å£ï¼‰"><a href="#å·¥å‚åå¤„ç†å™¨æ–¹æ³•ï¼ˆBeanFactoryProcessor-æ¥å£ï¼‰" class="headerlink" title="å·¥å‚åå¤„ç†å™¨æ–¹æ³•ï¼ˆBeanFactoryProcessor æ¥å£ï¼‰"></a>å·¥å‚åå¤„ç†å™¨æ–¹æ³•ï¼ˆBeanFactoryProcessor æ¥å£ï¼‰</h5><p>å·¥å‚åå¤„ç†å™¨æ–¹æ³•æ˜¯ç”¨äºæ¥å®ç°æŸäº›ç‰¹å®šåŠŸèƒ½ã€‚</p><p><code>BeanFactoryPostProcessor</code>æ˜¯å¦ä¸€ç§å®¹å™¨çº§åˆ«çš„æ‰©å±•ç‚¹ï¼Œå®ƒå…è®¸å¯¹Beanå®šä¹‰ï¼ˆBeanDefinitionï¼‰è¿›è¡Œè¯»å–å’Œä¿®æ”¹ï¼Œè¿™åœ¨Beanå®ä¾‹åŒ–ä¹‹å‰æ‰§è¡Œã€‚</p><h5 id="Bean-çº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><a href="#Bean-çº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•" class="headerlink" title="Bean çº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"></a>Bean çº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</h5><p>Bean çº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æŒ‡çš„æ˜¯é’ˆå¯¹ Bean å®ä¾‹çš„ä¸ªæ€§åŒ–è¡Œä¸º</p><p>Beançº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ˜¯æŒ‡ç›´æ¥åœ¨Beanç±»ä¸­å®ç°çš„æ¥å£æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•é’ˆå¯¹ç‰¹å®šBeanå®ä¾‹ç”Ÿæ•ˆã€‚åŒ…æ‹¬ï¼š</p><ul><li><strong>Awareæ¥å£</strong>ï¼šå¦‚<code>BeanNameAware</code>ã€<code>BeanFactoryAware</code>ã€<code>ApplicationContextAware</code>ç­‰ï¼Œå…è®¸Beanè·å–å®¹å™¨ç›¸å…³çš„èµ„æºå’Œä¿¡æ¯ã€‚</li><li><strong>InitializingBeanå’ŒDisposableBeanæ¥å£</strong>ï¼šåˆ†åˆ«ç”¨äºè‡ªå®šä¹‰åˆå§‹åŒ–åå’Œé”€æ¯å‰çš„é€»è¾‘</li></ul><p>é€šè¿‡ç›´æ¥åœ¨Beanç±»ä¸­å®ç°è¿™äº›æ¥å£ï¼Œå¯ä»¥ä½¿Beanåœ¨å…¶ç”Ÿå‘½å‘¨æœŸçš„ç‰¹å®šæ—¶åˆ»è·å¾—æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘çš„èƒ½åŠ›ã€‚</p><h3 id="äºŒã€æ‰©å±•ç‚¹"><a href="#äºŒã€æ‰©å±•ç‚¹" class="headerlink" title="äºŒã€æ‰©å±•ç‚¹"></a>äºŒã€æ‰©å±•ç‚¹</h3><h4 id="2-1-Spring-Bean-è‡ªèº«çš„æ–¹æ³•ä½¿ç”¨"><a href="#2-1-Spring-Bean-è‡ªèº«çš„æ–¹æ³•ä½¿ç”¨" class="headerlink" title="2.1 Spring Bean è‡ªèº«çš„æ–¹æ³•ä½¿ç”¨"></a>2.1 Spring Bean è‡ªèº«çš„æ–¹æ³•ä½¿ç”¨</h4><p>åœ¨Springæ¡†æ¶ä¸­ï¼ŒBeançš„ç”Ÿå‘½å‘¨æœŸç®¡ç†æ˜¯é€šè¿‡ä¸€ç³»åˆ—çº¦å®šçš„æ–¹æ³•æ¥å®ç°çš„ï¼Œè¿™äº›æ–¹æ³•å…è®¸Springå®¹å™¨åœ¨Beançš„ç”Ÿå‘½å‘¨æœŸçš„ä¸åŒé˜¶æ®µè¿›è¡Œå¹²é¢„ã€‚ä»¥ä¸‹æ˜¯è¿™äº›è‡ªèº«æ–¹æ³•çš„è¯¦ç»†è¯´æ˜ï¼Œå¯¹åº”äºBeanç”Ÿå‘½å‘¨æœŸçš„å››ä¸ªä¸»è¦é˜¶æ®µï¼šå®ä¾‹åŒ–ã€å±æ€§èµ‹å€¼ã€åˆå§‹åŒ–å’Œé”€æ¯ã€‚</p><p>Bean è‡ªèº«æ–¹æ³•ä½¿ç”¨</p><ul><li>å®ä¾‹åŒ–<ul><li><strong>æ„é€ å‡½æ•°ï¼ˆConstructorï¼‰</strong>ï¼šæ˜¯å®ä¾‹åŒ–é˜¶æ®µæœ€åŸºæœ¬çš„æ–¹æ³•ã€‚Springæ ¹æ®Beançš„å®šä¹‰æ¥è°ƒç”¨ç›¸åº”çš„æ„é€ å‡½æ•°åˆ›å»ºBeanå®ä¾‹ã€‚è¿™å¯èƒ½æ˜¯æ— å‚æ„é€ å‡½æ•°æˆ–å¸¦æœ‰å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œåè€…ç”¨äºä¾èµ–æ³¨å…¥ã€‚</li></ul></li><li>å±æ€§èµ‹å€¼<ul><li><strong>Getterå’ŒSetteræ–¹æ³•</strong>ï¼šç”¨äºå±æ€§èµ‹å€¼é˜¶æ®µã€‚Springé€šè¿‡åå°„è°ƒç”¨Beançš„Setteræ–¹æ³•æ¥æ³¨å…¥ä¾èµ–ã€‚è¿™äº›æ–¹æ³•éµå¾ªJavaBeançš„å‘½åçº¦å®šï¼Œä¾‹å¦‚ï¼Œå±æ€§<code>name</code>å¯¹åº”äº<code>getName()</code>å’Œ<code>setName(String name)</code>ã€‚</li></ul></li><li>åˆå§‹åŒ–<ul><li><strong>è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•</strong>ï¼šå¯ä»¥åœ¨Beanå®šä¹‰ä¸­é€šè¿‡<code>init-method</code>å±æ€§æŒ‡å®šä¸€ä¸ªæ–¹æ³•ä½œä¸ºBeançš„åˆå§‹åŒ–æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åœ¨å±æ€§èµ‹å€¼ä¹‹åè°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œä»»ä½•å¿…è¦çš„åˆå§‹åŒ–é€»è¾‘ã€‚</li><li><strong>@PostConstructæ³¨è§£</strong>:ï¼šåˆå§‹åŒ–ä¹‹å‰è°ƒç”¨çš„æ–¹æ³•</li></ul></li><li>é”€æ¯<ul><li><strong>è‡ªå®šä¹‰é”€æ¯æ–¹æ³•</strong>ï¼šä¸åˆå§‹åŒ–æ–¹æ³•ç±»ä¼¼ï¼Œå¯ä»¥åœ¨Beanå®šä¹‰ä¸­é€šè¿‡<code>destroy-method</code>å±æ€§æŒ‡å®šä¸€ä¸ªæ–¹æ³•ä½œä¸ºBeançš„é”€æ¯æ–¹æ³•ã€‚å½“å®¹å™¨å…³é—­æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨ï¼Œç”¨äºæ‰§è¡Œä»»ä½•å¿…è¦çš„æ¸…ç†å·¥ä½œã€‚</li><li><strong>@PreDestroyæ³¨è§£</strong>ï¼šSpringå®¹å™¨åœ¨é”€æ¯Beanä¹‹å‰è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</li></ul></li></ul><blockquote><p>å…·ä½“ä½¿ç”¨ç¤ºä¾‹</p></blockquote><p>å±•ç¤ºå¦‚ä½•åœ¨Springä¸­ä½¿ç”¨Beanè‡ªèº«çš„æ–¹æ³•ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs csharp">package com.example;<br><br>import javax.annotation.PostConstruct;<br>import javax.annotation.PreDestroy;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyBean</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-comment">// æ„é€ å‡½æ•°</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyBean</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;MyBean is being constructed without arguments.&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œç”¨äºä¾èµ–æ³¨å…¥</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyBean</span>(<span class="hljs-params">String name</span>)</span> &#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;MyBean is being constructed with name: &quot;</span> + name);<br>    &#125;<br><br>    <span class="hljs-comment">// Getterå’ŒSetteræ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span>()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span>(<span class="hljs-params">String name</span>)</span> &#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Setting the name of MyBean to: &quot;</span> + name);<br>    &#125;<br><br>    <span class="hljs-comment">// è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">myCustomInit</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Custom init method of MyBean is called.&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// ä½¿ç”¨@PostConstructæ³¨è§£çš„åˆå§‹åŒ–æ–¹æ³•</span><br>    @PostConstruct<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postConstructInit</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;@PostConstruct init method is called.&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// è‡ªå®šä¹‰é”€æ¯æ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">myCustomDestroy</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Custom destroy method of MyBean is called.&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// ä½¿ç”¨@PreDestroyæ³¨è§£çš„é”€æ¯æ–¹æ³•</span><br>    @PreDestroy<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">preDestroyCleanup</span>()</span> &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;@PreDestroy cleanup method is called.&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œåœ¨Springé…ç½®æ–‡ä»¶æˆ–Javaé…ç½®ä¸­ï¼Œæ‚¨éœ€è¦æ³¨å†Œè¿™ä¸ªBeanï¼Œå¹¶æŒ‡å®š<code>init-method</code>å’Œ<code>destroy-method</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.example.MyBean&quot;</span> <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;myCustomInit&quot;</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">&quot;myCustomDestroy&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- å¦‚æœä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼Œå¯ä»¥å¦‚ä¸‹é…ç½® --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;John Doe&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨Javaé…ç½®ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">package</span> com.example.config;<br><br><span class="hljs-keyword">import</span> com.example.MyBean;<br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean(initMethod = <span class="hljs-string">&quot;myCustomInit&quot;</span>, destroyMethod = <span class="hljs-string">&quot;myCustomDestroy&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> MyBean myBean() &#123;<br>        <span class="hljs-keyword">return</span> new MyBean(<span class="hljs-string">&quot;John Doe&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¯¥ç¤ºä¾‹ä¸­ï¼Œ<code>MyBean</code>ç±»å±•ç¤ºäº†å¦‚ä½•å®šä¹‰æ„é€ å‡½æ•°ã€getterå’Œsetteræ–¹æ³•ã€è‡ªå®šä¹‰çš„åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨<code>@PostConstruct</code>å’Œ<code>@PreDestroy</code>æ³¨è§£æ¥è‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–å‰å’Œé”€æ¯å‰çš„é€»è¾‘ã€‚</p><p>é€šè¿‡åœ¨Springé…ç½®ä¸­æŒ‡å®š<code>init-method</code>å’Œ<code>destroy-method</code>å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶Springä½•æ—¶è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œä»è€Œå®ç°å¯¹Beanç”Ÿå‘½å‘¨æœŸçš„ç²¾ç»†ç®¡ç†ã€‚</p><h4 id="2-2-å®¹å™¨çº§åˆ«æ–¹æ³•"><a href="#2-2-å®¹å™¨çº§åˆ«æ–¹æ³•" class="headerlink" title="2.2  å®¹å™¨çº§åˆ«æ–¹æ³•"></a>2.2  å®¹å™¨çº§åˆ«æ–¹æ³•</h4><p>å°†è¿™ä¸ªå®¹å™¨çº§åˆ«æ–¹æ³•ç†è§£ä¸ºé˜¶æ®µä¸­é—´å®¹å™¨ä¼šè¿›è¡Œçš„ä¸€äº›æ“ä½œï¼Œè¿™äº›æ–¹æ³•ä¸€èˆ¬æ˜¯ BeanPostProcessor çš„ä¸€ç³»åˆ—æ¥å£ã€‚</p><p>åœ¨ä¸Šè¿°è®²åˆ°çš„Bean å››ä¸ªé˜¶æ®µï¼Œåœ¨è¿™å››ä¸ªé˜¶æ®µçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œä¸€äº›å‰ç½®æˆ–è€…åç½®çš„æ“ä½œã€‚</p><p>è¿™äº›æ“ä½œç‹¬ç«‹äº Bean ä¹‹å¤–ï¼Œå¹¶ä¸”ä¼šæ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ï¼Œåœ¨Spring å®¹å™¨åˆ›å»ºBeançš„æ—¶å€™ï¼Œä¼šè¿›è¡Œä¸€äº›å¤„ç†ã€‚</p><p><code>BeanPostProcessor</code>æ¥å£æä¾›äº†å®¹å™¨çº§åˆ«çš„æ‰©å±•ç‚¹ï¼Œå…è®¸åœ¨Beançš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–å‰åæ’å…¥è‡ªå®šä¹‰æ“ä½œã€‚è¿™äº›æ“ä½œåŒ…æ‹¬ï¼š</p><ul><li>å®ä¾‹åŒ–å‰å<ul><li>postProcessBeforeInstantiation</li><li>postProcessAfterInstantiation</li></ul></li><li>åˆå§‹åŒ–å‰å<ul><li><strong>postProcessBeforeInitialization</strong>ï¼šåœ¨ä»»ä½•Beanåˆå§‹åŒ–å›è°ƒï¼ˆå¦‚<code>@PostConstruct</code>æ³¨è§£çš„æ–¹æ³•ã€<code>afterPropertiesSet</code>ã€è‡ªå®šä¹‰çš„init-methodï¼‰ä¹‹å‰è°ƒç”¨ã€‚</li><li><strong>postProcessAfterInitialization</strong>ï¼šåœ¨æ‰€æœ‰Beanåˆå§‹åŒ–å›è°ƒä¹‹åè°ƒç”¨ã€‚</li></ul></li></ul><p>é€šè¿‡å®ç°<code>BeanPostProcessor</code>æ¥å£å¹¶æ³¨å†Œä¸ºSpringå®¹å™¨çš„Beanï¼Œå¯ä»¥å¯¹æ‰€æœ‰Beançš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–è¿‡ç¨‹è¿›è¡Œå¹²é¢„ã€‚</p><p>å¯ä»¥ç†è§£  <code>InstantiationAwareBeanPostProcessor</code> æ¥å£æ–¹æ³•æ˜¯ ä½œä¸º å®ä¾‹åŒ–é˜¶æ®µçš„â€äº§å‰äº§åæŠ¤ç†â€ï¼›<code>BeanPostProcessor</code> æ˜¯ åˆå§‹åŒ–é˜¶æ®µçš„ â€œå…³é”®è°ƒæ•´å’Œå¢å¼ºâ€ã€‚</p><p>å…·ä½“çš„ä¸€ä¸ªå…³ç³»çœ‹ä¸‹å›¾ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312150342853.png" alt="image.png"></p><blockquote><p>è¡¥å……ä¸€ç‚¹å…³äº<code>InstantiationAwareBeanPostProcessor</code>çš„æè¿°ä»¥ç¡®ä¿æ¦‚å¿µçš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§ã€‚</p></blockquote><p><code>BeanPostProcessor</code>æ¥å£å’Œ<code>InstantiationAwareBeanPostProcessor</code>æ¥å£çš„ä½¿ç”¨:</p><ul><li>**<code>BeanPostProcessor</code>**ï¼šå…è®¸åœ¨Beançš„åˆå§‹åŒ–å‰åæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚è¿™åŒ…æ‹¬ï¼š<ul><li><code>postProcessBeforeInitialization</code>: åœ¨Beanåˆå§‹åŒ–ä¹‹å‰è°ƒç”¨ï¼ˆå¦‚è°ƒç”¨<code>@PostConstruct</code>æ³¨è§£çš„æ–¹æ³•ã€<code>InitializingBean</code>çš„<code>afterPropertiesSet</code>æ–¹æ³•æˆ–è‡ªå®šä¹‰çš„init-methodä¹‹å‰ï¼‰ã€‚</li><li><code>postProcessAfterInitialization</code>: åœ¨Beanåˆå§‹åŒ–ä¹‹åè°ƒç”¨ï¼ˆå¦‚ä¸Šè¿°åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œä¹‹åï¼‰ã€‚</li></ul></li><li>**<code>InstantiationAwareBeanPostProcessor</code>**ï¼šæ˜¯<code>BeanPostProcessor</code>çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†æ›´å¤šæ§åˆ¶ï¼ŒåŒ…æ‹¬ï¼š<ul><li><code>postProcessBeforeInstantiation</code>: åœ¨Beanå®ä¾‹åŒ–ä¹‹å‰è°ƒç”¨ï¼Œå…è®¸è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡æ¥ä»£æ›¿çœŸæ­£çš„å®ä¾‹ã€‚</li><li><code>postProcessAfterInstantiation</code>: åœ¨Beanå®ä¾‹åŒ–ä¹‹åã€è®¾ç½®å±æ€§ä¹‹å‰è°ƒç”¨ï¼Œå…è®¸å¯¹Beanå®ä¾‹è¿›è¡Œé¢å¤–çš„å¤„ç†ã€‚</li></ul></li></ul><p>é€šè¿‡è¿™äº›æ¥å£ï¼ŒSpringå…è®¸å¼€å‘è€…åœ¨Beanç”Ÿå‘½å‘¨æœŸçš„å…³é”®é˜¶æ®µä»‹å…¥ï¼Œæä¾›äº†æé«˜çš„çµæ´»æ€§æ¥å®šåˆ¶Beançš„è¡Œä¸ºï¼Œæ¯”å¦‚é€šè¿‡ä»£ç†æ¨¡å¼å¢å¼ºBeanã€ä¿®æ”¹Beanå±æ€§ã€æ³¨å…¥é¢å¤–çš„ä¾èµ–ç­‰ã€‚</p><p>è¿™äº›ç‰¹æ€§ä½¿å¾—Springéå¸¸é€‚åˆäºä¼ä¸šçº§åº”ç”¨çš„å¼€å‘ï¼Œå› ä¸ºå®ƒä»¬å…è®¸é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ï¼ˆAOPï¼‰ã€äº‹åŠ¡ç®¡ç†ç­‰é«˜çº§åŠŸèƒ½çš„å®ç°ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBeanPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanPostProcessor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">postProcessBeforeInitialization</span>(<span class="hljs-title class_">Object</span> bean, <span class="hljs-title class_">String</span> beanName) throws <span class="hljs-title class_">BeansException</span> &#123;<br>        <span class="hljs-comment">// åœ¨åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œçš„é€»è¾‘</span><br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">postProcessAfterInitialization</span>(<span class="hljs-title class_">Object</span> bean, <span class="hljs-title class_">String</span> beanName) throws <span class="hljs-title class_">BeansException</span> &#123;<br>        <span class="hljs-comment">// åœ¨åˆå§‹åŒ–ä¹‹åæ‰§è¡Œçš„é€»è¾‘</span><br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡æ³¨å†Œä¸Šè¿°<code>BeanPostProcessor</code>çš„å®ç°ç±»åˆ°Springå®¹å™¨ï¼Œå¯ä»¥å®ç°å¯¹æ‰€æœ‰Beanå®ä¾‹åŒ–å’Œåˆå§‹åŒ–è¿‡ç¨‹çš„è‡ªå®šä¹‰å¹²é¢„ã€‚</p><p>è¿™ä¸ä»…æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¹Ÿä¸ºå®ç°å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æä¾›äº†ä¾¿åˆ©ã€‚</p><h4 id="2-3-å·¥å‚åå¤„ç†å™¨æ–¹æ³•"><a href="#2-3-å·¥å‚åå¤„ç†å™¨æ–¹æ³•" class="headerlink" title="2.3 å·¥å‚åå¤„ç†å™¨æ–¹æ³•"></a>2.3 <strong>å·¥å‚åå¤„ç†å™¨æ–¹æ³•</strong></h4><p><strong>BeanFactoryProcessor ä¸€ç³»åˆ—æ¥å£</strong></p><p>åŒ…æ‹¬ AspectJWeavingEnablerã€CustomAutowireConfigurerã€ConfigurationClassPostProcessor ç­‰ã€‚</p><p>è¿™äº›éƒ½æ˜¯ Spring æ¡†æ¶ä¸­å·²ç»å®ç°å¥½çš„ BeanFactoryPostProcessorï¼Œç”¨æ¥å®ç°æŸäº›ç‰¹å®šçš„åŠŸèƒ½</p><blockquote><p>BeanFactoryProcessor æ¥å£ vs  BeanPostProcessoræ¥å£</p></blockquote><p><code>BeanFactoryPostProcessor</code> æ¥å£å’Œ <code>BeanPostProcessor</code> æ¥å£éƒ½æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äºå®šåˆ¶å’Œæ‰©å±• Bean çš„å…³é”®æ¥å£ï¼Œä½†å®ƒä»¬çš„ä½œç”¨å’Œæ—¶æœºç•¥æœ‰ä¸åŒã€‚</p><p>BeanFactoryPostProcessor æ¥å£ï¼š</p><ol><li><p><strong>ä½œç”¨ï¼š</strong> <code>BeanFactoryPostProcessor</code> æ¥å£ç”¨äºåœ¨ Spring å®¹å™¨å®ä¾‹åŒ– Bean ä¹‹å‰ä¿®æ”¹æˆ–å®šåˆ¶ BeanFactory çš„é…ç½®ã€‚</p></li><li><p><strong>æ—¶æœºï¼š</strong> åœ¨ Spring å®¹å™¨è¯»å–äº† Bean çš„å®šä¹‰ï¼ˆé…ç½®å…ƒæ•°æ®ï¼‰ä½†åœ¨å®ä¾‹åŒ–ä»»ä½• Bean ä¹‹å‰ï¼Œ<code>BeanFactoryPostProcessor</code> æ¥å£æä¾›äº†æœºä¼šæ¥ä¿®æ”¹ Bean çš„å®šä¹‰ï¼Œä¾‹å¦‚ä¿®æ”¹å±æ€§å€¼ã€æ·»åŠ å±æ€§ç­‰ã€‚</p></li><li><p><strong>å®ç°æ–¹æ³•ï¼š</strong> å®ç° <code>postProcessBeanFactory</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼ é€’äº† BeanFactory å¯¹è±¡ï¼Œå¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­ä¿®æ”¹ BeanFactory çš„é…ç½®ã€‚</p></li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">config</span>.<span class="hljs-property">ConfigurableListableBeanFactory</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">support</span>.<span class="hljs-property">BeanDefinitionBuilder</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">support</span>.<span class="hljs-property">BeanDefinitionRegistryPostProcessor</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">support</span>.<span class="hljs-property">BeanDefinitionRegistry</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBeanFactoryPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanDefinitionRegistryPostProcessor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">postProcessBeanFactory</span>(<span class="hljs-params">ConfigurableListableBeanFactory beanFactory</span>) &#123;<br>        <span class="hljs-comment">// åœ¨è¿™é‡Œå¯ä»¥ä¿®æ”¹ BeanFactory çš„é…ç½®</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">postProcessBeanDefinitionRegistry</span>(<span class="hljs-params">BeanDefinitionRegistry registry</span>) &#123;<br>        <span class="hljs-comment">// åœ¨è¿™é‡Œå¯ä»¥æ³¨å†Œæ–°çš„ BeanDefinition</span><br>        <span class="hljs-title class_">BeanDefinitionBuilder</span> builder = <span class="hljs-title class_">BeanDefinitionBuilder</span>.<span class="hljs-title function_">genericBeanDefinition</span>(<span class="hljs-title class_">MyBean</span>.<span class="hljs-property">class</span>);<br>        registry.<span class="hljs-title function_">registerBeanDefinition</span>(<span class="hljs-string">&quot;myBean&quot;</span>, builder.<span class="hljs-title function_">getBeanDefinition</span>());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>BeanPostProcessor æ¥å£</p></blockquote><ol><li><p><strong>ä½œç”¨ï¼š</strong> <code>BeanPostProcessor</code> æ¥å£ç”¨äºåœ¨ Spring å®¹å™¨å®ä¾‹åŒ– Bean åï¼Œåœ¨ Bean çš„åˆå§‹åŒ–å‰åæ‰§è¡Œä¸€äº›è‡ªå®šä¹‰çš„é€»è¾‘ã€‚</p></li><li><p><strong>æ—¶æœºï¼š</strong> å½“ Bean è¢«å®ä¾‹åŒ–åï¼Œä½†åœ¨è°ƒç”¨å…¶åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ä¹‹å‰ï¼Œ<code>BeanPostProcessor</code> æä¾›äº† <code>postProcessBeforeInitialization</code> å’Œ <code>postProcessAfterInitialization</code> æ–¹æ³•ç”¨äºåœ¨åˆå§‹åŒ–é˜¶æ®µè¿›è¡Œå®šåˆ¶æ“ä½œã€‚</p></li><li><p><strong>å®ç°æ–¹æ³•ï¼š</strong> å®ç° <code>BeanPostProcessor</code> æ¥å£çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­æ·»åŠ å®šåˆ¶é€»è¾‘ã€‚</p></li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">BeansException</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">config</span>.<span class="hljs-property">BeanPostProcessor</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBeanPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanPostProcessor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">postProcessBeforeInitialization</span>(<span class="hljs-title class_">Object</span> bean, <span class="hljs-title class_">String</span> beanName) throws <span class="hljs-title class_">BeansException</span> &#123;<br>        <span class="hljs-comment">// åœ¨åˆå§‹åŒ–ä¹‹å‰çš„é€»è¾‘</span><br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">postProcessAfterInitialization</span>(<span class="hljs-title class_">Object</span> bean, <span class="hljs-title class_">String</span> beanName) throws <span class="hljs-title class_">BeansException</span> &#123;<br>        <span class="hljs-comment">// åœ¨åˆå§‹åŒ–ä¹‹åçš„é€»è¾‘</span><br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ€»ç»“</p><ul><li><code>BeanFactoryPostProcessor</code> ä¸»è¦ç”¨äºä¿®æ”¹æ•´ä¸ª BeanFactory çš„é…ç½®ï¼Œå®ƒåœ¨ Bean å®ä¾‹åŒ–ä¹‹å‰æ‰§è¡Œã€‚</li><li><code>BeanPostProcessor</code> ä¸»è¦ç”¨äºåœ¨æ¯ä¸ª Bean çš„åˆå§‹åŒ–é˜¶æ®µæ·»åŠ è‡ªå®šä¹‰é€»è¾‘ï¼Œå®ƒåœ¨ Bean å®ä¾‹åŒ–åï¼Œåˆå§‹åŒ–æ–¹æ³•è°ƒç”¨å‰åæ‰§è¡Œã€‚</li></ul><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªæ¥å£æ¥å®Œæˆæ›´å¤æ‚çš„å®šåˆ¶éœ€æ±‚ã€‚</p><h4 id="2-4-Bean-çº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><a href="#2-4-Bean-çº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•" class="headerlink" title="2.4  Bean çº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"></a>2.4  <strong>Bean çº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</strong></h4><p>å…³äº Bean çº§ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„ç†è§£ï¼š</p><ul><li>è¿™äº›æ–¹æ³•æä¾›äº†é’ˆå¯¹ Bean å®ä¾‹çš„<strong>ä¸ªæ€§åŒ–è¡Œä¸º</strong>ï¼Œå…è®¸ Bean åœ¨å…¶ç”Ÿå‘½å‘¨æœŸçš„å…³é”®ç‚¹åšå‡ºå“åº”ã€‚</li></ul><p>é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œæ˜¯å¯ä»¥å¯¹äºæŸä¸ªBeanå®ä¾‹è¿›è¡Œä¸ªæ€§åŒ–æ“ä½œçš„ã€‚</p><p>å¯ä»¥ç†è§£ä¸º Bean ç±»ç›´æ¥å®ç°æ¥å£çš„æ–¹æ³•ï¼Œæ¯”å¦‚Â <code>BeanNameAware</code>ã€<code>BeanFactoryAware</code>ã€<code>ApplicationContextAware</code>ã€<code>InitializingBean</code>ã€<code>DisposableBean</code>Â ç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åªå¯¹å½“å‰ Bean ç”Ÿæ•ˆã€‚</p><p>Aware ç±»å‹çš„æ¥å£</p><p>Aware ç±»å‹çš„æ¥å£çš„ä½œç”¨å°±æ˜¯è®©æˆ‘ä»¬èƒ½å¤Ÿæ‹¿åˆ° Spring å®¹å™¨ä¸­çš„ä¸€äº›èµ„æºã€‚</p><p>åŸºæœ¬éƒ½èƒ½å¤Ÿè§åçŸ¥æ„ï¼ŒAware ä¹‹å‰çš„åå­—å°±æ˜¯å¯ä»¥æ‹¿åˆ°ä»€ä¹ˆèµ„æºï¼Œä¾‹å¦‚ BeanNameAware å¯ä»¥æ‹¿åˆ° BeanNameï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><h3 id="ä¸‰ã€Spring-Bean-è¯¦ç»†ç”Ÿå‘½å‘¨æœŸ"><a href="#ä¸‰ã€Spring-Bean-è¯¦ç»†ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ä¸‰ã€Spring Bean è¯¦ç»†ç”Ÿå‘½å‘¨æœŸ"></a>ä¸‰ã€Spring Bean è¯¦ç»†ç”Ÿå‘½å‘¨æœŸ</h3><p>Spring çš„ç”Ÿå‘½å‘¨æœŸåŸºæœ¬ä¸Šæ˜¯å¾ˆå¤šé¢è¯•çš„æ—¶å€™ä¼šé‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œå…¶ä¸­æ·±åº¦ä¸€äº›å¯èƒ½ä¼šé—®ä¸€ä¸‹ç›¸å…³çš„æºç å®ç°ï¼›</p><p>è¿™éƒ¨åˆ†å†…å®¹ä¸»è¦è¿˜æ˜¯å›´ç»•IOCå’ŒAOPçš„ä¸€ä¸ªå®ç°æºç çš„å­¦ä¹ ï¼Œä»¥åŠå¦‚ä½•å®ç°çš„ï¼›å¦‚æœæœ‰ç›¸å…³å­¦ä¹ ï¼Œå¹¶å¯¹æ­¤æœ‰æ‰€æ€è€ƒï¼Œå¯èƒ½æ˜¯æˆä¸ºé¢è¯•å®˜æ¯”è¾ƒäº²è€çš„ä¸€ä¸ªè€ƒæŸ¥å› ç´ ã€‚</p><blockquote><p>Bean çš„ç”Ÿå‘½å‘¨æœŸ</p></blockquote><ul><li>Bean å®¹å™¨æ‰¾åˆ°é…ç½®æ–‡ä»¶ä¸­ Spring Bean çš„å®šä¹‰ã€‚</li><li>Bean å®¹å™¨åˆ©ç”¨ Java Reflection API åˆ›å»ºä¸€ä¸ª Bean çš„å®ä¾‹ã€‚</li><li>å¦‚æœæ¶‰åŠåˆ°ä¸€äº›å±æ€§å€¼ åˆ©ç”¨ set() æ–¹æ³•è®¾ç½®ä¸€äº›å±æ€§å€¼ã€‚</li><li>å¦‚æœ Bean å®ç°äº† BeanNameAware æ¥å£ï¼Œè°ƒç”¨ setBeanName() æ–¹æ³•ï¼Œä¼ å…¥ Bean çš„åå­—ã€‚</li><li>å¦‚æœ Bean å®ç°äº† BeanClassLoaderAware æ¥å£ï¼Œè°ƒç”¨ setBeanClassLoader() æ–¹æ³•ï¼Œä¼ å…¥ ClassLoader å¯¹è±¡çš„å®ä¾‹ã€‚</li><li>å¦‚æœ Bean å®ç°äº† BeanFactoryAware æ¥å£ï¼Œè°ƒç”¨ setBeanFactory() æ–¹æ³•ï¼Œä¼ å…¥ BeanFactory å¯¹è±¡çš„å®ä¾‹ã€‚</li><li>ä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œå¦‚æœå®ç°äº†å…¶ä»– * .Aware æ¥å£ï¼Œå°±è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚</li><li>å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ª Bean çš„ Spring å®¹å™¨ç›¸å…³çš„ BeanPostProcessor å¯¹è±¡ï¼Œæ‰§è¡Œ postProcessBeforeInitialization() æ–¹æ³•</li><li>å¦‚æœ Bean å®ç°äº† InitializingBean æ¥å£ï¼Œæ‰§è¡Œ afterPropertiesSet() æ–¹æ³•ã€‚</li><li>å¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« init-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚</li><li>å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ª Bean çš„ Spring å®¹å™¨ç›¸å…³çš„ BeanPostProcessor å¯¹è±¡ï¼Œæ‰§è¡Œ postProcessAfterInitialization() æ–¹æ³•</li><li>å½“è¦é”€æ¯ Bean çš„æ—¶å€™ï¼Œå¦‚æœ Bean å®ç°äº† DisposableBean æ¥å£ï¼Œæ‰§è¡Œ destroy() æ–¹æ³•ã€‚</li><li>å½“è¦é”€æ¯ Bean çš„æ—¶å€™ï¼Œå¦‚æœ Bean åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å« destroy-method å±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚</li></ul><hr><p><strong>Spring Beanç”Ÿå‘½å‘¨æœŸè¯¦ç»†å›é¡¾</strong>ï¼š</p><ol><li><strong>å®ä¾‹åŒ–Bean</strong>ï¼šSpringå®¹å™¨å…ˆé€šè¿‡æ„é€ å™¨ï¼ˆæˆ–è€…å¯¹äºFactoryBeanæ¥è¯´æ˜¯é€šè¿‡FactoryBeançš„<code>getObject()</code>æ–¹æ³•ï¼‰æ¥åˆ›å»ºBeanå®ä¾‹ã€‚</li><li><strong>å¡«å……å±æ€§</strong>ï¼šSpringå®¹å™¨æŠŠå€¼å’ŒBeançš„å¼•ç”¨æ³¨å…¥åˆ°Beanå¯¹åº”çš„å±æ€§ä¸­ã€‚</li><li><strong>è°ƒç”¨BeanNameAwareçš„setBeanName()æ–¹æ³•</strong>ï¼šå¦‚æœBeanå®ç°äº†BeanNameAwareæ¥å£ï¼ŒSpringå°†Beançš„IDä¼ é€’ç»™setBeanName()æ–¹æ³•ã€‚</li><li><strong>è°ƒç”¨BeanFactoryAwareçš„setBeanFactory()æ–¹æ³•</strong>ï¼šå¦‚æœBeanå®ç°äº†BeanFactoryAwareæ¥å£ï¼ŒSpringå°†è°ƒç”¨setBeanFactory()æ–¹æ³•ï¼Œå°†BeanFactoryå®¹å™¨å®ä¾‹ä¼ å…¥ã€‚</li><li><strong>é¢„åˆå§‹åŒ–ï¼ˆ@PostConstructæ³¨è§£æ–¹æ³•ï¼‰</strong>ï¼šé€šè¿‡Beançš„postProcessBeforeInitialization()æ–¹æ³•ã€‚</li><li><strong>åˆå§‹åŒ–</strong>ï¼šå¦‚æœBeanå®ç°äº†InitializingBeanæ¥å£ï¼ŒSpringå°†è°ƒç”¨å…¶afterPropertiesSet()æ–¹æ³•ã€‚æ­¤å¤–ï¼Œå¦‚æœBeanåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†init-methodå±æ€§ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚</li><li><strong>ååˆå§‹åŒ–ï¼ˆBeanPostProcessorï¼‰</strong>ï¼šé€šè¿‡Beançš„postProcessAfterInitialization()æ–¹æ³•ï¼Œå¯ä»¥å¯¹Beanè¿›è¡Œé¢å¤–çš„å¤„ç†ã€‚</li><li><strong>Beanå‡†å¤‡å°±ç»ª</strong>ï¼šæ­¤æ—¶ï¼ŒBeanå·²ç»å‡†å¤‡å¥½è¢«åº”ç”¨ä¸­ä½¿ç”¨äº†ï¼Œå¤„äºå®Œå…¨åˆå§‹åŒ–çŠ¶æ€ã€‚</li><li><strong>é”€æ¯å‰ï¼ˆ@PreDestroyæ³¨è§£æ–¹æ³•ï¼‰</strong>ï¼šå½“å®¹å™¨å…³é—­æ—¶ï¼Œå¦‚æœBeanå®ç°äº†DisposableBeanæ¥å£ï¼ŒSpringå°†è°ƒç”¨å…¶destroy()æ–¹æ³•ã€‚åŒæ ·ï¼Œå¦‚æœBeanä½¿ç”¨äº†destroy-methodå£°æ˜äº†é”€æ¯æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚</li></ol><p>é€šè¿‡è¿™ä¸ªè¯¦ç»†çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Springåœ¨Beançš„åˆ›å»ºå’Œé”€æ¯è¿‡ç¨‹ä¸­æä¾›äº†ä¸°å¯Œçš„æ‰©å±•ç‚¹ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦æ’å…¥è‡ªå·±çš„ä»£ç ï¼Œè¿›è¡Œè‡ªå®šä¹‰çš„å¤„ç†ã€‚</p><h3 id="å››ã€æºç è§£æ"><a href="#å››ã€æºç è§£æ" class="headerlink" title="å››ã€æºç è§£æ"></a>å››ã€æºç è§£æ</h3><p>åœ¨æˆ‘ä»¬è®²åˆ° IOC çš„æ—¶å€™ï¼Œå®ƒåœ¨Spring æ¡†æ¶çš„å®é™…å®ç°ä¸»è¦æ˜¯ä¾èµ–äº<code>BeanFactory</code>æ¥å£åŠå…¶å­æ¥å£<code>ApplicationContext</code>ã€‚</p><p>IOC çš„å®ç°æ˜¯æ¯”è¾ƒå¤æ‚çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œæ¶‰åŠåˆ°äº†å¾ˆå¤šç»„ä»¶å’Œæ¦‚å¿µã€‚</p><p>åœ¨å‰é¢çš„åŸºç¡€æ¦‚å¿µä¸­ï¼Œå‡ºç°è¿‡ <code>BeanDefinition</code>ã€ <code>BeanFactoryPostProcessor</code>ã€ <code>BeanPostProcessor</code> ç­‰è¯ï¼Œè¿™é‡Œå¯¹ç›¸å…³æ¦‚å¿µåšä¸€ä¸ªå°çš„æ€»ç»“ã€‚</p><p>to be continedâ€¦</p><p>è¿™éƒ¨åˆ†å†…å®¹éœ€è¦æ•´åˆï¼Œæ˜¯å†™çš„æœ‰ç‚¹é—®é¢˜çš„ï¼Œé€»è¾‘å…³è”ä¸å¼ºï¼Œé‡å¤æ€§å¤ªé«˜ã€‚</p><h4 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h4><ol><li><code>BeanFactory</code>æ¥å£</li></ol><ul><li><strong>åŠŸèƒ½</strong>ï¼š<code>BeanFactory</code>æ˜¯Spring IoCå®¹å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒå®šä¹‰äº†IoCå®¹å™¨çš„åŸºæœ¬åŠŸèƒ½ï¼Œå¦‚è·å–beanã€æ£€æŸ¥beançš„å­˜åœ¨ç­‰ã€‚</li><li><strong>å®ç°ç±»</strong>ï¼š<code>XmlBeanFactory</code>ï¼ˆå·²å¼ƒç”¨ï¼‰ã€<code>DefaultListableBeanFactory</code>ç­‰ã€‚</li></ul><ol start="2"><li><code>ApplicationContext</code>æ¥å£</li></ol><ul><li><strong>åŠŸèƒ½</strong>ï¼š<code>ApplicationContext</code>æ˜¯<code>BeanFactory</code>çš„å­æ¥å£ï¼Œæä¾›äº†æ›´å®Œæ•´çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å›½é™…åŒ–æ”¯æŒã€äº‹ä»¶ä¼ æ’­ç­‰ã€‚å®ƒæ˜¯Springä¸­æœ€å¸¸ç”¨çš„IoCå®¹å™¨æ¥å£ã€‚</li><li><strong>å®ç°ç±»</strong>ï¼š<code>ClassPathXmlApplicationContext</code>ã€<code>FileSystemXmlApplicationContext</code>ã€<code>AnnotationConfigApplicationContext</code>ç­‰ã€‚</li></ul><ol start="3"><li><code>BeanDefinition</code>åŠå…¶è§£æ</li></ol><ul><li><strong>åŠŸèƒ½</strong>ï¼š<code>BeanDefinition</code>è¡¨ç¤ºSpring IoCå®¹å™¨ä¸­ç®¡ç†çš„beançš„å®šä¹‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åã€ä½œç”¨åŸŸã€ç”Ÿå‘½å‘¨æœŸå›è°ƒç­‰ã€‚</li><li><strong>å®ç°</strong>ï¼šSpringé€šè¿‡è¯»å–é…ç½®æ–‡ä»¶ï¼ˆXMLã€Java Configï¼‰è§£æbeanå®šä¹‰ï¼Œå¹¶å°†è§£æç»“æœå°è£…ä¸º<code>BeanDefinition</code>å¯¹è±¡ã€‚</li></ul><ol start="4"><li><code>BeanFactoryPostProcessor</code>æ¥å£</li></ol><ul><li><strong>åŠŸèƒ½</strong>ï¼šå…è®¸åœ¨å®¹å™¨å®ä¾‹åŒ–ä»»ä½•beanä¹‹å‰è¯»å–å¹¶ä¿®æ”¹beançš„å®šä¹‰ï¼ˆå³<code>BeanDefinition</code>ï¼‰ã€‚å¯ä»¥ç”¨äºè‡ªå®šä¹‰ä¿®æ”¹beanå®šä¹‰çš„é€»è¾‘ã€‚</li><li><strong>å®ç°ç±»</strong>ï¼š<code>PropertyPlaceholderConfigurer</code>ã€<code>CustomEditorConfigurer</code>ç­‰ã€‚</li></ul><ol start="5"><li><code>BeanPostProcessor</code>æ¥å£</li></ol><ul><li><strong>åŠŸèƒ½</strong>ï¼šæä¾›äº†ä¿®æ”¹æ–°å®ä¾‹åŒ–çš„beanå¯¹è±¡çš„æ‰©å±•ç‚¹ï¼Œæ¯”å¦‚AOPä»£ç†çš„åˆ›å»ºå°±æ˜¯åœ¨è¿™ä¸€æ­¥éª¤ä¸­å®ç°çš„ã€‚</li><li><strong>å®ç°ç±»</strong>ï¼š<code>AutowiredAnnotationBeanPostProcessor</code>ã€<code>RequiredAnnotationBeanPostProcessor</code>ç­‰ã€‚</li></ul><ol start="6"><li>ä¾èµ–æ³¨å…¥</li></ol><ul><li><strong>åŠŸèƒ½</strong>ï¼šåœ¨beançš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­ï¼ŒSpring IoCå®¹å™¨ä¼šæ ¹æ®<code>BeanDefinition</code>ä¸­çš„ä¿¡æ¯ï¼Œé€šè¿‡åå°„ç­‰æŠ€æœ¯ï¼Œè‡ªåŠ¨å°†å£°æ˜çš„ä¾èµ–æ³¨å…¥åˆ°beanä¸­ã€‚</li><li><strong>å®ç°</strong>ï¼šä¸»è¦é€šè¿‡<code>BeanWrapper</code>å®ç°å±æ€§çš„è®¾ç½®ï¼Œ<code>AutowiredAnnotationBeanPostProcessor</code>å¤„ç†<code>@Autowired</code>æ³¨è§£ç­‰ã€‚</li></ul><p> é˜…è¯»é“¾è·¯</p><ol><li><strong>å¯åŠ¨å…¥å£</strong>ï¼šä»<code>ApplicationContext</code>çš„å®ç°ç±»å¼€å§‹ï¼Œäº†è§£å®¹å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</li><li><strong>Beanå®šä¹‰çš„è§£æä¸æ³¨å†Œ</strong>ï¼šæ·±å…¥åˆ°å¦‚ä½•è§£æé…ç½®ï¼ˆXMLã€æ³¨è§£ï¼‰å¹¶å°†è§£æç»“æœè½¬æ¢ä¸º<code>BeanDefinition</code>ï¼Œä»¥åŠ<code>BeanDefinition</code>æ˜¯å¦‚ä½•æ³¨å†Œåˆ°å®¹å™¨ä¸­çš„ã€‚</li><li><strong>Beançš„åˆ›å»ºä¸ä¾èµ–æ³¨å…¥</strong>ï¼šæ¢ç©¶å®¹å™¨æ˜¯å¦‚ä½•åˆ›å»ºbeanå®ä¾‹ã€å®Œæˆä¾èµ–æ³¨å…¥çš„ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šäº†è§£<code>BeanPostProcessor</code>å’Œ<code>BeanFactoryPostProcessor</code>åœ¨beanç”Ÿå‘½å‘¨æœŸä¸­çš„ä½œç”¨ã€‚</li><li><strong>é«˜çº§ç‰¹æ€§</strong>ï¼šAOPã€äº‹ä»¶ç›‘å¬ç­‰é«˜çº§ç‰¹æ€§æ˜¯å¦‚ä½•ä¸IoCå®¹å™¨æ•´åˆçš„ã€‚</li></ol><hr><h4 id="ç›¸å…³æ¦‚å¿µå›é¡¾"><a href="#ç›¸å…³æ¦‚å¿µå›é¡¾" class="headerlink" title="ç›¸å…³æ¦‚å¿µå›é¡¾"></a>ç›¸å…³æ¦‚å¿µå›é¡¾</h4><blockquote><p>Springä¸Šä¸‹æ–‡</p></blockquote><p>ä»ä»£ç çº§åˆ«æ¥è¯´ï¼Œå°±æ˜¯æŒ‡Spring Context</p><p>ä»æºç çº§åˆ«ï¼Œæˆ‘ä»¬åˆå§‹åŒ–Spring Contextçš„æ—¶å€™ï¼Œä¸€å †çš„Springç»„ä»¶å›´ç»•åœ¨ä¸€èµ·ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œè¿™ä¸ªçŠ¶æ€å°±è¢«ç§°ä¸ºSpringç¯å¢ƒã€‚</p><blockquote><p>Spring åˆå§‹åŒ–æ“ä½œ</p></blockquote><p>å…·ä½“æ“ä½œå¯ä»¥è§ä¸‹#ClassPathXmlApplicationContext çš„æ„é€ æ–¹æ³•å“ªé‡Œä¼šè¢«åŠ è½½å¹¶ä½¿ç”¨</p><p>ä½¿ç”¨å‰éœ€è¦å¼•å…¥ spring-context ç›¸å…³çš„ä¾èµ–ï¼Œåˆå§‹åŒ–Beanå¯ä»¥é€šè¿‡æ³¨è§£çš„æ–¹å¼ä¹Ÿå¯ä»¥é€šè¿‡xmlçš„æ–¹å¼ã€‚</p><blockquote><p><code>BeanFactory</code>  ä¸  <code>ApplicationContext</code></p></blockquote><p>å…ˆäº†è§£ä¸€ä¸‹  <code>BeanFactory</code> ä¸  <code>ApplicationContext</code> æ¥å£ä¸¤ä¸ªçš„ä½œç”¨ä¸æ¦‚å¿µï¼š</p><ul><li><code>org.springframework.beans</code> å’Œ <code>org.springframework.context</code> åŒ…æ˜¯Spring Frameworkçš„IoCå®¹å™¨çš„åŸºç¡€ã€‚ </li><li><code>BeanFactory</code>Â æä¾›äº†é…ç½®æ¡†æ¶å’ŒåŸºæœ¬åŠŸèƒ½ï¼Œæä¾›äº†ä¸€ç§é«˜çº§é…ç½®æœºåˆ¶ï¼Œèƒ½å¤Ÿç®¡ç†ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚</li><li><code>ApplicationContext</code> æ˜¯ <code>BeanFactory</code> çš„ä¸€ä¸ªå­æ¥å£ï¼Œç›¸æ¯”äº <code>BeanFactory</code>  æ¥è¯´ï¼Œå¢åŠ äº†æ›´å¤šçš„ä¼ä¸šç‰¹å®šåŠŸèƒ½, æ˜¯Â <code>BeanFactory</code>Â çš„ä¸€ä¸ªå®Œæ•´çš„è¶…é›†ã€‚</li><li><code>BeanFactory</code> å®ç°äº†<strong>å»¶è¿Ÿ</strong>åŠ è½½ï¼ˆæ‡’åŠ è½½ï¼‰ï¼Œåªæœ‰åœ¨è¯·æ±‚è·å–Beanæ—¶ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡<code>getBean()</code>æ–¹æ³•ï¼‰ï¼Œå®¹å™¨æ‰ä¼šåˆ›å»ºè¯¥Beanã€‚è¿™æ„å‘³ç€å¦‚æœåº”ç”¨ä¸­æœªä½¿ç”¨æŸä¸ªBeanï¼Œå®ƒå°±ä¸ä¼šè¢«å®ä¾‹åŒ–ã€‚</li><li><code>ApplicationContext</code>å…¶ä¸‹ç®¡ç†çš„ Bean æ˜¯<strong>åœ¨IOCå®¹å™¨åˆå§‹åŒ–</strong>çš„æ—¶å€™å®Œæˆ Bean å®ä¾‹åŒ–ã€‚</li></ul><blockquote><p>å®ä¾‹åŒ– Instantiation</p></blockquote><p>å…¶ä¸­ç¬¬ä¸€é˜¶æ®µ â€”â€” å®ä¾‹åŒ– Instantiationï¼Œ</p><p>Bean å®ä¾‹åŒ–çš„æ—¶æœºåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯ BeanFactoryï¼Œè¿˜æœ‰ä¸€ç§æ˜¯  ApplicationContextï¼›</p><p>ä¸‹é¢æ˜¯ä¸¤è€…å·®åˆ«ï¼š</p><ul><li>BeanFactory<ul><li>å…¶ä¸‹ç®¡ç†çš„Bean <strong>åœ¨ä½¿ç”¨åˆ°Beançš„æ—¶å€™</strong> æ‰ä¼šè¿›è¡Œå®ä¾‹åŒ–Beanæ“ä½œï¼ˆæ‡’åŠ è½½ç­–ç•¥ï¼‰</li></ul></li><li>ApplicationContext  <ul><li>å…¶ä¸‹ç®¡ç†çš„ Bean <strong>åœ¨IOCå®¹å™¨åˆå§‹åŒ–</strong>çš„æ—¶å€™å®Œæˆ Bean å®ä¾‹åŒ–ã€‚</li><li><code>ApplicationContext</code>æ˜¯<code>BeanFactory</code>çš„å­æ¥å£ï¼Œå¤æ‚ç¨‹åº¦æ›´é«˜ä¸€äº›ã€‚</li><li>å¦‚<code>AnnotationConfigApplicationContext</code>å’Œ<code>ClassPathXmlApplicationContext</code>ç­‰ï¼Œæä¾›äº†å¤šç§æ–¹ä¾¿çš„æ–¹å¼æ¥åˆ›å»ºApplicationContextå®ä¾‹</li></ul></li></ul><blockquote><p><code>ApplicationContext</code></p></blockquote><p><code>org.springframework.context.ApplicationContext</code>Â æ¥å£ä»£è¡¨Spring IoCå®¹å™¨ï¼Œè´Ÿè´£å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…beanã€‚</p><blockquote><p><code>AbstractApplicationContext</code></p></blockquote><p><code>AbstractApplicationContext</code> å®ç°äº† <code>ApplicationContext</code> æ¥å£ï¼Œæä¾›äº†è¿™ä¸ªæ¥å£çš„å¤§éƒ¨åˆ†é€šç”¨åŠŸèƒ½ã€‚</p><p>å®ƒæ˜¯å®é™…åº”ç”¨ä¸Šä¸‹æ–‡ç±»ï¼ˆå¦‚ <code>ClassPathXmlApplicationContext</code> å’Œ <code>AnnotationConfigApplicationContext</code>ï¼‰çš„çˆ¶ç±»</p><p>é€šè¿‡ç»§æ‰¿å’Œæ‰©å±• <code>AbstractApplicationContext</code>ï¼ŒSpring å…è®¸å¼€å‘è€…è‡ªå®šä¹‰åº”ç”¨ä¸Šä¸‹æ–‡çš„è¡Œä¸ºï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ã€‚</p><blockquote><p> ClassPathXmlApplicationContext</p></blockquote><p>ClassPathXmlApplicationContext çš„æ„é€ æ–¹æ³•å“ªé‡Œä¼šè¢«åŠ è½½å¹¶ä½¿ç”¨ï¼Ÿ</p><p>ä»¥ä¸‹æ˜¯å‡ ä¸ªå…¸å‹åœºæ™¯ï¼Œå…¶ä¸­å¯èƒ½ä¼šåŠ è½½å¹¶ä½¿ç”¨ <code>ClassPathXmlApplicationContext</code> çš„æ„é€ æ–¹æ³•ï¼š</p><ol><li>Java åº”ç”¨çš„ä¸»æ–¹æ³• (main)</li></ol><p>åœ¨ä¸€ä¸ªæ ‡å‡†çš„ Java åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¯ä»¥åœ¨ <code>main</code> æ–¹æ³•ä¸­åˆ›å»º <code>ClassPathXmlApplicationContext</code> çš„å®ä¾‹æ¥å¯åŠ¨ Spring å®¹å™¨ã€‚è¿™æ˜¯æœ€å¸¸è§çš„ç”¨æ³•ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApp</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) &#123;<br>        <span class="hljs-title class_">ApplicationContext</span> context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br>        <span class="hljs-comment">// ä½¿ç”¨ context è·å– Bean å®ä¾‹...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>ClassPathXmlApplicationContext</code> ç”¨äºåŠ è½½åä¸º â€œapplicationContext.xmlâ€ çš„é…ç½®æ–‡ä»¶ã€‚</p><ol start="2"><li>Web åº”ç”¨ç¨‹åº</li></ol><p>åœ¨åŸºäº Servlet çš„ä¼ ç»Ÿ Web åº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥åœ¨ Servlet çš„ <code>init</code> æ–¹æ³•ä¸­åˆ›å»º <code>ClassPathXmlApplicationContext</code>ï¼Œæˆ–è€…ä½¿ç”¨ Spring çš„ <code>ContextLoaderListener</code> åœ¨ Web åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ Spring ä¸Šä¸‹æ–‡ã€‚</p><ol start="3"><li>å•å…ƒæµ‹è¯•</li></ol><p>åœ¨ç¼–å†™ Spring åº”ç”¨çš„å•å…ƒæµ‹è¯•æ—¶ï¼Œå¯ä»¥åœ¨æµ‹è¯•ç±»ä¸­åˆ›å»º <code>ClassPathXmlApplicationContext</code> æ¥åŠ è½½æ‰€éœ€çš„ Spring é…ç½®ï¼Œå¹¶è¿›è¡Œæµ‹è¯•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTest</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSomeService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;testContext.xml&quot;</span>);<br>        <span class="hljs-type">MyService</span> <span class="hljs-variable">myService</span> <span class="hljs-operator">=</span> context.getBean(MyService.class);<br>        <span class="hljs-comment">// æ‰§è¡Œæµ‹è¯•...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæµ‹è¯•ä½¿ç”¨äº†å•ç‹¬çš„é…ç½®æ–‡ä»¶ â€œtestContext.xmlâ€ã€‚</p><ol start="4"><li>Spring Boot åº”ç”¨</li></ol><p>ä½¿ç”¨ Spring Boot æ—¶é€šå¸¸ä¸ç›´æ¥ä½¿ç”¨ <code>ClassPathXmlApplicationContext</code></p><p> Spring Boot æä¾›äº†åŸºäºæ³¨è§£çš„é…ç½®å’Œè‡ªåŠ¨é…ç½®çš„èƒ½åŠ›ï¼Œä¸€èˆ¬æ˜¯ä½¿ç”¨æ³¨è§£é…ç½®çš„æ–¹å¼è¿›è¡Œå£°æ˜Beanæ“ä½œ ï¼Œä½†åœ¨ä¸€äº›æ—§çš„æˆ–ç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä»ç„¶éœ€è¦æ‰‹åŠ¨åŠ è½½ XML é…ç½®çš„æ–¹å¼ã€‚</p><h4 id="å®¹å™¨çº§åˆ«æ–¹æ³•"><a href="#å®¹å™¨çº§åˆ«æ–¹æ³•" class="headerlink" title="å®¹å™¨çº§åˆ«æ–¹æ³•"></a>å®¹å™¨çº§åˆ«æ–¹æ³•</h4><p>è¿™éƒ¨åˆ†å†…å®¹å¾…åç»­å®Œå–„åˆ†æã€‚</p><blockquote><p>æºç å†…å®¹åˆ†æï¼ˆå®¹å™¨çº§åˆ«æ–¹æ³•ï¼‰</p></blockquote><p>éœ€è¦å»äº†è§£Beançš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™ä¸ªæºç å¯¹åº”çš„æ–¹æ³•æ˜¯å¿…é¡»å»äº†è§£å’Œçœ‹çš„ã€‚</p><blockquote><p>InstantiationAwareBeanPostProcessor æ¥å£åˆ†æ</p></blockquote><p>æŸ¥çœ‹æºç ï¼Œå¯ä»¥çœ‹åˆ° InstantiationAwareBeanPostProcessor æ¥å£æ˜¯ç»§æ‰¿  BeanPostProcessor</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">InstantiationAwareBeanPostProcessor</span> <span class="hljs-symbol">extends</span> <span class="hljs-symbol">BeanPostProcessor</span><br></code></pre></td></tr></table></figure><blockquote><p>BeanPostProcessor</p></blockquote><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BeanPostProcessor</span> &#123;  <br>    <span class="hljs-meta">@Nullable</span>  <br>    <span class="hljs-keyword">default</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">postProcessBeforeInitialization</span>(<span class="hljs-title class_">Object</span> bean, <span class="hljs-title class_">String</span> beanName) throws <span class="hljs-title class_">BeansException</span> &#123;  <br>        <span class="hljs-keyword">return</span> bean;  <br>    &#125;  <br>  <br>    <span class="hljs-meta">@Nullable</span>  <br>    <span class="hljs-keyword">default</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">postProcessAfterInitialization</span>(<span class="hljs-title class_">Object</span> bean, <span class="hljs-title class_">String</span> beanName) throws <span class="hljs-title class_">BeansException</span> &#123;  <br>        <span class="hljs-keyword">return</span> bean;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>AbstractAutowireCapableBeanFactory#createBean</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-comment">// åˆ›å»ºBeanå®ä¾‹çš„æ–¹æ³•ï¼Œæ¥æ”¶Beançš„åç§°ã€RootBeanDefinitionï¼ˆBeançš„å®šä¹‰ä¿¡æ¯ï¼‰å’Œå‚æ•°æ•°ç»„</span><br>protected Object createBean(<span class="hljs-keyword">String</span> beanName, RootBeanDefinition mbd, <span class="hljs-meta">@Nullable Object[] args) throws BeanCreationException &#123;</span><br>    <span class="hljs-comment">// å¦‚æœå¯ç”¨äº†è·Ÿè¸ªæ—¥å¿—ï¼Œè¾“å‡ºåˆ›å»ºBeanå®ä¾‹çš„è·Ÿè¸ªä¿¡æ¯</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.logger.isTraceEnabled()) &#123;<br>        <span class="hljs-built_in">this</span>.logger.<span class="hljs-built_in">trace</span>(<span class="hljs-string">&quot;Creating instance of bean &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// è§£æBeançš„ç±»ä¿¡æ¯ï¼Œå¦‚æœå·²ç»æœ‰è§£æè¿‡çš„ç±»ä¿¡æ¯ï¼Œä½¿ç”¨ä¹‹å‰è§£æå¾—åˆ°çš„ç±»ä¿¡æ¯</span><br>    RootBeanDefinition mbdToUse = mbd;<br>    Class&lt;?&gt; resolvedClass = <span class="hljs-built_in">this</span>.resolveBeanClass(mbd, beanName, <span class="hljs-keyword">new</span> <span class="hljs-type">Class</span>[<span class="hljs-number">0</span>]);<br>    <span class="hljs-comment">// å¦‚æœè§£æå¾—åˆ°çš„ç±»ä¿¡æ¯ä¸ä¸ºç©ºï¼Œä¸”å½“å‰Beançš„å®šä¹‰ä¿¡æ¯æ²¡æœ‰æŒ‡å®šç±»ä¿¡æ¯ï¼Œåˆ™æ›´æ–°Beançš„å®šä¹‰ä¿¡æ¯</span><br>    <span class="hljs-keyword">if</span> (resolvedClass != <span class="hljs-literal">null</span> &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != <span class="hljs-literal">null</span>) &#123;<br>        mbdToUse = <span class="hljs-keyword">new</span> <span class="hljs-type">RootBeanDefinition</span>(mbd);<br>        mbdToUse.setBeanClass(resolvedClass);<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// å‡†å¤‡å¤„ç†æ–¹æ³•çš„è¦†ç›–ï¼Œå³å‡†å¤‡è§£ææ–¹æ³•æ³¨è§£</span><br>        mbdToUse.prepareMethodOverrides();<br>    &#125; <span class="hljs-keyword">catch</span> (BeanDefinitionValidationException var9) &#123;<br>        <span class="hljs-comment">// å¦‚æœæ–¹æ³•æ³¨è§£è§£æå¤±è´¥ï¼ŒæŠ›å‡ºBeanDefinitionStoreExceptionå¼‚å¸¸</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">BeanDefinitionStoreException</span>(mbdToUse.getResourceDescription(), beanName, <span class="hljs-string">&quot;Validation of method overrides failed&quot;</span>, var9);<br>    &#125;<br><br>    Object beanInstance;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// åœ¨å®ä¾‹åŒ–Beanä¹‹å‰ï¼Œå°è¯•è°ƒç”¨BeanPostProcessorçš„beforeInstantiationæ–¹æ³•</span><br>        beanInstance = <span class="hljs-built_in">this</span>.resolveBeforeInstantiation(beanName, mbdToUse);<br>        <span class="hljs-comment">// å¦‚æœbeforeInstantiationæ–¹æ³•è¿”å›éç©ºï¼Œè¡¨ç¤ºå·²ç»åˆ›å»ºäº†Beanå®ä¾‹ï¼Œç›´æ¥è¿”å›è¯¥å®ä¾‹</span><br>        <span class="hljs-keyword">if</span> (beanInstance != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> beanInstance;<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable var10) &#123;<br>        <span class="hljs-comment">// å¦‚æœbeforeInstantiationæ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼ŒæŠ›å‡ºBeanCreationExceptionå¼‚å¸¸</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">BeanCreationException</span>(mbdToUse.getResourceDescription(), beanName, <span class="hljs-string">&quot;BeanPostProcessor before instantiation of bean failed&quot;</span>, var10);<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// æ‰§è¡ŒçœŸæ­£çš„Beanåˆ›å»ºé€»è¾‘ï¼ŒåŒ…æ‹¬å®ä¾‹åŒ–ã€å±æ€§æ³¨å…¥ç­‰è¿‡ç¨‹</span><br>        beanInstance = <span class="hljs-built_in">this</span>.doCreateBean(beanName, mbdToUse, args);<br>        <span class="hljs-comment">// å¦‚æœå¯ç”¨äº†è·Ÿè¸ªæ—¥å¿—ï¼Œè¾“å‡ºBeanå®ä¾‹åˆ›å»ºå®Œæˆçš„è·Ÿè¸ªä¿¡æ¯</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.logger.isTraceEnabled()) &#123;<br>            <span class="hljs-built_in">this</span>.logger.<span class="hljs-built_in">trace</span>(<span class="hljs-string">&quot;Finished creating instance of bean &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">// è¿”å›åˆ›å»ºçš„Beanå®ä¾‹</span><br>        <span class="hljs-keyword">return</span> beanInstance;<br>    &#125; <span class="hljs-keyword">catch</span> (ImplicitlyAppearedSingletonException | BeanCreationException var7) &#123;<br>        <span class="hljs-comment">// å¦‚æœBeanåˆ›å»ºè¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼ŒæŠ›å‡ºå¼‚å¸¸</span><br>        <span class="hljs-keyword">throw</span> var7;<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable var8) &#123;<br>        <span class="hljs-comment">// å¦‚æœBeanåˆ›å»ºè¿‡ç¨‹ä¸­å‡ºç°äº†æœªæ•è·çš„å¼‚å¸¸ï¼ŒæŠ›å‡ºBeanCreationExceptionå¼‚å¸¸</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-type">BeanCreationException</span>(mbdToUse.getResourceDescription(), beanName, <span class="hljs-string">&quot;Unexpected exception during bean creation&quot;</span>, var8);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h4 id="Bean-åˆ›å»ºæµç¨‹å…¥å£-refresh"><a href="#Bean-åˆ›å»ºæµç¨‹å…¥å£-refresh" class="headerlink" title="Bean åˆ›å»ºæµç¨‹å…¥å£ refresh()"></a>Bean åˆ›å»ºæµç¨‹å…¥å£ refresh()</h4><h5 id="Bean-åˆ›å»ºæµç¨‹å…¥å£"><a href="#Bean-åˆ›å»ºæµç¨‹å…¥å£" class="headerlink" title="Bean åˆ›å»ºæµç¨‹å…¥å£"></a>Bean åˆ›å»ºæµç¨‹å…¥å£</h5><p>è¿™é‡Œç›´æ¥è·Ÿä¸€ä¸‹æºç çœ‹ä¸€ä¸‹ç›¸å…³å†…å®¹</p><p>ä¸‹é¢çš„ä»£ç æ˜¯ä» spring-context-5.2.4.RELEASE ç‰ˆæœ¬ä¸­çš„ AbstractApplicationContext æŠ½è±¡ç±»ä¸‹ç›¸å…³æ–¹æ³•å’Œå†…å®¹è¯´æ˜ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸Šä¸‹æ–‡ç±»ä¸­ï¼ˆå¦‚ <code>ClassPathXmlApplicationContext</code> å’Œ <code>AnnotationConfigApplicationContext</code>ï¼‰ï¼Œä»–ä»¬çš„æ„é€ æ–¹æ³•ä¸­ä¼šè°ƒç”¨è¿™ä¸ª refresh() æ–¹æ³•ç±»è¿›è¡Œåˆå§‹åŒ– Spring å®¹å™¨ã€‚</p><p>å› æ­¤å¯ä»¥åˆ¤æ–­å‡º  Bean åˆ›å»ºæµç¨‹å…¥å£ æ˜¯å®šä¹‰åœ¨ AbstractApplicationContext æŠ½è±¡ç±»ä¸‹ refresh() æ–¹æ³•ã€‚</p><h5 id="refresshæ–¹æ³•"><a href="#refresshæ–¹æ³•" class="headerlink" title="refresshæ–¹æ³•"></a>refresshæ–¹æ³•</h5><p>è¿™é‡Œå®é™…çœ‹ä¸€ä¸‹ç›¸å…³ä»£ç  AbstractApplicationContext#refresh()</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> void refresh() throws BeansException, IllegalStateException &#123;<br>    <span class="hljs-comment">// åŒæ­¥é”ç¡®ä¿å®¹å™¨åˆ·æ–°æ—¶çš„çº¿ç¨‹å®‰å…¨</span><br>    synchronized (<span class="hljs-keyword">this</span>.startupShutdownMonitor) &#123;<br><br>        <span class="hljs-comment">// å‡†å¤‡åˆ·æ–°ï¼Œè®¾ç½®å¯åŠ¨æ—¥æœŸå’Œæ´»è·ƒçŠ¶æ€ç­‰</span><br>        <span class="hljs-keyword">this</span>.prepareRefresh();<br><br>        <span class="hljs-comment">// è·å–æ–°çš„ BeanFactoryï¼Œåˆå§‹åŒ– BeanFactoryï¼Œå¹¶åŠ è½½ Bean å®šä¹‰</span><br>        ConfigurableListableBeanFactory beanFactory = <span class="hljs-keyword">this</span>.obtainFreshBeanFactory();<br><br>        <span class="hljs-comment">// é…ç½® BeanFactoryï¼Œè®¾ç½®ç±»åŠ è½½å™¨ã€äº‹ä»¶å¤„ç†å™¨ç­‰</span><br>        <span class="hljs-keyword">this</span>.prepareBeanFactory(beanFactory);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// å…è®¸åœ¨ BeanFactory æ ‡å‡†åˆå§‹åŒ–ä¹‹åè¿›è¡Œå®šåˆ¶ä¿®æ”¹</span><br>            <span class="hljs-keyword">this</span>.postProcessBeanFactory(beanFactory);<br><br>            <span class="hljs-comment">// è°ƒç”¨åœ¨å®¹å™¨ä¸­æ³¨å†Œçš„ BeanFactoryPostProcessor</span><br>            <span class="hljs-keyword">this</span>.invokeBeanFactoryPostProcessors(beanFactory);<br><br>            <span class="hljs-comment">// æ³¨å†Œ BeanPostProcessorï¼Œè¿™äº›å¤„ç†å™¨å½±å“æ‰€æœ‰ Bean çš„åˆ›å»º</span><br>            <span class="hljs-keyword">this</span>.registerBeanPostProcessors(beanFactory);<br><br>            <span class="hljs-comment">// åˆå§‹åŒ– MessageSource ç»„ä»¶ï¼Œç”¨äºå›½é™…åŒ–å¤„ç†</span><br>            <span class="hljs-keyword">this</span>.initMessageSource();<br><br>            <span class="hljs-comment">// åˆå§‹åŒ– ApplicationEventMulticasterï¼Œç”¨äºäº‹ä»¶å¹¿æ’­</span><br>            <span class="hljs-keyword">this</span>.initApplicationEventMulticaster();<br><br>            <span class="hljs-comment">// ç‰¹å®šäº ApplicationContext çš„åˆ·æ–°æ“ä½œ</span><br>            <span class="hljs-keyword">this</span>.onRefresh();<br><br>            <span class="hljs-comment">// æ³¨å†Œç›‘å¬å™¨åˆ°äº‹ä»¶å¹¿æ’­å™¨</span><br>            <span class="hljs-keyword">this</span>.registerListeners();<br><br>            <span class="hljs-comment">// åˆå§‹åŒ–æ‰€æœ‰å‰©ä½™çš„éæ‡’åŠ è½½å•ä¾‹</span><br>            <span class="hljs-keyword">this</span>.finishBeanFactoryInitialization(beanFactory);<br><br>            <span class="hljs-comment">// å®Œæˆåˆ·æ–°è¿‡ç¨‹ï¼Œé€šçŸ¥ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨ä»¥åŠå‘å¸ƒç›¸åº”çš„äº‹ä»¶</span><br>            <span class="hljs-keyword">this</span>.finishRefresh();<br>        &#125; <span class="hljs-keyword">catch</span> (BeansException var9) &#123;<br>            <span class="hljs-comment">// åœ¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–è¿‡ç¨‹ä¸­æ•è·å¹¶å¤„ç†å¼‚å¸¸</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.logger.isWarnEnabled()) &#123;<br>                <span class="hljs-keyword">this</span>.logger.warn(<span class="hljs-string">&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot;</span> + var9);<br>            &#125;<br><br>            <span class="hljs-comment">// é”€æ¯å·²åˆ›å»ºçš„ Beanï¼Œä»¥é˜²æœ‰äº› Bean å·²ç»åˆå§‹åŒ–äº†ï¼Œä½†åç»­çš„åˆå§‹åŒ–è¿‡ç¨‹å¤±è´¥äº†</span><br>            <span class="hljs-keyword">this</span>.destroyBeans();<br><br>            <span class="hljs-comment">// å–æ¶ˆåˆ·æ–°æ“ä½œï¼Œé‡ç½®ä¸Šä¸‹æ–‡çš„åŒæ­¥æ ‡å¿—</span><br>            <span class="hljs-keyword">this</span>.cancelRefresh(var9);<br><br>            <span class="hljs-comment">// é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œé€šçŸ¥å¤–éƒ¨è°ƒç”¨è€…</span><br>            <span class="hljs-keyword">throw</span> var9;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">// é‡ç½®å…¬å…±ç¼“å­˜ï¼ˆä¾‹å¦‚ Reflection ç¼“å­˜ï¼‰</span><br>            <span class="hljs-keyword">this</span>.resetCommonCaches();<br>        &#125;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åˆå§‹åŒ–å•ä¾‹è¿™æ­¥æ“ä½œæ˜¯åœ¨ this.finishBeanFactoryInitialization(beanFactory); è¿™é‡Œè¿›è¡Œçš„</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-type">void</span> <span class="hljs-title">finishBeanFactoryInitialization</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;<br>    <span class="hljs-comment">// å¦‚æœ BeanFactory åŒ…å«åä¸º &quot;conversionService&quot; çš„ Beanï¼Œå¹¶ä¸”è¿™ä¸ª Bean é€‚é…äº ConversionService ç±»å‹</span><br>    <span class="hljs-keyword">if</span> (beanFactory.<span class="hljs-built_in">containsBean</span>(<span class="hljs-string">&quot;conversionService&quot;</span>) &amp;&amp; beanFactory.<span class="hljs-built_in">isTypeMatch</span>(<span class="hljs-string">&quot;conversionService&quot;</span>, ConversionService.<span class="hljs-keyword">class</span>)) &#123;<br>        <span class="hljs-comment">// å°†è¿™ä¸ª Bean è®¾ç½®ä¸ºå®¹å™¨çš„ ConversionService</span><br>        beanFactory.<span class="hljs-built_in">setConversionService</span>((ConversionService)beanFactory.<span class="hljs-built_in">getBean</span>(<span class="hljs-string">&quot;conversionService&quot;</span>, ConversionService.<span class="hljs-keyword">class</span>));<br>    &#125;<br><br>    <span class="hljs-comment">// å¦‚æœ BeanFactory è¿˜æ²¡æœ‰åµŒå…¥çš„å€¼è§£æå™¨</span><br>    <span class="hljs-keyword">if</span> (!beanFactory.<span class="hljs-built_in">hasEmbeddedValueResolver</span>()) &#123;<br>        <span class="hljs-comment">// æ·»åŠ ä¸€ä¸ªåµŒå…¥çš„å€¼è§£æå™¨ï¼Œç”¨äºè§£æå ä½ç¬¦</span><br>        beanFactory.<span class="hljs-built_in">addEmbeddedValueResolver</span>(strVal -&gt; &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.<span class="hljs-built_in">getEnvironment</span>().<span class="hljs-built_in">resolvePlaceholders</span>(strVal);<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-comment">// è·å–æ‰€æœ‰å®ç° LoadTimeWeaverAware æ¥å£çš„ Bean çš„åç§°</span><br>    <span class="hljs-type">String</span>[] weaverAwareNames = beanFactory.<span class="hljs-built_in">getBeanNamesForType</span>(LoadTimeWeaverAware.<span class="hljs-keyword">class</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<br>    <br>    <span class="hljs-comment">// éå†è¿™äº› Bean åç§°</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> weaverAwareName : weaverAwareNames) &#123;<br>        <span class="hljs-comment">// åˆå§‹åŒ–ç›¸åº”çš„ Beanï¼Œä»¥ç¡®ä¿å®ƒä»¬èƒ½å¤Ÿæ‰§è¡ŒåŠ è½½æ—¶ç»‡å…¥ï¼ˆLoad Time Weavingï¼‰çš„ç›¸å…³é€»è¾‘</span><br>        <span class="hljs-keyword">this</span>.<span class="hljs-built_in">getBean</span>(weaverAwareName);<br>    &#125;<br><br>    <span class="hljs-comment">// å°† BeanFactory çš„ä¸´æ—¶ç±»åŠ è½½å™¨è®¾ç½®ä¸º null</span><br>    beanFactory.<span class="hljs-built_in">setTempClassLoader</span>(null);<br><br>    <span class="hljs-comment">// å†»ç»“æ‰€æœ‰çš„ Bean å®šä¹‰ï¼Œè¡¨ç¤ºæ³¨å†Œçš„ Bean å®šä¹‰å°†ä¸å†è¢«ä¿®æ”¹æˆ–ä»»ä½•è¿›ä¸€æ­¥çš„å¤„ç†</span><br>    beanFactory.<span class="hljs-built_in">freezeConfiguration</span>();<br><br>    <span class="hljs-comment">// é¢„å®ä¾‹åŒ–å•ä¾‹ï¼Œç¡®ä¿æ‰€æœ‰éæ‡’åŠ è½½çš„å•ä¾‹éƒ½è¢«å®ä¾‹åŒ–</span><br>    beanFactory.<span class="hljs-built_in">preInstantiateSingletons</span>();<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="äº”ã€è§†é¢‘å­¦ä¹ "><a href="#äº”ã€è§†é¢‘å­¦ä¹ " class="headerlink" title="äº”ã€è§†é¢‘å­¦ä¹ "></a>äº”ã€è§†é¢‘å­¦ä¹ </h3><h4 id="Spring-Bean-çš„ç”Ÿå‘½å‘¨æœŸ001"><a href="#Spring-Bean-çš„ç”Ÿå‘½å‘¨æœŸ001" class="headerlink" title="Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ001"></a>Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ001</h4><p>è§†é¢‘åœ°å€ï¼š  <a href="https://www.bilibili.com/video/BV1584y1r7n6/">https://www.bilibili.com/video/BV1584y1r7n6/</a></p><p>ä½œä¸ºéƒ¨åˆ†å†…å®¹å­¦ä¹ å’Œå›é¡¾ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231218215844.png" alt="image.png"></p><p>ç”Ÿäº§ â†’  ä½¿ç”¨  â†’  é”€æ¯</p><h5 id="ç”Ÿäº§"><a href="#ç”Ÿäº§" class="headerlink" title="ç”Ÿäº§"></a>ç”Ÿäº§</h5><p>å¯åŠ¨ï¼Œå‡†å¤‡å®¹å™¨&#x2F;ç¯å¢ƒç­‰</p><p>â‘  åŠ è½½ Bean å®šä¹‰ï¼ˆBeanDefinitions)</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus">åŠ è½½Beanå®šä¹‰<br><br><span class="hljs-function"><span class="hljs-title">run</span><span class="hljs-params">()</span></span><br>â†’<br><span class="hljs-function"><span class="hljs-title">refreshContext</span><span class="hljs-params">()</span></span><br>â†’ <br><span class="hljs-function"><span class="hljs-title">refresh</span><span class="hljs-params">()</span></span><br>â†’ <br><span class="hljs-function"><span class="hljs-title">obtainFreshBeanFactory</span><span class="hljs-params">()</span></span><br>â†’<br><span class="hljs-function"><span class="hljs-title">refreshBeanFactory</span><span class="hljs-params">()</span></span><br>â†’<br><span class="hljs-function"><span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></table></figure><p>é€šè¿‡ loadBeanDefinitions æ‰«ææ‰€æœ‰xmlé…ç½®ã€æ³¨è§£å°†Beanè®°å½•åœ¨ Beanå®šä¹‰é›†åˆ beanDefinitionMap ä¸­</p><p>â‘¡åˆ›å»º Bean å¯¹è±¡ï¼ˆcreateBean)</p><p>éå†â€œBeanå®šä¹‰â€é›†åˆ</p><p>é€šè¿‡ createBean éå† beanDefinitionMap åˆ›å»ºbean</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus">åˆ›å»ºBean<br><br><span class="hljs-function"><span class="hljs-title">run</span><span class="hljs-params">()</span></span><br>â†’<br><span class="hljs-function"><span class="hljs-title">refreshContext</span><span class="hljs-params">()</span></span><br>â†’ <br><span class="hljs-function"><span class="hljs-title">refresh</span><span class="hljs-params">()</span></span><br>â†’ <br><span class="hljs-function"><span class="hljs-title">finishBeanFactoryInitialization</span><span class="hljs-params">()</span></span><br>â†’<br><span class="hljs-function"><span class="hljs-title">preInstantiateSingletioins</span><span class="hljs-params">()</span></span><br>â†’<br><span class="hljs-function"><span class="hljs-title">doGetBean</span><span class="hljs-params">()</span></span><br>â†’<br><span class="hljs-function"><span class="hljs-title">createBean</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></table></figure><blockquote><p>2.1.æ„é€ å¯¹è±¡</p></blockquote><p>é€šè¿‡ createBeanInstance æ–¹æ³•è¿›è¡Œå¯¹è±¡çš„æ„é€ </p><p>ä½¿ç”¨åå°„æœºåˆ¶ä»â€œBeanå®šä¹‰â€ä¸­çš„BeanClassæ‹¿åˆ°ç±»çš„æ„é€ æ–¹æ³•</p><p>å‡†å¤‡å‚æ•°ï¼šåœ¨å•ä¾‹æ± ä¸­ï¼Œæ ¹æ®å‚æ•°çš„Classç±»è¿›è¡ŒæŸ¥æ‰¾</p><p>æ„é€ å¯¹è±¡ï¼šé€šè¿‡åå°„è¿›è¡ŒBeançš„æ„é€ ï¼ˆå¦‚æœæ˜¯æ— å‚åˆ™æ— éœ€å‡†å¤‡å‚æ•°ç›´æ¥æ„é€ ï¼‰</p><hr><p>æŸ¥æ‰¾Classç±»<br>    å½“åŒ¹é…åˆ°å¤šä¸ªå®ä¾‹ï¼Œ<br>    ä¼šå†æ ¹æ®å‚æ•°åè¿›è¡ŒåŒ¹é…</p><blockquote><p>2.2.å¡«å……å±æ€§</p></blockquote><p>é€šè¿‡ populateBean æ–¹æ³•å¯¹ Bean å†…éƒ¨æ‰€éœ€å±æ€§è¿›è¡Œå±æ€§å¡«å……, é€šå¸¸æ˜¯ @Autowired æ³¨è§£çš„å˜é‡</p><p>ä¸‰çº§ç¼“å­˜è¿›è¡Œä¾èµ–æ³¨å…¥</p><blockquote><p>2.3.åˆå§‹åŒ–å®ä¾‹</p></blockquote><p>é€šè¿‡ initializeBean æ–¹æ³•å¯¹å®ä¾‹è¿›è¡Œåˆå§‹åŒ–</p><p>åˆå§‹åŒ–æ“ä½œï¼š</p><ol><li>åˆå§‹åŒ–å®¹å™¨ç›¸å…³ä¿¡æ¯<br>é€šè¿‡ invokeAwareMethods æ–¹æ³•ä¸ºå®ç°å„ç§ Aware æ¥å£çš„Beanè®¾ç½®è¯¸å¦‚ beanName, beanFactory ç­‰å®¹å™¨ä¿¡æ¯<br>Aware æ¥å£æŒ‡ä»£ï¼šä¿¡æ¯æ„ŸçŸ¥æ¥å£</li><li>é€šè¿‡ invokeInitMethods æ–¹æ³•æ‰§è¡Œ Bean çš„åˆå§‹åŒ–æ–¹æ³•</li></ol><p>è¯¥ invokeInitMethods æ–¹æ³•æ˜¯é€šè¿‡å®ç° InitializingBean æ¥å£è€Œå®ç°çš„ afterPropertiesSet æ–¹æ³•<br>ã€Beanå¡«å……å±æ€§åæ‰§è¡Œã€‘  ((InitializingBean)bean).afterPropertiesSet()</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs csharp">afterPropertiesSet <br><br>â†“ <br><br><span class="hljs-keyword">init</span>-Methods<br><br>â†“<br><br>BeanPostProcessors<br></code></pre></td></tr></table></figure><hr><h5 id="é”€æ¯æ“ä½œ"><a href="#é”€æ¯æ“ä½œ" class="headerlink" title="é”€æ¯æ“ä½œ"></a>é”€æ¯æ“ä½œ</h5><ul><li>é”€æ¯æ“ä½œ<ul><li>é”€æ¯å‰<ul><li>é”€æ¯ä¹‹å‰ä¼šæ‰§è¡Œ postProcessBeforeDestruction â€œé”€æ¯å‰å¤„ç†å™¨â€œï¼Œè¿™æ­¥ä¼šæ‰§è¡Œ Bean ä¸­ @PreDestroy æ³¨è§£çš„æ–¹æ³•</li></ul></li><li>å®¹å™¨é”€æ¯<ul><li>åç»­é€šè¿‡ destoryBeans æ–¹æ³•é€ä¸€â€œé”€æ¯â€å®¹å™¨ä¸­çš„Beanï¼Œé”€æ¯çš„æ—¶å€™ä¼šæ‰§è¡Œ destroy æ–¹æ³•ï¼ˆé€šè¿‡registerDisposableBeanæ–¹æ³•æ³¨å†Œçš„Beanï¼Œè¯¥æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³• destroyã€‚</li><li>åœ¨Beané”€æ¯çš„æ—¶å€™ï¼ŒSpringå®¹å™¨ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ï¼‰</li></ul></li><li>Beanè‡ªå®šä¹‰é”€æ¯æ–¹æ³•<ul><li>â€œå®¢æˆ·é”€æ¯æ–¹æ³•â€invokeCustomDestroyMethod; â†’  æ‰§è¡ŒBeanä¸Šè‡ªå®šä¹‰çš„ destoryMethod æ–¹æ³•</li></ul></li></ul></li></ul><h3 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h3><h4 id="Spring-Bean-ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾"><a href="#Spring-Bean-ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾" class="headerlink" title="Spring Bean ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾"></a><strong>Spring Bean ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾</strong></h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312160247944.png" alt="image.png"></p><hr><p>å‚è€ƒ</p><ul><li><a href="https://docs.spring.io/spring-framework/reference/6.1-SNAPSHOT/core/beans.html">https://docs.spring.io/spring-framework/reference/6.1-SNAPSHOT/core/beans.html</a></li><li><a href="https://springdoc.cn/spring/core.html#spring-core">https://springdoc.cn/spring/core.html#spring-core</a></li><li><a href="https://www.bilibili.com/video/BV1584y1r7n6">https://www.bilibili.com/video/BV1584y1r7n6</a></li><li><a href="https://javaguide.cn/system-design/framework/spring/spring-knowledge-and-questions-summary.html">https://javaguide.cn/system-design/framework/spring/spring-knowledge-and-questions-summary.html</a></li><li><a href="https://blog.csdn.net/riemann_/article/details/118500805">https://blog.csdn.net/riemann_/article/details/118500805</a></li><li><a href="https://blog.csdn.net/qq_20021569/article/details/109178816">https://blog.csdn.net/qq_20021569/article/details/109178816</a></li><li><a href="https://gitee.com/moxi159753/LearningNotes/tree/master/%E6%A0%A1%E6%8B%9B%E9%9D%A2%E8%AF%95/Spring%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90">https://gitee.com/moxi159753/LearningNotes/tree/master/%E6%A0%A1%E6%8B%9B%E9%9D%A2%E8%AF%95/Spring%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90</a></li><li><a href="https://cloud.tencent.com/developer/article/2216932">https://cloud.tencent.com/developer/article/2216932</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLå­¦ä¹ _æ€§èƒ½ä¼˜åŒ–</title>
    <link href="/2023/12/15/MySQL%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A801/"/>
    <url>/2023/12/15/MySQL%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A801/</url>
    
    <content type="html"><![CDATA[<h3 id="æ€§èƒ½ä¼˜åŒ–éƒ¨åˆ†"><a href="#æ€§èƒ½ä¼˜åŒ–éƒ¨åˆ†" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–éƒ¨åˆ†"></a>æ€§èƒ½ä¼˜åŒ–éƒ¨åˆ†</h3><p>æ€§èƒ½ä¼˜åŒ–å‚è€ƒï¼š <a href="https://javaguide.cn/database/mysql/mysql-questions-01.html#mysql-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">https://javaguide.cn/database/mysql/mysql-questions-01.html#mysql-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96</a></p><p>è§„èŒƒ</p><p>ç•¥</p><h3 id="å¸¸è§-SQL"><a href="#å¸¸è§-SQL" class="headerlink" title="å¸¸è§ SQL"></a>å¸¸è§ SQL</h3><h4 id="ç¤ºä¾‹æ•°æ®"><a href="#ç¤ºä¾‹æ•°æ®" class="headerlink" title="ç¤ºä¾‹æ•°æ®"></a>ç¤ºä¾‹æ•°æ®</h4><p>æ³¨æ„ä¸€ä¸‹åœ¨  <code>utf8mb4</code>  çš„æ•°æ®åº“ä¸­æ“ä½œ</p><p>åˆ›å»ºç¤ºä¾‹è¡¨</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Student (<br>    student_id <span class="hljs-type">INT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY KEY</span>,<br>    <span class="hljs-type">name</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    age <span class="hljs-type">INT</span>,<br>    gender <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>)<br>);<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Score (<br>    record_id <span class="hljs-type">INT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY KEY</span>,<br>    student_id <span class="hljs-type">INT</span>,<br>    subject <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    score <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>),<br>    exam_date <span class="hljs-type">DATE</span>,<br>    <span class="hljs-keyword">FOREIGN KEY</span> (student_id) <span class="hljs-keyword">REFERENCES</span> Student(student_id)<br>);<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹æ•°æ®</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs 1c">INSERT INTO Student (name, age, gender) VALUES<br>(&#x27;å¼ ä¸‰&#x27;, <span class="hljs-number">20</span>, &#x27;ç”·&#x27;),<br>(&#x27;æå››&#x27;, <span class="hljs-number">19</span>, &#x27;ç”·&#x27;),<br>(&#x27;ç‹äº”&#x27;, <span class="hljs-number">21</span>, &#x27;å¥³&#x27;),<br>(&#x27;èµµå…­&#x27;, <span class="hljs-number">22</span>, &#x27;å¥³&#x27;),<br>(&#x27;å­™ä¸ƒ&#x27;, <span class="hljs-number">18</span>, &#x27;ç”·&#x27;);<br><br>INSERT INTO Score (student_id, subject, score, exam_date) VALUES<br>(<span class="hljs-number">1</span>, &#x27;æ•°å­¦&#x27;, <span class="hljs-number">85.5</span>, &#x27;<span class="hljs-number">2023-10-01</span>&#x27;),<br>(<span class="hljs-number">1</span>, &#x27;è‹±è¯­&#x27;, <span class="hljs-number">78.0</span>, &#x27;<span class="hljs-number">2023-10-02</span>&#x27;),<br>(<span class="hljs-number">1</span>, &#x27;ç‰©ç†&#x27;, <span class="hljs-number">92.0</span>, &#x27;<span class="hljs-number">2023-10-03</span>&#x27;),<br><br>(<span class="hljs-number">2</span>, &#x27;æ•°å­¦&#x27;, <span class="hljs-number">88.0</span>, &#x27;<span class="hljs-number">2023-10-01</span>&#x27;),<br>(<span class="hljs-number">2</span>, &#x27;è‹±è¯­&#x27;, <span class="hljs-number">74.5</span>, &#x27;<span class="hljs-number">2023-10-02</span>&#x27;),<br>(<span class="hljs-number">2</span>, &#x27;åŒ–å­¦&#x27;, <span class="hljs-number">91.0</span>, &#x27;<span class="hljs-number">2023-10-04</span>&#x27;),<br><br>(<span class="hljs-number">3</span>, &#x27;è‹±è¯­&#x27;, <span class="hljs-number">82.0</span>, &#x27;<span class="hljs-number">2023-10-02</span>&#x27;),<br>(<span class="hljs-number">3</span>, &#x27;ç”Ÿç‰©&#x27;, <span class="hljs-number">87.0</span>, &#x27;<span class="hljs-number">2023-10-05</span>&#x27;),<br>(<span class="hljs-number">3</span>, &#x27;åŒ–å­¦&#x27;, <span class="hljs-number">79.0</span>, &#x27;<span class="hljs-number">2023-10-04</span>&#x27;),<br><br>(<span class="hljs-number">4</span>, &#x27;ç‰©ç†&#x27;, <span class="hljs-number">95.0</span>, &#x27;<span class="hljs-number">2023-10-03</span>&#x27;),<br>(<span class="hljs-number">4</span>, &#x27;åŒ–å­¦&#x27;, <span class="hljs-number">88.0</span>, &#x27;<span class="hljs-number">2023-10-04</span>&#x27;),<br>(<span class="hljs-number">4</span>, &#x27;ç”Ÿç‰©&#x27;, <span class="hljs-number">90.0</span>, &#x27;<span class="hljs-number">2023-10-05</span>&#x27;),<br><br>(<span class="hljs-number">5</span>, &#x27;æ•°å­¦&#x27;, <span class="hljs-number">93.0</span>, &#x27;<span class="hljs-number">2023-10-01</span>&#x27;),<br>(<span class="hljs-number">5</span>, &#x27;è‹±è¯­&#x27;, <span class="hljs-number">85.0</span>, &#x27;<span class="hljs-number">2023-10-02</span>&#x27;),<br>(<span class="hljs-number">5</span>, &#x27;ç‰©ç†&#x27;, <span class="hljs-number">88.0</span>, &#x27;<span class="hljs-number">2023-10-03</span>&#x27;),<br>(<span class="hljs-number">5</span>, &#x27;åŒ–å­¦&#x27;, <span class="hljs-number">84.0</span>, &#x27;<span class="hljs-number">2023-10-04</span>&#x27;);<br></code></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢ä¸åŒç§‘ç›®ä¸‹çš„å­¦ç”Ÿæˆç»©"><a href="#æŸ¥è¯¢ä¸åŒç§‘ç›®ä¸‹çš„å­¦ç”Ÿæˆç»©" class="headerlink" title="æŸ¥è¯¢ä¸åŒç§‘ç›®ä¸‹çš„å­¦ç”Ÿæˆç»©"></a>æŸ¥è¯¢ä¸åŒç§‘ç›®ä¸‹çš„å­¦ç”Ÿæˆç»©</h4><p>å‚è€ƒä¸€ä¸‹è¿™ä¸ªï¼š <a href="https://www.cnblogs.com/kongxiaoshuang/p/17643868.html">https://www.cnblogs.com/kongxiaoshuang/p/17643868.html</a></p><p>å¤§æ¦‚çš„æ–¹å¼æœ‰å‡ ç§ï¼š</p><ul><li>1ã€ä½¿ç”¨ case when çš„æ–¹å¼ï¼ˆå›ºå®šåˆ—ï¼Œç„¶åè¿›è¡Œå±•ç¤ºï¼‰</li><li>2ã€ä½¿ç”¨ sum if çš„æ–¹å¼</li><li>3ã€ä½¿ç”¨åŠ¨æ€SQLçš„æ–¹å¼</li></ul><p>ä½¿ç”¨ case when çš„æ–¹å¼</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span><br>    s.student_id,<br>    s.name,<br>    MAX(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> sc.subject = <span class="hljs-string">&#x27;è‹±è¯­&#x27;</span> <span class="hljs-keyword">THEN</span> sc.score <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> è‹±è¯­æˆç»©,<br>    MAX(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> sc.subject = <span class="hljs-string">&#x27;æ•°å­¦&#x27;</span> <span class="hljs-keyword">THEN</span> sc.score <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> æ•°å­¦æˆç»©<br><span class="hljs-keyword">FROM</span><br>    Student s<br><span class="hljs-keyword">LEFT JOIN</span><br>    Score sc <span class="hljs-keyword">ON</span> s.student_id = sc.student_id<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span><br>    s.student_id, s.name;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ sum if çš„æ–¹å¼</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> <br>    s.student_id,<br>    s.name,<br>SUM(<span class="hljs-keyword">if</span> (sc.subject = <span class="hljs-string">&#x27;è‹±è¯­&#x27;</span>,sc.score,<span class="hljs-number">0</span>)) <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;è‹±è¯­æˆç»©&#x27;</span>,<br>SUM(<span class="hljs-keyword">if</span> (sc.subject = <span class="hljs-string">&#x27;æ•°å­¦&#x27;</span>,sc.score,<span class="hljs-number">0</span>)) <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;æ•°å­¦æˆç»©&#x27;</span><br><span class="hljs-keyword">FROM</span><br>    Student s<br><span class="hljs-keyword">LEFT JOIN</span><br>    Score sc <span class="hljs-keyword">ON</span> s.student_id = sc.student_id<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span><br>    s.student_id, s.name;<br></code></pre></td></tr></table></figure><h4 id="åŠ¨æ€å±•ç¤ºå¹¶æŸ¥è¯¢å‡ºæ¥"><a href="#åŠ¨æ€å±•ç¤ºå¹¶æŸ¥è¯¢å‡ºæ¥" class="headerlink" title="åŠ¨æ€å±•ç¤ºå¹¶æŸ¥è¯¢å‡ºæ¥"></a>åŠ¨æ€å±•ç¤ºå¹¶æŸ¥è¯¢å‡ºæ¥</h4><p>åŠ¨æ€ SQL çš„æ–¹å¼</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SET</span> @<span class="hljs-keyword">sql</span> = <span class="hljs-keyword">NULL</span>;<br><br><span class="hljs-comment">-- æ„é€ SELECTè¯­å¥</span><br><span class="hljs-keyword">SELECT</span><br>  GROUP_CONCAT(<span class="hljs-keyword">DISTINCT</span><br>    CONCAT(<br>      <span class="hljs-string">&#x27;MAX(CASE WHEN sc.subject = &#x27;&#x27;&#x27;</span>,<br>      subject,<br>      <span class="hljs-string">&#x27;&#x27;&#x27; THEN sc.score ELSE NULL END) AS `&#x27;</span>,<br>      subject, <span class="hljs-string">&#x27;`&#x27;</span><br>    )<br>  ) <span class="hljs-keyword">INTO</span> @<span class="hljs-keyword">sql</span><br><span class="hljs-keyword">FROM</span> Score;<br><br><span class="hljs-comment">-- å®Œæ•´çš„SQLæŸ¥è¯¢è¯­å¥</span><br><span class="hljs-keyword">SET</span> @<span class="hljs-keyword">sql</span> = CONCAT(<span class="hljs-string">&#x27;SELECT s.student_id, s.name, &#x27;</span>, @<span class="hljs-keyword">sql</span>, <span class="hljs-string">&#x27; </span><br><span class="hljs-string">                   FROM Student s </span><br><span class="hljs-string">                   LEFT JOIN Score sc </span><br><span class="hljs-string">                   ON s.student_id = sc.student_id </span><br><span class="hljs-string">                   GROUP BY s.student_id, s.name&#x27;</span>);<br><br><span class="hljs-comment">-- æ‰§è¡ŒåŠ¨æ€SQL</span><br><span class="hljs-keyword">PREPARE</span> stmt <span class="hljs-keyword">FROM</span> @<span class="hljs-keyword">sql</span>;<br><span class="hljs-keyword">EXECUTE</span> stmt;<br><span class="hljs-keyword">DEALLOCATE</span> <span class="hljs-keyword">PREPARE</span> stmt;<br></code></pre></td></tr></table></figure><h4 id="è¡Œè½¬åˆ—"><a href="#è¡Œè½¬åˆ—" class="headerlink" title="è¡Œè½¬åˆ—"></a>è¡Œè½¬åˆ—</h4><p>å‚è€ƒï¼š <a href="https://bbs.huaweicloud.com/blogs/400950">https://bbs.huaweicloud.com/blogs/400950</a></p><p>PIVOTå‡½æ•°æ˜¯MySQL8.0ç‰ˆæœ¬ä¸­æ–°å¢çš„å‡½æ•°ï¼Œç”¨äºå®ç°è¡Œè½¬åˆ—æ“ä½œã€‚</p><p>æ”¾å¼ƒè¡Œè½¬åˆ—ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨ CASE WHEN çš„æ–¹å¼</p><p>ï¼ˆåç»­çœ‹ä¸€ä¸‹ MySQL ç›¸å…³çš„è§†é¢‘å†…å®¹ï¼‰</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/database/mysql/mysql-high-performance-optimization-specification-recommendations.html">https://javaguide.cn/database/mysql/mysql-high-performance-optimization-specification-recommendations.html</a></li><li><a href="https://mp.weixin.qq.com/s/NM-aHaW6TXrnO6la6Jfl5A">https://mp.weixin.qq.com/s/NM-aHaW6TXrnO6la6Jfl5A</a></li><li><a href="https://mp.weixin.qq.com/s/XC8e5iuQtfsrEOERffEZ-Q">https://mp.weixin.qq.com/s/XC8e5iuQtfsrEOERffEZ-Q</a></li><li><a href="https://javaguide.cn/database/mysql/mysql-questions-01.html#mysql-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">https://javaguide.cn/database/mysql/mysql-questions-01.html#mysql-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå­¦ä¹ _Spring_Beançš„ä½œç”¨åŸŸ</title>
    <link href="/2023/12/14/Spring%E5%AD%A6%E4%B9%A0_Spring_Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F/"/>
    <url>/2023/12/14/Spring%E5%AD%A6%E4%B9%A0_Spring_Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¤ä¹ æ¦‚å¿µ</p></blockquote><blockquote><p>ä»€ä¹ˆæ˜¯ Spring Bean</p></blockquote><p>Bean ä»£æŒ‡çš„å°±æ˜¯é‚£äº›è¢« IoC å®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚</p><p>æˆ‘ä»¬éœ€è¦å‘Šè¯‰ IoC å®¹å™¨å¸®åŠ©æˆ‘ä»¬ç®¡ç†å“ªäº›å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥å®šä¹‰çš„ã€‚é…ç½®å…ƒæ•°æ®å¯ä»¥æ˜¯ XML æ–‡ä»¶ã€æ³¨è§£æˆ–è€… Java é…ç½®ç±»ã€‚</p><h3 id="Spring-ä¸­çš„-bean-çš„ä½œç”¨åŸŸæœ‰å“ªäº›"><a href="#Spring-ä¸­çš„-bean-çš„ä½œç”¨åŸŸæœ‰å“ªäº›" class="headerlink" title="Spring ä¸­çš„ bean çš„ä½œç”¨åŸŸæœ‰å“ªäº›"></a>Spring ä¸­çš„ bean çš„ä½œç”¨åŸŸæœ‰å“ªäº›</h3><p>è¿™ä¸ªé—®é¢˜æ˜¯é¢è¯•é¢˜åœºæ™¯çš„ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹åŸºæœ¬çš„ä¸€ä¸ªå›ç­”ã€‚</p><p>Spring ä¸­ Bean çš„ä½œç”¨åŸŸé€šå¸¸æœ‰ä¸‹é¢å‡ ç§ï¼š</p><ul><li><strong>singleton</strong> : IoC å®¹å™¨ä¸­åªæœ‰å”¯ä¸€çš„ bean å®ä¾‹ã€‚Spring ä¸­çš„ bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ï¼Œæ˜¯å¯¹å•ä¾‹è®¾è®¡æ¨¡å¼çš„åº”ç”¨ã€‚</li><li><strong>prototype</strong> : æ¯æ¬¡è·å–éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿ç»­ <code>getBean()</code> ä¸¤æ¬¡ï¼Œå¾—åˆ°çš„æ˜¯ä¸åŒçš„ Bean å®ä¾‹ã€‚</li><li><strong>request</strong> ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰: æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼ˆè¯·æ±‚ beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP request å†…æœ‰æ•ˆã€‚</li><li><strong>session</strong> ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ : æ¯ä¸€æ¬¡æ¥è‡ªæ–° session çš„ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼ˆä¼šè¯ beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚</li><li><strong>application&#x2F;global-session</strong> ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ï¼šæ¯ä¸ª Web åº”ç”¨åœ¨å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ª Beanï¼ˆåº”ç”¨ Beanï¼‰ï¼Œè¯¥ bean ä»…åœ¨å½“å‰åº”ç”¨å¯åŠ¨æ—¶é—´å†…æœ‰æ•ˆã€‚</li><li><strong>websocket</strong> ï¼ˆä»… Web åº”ç”¨å¯ç”¨ï¼‰ï¼šæ¯ä¸€æ¬¡ WebSocket ä¼šè¯äº§ç”Ÿä¸€ä¸ªæ–°çš„ beanã€‚</li></ul><blockquote><p>å¦‚ä½•é…ç½® bean çš„ä½œç”¨åŸŸ</p></blockquote><p>xml æ–¹å¼ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;bean <span class="hljs-attribute">id</span>=<span class="hljs-string">&quot;...&quot;</span> <span class="hljs-attribute">class</span>=<span class="hljs-string">&quot;...&quot;</span> <span class="hljs-attribute">scope</span>=<span class="hljs-string">&quot;singleton&quot;</span>&gt;&lt;/bean&gt;<br></code></pre></td></tr></table></figure><p>æ³¨è§£æ–¹å¼ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Bean</span><br><span class="hljs-variable">@Scope</span>(value = ConfigurableBeanFactory.SCOPE_PROTOTYPE)<br>public Person <span class="hljs-built_in">personPrototype</span>() &#123;<br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Person</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>å…·ä½“æ€ä¹ˆé…ç½®çš„çœ‹ä½ å®é™…ä½¿ç”¨ï¼Œè¿™é‡Œå¤§æ¦‚è®²ä¸€ä¸‹ä½¿ç”¨åœºæ™¯ï¼Œé€šè¿‡ä¸åŒåœºæ™¯ä¸‹çš„ä½¿ç”¨ç¤ºä¾‹å¯¹ Spring ä¸­ Bean çš„ä½œç”¨åŸŸæœ‰ä¸€ä¸ªåŸºæœ¬è®¤çŸ¥ã€‚</p><h4 id="Singleton-Beanï¼ˆé»˜è®¤ä½œç”¨åŸŸï¼‰"><a href="#Singleton-Beanï¼ˆé»˜è®¤ä½œç”¨åŸŸï¼‰" class="headerlink" title="Singleton Beanï¼ˆé»˜è®¤ä½œç”¨åŸŸï¼‰"></a>Singleton Beanï¼ˆé»˜è®¤ä½œç”¨åŸŸï¼‰</h4><p><strong>åœºæ™¯</strong>: åœ¨ä¸€ä¸ªåœ¨çº¿ä¹¦åº—åº”ç”¨ä¸­ï¼Œæœ‰ä¸€ä¸ªåº“å­˜ç®¡ç†æœåŠ¡è´Ÿè´£è·Ÿè¸ªæ‰€æœ‰ä¹¦ç±çš„åº“å­˜ã€‚è¿™ä¸ªæœåŠ¡éœ€è¦æ˜¯å•ä¾‹çš„ï¼Œå› ä¸ºå®ƒç»´æŠ¤ç€æ•´ä¸ªåº”ç”¨ä¸­ä¹¦ç±åº“å­˜çš„ç»Ÿä¸€è§†å›¾ã€‚</p><p>ä»£ç é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentHashMap;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InventoryService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Integer&gt; bookInventory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addBook</span><span class="hljs-params">(String isbn, <span class="hljs-type">int</span> quantity)</span> &#123;<br>        bookInventory.put(isbn, bookInventory.getOrDefault(isbn, <span class="hljs-number">0</span>) + quantity);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkStock</span><span class="hljs-params">(String isbn)</span> &#123;<br>        <span class="hljs-keyword">return</span> bookInventory.getOrDefault(isbn, <span class="hljs-number">0</span>) &gt; <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// ... å…¶ä»–ä¸åº“å­˜ç®¡ç†ç›¸å…³çš„æ–¹æ³• ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>InventoryService</code> æ˜¯ä¸€ä¸ªsingletonä½œç”¨åŸŸçš„Beanï¼Œå®ƒåœ¨åº”ç”¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…åªä¼šæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</p><p>æ‰€æœ‰å¯¹ä¹¦ç±åº“å­˜çš„æ“ä½œéƒ½é€šè¿‡è¿™ä¸ªå•ä¸€å®ä¾‹è¿›è¡Œï¼Œç¡®ä¿äº†åº“å­˜æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><h4 id="Prototypeä½œç”¨åŸŸ"><a href="#Prototypeä½œç”¨åŸŸ" class="headerlink" title="Prototypeä½œç”¨åŸŸ"></a>Prototypeä½œç”¨åŸŸ</h4><p><strong>åœºæ™¯</strong>: åœ¨åŒä¸€åœ¨çº¿ä¹¦åº—åº”ç”¨ä¸­ï¼Œå½“ç”¨æˆ·æƒ³è¦è´­ä¹°ä¹¦ç±æ—¶ï¼Œæ¯ä¸ªè´­ç‰©è½¦éƒ½åº”è¯¥æ˜¯ç‹¬ç«‹çš„ã€‚å› æ­¤ï¼Œæ¯ä¸ªç”¨æˆ·çš„è´­ç‰©è½¦åº”è¯¥æœ‰å…¶è‡ªå·±çš„çŠ¶æ€ã€‚</p><p>ä»£ç é€»è¾‘</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Scope</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Scope</span>(<span class="hljs-string">&quot;prototype&quot;</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShoppingCart</span> &#123;<br><br>    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Integer</span>&gt; items = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addItem</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> isbn</span>) &#123;<br>        items.<span class="hljs-title function_">put</span>(isbn, items.<span class="hljs-title function_">getOrDefault</span>(isbn, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Integer</span>&gt; <span class="hljs-title function_">getItems</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> items;<br>    &#125;<br><br>    <span class="hljs-comment">// ... è´­ç‰©è½¦çš„å…¶ä»–æ–¹æ³• ...</span><br>&#125;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShoppingService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ApplicationContext</span> context;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ShoppingCart</span> <span class="hljs-title function_">createNewShoppingCart</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> context.<span class="hljs-title function_">getBean</span>(<span class="hljs-title class_">ShoppingCart</span>.<span class="hljs-property">class</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œ<code>ShoppingService</code> ä½¿ç”¨Springçš„åº”ç”¨ä¸Šä¸‹æ–‡æ¥ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ–°çš„<code>ShoppingCart</code>å®ä¾‹ã€‚</p><p>æ¯æ¬¡è°ƒç”¨<code>createNewShoppingCart</code>æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªå…¨æ–°çš„è´­ç‰©è½¦å®ä¾‹ï¼Œä¿è¯äº†ç”¨æˆ·ä¹‹é—´è´­ç‰©è½¦çš„éš”ç¦»ã€‚</p><h4 id="Requestä½œç”¨åŸŸ"><a href="#Requestä½œç”¨åŸŸ" class="headerlink" title="Requestä½œç”¨åŸŸ"></a>Requestä½œç”¨åŸŸ</h4><p><strong>åœºæ™¯</strong>: åœ¨ä¸€ä¸ªæ–°é—»ç½‘ç«™åº”ç”¨ä¸­ï¼Œä½ éœ€è¦è·Ÿè¸ªæ¯ä¸ªHTTPè¯·æ±‚çš„è®¿é—®ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·çš„åœ°ç†ä½ç½®å’Œè®¾å¤‡ç±»å‹ï¼Œä»¥ä¾¿ä¸ºä»–ä»¬æä¾›å®šåˆ¶åŒ–çš„æ–°é—»å†…å®¹ã€‚</p><p>ä»£ç é€»è¾‘</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">import</span> org.springframework.web.context.annotation.RequestScope;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@RequestScope</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">UserContext</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">String</span> location;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">String</span> deviceType;<br><br>    <span class="hljs-keyword">public</span> UserContext(HttpServletRequest request) &#123;<br>        <span class="hljs-comment">// é€šè¿‡è¯·æ±‚è·å–ç”¨æˆ·çš„ä½ç½®å’Œè®¾å¤‡ç±»å‹</span><br>        <span class="hljs-built_in">this</span>.location = request.getHeader(<span class="hljs-string">&quot;Location&quot;</span>);<br>        <span class="hljs-built_in">this</span>.deviceType = request.getHeader(<span class="hljs-string">&quot;Device-Type&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> getLocation() &#123;<br>        <span class="hljs-keyword">return</span> location;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> getDeviceType() &#123;<br>        <span class="hljs-keyword">return</span> deviceType;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">NewsController</span> </span>&#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserContext userContext;<br><br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/news&quot;</span>)<br>    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;NewsItem&gt;&gt; getNews() &#123;<br>        List&lt;NewsItem&gt; <span class="hljs-keyword">new</span><span class="hljs-type">s</span> = <span class="hljs-keyword">new</span><span class="hljs-type">sService</span>.getNewsForLocation(userContext.getLocation());<br>        <span class="hljs-comment">// è¿”å›å®šåˆ¶åŒ–çš„æ–°é—»å†…å®¹</span><br>        <span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-keyword">new</span><span class="hljs-type">s</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œ<code>UserContext</code>æ˜¯ä¸€ä¸ªrequestä½œç”¨åŸŸçš„Beanï¼Œå®ƒä¸ºæ¯ä¸ªHTTPè¯·æ±‚æä¾›äº†ä¸€ä¸ªæ–°å®ä¾‹ï¼Œ</p><p>åŒ…å«äº†è¯·æ±‚ç‰¹å®šçš„ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¦‚ä½ç½®å’Œè®¾å¤‡ç±»å‹ã€‚</p><h4 id="Sessionä½œç”¨åŸŸ"><a href="#Sessionä½œç”¨åŸŸ" class="headerlink" title="Sessionä½œç”¨åŸŸ"></a>Sessionä½œç”¨åŸŸ</h4><p><strong>åœºæ™¯</strong>: åœ¨ä¸€ä¸ªåœ¨çº¿è€ƒè¯•å¹³å°ä¸Šï¼Œæ¯ä¸ªç”¨æˆ·çš„è€ƒè¯•è¿‡ç¨‹éœ€è¦è¢«è¿½è¸ªã€‚ç”¨æˆ·å¯èƒ½ä¼šåœ¨è€ƒè¯•ä¸­æ–­åè¿”å›ç»§ç»­è€ƒè¯•ï¼Œæ‰€ä»¥è€ƒè¯•çŠ¶æ€éœ€è¦åœ¨ä¼šè¯ä¸­ä¿æŒã€‚</p><p>ä»£ç é€»è¾‘</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.web.context.<span class="hljs-keyword">annotation</span>.SessionScope;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@SessionScope</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExamSession</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Exam currentExam;<br>    <span class="hljs-keyword">private</span> int currentQuestionIndex;<br><br>    <span class="hljs-comment">// è€ƒè¯•ä¼šè¯çš„æ–¹æ³•ï¼Œä¾‹å¦‚å¼€å§‹è€ƒè¯•ã€å›ç­”é—®é¢˜ç­‰</span><br>&#125;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExamController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ExamSession examSession;<br><br>    <span class="hljs-meta">@PostMapping(<span class="hljs-string">&quot;/exam/start&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> String startExam() &#123;<br>        examSession.startNewExam();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;exam_started&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(<span class="hljs-string">&quot;/exam/answer&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> String answerQuestion(Answer answer) &#123;<br>        examSession.answerQuestion(answer);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;answer_recorded&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œ<code>ExamSession</code> æ˜¯ä¸€ä¸ªsessionä½œç”¨åŸŸçš„Beanï¼Œå®ƒè®°å½•äº†ç”¨æˆ·çš„å½“å‰è€ƒè¯•çŠ¶æ€ã€‚æ¯ä¸ªç”¨æˆ·ä¼šè¯éƒ½æœ‰è‡ªå·±çš„<code>ExamSession</code>å®ä¾‹ã€‚</p><blockquote><p>Session vs Global-Session vs WebSocket</p></blockquote><ol><li><strong>Session</strong>:<ul><li><strong>ä½œç”¨åŸŸ</strong>: é™å®šåœ¨ä¸€ä¸ªç”¨æˆ·çš„HTTPä¼šè¯ä¸­ã€‚</li><li><strong>å…¸å‹ç”¨ä¾‹</strong>: åœ¨ç”¨æˆ·ç™»å½•åˆ°ç½‘ç«™åï¼Œä½ å¯èƒ½éœ€è¦è·Ÿè¸ªè¯¥ç”¨æˆ·çš„ç‰¹å®šçŠ¶æ€ï¼ˆæ¯”å¦‚è´­ç‰©è½¦ã€åå¥½è®¾ç½®ç­‰ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„ä¼šè¯ï¼Œæ¯ä¸ªä¼šè¯éƒ½æœ‰è‡ªå·±çš„Beanå®ä¾‹ã€‚</li></ul></li><li><strong>Global-Session</strong>:<ul><li><strong>ä½œç”¨åŸŸ</strong>: é™å®šåœ¨Portletç¯å¢ƒçš„å…¨å±€HTTPä¼šè¯ä¸­ã€‚åœ¨Spring 5åŠä¹‹åçš„ç‰ˆæœ¬ä¸­å·²ä¸å†ä½¿ç”¨ï¼Œå› ä¸ºSpring 5ä¸å†æ”¯æŒPortletã€‚</li><li><strong>å…¸å‹ç”¨ä¾‹</strong>: åœ¨Portletç¯å¢ƒä¸­ï¼Œå¤šä¸ªPortletå¯èƒ½éœ€è¦å…±äº«å…¨å±€ä¼šè¯æ•°æ®ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·çš„è¯­è¨€åå¥½å¯èƒ½éœ€è¦è·¨å¤šä¸ªPortletä¿æŒä¸€è‡´ã€‚</li></ul></li><li><strong>WebSocket</strong>:<ul><li><strong>ä½œç”¨åŸŸ</strong>: ç»‘å®šåˆ°WebSocketçš„ä¼šè¯ä¸­ã€‚</li><li><strong>å…¸å‹ç”¨ä¾‹</strong>: å½“ç”¨æˆ·é€šè¿‡WebSocketè¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ä¸ºæ¯ä¸ªWebSocketä¼šè¯ä¿å­˜çŠ¶æ€ï¼Œä¾‹å¦‚æ¸¸æˆä¸­çš„ç©å®¶çŠ¶æ€æˆ–èŠå¤©åº”ç”¨ä¸­çš„ç”¨æˆ·ä¼šè¯</li></ul></li></ol><h4 id="Singleton-vs-Prototype"><a href="#Singleton-vs-Prototype" class="headerlink" title="Singleton vs Prototype"></a>Singleton vs Prototype</h4><blockquote><p>Singleton vs Prototype</p></blockquote><ol><li><strong>Singleton</strong>:<ul><li><strong>æè¿°</strong>: åœ¨Spring IoCå®¹å™¨ä¸­åªåˆ›å»ºä¸€ä¸ªBeanå®ä¾‹ã€‚</li><li><strong>å…¸å‹ç”¨ä¾‹</strong>: å¤§å¤šæ•°æœåŠ¡å±‚å’Œæ•°æ®è®¿é—®å±‚çš„ç»„ä»¶éƒ½æ˜¯æ— çŠ¶æ€çš„ï¼Œå¯ä»¥è¢«åº”ç”¨ä¸­çš„æ‰€æœ‰å…¶ä»–Beanå…±äº«ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“è¿æ¥æ± ã€ä¸šåŠ¡æœåŠ¡ç­‰ã€‚</li></ul></li><li><strong>Prototype</strong>:<ul><li><strong>æè¿°</strong>: æ¯æ¬¡è¯·æ±‚æ—¶ï¼ŒSpring IoCå®¹å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Beanå®ä¾‹ã€‚</li><li><strong>å…¸å‹ç”¨ä¾‹</strong>: æ¯”å¦‚åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œä½ æƒ³è¦ä¸ºæ¯ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ›å»ºä¸€ä¸ªæ–°çš„å¤„ç†å™¨ï¼ˆFileUploadHandlerï¼‰å®ä¾‹ï¼Œä»¥é˜²ä¸åŒç”¨æˆ·ä¸Šä¼ çš„æ•°æ®ç›¸äº’å†²çªã€‚</li></ul></li></ol><p>ä¸¤ç§ä½œç”¨åŸŸçš„ä½¿ç”¨ä¸»è¦å–å†³äºBeançš„çŠ¶æ€ç®¡ç†éœ€æ±‚ã€‚</p><p>Singletonç”¨äºé‚£äº›ä¸éœ€è¦ç»´æŠ¤çŠ¶æ€ä¿¡æ¯çš„å…±äº«ç»„ä»¶ï¼Œè€ŒPrototypeé€‚ç”¨äºæ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦ä¸€ä¸ªæ–°çŠ¶æ€çš„åœºæ™¯ã€‚</p><blockquote><p>Singleton vs Prototype   å¯¹æ¯”ä¸¤è€…çš„ç”Ÿå‘½å‘¨æœŸåŒºåˆ«</p></blockquote><p>å•ä¾‹Beançš„ç”Ÿå‘½å‘¨æœŸï¼š</p><ol><li><strong>å®ä¾‹åŒ–</strong>: åªæœ‰ä¸€ä¸ªBeanå®ä¾‹è¢«åˆ›å»ºã€‚</li><li><strong>å±æ€§å¡«å……</strong>: å®¹å™¨æ³¨å…¥ä¾èµ–çš„å±æ€§ã€‚</li><li><strong>åˆå§‹åŒ–</strong>: å¦‚æœBeanå®ç°äº†<code>InitializingBean</code>æ¥å£æˆ–å®šä¹‰äº†è‡ªå®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ï¼ˆå¦‚ä½¿ç”¨<code>@PostConstruct</code>æ³¨è§£æˆ–åœ¨XMLé…ç½®ä¸­æŒ‡å®š<code>init-method</code>ï¼‰ï¼Œå°†ä¼šæ‰§è¡Œã€‚</li><li><strong>åå¤„ç†</strong>: <code>BeanPostProcessors</code>åœ¨åˆå§‹åŒ–å‰åæ‰§è¡Œã€‚</li><li><strong>ä½¿ç”¨</strong>: Beanç°åœ¨å¯ä»¥è¢«åº”ç”¨ä¸­çš„å…¶ä»–Beanä½¿ç”¨ã€‚</li><li><strong>é”€æ¯</strong>: å½“å®¹å™¨å…³é—­æ—¶ï¼Œå¦‚æœBeanå®ç°äº†<code>DisposableBean</code>æ¥å£æˆ–å®šä¹‰äº†è‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³•ï¼ˆå¦‚ä½¿ç”¨<code>@PreDestroy</code>æ³¨è§£æˆ–åœ¨XMLé…ç½®ä¸­æŒ‡å®š<code>destroy-method</code>ï¼‰ï¼Œå°†ä¼šæ‰§è¡Œã€‚</li></ol><p>å¤šä¾‹Beançš„ç”Ÿå‘½å‘¨æœŸï¼š</p><ol><li><strong>å®ä¾‹åŒ–</strong>: æ¯æ¬¡è¯·æ±‚æ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„Beanå®ä¾‹ã€‚</li><li><strong>å±æ€§å¡«å……</strong>: å®¹å™¨æ³¨å…¥ä¾èµ–çš„å±æ€§ã€‚</li><li><strong>åˆå§‹åŒ–</strong>: ä¸å•ä¾‹Beanç›¸åŒï¼Œå¦‚æœæœ‰æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå°†ä¼šæ‰§è¡Œã€‚</li><li><strong>åå¤„ç†</strong>: ä¸å•ä¾‹Beanç›¸åŒï¼Œ<code>BeanPostProcessors</code>åœ¨åˆå§‹åŒ–å‰åæ‰§è¡Œã€‚</li><li><strong>ä½¿ç”¨</strong>: Beanè¢«å®¢æˆ·ç«¯è·å–å¹¶ä½¿ç”¨ã€‚</li><li><strong>é”€æ¯</strong>: å®¹å™¨ä¸ä¼šç®¡ç†å¤šä¾‹Beançš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼›é”€æ¯ç”±å®¢æˆ·ç«¯è´Ÿè´£ã€‚</li></ol><p>åŒºåˆ«ï¼š</p><ul><li><strong>å®ä¾‹åŒ–é¢‘ç‡</strong>:<ul><li><strong>å•ä¾‹</strong>: åªåœ¨Spring IoCå®¹å™¨åˆ›å»ºæ—¶å®ä¾‹åŒ–ä¸€æ¬¡ã€‚</li><li><strong>å¤šä¾‹</strong>: æ¯æ¬¡è¯·æ±‚æ—¶å®ä¾‹åŒ–ã€‚</li></ul></li><li><strong>ä¾èµ–æ³¨å…¥æ—¶æœº</strong>:<ul><li><strong>å•ä¾‹</strong>: ä¾èµ–é¡¹åœ¨å®¹å™¨åˆ›å»ºå•ä¾‹Beanæ—¶æ³¨å…¥ã€‚</li><li><strong>å¤šä¾‹</strong>: ä¾èµ–é¡¹åœ¨æ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹æ—¶æ³¨å…¥ã€‚</li></ul></li><li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>:<ul><li><strong>å•ä¾‹</strong>: å®¹å™¨è´Ÿè´£æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬é”€æ¯ã€‚</li><li><strong>å¤šä¾‹</strong>: å®¹å™¨å¯åŠ¨åï¼Œä¸å†ç®¡ç†Beançš„ç”Ÿå‘½å‘¨æœŸï¼›Beançš„é”€æ¯ä¸ç”±Springå®¹å™¨ç®¡ç†ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨ç®¡ç†ã€‚</li></ul></li><li><strong>é”€æ¯å›è°ƒ</strong>:<ul><li><strong>å•ä¾‹</strong>: å®¹å™¨å…³é—­æ—¶ï¼Œå¯ä»¥è°ƒç”¨é”€æ¯æ–¹æ³•ã€‚</li><li><strong>å¤šä¾‹</strong>: å®¹å™¨ä¸è‡ªåŠ¨è°ƒç”¨é”€æ¯æ–¹æ³•ï¼Œå¿…é¡»ç”±è·å–Beançš„å®¢æˆ·ç«¯ä»£ç æ¥å¤„ç†ã€‚</li></ul></li></ul><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå•ä¾‹Beané€šå¸¸ç”¨äºæ— çŠ¶æ€çš„æœåŠ¡ï¼Œä¾‹å¦‚ä¸šåŠ¡é€»è¾‘ç»„ä»¶å’Œæ•°æ®è®¿é—®å¯¹è±¡ã€‚</p><p>è€Œå¤šä¾‹Beanåˆ™ç”¨äºæœ‰æ˜ç¡®çŠ¶æ€çš„æ“ä½œï¼Œè¿™äº›çŠ¶æ€ä¸èƒ½å…±äº«ç»™å…¶ä»–å®ä¾‹æˆ–çº¿ç¨‹ï¼Œä¾‹å¦‚ç”¨æˆ·çš„ä¼šè¯æˆ–ç‹¬ç«‹çš„ä»»åŠ¡å¤„ç†å™¨ã€‚</p><p>å¤šä¾‹Bean çš„é”€æ¯æ“ä½œæœ‰å…´è¶£å¯ä»¥äº†è§£ä¸€ä¸‹ï¼š <a href="https://springdoc.cn/spring/core.html#beans-factory-scopes-prototype">https://springdoc.cn/spring/core.html#beans-factory-scopes-prototype</a></p><blockquote><p>ä¸ºäº†è®©Springå®¹å™¨é‡Šæ”¾ç”± prototype scopeBean æŒæœ‰çš„èµ„æºï¼Œå¯ä»¥å°è¯•ä½¿ç”¨è‡ªå®šä¹‰Â <a href="https://springdoc.cn/spring/core.html#beans-factory-extension-bpp">Beanåå¤„ç†å™¨</a>ï¼Œå®ƒæŒæœ‰å¯¹éœ€è¦æ¸…ç†çš„Beançš„å¼•ç”¨ã€‚</p></blockquote><hr><p>å‚è€ƒ</p><ul><li><a href="https://springdoc.cn/spring/core.html#spring-core">https://springdoc.cn/spring/core.html#spring-core</a></li><li><a href="https://javaguide.cn/system-design/framework/spring/spring-knowledge-and-questions-summary.html#bean-%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%9C%89%E5%93%AA%E4%BA%9B">Springå¸¸è§é¢è¯•é¢˜æ€»ç»“ | JavaGuide(Javaé¢è¯• + å­¦ä¹ æŒ‡å—)</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå­¦ä¹ _IOC</title>
    <link href="/2023/12/14/Spring%E5%AD%A6%E4%B9%A0_IOC/"/>
    <url>/2023/12/14/Spring%E5%AD%A6%E4%B9%A0_IOC/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€IOCæ˜¯ä»€ä¹ˆ"><a href="#1ã€IOCæ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€IOCæ˜¯ä»€ä¹ˆ"></a>1ã€IOCæ˜¯ä»€ä¹ˆ</h3><p>IoC &amp; AOP ä¸æ˜¯ Spring æå‡ºæ¥çš„ï¼Œå®ƒä»¬åœ¨ Spring ä¹‹å‰å·²ç»å­˜åœ¨äº†ï¼Œåªä¸è¿‡å½“æ—¶æ›´åŠ åå‘äºç†è®ºã€‚Spring åœ¨æŠ€æœ¯å±‚æ¬¡å°†è¿™ä¸¤ä¸ªæ€æƒ³è¿›è¡Œäº†å¾ˆå¥½çš„å®ç°ã€‚</p><p>IOC ï¼ˆInversion of Control ï¼‰æŒ‡çš„æ˜¯æ§åˆ¶åè½¬&#x2F;åè½¬æ§åˆ¶ã€‚</p><blockquote><p>IOC ç†è®ºè¯´æ˜</p></blockquote><p>ä¾‹å¦‚ï¼šç°æœ‰ç±» A ä¾èµ–äºç±» B</p><ul><li>åœ¨ä¼ ç»Ÿçš„å¼€å‘æ–¹å¼ä¸­ï¼Œå¾€å¾€æ˜¯åœ¨ç±» A ä¸­æ‰‹åŠ¨é€šè¿‡ new å…³é”®å­—æ¥ new ä¸€ä¸ª B çš„å¯¹è±¡å‡ºæ¥</li><li>ä½¿ç”¨IOCæ€æƒ³çš„å¼€å‘æ–¹å¼ï¼šä¸é€šè¿‡ new å…³é”®å­—æ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ IoC å®¹å™¨(Spring æ¡†æ¶) æ¥å¸®åŠ©æˆ‘ä»¬å®ä¾‹åŒ–å¯¹è±¡ã€‚æˆ‘ä»¬éœ€è¦å“ªä¸ªå¯¹è±¡ï¼Œç›´æ¥ä» IoC å®¹å™¨é‡Œé¢è·å–ã€‚</li></ul><p>æ§åˆ¶åè½¬ä¸»è¦æŒ‡çš„æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ç»´æŠ¤äº¤ç»™IOCå®¹å™¨å»ç®¡ç†ï¼Œè€Œä¸æ˜¯ç”±ç¨‹åºå‘˜æ‰‹åŠ¨è¿›è¡Œç®¡ç†ã€‚åœ¨ä¼ ç»Ÿçš„åº”ç”¨ä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºé€šå¸¸æ˜¯ç”±ç¨‹åºå‘˜é€šè¿‡<code>new</code>å…³é”®å­—æ¥å®Œæˆçš„ï¼Œè€Œå¯¹è±¡ä¹‹é—´çš„å…³ç³»ä¹Ÿéœ€è¦ç”±ç¨‹åºå‘˜è¿›è¡Œç¡¬ç¼–ç ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312051438413.png" alt="image.png"></p><ul><li><strong>æ§åˆ¶</strong>Â ï¼šæŒ‡çš„æ˜¯å¯¹è±¡åˆ›å»ºï¼ˆå®ä¾‹åŒ–ã€ç®¡ç†ï¼‰çš„æƒåŠ›</li><li><strong>åè½¬</strong>Â ï¼šæ§åˆ¶æƒäº¤ç»™å¤–éƒ¨ç¯å¢ƒï¼ˆIoC å®¹å™¨ï¼‰</li></ul><blockquote><p>IOC å’Œ DI  çš„å…³ç³»</p></blockquote><p>å…¶å®å®ƒä»¬æ˜¯åŒä¸€ä¸ªæ¦‚å¿µçš„ä¸åŒè§’åº¦æè¿°ï¼Œç”±äºæ§åˆ¶åè½¬æ¦‚å¿µæ¯”è¾ƒå«ç³Šï¼ˆå¯èƒ½åªæ˜¯ç†è§£ä¸ºå®¹å™¨æ§åˆ¶å¯¹è±¡è¿™ä¸€ä¸ªå±‚é¢ï¼Œå¾ˆéš¾è®©äººæƒ³åˆ°è°æ¥ç»´æŠ¤å¯¹è±¡å…³ç³»ï¼‰ï¼Œæ‰€ä»¥2004å¹´å¤§å¸ˆçº§äººç‰©Martin Fowleråˆç»™å‡ºäº†ä¸€ä¸ªæ–°çš„åå­—ï¼šâ€œä¾èµ–æ³¨å…¥â€ï¼Œç›¸å¯¹IoC è€Œè¨€ï¼Œâ€œä¾èµ–æ³¨å…¥â€æ˜ç¡®æè¿°äº†â€œè¢«æ³¨å…¥å¯¹è±¡ä¾èµ–IoCå®¹å™¨é…ç½®ä¾èµ–å¯¹è±¡â€ã€‚</p><p>é€šä¿—æ¥è¯´å°±æ˜¯<strong>IoCæ˜¯è®¾è®¡æ€æƒ³ï¼ŒDIæ˜¯å®ç°æ–¹å¼</strong>ã€‚</p><div style="background-color: #3498db; color: white; padding: 10px;">    IoCæ˜¯è®¾è®¡æ€æƒ³ï¼ŒDIæ˜¯å®ç°æ–¹å¼ã€‚</div><hr><blockquote><p>IOC å®¹å™¨</p></blockquote><p>åœ¨ Spring ä¸­ï¼Œ IoC å®¹å™¨æ˜¯ Spring ç”¨æ¥å®ç° IoC çš„è½½ä½“ï¼Œ IoC å®¹å™¨å®é™…ä¸Šå°±æ˜¯ä¸ª Mapï¼ˆkeyï¼Œvalueï¼‰ï¼ŒMap ä¸­å­˜æ”¾çš„æ˜¯å„ç§å¯¹è±¡ã€‚</p><p>Spring æ—¶ä»£æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡ XML æ–‡ä»¶æ¥é…ç½® Beanï¼Œåæ¥å¼€å‘äººå‘˜è§‰å¾— XML æ–‡ä»¶æ¥é…ç½®ä¸å¤ªå¥½ï¼Œäºæ˜¯ SpringBoot æ³¨è§£é…ç½®å°±æ…¢æ…¢å¼€å§‹æµè¡Œèµ·æ¥ã€‚</p><blockquote><p>ä»€ä¹ˆæ˜¯ Spring Bean</p></blockquote><p>Bean ä»£æŒ‡çš„å°±æ˜¯é‚£äº›è¢« IoC å®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚</p><p>æˆ‘ä»¬éœ€è¦å‘Šè¯‰ IoC å®¹å™¨å¸®åŠ©æˆ‘ä»¬ç®¡ç†å“ªäº›å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥å®šä¹‰çš„ã€‚é…ç½®å…ƒæ•°æ®å¯ä»¥æ˜¯ XML æ–‡ä»¶ã€æ³¨è§£æˆ–è€… Java é…ç½®ç±»ã€‚</p><h3 id="2ã€IOC-é…ç½®çš„ä¸‰ç§æ–¹å¼"><a href="#2ã€IOC-é…ç½®çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="2ã€IOC é…ç½®çš„ä¸‰ç§æ–¹å¼"></a>2ã€IOC é…ç½®çš„ä¸‰ç§æ–¹å¼</h3><div style="border: 1px solid #999; border-radius: 5px; padding: 10px;">    ä¸»æµæ–¹å¼æ˜¯Â æ³¨è§£ + Java é…ç½®.</div><p>Springæ¡†æ¶æä¾›äº†ä¸‰ç§ä¸»è¦çš„IoCé…ç½®æ–¹å¼ï¼šXMLé…ç½®ã€æ³¨è§£é…ç½®å’ŒJavaé…ç½®ã€‚å¼€å‘è€…å¯ä»¥é€‰æ‹©å…¶ä¸­ä¸€ç§æˆ–æ··åˆä½¿ç”¨è¿™äº›æ–¹å¼ï¼Œæ¥å£°æ˜å¯¹è±¡çš„ä¾èµ–å…³ç³»å’Œé…ç½®ä¿¡æ¯ã€‚</p><p>Springå®¹å™¨ä¼šæ ¹æ®è¿™äº›é…ç½®ä¿¡æ¯ï¼Œè‡ªåŠ¨æ‰«æå¹¶åŠ è½½æ‰€éœ€çš„å¯¹è±¡ï¼Œå®ç°å¯¹è±¡çš„åˆ›å»ºã€è£…é…å’Œç®¡ç†ã€‚</p><h4 id="xml-é…ç½®"><a href="#xml-é…ç½®" class="headerlink" title="xml é…ç½®"></a>xml é…ç½®</h4><p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†beançš„ä¿¡æ¯é…ç½®.xmlæ–‡ä»¶é‡Œï¼Œé€šè¿‡SpringåŠ è½½æ–‡ä»¶ä¸ºæˆ‘ä»¬åˆ›å»ºbeanã€‚</p><p>è¿™ç§æ–¹å¼å‡ºç°å¾ˆå¤šæ—©å‰çš„SSMé¡¹ç›®ä¸­ï¼Œå°†ç¬¬ä¸‰æ–¹ç±»åº“æˆ–è€…ä¸€äº›é…ç½®å·¥å…·ç±»éƒ½ä»¥è¿™ç§æ–¹å¼è¿›è¡Œé…ç½®ï¼Œä¸»è¦åŸå› æ˜¯ç”±äºç¬¬ä¸‰æ–¹ç±»ä¸æ”¯æŒSpringæ³¨è§£ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š å¯ä»¥ä½¿ç”¨äºä»»ä½•åœºæ™¯ï¼Œç»“æ„æ¸…æ™°ï¼Œé€šä¿—æ˜“æ‡‚</li><li><strong>ç¼ºç‚¹</strong>ï¼š é…ç½®ç¹çï¼Œä¸æ˜“ç»´æŠ¤ï¼Œæ¯ç‡¥æ— å‘³ï¼Œæ‰©å±•æ€§å·®</li></ul><p><strong>ä¸¾ä¾‹</strong>ï¼š</p><ol><li>é…ç½®xx.xmlæ–‡ä»¶</li><li>å£°æ˜å‘½åç©ºé—´å’Œé…ç½®bean</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-string"><span class="hljs-tag"> http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- services --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;tech.pdai.springframework.service.UserServiceImpl&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userDao&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- more bean definitions for services go here --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="Java-é…ç½®"><a href="#Java-é…ç½®" class="headerlink" title="Java é…ç½®"></a>Java é…ç½®</h4><p>å°†ç±»çš„åˆ›å»ºäº¤ç»™æˆ‘ä»¬é…ç½®çš„JavcConfigç±»æ¥å®Œæˆï¼ŒSpringåªè´Ÿè´£ç»´æŠ¤å’Œç®¡ç†ï¼Œé‡‡ç”¨çº¯Javaåˆ›å»ºæ–¹å¼ã€‚</p><p>å…¶æœ¬è´¨ä¸Šå°±æ˜¯æŠŠåœ¨XMLä¸Šçš„é…ç½®å£°æ˜è½¬ç§»åˆ°Javaé…ç½®ç±»ä¸­</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šé€‚ç”¨äºä»»ä½•åœºæ™¯ï¼Œé…ç½®æ–¹ä¾¿ï¼Œå› ä¸ºæ˜¯çº¯Javaä»£ç ï¼Œæ‰©å±•æ€§é«˜ï¼Œååˆ†çµæ´»</li><li><strong>ç¼ºç‚¹</strong>ï¼šç”±äºæ˜¯é‡‡ç”¨Javaç±»çš„æ–¹å¼ï¼Œå£°æ˜ä¸æ˜æ˜¾ï¼Œå¦‚æœå¤§é‡é…ç½®ï¼Œå¯è¯»æ€§æ¯”è¾ƒå·®</li></ul><p><strong>ä¸¾ä¾‹</strong>ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œ æ·»åŠ @Configurationæ³¨è§£å£°æ˜ä¸ºé…ç½®ç±»</li><li>åˆ›å»ºæ–¹æ³•ï¼Œæ–¹æ³•ä¸ŠåŠ ä¸Š@beanï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºå®ä¾‹å¹¶è¿”å›ï¼Œè¯¥å®ä¾‹åˆ›å»ºåä¼šäº¤ç»™springç®¡ç†ï¼Œæ–¹æ³•åå»ºè®®ä¸å®ä¾‹åç›¸åŒï¼ˆé¦–å­—æ¯å°å†™ï¼‰ã€‚æ³¨ï¼šå®ä¾‹ç±»ä¸éœ€è¦åŠ ä»»ä½•æ³¨è§£</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> <span class="hljs-variable">pdai</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeansConfig</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> user dao</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Bean</span>(<span class="hljs-string">&quot;userDao&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">UserDaoImpl</span> <span class="hljs-title function_">userDao</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDaoImpl</span>();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> user service</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Bean</span>(<span class="hljs-string">&quot;userService&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-title function_">userService</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-title class_">UserServiceImpl</span> userService = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();<br>        userService.<span class="hljs-title function_">setUserDao</span>(<span class="hljs-title function_">userDao</span>());<br>        <span class="hljs-keyword">return</span> userService;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ³¨è§£é…ç½®"><a href="#æ³¨è§£é…ç½®" class="headerlink" title="æ³¨è§£é…ç½®"></a>æ³¨è§£é…ç½®</h4><p>é€šè¿‡åœ¨ç±»ä¸ŠåŠ æ³¨è§£çš„æ–¹å¼ï¼Œæ¥å£°æ˜ä¸€ä¸ªç±»äº¤ç»™Springç®¡ç†ï¼ŒSpringä¼šè‡ªåŠ¨æ‰«æå¸¦æœ‰@Componentï¼Œ@Controllerï¼Œ@Serviceï¼Œ@Repositoryè¿™å››ä¸ªæ³¨è§£çš„ç±»ï¼Œç„¶åå¸®æˆ‘ä»¬åˆ›å»ºå¹¶ç®¡ç†ï¼Œå‰ææ˜¯éœ€è¦å…ˆé…ç½®Springçš„æ³¨è§£æ‰«æå™¨ã€‚</p><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¼€å‘ä¾¿æ·ï¼Œé€šä¿—æ˜“æ‡‚ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå…·æœ‰å±€é™æ€§ï¼Œå¯¹äºä¸€äº›ç¬¬ä¸‰æ–¹èµ„æºï¼Œæ— æ³•æ·»åŠ æ³¨è§£ã€‚åªèƒ½é‡‡ç”¨XMLæˆ–JavaConfigçš„æ–¹å¼é…ç½®</li></ul><p><strong>ä¸¾ä¾‹</strong>ï¼š</p><ol><li>å¯¹ç±»æ·»åŠ @Componentç›¸å…³çš„æ³¨è§£ï¼Œæ¯”å¦‚@Controllerï¼Œ@Serviceï¼Œ@Repository</li><li>è®¾ç½®ComponentScançš„basePackage, æ¯”å¦‚<code>&lt;context:component-scan base-package=&#39;tech.pdai.springframework&#39;&gt;</code>, æˆ–è€…<code>@ComponentScan(&quot;tech.pdai.springframework&quot;)</code>æ³¨è§£ï¼Œæˆ–è€… <code>new AnnotationConfigApplicationContext(&quot;tech.pdai.springframework&quot;)</code>æŒ‡å®šæ‰«æçš„basePackage.<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * @author pdai</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * user dao impl.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserDaoImpl userDao;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * find user list.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * @return user list</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; findUserList() &#123;<br>        <span class="hljs-keyword">return</span> userDao.findUserList();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="3ã€ä¾èµ–æ³¨å…¥çš„ä¸‰ç§æ–¹å¼"><a href="#3ã€ä¾èµ–æ³¨å…¥çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="3ã€ä¾èµ–æ³¨å…¥çš„ä¸‰ç§æ–¹å¼"></a>3ã€ä¾èµ–æ³¨å…¥çš„ä¸‰ç§æ–¹å¼</h3><p>å‚è€ƒçœ‹ä¸€ä¸‹è¿™ä¸ªï¼š <a href="https://zhuanlan.zhihu.com/p/557140781">https://zhuanlan.zhihu.com/p/557140781</a></p><p>ä¾èµ–æ³¨å…¥æœ‰ä¸‰ç§ä¸»è¦çš„å®ç°æ–¹å¼ï¼šå±æ€§æ³¨å…¥ã€Setteræ³¨å…¥å’Œæ„é€ æ–¹æ³•æ³¨å…¥ã€‚</p><p>å±æ€§æ³¨å…¥æœ€ç®€å•ï¼Œä½†é€šç”¨æ€§è¾ƒå·®ã€‚Springå®˜æ–¹æ¨èä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥ï¼Œå› ä¸ºå®ƒæ”¯æŒæ³¨å…¥ä¸å¯å˜å¯¹è±¡ï¼Œé€šç”¨æ€§æ›´å¼ºã€‚å¯¹äºå¯å˜å¯¹è±¡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Setteræ³¨å…¥ã€‚</p><p><strong>ä»£ç ç¤ºä¾‹</strong></p><blockquote><ol><li>å±æ€§æ³¨å…¥ï¼ˆField Injectionï¼‰</li></ol></blockquote><p><strong>å±æ€§æ³¨å…¥æ˜¯æˆ‘ä»¬æœ€ç†Ÿæ‚‰ï¼Œä¹Ÿæ˜¯æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨æœ€å¤šçš„ä¸€ç§æ³¨å…¥æ–¹å¼</strong>(ç›´æ¥åœ¨ç±»çš„å­—æ®µä¸Šæ³¨å…¥ä¾èµ–)</p><p>è¿™ç§æ–¹å¼åœ¨æŸäº›åœºæ™¯ä¸‹å¾ˆæ–¹ä¾¿ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´éš¾ä»¥æµ‹è¯•å’Œéš¾ä»¥ç»´æŠ¤çš„ä»£ç ï¼Œå› ä¸ºå®ƒéšè—äº†ç±»çš„ä¾èµ–ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Component</span><br>public class MyService &#123;<br><br>    <span class="hljs-variable">@Autowired</span><br>    private DependencyClass dependency;<br><br>    <span class="hljs-comment">// ... å…¶ä»–æ–¹æ³• ...</span><br>&#125;<br><br><span class="hljs-variable">@Component</span><br>public class DependencyClass &#123;<br>    <span class="hljs-comment">// ... ç±»çš„å®ç° ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨ï¼Œç¼ºç‚¹ä¹Ÿéšä¹‹è€Œæ¥</p><ol><li>åŠŸèƒ½æ€§é—®é¢˜ï¼šæ— æ³•æ³¨å…¥ä¸€ä¸ªä¸å¯å˜çš„å¯¹è±¡ï¼ˆfinal ä¿®é¥°çš„å¯¹è±¡ï¼‰ï¼›</li><li>é€šç”¨æ€§é—®é¢˜ï¼šåªèƒ½é€‚åº”äº IoC å®¹å™¨ï¼›</li><li>è®¾è®¡åŸåˆ™é—®é¢˜ï¼šæ›´å®¹æ˜“è¿èƒŒå•ä¸€è®¾è®¡åŸåˆ™ã€‚</li></ol><blockquote><ol start="2"><li>Setteræ³¨å…¥ï¼ˆSetter Injectionï¼‰</li></ol></blockquote><p>åœ¨Setteræ³¨å…¥ä¸­ï¼ŒSpringé€šè¿‡è°ƒç”¨ç±»çš„setteræ–¹æ³•æ¥æ³¨å…¥ä¾èµ–ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> DependencyClass dependency;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> void setDependency(DependencyClass dependency) &#123;<br>        <span class="hljs-keyword">this</span>.dependency = dependency;<br>    &#125;<br><br>    <span class="hljs-comment">// ... å…¶ä»–æ–¹æ³• ...</span><br>&#125;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DependencyClass</span> &#123;<br>    <span class="hljs-comment">// ... ç±»çš„å®ç° ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>setter çš„æ–¹å¼å¯èƒ½ä¼šéº»çƒ¦ä¸€ç‚¹ï¼Œä¸è¿‡ä»–æ˜¯å®Œå…¨ç¬¦åˆå•ä¸€èŒè´£çš„è®¾è®¡åŸåˆ™ï¼Œæ¯ä¸€ä¸ª Setter åªé’ˆå¯¹ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ol><li>ä¸èƒ½æ³¨å…¥ä¸å¯å˜å¯¹è±¡ï¼ˆfinal ä¿®é¥°çš„å¯¹è±¡ï¼‰ï¼›</li><li>æ³¨å…¥çš„å¯¹è±¡å¯è¢«ä¿®æ”¹</li></ol><blockquote><ol start="3"><li>æ„é€ æ–¹æ³•æ³¨å…¥ï¼ˆConstructor Injectionï¼‰</li></ol></blockquote><p>è¿™ç§æ–¹å¼é€šè¿‡ç±»çš„æ„é€ æ–¹æ³•æ¥æ³¨å…¥ä¾èµ–ã€‚è¿™æ˜¯æœ€æ¨èçš„æ–¹å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥ç¡®ä¿æ‰€éœ€çš„ä¾èµ–é¡¹åœ¨å¯¹è±¡åˆ›å»ºæ—¶å³è¢«æä¾›ï¼Œä»è€Œä¿è¯äº†å¯¹è±¡çš„ä¸å˜æ€§å’Œä¾èµ–çš„ä¸å¯æ›´æ”¹æ€§ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>:</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DependencyClass dependency;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> MyService(DependencyClass dependency) &#123;<br>        <span class="hljs-keyword">this</span>.dependency = dependency;<br>    &#125;<br><br>    <span class="hljs-comment">// ... å…¶ä»–æ–¹æ³• ...</span><br>&#125;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DependencyClass</span> &#123;<br>    <span class="hljs-comment">// ... ç±»çš„å®ç° ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyService</code> ç±»ä¾èµ–äº <code>DependencyClass</code>ã€‚</p><p>å½“Springåˆ›å»º <code>MyService</code> çš„å®ä¾‹æ—¶ï¼Œå®ƒä¼šæŸ¥æ‰¾ <code>DependencyClass</code> çš„å®ä¾‹å¹¶é€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥å®ƒã€‚</p><p>ä»Spring 4.3å¼€å§‹ï¼Œå½“ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°æ—¶ï¼Œ<code>@Autowired</code> æ³¨è§£æ˜¯å¯é€‰çš„(å¯ä»¥çœç•¥ï¼‰ã€‚Springä¼šè‡ªåŠ¨å°†è¿™ä¸ªå”¯ä¸€çš„æ„é€ å‡½æ•°ç”¨ä½œä¾èµ–æ³¨å…¥çš„å…¥å£ã€‚</p><p>ä¸Šé¢çš„ä»£ç å¯ä»¥ç®€åŒ–ä¸ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DependencyClass dependency;<br><br>    <span class="hljs-keyword">public</span> MyService(DependencyClass dependency) &#123;<br>        <span class="hljs-keyword">this</span>.dependency = dependency;<br>    &#125;<br><br>    <span class="hljs-comment">// ... å…¶ä»–æ–¹æ³• ...</span><br>&#125;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DependencyClass</span> &#123;<br>    <span class="hljs-comment">// ... ç±»çš„å®ç° ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•ç¬¦åˆâ€œçº¦å®šä¼˜äºé…ç½®â€çš„åŸåˆ™ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„æ³¨è§£ä½¿ç”¨ã€‚</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://www.pdai.tech/md/spring/spring-x-framework-ioc.html">https://www.pdai.tech/md/spring/spring-x-framework-ioc.html</a></li><li><a href="https://javaguide.cn/system-design/framework/spring/ioc-and-aop.html">https://javaguide.cn/system-design/framework/spring/ioc-and-aop.html</a></li><li><a href="https://www.martinfowler.com/articles/injection.html">https://www.martinfowler.com/articles/injection.html</a></li><li><a href="https://www.iteye.com/blog/jinnianshilongnian-1413846">https://www.iteye.com/blog/jinnianshilongnian-1413846</a></li><li><a href="https://www.pdai.tech/md/spring/spring-x-framework-ioc.html#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F">https://www.pdai.tech/md/spring/spring-x-framework-ioc.html#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F</a></li><li><a href="https://zhuanlan.zhihu.com/p/557140781">https://zhuanlan.zhihu.com/p/557140781</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è˜‘è‡åšå®¢é¡¹ç›®_Day04</title>
    <link href="/2023/12/13/%E8%98%91%E8%8F%87%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE_Day04/"/>
    <url>/2023/12/13/%E8%98%91%E8%8F%87%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE_Day04/</url>
    
    <content type="html"><![CDATA[<p>ç»§ç»­è®²è¿°è˜‘è‡åšå®¢é‡Œé¢ä¸€äº›å†™æ³•çš„ä½¿ç”¨è¯´æ˜</p><p>è§£é‡Šä¸‹é¢è¿™æ®µä»£ç çš„ä½¿ç”¨</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@AvoidRepeatableCommit</span>  <br><span class="hljs-variable">@AuthorityVerify</span>  <br><span class="hljs-variable">@OperationLogger</span>(value = <span class="hljs-string">&quot;å¢åŠ åšå®¢&quot;</span>)  <br><span class="hljs-variable">@ApiOperation</span>(value = <span class="hljs-string">&quot;å¢åŠ åšå®¢&quot;</span>, notes = <span class="hljs-string">&quot;å¢åŠ åšå®¢&quot;</span>, response = String.class)  <br><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/add&quot;</span>)  <br>public String <span class="hljs-built_in">add</span>(<span class="hljs-variable">@Validated</span>(&#123;Insert.class&#125;) <span class="hljs-variable">@RequestBody</span> BlogVO blogVO, BindingResult result) &#123;  <br>  <br>    <span class="hljs-comment">// å‚æ•°æ ¡éªŒ  </span><br>    <span class="hljs-selector-tag">ThrowableUtils</span><span class="hljs-selector-class">.checkParamArgument</span>(result);  <br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">blogService</span><span class="hljs-selector-class">.addBlog</span>(blogVO);  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1ã€è‡ªå®šä¹‰æ³¨è§£AvoidRepeatableCommitçš„ä½¿ç”¨"><a href="#1ã€è‡ªå®šä¹‰æ³¨è§£AvoidRepeatableCommitçš„ä½¿ç”¨" class="headerlink" title="1ã€è‡ªå®šä¹‰æ³¨è§£AvoidRepeatableCommitçš„ä½¿ç”¨"></a>1ã€è‡ªå®šä¹‰æ³¨è§£<code>AvoidRepeatableCommit</code>çš„ä½¿ç”¨</h3><p><code>@AvoidRepeatableCommit</code> æ³¨è§£ç”¨äºé˜²æ­¢ç”¨æˆ·åœ¨æŒ‡å®šæ—¶é—´å†…é‡å¤æäº¤è¡¨å•æˆ–è¯·æ±‚ã€‚</p><p>ä¸Spring AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡ŒæŸäº›é¢„å¤„ç†æ“ä½œã€‚</p><h4 id="è‡ªå®šä¹‰æ³¨è§£-AvoidRepeatableCommit"><a href="#è‡ªå®šä¹‰æ³¨è§£-AvoidRepeatableCommit" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£ AvoidRepeatableCommit"></a>è‡ªå®šä¹‰æ³¨è§£ AvoidRepeatableCommit</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Target</span>(ElementType.METHOD)<br><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)<br>public <span class="hljs-variable">@interface</span> AvoidRepeatableCommit &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŒ‡å®šæ—¶é—´å†…ä¸å¯é‡å¤æäº¤,å•ä½æ¯«ç§’ï¼Œé»˜è®¤1ç§’</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">timeout</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-number">1000</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>@Target(ElementType.METHOD)</code>: è¡¨æ˜è¿™ä¸ªæ³¨è§£åªèƒ½ç”¨äºæ–¹æ³•ã€‚</li><li><code>@Retention(RetentionPolicy.RUNTIME)</code>: è¡¨æ˜è¿™ä¸ªæ³¨è§£åœ¨è¿è¡Œæ—¶ä¿ç•™ï¼Œå¯ä»¥é€šè¿‡åå°„è¯»å–ã€‚</li><li><code>timeout()</code>: æ³¨è§£çš„å±æ€§ï¼Œè¡¨ç¤ºä¸å…è®¸é‡å¤æäº¤çš„æ—¶é—´çª—å£ï¼Œé»˜è®¤ä¸º1000æ¯«ç§’ï¼ˆ1ç§’ï¼‰ã€‚</li></ul><p>ä½¿ç”¨åœºæ™¯ï¼šåœ¨Spring MVCçš„æ§åˆ¶å™¨æ–¹æ³•ä¸Šä½¿ç”¨æ­¤æ³¨è§£ï¼Œé˜²æ­¢ç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…é‡å¤æäº¤ç›¸åŒçš„è¯·æ±‚</p><h4 id="é˜²æ­¢é‡å¤æäº¤"><a href="#é˜²æ­¢é‡å¤æäº¤" class="headerlink" title="é˜²æ­¢é‡å¤æäº¤"></a>é˜²æ­¢é‡å¤æäº¤</h4><p><code>AvoidRepeatableCommitAspect</code> ç±»æ˜¯ä¸€ä¸ªSpring AOPåˆ‡é¢ï¼Œç”¨äºé˜²æ­¢æ¥å£çš„é‡å¤æäº¤ã€‚</p><p>è¿™ä¸ªåˆ‡é¢é€šè¿‡æ‹¦æˆªè¢« <code>@AvoidRepeatableCommit</code> æ³¨è§£æ ‡è®°çš„æ–¹æ³•ï¼Œå¹¶åœ¨Redisä¸­è®°å½•è¯·æ±‚çš„çŠ¶æ€æ¥å®ç°ã€‚</p><p>ä¸‹é¢æ˜¯å¯¹è¿™ä¸ªåˆ‡é¢ç±»å®ç°çš„è¯¦ç»†è§£é‡Šå’Œæ³¨é‡Šï¼š</p><blockquote><p>AvoidRepeatableCommitAspect åˆ‡é¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AvoidRepeatableCommitAspect</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisUtil redisUtil;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç¯ç»•é€šçŸ¥ï¼Œç”¨äºå¤„ç†å¸¦æœ‰ <span class="hljs-doctag">@AvoidRepeatableCommit</span> æ³¨è§£çš„æ–¹æ³•ã€‚</span><br><span class="hljs-comment">     * é˜²æ­¢åŒä¸€ä¸ªç”¨æˆ·åœ¨æŒ‡å®šæ—¶é—´å†…é‡å¤æäº¤ç›¸åŒçš„è¯·æ±‚ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> point åˆ‡ç‚¹ï¼Œæä¾›å¯¹è¿æ¥ç‚¹çš„è®¿é—®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ–¹æ³•æ‰§è¡Œçš„è¿”å›å€¼</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Throwable å¯èƒ½æŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Around(&quot;@annotation(com.moxi.mogublog.admin.annotion.AvoidRepeatableCommit.AvoidRepeatableCommit)&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint point)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> RequestHolder.getRequest();<br><br>        <span class="hljs-comment">// è·å–è¯·æ±‚è€…çš„IPåœ°å€</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> IpUtils.getIpAddr(request);<br><br>        <span class="hljs-comment">// è·å–æ³¨è§£æ ‡è®°çš„æ–¹æ³•</span><br>        <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature) point.getSignature();<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> signature.getMethod();<br><br>        <span class="hljs-comment">// è·å–ç±»åå’Œæ–¹æ³•å</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> method.getDeclaringClass().getName();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">ipKey</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;%s#%s&quot;</span>, className, methodName);<br><br>        <span class="hljs-comment">// ç”ŸæˆåŸºäºIPå’Œæ–¹æ³•çš„å”¯ä¸€æ ‡è¯†</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">hashCode</span> <span class="hljs-operator">=</span> Math.abs(ipKey.hashCode());<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;%s:%s_%d&quot;</span>, RedisConf.AVOID_REPEATABLE_COMMIT, ip, hashCode);<br>        log.info(<span class="hljs-string">&quot;ipKey=&#123;&#125;, hashCode=&#123;&#125;, key=&#123;&#125;&quot;</span>, ipKey, hashCode, key);<br><br>        <span class="hljs-type">AvoidRepeatableCommit</span> <span class="hljs-variable">avoidRepeatableCommit</span> <span class="hljs-operator">=</span> method.getAnnotation(AvoidRepeatableCommit.class);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> avoidRepeatableCommit.timeout();<br><br>        <span class="hljs-comment">// æ£€æŸ¥Redisä¸­æ˜¯å¦å·²å­˜åœ¨è¯¥è¯·æ±‚çš„æ ‡è®°</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> redisUtil.get(key);<br>        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(value)) &#123;<br>            log.info(<span class="hljs-string">&quot;è¯·å‹¿é‡å¤æäº¤è¡¨å•&quot;</span>);<br>            <span class="hljs-keyword">return</span> ResultUtil.result(SysConf.ERROR, <span class="hljs-string">&quot;è¯·å‹¿é‡å¤æäº¤è¡¨å•&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// è®¾ç½®Redisæ ‡è®°ä»¥é˜²æ­¢åœ¨timeoutæ—¶é—´å†…é‡å¤æäº¤</span><br>        redisUtil.setEx(key, StringUtils.getUUID(), timeout, TimeUnit.MILLISECONDS);<br><br>        <span class="hljs-comment">// æ‰§è¡ŒåŸæ–¹æ³•</span><br>        <span class="hljs-keyword">return</span> point.proceed();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>@Around(&quot;@annotation(...AvoidRepeatableCommit)&quot;)</code>: <ul><li>è¡¨æ˜è¿™ä¸ªåˆ‡é¢çš„æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æ ‡è®°æœ‰ <code>@AvoidRepeatableCommit</code> æ³¨è§£çš„æ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚</li></ul></li><li>åˆ‡é¢çš„å®ç°é€»è¾‘æ˜¯ï¼š<ul><li>é¦–å…ˆæ£€æŸ¥Redisä¸­æ˜¯å¦å·²ç»å­˜å‚¨äº†é’ˆå¯¹è¯¥è¯·æ±‚çš„æ ‡è®°ã€‚</li><li>å¦‚æœå­˜åœ¨ï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚åœ¨æŒ‡å®šæ—¶é—´å†…å·²ç»æäº¤è¿‡ï¼Œå› æ­¤æ‹’ç»é‡å¤æäº¤ã€‚</li><li>å¦‚æœä¸å­˜åœ¨ï¼Œå…è®¸æ‰§è¡Œæ–¹æ³•ï¼Œå¹¶åœ¨Redisä¸­è®¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œä»¥é˜²æ­¢åœ¨æŒ‡å®šæ—¶é—´å†…çš„é‡å¤æäº¤ã€‚</li></ul></li></ul><p>åœ¨è¿™ä¸ªç±»ä¸­ï¼š</p><ol><li>ä½¿ç”¨ <code>@Aspect</code> æ ‡è®°è¿™ä¸ªç±»ä¸ºä¸€ä¸ªåˆ‡é¢ï¼Œå¹¶é€šè¿‡ <code>@Component</code> æ³¨å†Œåˆ°Springå®¹å™¨ã€‚</li><li><code>@Around</code> æ³¨è§£å®šä¹‰äº†ä¸€ä¸ªç¯ç»•é€šçŸ¥ï¼Œæ‹¦æˆªæ‰€æœ‰ä½¿ç”¨ <code>@AvoidRepeatableCommit</code> æ³¨è§£çš„æ–¹æ³•ã€‚</li><li>åœ¨é€šçŸ¥æ–¹æ³•å†…ï¼Œé¦–å…ˆè·å–è¯·æ±‚è€…çš„IPåœ°å€å’Œç›®æ ‡æ–¹æ³•çš„ä¿¡æ¯ï¼Œç„¶åæ„å»ºä¸€ä¸ªå”¯ä¸€çš„Redis keyã€‚</li><li>é€šè¿‡æ£€æŸ¥Redisä¸­è¯¥keyçš„å­˜åœ¨ä¸å¦æ¥åˆ¤æ–­æ˜¯å¦å·²ç»æäº¤è¿‡ç›¸åŒçš„è¯·æ±‚ã€‚å¦‚æœå·²ç»æäº¤è¿‡ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œé˜²æ­¢é‡å¤å¤„ç†ã€‚</li><li>å¦‚æœæ²¡æœ‰æäº¤è¿‡ï¼Œå°†è¯¥keyå­˜å‚¨åˆ°Redisä¸­ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ä¸ºæ³¨è§£ä¸­æŒ‡å®šçš„è¶…æ—¶æ—¶é—´ã€‚</li><li>æœ€åï¼Œæ‰§è¡Œè¢«æ‹¦æˆªçš„æ–¹æ³•ã€‚</li></ol><p>è¿™ç§å®ç°æ–¹å¼æœ‰æ•ˆåœ°åˆ©ç”¨äº†Redisæ¥é˜²æ­¢çŸ­æ—¶é—´å†…çš„é‡å¤æäº¤ï¼Œé€‚ç”¨äºè¡¨å•æäº¤ç­‰éœ€è¦é˜²æ­¢é‡å¤æ“ä½œçš„åœºæ™¯ã€‚<br>é€šè¿‡è¿™ä¸ªåˆ‡é¢ï¼Œå¯ä»¥å¢å¼ºåº”ç”¨çš„å¥å£®æ€§ï¼Œé˜²æ­¢ç”±äºé‡å¤æäº¤å¯¼è‡´çš„æ•°æ®é—®é¢˜æˆ–èµ„æºæµªè´¹ã€‚</p><h3 id="2ã€è‡ªå®šä¹‰æ³¨è§£-OperationLogger-çš„ä½¿ç”¨"><a href="#2ã€è‡ªå®šä¹‰æ³¨è§£-OperationLogger-çš„ä½¿ç”¨" class="headerlink" title="2ã€è‡ªå®šä¹‰æ³¨è§£ OperationLogger çš„ä½¿ç”¨"></a>2ã€è‡ªå®šä¹‰æ³¨è§£ <code>OperationLogger</code> çš„ä½¿ç”¨</h3><p><code>@OperationLogger</code> æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£ï¼Œç”¨äºè®°å½•æ“ä½œæ—¥å¿—ã€‚ç»“åˆSpring AOPï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ æ—¥å¿—è®°å½•çš„é€»è¾‘ã€‚</p><h4 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="è‡ªå®šä¹‰æ³¨è§£"></a>è‡ªå®šä¹‰æ³¨è§£</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-keyword">@Target</span>(ElementType.METHOD)<br><span class="hljs-keyword">@Retention</span>(RetentionPolicy.RUNTIME)<br>public <span class="hljs-keyword">@interface</span> OperationLogger &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¸šåŠ¡åç§°ã€‚</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-built_in">value</span>() default &quot;&quot;;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¹³å°</span><br><span class="hljs-comment">     */</span><br>    PlatformEnum <span class="hljs-built_in">platform</span>() default PlatformEnum<span class="hljs-selector-class">.ADMIN</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ˜¯å¦å°†å½“å‰æ—¥å¿—è®°å½•åˆ°æ•°æ®åº“ä¸­ã€‚</span><br><span class="hljs-comment">     */</span><br>    boolean <span class="hljs-built_in">save</span>() default true;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>@Target(ElementType.METHOD)</code>: è¡¨ç¤ºè¯¥æ³¨è§£åªèƒ½ç”¨äºæ–¹æ³•ã€‚</li><li><code>@Retention(RetentionPolicy.RUNTIME)</code>: è¡¨ç¤ºè¯¥æ³¨è§£åœ¨è¿è¡Œæ—¶æœ‰æ•ˆï¼Œå¯ä»¥é€šè¿‡åå°„è·å–ã€‚</li><li><code>value()</code>: æä¾›ä¸šåŠ¡åç§°ï¼Œé»˜è®¤ä¸ºç©ºã€‚</li><li><code>platform()</code>: æŒ‡å®šæ“ä½œå‘ç”Ÿçš„å¹³å°ï¼Œé»˜è®¤ä¸º <code>ADMIN</code>ã€‚</li><li><code>save()</code>: æŒ‡ç¤ºæ˜¯å¦å°†æ—¥å¿—è®°å½•ä¿å­˜åˆ°æ•°æ®åº“ï¼Œé»˜è®¤ä¸º <code>true</code>ã€‚</li></ul><h4 id="LoggerAspect"><a href="#LoggerAspect" class="headerlink" title="LoggerAspect"></a>LoggerAspect</h4><p><code>LoggerAspect</code> æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»ï¼Œç”¨äºå¤„ç†å¸¦æœ‰ <code>@OperationLogger</code> æ³¨è§£çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerAspect</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisUtil redisUtil;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ThreadPoolTaskExecutor threadPoolTaskExecutor;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¼€å§‹æ—¶é—´ï¼Œç”¨äºè®¡ç®—æ–¹æ³•æ‰§è¡Œæ—¶é•¿</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Date startTime;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å®šä¹‰åˆ‡ç‚¹ï¼ŒåŒ¹é…å¸¦æœ‰ <span class="hljs-doctag">@OperationLogger</span> æ³¨è§£çš„æ–¹æ³•</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> operationLogger è‡ªå®šä¹‰æ³¨è§£</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Pointcut(value = &quot;@annotation(operationLogger)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pointcut</span><span class="hljs-params">(OperationLogger operationLogger)</span> &#123;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç¯ç»•é€šçŸ¥ï¼Œç”¨äºåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ æ—¥å¿—è®°å½•é€»è¾‘</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> joinPoint åˆ‡ç‚¹ä¿¡æ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> operationLogger è‡ªå®šä¹‰æ³¨è§£</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ–¹æ³•æ‰§è¡Œç»“æœ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Throwable å¯èƒ½æŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Around(value = &quot;pointcut(operationLogger)&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doAround</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, OperationLogger operationLogger)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        startTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>        <span class="hljs-comment">// æ‰§è¡ŒåŸæ–¹æ³•</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// æ—¥å¿—æ”¶é›†</span><br>            handle(joinPoint);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;æ—¥å¿—è®°å½•å‡ºé”™!&quot;</span>, e);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ—¥å¿—å¤„ç†é€»è¾‘</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> point åˆ‡ç‚¹ä¿¡æ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(ProceedingJoinPoint point)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> RequestHolder.getRequest();<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">currentMethod</span> <span class="hljs-operator">=</span> AspectUtil.INSTANCE.getMethod(point);<br>        <span class="hljs-type">OperationLogger</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> currentMethod.getAnnotation(OperationLogger.class);<br><br>        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦ä¿å­˜æ—¥å¿—</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">save</span> <span class="hljs-operator">=</span> annotation.save();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">bussinessName</span> <span class="hljs-operator">=</span> AspectUtil.INSTANCE.parseParams(point.getArgs(), annotation.value());<br>        <span class="hljs-type">String</span> <span class="hljs-variable">ua</span> <span class="hljs-operator">=</span> RequestUtil.getUa();<br>        log.info(<span class="hljs-string">&quot;&#123;&#125; | &#123;&#125; - &#123;&#125; &#123;&#125; - &#123;&#125;&quot;</span>, bussinessName, IpUtils.getIpAddr(request), RequestUtil.getMethod(), RequestUtil.getRequestUrl(), ua);<br><br>        <span class="hljs-keyword">if</span> (!save) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// è·å–å‚æ•°åç§°å’Œå€¼</span><br>        Map&lt;String, Object&gt; nameAndArgsMap = AopUtils.getFieldsName(point);<br>        <span class="hljs-type">SecurityUser</span> <span class="hljs-variable">securityUser</span> <span class="hljs-operator">=</span> (SecurityUser) SecurityContextHolder.getContext().getAuthentication().getPrincipal();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">paramsJson</span> <span class="hljs-operator">=</span> JSONObject.toJSONString(nameAndArgsMap);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> request.getMethod();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> IpUtils.getIpAddr(request);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> request.getRequestURI();<br><br>        <span class="hljs-comment">// å¼‚æ­¥å­˜å‚¨æ—¥å¿—</span><br>        threadPoolTaskExecutor.execute(<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SysLogHandle</span>(ip, type, url, securityUser, paramsJson, point.getTarget().getClass().getName(),<br>                        point.getSignature().getName(), bussinessName, startTime, redisUtil));<br>    &#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * åœ¨æ‰§è¡Œå¸¦æœ‰ <span class="hljs-doctag">@OperationLogger</span> æ³¨è§£çš„æ–¹æ³•æ—¶æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œçš„é€šçŸ¥ã€‚</span><br><span class="hljs-comment"> * ç”¨äºè®°å½•å¼‚å¸¸ä¿¡æ¯å’Œç›¸å…³æ“ä½œæ—¥å¿—ã€‚</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> joinPoint è¿æ¥ç‚¹ï¼Œæä¾›å¯¹ç›®æ ‡æ–¹æ³•çš„è®¿é—®</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> operationLogger æ“ä½œæ—¥å¿—çš„è‡ªå®šä¹‰æ³¨è§£</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> e æŠ›å‡ºçš„å¼‚å¸¸</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> Exception å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@AfterThrowing(value = &quot;pointcut(operationLogger)&quot;, throwing = &quot;e&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAfterThrowing</span><span class="hljs-params">(JoinPoint joinPoint, OperationLogger operationLogger, Throwable e)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªå¼‚å¸¸æ—¥å¿—å¯¹è±¡</span><br><span class="hljs-type">ExceptionLog</span> <span class="hljs-variable">exception</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionLog</span>();<br><span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> RequestHolder.getRequest();<br><br><span class="hljs-comment">// è·å–è¯·æ±‚IPåœ°å€</span><br><span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> IpUtils.getIpAddr(request);<br>exception.setIp(ip);<br><br><span class="hljs-comment">// è§£ææ“ä½œåç§°</span><br><span class="hljs-type">String</span> <span class="hljs-variable">operationName</span> <span class="hljs-operator">=</span> AspectUtil.INSTANCE.parseParams(joinPoint.getArgs(), operationLogger.value());<br><br><span class="hljs-comment">// å°è¯•ä»Redisä¸­è·å–IPæ¥æºä¿¡æ¯</span><br><span class="hljs-type">String</span> <span class="hljs-variable">jsonResult</span> <span class="hljs-operator">=</span> redisUtil.get(RedisConf.IP_SOURCE + Constants.SYMBOL_COLON + ip);<br><span class="hljs-keyword">if</span> (StringUtils.isEmpty(jsonResult)) &#123;<br><span class="hljs-comment">// å¦‚æœRedisä¸­æ²¡æœ‰IPæ¥æºä¿¡æ¯ï¼Œåˆ™æŸ¥è¯¢å¹¶ä¿å­˜</span><br><span class="hljs-type">String</span> <span class="hljs-variable">addresses</span> <span class="hljs-operator">=</span> IpUtils.getAddresses(SysConf.IP + SysConf.EQUAL_TO + ip, SysConf.UTF_8);<br><span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(addresses)) &#123;<br>exception.setIpSource(addresses);<br>redisUtil.setEx(RedisConf.IP_SOURCE + Constants.SYMBOL_COLON + ip, addresses, <span class="hljs-number">24</span>, TimeUnit.HOURS);<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">// å¦‚æœRedisä¸­å·²æœ‰IPæ¥æºä¿¡æ¯ï¼Œç›´æ¥ä½¿ç”¨</span><br>exception.setIpSource(jsonResult);<br>&#125;<br><br><span class="hljs-comment">// è®¾ç½®å¼‚å¸¸æ—¥å¿—çš„å…¶ä»–ä¿¡æ¯</span><br>exception.setIp(ip);<br>exception.setMethod(joinPoint.getSignature().getName());<br>exception.setExceptionJson(JSON.toJSONString(e,<br>SerializerFeature.DisableCircularReferenceDetect,<br>SerializerFeature.WriteMapNullValue));<br>exception.setExceptionMessage(e.getMessage());<br>exception.setOperation(operationName);<br>exception.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>exception.setUpdateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br><br><span class="hljs-comment">// å°†å¼‚å¸¸æ—¥å¿—ä¿å­˜åˆ°æ•°æ®åº“</span><br>exception.insert();<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="SysLogHandle-ç±»"><a href="#SysLogHandle-ç±»" class="headerlink" title="SysLogHandle ç±»"></a><code>SysLogHandle</code> ç±»</h4><p><code>SysLogHandle</code> æ˜¯ä¸€ä¸ªRunnableå®ç°ï¼Œç”¨äºå¼‚æ­¥è®°å½•æ—¥å¿—ä¿¡æ¯ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysLogHandle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AbstractRequestAwareRunnable</span> &#123;<br><br>    <span class="hljs-comment">// Rediså·¥å…·ç±»ï¼Œç”¨äºæ“ä½œRedis</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisUtil</span> redisUtil;<br><br>    <span class="hljs-comment">// è¯·æ±‚çš„å‚æ•°åˆ—è¡¨ï¼Œä»¥JSONå­—ç¬¦ä¸²æ ¼å¼ä¿å­˜</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> paramsJson;<br><br>    <span class="hljs-comment">// è¢«è°ƒç”¨çš„ç±»çš„å®Œæ•´è·¯å¾„</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> classPath;<br><br>    <span class="hljs-comment">// è¢«è°ƒç”¨çš„æ–¹æ³•åç§°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> methodName;<br><br>    <span class="hljs-comment">// æ–¹æ³•è¯·æ±‚çš„å¼€å§‹æ—¶é—´</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Date</span> startTime;<br><br>    <span class="hljs-comment">// æ“ä½œåç§°ï¼Œé€šå¸¸ä»æ³¨è§£ä¸­è·å–</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> operationName;<br><br>    <span class="hljs-comment">// è¯·æ±‚çš„IPåœ°å€</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> ip;<br><br>    <span class="hljs-comment">// è¯·æ±‚ç±»å‹ï¼ˆå¦‚GETã€POSTï¼‰</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-keyword">type</span>;<br><br>    <span class="hljs-comment">// è¯·æ±‚çš„URL</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> requestUrl;<br><br>    <span class="hljs-comment">// å½“å‰æ“ä½œçš„å®‰å…¨ç”¨æˆ·ä¿¡æ¯</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">SecurityUser</span> securityUser;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æ—¥å¿—å¤„ç†æ‰€éœ€çš„å„ç§å‚æ•°ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> ip           è¯·æ±‚çš„IPåœ°å€</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> type         è¯·æ±‚ç±»å‹ï¼ˆå¦‚GETã€POSTï¼‰</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> requestUrl   è¯·æ±‚çš„URL</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> securityUser å½“å‰æ“ä½œçš„å®‰å…¨ç”¨æˆ·</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> paramsJson   è¯·æ±‚çš„å‚æ•°åˆ—è¡¨ï¼ˆJSONæ ¼å¼ï¼‰</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> classPath    è¢«è°ƒç”¨çš„ç±»çš„å®Œæ•´è·¯å¾„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> methodName   è¢«è°ƒç”¨çš„æ–¹æ³•åç§°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> operationName æ“ä½œåç§°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> startTime    æ–¹æ³•è¯·æ±‚çš„å¼€å§‹æ—¶é—´</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> redisUtil    Rediså·¥å…·ç±»</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">SysLogHandle</span>(<span class="hljs-title class_">String</span> ip, <span class="hljs-title class_">String</span> <span class="hljs-keyword">type</span>, <span class="hljs-title class_">String</span> requestUrl, <span class="hljs-title class_">SecurityUser</span> securityUser,<br>                        <span class="hljs-title class_">String</span> paramsJson, <span class="hljs-title class_">String</span> classPath,<br>                        <span class="hljs-title class_">String</span> methodName, <span class="hljs-title class_">String</span> operationName,<br>                        <span class="hljs-title class_">Date</span> startTime, <span class="hljs-title class_">RedisUtil</span> redisUtil) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ip</span> = ip;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requestUrl</span> = requestUrl;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">securityUser</span> = securityUser;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">paramsJson</span> = paramsJson;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">classPath</span> = classPath;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">methodName</span> = methodName;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">operationName</span> = operationName;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">startTime</span> = startTime;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">redisUtil</span> = redisUtil;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰§è¡Œæ—¥å¿—è®°å½•çš„é€»è¾‘ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onRun</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-title class_">SysLog</span> sysLog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SysLog</span>();<br><br>        <span class="hljs-comment">// ä»Redisä¸­è·å–IPæ¥æºä¿¡æ¯</span><br>        <span class="hljs-title class_">String</span> jsonResult = redisUtil.<span class="hljs-title function_">get</span>(<span class="hljs-title class_">RedisConf</span>.<span class="hljs-property">IP_SOURCE</span> + <span class="hljs-title class_">Constants</span>.<span class="hljs-property">SYMBOL_COLON</span> + ip);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isEmpty</span>(jsonResult)) &#123;<br>            <span class="hljs-title class_">String</span> addresses = <span class="hljs-title class_">IpUtils</span>.<span class="hljs-title function_">getAddresses</span>(<span class="hljs-title class_">SysConf</span>.<span class="hljs-property">IP</span> + <span class="hljs-title class_">SysConf</span>.<span class="hljs-property">EQUAL_TO</span> + ip, <span class="hljs-title class_">SysConf</span>.<span class="hljs-property">UTF_8</span>);<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">isNotEmpty</span>(addresses)) &#123;<br>                sysLog.<span class="hljs-title function_">setIpSource</span>(addresses);<br>                redisUtil.<span class="hljs-title function_">setEx</span>(<span class="hljs-title class_">RedisConf</span>.<span class="hljs-property">IP_SOURCE</span> + <span class="hljs-title class_">Constants</span>.<span class="hljs-property">SYMBOL_COLON</span> + ip, addresses, <span class="hljs-number">24</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">HOURS</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            sysLog.<span class="hljs-title function_">setIpSource</span>(jsonResult);<br>        &#125;<br><br>        <span class="hljs-comment">// è®¾ç½®æ—¥å¿—çš„å…¶ä»–å±æ€§</span><br>        sysLog.<span class="hljs-title function_">setIp</span>(ip);<br>        sysLog.<span class="hljs-title function_">setClassPath</span>(classPath);<br>        sysLog.<span class="hljs-title function_">setMethod</span>(methodName);<br>        sysLog.<span class="hljs-title function_">setType</span>(<span class="hljs-keyword">type</span>);<br>        sysLog.<span class="hljs-title function_">setUrl</span>(requestUrl);<br>        sysLog.<span class="hljs-title function_">setOperation</span>(operationName);<br>        sysLog.<span class="hljs-title function_">setCreateTime</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        sysLog.<span class="hljs-title function_">setUpdateTime</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        sysLog.<span class="hljs-title function_">setUserName</span>(securityUser.<span class="hljs-title function_">getUsername</span>());<br>        sysLog.<span class="hljs-title function_">setAdminUid</span>(securityUser.<span class="hljs-title function_">getUid</span>());<br>        sysLog.<span class="hljs-title function_">setParams</span>(paramsJson);<br><br>        <span class="hljs-comment">// è®¡ç®—å¹¶è®¾ç½®è¯·æ±‚è€—æ—¶</span><br>        <span class="hljs-title class_">Date</span> endTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>        <span class="hljs-title class_">Long</span> spendTime = <span class="hljs-title class_">DateUtil</span>.<span class="hljs-title function_">between</span>(startTime, endTime, <span class="hljs-title class_">DateUnit</span>.<span class="hljs-property">MS</span>);<br>        sysLog.<span class="hljs-title function_">setSpendTime</span>(spendTime);<br><br>        <span class="hljs-comment">// å°†æ—¥å¿—ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“</span><br>        sysLog.<span class="hljs-title function_">insert</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>SysLogHandle</code> ç»§æ‰¿è‡ª <code>AbstractRequestAwareRunnable</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªRunnableå®ç°ï¼Œç”¨äºå¼‚æ­¥æ‰§è¡Œæ—¥å¿—è®°å½•ä»»åŠ¡ã€‚</li><li>æ„é€ å‡½æ•°æ¥æ”¶æ‰€æœ‰å¿…è¦çš„å‚æ•°ï¼ŒåŒ…æ‹¬è¯·æ±‚ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯å’Œæ–¹æ³•ä¿¡æ¯ã€‚</li><li><code>onRun</code> æ–¹æ³•æ˜¯æ—¥å¿—è®°å½•é€»è¾‘çš„å®ç°ã€‚å®ƒé¦–å…ˆä»Redisä¸­è·å–IPæ¥æºä¿¡æ¯ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª <code>SysLog</code> å¯¹è±¡å¹¶è®¾ç½®å„ç§å±æ€§ï¼ŒåŒ…æ‹¬è¯·æ±‚ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ã€æ“ä½œåç§°ã€å‚æ•°ç­‰ã€‚</li><li>æœ€åï¼Œè®¡ç®—è¯·æ±‚è€—æ—¶å¹¶å°†æ—¥å¿—ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“ã€‚</li></ul><p>è¿™ä¸ªç±»çš„ä¸»è¦ä½œç”¨æ˜¯å¼‚æ­¥è®°å½•æ¯æ¬¡è¯·æ±‚çš„è¯¦ç»†æ—¥å¿—ï¼ŒåŒ…æ‹¬è¯·æ±‚å‚æ•°ã€æ‰§è¡Œæ—¶é—´ç­‰ï¼Œ</p><p>é€šè¿‡å¼‚æ­¥å¤„ç†ï¼Œå®ƒè¿˜æœ‰åŠ©äºå‡å°‘æ—¥å¿—è®°å½•å¯¹åº”ç”¨æ€§èƒ½çš„å½±å“ã€‚</p><h4 id="å¼‚æ­¥æ—¥å¿—è®°å½•çš„åŠŸèƒ½"><a href="#å¼‚æ­¥æ—¥å¿—è®°å½•çš„åŠŸèƒ½" class="headerlink" title="å¼‚æ­¥æ—¥å¿—è®°å½•çš„åŠŸèƒ½"></a>å¼‚æ­¥æ—¥å¿—è®°å½•çš„åŠŸèƒ½</h4><p>åœ¨åˆ‡é¢çš„æ—¶å€™ï¼Œhandle æ–¹æ³•ä¿å­˜æ—¥å¿—çš„æ“ä½œæ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œè¿™é‡Œå•ç‹¬æ‹¿å‡ºæ¥åˆ†æä¸€ä¸‹ã€‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">// å¼‚æ­¥å­˜å‚¨æ—¥å¿—</span><br><span class="hljs-selector-tag">threadPoolTaskExecutor</span><span class="hljs-selector-class">.execute</span>(<br>        new <span class="hljs-built_in">SysLogHandle</span>(ip, type, url, securityUser,<br>                        paramsJson, point.<span class="hljs-built_in">getTarget</span>().<span class="hljs-built_in">getClass</span>().<span class="hljs-built_in">getName</span>(),<br>                        point.<span class="hljs-built_in">getSignature</span>().<span class="hljs-built_in">getName</span>(), bussinessName,<br>                        startTime, redisUtil));<br><br></code></pre></td></tr></table></figure><ol><li><strong>ä½¿ç”¨çº¿ç¨‹æ± </strong>:<ul><li><code>threadPoolTaskExecutor.execute(...)</code>: è¿™éƒ¨åˆ†ä»£ç åˆ©ç”¨Springæ¡†æ¶ä¸­çš„ <code>ThreadPoolTaskExecutor</code> æ¥æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚<code>ThreadPoolTaskExecutor</code> æ˜¯ä¸€ä¸ªåŸºäºçº¿ç¨‹æ± çš„TaskExecutorå®ç°ï¼Œå…è®¸å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ã€‚</li></ul></li><li><strong>åˆ›å»ºæ—¥å¿—å¤„ç†ä»»åŠ¡</strong>:<ul><li><code>new SysLogHandle(...)</code>: è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª <code>SysLogHandle</code> å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®ç°äº† <code>Runnable</code> æ¥å£çš„ç±»ï¼Œç”¨äºå¤„ç†æ—¥å¿—è®°å½•çš„å…·ä½“é€»è¾‘ã€‚</li></ul></li><li><strong>ä¼ é€’å‚æ•°ç»™æ—¥å¿—å¤„ç†ä»»åŠ¡</strong>:<ul><li>å‘ <code>SysLogHandle</code> æ„é€ å™¨ä¼ é€’äº†å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬è¯·æ±‚çš„IPåœ°å€ (<code>ip</code>)ã€è¯·æ±‚ç±»å‹ (<code>type</code>)ã€è¯·æ±‚URL (<code>url</code>)ã€å½“å‰å®‰å…¨ç”¨æˆ· (<code>securityUser</code>)ã€è¯·æ±‚å‚æ•°çš„JSONå­—ç¬¦ä¸² (<code>paramsJson</code>)ã€è¢«è°ƒç”¨çš„ç±»åå’Œæ–¹æ³•åï¼ˆé€šè¿‡ <code>point.getTarget().getClass().getName()</code> å’Œ <code>point.getSignature().getName()</code> è·å–ï¼‰ã€ä¸šåŠ¡åç§° (<code>bussinessName</code>)ã€æ–¹æ³•å¼€å§‹æ‰§è¡Œçš„æ—¶é—´ (<code>startTime</code>)ï¼Œä»¥åŠRediså·¥å…·ç±» (<code>redisUtil</code>)ã€‚</li></ul></li><li><strong>æ‰§è¡Œä»»åŠ¡</strong>:<ul><li><code>threadPoolTaskExecutor.execute(...)</code>: è¿™ä¸ªæ–¹æ³•å°† <code>SysLogHandle</code> çš„å®ä¾‹æäº¤åˆ°çº¿ç¨‹æ± è¿›è¡Œå¼‚æ­¥æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹çš„æ‰§è¡Œã€‚è¿™æ„å‘³ç€åŸæ–¹æ³•ï¼ˆè¢« <code>@OperationLogger</code> æ³¨è§£çš„æ–¹æ³•ï¼‰çš„æ‰§è¡Œå’Œæ—¥å¿—çš„è®°å½•æ˜¯å¹¶å‘è¿›è¡Œçš„ã€‚</li></ul></li></ol><blockquote><p>å®é™…åº”ç”¨</p></blockquote><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ç§å¼‚æ­¥æ—¥å¿—è®°å½•æ–¹æ³•éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨é«˜æµé‡çš„Webåº”ç”¨ä¸­ã€‚å®ƒå…è®¸åº”ç”¨å¿«é€Ÿå“åº”ç”¨æˆ·è¯·æ±‚ï¼ŒåŒæ—¶å°†è€—æ—¶çš„æ—¥å¿—è®°å½•æ“ä½œæ”¾åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä»è€Œä¸ä¼šæ˜¾è‘—å½±å“ç”¨æˆ·ä½“éªŒå’Œåº”ç”¨æ€§èƒ½ã€‚</p><p>é€šè¿‡å°†æ—¥å¿—è®°å½•é€»è¾‘ä»ä¸»æ‰§è¡Œè·¯å¾„ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¯ä»¥å‡å°‘å¯¹ä¸»ä¸šåŠ¡é€»è¾‘çš„å¹²æ‰°ï¼ŒåŒæ—¶ç¡®ä¿äº†é‡è¦çš„æ“ä½œæ—¥å¿—è¢«æ­£ç¡®è®°å½•å’Œå­˜å‚¨ã€‚</p><h4 id="å·¥å…·ç±»AspectUtil"><a href="#å·¥å…·ç±»AspectUtil" class="headerlink" title="å·¥å…·ç±»AspectUtil"></a>å·¥å…·ç±»AspectUtil</h4><p>å¯¹äºä¸Šé¢ä½¿ç”¨åˆ°çš„å·¥å…·ç±» AspectUtil è¿›è¡Œè®°å½•è¯´æ˜</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-variable">public</span> <span class="hljs-variable">enum</span> <span class="hljs-title class_">AspectUtil</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å•ä¾‹å®ä¾‹ï¼Œæšä¸¾ç±»å‹ä¿è¯å…¨å±€å”¯ä¸€ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">INSTANCE</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ä»¥ç±»è·¯å¾„ä¸ºå‰ç¼€çš„é”®ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> point å½“å‰åˆ‡é¢æ‰§è¡Œçš„æ–¹æ³•çš„è¿æ¥ç‚¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> prefix å‰ç¼€å­—ç¬¦ä¸²</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ä»¥ç±»è·¯å¾„ä¸ºå‰ç¼€çš„é”®å­—ç¬¦ä¸²</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getKey</span>(<span class="hljs-params">JoinPoint</span> <span class="hljs-params">point</span>, <span class="hljs-params">String</span> <span class="hljs-params">prefix</span>) &#123;<br>        <span class="hljs-title class_">String</span> <span class="hljs-variable">keyPrefix</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-operator">!</span><span class="hljs-title class_">StringUtils</span>.<span class="hljs-property">isEmpty</span>(<span class="hljs-variable">prefix</span>)) &#123;<br>            <span class="hljs-variable">keyPrefix</span> <span class="hljs-operator">+</span><span class="hljs-operator">=</span> <span class="hljs-variable">prefix</span>;<br>        &#125;<br>        <span class="hljs-variable">keyPrefix</span> <span class="hljs-operator">+</span><span class="hljs-operator">=</span> <span class="hljs-title function_">getClassName</span>(<span class="hljs-variable">point</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">keyPrefix</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–å½“å‰åˆ‡é¢æ‰§è¡Œçš„æ–¹æ³•æ‰€åœ¨çš„ç±»çš„åç§°ï¼Œæ›¿æ¢æ‰€æœ‰çš„ç‚¹ä¸ºä¸‹åˆ’çº¿ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> point å½“å‰åˆ‡é¢æ‰§è¡Œçš„æ–¹æ³•çš„è¿æ¥ç‚¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å¤„ç†åçš„ç±»åå­—ç¬¦ä¸²</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getClassName</span>(<span class="hljs-params">JoinPoint</span> <span class="hljs-params">point</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">point</span>.<span class="hljs-property">getTarget</span>().<span class="hljs-property">getClass</span>().<span class="hljs-property">getName</span>().<span class="hljs-property">replaceAll</span>(<span class="hljs-string">&quot;<span class="hljs-char escape_">\\</span>.&quot;</span>, <span class="hljs-string">&quot;_&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–å½“å‰åˆ‡é¢æ‰§è¡Œçš„æ–¹æ³•çš„Methodå¯¹è±¡ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> point å½“å‰åˆ‡é¢æ‰§è¡Œçš„æ–¹æ³•çš„è¿æ¥ç‚¹</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å½“å‰æ‰§è¡Œæ–¹æ³•çš„Methodå¯¹è±¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> NoSuchMethodException å¦‚æœæ— æ³•æ‰¾åˆ°ç›¸åº”çš„æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">Method</span> <span class="hljs-title function_">getMethod</span>(<span class="hljs-title class_">JoinPoint</span> <span class="hljs-variable">point</span>) <span class="hljs-variable">throws</span> <span class="hljs-title class_">NoSuchMethodException</span> &#123;<br>        <span class="hljs-title class_">Signature</span> <span class="hljs-variable">sig</span> <span class="hljs-operator">=</span> <span class="hljs-variable">point</span>.<span class="hljs-property">getSignature</span>();<br>        <span class="hljs-title class_">MethodSignature</span> <span class="hljs-variable">msig</span> <span class="hljs-operator">=</span> (<span class="hljs-title class_">MethodSignature</span>) <span class="hljs-variable">sig</span>;<br>        <span class="hljs-title class_">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-variable">point</span>.<span class="hljs-property">getTarget</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">target</span>.<span class="hljs-property">getClass</span>().<span class="hljs-property">getMethod</span>(<span class="hljs-variable">msig</span>.<span class="hljs-property">getName</span>(), <span class="hljs-variable">msig</span>.<span class="hljs-property">getParameterTypes</span>());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è§£æä¸šåŠ¡åç§°ä¸­çš„å ä½ç¬¦ï¼Œå¹¶ç”¨æ–¹æ³•å‚æ•°æ›¿æ¢ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> params æ–¹æ³•å‚æ•°æ•°ç»„</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> bussinessName å¸¦å ä½ç¬¦çš„ä¸šåŠ¡åç§°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è§£æåçš„ä¸šåŠ¡åç§°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">parseParams</span>(<span class="hljs-params">Object</span>[] <span class="hljs-params">params</span>, <span class="hljs-params">String</span> <span class="hljs-params">bussinessName</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">bussinessName</span>.<span class="hljs-property">contains</span>(<span class="hljs-string">&quot;&#123;&quot;</span>) <span class="hljs-operator">&amp;&amp;</span> <span class="hljs-variable">bussinessName</span>.<span class="hljs-property">contains</span>(<span class="hljs-string">&quot;&#125;&quot;</span>)) &#123;<br>            <span class="hljs-title class_">List</span><span class="hljs-operator">&lt;</span><span class="hljs-title class_">String</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">RegexUtils</span>.<span class="hljs-property">match</span>(<span class="hljs-variable">bussinessName</span>, <span class="hljs-string">&quot;(?&lt;=<span class="hljs-char escape_">\\</span>&#123;)(<span class="hljs-char escape_">\\</span>d+)&quot;</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> <span class="hljs-variable">s</span> : <span class="hljs-variable">result</span>) &#123;<br>                int index <span class="hljs-operator">=</span> <span class="hljs-title class_">Integer</span>.<span class="hljs-property">parseInt</span>(<span class="hljs-variable">s</span>);<br>                <span class="hljs-variable">bussinessName</span> <span class="hljs-operator">=</span> <span class="hljs-variable">bussinessName</span>.<span class="hljs-property">replaceAll</span>(<span class="hljs-string">&quot;<span class="hljs-char escape_">\\</span>&#123;&quot;</span> <span class="hljs-operator">+</span> index <span class="hljs-operator">+</span> <span class="hljs-string">&quot;&#125;&quot;</span>, <span class="hljs-variable">JSON</span>.<span class="hljs-property">toJSONString</span>(<span class="hljs-variable">params</span>[index <span class="hljs-operator">-</span> <span class="hljs-number">1</span>]));<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">bussinessName</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>AspectUtil</code> æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œæä¾›äº†ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„å®ä¾‹ <code>INSTANCE</code>ã€‚</li><li><code>getKey</code> æ–¹æ³•æ ¹æ®è¿æ¥ç‚¹ (<code>JoinPoint</code>) å’Œç»™å®šçš„å‰ç¼€ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²é”®ã€‚è¯¥é”®é€šå¸¸ç”¨äºè¯†åˆ«ç‰¹å®šçš„æ–¹æ³•æˆ–ç±»ã€‚</li><li><code>getClassName</code> æ–¹æ³•è·å–è¿æ¥ç‚¹æŒ‡å‘çš„ç›®æ ‡ç±»çš„åç§°ï¼Œå¹¶å°†å…¶ä¸­çš„ç‚¹æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ã€‚è¿™åœ¨éœ€è¦åŸºäºç±»åç”Ÿæˆå”¯ä¸€æ ‡è¯†æ—¶å¾ˆæœ‰ç”¨ã€‚</li><li><code>getMethod</code> æ–¹æ³•è¿”å›è¿æ¥ç‚¹æŒ‡å‘çš„å…·ä½“æ–¹æ³•çš„ <code>Method</code> å¯¹è±¡ï¼Œç”¨äºè¿›ä¸€æ­¥çš„åå°„æ“ä½œã€‚</li><li><code>parseParams</code> æ–¹æ³•è§£æä¸šåŠ¡åç§°å­—ç¬¦ä¸²ä¸­çš„å ä½ç¬¦ï¼Œå¹¶ç”¨æ–¹æ³•çš„å®é™…å‚æ•°æ›¿æ¢è¿™äº›å ä½ç¬¦ã€‚è¿™å¯¹äºç”ŸæˆåŠ¨æ€çš„æ—¥å¿—æ¶ˆæ¯æˆ–é”™è¯¯æ¶ˆæ¯éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“æ¶ˆæ¯å†…å®¹ä¾èµ–äºæ–¹æ³•çš„è¾“å…¥å‚æ•°æ—¶ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è˜‘è‡åšå®¢é¡¹ç›®_Day03</title>
    <link href="/2023/12/12/%E8%98%91%E8%8F%87%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE_Day03/"/>
    <url>/2023/12/12/%E8%98%91%E8%8F%87%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE_Day03/</url>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œè®²è¿°è˜‘è‡åšå®¢é‡Œé¢ä¸€äº›å†™æ³•çš„ä½¿ç”¨è¯´æ˜</p><p>ä¸‹é¢çš„ç« èŠ‚éƒ½æ˜¯ä¸ºäº†è§£é‡Šä¸‹é¢è¿™æ®µä»£ç çš„ä½¿ç”¨</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@AuthorityVerify</span>  <br><span class="hljs-variable">@ApiOperation</span>(value = <span class="hljs-string">&quot;è·å–åšå®¢åˆ—è¡¨&quot;</span>, notes = <span class="hljs-string">&quot;è·å–åšå®¢åˆ—è¡¨&quot;</span>, response = String.class)  <br><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/getList&quot;</span>)  <br>public String <span class="hljs-built_in">getList</span>(<span class="hljs-variable">@Validated</span>(&#123;GetList.class&#125;) <span class="hljs-variable">@RequestBody</span> BlogVO blogVO, BindingResult result) &#123;  <br>  <br>    <span class="hljs-selector-tag">ThrowableUtils</span><span class="hljs-selector-class">.checkParamArgument</span>(result);  <br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResultUtil</span><span class="hljs-selector-class">.successWithData</span>(blogService.<span class="hljs-built_in">getPageList</span>(blogVO));  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1ã€è‡ªå®šä¹‰æ³¨è§£-AuthorityVerify-çš„ä½¿ç”¨"><a href="#1ã€è‡ªå®šä¹‰æ³¨è§£-AuthorityVerify-çš„ä½¿ç”¨" class="headerlink" title="1ã€è‡ªå®šä¹‰æ³¨è§£ AuthorityVerify çš„ä½¿ç”¨"></a>1ã€è‡ªå®šä¹‰æ³¨è§£ AuthorityVerify çš„ä½¿ç”¨</h3><h4 id="æ³¨è§£å®šä¹‰"><a href="#æ³¨è§£å®šä¹‰" class="headerlink" title="æ³¨è§£å®šä¹‰"></a>æ³¨è§£å®šä¹‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AuthorityVerify &#123;<br>    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</code>ï¼šè¿™è¡¨æ˜è¿™ä¸ªæ³¨è§£å¯ä»¥åº”ç”¨äºæ–¹æ³•å’Œç±»ã€‚å¦‚æœæ”¾åœ¨ç±»ä¸Šï¼Œé€šå¸¸æ„å‘³ç€ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½åº”ç”¨è¿™ä¸ªæ³¨è§£ï¼›å¦‚æœæ”¾åœ¨æ–¹æ³•ä¸Šï¼Œåˆ™åªé’ˆå¯¹è¯¥æ–¹æ³•ã€‚</li><li><code>@Retention(RetentionPolicy.RUNTIME)</code>ï¼šè¿™æŒ‡å®šäº†æ³¨è§£çš„ä¿ç•™ç­–ç•¥æ˜¯åœ¨è¿è¡Œæ—¶ã€‚è¿™æ„å‘³ç€è¿™ä¸ªæ³¨è§£ä¸ä»…è¢«ä¿å­˜åœ¨classæ–‡ä»¶ä¸­ï¼Œè¿˜å¯ä»¥é€šè¿‡åå°„åœ¨è¿è¡Œæ—¶è¢«è¯»å–ã€‚</li><li><code>String value() default &quot;&quot;</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„æ³¨è§£å…ƒç´ ï¼Œå…è®¸åœ¨ä½¿ç”¨æ³¨è§£æ—¶è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚</li></ul><h4 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h4><p>è¿™ä¸ªæ³¨è§£å¯ä»¥åº”ç”¨äºç±»æˆ–æ–¹æ³•æ¥å®ç°æƒé™éªŒè¯ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@AuthorityVerify</span><br>public class SomeController &#123;<br><br>    <span class="hljs-variable">@AuthorityVerify</span>(<span class="hljs-string">&quot;admin&quot;</span>)<br>    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/someSecureMethod&quot;</span>)<br>    public String <span class="hljs-built_in">someSecureMethod</span>() &#123;<br>        <span class="hljs-comment">// æ–¹æ³•å®ç°</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>@AuthorityVerify</code> åº”ç”¨äºä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•ã€‚<br>ä½ å¯ä»¥å°†å…¶æ”¾åœ¨ä»»ä½•Spring Controllerçš„æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•éœ€è¦è¿›è¡Œæƒé™éªŒè¯ã€‚<br>æ³¨è§£ä¸­çš„ <code>&quot;admin&quot;</code> å­—ç¬¦ä¸²å¯ä»¥ç”¨æ¥æŒ‡å®šéœ€è¦å“ªç§æƒé™æ‰èƒ½è®¿é—®è¯¥æ–¹æ³•ã€‚</p><p>è¦è®©è¿™ä¸ªæ³¨è§£çœŸæ­£èµ·ä½œç”¨ï¼Œè¿˜éœ€è¦ç¼–å†™é¢å¤–çš„ä»£ç æ¥å¤„ç†è¿™ä¸ªæ³¨è§£ã€‚é€šå¸¸æ˜¯é€šè¿‡Springçš„AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰åŠŸèƒ½æ¥å®ç°çš„ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåˆ‡é¢æ¥æ‹¦æˆªå¸¦æœ‰ <code>@AuthorityVerify</code> æ³¨è§£çš„æ–¹æ³•è°ƒç”¨ï¼Œç„¶åæ‰§è¡Œæƒé™éªŒè¯é€»è¾‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthorityAspect</span> &#123;<br><br>    <span class="hljs-meta">@Around(&quot;@annotation(authorityVerify)&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint point, AuthorityVerify authorityVerify)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-comment">// è·å–æ³¨è§£ä¸­çš„å€¼</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> authorityVerify.value();<br><br>        <span class="hljs-comment">// è¿™é‡Œå®ç°æƒé™éªŒè¯é€»è¾‘</span><br>        <span class="hljs-comment">// ...</span><br><br>        <span class="hljs-comment">// ç»§ç»­æ‰§è¡ŒåŸæ–¹æ³•</span><br>        <span class="hljs-keyword">return</span> point.proceed();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè˜‘è‡åšå®¢é¡¹ç›®ä¹Ÿæ˜¯è¿™æ ·ä½¿ç”¨çš„ã€‚</p><p>ä¸Šé¢çš„ç¤ºä¾‹æ˜¯é€šè¿‡æ³¨è§£çš„å€¼ï¼Œç„¶ååœ¨ç¯ç»•é€šçŸ¥é‡Œé¢çš„æ–¹æ³•ï¼Œæ ¹æ®è·å–å€¼æ¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</p><p>è˜‘è‡åšå®¢çš„è¿™ä¸ªæ–¹æ³•æœ‰æ‰€ä¸åŒçš„æ˜¯ï¼Œä»–æ˜¯é€šè¿‡åˆ¤æ–­æ·»åŠ è¯¥æ³¨è§£çš„æ–¹æ³•ï¼Œè·å–è®¿é—®è¯·æ±‚è·¯å¾„ï¼Œè·å–ç”¨æˆ·ï¼Œåˆ¤å®šè¯¥ç”¨æˆ·ä¸‹æ˜¯å¦æœ‰è¯¥è®¿é—®è·¯å¾„çš„æƒé™ã€‚</p><p>getList æ–¹æ³•</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@AuthorityVerify</span>  <br><span class="hljs-variable">@ApiOperation</span>(value = <span class="hljs-string">&quot;è·å–åšå®¢åˆ—è¡¨&quot;</span>, notes = <span class="hljs-string">&quot;è·å–åšå®¢åˆ—è¡¨&quot;</span>, response = String.class)  <br><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/getList&quot;</span>)  <br>public String <span class="hljs-built_in">getList</span>(<span class="hljs-variable">@Validated</span>(&#123;GetList.class&#125;) <span class="hljs-variable">@RequestBody</span> BlogVO blogVO, BindingResult result) &#123;  <br>  <br>    <span class="hljs-selector-tag">ThrowableUtils</span><span class="hljs-selector-class">.checkParamArgument</span>(result);  <br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResultUtil</span><span class="hljs-selector-class">.successWithData</span>(blogService.<span class="hljs-built_in">getPageList</span>(blogVO));  <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="AuthorityVerifyAspect"><a href="#AuthorityVerifyAspect" class="headerlink" title="AuthorityVerifyAspect"></a><code>AuthorityVerifyAspect</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æƒé™æ ¡éªŒ åˆ‡é¢å®ç°</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> é™Œæºª</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@create</span>: 2020-03-06-19:05</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthorityVerifyAspect</span> &#123;<br><br>    <span class="hljs-comment">// è‡ªåŠ¨æ³¨å…¥æ‰€éœ€çš„æœåŠ¡å’Œå·¥å…·ç±»</span><br>    <span class="hljs-meta">@Autowired</span><br>    CategoryMenuService categoryMenuService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    RoleService roleService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    AdminService adminService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    RedisUtil redisUtil;<br><br>    <span class="hljs-comment">// å®šä¹‰åˆ‡ç‚¹ï¼ŒæŒ‡å‘ä½¿ç”¨AuthorityVerifyæ³¨è§£çš„æ–¹æ³•</span><br>    <span class="hljs-meta">@Pointcut(value = &quot;@annotation(authorityVerify)&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pointcut</span><span class="hljs-params">(AuthorityVerify authorityVerify)</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">// ç¯ç»•é€šçŸ¥ï¼Œç”¨äºåœ¨æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ é¢å¤–çš„å¤„ç†</span><br>    <span class="hljs-meta">@Around(value = &quot;pointcut(authorityVerify)&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doAround</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, AuthorityVerify authorityVerify)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br><br>        <span class="hljs-comment">// è·å–å½“å‰HTTPè¯·æ±‚çš„å±æ€§</span><br>        <span class="hljs-type">ServletRequestAttributes</span> <span class="hljs-variable">attribute</span> <span class="hljs-operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();<br>        <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> attribute.getRequest();<br><br>        <span class="hljs-comment">// è·å–è¯·æ±‚è·¯å¾„</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> request.getRequestURI();<br><br>        <span class="hljs-comment">// è§£æå‡ºè¯·æ±‚è€…çš„ID</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">adminUid</span> <span class="hljs-operator">=</span> request.getAttribute(SysConf.ADMIN_UID).toString();<br><br>        <span class="hljs-comment">// å°è¯•ä»Redisè·å–ç®¡ç†å‘˜èƒ½å¤Ÿè®¿é—®çš„è·¯å¾„</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">visitUrlStr</span> <span class="hljs-operator">=</span> redisUtil.get(RedisConf.ADMIN_VISIT_MENU + RedisConf.SEGMENTATION + adminUid);<br>        LinkedTreeMap&lt;String, String&gt; visitMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedTreeMap</span>&lt;&gt;();<br><br>        <span class="hljs-comment">// åˆ¤æ–­Redisä¸­æ˜¯å¦æœ‰æ•°æ®</span><br>        <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(visitUrlStr)) &#123;<br>            <span class="hljs-comment">// ä»Redisä¸­è·å–</span><br>            visitMap = (LinkedTreeMap&lt;String, String&gt;) JsonUtils.jsonToMap(visitUrlStr, String.class);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Redisä¸­æ²¡æœ‰ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“</span><br>            <span class="hljs-type">Admin</span> <span class="hljs-variable">admin</span> <span class="hljs-operator">=</span> adminService.getById(adminUid);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">roleUid</span> <span class="hljs-operator">=</span> admin.getRoleUid();<br>            <span class="hljs-type">Role</span> <span class="hljs-variable">role</span> <span class="hljs-operator">=</span> roleService.getById(roleUid);<br><br>            <span class="hljs-type">String</span> <span class="hljs-variable">categoryMenuUids</span> <span class="hljs-operator">=</span> role.getCategoryMenuUids();<br>            String[] uids = categoryMenuUids.replace(<span class="hljs-string">&quot;[&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;]&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;\&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).split(<span class="hljs-string">&quot;,&quot;</span>);<br><br>            List&lt;String&gt; categoryMenuUids = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(Arrays.asList(uids));<br><br>            <span class="hljs-comment">// åªæŸ¥è¯¢è®¿é—®çš„æŒ‰é’®</span><br>            QueryWrapper&lt;CategoryMenu&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>            queryWrapper.in(SQLConf.UID, categoryMenuUids);<br>            queryWrapper.eq(SQLConf.MENU_TYPE, EMenuType.BUTTON);<br>            queryWrapper.eq(SQLConf.STATUS, EStatus.ENABLE);<br>            List&lt;CategoryMenu&gt; buttonList = categoryMenuService.list(queryWrapper);<br><br>            <span class="hljs-keyword">for</span> (CategoryMenu item : buttonList) &#123;<br>                <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(item.getUrl())) &#123;<br>                    visitMap.put(item.getUrl(), item.getUrl());<br>                &#125;<br>            &#125;<br>            <span class="hljs-comment">// å°†è®¿é—®URLå­˜å‚¨åˆ°Redisä¸­</span><br>            redisUtil.setEx(RedisConf.ADMIN_VISIT_MENU + SysConf.REDIS_SEGMENTATION + adminUid, JsonUtils.objectToJson(visitMap), <span class="hljs-number">1</span>, TimeUnit.HOURS);<br>        &#125;<br><br>        <span class="hljs-comment">// åˆ¤æ–­è¯¥è§’è‰²æ˜¯å¦èƒ½å¤Ÿè®¿é—®è¯¥æ¥å£</span><br>        <span class="hljs-keyword">if</span> (visitMap.get(url) != <span class="hljs-literal">null</span>) &#123;<br>            log.info(<span class="hljs-string">&quot;ç”¨æˆ·æ‹¥æœ‰æ“ä½œæƒé™ï¼Œè®¿é—®çš„è·¯å¾„: &#123;&#125;ï¼Œæ‹¥æœ‰çš„æƒé™æ¥å£ï¼š&#123;&#125;&quot;</span>, url, visitMap.get(url));<br>            <span class="hljs-comment">// ç”¨æˆ·æœ‰æƒé™ï¼Œç»§ç»­æ‰§è¡Œä¸šåŠ¡</span><br>            <span class="hljs-keyword">return</span> joinPoint.proceed();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            log.info(<span class="hljs-string">&quot;ç”¨æˆ·ä¸å…·æœ‰æ“ä½œæƒé™ï¼Œè®¿é—®çš„è·¯å¾„: &#123;&#125;&quot;</span>, url);<br>            <span class="hljs-comment">// ç”¨æˆ·æ— æƒé™ï¼Œè¿”å›æ— æƒé™çš„å“åº”</span><br>            <span class="hljs-keyword">return</span> ResultUtil.result(ECode.NO_OPERATION_AUTHORITY, MessageConf.RESTAPI_NO_PRIVILEGE);<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€-Validated-æ³¨è§£çš„ä½¿ç”¨"><a href="#2ã€-Validated-æ³¨è§£çš„ä½¿ç”¨" class="headerlink" title="2ã€@Validated æ³¨è§£çš„ä½¿ç”¨"></a>2ã€@Validated æ³¨è§£çš„ä½¿ç”¨</h3><h4 id="è§£é‡Šå¦‚ä½•ä½¿ç”¨çš„"><a href="#è§£é‡Šå¦‚ä½•ä½¿ç”¨çš„" class="headerlink" title="è§£é‡Šå¦‚ä½•ä½¿ç”¨çš„"></a>è§£é‡Šå¦‚ä½•ä½¿ç”¨çš„</h4><p>Springæ¡†æ¶ä¸­ï¼Œ<code>@Validated</code> æ³¨è§£æ˜¯ç”¨æ¥å¯ç”¨æ–¹æ³•å‚æ•°çº§åˆ«çš„éªŒè¯çš„ã€‚è¿™ä¸ªæ³¨è§£å‘Šè¯‰Springéœ€è¦å¯¹è¢«æ³¨è§£çš„å‚æ•°æ‰§è¡ŒéªŒè¯ã€‚</p><blockquote><p>å¦‚ä½•ä½¿ç”¨ <code>@Validated</code></p></blockquote><p>ä¸€èˆ¬ä¼šç»“åˆ éªŒè¯ç»„ã€<code>@RequestBody</code>ã€<code>BindingResult</code> ç»“åˆä½¿ç”¨</p><ol><li><strong>æŒ‡å®šéªŒè¯ç»„</strong>:<ul><li><code>@Validated</code> å¯ä»¥æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªéªŒè¯ç»„ï¼Œä¾‹å¦‚ <code>@Validated(&#123;GetList.class&#125;)</code>ã€‚è¿™æ„å‘³ç€åªæœ‰åœ¨ <code>GetList</code> ç»„ä¸­å®šä¹‰çš„éªŒè¯è§„åˆ™ä¼šè¢«åº”ç”¨äº <code>blogVO</code> å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šç»„ï¼Œå°†åº”ç”¨é»˜è®¤çš„éªŒè¯è§„åˆ™ã€‚</li></ul></li><li><strong>ä¸ <code>@RequestBody</code> ç»“åˆ</strong>:<ul><li>åœ¨RESTæ§åˆ¶å™¨ä¸­ï¼Œ<code>@Validated</code> é€šå¸¸ä¸ <code>@RequestBody</code> ç»“åˆä½¿ç”¨ï¼Œç”¨äºéªŒè¯JSONè¯·æ±‚ä½“æ˜ å°„åˆ°çš„Javaå¯¹è±¡ã€‚</li></ul></li><li><strong>å¤„ç†éªŒè¯ç»“æœ</strong>:<ul><li>é€šå¸¸ä¸ <code>BindingResult</code> ç»“åˆä½¿ç”¨ï¼Œåè€…ç”¨äºæ•è·éªŒè¯è¿‡ç¨‹ä¸­å‘ç°çš„é”™è¯¯ã€‚å¦‚æœå­˜åœ¨é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ <code>BindingResult</code> å¯¹è±¡æ¥å“åº”ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</li></ul></li></ol><h4 id="åŸºæœ¬ä½¿ç”¨ç”¨æ³•"><a href="#åŸºæœ¬ä½¿ç”¨ç”¨æ³•" class="headerlink" title="åŸºæœ¬ä½¿ç”¨ç”¨æ³•"></a>åŸºæœ¬ä½¿ç”¨ç”¨æ³•</h4><blockquote><p>ä½¿ç”¨ç¤ºä¾‹</p></blockquote><p>å±•ç¤ºå¦‚ä½•åœ¨Spring Bootåº”ç”¨ä¸­å¯¹ä¸€ä¸ªREST APIç«¯ç‚¹çš„è¯·æ±‚ä½“è¿›è¡ŒéªŒè¯ã€‚</p><p><strong>åœºæ™¯æè¿°</strong></p><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªåšå®¢åº”ç”¨ç¨‹åºï¼Œéœ€è¦ä¸€ä¸ªAPIæ¥åˆ›å»ºæ–°çš„åšå®¢æ–‡ç« ã€‚</p><p>æˆ‘ä»¬å¸Œæœ›ç¡®ä¿ä¼ å…¥çš„æ•°æ®æ»¡è¶³æŸäº›æ¡ä»¶ï¼Œæ¯”å¦‚æ ‡é¢˜ä¸ä¸ºç©ºï¼Œå†…å®¹é•¿åº¦ä¸ä½äºä¸€å®šå­—ç¬¦æ•°ç­‰ã€‚</p><p><strong>å®ä½“ç±»å®šä¹‰</strong></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>BlogPost</code> ç±»ï¼Œå®ƒåŒ…å«æ–‡ç« çš„æ ‡é¢˜å’Œå†…å®¹ï¼Œè¿™äº›å­—æ®µéƒ½æœ‰ç‰¹å®šçš„éªŒè¯è§„åˆ™ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> javax.<span class="hljs-property">validation</span>.<span class="hljs-property">constraints</span>.<span class="hljs-property">NotBlank</span>;<br><span class="hljs-keyword">import</span> javax.<span class="hljs-property">validation</span>.<span class="hljs-property">constraints</span>.<span class="hljs-property">Size</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogPost</span> &#123;<br><br>    <span class="hljs-meta">@NotBlank</span>(message = <span class="hljs-string">&quot;Title is required&quot;</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> title;<br><br>    <span class="hljs-meta">@NotBlank</span>(message = <span class="hljs-string">&quot;Content is required&quot;</span>)<br>    <span class="hljs-meta">@Size</span>(min = <span class="hljs-number">100</span>, message = <span class="hljs-string">&quot;Content must be at least 100 characters long&quot;</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> content;<br><br>    <span class="hljs-comment">// Getters and setters</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTitle</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> title;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setTitle</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> title</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getContent</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> content;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setContent</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> content</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span> = content;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ§åˆ¶å™¨æ–¹æ³•</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªRESTæ§åˆ¶å™¨æ–¹æ³•æ¥æ¥æ”¶åšå®¢æ–‡ç« çš„æ•°æ®ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.validation.BindingResult;<br><span class="hljs-keyword">import</span> org.springframework.validation.<span class="hljs-keyword">annotation</span>.Validated;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogController</span> &#123;<br><br>    <span class="hljs-meta">@PostMapping(<span class="hljs-string">&quot;/createBlog&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> String createBlog(<span class="hljs-meta">@Validated</span> <span class="hljs-meta">@RequestBody</span> BlogPost blogPost, BindingResult result) &#123;<br>        <span class="hljs-keyword">if</span> (result.hasErrors()) &#123;<br>            <span class="hljs-comment">// å¤„ç†éªŒè¯é”™è¯¯ï¼Œä¾‹å¦‚è¿”å›é”™è¯¯ä¿¡æ¯</span><br>            <span class="hljs-keyword">return</span> result.getFieldError().getDefaultMessage();<br>        &#125;<br>        <span class="hljs-comment">// å¦‚æœæ•°æ®æœ‰æ•ˆï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚ä¿å­˜åšå®¢æ–‡ç« </span><br>        <span class="hljs-comment">// saveBlogPost(blogPost);</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Blog post created successfully&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ç”¨æ³•</p><ul><li><code>BlogPost</code> ç±»ä¸­çš„å­—æ®µ <code>title</code> å’Œ <code>content</code> ä½¿ç”¨äº†JSR 380ï¼ˆHibernate Validatorï¼‰æ³¨è§£æ¥å£°æ˜éªŒè¯è§„åˆ™ã€‚<code>@NotBlank</code> ç¡®ä¿å­—æ®µä¸ä¸ºç©ºï¼Œ<code>@Size</code> æŒ‡å®šäº† <code>content</code> å­—æ®µçš„æœ€å°é•¿åº¦ã€‚</li><li>åœ¨ <code>BlogController</code> çš„ <code>createBlog</code> æ–¹æ³•ä¸­ï¼Œ<code>@Validated</code> æ³¨è§£ç”¨äºå¯ç”¨å¯¹ <code>@RequestBody</code> æ³¨è§£çš„ <code>BlogPost</code> å¯¹è±¡çš„è‡ªåŠ¨éªŒè¯ã€‚</li><li><code>BindingResult</code> å‚æ•°ç”¨äºæ•è·ä»»ä½•éªŒè¯é”™è¯¯ã€‚å¦‚æœå­˜åœ¨é”™è¯¯ï¼Œå¯ä»¥ä» <code>BindingResult</code> ä¸­è·å–é”™è¯¯ä¿¡æ¯å¹¶é€‚å½“å“åº”ã€‚</li></ul><p>åœ¨æ¥å£è°ƒç”¨çš„æ—¶å€™ï¼Œå½“å®¢æˆ·ç«¯å‘é€POSTè¯·æ±‚åˆ° <code>/createBlog</code> ç«¯ç‚¹ï¼Œå¹¶æä¾›JSONæ ¼å¼çš„åšå®¢æ–‡ç« æ•°æ®æ—¶ï¼ŒSpringå°†è‡ªåŠ¨éªŒè¯è¯¥æ•°æ®æ˜¯å¦ç¬¦åˆ <code>BlogPost</code> ç±»ä¸­å®šä¹‰çš„è§„åˆ™ã€‚å¦‚æœæ•°æ®ä¸ç¬¦åˆè§„åˆ™ï¼Œå°†è¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</p><h4 id="å¦‚æœéœ€è¦ä½¿ç”¨éªŒè¯ç»„ï¼Œæ˜¯å¦‚ä½•ä½¿ç”¨çš„"><a href="#å¦‚æœéœ€è¦ä½¿ç”¨éªŒè¯ç»„ï¼Œæ˜¯å¦‚ä½•ä½¿ç”¨çš„" class="headerlink" title="å¦‚æœéœ€è¦ä½¿ç”¨éªŒè¯ç»„ï¼Œæ˜¯å¦‚ä½•ä½¿ç”¨çš„"></a>å¦‚æœéœ€è¦ä½¿ç”¨éªŒè¯ç»„ï¼Œæ˜¯å¦‚ä½•ä½¿ç”¨çš„</h4><blockquote><p>ä½¿ç”¨ç¤ºä¾‹2</p></blockquote><p>è¿™é‡Œä¸»è¦è¯´æ˜ä¸€ä¸‹éªŒè¯ç»„çš„ä½¿ç”¨</p><p>åœ¨Springæ¡†æ¶ä¸­ï¼Œå½“ <code>@Validated</code> æ³¨è§£è¢«åº”ç”¨äºä¸€ä¸ªæ–¹æ³•å‚æ•°ï¼Œå¹¶ä¸”æŒ‡å®šäº†ä¸€ä¸ªæˆ–å¤šä¸ªç»„ç±»ï¼Œè¿›è¡ŒéªŒè¯æ—¶åªä¼šè€ƒè™‘é‚£äº›å±äºæŒ‡å®šç»„çš„éªŒè¯çº¦æŸã€‚</p><p><strong>éªŒè¯ç»„çš„ä½œç”¨</strong></p><ol><li><strong>åˆ†ç»„éªŒè¯</strong>:<ul><li>éªŒè¯ç»„å…è®¸ä½ å°†ä¸€ä¸ªå®ä½“ç±»ï¼ˆå¦‚ <code>BlogVO</code>ï¼‰çš„éªŒè¯è§„åˆ™åˆ†æˆä¸åŒçš„ç»„ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥åœ¨ä¸åŒçš„åœºæ™¯ä¸‹åº”ç”¨ä¸åŒçš„éªŒè¯è§„åˆ™é›†åˆã€‚</li><li>ä¾‹å¦‚ï¼Œä¸€ä¸ªå®ä½“åœ¨åˆ›å»ºæ—¶å¯èƒ½éœ€è¦ä¸€ç»„éªŒè¯è§„åˆ™ï¼Œåœ¨æ›´æ–°æ—¶éœ€è¦å¦ä¸€ç»„è§„åˆ™ã€‚</li></ul></li><li><strong>å®šä¹‰éªŒè¯ç»„</strong>:<ul><li>éªŒè¯ç»„é€šå¸¸æ˜¯ç©ºæ¥å£ï¼Œç”¨äºæ ‡è¯†éªŒè¯è§„åˆ™å±äºå“ªä¸ªç»„ã€‚</li><li>ä¾‹å¦‚ï¼Œ<code>public interface GetList &#123;&#125;</code> å¯ä»¥ä½œä¸ºä¸€ä¸ªéªŒè¯ç»„çš„å£°æ˜ã€‚</li></ul></li></ol><p><strong>ä»£ç ç¤ºä¾‹</strong></p><p>å®ä½“ç±»ä¸­çš„éªŒè¯è§„åˆ™</p><p>åœ¨ <code>BlogVO</code> å®ä½“ç±»ä¸­ï¼ŒéªŒè¯æ³¨è§£å¯èƒ½åƒè¿™æ ·ä½¿ç”¨ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Blog</span>VO &#123;<br><br>    <span class="hljs-variable">@NotBlank</span>(groups = <span class="hljs-title class_">GetList</span>.<span class="hljs-keyword">class</span>, message = <span class="hljs-string">&quot;Title cannot be empty when getting list&quot;</span>)<br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> title;<br><br>    <span class="hljs-regexp">//</span> å…¶ä»–å­—æ®µå’Œgetter/setter<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><ul><li><code>@NotBlank</code> æ³¨è§£åªæœ‰åœ¨æ‰§è¡Œé’ˆå¯¹ <code>GetList</code> ç»„çš„éªŒè¯æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚</li><li>å¦‚æœåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ä½¿ç”¨äº† <code>@Validated(&#123;GetList.class&#125;)</code> å¯¹ <code>BlogVO</code> å®ä¾‹è¿›è¡ŒéªŒè¯ï¼Œé‚£ä¹ˆåªæœ‰é‚£äº›æŒ‡å®šä¸º <code>GetList</code> ç»„çš„éªŒè¯è§„åˆ™ï¼ˆå¦‚ä¸Šé¢çš„ <code>title</code> å­—æ®µï¼‰ä¼šè¢«è€ƒè™‘ã€‚</li><li>è¿™ç§æ–¹å¼æä¾›äº†çµæ´»æ€§ï¼Œå…è®¸åœ¨ä¸åŒçš„æ“ä½œï¼ˆå¦‚è·å–åˆ—è¡¨ã€åˆ›å»ºã€æ›´æ–°ç­‰ï¼‰ä¸­é‡å¤ä½¿ç”¨åŒä¸€ä¸ªå®ä½“ç±»ï¼ŒåŒæ—¶åº”ç”¨ä¸åŒçš„éªŒè¯è§„åˆ™ã€‚</li></ul><p>æ§åˆ¶å™¨æ–¹æ³•</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">&quot;/getList&quot;</span>)  <br>public String <span class="hljs-built_in">getList</span>(<span class="hljs-variable">@Validated</span>(&#123;GetList.class&#125;) <span class="hljs-variable">@RequestBody</span> BlogVO blogVO, BindingResult result) &#123;  <br>  <br>    <span class="hljs-selector-tag">ThrowableUtils</span><span class="hljs-selector-class">.checkParamArgument</span>(result);  <br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResultUtil</span><span class="hljs-selector-class">.successWithData</span>(blogService.<span class="hljs-built_in">getPageList</span>(blogVO));  <br>&#125;<br></code></pre></td></tr></table></figure><p>GetList æ¥å£å®šä¹‰</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * GetList Group  ç”¨äºgetListæ–¹æ³•æŸ¥è¯¢æ—¶  </span><br><span class="hljs-comment"> *  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span>: é™Œæºª  </span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span>: 2019å¹´12æœˆ4æ—¥22:49:01  </span><br><span class="hljs-comment"> */</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GetList</span> &#123;  <br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>@Validated(&#123;GetList.class&#125;)</code> è¡¨æ˜åªæœ‰æ ‡è®°ä¸º <code>GetList</code> ç»„çš„éªŒè¯çº¦æŸä¼šè¢«åº”ç”¨äº <code>BlogVO</code> å¯¹è±¡ã€‚</li><li>è¿™æ„å‘³ç€ <code>BlogVO</code> ç±»ä¸­çš„æŸäº›éªŒè¯æ³¨è§£å¯èƒ½è¢«æŒ‡å®šä¸ºä»…åœ¨ <code>GetList</code> ç»„ä¸Šä¸‹æ–‡ä¸­æœ‰æ•ˆã€‚</li></ul><hr><h3 id="3ã€æŠ›å‡ºå¼‚å¸¸å·¥å…·ç±»ThrowableUtils"><a href="#3ã€æŠ›å‡ºå¼‚å¸¸å·¥å…·ç±»ThrowableUtils" class="headerlink" title="3ã€æŠ›å‡ºå¼‚å¸¸å·¥å…·ç±»ThrowableUtils"></a>3ã€æŠ›å‡ºå¼‚å¸¸å·¥å…·ç±»ThrowableUtils</h3><p>è¿™ä¸ªç±»ä¸»è¦ç”¨æ³•æ˜¯å¤„ç†éªŒè¯ç»“æœï¼Œå½“ä¼ å…¥æ¥å£æ•°æ®æ—¶ï¼Œæ˜ å°„å¯¹è±¡  BlogVO é‡Œé¢çš„å‚æ•°æ ¡éªŒï¼Œå¯¹åº”çš„éªŒè¯ç»“æœ  result ï¼Œå¯¹éªŒè¯ç»“æœè¿›è¡Œå¤„ç†</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æŠ›å‡ºå¼‚å¸¸å·¥å…·ç±»</span><br><span class="hljs-comment"> * ç”¨äºå¤„ç†å’Œæ ¼å¼åŒ–ç”±Spring Validationæ¡†æ¶æŠ›å‡ºçš„éªŒè¯é”™è¯¯ã€‚</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * @author é™Œæºª</span><br><span class="hljs-comment"> * @date 2019å¹´12æœˆ4æ—¥22:47:18</span><br><span class="hljs-comment"> */</span><br>public <span class="hljs-keyword">class</span> ThrowableUtils &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¡éªŒå‚æ•°æ­£ç¡®æ€§ï¼Œå¦‚æœå‘ç°éªŒè¯é”™è¯¯ï¼Œåˆ™æ‹¼è£…å¹¶æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ã€‚</span><br><span class="hljs-comment">     * è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºå¤„ç†ç”±Spring Validationæ¡†æ¶äº§ç”Ÿçš„éªŒè¯é”™è¯¯ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * @param result BindingResultå¯¹è±¡ï¼ŒåŒ…å«éªŒè¯è¿‡ç¨‹ä¸­äº§ç”Ÿçš„é”™è¯¯ä¿¡æ¯ã€‚</span><br><span class="hljs-comment">     */</span><br>    public static void checkParamArgument(BindingResult result) &#123;<br>        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨éªŒè¯é”™è¯¯</span><br>        <span class="hljs-keyword">if</span> (result != null &amp;&amp; result.hasErrors()) &#123;<br>            StringBuilder sb = new StringBuilder();<br><br>            <span class="hljs-comment">// è·å–æ‰€æœ‰å­—æ®µçº§åˆ«çš„é”™è¯¯</span><br>            <span class="hljs-keyword">List</span>&lt;FieldError&gt; errors = result.getFieldErrors();<br>            <span class="hljs-keyword">if</span> (CollectionUtil.isNotEmpty(errors)) &#123;<br>                <span class="hljs-comment">// åªå¤„ç†ç¬¬ä¸€ä¸ªé”™è¯¯</span><br>                FieldError <span class="hljs-keyword">error</span> = errors.<span class="hljs-built_in">get</span>(0);<br>                <br>                <span class="hljs-comment">// è·å–è¢«æ‹’ç»çš„å€¼ï¼ˆå³ä¸åˆæ³•çš„è¾“å…¥å€¼ï¼‰</span><br>                String rejectedValue = Objects.<span class="hljs-keyword">toString</span>(<span class="hljs-keyword">error</span>.getRejectedValue(), <span class="hljs-string">&quot;&quot;</span>);<br>                <span class="hljs-comment">// è·å–é»˜è®¤é”™è¯¯ä¿¡æ¯</span><br>                String defMsg = <span class="hljs-keyword">error</span>.getDefaultMessage();<br><br>                <span class="hljs-comment">// æ’é™¤åœ¨ç±»çº§åˆ«ä¸Šçš„æ³¨è§£æç¤º</span><br>                <span class="hljs-keyword">if</span> (rejectedValue.contains(Constants.DELIMITER_TO)) &#123;<br>                    <span class="hljs-comment">// å¯¹äºç±»çº§åˆ«çš„é”™è¯¯ï¼Œç›´æ¥ä½¿ç”¨é”™è¯¯ä¿¡æ¯</span><br>                    sb.<span class="hljs-keyword">append</span>(defMsg);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">// å¯¹äºå­—æ®µçº§åˆ«çš„é”™è¯¯ï¼Œæ‹¼æ¥å­—æ®µåå’Œé”™è¯¯ä¿¡æ¯</span><br>                    <span class="hljs-keyword">if</span> (Constants.DELIMITER_COLON.contains(defMsg)) &#123;<br>                        sb.<span class="hljs-keyword">append</span>(<span class="hljs-keyword">error</span>.getField()).<span class="hljs-keyword">append</span>(<span class="hljs-string">&quot; &quot;</span>).<span class="hljs-keyword">append</span>(defMsg);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        sb.<span class="hljs-keyword">append</span>(<span class="hljs-keyword">error</span>.getField()).<span class="hljs-keyword">append</span>(<span class="hljs-string">&quot; &quot;</span>).<span class="hljs-keyword">append</span>(defMsg);<br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// å¤„ç†éå­—æ®µçº§åˆ«çš„é”™è¯¯ï¼ˆå¦‚ç±»çº§åˆ«çš„é”™è¯¯ï¼‰</span><br>                String msg = result.getAllErrors().<span class="hljs-built_in">get</span>(0).getDefaultMessage();<br>                sb.<span class="hljs-keyword">append</span>(msg);<br>            &#125;<br>            <br>            <span class="hljs-comment">// æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ï¼ŒåŒ…å«å¤„ç†è¿‡çš„é”™è¯¯ä¿¡æ¯</span><br>            throw new ApiInvalidParamException(sb.<span class="hljs-keyword">toString</span>());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4ã€è‡ªå®šä¹‰å¼‚å¸¸-ApiInvalidParamException-çš„ä½¿ç”¨"><a href="#4ã€è‡ªå®šä¹‰å¼‚å¸¸-ApiInvalidParamException-çš„ä½¿ç”¨" class="headerlink" title="4ã€è‡ªå®šä¹‰å¼‚å¸¸ ApiInvalidParamException çš„ä½¿ç”¨"></a>4ã€è‡ªå®šä¹‰å¼‚å¸¸ ApiInvalidParamException çš„ä½¿ç”¨</h3><p><code>ApiInvalidParamException</code> ç±»æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œç»§æ‰¿è‡ª <code>RuntimeException</code>ã€‚å…¶ä¸»è¦ä½œç”¨æ˜¯å°è£…å’Œè¡¨ç¤ºä¸APIå‚æ•°ç›¸å…³çš„é”™è¯¯æˆ–å¼‚å¸¸æƒ…å†µã€‚</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è‡ªå®šä¹‰çš„è¿è¡Œæ—¶å¼‚å¸¸ç±»ï¼Œç”¨äºè¡¨ç¤ºAPIæ“ä½œä¸­çš„å‚æ•°æ— æ•ˆæˆ–ä¸ç¬¦åˆé¢„æœŸçš„æƒ…å†µã€‚</span><br><span class="hljs-comment"> * è¿™ä¸ªç±»ä¸»è¦ç”¨äºåœ¨APIå±‚æŠ›å‡ºå‚æ•°ç›¸å…³çš„å¼‚å¸¸ï¼Œå¹¶èƒ½å¤Ÿè¢«å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ•è·å’Œå¤„ç†ï¼Œ</span><br><span class="hljs-comment"> * ä»¥ä¾¿è¿”å›ç»Ÿä¸€æ ¼å¼çš„é”™è¯¯å“åº”ç»™å®¢æˆ·ç«¯ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiInvalidParamException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = <span class="hljs-number">1</span>L;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ— å‚æ„é€ å‡½æ•°ã€‚</span><br><span class="hljs-comment">     * åˆ›å»ºä¸€ä¸ªæ²¡æœ‰è¯¦ç»†é”™è¯¯æ¶ˆæ¯çš„ApiInvalidParamExceptionå¼‚å¸¸å®ä¾‹ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApiInvalidParamException</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¸¦æ¶ˆæ¯å’ŒåŸå› çš„æ„é€ å‡½æ•°ã€‚</span><br><span class="hljs-comment">     * åˆ›å»ºä¸€ä¸ªåŒ…å«å…·ä½“é”™è¯¯æè¿°å’ŒåŸå› çš„ApiInvalidParamExceptionå¼‚å¸¸å®ä¾‹ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message æè¿°å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> cause å¼•å‘æ­¤å¼‚å¸¸çš„åŸå› ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApiInvalidParamException</span><span class="hljs-params">(String message, Throwable cause)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message, cause);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¸¦æ¶ˆæ¯çš„æ„é€ å‡½æ•°ã€‚</span><br><span class="hljs-comment">     * åˆ›å»ºä¸€ä¸ªåŒ…å«å…·ä½“é”™è¯¯æè¿°çš„ApiInvalidParamExceptionå¼‚å¸¸å®ä¾‹ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message æè¿°å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApiInvalidParamException</span><span class="hljs-params">(String message)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(message);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¸¦åŸå› çš„æ„é€ å‡½æ•°ã€‚</span><br><span class="hljs-comment">     * åˆ›å»ºä¸€ä¸ªåŒ…å«åŸå› çš„ApiInvalidParamExceptionå¼‚å¸¸å®ä¾‹ï¼Œä½†ä¸æä¾›è¯¦ç»†ä¿¡æ¯ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> cause å¼•å‘æ­¤å¼‚å¸¸çš„åŸå› ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ApiInvalidParamException</span><span class="hljs-params">(Throwable cause)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(cause);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç è§£é‡Š</p><p>ç±»ä¸­å®šä¹‰äº†å‡ ä¸ªæ„é€ å‡½æ•°ï¼Œå…è®¸åœ¨åˆ›å»ºå¼‚å¸¸å®ä¾‹æ—¶æä¾›ä¸åŒç±»å‹çš„ä¿¡æ¯ï¼š</p><ol><li><p><strong>æ— å‚æ„é€ å‡½æ•°</strong>:</p><ul><li><code>public ApiInvalidParamException()</code>: åˆ›å»ºä¸€ä¸ªæ²¡æœ‰è¯¦ç»†é”™è¯¯æ¶ˆæ¯çš„å¼‚å¸¸å®ä¾‹ã€‚</li></ul></li><li><p><strong>å¸¦æ¶ˆæ¯çš„æ„é€ å‡½æ•°</strong>:</p><ul><li><code>public ApiInvalidParamException(String message)</code>: åˆ›å»ºä¸€ä¸ªå¸¦æœ‰å…·ä½“é”™è¯¯æè¿°çš„å¼‚å¸¸å®ä¾‹ã€‚</li></ul></li><li><p><strong>å¸¦æ¶ˆæ¯å’ŒåŸå› çš„æ„é€ å‡½æ•°</strong>:</p><ul><li><code>public ApiInvalidParamException(String message, Throwable cause)</code>: åˆ›å»ºä¸€ä¸ªå¼‚å¸¸å®ä¾‹ï¼ŒåŒæ—¶æä¾›é”™è¯¯æè¿°å’Œä¸€ä¸ªåŸå§‹å¼‚å¸¸ï¼ˆåŸå§‹å¼‚å¸¸è¡¨ç¤ºè¿™ä¸ªæ–°å¼‚å¸¸çš„åŸå› ï¼‰ã€‚</li></ul></li><li><p><strong>å¸¦åŸå› çš„æ„é€ å‡½æ•°</strong>:</p><ul><li><code>public ApiInvalidParamException(Throwable cause)</code>: åˆ›å»ºä¸€ä¸ªå¼‚å¸¸å®ä¾‹ï¼ŒåªåŒ…å«ä¸€ä¸ªåŸå§‹å¼‚å¸¸ã€‚</li></ul></li></ol><blockquote><p>è‡ªå®šä¹‰å¼‚å¸¸ç±»çš„ä½¿ç”¨</p></blockquote><p><strong>ä½¿ç”¨åœºæ™¯</strong></p><p>åœ¨APIçš„å„ä¸ªå±‚é¢ï¼ˆå¦‚æ§åˆ¶å™¨ã€æœåŠ¡æˆ–æ•°æ®è®¿é—®å±‚ï¼‰ä¸­ï¼Œå½“é‡åˆ°ä¸ç¬¦åˆè¦æ±‚çš„å‚æ•°æˆ–å…¶ä»–ä¸å‚æ•°ç›¸å…³çš„é—®é¢˜æ—¶ï¼Œå¯ä»¥æŠ›å‡º <code>ApiInvalidParamException</code>ã€‚</p><p>ç„¶åï¼Œå…¨å±€å¼‚å¸¸å¤„ç†å™¨å¯ä»¥æ•è·è¿™äº›å¼‚å¸¸ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºç»Ÿä¸€çš„ã€ç”¨æˆ·å‹å¥½çš„å“åº”æ ¼å¼ï¼Œå¦‚JSONï¼ŒåŒ…å«é”™è¯¯ä»£ç å’Œé”™è¯¯æ¶ˆæ¯ã€‚</p><p><strong>ä½œç”¨å’Œç”¨é€”</strong></p><ol><li><strong>è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</strong>:<ul><li>è¿™ä¸ªç±»ç”¨äºè¡¨ç¤ºåœ¨APIä¸­é‡åˆ°çš„ç‰¹å®šç±»å‹çš„å‚æ•°é”™è¯¯ã€‚é€šè¿‡åˆ›å»ºè¿™æ ·çš„è‡ªå®šä¹‰å¼‚å¸¸ï¼Œå¯ä»¥æ›´æ¸…æ™°åœ°è¡¨è¾¾ä»£ç ä¸­å¯èƒ½å‡ºç°çš„ç‰¹å®šé”™è¯¯æƒ…å†µã€‚</li></ul></li><li><strong>å…¨å±€å¼‚å¸¸æ‹¦æˆª</strong>:<ul><li>åœ¨ä¸€ä¸ªåŸºäºSpring Bootçš„REST APIé¡¹ç›®ä¸­ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ˆå¦‚ä½¿ç”¨ <code>@ControllerAdvice</code> æ³¨è§£çš„ç±»ï¼‰ã€‚</li><li><code>ApiInvalidParamException</code> å¯ä»¥è¢«è¿™æ ·çš„å…¨å±€å¤„ç†å™¨æ•è·ï¼Œå¹¶è½¬æ¢ä¸ºç»Ÿä¸€çš„å“åº”æ ¼å¼å‘é€ç»™APIçš„è°ƒç”¨è€…ã€‚è¿™æœ‰åŠ©äºç»´æŒAPIçš„å“åº”æ ¼å¼çš„ä¸€è‡´æ€§ã€‚</li></ul></li><li><strong>é”™è¯¯æ¶ˆæ¯å®šåˆ¶</strong>:<ul><li>è¿™ä¸ªå¼‚å¸¸ç±»å…è®¸åœ¨æŠ›å‡ºå¼‚å¸¸æ—¶é™„å¸¦ä¸€ä¸ªè‡ªå®šä¹‰çš„é”™è¯¯æ¶ˆæ¯ï¼Œè¿™å¯¹äºæä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œå“ªä¸ªå‚æ•°é”™è¯¯ä»¥åŠä¸ºä»€ä¹ˆé”™è¯¯ï¼‰éå¸¸æœ‰ç”¨ã€‚</li></ul></li></ol><h3 id="5ã€å…¨å±€å¼‚å¸¸å¤„ç†"><a href="#5ã€å…¨å±€å¼‚å¸¸å¤„ç†" class="headerlink" title="5ã€å…¨å±€å¼‚å¸¸å¤„ç†"></a>5ã€å…¨å±€å¼‚å¸¸å¤„ç†</h3><p><code>GlobalExceptionConfig</code> ç±»å’Œ <code>HandlerExceptionResolver</code> ç±»æ˜¯Springæ¡†æ¶ä¸­ç”¨äºå…¨å±€å¼‚å¸¸å¤„ç†çš„é…ç½®å’Œå®ç°</p><p>é’ˆå¯¹è˜‘è‡åšå®¢ç›¸å…³å®ç°ï¼Œè¿›è¡Œè¯´æ˜</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@Configuration  </span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalExceptionConfig</span> </span>&#123;  <br>  <br>    <span class="hljs-meta">@Bean  </span><br>    <span class="hljs-keyword">public</span> HandlerExceptionResolver getHandlerExceptionResolver() &#123;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">HandlerExceptionResolver</span>();  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>@Configuration</code>: è¡¨ç¤ºè¿™ä¸ªç±»åŒ…å«Springå®¹å™¨çš„beanå®šä¹‰ã€‚</li><li><code>@Bean</code>: è¡¨ç¤ºè¯¥æ–¹æ³•å°†è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åº”è¯¥è¢«æ³¨å†Œä¸ºSpringåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­çš„beanã€‚</li><li><code>getHandlerExceptionResolver()</code>: è¿™ä¸ªæ–¹æ³•åˆ›å»ºå¹¶è¿”å› <code>HandlerExceptionResolver</code> çš„ä¸€ä¸ªå®ä¾‹ï¼Œç”¨äºå…¨å±€å¼‚å¸¸å¤„ç†</li></ul><blockquote><p>HandlerExceptionResolver ç±»è§£é‡Š</p></blockquote><p><code>HandlerExceptionResolver</code> ç±»å®ç°äº†Springçš„ <code>HandlerExceptionResolver</code> æ¥å£ï¼Œç”¨äºå¤„ç†Spring MVCæŠ›å‡ºçš„æ‰€æœ‰å¼‚å¸¸ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HandlerExceptionResolver</span> <span class="hljs-keyword">implements</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">servlet</span>.<span class="hljs-property">HandlerExceptionResolver</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ModelAndView</span> <span class="hljs-title function_">resolveException</span>(<span class="hljs-params">HttpServletRequest request, HttpServletResponse response, <span class="hljs-built_in">Object</span> handler, Exception exception</span>) &#123;<br>        <span class="hljs-comment">// å¼‚å¸¸å¤„ç†é€»è¾‘...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>@Slf4j</code>: Lombokåº“æä¾›çš„æ³¨è§£ï¼Œä¸ºç±»æä¾›äº†ä¸€ä¸ªæ—¥å¿—å¯¹è±¡ <code>log</code>ã€‚</li><li><code>resolveException(...)</code>: è¿™æ˜¯å¼‚å¸¸å¤„ç†çš„æ ¸å¿ƒæ–¹æ³•ï¼Œå®ƒæ¥æ”¶å‘ç”Ÿå¼‚å¸¸çš„HTTPè¯·æ±‚å’Œå“åº”ã€å¤„ç†å™¨ï¼ˆhandlerï¼‰å¯¹è±¡ä»¥åŠå®é™…æŠ›å‡ºçš„å¼‚å¸¸ã€‚</li><li>åœ¨è¿™ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œå¯ä»¥æ ¹æ®ä¸åŒç±»å‹çš„å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œå¹¶ç”Ÿæˆé€‚å½“çš„å“åº”</li></ul><p>å…·ä½“ä»£ç åˆ†æ</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Slf</span>4j<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HandlerExceptionResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">org</span>.<span class="hljs-title">springframework</span>.<span class="hljs-title">web</span>.<span class="hljs-title">servlet</span>.<span class="hljs-title">HandlerExceptionResolver</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¤„ç†Spring MVCæŠ›å‡ºçš„æ‰€æœ‰å¼‚å¸¸ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request   å½“å‰çš„HTTPè¯·æ±‚</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response  å½“å‰çš„HTTPå“åº”</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> handler   å¤„ç†å½“å‰è¯·æ±‚çš„å¤„ç†å™¨</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> exception æŠ›å‡ºçš„å¼‚å¸¸</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ModelAndView - Spring MVCçš„æ¨¡å‹å’Œè§†å›¾å¯¹è±¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function">ModelAndView <span class="hljs-title">resolveException</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object <span class="hljs-keyword">handler</span>, Exception exception)</span> </span>&#123;<br>        log.<span class="hljs-keyword">error</span>(<span class="hljs-string">&quot;ç³»ç»Ÿç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼š&quot;</span>, exception);<br><br>        <span class="hljs-comment">// æ£€æŸ¥å“åº”æ˜¯å¦å·²ç»æäº¤</span><br>        <span class="hljs-keyword">if</span> (response.isCommitted()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView();<br>        &#125;<br><br>        <span class="hljs-comment">// åˆå§‹åŒ–é”™è¯¯ä»£ç å’Œä¿¡æ¯</span><br>        String errorCode = ErrorCode.ERROR;<br>        String message = BaseMessageConf.OPERATION_FAIL;<br><br>        <span class="hljs-comment">// æ ¹æ®å¼‚å¸¸ç±»å‹è®¾ç½®ä¸åŒçš„é”™è¯¯ä»£ç å’Œæ¶ˆæ¯</span><br>        <span class="hljs-keyword">if</span> (exception <span class="hljs-keyword">instanceof</span> BusinessException) &#123;<br>            errorCode = ((BusinessException) exception).getCode();<br>            message = exception.getMessage();<br>        &#125; <span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> <span class="hljs-params">(exception <span class="hljs-keyword">instanceof</span> ApiInvalidParamException)</span> </span>&#123;<br>            errorCode = ErrorCode.PARAM_INCORRECT;<br>            message = exception.getMessage();<br>        &#125;<br>        <span class="hljs-comment">// ...å¤„ç†å…¶ä»–è‡ªå®šä¹‰å¼‚å¸¸</span><br><br>        <span class="hljs-comment">// è®¾ç½®å“åº”ç±»å‹ä¸ºJSON</span><br>        response.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);<br><br>        <span class="hljs-comment">// å‘å®¢æˆ·ç«¯è¾“å‡ºé”™è¯¯ä¿¡æ¯</span><br>        <span class="hljs-keyword">try</span> (PrintWriter writer = response.getWriter()) &#123;<br>            writer.write(ResultUtil.resultWithMessage(errorCode, message));<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.<span class="hljs-keyword">error</span>(<span class="hljs-string">&quot;å“åº”è¾“å‡ºå¤±è´¥ï¼åŸå› å¦‚ä¸‹ï¼š&quot;</span>, e);<br>        &#125;<br><br>        <span class="hljs-comment">// è¿”å›ä¸€ä¸ªç©ºçš„ModelAndViewè¡¨ç¤ºå·²æ‰‹åŠ¨å¤„ç†å“åº”</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ModelAndView();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç±»ä¸­ï¼Œ<code>resolveException</code> æ–¹æ³•æ ¹æ®æ•è·åˆ°çš„å¼‚å¸¸ç±»å‹ï¼Œå¯¹é”™è¯¯ä¿¡æ¯è¿›è¡Œå®šåˆ¶ï¼Œå¹¶å°†å®šåˆ¶çš„é”™è¯¯æ¶ˆæ¯ä»¥JSONæ ¼å¼å†™å…¥HTTPå“åº”ã€‚</p><p>è¿™ç§æ–¹å¼æœ‰åŠ©äºå®ç°ç»Ÿä¸€çš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä½¿å¾—APIçš„é”™è¯¯å“åº”æ›´åŠ ä¸€è‡´å’Œæ ‡å‡†åŒ–ã€‚</p><h3 id="6ã€è¿”å›ç»Ÿä¸€æ¥å£ResultUtil"><a href="#6ã€è¿”å›ç»Ÿä¸€æ¥å£ResultUtil" class="headerlink" title="6ã€è¿”å›ç»Ÿä¸€æ¥å£ResultUtil"></a>6ã€è¿”å›ç»Ÿä¸€æ¥å£ResultUtil</h3><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å·¥å…·ç±»ç”¨äºæ„å»ºç»Ÿä¸€çš„APIå“åº”æ ¼å¼ã€‚</span><br><span class="hljs-comment"> * æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥ç”Ÿæˆæ ‡å‡†åŒ–çš„JSONå­—ç¬¦ä¸²å“åº”ï¼Œ</span><br><span class="hljs-comment"> * åŒ…æ‹¬æˆåŠŸæˆ–é”™è¯¯çš„çŠ¶æ€ä»£ç ã€æ¶ˆæ¯å’Œæ•°æ®ã€‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-variable">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResultUtil</span> &#123;<br>    <span class="hljs-comment">// å¸¸é‡å®šä¹‰</span><br>    <span class="hljs-variable">final</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-variable">CODE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;code&quot;</span>;<br>    <span class="hljs-variable">final</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-variable">SUCCESS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;success&quot;</span>;<br>    <span class="hljs-variable">final</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-variable">ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;error&quot;</span>;<br>    <span class="hljs-variable">final</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-variable">DATA</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;data&quot;</span>;<br>    <span class="hljs-variable">final</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-variable">MESSAGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;message&quot;</span>;<br>    <span class="hljs-variable">final</span> <span class="hljs-keyword">static</span> int <span class="hljs-variable">NUM_TWO</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-variable">final</span> <span class="hljs-keyword">static</span> int <span class="hljs-variable">NUM_THREE</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”ŸæˆåŒ…å«çŠ¶æ€ç å’Œæ•°æ®çš„å“åº”ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code çŠ¶æ€ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">result</span>(<span class="hljs-params">Object</span> <span class="hljs-params">code</span>, <span class="hljs-params">Object</span> <span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">resultWithData</span>(<span class="hljs-variable">code</span>, <span class="hljs-variable">data</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”ŸæˆåªåŒ…å«æ•°æ®çš„å“åº”ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code çŠ¶æ€ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">resultWithData</span>(<span class="hljs-params">Object</span> <span class="hljs-params">code</span>, <span class="hljs-params">Object</span> <span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-title class_">Map</span><span class="hljs-operator">&lt;</span><span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">HashMap</span><span class="hljs-operator">&lt;</span><span class="hljs-operator">&gt;</span>(<span class="hljs-variable">NUM_TWO</span>);<br>        <span class="hljs-variable">map</span>.<span class="hljs-property">put</span>(<span class="hljs-variable">CODE</span>, <span class="hljs-variable">code</span>);<br>        <span class="hljs-variable">map</span>.<span class="hljs-property">put</span>(<span class="hljs-variable">DATA</span>, <span class="hljs-variable">data</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JsonUtils</span>.<span class="hljs-property">objectToJson</span>(<span class="hljs-variable">map</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”ŸæˆåªåŒ…å«æ¶ˆæ¯çš„å“åº”ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code çŠ¶æ€ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message æ¶ˆæ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">resultWithMessage</span>(<span class="hljs-params">Object</span> <span class="hljs-params">code</span>, <span class="hljs-params">String</span> <span class="hljs-params">message</span>) &#123;<br>        <span class="hljs-title class_">Map</span><span class="hljs-operator">&lt;</span><span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">HashMap</span><span class="hljs-operator">&lt;</span><span class="hljs-operator">&gt;</span>(<span class="hljs-variable">NUM_TWO</span>);<br>        <span class="hljs-variable">map</span>.<span class="hljs-property">put</span>(<span class="hljs-variable">CODE</span>, <span class="hljs-variable">code</span>);<br>        <span class="hljs-variable">map</span>.<span class="hljs-property">put</span>(<span class="hljs-variable">MESSAGE</span>, <span class="hljs-variable">message</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JsonUtils</span>.<span class="hljs-property">objectToJson</span>(<span class="hljs-variable">map</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”ŸæˆåŒæ—¶åŒ…å«æ•°æ®å’Œæ¶ˆæ¯çš„å“åº”ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code çŠ¶æ€ç </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message æ¶ˆæ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">resultWithDataAndMessage</span>(<span class="hljs-params">Object</span> <span class="hljs-params">code</span>, <span class="hljs-params">Object</span> <span class="hljs-params">data</span>, <span class="hljs-params">String</span> <span class="hljs-params">message</span>) &#123;<br>        <span class="hljs-title class_">Map</span><span class="hljs-operator">&lt;</span><span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">HashMap</span><span class="hljs-operator">&lt;</span><span class="hljs-operator">&gt;</span>(<span class="hljs-variable">NUM_THREE</span>);<br>        <span class="hljs-variable">map</span>.<span class="hljs-property">put</span>(<span class="hljs-variable">CODE</span>, <span class="hljs-variable">code</span>);<br>        <span class="hljs-variable">map</span>.<span class="hljs-property">put</span>(<span class="hljs-variable">DATA</span>, <span class="hljs-variable">data</span>);<br>        <span class="hljs-variable">map</span>.<span class="hljs-property">put</span>(<span class="hljs-variable">MESSAGE</span>, <span class="hljs-variable">message</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JsonUtils</span>.<span class="hljs-property">objectToJson</span>(<span class="hljs-variable">map</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”Ÿæˆè¡¨ç¤ºæ“ä½œæˆåŠŸçš„å“åº”ï¼ŒåªåŒ…å«æ•°æ®ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">successWithData</span>(<span class="hljs-params">Object</span> <span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">resultWithData</span>(<span class="hljs-variable">SUCCESS</span>, <span class="hljs-variable">data</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”Ÿæˆè¡¨ç¤ºæ“ä½œæˆåŠŸçš„å“åº”ï¼ŒåªåŒ…å«æ¶ˆæ¯ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message æ¶ˆæ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">successWithMessage</span>(<span class="hljs-params">String</span> <span class="hljs-params">message</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">resultWithMessage</span>(<span class="hljs-variable">SUCCESS</span>, <span class="hljs-variable">message</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”Ÿæˆè¡¨ç¤ºæ“ä½œæˆåŠŸçš„å“åº”ï¼ŒåŒæ—¶åŒ…å«æ•°æ®å’Œæ¶ˆæ¯ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message æ¶ˆæ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">successWithDataAndMessage</span>(<span class="hljs-params">Object</span> <span class="hljs-params">data</span>, <span class="hljs-params">String</span> <span class="hljs-params">message</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">resultWithDataAndMessage</span>(<span class="hljs-variable">SUCCESS</span>, <span class="hljs-variable">data</span>, <span class="hljs-variable">message</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”Ÿæˆè¡¨ç¤ºæ“ä½œå¤±è´¥çš„å“åº”ï¼ŒåªåŒ…å«æ¶ˆæ¯ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> message æ¶ˆæ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">errorWithMessage</span>(<span class="hljs-params">String</span> <span class="hljs-params">message</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">resultWithMessage</span>(<span class="hljs-variable">ERROR</span>, <span class="hljs-variable">message</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”Ÿæˆè¡¨ç¤ºæ“ä½œå¤±è´¥çš„å“åº”ï¼ŒåªåŒ…å«æ•°æ®ã€‚</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> data æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">errorWithData</span>(<span class="hljs-params">Object</span> <span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">resultWithData</span>(<span class="hljs-variable">ERROR</span>, <span class="hljs-variable">data</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>ResultUtil</code> æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç”¨äºåˆ›å»ºå’Œæ ¼å¼åŒ–APIå“åº”ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—é™æ€æ–¹æ³•æ¥ç”Ÿæˆæ ‡å‡†åŒ–çš„JSONå­—ç¬¦ä¸²å“åº”ã€‚è¿™äº›æ–¹æ³•å…è®¸åŒ…å«å„ç§ç±»å‹çš„ä¿¡æ¯ï¼Œå¦‚çŠ¶æ€ç ã€æ•°æ®ã€æ¶ˆæ¯ç­‰ã€‚</p><blockquote><p>ç±»çš„ä½œç”¨</p></blockquote><ol><li><strong>ç»Ÿä¸€APIå“åº”æ ¼å¼</strong>:<ul><li><code>ResultUtil</code> ç±»ç”¨äºç”Ÿæˆå…·æœ‰ä¸€è‡´æ ¼å¼çš„APIå“åº”ã€‚è¿™æœ‰åŠ©äºå‰ç«¯å¼€å‘è€…ç†è§£å’Œå¤„ç†åç«¯å‘é€çš„æ•°æ®ã€‚</li></ul></li><li><strong>çµæ´»çš„å“åº”æ„å»º</strong>:<ul><li>æä¾›äº†å¤šç§æ–¹æ³•æ¥æ„å»ºå“åº”ï¼Œå¯ä»¥åªåŒ…å«æ•°æ®ã€åªåŒ…å«æ¶ˆæ¯æˆ–åŒæ—¶åŒ…å«æ•°æ®å’Œæ¶ˆæ¯ã€‚</li></ul></li></ol><blockquote><p>æ–¹æ³•è¯´æ˜</p></blockquote><ul><li><code>result(Object code, Object data)</code>: ç”ŸæˆåŒ…å«æŒ‡å®šä»£ç å’Œæ•°æ®çš„å“åº”ã€‚</li><li><code>resultWithData(Object code, Object data)</code>: ç”ŸæˆåªåŒ…å«æ•°æ®çš„å“åº”ã€‚</li><li><code>resultWithMessage(Object code, String message)</code>: ç”ŸæˆåªåŒ…å«æ¶ˆæ¯çš„å“åº”ã€‚</li><li><code>resultWithDataAndMessage(Object code, Object data, String message)</code>: ç”ŸæˆåŒæ—¶åŒ…å«æ•°æ®å’Œæ¶ˆæ¯çš„å“åº”ã€‚</li><li><code>successWithData(Object data)</code>: ç”Ÿæˆè¡¨ç¤ºæ“ä½œæˆåŠŸçš„å“åº”ï¼ŒåªåŒ…å«æ•°æ®ã€‚</li><li><code>successWithMessage(String message)</code>: ç”Ÿæˆè¡¨ç¤ºæ“ä½œæˆåŠŸçš„å“åº”ï¼ŒåªåŒ…å«æ¶ˆæ¯ã€‚</li><li><code>successWithDataAndMessage(Object data, String message)</code>: ç”Ÿæˆè¡¨ç¤ºæ“ä½œæˆåŠŸçš„å“åº”ï¼ŒåŒ…å«æ•°æ®å’Œæ¶ˆæ¯ã€‚</li><li><code>errorWithMessage(String message)</code>: ç”Ÿæˆè¡¨ç¤ºæ“ä½œå¤±è´¥çš„å“åº”ï¼ŒåªåŒ…å«æ¶ˆæ¯ã€‚</li><li><code>errorWithData(Object data)</code>: ç”Ÿæˆè¡¨ç¤ºæ“ä½œå¤±è´¥çš„å“åº”ï¼ŒåªåŒ…å«æ•°æ®ã€‚</li></ul><blockquote><p>ä½¿ç”¨ç¤ºä¾‹</p></blockquote><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs abnf">// è¿”å›æˆåŠŸå“åº”ï¼ŒåªåŒ…å«æ•°æ®<br>String response <span class="hljs-operator">=</span> ResultUtil.successWithData(someData)<span class="hljs-comment">;</span><br><br>// è¿”å›å¤±è´¥å“åº”ï¼ŒåªåŒ…å«é”™è¯¯æ¶ˆæ¯<br>String errorResponse <span class="hljs-operator">=</span> ResultUtil.errorWithMessage(<span class="hljs-string">&quot;An error occurred&quot;</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç±»åœ¨å®é™…çš„APIå¼€å‘ä¸­éå¸¸æœ‰ç”¨ï¼Œå®ƒå¯ä»¥ç®€åŒ–å“åº”çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå¹¶ç¡®ä¿APIçš„è¿”å›æ ¼å¼ç»Ÿä¸€å’Œæ ‡å‡†åŒ–ã€‚</p><p>å¯¹äºç»´æŠ¤APIçš„ä¸€è‡´æ€§å’Œå¯ç”¨æ€§éå¸¸é‡è¦ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—_åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2023/12/11/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2023/12/11/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Start</p></blockquote><p>åœ¨é¢è¯•çš„æ—¶å€™ï¼Œå½“ä½ çš„ç®€å†ä¸Šé¢å†™äº†ç”¨è¿‡<code>MQ</code> ,é‚£ä¹ˆé¢è¯•å®˜çš„é¢è¯•è¿™ä¸ªæ—¶å€™ä¾¿å¼€å§‹äº†ï¼š</p><ul><li><ol><li>ä½ åœ¨ç³»ç»Ÿé‡Œç”¨è¿‡æ¶ˆæ¯é˜Ÿåˆ—å—</li></ol></li><li><ol start="2"><li>ä½ ä»¬åœ¨é¡¹ç›®é‡Œæ˜¯å¦‚ä½•ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„ã€‚</li></ol></li><li><ol start="3"><li>ä¸ºä»€ä¹ˆä½ ä»¬è¿™é‡Œè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å‘¢ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥è°ƒç”¨æ¥å£å¤„ç†å‘¢ã€‚</li></ol></li><li><ol start="4"><li>è¯´è¯´æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç‚¹å’Œç¼ºç‚¹å§ã€‚</li></ol></li><li><ol start="5"><li>æ¶ˆæ¯é˜Ÿåˆ—çš„é€‰å‹ï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚</li></ol></li><li><ol start="6"><li>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆæ¯ï¼Œå¦‚ä½•ä¿è¯æ¶ˆè´¹çš„æ—¶å€™æ˜¯å¹‚ç­‰ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚</li></ol></li><li><ol start="7"><li>å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶ä»¥åŠè¿‡æœŸå¤±æ•ˆé—®é¢˜ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†ä»¥åè¯¥å¦‚ä½•å¤„ç†ï¼Ÿæœ‰å‡ ç™¾ä¸‡æ¶ˆæ¯æŒç»­å †ç§¯å‡ å°æ—¶ï¼Œè¦æ€ä¹ˆè§£å†³ï¼Ÿ</li></ol></li><li><ol start="8"><li>è®©ä½ å»è®¾è®¡ä¸€ä¸ªMQï¼Œè¯¥å¦‚ä½•è¿›è¡Œæ¶æ„è®¾è®¡ï¼Œè¯´ä¸€ä¸‹ä½ çš„æ€è·¯ã€‚</li></ol></li></ul><p>å‰å‡ ä¸ªé—®é¢˜çš„æ€è€ƒä¸»è¦æ˜¯å›´ç»•ï¼šä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼›</p><p>é™ˆè¿°å›ç­”çš„æ—¶å€™éœ€è¦ä»æ¶ˆæ¯é˜Ÿåˆ—åˆ©å¼Šã€ä¼˜ç¼ºç‚¹ã€é£é™©ç‚¹ç­‰æ–¹é¢è€ƒè™‘ï¼Œåœ¨è¿›è¡ŒæŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œä¸»è¦è¿˜æ˜¯å›´ç»•ä½¿ç”¨åœºæ™¯æ¥å†³å®šã€‚</p><div style="box-shadow: 2px 2px 5px #888888; padding: 10px; border: 1px solid #3271ae;">    æ¯ä¸€ä¸ª MQÂ æ²¡æœ‰ç»å¯¹çš„å¥½åï¼Œä½†æ˜¯è¦çœ‹ç”¨åœ¨å“ªä¸ªåœºæ™¯å¯ä»¥æ‰¬é•¿é¿çŸ­ï¼Œåˆ©ç”¨å…¶ä¼˜åŠ¿ï¼Œè§„é¿å…¶åŠ£åŠ¿ã€‚</div><h3 id="ä¸€ã€MQ-æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€MQ-æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€MQ  æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€MQ  æ˜¯ä»€ä¹ˆ</h3><h4 id="1ã€æ¶ˆæ¯é˜Ÿåˆ—çš„æ ¸å¿ƒä½¿ç”¨åœºæ™¯"><a href="#1ã€æ¶ˆæ¯é˜Ÿåˆ—çš„æ ¸å¿ƒä½¿ç”¨åœºæ™¯" class="headerlink" title="1ã€æ¶ˆæ¯é˜Ÿåˆ—çš„æ ¸å¿ƒä½¿ç”¨åœºæ™¯"></a>1ã€æ¶ˆæ¯é˜Ÿåˆ—çš„æ ¸å¿ƒä½¿ç”¨åœºæ™¯</h4><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰çš„æ ¸å¿ƒä½¿ç”¨åœºæ™¯ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢ï¼šè§£è€¦ã€å¼‚æ­¥å¤„ç†å’Œå‰Šå³°ã€‚</p><h5 id="è§£è€¦"><a href="#è§£è€¦" class="headerlink" title="è§£è€¦"></a>è§£è€¦</h5><p><strong>ç±»æ¯”è§£é‡Š</strong></p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨ç»„ç»‡ä¸€ä¸ªå¤§å‹æ´¾å¯¹ï¼Œä½ éœ€è¦é€šçŸ¥å¾ˆå¤šæœ‹å‹ã€‚å¦‚æœä½ ç›´æ¥ä¸€ä¸ªä¸ªæ‰“ç”µè¯ï¼Œæ¯å½“æ–°æœ‹å‹åŠ å…¥æˆ–æŸäººé€€å‡ºï¼Œä½ éƒ½éœ€è¦æ›´æ–°ä½ çš„é€šçŸ¥åˆ—è¡¨ã€‚è¿™å¾ˆéº»çƒ¦ï¼Œå¯¹å§ï¼Ÿ</p><p>ç°åœ¨ï¼Œå‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªåœ¨çº¿æ´»åŠ¨é¡µé¢ï¼Œä½ åªéœ€è¦æ›´æ–°è¿™ä¸ªé¡µé¢ï¼Œè€Œä½ çš„æœ‹å‹ä»¬è‡ªå·±å†³å®šæ˜¯å¦æŸ¥çœ‹è¿™ä¸ªé¡µé¢ã€‚è¿™å°±å¤§å¤§ç®€åŒ–äº†ä½ çš„å·¥ä½œã€‚</p><p><strong>æŠ€æœ¯è§£é‡Š</strong></p><p>åœ¨æ²¡æœ‰æ¶ˆæ¯é˜Ÿåˆ—çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿ A éœ€è¦ç›´æ¥å’Œå¤šä¸ªç³»ç»Ÿï¼ˆå¦‚ Bã€Cã€Dã€Eï¼‰è¿›è¡Œé€šä¿¡ã€‚è¿™ç§ç´§å¯†è€¦åˆçš„æ–¹å¼ä½¿å¾—ç³»ç»Ÿ A éœ€è¦ä¸æ–­æ›´æ–°ä¸å…¶ä»–ç³»ç»Ÿçš„äº¤äº’é€»è¾‘ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åï¼Œç³»ç»Ÿ A åªéœ€å°†æ¶ˆæ¯å‘å¸ƒåˆ°é˜Ÿåˆ—ï¼Œè€Œå…¶ä»–ç³»ç»Ÿæ ¹æ®éœ€è¦ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ã€‚</p><p>è¿™ç§å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼ï¼ˆPub&#x2F;Subï¼‰ä½¿å¾—ç³»ç»Ÿ A ä¸å…¶ä»–ç³»ç»Ÿè§£è€¦ï¼Œç®€åŒ–äº†ç»´æŠ¤å’Œæ‰©å±•çš„å¤æ‚æ€§ã€‚</p><hr><p>å‚è€ƒ2ï¼šè§£è€¦å¯ä»¥ç†è§£ä¸ºå°†æŸä¸ªå¤æ‚çš„æœåŠ¡æ“ä½œï¼Œäº¤æ¥ä¸‹æ¸¸å»å¤„ç†ã€‚ï¼ˆæœåŠ¡è°ƒç”¨é“¾ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307221536.png" alt="image.png"></p><h5 id="å¼‚æ­¥å¤„ç†"><a href="#å¼‚æ­¥å¤„ç†" class="headerlink" title="å¼‚æ­¥å¤„ç†"></a>å¼‚æ­¥å¤„ç†</h5><p><strong>ç±»æ¯”è§£é‡Š</strong></p><p>å‡è®¾ä½ åœ¨ä¸€å®¶é¤å…ç‚¹é¤ã€‚å¦‚æœå¨å¸ˆéœ€è¦ç­‰å¾…ä¸€ä¸ªèœåšå®Œæ‰å¼€å§‹åšä¸‹ä¸€ä¸ªï¼Œè¿™å°†éå¸¸ä½æ•ˆã€‚ä½†å¦‚æœä»–ä»¬èƒ½åŒæ—¶å¤„ç†å¤šä¸ªè®¢å•ï¼Œæ¯é“èœå®Œæˆæ—¶å°±ç›´æ¥ä¸Šèœï¼Œè¿™æ ·æ•ˆç‡ä¼šæ›´é«˜ã€‚</p><p><strong>æŠ€æœ¯è§£é‡Š</strong></p><p>åœ¨åŒæ­¥å¤„ç†æ¨¡å¼ä¸­ï¼Œç³»ç»Ÿ A åœ¨å®Œæˆæ‰€æœ‰æ“ä½œï¼ˆå¦‚æ›´æ–°å¤šä¸ªæ•°æ®åº“ï¼‰ä¹‹å‰ä¸ä¼šå“åº”ç”¨æˆ·è¯·æ±‚ï¼Œå¯¼è‡´å»¶è¿Ÿã€‚<br>è€Œå¼‚æ­¥å¤„ç†ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç³»ç»Ÿ A å¯ä»¥å¿«é€Ÿå“åº”ç”¨æˆ·è¯·æ±‚ï¼Œå°†åç»­ä»»åŠ¡ï¼ˆå¦‚æ•°æ®åº“æ›´æ–°ï¼‰æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç”±å…¶ä»–ç³»ç»Ÿæˆ–æœåŠ¡æ…¢æ…¢å¤„ç†ã€‚è¿™å‡å°‘äº†ç”¨æˆ·çš„ç­‰å¾…æ—¶é—´ï¼Œæé«˜äº†ç³»ç»Ÿçš„å“åº”èƒ½åŠ›ã€‚</p><p>å‚è€ƒ2ï¼šåŠ å¿«å“åº”ï¼Œå¼‚æ­¥å¤„ç†</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307221735.png" alt="image.png"></p><h5 id="å‰Šå³°"><a href="#å‰Šå³°" class="headerlink" title="å‰Šå³°"></a>å‰Šå³°</h5><p><strong>ç±»æ¯”è§£é‡Š</strong></p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªå…¬äº¤è½¦ç«™åœ¨é«˜å³°æ—¶æ®µé¢ä¸´å¤§é‡ä¹˜å®¢ã€‚å¦‚æœæ¯ä¸ªäººéƒ½ç«‹å³ä¸Šè½¦ï¼Œå…¬äº¤è½¦ä¼šè¢«è¿…é€Ÿå¡æ»¡ã€‚ä½†å¦‚æœæœ‰ä¸€ä¸ªç­‰å€™åŒºï¼Œè®©ä¹˜å®¢æŒ‰é¡ºåºä¸Šè½¦ï¼Œè¿™æ ·æ—¢ä¿æŒäº†å…¬äº¤è½¦çš„æ­£å¸¸è¿è¡Œï¼Œåˆé¿å…äº†æ‹¥æŒ¤ã€‚</p><p><strong>æŠ€æœ¯è§£é‡Š</strong></p><p>åœ¨æµé‡å‰Šå³°åœºæ™¯ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å……å½“ç¼“å†²åŒºï¼Œå¸®åŠ©å¤„ç†çŸ­æ—¶çš„é«˜æµé‡ã€‚å½“ç³»ç»Ÿ A åœ¨é«˜å³°æ—¶æ®µé¢ä¸´å¤§é‡è¯·æ±‚æ—¶ï¼Œè¿™äº›è¯·æ±‚é¦–å…ˆè¢«æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚<br>ç³»ç»Ÿ A æ ¹æ®è‡ªå·±çš„å¤„ç†èƒ½åŠ›é€æ¸ä»é˜Ÿåˆ—ä¸­å–å‡ºå¹¶å¤„ç†è¿™äº›è¯·æ±‚ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨é«˜å³°æœŸå¯¹ç³»ç»Ÿé€ æˆè¿‡å¤§çš„å‹åŠ›ï¼ŒåŒæ—¶ä¿è¯äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚</p><p>ä¸Šé¢æåŠåˆ°çš„å‰Šå³°ã€è§£è€¦ã€å¼‚æ­¥å°±æ˜¯<strong>åœ¨ç‰¹æ®Šåœºæ™¯ä¸‹å…¶å¯¹åº”çš„å¥½å¤„</strong>ï¼Œè€Œç¼ºç‚¹å¯¹åº”çš„æ˜¯ç³»ç»Ÿçš„å¤æ‚æ€§å˜é«˜ï¼Œå¯ç”¨æ€§é™ä½ï¼Œä»¥åŠè¿˜æœ‰ä¸€è‡´æ€§é—®é¢˜ã€‚</p><p>å‚è€ƒ2ï¼šï¼ˆæµé‡é€Ÿç‡ç¼“å†²ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240307221812.png" alt="image.png"></p><blockquote><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¼šå¸¦æ¥å“ªäº›é—®é¢˜ï¼Ÿ</p></blockquote><ul><li><strong>ç³»ç»Ÿå¯ç”¨æ€§é™ä½ï¼š</strong> ç³»ç»Ÿå¯ç”¨æ€§åœ¨æŸç§ç¨‹åº¦ä¸Šé™ä½ï¼Œä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢ï¼Ÿåœ¨åŠ å…¥ MQ ä¹‹å‰ï¼Œä½ ä¸ç”¨è€ƒè™‘æ¶ˆæ¯ä¸¢å¤±æˆ–è€…è¯´ MQ æŒ‚æ‰ç­‰ç­‰çš„æƒ…å†µï¼Œä½†æ˜¯ï¼Œå¼•å…¥ MQ ä¹‹åä½ å°±éœ€è¦å»è€ƒè™‘äº†ï¼</li><li><strong>ç³»ç»Ÿå¤æ‚æ€§æé«˜ï¼š</strong> åŠ å…¥ MQ ä¹‹åï¼Œéœ€è¦ä¿è¯æ¶ˆæ¯æ²¡æœ‰è¢«é‡å¤æ¶ˆè´¹ã€å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€ä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ç­‰ç­‰é—®é¢˜ï¼</li><li><strong>ä¸€è‡´æ€§é—®é¢˜ï¼š</strong> æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å®ç°å¼‚æ­¥ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¸¦æ¥çš„å¼‚æ­¥ç¡®å®å¯ä»¥æé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œä¸‡ä¸€æ¶ˆæ¯çš„çœŸæ­£æ¶ˆè´¹è€…å¹¶æ²¡æœ‰æ­£ç¡®æ¶ˆè´¹æ¶ˆæ¯æ€ä¹ˆåŠï¼Ÿè¿™æ ·å°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ</li></ul><h4 id="2ã€æŠ€æœ¯é€‰å‹"><a href="#2ã€æŠ€æœ¯é€‰å‹" class="headerlink" title="2ã€æŠ€æœ¯é€‰å‹"></a>2ã€æŠ€æœ¯é€‰å‹</h4><p>æŠ€æœ¯é€‰å‹å¯ä»¥å‚è€ƒçœ‹ä¸€ä¸‹ä¸‹é¢çš„å†…å®¹</p><table><thead><tr><th>ç‰¹æ€§</th><th>ActiveMQ</th><th>RabbitMQ</th><th>RocketMQ</th><th>Kafka</th></tr></thead><tbody><tr><td>å•æœºååé‡</td><td>ä¸‡çº§ï¼Œæ¯” RocketMQã€Kafka ä½ä¸€ä¸ªæ•°é‡çº§</td><td>åŒ ActiveMQ</td><td>10 ä¸‡çº§ï¼Œæ”¯æ’‘é«˜åå</td><td>10 ä¸‡çº§ï¼Œé«˜ååï¼Œä¸€èˆ¬é…åˆå¤§æ•°æ®ç±»çš„ç³»ç»Ÿæ¥è¿›è¡Œå®æ—¶æ•°æ®è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯</td></tr><tr><td>topic æ•°é‡å¯¹ååé‡çš„å½±å“</td><td></td><td></td><td>topic å¯ä»¥è¾¾åˆ°å‡ ç™¾&#x2F;å‡ åƒçš„çº§åˆ«ï¼Œååé‡ä¼šæœ‰è¾ƒå°å¹…åº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ RocketMQ çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼Œå¯ä»¥æ”¯æ’‘å¤§é‡çš„ topic</td><td>topic ä»å‡ ååˆ°å‡ ç™¾ä¸ªæ—¶å€™ï¼Œååé‡ä¼šå¤§å¹…åº¦ä¸‹é™ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼ŒKafka å°½é‡ä¿è¯ topic æ•°é‡ä¸è¦è¿‡å¤šï¼Œå¦‚æœè¦æ”¯æ’‘å¤§è§„æ¨¡çš„ topicï¼Œéœ€è¦å¢åŠ æ›´å¤šçš„æœºå™¨èµ„æº</td></tr><tr><td>æ—¶æ•ˆæ€§</td><td>ms çº§</td><td>å¾®ç§’çº§ï¼Œè¿™æ˜¯ RabbitMQ çš„ä¸€å¤§ç‰¹ç‚¹ï¼Œå»¶è¿Ÿæœ€ä½</td><td>ms çº§</td><td>å»¶è¿Ÿåœ¨ ms çº§ä»¥å†…</td></tr><tr><td>å¯ç”¨æ€§</td><td>é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨</td><td>åŒ ActiveMQ</td><td>éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼æ¶æ„</td><td>éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨</td></tr><tr><td>æ¶ˆæ¯å¯é æ€§</td><td>æœ‰è¾ƒä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®</td><td>åŸºæœ¬ä¸ä¸¢</td><td>ç»è¿‡å‚æ•°ä¼˜åŒ–é…ç½®ï¼Œå¯ä»¥åšåˆ° 0 ä¸¢å¤±</td><td>åŒ RocketMQ</td></tr><tr><td>åŠŸèƒ½æ”¯æŒ</td><td>MQ é¢†åŸŸçš„åŠŸèƒ½æå…¶å®Œå¤‡</td><td>åŸºäº erlang å¼€å‘ï¼Œå¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå¥½ï¼Œå»¶æ—¶å¾ˆä½</td><td>MQ åŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½</td><td>åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„ MQ åŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨</td></tr></tbody></table><blockquote><p>Kafka</p></blockquote><p>ä¼˜ç‚¹</p><ol><li><strong>é«˜ååé‡</strong>ï¼šKafka è®¾è®¡ç”¨äºå¤„ç†é«˜ååé‡æ•°æ®ï¼Œé€‚åˆå¤§è§„æ¨¡æ¶ˆæ¯å¤„ç†åº”ç”¨ã€‚</li><li><strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>ï¼šå®ƒå¤©ç”Ÿå°±æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ˜“äºæ‰©å±•ã€‚</li><li><strong>æŒä¹…æ€§å’Œå¯é æ€§</strong>ï¼šKafka å¯ä»¥æŒä¹…åŒ–æ¶ˆæ¯åˆ°ç£ç›˜ï¼Œå› æ­¤å¯¹æ¶ˆæ¯ä¸ä¼šå› ä¸ºç³»ç»Ÿæ•…éšœè€Œä¸¢å¤±ã€‚</li><li><strong>é«˜æ•ˆ</strong>ï¼šKafka ä½¿ç”¨é¡ºåºç£ç›˜I&#x2F;Oï¼Œæä¾›é«˜æ€§èƒ½ä¸æ•°æ®ååã€‚</li></ol><p>ç¼ºç‚¹</p><ol><li><strong>å¤æ‚æ€§</strong>ï¼šKafka çš„è®¾ç½®å’Œç®¡ç†ç›¸å¯¹å¤æ‚ã€‚</li><li><strong>æ¶ˆæ¯ç§¯å‹</strong>ï¼šåœ¨é«˜è´Ÿè½½ä¸‹ï¼Œæ¶ˆæ¯å»¶è¿Ÿå¯èƒ½ä¼šå¢åŠ ã€‚</li><li><strong>ä¸æ”¯æŒä¼˜å…ˆçº§é˜Ÿåˆ—</strong>ã€‚</li></ol><blockquote><p>ActiveMQ</p></blockquote><p>ä¼˜ç‚¹</p><ol><li><strong>æ”¯æŒå¤šç§ä¼ è¾“åè®®</strong>ï¼šå¦‚ OpenWire, STOMP, MQTT ç­‰ã€‚</li><li><strong>æ˜“äºä½¿ç”¨å’Œé…ç½®</strong>ï¼šç›¸æ¯” Kafkaï¼ŒActiveMQ é…ç½®å’Œç®¡ç†è¾ƒä¸ºç®€å•ã€‚</li><li><strong>JMS æ”¯æŒ</strong>ï¼šå®Œå…¨æ”¯æŒ JMS API å’Œ J2EE é›†æˆã€‚</li></ol><p>ç¼ºç‚¹</p><ol><li><strong>è¾ƒä½çš„ååé‡</strong>ï¼šç›¸æ¯” Kafkaï¼ŒActiveMQ çš„ååé‡è¾ƒä½ã€‚</li><li><strong>å¯æ‰©å±•æ€§é—®é¢˜</strong>ï¼šåœ¨éå¸¸å¤§çš„æ•°æ®è´Ÿè½½ä¸‹ï¼Œæ‰©å±•æ€§å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</li></ol><blockquote><p>RabbitMQ</p></blockquote><p>ä¼˜ç‚¹</p><ol><li><strong>çµæ´»çš„è·¯ç”±</strong>ï¼šæ”¯æŒå¤æ‚çš„è·¯ç”±ã€‚</li><li><strong>å¤šç§æ¶ˆæ¯åè®®</strong>ï¼šæ”¯æŒ AMQP, MQTT, STOMP ç­‰ã€‚</li><li><strong>ç®¡ç†ç•Œé¢å‹å¥½</strong>ï¼šæä¾›æ˜“äºä½¿ç”¨çš„ç®¡ç†ç•Œé¢ã€‚</li></ol><p>ç¼ºç‚¹</p><ol><li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šåœ¨é«˜ååé‡æ—¶ï¼Œæ€§èƒ½å¯èƒ½ä¼šå—é™ã€‚</li><li><strong>æŒä¹…åŒ–å¼€é”€</strong>ï¼šæ¶ˆæ¯æŒä¹…åŒ–å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</li></ol><blockquote><p>RocketMQ</p></blockquote><p>ä¼˜ç‚¹</p><ol><li><strong>é«˜æ€§èƒ½å’Œä½å»¶è¿Ÿ</strong>ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¡¨ç°å‡ºè‰²ã€‚</li><li><strong>ä¸°å¯Œçš„åŠŸèƒ½</strong>ï¼šæä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼Œå¦‚æ¶ˆæ¯é¡ºåºã€äº‹åŠ¡æ¶ˆæ¯ç­‰ã€‚</li><li><strong>å¯é æ€§å’Œæ‰©å±•æ€§</strong>ï¼šä¿è¯äº†æ¶ˆæ¯çš„å¯é ä¼ è¾“ï¼ŒåŒæ—¶æ”¯æŒæ°´å¹³å’Œå‚ç›´æ‰©å±•ã€‚</li></ol><p>ç¼ºç‚¹</p><ol><li><strong>ç¤¾åŒºå’Œç”Ÿæ€</strong>ï¼šç›¸æ¯” Kafkaï¼ŒRocketMQ çš„ç¤¾åŒºå’Œç”Ÿæ€ç›¸å¯¹è¾ƒå°ã€‚</li><li><strong>å¤æ‚æ€§</strong>ï¼šé…ç½®å’Œç®¡ç†ç¨å¾®å¤æ‚ã€‚</li></ol><blockquote><p>æŠ€æœ¯é€‰å‹è€ƒè™‘å› ç´ </p></blockquote><ol><li><strong>ååé‡éœ€æ±‚</strong>ï¼šå¦‚æœä½ çš„ç³»ç»Ÿéœ€è¦å¤„ç†å¤§é‡çš„æ•°æ®ï¼ŒKafka æˆ– RocketMQ å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</li><li><strong>ç³»ç»Ÿå¤æ‚æ€§</strong>ï¼šå¦‚æœä½ éœ€è¦ä¸€ä¸ªæ˜“äºè®¾ç½®å’Œç®¡ç†çš„ç³»ç»Ÿï¼ŒActiveMQ æˆ– RabbitMQ å¯èƒ½æ›´åˆé€‚ã€‚</li><li><strong>åŠŸèƒ½éœ€æ±‚</strong>ï¼šæ ¹æ®ä½ éœ€è¦çš„ç‰¹å®šåŠŸèƒ½ï¼ˆå¦‚æ¶ˆæ¯æ’åºã€äº‹åŠ¡å¤„ç†ç­‰ï¼‰é€‰æ‹©ç›¸åº”çš„ç³»ç»Ÿã€‚</li><li><strong>ç¤¾åŒºæ”¯æŒå’Œç”Ÿæ€ç³»ç»Ÿ</strong>ï¼šå¼ºå¤§çš„ç¤¾åŒºå¯ä»¥æä¾›æ›´å¥½çš„æ”¯æŒå’Œæ›´å¤šçš„èµ„æºã€‚</li><li><strong>å¯é æ€§å’ŒæŒä¹…æ€§</strong>ï¼šå¦‚æœè¿™äº›æ˜¯ä½ çš„ä¸»è¦å…³æ³¨ç‚¹ï¼ŒKafka å’Œ RocketMQ æ˜¯ä¸é”™çš„é€‰æ‹©</li></ol><p>é€‰æ‹©å»ºè®®ï¼š</p><ul><li><strong>ä¸­å°å‹å…¬å¸</strong>ï¼ŒæŠ€æœ¯å®åŠ›è¾ƒä¸ºä¸€èˆ¬ï¼ŒæŠ€æœ¯æŒ‘æˆ˜ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œç”¨ RabbitMQ æ˜¯ä¸é”™çš„é€‰æ‹©ï¼›</li><li><strong>å¤§å‹å…¬å¸</strong>ï¼ŒåŸºç¡€æ¶æ„ç ”å‘å®åŠ›è¾ƒå¼ºï¼Œç”¨ RocketMQ æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</li><li>å¦‚æœæ˜¯<strong>å¤§æ•°æ®é¢†åŸŸ</strong>çš„å®æ—¶è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯ï¼ŒKafka æ˜¯ä¸šå†…æ ‡å‡†ï¼Œç¤¾åŒºæ´»è·ƒåº¦å¾ˆé«˜ï¼Œå‡ ä¹æ˜¯å…¨ä¸–ç•Œè¯¥é¢†åŸŸçš„äº‹å®æ€§è§„èŒƒã€‚</li><li>ActiveMQï¼Œæœ€è¿‘é€å¹´ä½¿ç”¨å‡å°‘ï¼Œæ²¡ç»è¿‡å¤§è§„æ¨¡ååé‡åœºæ™¯çš„éªŒè¯ï¼Œç¤¾åŒºä¸æ˜¯å¾ˆæ´»è·ƒã€‚</li></ul><h3 id="äºŒã€åŸºç¡€æ¦‚å¿µ"><a href="#äºŒã€åŸºç¡€æ¦‚å¿µ" class="headerlink" title="äºŒã€åŸºç¡€æ¦‚å¿µ"></a>äºŒã€åŸºç¡€æ¦‚å¿µ</h3><p>é’ˆå¯¹ä¸€äº›æ¶ˆæ¯ä¸­é—´ä»¶ç›¸å…³çš„æ¦‚å¿µè¿›è¡Œé˜è¿°è¯´æ˜ã€‚</p><h4 id="JMSå’ŒAMQP"><a href="#JMSå’ŒAMQP" class="headerlink" title="JMSå’ŒAMQP"></a>JMSå’ŒAMQP</h4><p>JMSï¼ˆJava Message Serviceï¼‰å’Œ AMQPï¼ˆAdvanced Message Queuing Protocolï¼‰éƒ½æ˜¯æ¶ˆæ¯ä¼ é€’çš„æ ‡å‡†å’Œè§„èŒƒï¼Œä½†å®ƒä»¬åœ¨è®¾è®¡ç†å¿µã€å®ç°æ–¹å¼å’Œä½¿ç”¨åœºæ™¯ä¸Šæœ‰æ‰€ä¸åŒ</p><blockquote><p>JMSï¼ˆJava Message Serviceï¼‰</p></blockquote><p>å®šä¹‰</p><ul><li>JMS æ˜¯ä¸€ä¸ª Java å¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMOMï¼‰çš„ APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚</li></ul><p>ç‰¹ç‚¹</p><ul><li><strong>Java æ ‡å‡†</strong>ï¼šJMS æ˜¯ Java EE çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äº Java åº”ç”¨ç¨‹åºã€‚</li><li><strong>API è§„èŒƒ</strong>ï¼šå®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„ API æ¥ä¸æ¶ˆæ¯æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç½‘ç»œåè®®ã€‚</li><li><strong>æä¾›è€…ä¾èµ–</strong>ï¼šJMS API å¯ä»¥ç”±å¤šç§ä¾›åº”å•†å®ç°ï¼Œå¦‚ ActiveMQã€IBM MQ ç­‰ã€‚</li><li><strong>ä¸¤ç§æ¶ˆæ¯æ¨¡å‹</strong>ï¼šæ”¯æŒç‚¹å¯¹ç‚¹ï¼ˆQueueï¼‰å’Œå‘å¸ƒ&#x2F;è®¢é˜…ï¼ˆTopicï¼‰æ¨¡å‹ã€‚</li><li><strong>ä¸è·¨è¯­è¨€</strong>ï¼šä¸»è¦ç”¨äº Java åº”ç”¨ç¨‹åºï¼Œä¸é€‚ç”¨äºä¸åŒè¯­è¨€ä¹‹é—´çš„é€šä¿¡ã€‚</li></ul><blockquote><p>AMQPï¼ˆAdvanced Message Queuing Protocolï¼‰</p></blockquote><p>å®šä¹‰</p><ul><li>AMQP æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†çš„åº”ç”¨å±‚åè®®ï¼Œä¸“ä¸ºå¼‚æ­¥æ¶ˆæ¯ä¼ é€’æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¡†æ¶ï¼Œæ”¯æŒè·¨å¹³å°å’Œè·¨è¯­è¨€çš„æ¶ˆæ¯é€šä¿¡ã€‚</li></ul><p>ç‰¹ç‚¹</p><ul><li><strong>åè®®æ ‡å‡†</strong>ï¼šAMQP å®šä¹‰äº†ç½‘ç»œåè®®ï¼ŒåŒ…æ‹¬æ¶ˆæ¯çš„æ ¼å¼ã€ä¼ è¾“æ–¹å¼å’Œé˜Ÿåˆ—çš„è¡Œä¸ºã€‚</li><li><strong>ä¾›åº”å•†ä¸­ç«‹</strong>ï¼šæ—¨åœ¨å…è®¸ä»ä¸åŒä¾›åº”å•†çš„æ¶ˆæ¯ç³»ç»Ÿä¸­äº’æ“ä½œã€‚</li><li><strong>è·¨è¯­è¨€æ”¯æŒ</strong>ï¼šä¸é™äº Javaï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€å’Œå¹³å°ã€‚</li><li><strong>å¤šç§æ¶ˆæ¯æ¨¡å¼</strong>ï¼šæ”¯æŒçµæ´»çš„æ¶ˆæ¯æ¨¡å¼ï¼ŒåŒ…æ‹¬ç‚¹å¯¹ç‚¹ã€å‘å¸ƒ&#x2F;è®¢é˜…ã€è¯·æ±‚&#x2F;å“åº”ç­‰ã€‚</li><li><strong>å¯é æ€§å’Œå®‰å…¨æ€§</strong>ï¼šæä¾›äº†æ¶ˆæ¯ç¡®è®¤ã€äº¤æ˜“ã€å®‰å…¨ç­‰æœºåˆ¶ã€‚</li></ul><blockquote><p>ä¸»è¦åŒºåˆ«</p></blockquote><ul><li><strong>è®¾è®¡èŒƒå›´</strong>ï¼šJMS æ˜¯ä¸€ä¸ªé’ˆå¯¹ Java çš„ API è§„èŒƒï¼Œè€Œ AMQP æ˜¯ä¸€ä¸ªè·¨è¯­è¨€ã€è·¨å¹³å°çš„ç½‘ç»œåè®®ã€‚</li><li><strong>é€‚ç”¨èŒƒå›´</strong>ï¼šJMS ä¸»è¦ç”¨äº Java åº”ç”¨ï¼ŒAMQP é€‚ç”¨äºä»»ä½•æ”¯æŒè¯¥åè®®çš„å®¢æˆ·ç«¯ã€‚</li><li><strong>å®ç°ä¾èµ–</strong>ï¼šä½¿ç”¨ JMS æ—¶ï¼Œéœ€è¦ä¾èµ–ç‰¹å®šä¾›åº”å•†çš„å®ç°ï¼Œè€Œ AMQP çš„å®ç°æ˜¯ä¾›åº”å•†ä¸­ç«‹çš„ï¼Œç†è®ºä¸Šä»»ä½• AMQP å…¼å®¹çš„å®¢æˆ·ç«¯éƒ½å¯ä»¥ä¸ä»»ä½• AMQP å…¼å®¹çš„æœåŠ¡å™¨é€šä¿¡ã€‚</li><li><strong>å…¼å®¹æ€§</strong>ï¼šAMQP çš„è®¾è®¡ç›®æ ‡æ˜¯å®ç°ä¸åŒæ¶ˆæ¯ç³»ç»Ÿä¹‹é—´çš„äº’æ“ä½œæ€§ï¼Œè€Œ JMS æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚</li></ul><p><strong>ActiveMQï¼ˆå·²è¢«æ·˜æ±°ï¼‰ æ˜¯åŸºäº JMS è§„èŒƒå®ç°çš„ã€‚</strong></p><p><strong>RabbitMQ æ˜¯åŸºäº AMQP åè®®å®ç°çš„ã€‚</strong></p><blockquote><p>JMS vs AMQP</p></blockquote><table><thead><tr><th>å¯¹æ¯”æ–¹å‘</th><th>JMS</th><th>AMQP</th></tr></thead><tbody><tr><td>å®šä¹‰</td><td>Java API</td><td>åè®®</td></tr><tr><td>è·¨è¯­è¨€</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>è·¨å¹³å°</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>æ”¯æŒæ¶ˆæ¯ç±»å‹</td><td>æä¾›ä¸¤ç§æ¶ˆæ¯æ¨¡å‹ï¼šâ‘ Peer-2-Peer;â‘¡Pub&#x2F;sub</td><td>æä¾›äº†äº”ç§æ¶ˆæ¯æ¨¡å‹ï¼šâ‘ direct exchangeï¼›â‘¡fanout exchangeï¼›â‘¢topic changeï¼›â‘£headers exchangeï¼›â‘¤system exchangeã€‚æœ¬è´¨æ¥è®²ï¼Œåå››ç§å’Œ JMS çš„ pub&#x2F;sub æ¨¡å‹æ²¡æœ‰å¤ªå¤§å·®åˆ«ï¼Œä»…æ˜¯åœ¨è·¯ç”±æœºåˆ¶ä¸Šåšäº†æ›´è¯¦ç»†çš„åˆ’åˆ†ï¼›</td></tr><tr><td>æ”¯æŒæ¶ˆæ¯ç±»å‹</td><td>æ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹ ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°è¿‡</td><td>byte[]ï¼ˆäºŒè¿›åˆ¶ï¼‰</td></tr></tbody></table><ul><li>AMQP ä¸ºæ¶ˆæ¯å®šä¹‰äº†çº¿è·¯å±‚ï¼ˆwire-level protocolï¼‰çš„åè®®ï¼Œè€Œ JMS æ‰€å®šä¹‰çš„æ˜¯ API è§„èŒƒã€‚åœ¨ Java ä½“ç³»ä¸­ï¼Œå¤šä¸ª client å‡å¯ä»¥é€šè¿‡ JMS è¿›è¡Œäº¤äº’ï¼Œä¸éœ€è¦åº”ç”¨ä¿®æ”¹ä»£ç ï¼Œä½†æ˜¯å…¶å¯¹è·¨å¹³å°çš„æ”¯æŒè¾ƒå·®ã€‚è€Œ AMQP å¤©ç„¶å…·æœ‰è·¨å¹³å°ã€è·¨è¯­è¨€ç‰¹æ€§ã€‚</li><li>JMS æ”¯æŒ <code>TextMessage</code>ã€<code>MapMessage</code> ç­‰å¤æ‚çš„æ¶ˆæ¯ç±»å‹ï¼›è€Œ AMQP ä»…æ”¯æŒ <code>byte[]</code> æ¶ˆæ¯ç±»å‹ï¼ˆå¤æ‚çš„ç±»å‹å¯åºåˆ—åŒ–åå‘é€ï¼‰ã€‚</li><li>ç”±äº Exchange æä¾›çš„è·¯ç”±ç®—æ³•ï¼ŒAMQP å¯ä»¥æä¾›å¤šæ ·åŒ–çš„è·¯ç”±æ–¹å¼æ¥ä¼ é€’æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œ JMS ä»…æ”¯æŒ é˜Ÿåˆ— å’Œ ä¸»é¢˜&#x2F;è®¢é˜… æ–¹å¼ä¸¤ç§</li></ul><h4 id="RPC-å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„åŒºåˆ«"><a href="#RPC-å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„åŒºåˆ«" class="headerlink" title="RPC å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„åŒºåˆ«"></a>RPC å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„åŒºåˆ«</h4><p>RPCï¼ˆRemote Procedure Callï¼‰å’Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸¤ç§ä¸åŒçš„é€šä¿¡æœºåˆ¶ï¼Œå®ƒä»¬åœ¨è®¾è®¡ç›®çš„ã€é€šä¿¡æ–¹å¼ã€æ¶æ„è¦æ±‚å’Œæ—¶æ•ˆæ€§ç­‰æ–¹é¢å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚</p><blockquote><p>ç”¨é€”</p></blockquote><ul><li><strong>RPC</strong>ï¼š<ul><li>ç›®çš„æ˜¯å®ç°ä¸åŒæœåŠ¡ä¹‹é—´çš„ç›´æ¥åŒæ­¥è°ƒç”¨ã€‚</li><li>ç±»ä¼¼äºæœ¬åœ°å‡½æ•°è°ƒç”¨ï¼Œç”¨äºæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ç´§å¯†åä½œã€‚</li><li>é€‚ç”¨äºå¯¹å“åº”æ—¶é—´æœ‰ä¸¥æ ¼è¦æ±‚çš„åœºæ™¯ã€‚</li></ul></li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼š<ul><li>ç›®çš„æ˜¯æä¾›å¼‚æ­¥é€šä¿¡èƒ½åŠ›ï¼Œè§£è€¦æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li><li>ç”¨äºä»»åŠ¡çš„å¼‚æ­¥å¤„ç†ã€æµé‡å‰Šå³°å’Œåˆ†å¸ƒå¼äº‹åŠ¡ç­‰ã€‚</li><li>é€‚ç”¨äºå¤„ç†é«˜å³°æœŸæµé‡æˆ–è€…æ‰§è¡Œè€—æ—¶æ“ä½œã€‚</li></ul></li></ul><blockquote><p>é€šä¿¡æ–¹å¼</p></blockquote><ul><li><strong>RPC</strong>ï¼š<ul><li>æ˜¯ä¸€ç§åŒæ­¥æ“ä½œï¼Œè°ƒç”¨æ–¹å‘èµ·è¯·æ±‚å¹¶ç­‰å¾…å“åº”ï¼Œç›´åˆ°è¿œç¨‹è¿‡ç¨‹æ‰§è¡Œå®Œæˆå¹¶è¿”å›ç»“æœã€‚</li><li>ä¾èµ–ç›´æ¥çš„ç½‘ç»œè¿æ¥å’Œå³æ—¶çš„æ•°æ®ä¼ è¾“ã€‚</li></ul></li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼š<ul><li>æä¾›äº†ä¸€ç§å¼‚æ­¥é€šä¿¡æ–¹å¼ï¼Œå‘é€æ–¹å°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ï¼Œæ¥æ”¶æ–¹å¯ä»¥åœ¨ä»»ä½•æ—¶é—´ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ã€‚</li><li>å¼•å…¥äº†ä¸­é—´ä»¶ä½œä¸ºæ¶ˆæ¯ä¼ é€’çš„ä¸­é—´å±‚ï¼Œå¢åŠ äº†æ¶ˆæ¯çš„æŒä¹…æ€§ã€‚</li></ul></li></ul><blockquote><p>æ¶æ„</p></blockquote><ul><li><strong>RPC</strong>ï¼š<ul><li>æ²¡æœ‰æ¶ˆæ¯å­˜å‚¨çš„éœ€æ±‚ï¼Œå› ä¸ºå®ƒä¾èµ–å³æ—¶çš„è¯·æ±‚-å“åº”æ¨¡å‹ã€‚</li><li>é€šå¸¸ä¸éœ€è¦ä¸­é—´å±‚æ¥ç¼“å­˜æˆ–ç®¡ç†æ¶ˆæ¯ã€‚</li></ul></li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼š<ul><li>å¿…é¡»è¦æœ‰æ¶ˆæ¯å­˜å‚¨å’Œç®¡ç†çš„æœºåˆ¶ï¼Œå› ä¸ºæ¶ˆæ¯éœ€è¦åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«å¤„ç†ã€‚</li><li>æ¶ˆæ¯ä¸­é—´ä»¶è´Ÿè´£ä¿è¯æ¶ˆæ¯çš„æŒä¹…æ€§å’Œå¯é æ€§ã€‚</li></ul></li></ul><blockquote><p>æ—¶æ•ˆæ€§</p></blockquote><ul><li><strong>RPC</strong>ï¼š<ul><li>ä¸€èˆ¬æœŸæœ›ç«‹å³å¤„ç†ï¼Œè°ƒç”¨æ–¹é€šå¸¸ä¼šé˜»å¡ç­‰å¾…ç›´åˆ°å¾—åˆ°å“åº”ã€‚</li><li>æ›´é€‚åˆäºéœ€è¦å¿«é€Ÿå®Œæˆçš„äº¤äº’å¼æ“ä½œã€‚</li></ul></li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼š<ul><li>æ¶ˆæ¯å¯èƒ½ä¸ä¼šç«‹å³å¤„ç†ï¼Œå…è®¸åœ¨ç³»ç»Ÿèµ„æºå…è®¸çš„æƒ…å†µä¸‹éšåå¤„ç†ã€‚</li><li>æ”¯æŒé«˜å³°æœŸçš„æµé‡å¹³æ»‘ï¼Œå…è®¸ç³»ç»ŸæŒ‰ç…§è‡ªå·±çš„èŠ‚å¥å’Œèƒ½åŠ›å¤„ç†æ¶ˆæ¯ã€‚</li></ul></li></ul><p><strong>æ€»ç»“</strong></p><p>RPC å’Œæ¶ˆæ¯é˜Ÿåˆ—è§£å†³çš„æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¸åŒçš„é—®é¢˜ã€‚</p><p>RPC å¼ºè°ƒçš„æ˜¯å³æ—¶æ€§å’ŒåŒæ­¥ï¼Œé€‚åˆäºéœ€è¦è¿…é€Ÿå“åº”çš„åœºæ™¯ã€‚è€Œæ¶ˆæ¯é˜Ÿåˆ—å¼ºè°ƒçš„æ˜¯å¼‚æ­¥æ€§å’Œè§£è€¦ï¼Œé€‚åˆäºéœ€è¦æé«˜ç³»ç»Ÿæ•´ä½“æ•ˆç‡å’Œç¨³å®šæ€§çš„åœºæ™¯ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸¤è€…å¾€å¾€ç›¸äº’è¡¥å……ï¼Œå…±åŒæ”¯æ’‘èµ·ä¸€ä¸ªé«˜æ•ˆã€å¯é ã€å¯æ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ã€‚</p><h3 id="ä¸‰ã€MQ-çš„å¸¸è§é—®é¢˜"><a href="#ä¸‰ã€MQ-çš„å¸¸è§é—®é¢˜" class="headerlink" title="ä¸‰ã€MQ çš„å¸¸è§é—®é¢˜"></a>ä¸‰ã€MQ çš„å¸¸è§é—®é¢˜</h3><p>é’ˆå¯¹æœ€å¼€å§‹æå‡ºçš„å‡ ä¸ªé—®é¢˜è¿›è¡Œå›ç­”ï¼Œå’Œç»™ä¸€ä¸ªè§£é‡Šæ€§è¯´æ˜ã€‚</p><ul><li><ol><li>ä½ åœ¨ç³»ç»Ÿé‡Œç”¨è¿‡æ¶ˆæ¯é˜Ÿåˆ—å—</li></ol></li><li><ol start="2"><li>ä½ ä»¬åœ¨é¡¹ç›®é‡Œæ˜¯å¦‚ä½•ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„ã€‚</li></ol></li><li><ol start="3"><li>ä¸ºä»€ä¹ˆä½ ä»¬è¿™é‡Œè¦ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å‘¢ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥è°ƒç”¨æ¥å£å¤„ç†å‘¢ã€‚</li></ol></li><li><ol start="4"><li>è¯´è¯´æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç‚¹å’Œç¼ºç‚¹å§ã€‚</li></ol></li><li><ol start="5"><li>æ¶ˆæ¯é˜Ÿåˆ—çš„é€‰å‹ï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚</li></ol></li><li><ol start="6"><li>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆæ¯ï¼Œå¦‚ä½•ä¿è¯æ¶ˆè´¹çš„æ—¶å€™æ˜¯å¹‚ç­‰ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„å¯é æ€§ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ã€‚</li></ol></li><li><ol start="7"><li>å¦‚ä½•è§£å†³æ¶ˆæ¯é˜Ÿåˆ—çš„å»¶æ—¶ä»¥åŠè¿‡æœŸå¤±æ•ˆé—®é¢˜ï¼Ÿæ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†ä»¥åè¯¥å¦‚ä½•å¤„ç†ï¼Ÿæœ‰å‡ ç™¾ä¸‡æ¶ˆæ¯æŒç»­å †ç§¯å‡ å°æ—¶ï¼Œè¦æ€ä¹ˆè§£å†³ï¼Ÿ</li></ol></li><li><ol start="8"><li>è®©ä½ å»è®¾è®¡ä¸€ä¸ªMQï¼Œè¯¥å¦‚ä½•è¿›è¡Œæ¶æ„è®¾è®¡ï¼Œè¯´ä¸€ä¸‹ä½ çš„æ€è·¯ã€‚</li></ol></li></ul><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/high-performance/message-queue/message-queue.html">https://javaguide.cn/high-performance/message-queue/message-queue.html</a></li><li><a href="https://doocs.github.io/advanced-java/#/docs/high-concurrency/mq-interview">https://doocs.github.io/advanced-java/#/docs/high-concurrency/mq-interview</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è˜‘è‡åšå®¢é¡¹ç›®_Day02</title>
    <link href="/2023/12/11/%E8%98%91%E8%8F%87%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE_Day02/"/>
    <url>/2023/12/11/%E8%98%91%E8%8F%87%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE_Day02/</url>
    
    <content type="html"><![CDATA[<h3 id="Part01-æˆ‘ä»¬åº”è¯¥å»äº†è§£ä»€ä¹ˆä¸œè¥¿å‘¢"><a href="#Part01-æˆ‘ä»¬åº”è¯¥å»äº†è§£ä»€ä¹ˆä¸œè¥¿å‘¢" class="headerlink" title="Part01: æˆ‘ä»¬åº”è¯¥å»äº†è§£ä»€ä¹ˆä¸œè¥¿å‘¢"></a>Part01: æˆ‘ä»¬åº”è¯¥å»äº†è§£ä»€ä¹ˆä¸œè¥¿å‘¢</h3><p>è¿™éƒ¨åˆ†å†…å®¹ä¸»è¦è®²è¿°ä¸€ä¸‹åŸºç¡€çš„åšå®¢ç®¡ç†æ˜¯æ€ä¹ˆåšçš„ï¼Œå¦‚æœéœ€è¦åšä¸€ä¸ªåŸºç¡€çš„åšå®¢ç³»ç»Ÿéœ€è¦æ€ä¹ˆåšï¼Œè€ƒè™‘å“ªäº›æ–¹é¢ã€‚</p><p>up ä¸» CodeSheep  åœ¨è§†é¢‘å¯¹äºé¡¹ç›®å­¦ä¹ çš„ä¸€äº›å»ºè®®ï¼Œè®°å½•ä¸€ä¸‹ <a href="https://www.bilibili.com/video/BV1y4411p74E/">https://www.bilibili.com/video/BV1y4411p74E/</a></p><ul><li><ol><li>è¿è¡Œé¡¹ç›®å¹¶è·‘èµ·æ¥</li></ol></li><li><ol start="2"><li>é˜…è¯»é¡¹ç›®æºç å¹¶è°ƒè¯•ï¼ˆå¯ä»¥ç»“åˆæŸä¸ªè¿è¡Œçš„åŠŸèƒ½å…¥æ‰‹ï¼Œä¸€ä¸ªç»„ä»¶ä¸€ä¸ªç»„ä»¶å¼„ç†Ÿã€çœ‹æŠ¥é”™ã€çœ‹æ—¥å¿—ã€çœ‹æ‰“å°å˜é‡ï¼‰</li></ol></li><li><ol start="3"><li>è®°å½•æ–‡æ¡£ï¼Œä»ä¸šåŠ¡é€»è¾‘å‡ºå‘ï¼ˆé€»è¾‘å¾ˆé‡è¦ï¼Œä½ å…ˆå­¦ä¹ è¿™ä¸ªï¼Œå‰ç«¯é¡µé¢å®ç°å’ŒäºŒæ¬¡æ”¹é€ æƒ³æ³•å…ˆæ”¾åé¢ï¼Œå…ˆå»äº†è§£ï¼Œå†å»æ‘¸ç´¢ï¼‰</li></ol></li></ul><p>è§†é¢‘ä¸­æ¨èè¿‡è¿™ä¸ªé¡¹ç›®ï¼ˆä¸€ä¸ªå•ä½“é¡¹ç›®ï¼‰ï¼Œæœ‰ç©ºä¹Ÿå¯ä»¥å­¦ä¹ ä¸€ä¸‹ï¼š <a href="https://github.com/halo-dev/halo">https://github.com/halo-dev/halo</a></p><p>åœ¨åå°ç®¡ç†ç•Œé¢ä¸­ï¼Œæœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„æ¨¡å—æ˜¯ï¼šåšå®¢ç®¡ç†</p><p>åšå®¢ç®¡ç†ï¼ˆç•Œé¢ï¼‰</p><ul><li>åšå®¢ç®¡ç†</li><li>åˆ†ç±»ç®¡ç†</li><li>æ”¶è—ç®¡ç†</li><li>æ ‡ç­¾ç®¡ç†</li><li>æ¨èç®¡ç†</li><li>ä¸“é¢˜ç®¡ç†</li></ul><h3 id="Part02-è˜‘è‡åšå®¢ä¸­åšå®¢ç®¡ç†æ˜¯å¦‚ä½•å®ç°çš„ã€‚"><a href="#Part02-è˜‘è‡åšå®¢ä¸­åšå®¢ç®¡ç†æ˜¯å¦‚ä½•å®ç°çš„ã€‚" class="headerlink" title="Part02: è˜‘è‡åšå®¢ä¸­åšå®¢ç®¡ç†æ˜¯å¦‚ä½•å®ç°çš„ã€‚"></a>Part02: è˜‘è‡åšå®¢ä¸­åšå®¢ç®¡ç†æ˜¯å¦‚ä½•å®ç°çš„ã€‚</h3><p>å…ˆäº†è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå›åˆ°æŠ€æœ¯æ ˆçš„ä½¿ç”¨ï¼ŒçŸ¥é“ä»–ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆæŠ€æœ¯æ ˆï¼Œæ‰èƒ½å¯¹åé¢æœ‰æ›´å¥½çš„äº†è§£ã€‚</p><p>å…·ä½“å†…å®¹çœ‹ä¸€ä¸‹ <a href="https://gitee.com/moxi159753/mogu_blog_v2.git">https://gitee.com/moxi159753/mogu_blog_v2.git</a></p><p>è¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œéœ€è¦çŸ¥é“çš„ä¸€ä¸ªæ˜¯é¡¹ç›®ä¸­ä½¿ç”¨çš„ Java æŒä¹…å±‚æ¡†æ¶ æ˜¯ MyBatis-Plusã€‚</p><p>é€šè¿‡è¿™ä¸ªæ¡†æ¶ï¼Œä½ å¯ä»¥å®ç° <strong>ä»£ç ç”Ÿæˆå™¨</strong>ã€<strong>è‡ªåŠ¨ CRUDï¼ˆCreate, Read, Update, Deleteï¼‰</strong> ç­‰æ“ä½œã€‚</p><h4 id="åšå®¢ç®¡ç†"><a href="#åšå®¢ç®¡ç†" class="headerlink" title="åšå®¢ç®¡ç†"></a>åšå®¢ç®¡ç†</h4><blockquote><p>æŸ¥æ‰¾</p></blockquote><p>æŸ¥è¯¢å¹¶åˆ†é¡µè·å–åšå®¢åˆ—è¡¨</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ ¹æ®æ¡ä»¶è·å–åšå®¢åˆ—è¡¨ï¼Œå¹¶è¿›è¡Œåˆ†é¡µã€‚</span><br><span class="hljs-comment"> * ä½¿ç”¨MyBatis-Plusçš„QueryWrapperæ¥æ„å»ºæŸ¥è¯¢æ¡ä»¶ã€‚</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * @param blogVO åŒ…å«æŸ¥è¯¢æ¡ä»¶çš„VOå¯¹è±¡</span><br><span class="hljs-comment"> * @return åˆ†é¡µåçš„åšå®¢åˆ—è¡¨</span><br><span class="hljs-comment"> */</span><br>@Override<br>public IPage&lt;Blog&gt; getPageList(BlogVO blogVO) &#123;<br>    <span class="hljs-comment">// åˆ›å»ºæŸ¥è¯¢åŒ…è£…å™¨</span><br>    QueryWrapper&lt;Blog&gt; queryWrapper = <span class="hljs-keyword">new</span> QueryWrapper&lt;&gt;();<br><br>    <span class="hljs-comment">// æ„å»ºæœç´¢æ¡ä»¶</span><br>    <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(blogVO.getKeyword()) &amp;&amp; !StringUtils.<span class="hljs-built_in">isEmpty</span>(blogVO.getKeyword().<span class="hljs-built_in">trim</span>())) &#123;<br>        queryWrapper.like(SQLConf.TITLE, blogVO.getKeyword().<span class="hljs-built_in">trim</span>());<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!StringUtils.<span class="hljs-built_in">isEmpty</span>(blogVO.getTagUid())) &#123;<br>        queryWrapper.like(SQLConf.TAG_UID, blogVO.getTagUid());<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!StringUtils.<span class="hljs-built_in">isEmpty</span>(blogVO.getBlogSortUid())) &#123;<br>        queryWrapper.like(SQLConf.BLOG_SORT_UID, blogVO.getBlogSortUid());<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!StringUtils.<span class="hljs-built_in">isEmpty</span>(blogVO.getLevelKeyword())) &#123;<br>        queryWrapper.eq(SQLConf.LEVEL, blogVO.getLevelKeyword());<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!StringUtils.<span class="hljs-built_in">isEmpty</span>(blogVO.getIsPublish())) &#123;<br>        queryWrapper.eq(SQLConf.IS_PUBLISH, blogVO.getIsPublish());<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!StringUtils.<span class="hljs-built_in">isEmpty</span>(blogVO.getIsOriginal())) &#123;<br>        queryWrapper.eq(SQLConf.IS_ORIGINAL, blogVO.getIsOriginal());<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!StringUtils.<span class="hljs-built_in">isEmpty</span>(blogVO.getType())) &#123;<br>        queryWrapper.eq(SQLConf.TYPE, blogVO.getType());<br>    &#125;<br><br>    <span class="hljs-comment">// è®¾ç½®åˆ†é¡µå‚æ•°</span><br>    Page&lt;Blog&gt; page = <span class="hljs-keyword">new</span> Page&lt;&gt;();<br>    page.setCurrent(blogVO.getCurrentPage());<br>    page.setSize(blogVO.getPageSize());<br>    queryWrapper.eq(SQLConf.STATUS, EStatus.ENABLE);<br><br>    <span class="hljs-comment">// è®¾ç½®æ’åºæ–¹å¼</span><br>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(blogVO.getOrderByAscColumn())) &#123;<br>        <span class="hljs-comment">// å°†é©¼å³°å‘½åè½¬æ¢æˆä¸‹åˆ’çº¿å‘½å</span><br>        String column = StringUtils.underLine(<span class="hljs-keyword">new</span> StringBuffer(blogVO.getOrderByAscColumn())).toString();<br>        queryWrapper.orderByAsc(column);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(blogVO.getOrderByDescColumn())) &#123;<br>        String column = StringUtils.underLine(<span class="hljs-keyword">new</span> StringBuffer(blogVO.getOrderByDescColumn())).toString();<br>        queryWrapper.orderByDesc(column);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// é»˜è®¤æ’åº</span><br>        <span class="hljs-keyword">if</span> (blogVO.getUseSort() == <span class="hljs-number">0</span>) &#123;<br>            queryWrapper.orderByDesc(SQLConf.CREATE_TIME);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            queryWrapper.orderByDesc(SQLConf.<span class="hljs-built_in">SORT</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢</span><br>    IPage&lt;Blog&gt; pageList = blogService.page(page, queryWrapper);<br>    List&lt;Blog&gt; list = pageList.getRecords();<br><br>    <span class="hljs-comment">// è‹¥ç»“æœä¸ºç©ºï¼Œç›´æ¥è¿”å›</span><br>    <span class="hljs-keyword">if</span> (list.size() == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> pageList;<br>    &#125;<br><br>    <span class="hljs-comment">// å¤„ç†æŸ¥è¯¢ç»“æœï¼Œä¾‹å¦‚æ·»åŠ åˆ†ç±»ã€æ ‡ç­¾ç­‰é¢å¤–ä¿¡æ¯</span><br>    <span class="hljs-comment">// ... çœç•¥äº†é¢å¤–ä¿¡æ¯å¤„ç†çš„ä»£ç  ...</span><br><br>    <span class="hljs-comment">// è¿”å›å¤„ç†åçš„åˆ†é¡µç»“æœ</span><br>    pageList.setRecords(list);<br>    <span class="hljs-keyword">return</span> pageList;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¤„ç†æŸ¥è¯¢ç»“æœ</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs pf">// ...çœç•¥æ–¹æ³•çš„å…¶å®ƒéƒ¨åˆ†...<br><br>List<span class="hljs-variable">&lt;Blog&gt;</span> list = pageList.getRecords();<br><br>// è‹¥æŸ¥è¯¢ç»“æœä¸ºç©ºï¼Œç›´æ¥è¿”å›<br>if (list.isEmpty()) &#123;<br>    return pageList;<br>&#125;<br><br>// åˆå§‹åŒ–å­˜å‚¨åˆ†ç±»UIDå’Œæ ‡ç­¾UIDçš„é›†åˆ<br>List<span class="hljs-variable">&lt;String&gt;</span> sortUids = new ArrayList<span class="hljs-variable">&lt;&gt;</span>();<br>List<span class="hljs-variable">&lt;String&gt;</span> <span class="hljs-keyword">tag</span>Uids = new ArrayList<span class="hljs-variable">&lt;&gt;</span>();<br><br>// éå†æŸ¥è¯¢ç»“æœï¼Œæ”¶é›†åˆ†ç±»UIDå’Œæ ‡ç­¾UID<br><span class="hljs-keyword">for</span> (B<span class="hljs-keyword">log</span> blog : list) &#123;<br>    if (StringUtils.isNotEmpty(blog.getB<span class="hljs-keyword">log</span>SortUid())) &#123;<br>        sortUids.add(blog.getB<span class="hljs-keyword">log</span>SortUid());<br>    &#125;<br>    if (StringUtils.isNotEmpty(blog.getTagUid())) &#123;<br>        <span class="hljs-keyword">tag</span>Uids.addAll(StringUtils.changeStringToString(blog.getTagUid(), SysConf.FILE_SEGMENTATION));<br>    &#125;<br>&#125;<br><br>// æ ¹æ®åˆ†ç±»UIDså’Œæ ‡ç­¾UIDsè·å–å¯¹åº”çš„åˆ†ç±»å’Œæ ‡ç­¾å¯¹è±¡<br>Collection<span class="hljs-variable">&lt;BlogSort&gt;</span> sortList = blogSortService.listByIds(sortUids);<br>Collection<span class="hljs-variable">&lt;Tag&gt;</span> <span class="hljs-keyword">tag</span>List = <span class="hljs-keyword">tag</span>Service.listByIds(<span class="hljs-keyword">tag</span>Uids);<br><br>// å°†åˆ†ç±»å’Œæ ‡ç­¾å¯¹è±¡è½¬æ¢ä¸ºMapï¼Œä¾¿äºå¿«é€ŸæŸ¥æ‰¾<br>Map<span class="hljs-variable">&lt;String, BlogSort&gt;</span> sortMap = sortList.stream()<br>    .collect(Collectors.<span class="hljs-keyword">to</span>Map(B<span class="hljs-keyword">log</span>Sort::getUid, Function.identity()));<br>Map<span class="hljs-variable">&lt;String, Tag&gt;</span> <span class="hljs-keyword">tag</span>Map = <span class="hljs-keyword">tag</span>List.stream()<br>    .collect(Collectors.<span class="hljs-keyword">to</span>Map(Tag::getUid, Function.identity()));<br><br>// éå†æŸ¥è¯¢ç»“æœï¼Œè®¾ç½®æ¯ä¸ªåšå®¢çš„åˆ†ç±»å’Œæ ‡ç­¾<br><span class="hljs-keyword">for</span> (B<span class="hljs-keyword">log</span> blog : list) &#123;<br>    blog.<span class="hljs-built_in">set</span>B<span class="hljs-keyword">log</span>Sort(sortMap.get(blog.getB<span class="hljs-keyword">log</span>SortUid()));<br>    List<span class="hljs-variable">&lt;String&gt;</span> <span class="hljs-keyword">tag</span>UidList = StringUtils.changeStringToString(blog.getTagUid(), SysConf.FILE_SEGMENTATION);<br>    List<span class="hljs-variable">&lt;Tag&gt;</span> blogTags = <span class="hljs-keyword">tag</span>UidList.stream()<br>        .map(<span class="hljs-keyword">tag</span>Map::get)<br>        .collect(Collectors.<span class="hljs-keyword">to</span>List());<br>    blog.<span class="hljs-built_in">set</span>TagList(blogTags);<br>&#125;<br><br>// æ›´æ–°å¤„ç†åçš„æŸ¥è¯¢ç»“æœ<br>pageList.<span class="hljs-built_in">set</span>Records(list);<br><br>// ...çœç•¥æ–¹æ³•çš„å…¶ä½™éƒ¨åˆ†...<br></code></pre></td></tr></table></figure><ol><li>é¦–å…ˆæ£€æŸ¥æŸ¥è¯¢ç»“æœåˆ—è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™ç›´æ¥è¿”å›ã€‚</li><li>éå†åšå®¢åˆ—è¡¨ï¼Œä»æ¯ä¸ªåšå®¢å¯¹è±¡ä¸­æå–åˆ†ç±»å’Œæ ‡ç­¾çš„UIDã€‚</li><li>ä½¿ç”¨æ”¶é›†çš„UIDsä»æœåŠ¡å±‚è·å–ç›¸åº”çš„åˆ†ç±»å’Œæ ‡ç­¾å¯¹è±¡ã€‚</li><li>å°†åˆ†ç±»å’Œæ ‡ç­¾å¯¹è±¡è½¬æ¢æˆMapï¼Œæ–¹ä¾¿åç»­æ ¹æ®UIDå¿«é€ŸæŸ¥æ‰¾ã€‚</li><li>å†æ¬¡éå†åšå®¢åˆ—è¡¨ï¼Œä¸ºæ¯ä¸ªåšå®¢è®¾ç½®å¯¹åº”çš„åˆ†ç±»å’Œæ ‡ç­¾åˆ—è¡¨ã€‚</li><li>æœ€åï¼Œå°†æ›´æ–°åçš„åšå®¢åˆ—è¡¨è®¾ç½®å›åˆ†é¡µç»“æœå¯¹è±¡ä¸­ã€‚</li></ol><p>è¿™ä¸ªè¿‡ç¨‹å…è®¸åœ¨è¿”å›åšå®¢åˆ—è¡¨ä¹‹å‰ä¸°å¯Œæ¯ä¸ªåšå®¢å¯¹è±¡çš„ä¿¡æ¯ï¼Œå¦‚æ·»åŠ åˆ†ç±»å’Œæ ‡ç­¾æ•°æ®ã€‚ä»¥ä¾¿æä¾›æ›´è¯¦ç»†çš„ä¿¡æ¯ç»™å‰ç«¯æ˜¾ç¤ºã€‚</p><blockquote><p>æ·»åŠ åšå®¢</p></blockquote><p>to be continedâ€¦.</p>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯é€‰å‹</title>
    <link href="/2023/12/11/%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E5%92%8C%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/"/>
    <url>/2023/12/11/%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E5%92%8C%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯é€‰å‹éœ€è¦è€ƒè™‘çš„å› ç´ "><a href="#ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯é€‰å‹éœ€è¦è€ƒè™‘çš„å› ç´ " class="headerlink" title="ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯é€‰å‹éœ€è¦è€ƒè™‘çš„å› ç´ "></a>ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯é€‰å‹éœ€è¦è€ƒè™‘çš„å› ç´ </h3><h3 id="æˆé•¿å’Œæ€è€ƒ"><a href="#æˆé•¿å’Œæ€è€ƒ" class="headerlink" title="æˆé•¿å’Œæ€è€ƒ"></a>æˆé•¿å’Œæ€è€ƒ</h3><h4 id="1ã€å½“å°A-æ¥åˆ°éœ€æ±‚åçš„ååº”-ğŸŒï¸"><a href="#1ã€å½“å°A-æ¥åˆ°éœ€æ±‚åçš„ååº”-ğŸŒï¸" class="headerlink" title="1ã€å½“å°A æ¥åˆ°éœ€æ±‚åçš„ååº” ğŸŒï¸"></a>1ã€å½“å°A æ¥åˆ°éœ€æ±‚åçš„ååº” ğŸŒï¸</h4><p>å¯¹äºä¸€ä¸ªéœ€æ±‚æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥ç«™åœ¨ä¸€ä¸ªè¯„å®¡çš„æ€åº¦å»çœ‹å¾…ä»–ã€‚</p><p>æ¥åˆ°äº§å“ç»ç†çš„éœ€æ±‚åï¼Œæˆ‘ä»¬åº”è¯¥ä»æœ‰åˆ©äºä¸šåŠ¡çš„è§’åº¦å‡ºå‘æ€è€ƒï¼Œå¯¹è¿™ä¸ªéœ€æ±‚è¿›è¡Œåˆ ã€æ”¹ã€å¢ã€‚</p><p>åŒæ—¶æœ€é‡è¦çš„ä¸€ä¸ªåœ°æ–¹æ˜¯ï¼Œä½ éœ€è¦æœ‰è‡ªå·±çš„ä¸€ä¸ªæ€è€ƒå’Œè‡ªå·±çš„å®è·µï¼Œå¹¶å»è½å®ä»–å’Œæ¨åŠ¨ä¸€äº›ä¸œè¥¿ï¼Œè®©ä½ çš„æ€è€ƒèƒ½å¤Ÿè½åœ°å¹¶çœ‹åˆ°æˆæ•ˆã€‚</p><p>æœ‰è‡ªå·±çš„æ€è€ƒå’Œæ•´ä½“ä¸šåŠ¡çš„ç†è§£ï¼Œå°†æœ‰åŠ©äºä½ æ•´ä½“çš„ä¸€ä¸ªèŒä¸šç”Ÿæ¶¯ï¼Œå¯¹äºä½ ç›®å‰æ‰€åšçš„äº‹æƒ…ï¼Œä¹Ÿè®¸åœ¨æœªæ¥æŸä¸ªåœ°æ–¹ï¼Œèƒ½å¤Ÿç»“åˆä½ å½“æ—¶çš„ä¸€ä¸ªèƒŒæ™¯ï¼Œåšå‡ºæœ‰ç‚¹é…·å¹¶å¾ˆæœ‰ç”¨çš„ä¸œè¥¿ã€‚</p><h4 id="2ã€æé«˜æŸä»¶äº‹æƒ…çš„æ•ˆç‡-ğŸ¦–"><a href="#2ã€æé«˜æŸä»¶äº‹æƒ…çš„æ•ˆç‡-ğŸ¦–" class="headerlink" title="2ã€æé«˜æŸä»¶äº‹æƒ…çš„æ•ˆç‡  ğŸ¦–"></a>2ã€æé«˜æŸä»¶äº‹æƒ…çš„æ•ˆç‡  ğŸ¦–</h4><p>å¯¹äºé¡¹ç›®ä¸­çš„ç°æˆä»£ç ï¼Œæˆ‘ä»¬åº”è¯¥å»ç†æ€§æ€è€ƒï¼Œ</p><ul><li>ç¬¬ä¸€ï¼Œè¿™äº›ä»£ç ä¸ºä»€ä¹ˆè¿™ä¹ˆå†™å‘¢ï¼Œå†™çš„é€»è¾‘æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ã€‚</li><li>ç¬¬äºŒï¼Œè¿™äº›ä»£ç èƒ½å¤Ÿä¼˜åŒ–å—ï¼Œå“ªäº›åœ°æ–¹å­˜åœ¨ç“¶é¢ˆå‘¢ï¼Œå¦‚ä½•ä¼˜åŒ–ã€‚ä¼˜åŒ–çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå¤„ç†ã€‚</li><li>ç¬¬ä¸‰ï¼Œä¿æŒæŒç»­å­¦ä¹ ï¼Œäº†è§£ç¨‹åºå®ç°çš„åº•å±‚é€»è¾‘ï¼Œå¯¹äºè®¡ç®—æœºæ“ä½œç³»ç»Ÿã€æ•°æ®ç»“æ„ã€ç»„æˆåŸç†ç­‰èƒ½å¤Ÿæœ‰æ¯”è¾ƒå¥½çš„è®¤è¯†å’Œç†è§£ã€‚</li><li>ç¬¬å››ï¼Œå¯¹äº ToC  çš„é¡¹ç›®ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘ä¸€ä¸‹æœåŠ¡ QPS èƒ½æ”¯æ’‘å¤šå°‘ï¼Œå¿ƒé‡Œå¯¹äºæµé‡é˜ˆå€¼æœ‰ä¸€ä¸ªæ¸…æ¥šè®¤çŸ¥ï¼Œé’ˆå¯¹è¿™ä¸ªé˜ˆå€¼å¦‚ä½•æé«˜ä¼˜åŒ–ï¼Œæ€§èƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæ˜¯ä¸€ä¸ªéœ€è¦è€ƒè™‘å¾ˆå¤šæ–¹é¢å’Œå†…å®¹çš„é—®é¢˜ã€‚</li><li>ç¬¬äº”ï¼Œå¯¹äºç”Ÿäº§ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒçš„åŒºåˆ«ï¼Œæ˜¯éå¸¸å¤§çš„ï¼Œç”Ÿäº§ç¯å¢ƒé‡åˆ°çš„å¤æ‚æ€§é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦éšæ—¶å…»æˆå…³æ³¨çº¿ä¸ŠæœåŠ¡è¿è¡Œçš„ä¸€ä¸ªæƒ…å†µï¼›ä¸€äº›åŸºç¡€çš„å†…å®¹ï¼Œæ¯”å¦‚è¯·æ±‚å³°å€¼çš„æ—¶å€™ CPUã€å†…å­˜çš„æ¶ˆè€—ã€ç½‘ç»œç«¯å£æ¶ˆè€—ç­‰éƒ½æ˜¯æˆ‘ä»¬éœ€è¦å»å…³æ³¨çš„ä¸€äº›ç‚¹ï¼Œå¹¶åœ¨å®è·µä¸­å…»æˆè¿™ä¸ªä¹ æƒ¯ã€‚</li><li>ç¬¬å…­ï¼Œäº†è§£æ•´ä¸ªé¡¹ç›®æ•´ä½“ä¸šåŠ¡ï¼Œä¸è¦ç»™è‡ªå·±çš„å·¥ä½œè®¾å®šè¾¹ç•Œã€‚</li><li>ç¬¬ä¸ƒï¼Œå½’çº³æ€»ç»“å¤ç›˜ã€‚</li></ul><p>å…³äºç¬¬äºŒç‚¹ï¼Œåœ¨ JavaGuide ç½‘ç«™æ–‡ç« ä¸­ä¸€å¥è¯å†™çš„å¾ˆå¥½ï¼Œå€Ÿé‰´å¼•ç”¨ä¸€ä¸‹ï¼š</p><div style="background-color: #3498db; color: white; padding: 10px;">   ä¸»åŠ¨æ€è€ƒä¸€ä¸‹ç°æœ‰å·¥ä½œä¸­å“ªäº›åœ°æ–¹æ•ˆç‡æœ‰æ”¹è¿›çš„ç©ºé—´ï¼Œæƒ³åˆ°äº†å°±ä¸»åŠ¨å»æ”¹è¿›å®ƒï¼</div><h4 id="3ã€å­¦ä¹ çš„æ—¶å€™ä¸€äº›å‘ä¸è¦å»ç¢°-ğŸ¤•"><a href="#3ã€å­¦ä¹ çš„æ—¶å€™ä¸€äº›å‘ä¸è¦å»ç¢°-ğŸ¤•" class="headerlink" title="3ã€å­¦ä¹ çš„æ—¶å€™ä¸€äº›å‘ä¸è¦å»ç¢° ğŸ¤•"></a>3ã€å­¦ä¹ çš„æ—¶å€™ä¸€äº›å‘ä¸è¦å»ç¢° ğŸ¤•</h4><ul><li>å¤šå»çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå¤šå»çœ‹å®é™…çš„æºç ï¼Œå°½é‡å°‘çš„å»çœ‹ä¸€ä¸‹åƒåœ¾åšå®¢</li><li>å…³æ³¨ç»†èŠ‚</li><li>åŠæ—¶åé¦ˆ</li><li>è§„èŒƒï¼Œä»¥åŠè§„èŒƒï¼ˆä»£ç ï¼Œæ³¨é‡Šï¼Œæ¥å£ï¼Œæ–¹æ³•åç§°ï¼Œæ–‡æ¡£ï¼ŒæŠ€æœ¯åç§°ï¼Œæ—¥å¿—ï¼Œæµ‹è¯•ï¼‰</li><li>å¤šå®é™…å»å†™ä»£ç ï¼ˆä¸è¦ä¸€è¯´å°±ä¼šï¼Œä¸€å†™å°±åºŸï¼‰</li><li>é‡è¦çš„å˜æ›´å’Œæ¥å£å†…å®¹ä¸€å®šè¦å†™æ–‡æ¡£</li><li>ç†è§£éœ€æ±‚åï¼Œå†å¼€å§‹å†™ä»£ç </li><li>å¤šæ€è€ƒï¼Œæœ‰è‡ªå·±çš„ç†è§£åå†å»è¯¢é—®ä¸€äº›ä¸œè¥¿ï¼ˆç§¯ææ²Ÿé€šï¼‰</li><li>ç”Ÿäº§ç¯å¢ƒä¸è¦åŠ¨</li></ul><h3 id="æœªæ¥å°±ä¸šæ–¹å‘é€‰æ‹©"><a href="#æœªæ¥å°±ä¸šæ–¹å‘é€‰æ‹©" class="headerlink" title="æœªæ¥å°±ä¸šæ–¹å‘é€‰æ‹©"></a>æœªæ¥å°±ä¸šæ–¹å‘é€‰æ‹©</h3><p>åœ¨ç›®å‰è¿™ç§è¶‹åŠ¿çš„æœªæ¥ä¸­ï¼Œå¯¹äºé¡¶å±‚è®¾è®¡çš„è¦æ±‚ä»ä¸šäººå‘˜å…¶å®æ˜¯è¶Šæ¥è¶Šé«˜çš„ï¼Œéœ€æ±‚é‡ä¹Ÿè¦å‡å°‘ï¼ˆå·²ç»æœ‰å¾ˆå¤šç°æˆçš„è§£å†³æ–¹æ¡ˆï¼‰ï¼Œæœªæ¥çš„å°±ä¸šå¸‚åœºéœ€è¦çš„åè€Œæ˜¯ä¸­ä½å±‚äººå‘˜ï¼Œè€Œéšç€GPTç­‰äººå·¥æ™ºèƒ½çš„å‘å±•ï¼ŒæŠ€æœ¯äººå‘˜çš„å¯æ›¿ä»£æ€§å…¶å®æ˜¯å¾ˆå¼ºçš„ã€‚</p><div style="background: linear-gradient(to right, #6dd5fa, #ff758c); color: white; padding: 15px;">  ä¹‰æ— åé¡¾çš„æŠ“ä½æ¯ä¸€ä¸ªç®¡ç†å²—æœºä¼šã€‚</div><ul><li>é©¾é©­ç®¡ç†<ul><li>æ¨¡ä»¿å‘¨å›´ä¼˜ç§€ç®¡ç†è€…</li><li>æ‰¾æœºä¼šé”»ç‚¼ å±•ç¤ºèƒ½åŠ›</li></ul></li><li>é¡¶å±‚æ¶æ„<ul><li>å¤§é‡ç ”è¯»å¸æ”¶  æ¶æ„è®¾è®¡æ–¹æ¡ˆ</li></ul></li></ul><p>æ¨èä¹¦ç±ï¼šã€Šè½¯ä»¶å¹³å°ç®¡ç†æ¶æ„è®¾è®¡ä¸æŠ€æœ¯ç®¡ç†ä¹‹é“ã€‹</p>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>thinking</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rediså…¥é—¨_åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2023/12/08/Redis%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2023/12/08/Redis%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<p>å¾…å®Œå–„çš„ä¸€äº›å†…å®¹</p><ul><li>å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥</li><li>Redis çš„å¸¸ç”¨æ•°æ®ç±»å‹</li><li>Zset è·³è¡¨</li><li>åˆ†å¸ƒå¼é”</li><li>Redis çº¿ç¨‹æ¨¡å‹</li><li>Redis å†…å­˜ç®¡ç† </li><li>æ•°æ®è¿‡æœŸç­–ç•¥</li><li>æ•°æ®æ·˜æ±°ç­–ç•¥</li><li>Redis æ€§èƒ½ä¼˜åŒ–</li><li>Redis é›†ç¾¤</li><li>Rediså®ç°åˆ†å¸ƒå¼é”å¦‚ä½•åˆç†çš„æ§åˆ¶é”çš„æœ‰æ•ˆæ—¶é•¿</li><li>redisé›†ç¾¤è„‘è£‚</li><li>ä½ ä»¬ç”¨è¿‡Redisçš„äº‹åŠ¡å—ï¼Ÿäº‹åŠ¡çš„å‘½ä»¤æœ‰å“ªäº›</li><li>Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿˜é‚£ä¹ˆå¿«ï¼Ÿ</li></ul><h3 id="1ã€Reids-çš„ä¸€äº›åŸºç¡€æ¦‚å¿µ"><a href="#1ã€Reids-çš„ä¸€äº›åŸºç¡€æ¦‚å¿µ" class="headerlink" title="1ã€Reids çš„ä¸€äº›åŸºç¡€æ¦‚å¿µ"></a>1ã€Reids çš„ä¸€äº›åŸºç¡€æ¦‚å¿µ</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨å­¦ä¹ ä½¿ç”¨ Redis çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå…ˆé¦–å…ˆçŸ¥é“çš„æ˜¯ï¼šRedis å­˜å‚¨çš„æ–¹å¼æ˜¯ä½œä¸ºä¸€ä¸ªé”®å€¼å­˜å‚¨çš„ï¼Œå…¶ä¸­é”®æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€é›†åˆç­‰å¤æ‚æ•°æ®ç±»å‹ã€‚</p><p>ä»æœ€åŸºç¡€çš„æ•°æ®ç±»å‹çš„ä½¿ç”¨å¼€å§‹ï¼Œæˆ‘ä»¬æ‰å¼€å§‹æ…¢æ…¢äº†è§£è¿™æ¬¾ Redis å†…å­˜å­˜å‚¨ç³»ç»Ÿï¼›</p><p>ç”±äº Redis æ˜¯åŸºäºå†…å­˜å­˜å‚¨ï¼Œæˆ‘ä»¬è¿˜ä¼šå­¦ä¹ åˆ° Redis çš„æŒä¹…åŒ–æ–¹æ¡ˆï¼›äº†è§£åˆ°å®ƒçš„æŒä¹…åŒ–ç‰¹æ€§ä¹‹åï¼Œæˆ‘ä»¬åˆå¼€å§‹å¯¹å®ƒçš„å…¶ä»–ç‰¹æ€§å»æŒæ¡å­¦ä¹ ï¼ŒåŒ…æ‹¬äº‹åŠ¡ï¼ˆä½¿ç”¨æ¯”è¾ƒå°‘ï¼‰ã€å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼ã€Lua è„šæœ¬ã€Key è¿‡æœŸç­‰ã€‚</p><p>åœ¨ä½¿ç”¨çš„æ—¶å€™è¿˜ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œè¿™äº›é—®é¢˜æ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Œå…·ä½“æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Œéƒ½æ˜¯å€¼å¾—æˆ‘ä»¬å»äº†è§£å’ŒæŒæ¡çš„åœ°æ–¹ï¼›</p><p>äº†è§£ç‰¹æ€§åï¼Œæˆ‘ä»¬åˆä¼šå»å­¦ä¹ ï¼šåœ¨é«˜å¹¶å‘é›†ç¾¤çš„æƒ…å†µä¸‹ï¼ŒRedis çš„åˆ†å¸ƒå¼é›†ç¾¤åˆæ˜¯æ€ä¹ˆåšçš„ç­‰ã€‚</p><h4 id="Redis-æ˜¯ä»€ä¹ˆ"><a href="#Redis-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Redis æ˜¯ä»€ä¹ˆ"></a>Redis æ˜¯ä»€ä¹ˆ</h4><blockquote><p>åŸºç¡€ä»‹ç»</p></blockquote><ul><li>1ã€Redisï¼ˆRemote Dictionary Serverï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ã€å†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œèƒ½å¤Ÿå¿«é€Ÿè¯»å†™ï¼Œç®€å•æ˜“ç”¨</li><li>2ã€æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ï¼ˆStringsï¼‰ã€åˆ—è¡¨ï¼ˆListsï¼‰ã€é›†åˆï¼ˆSetsï¼‰ã€æœ‰åºé›†åˆï¼ˆSorted Setsï¼‰ä»¥åŠå“ˆå¸Œè¡¨ï¼ˆHashesï¼‰ç­‰</li><li>3ã€åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒäº‹åŠ¡ã€æŒä¹…åŒ–ã€Luaè„šæœ¬ã€é›†ç¾¤ç­‰ï¼›ä½¿ç”¨åœºæ™¯ä¸°å¯Œã€‚</li></ul><blockquote><p>å¸¸è§çš„ä¸€äº›åŸºç¡€é¢è¯•é¢˜</p></blockquote><blockquote><p>Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ   ğŸ³ï¸â˜ƒï¸</p></blockquote><ul><li>åŸºäºå†…å­˜æ“ä½œ</li><li>æ•°æ®ç»“æ„ä¼˜åŒ–</li><li>å•çº¿ç¨‹äº‹ä»¶é©±åŠ¨æ¨¡å‹</li><li>ä¸“é—¨ä¸ºé«˜æ€§èƒ½è€Œè®¾è®¡ï¼ˆä¸“æ³¨äºæ ¸å¿ƒåŠŸèƒ½ï¼Œè®¾è®¡ç®€æ´ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼‰</li></ul><p>è¿™é“é¢˜ç›®çš„å»¶ç”³éœ€è¦çœ‹ä¸€ä¸‹ï¼ˆä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼‰  </p><ul><li>1.æ•°æ®å­˜äºå†…å­˜ 2.ç”¨äº†å¤šè·¯å¤ç”¨I&#x2F;O 3.å•çº¿ç¨‹</li></ul><blockquote><p>Redis å’Œ Memcached çš„åŒºåˆ«å’Œå…±åŒç‚¹</p></blockquote><div style="background-color: #ecf0f1; color: #34495e; padding: 15px; border: 2px solid #bdc3c7; border-radius: 5px;">  <strong>åŒºåˆ«ç‚¹ï¼š</strong>å®é™…å›ç­”çš„æ—¶å€™å»ºè®®é€šè¿‡ä»Redis çš„ä¸€äº›ç‰¹æ€§å»å›ç­”ï¼Œå¦‚æœé—®åˆ° Memcached åˆ°æ—¶å€™å¯ä»¥ä» æ•°æ®ç±»å‹ã€è¿‡æœŸç­–ç•¥ã€é›†ç¾¤ã€æŒä¹…åŒ–æ–¹é¢å»å›ç­”ä¸»è¦åŒºåˆ«ç‚¹ã€‚</div><ul><li>1ã€ä¸¤è€…éƒ½æ˜¯é«˜æ€§èƒ½çš„å†…å­˜ç¼“å­˜ç³»ç»Ÿï¼Œä½†åœ¨è®¾è®¡ã€ä½¿ç”¨ã€åŠŸèƒ½æœ‰ä¸€äº›å¼‚åŒ</li><li>2ã€åŒï¼šåŸºäºå†…å­˜ã€é«˜æ€§èƒ½è¯»å†™ã€é”®å€¼æ¨¡å‹ã€ç”¨ä½œç¼“å­˜ã€éƒ½æœ‰è¿‡æœŸç­–ç•¥</li><li>3ã€ä¸åŒ<ul><li>æŒä¹…åŒ–</li><li>æ•°æ®ç±»å‹ï¼šRedis çš„æ•°æ®ç±»å‹æ›´åŠ ä¸°å¯Œï¼ŒMemcached æ”¯æŒç®€å•çš„ ï¼Ÿ</li><li>åˆ†å¸ƒå¼æ”¯æŒ</li></ul></li></ul><p>å¾…æ•´ç† to be continedâ€¦</p><p><strong>åŒºåˆ«</strong>ï¼š</p><ol><li><strong>Redis æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼ˆæ”¯æŒæ›´å¤æ‚çš„åº”ç”¨åœºæ™¯ï¼‰</strong>ã€‚Redis ä¸ä»…ä»…æ”¯æŒç®€å•çš„ k&#x2F;v ç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾› listï¼Œsetï¼Œzsetï¼Œhash ç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚Memcached åªæ”¯æŒæœ€ç®€å•çš„ k&#x2F;v æ•°æ®ç±»å‹ã€‚</li><li><strong>Redis æ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨,è€Œ Memcached æŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ã€‚</strong></li><li><strong>Redis æœ‰ç¾éš¾æ¢å¤æœºåˆ¶ã€‚</strong> å› ä¸ºå¯ä»¥æŠŠç¼“å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚</li><li><strong>Redis åœ¨æœåŠ¡å™¨å†…å­˜ä½¿ç”¨å®Œä¹‹åï¼Œå¯ä»¥å°†ä¸ç”¨çš„æ•°æ®æ”¾åˆ°ç£ç›˜ä¸Šã€‚ä½†æ˜¯ï¼ŒMemcached åœ¨æœåŠ¡å™¨å†…å­˜ä½¿ç”¨å®Œä¹‹åï¼Œå°±ä¼šç›´æ¥æŠ¥å¼‚å¸¸ã€‚</strong></li><li><strong>Memcached æ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›ä½†æ˜¯ Redis ç›®å‰æ˜¯åŸç”Ÿæ”¯æŒ cluster æ¨¡å¼çš„ã€‚</strong></li><li><strong>Memcached æ˜¯å¤šçº¿ç¨‹ï¼Œéé˜»å¡ IO å¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼›Redis ä½¿ç”¨å•çº¿ç¨‹çš„å¤šè·¯ IO å¤ç”¨æ¨¡å‹ã€‚</strong> ï¼ˆRedis 6.0 é’ˆå¯¹ç½‘ç»œæ•°æ®çš„è¯»å†™å¼•å…¥äº†å¤šçº¿ç¨‹ï¼‰</li><li><strong>Redis æ”¯æŒå‘å¸ƒè®¢é˜…æ¨¡å‹ã€Lua è„šæœ¬ã€äº‹åŠ¡ç­‰åŠŸèƒ½ï¼Œè€Œ Memcached ä¸æ”¯æŒã€‚å¹¶ä¸”ï¼ŒRedis æ”¯æŒæ›´å¤šçš„ç¼–ç¨‹è¯­è¨€ã€‚</strong></li><li><strong>Memcached è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–ç•¥åªç”¨äº†æƒ°æ€§åˆ é™¤ï¼Œè€Œ Redis åŒæ—¶ä½¿ç”¨äº†æƒ°æ€§åˆ é™¤ä¸å®šæœŸåˆ é™¤ã€‚</strong></li></ol><h4 id="å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥"><a href="#å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥" class="headerlink" title="å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥"></a>å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥</h4><div style="background-color: #f2c867; color: #34495e; padding: 15px; border: 2px solid #bdc3c7; border-radius: 5px;">  <strong>ç¼“å­˜å¸¸ç”¨çš„ä¸‰ç§è¯»å†™ç­–ç•¥ï¼š</strong>Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰ã€Read/Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰ã€Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰</div><ul><li>å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥<ul><li>Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰<ul><li>è¯»<ul><li>ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å›</li><li>cache ä¸­è¯»å–ä¸åˆ°çš„è¯ï¼Œå°±ä» db ä¸­è¯»å–æ•°æ®è¿”å›</li><li>å†æŠŠæ•°æ®æ”¾åˆ° cache ä¸­ã€‚</li></ul></li><li>å†™<ul><li>å…ˆæ›´æ–° db</li><li>ç„¶åç›´æ¥åˆ é™¤ cache</li></ul></li></ul></li><li>Read&#x2F;Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰<ul><li>è¯»<ul><li>ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å› ã€‚</li><li>è¯»å–ä¸åˆ°çš„è¯ï¼Œå…ˆä» db åŠ è½½ï¼Œå†™å…¥åˆ° cache åè¿”å›å“åº”ã€‚</li></ul></li><li>å†™<ul><li>å…ˆæŸ¥ cacheï¼Œcache ä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥æ›´æ–° dbã€‚</li><li>cache ä¸­å­˜åœ¨ï¼Œåˆ™å…ˆæ›´æ–° cacheï¼Œç„¶å cache æœåŠ¡è‡ªå·±æ›´æ–° dbï¼ˆ<strong>åŒæ­¥æ›´æ–° cache å’Œ db</strong>ï¼‰ã€‚</li></ul></li></ul></li><li>Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰<ul><li>è¯»</li><li>å†™<ul><li>**Read&#x2F;Write Through æ˜¯åŒæ­¥æ›´æ–° cache å’Œ dbï¼Œ</li><li>Write Behind åˆ™æ˜¯åªæ›´æ–°ç¼“å­˜ï¼Œä¸ç›´æ¥æ›´æ–° dbï¼Œè€Œæ˜¯æ”¹ä¸ºå¼‚æ­¥æ‰¹é‡çš„æ–¹å¼æ¥æ›´æ–° db</li></ul></li></ul></li></ul></li></ul><p><strong>ä¸‰ç§æ¨¡å¼å„æœ‰ä¼˜åŠ£ï¼Œä¸å­˜åœ¨æœ€ä½³æ¨¡å¼ï¼Œæ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯é€‰æ‹©é€‚åˆè‡ªå·±çš„ç¼“å­˜è¯»å†™æ¨¡å¼ã€‚</strong></p><h5 id="Cache-Aside-Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰"><a href="#Cache-Aside-Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰" class="headerlink" title="Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰"></a>Cache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰</h5><p>é€‚åˆè¯»æ¯”è¾ƒå¤šçš„æƒ…å†µ</p><p>å†™ï¼š</p><ul><li>å…ˆæ›´æ–° db</li><li>ç„¶åç›´æ¥åˆ é™¤ cache</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231225211100.png" alt="image.png"></p><p><strong>è¯»</strong>Â :</p><ul><li>ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å›</li><li>cache ä¸­è¯»å–ä¸åˆ°çš„è¯ï¼Œå°±ä» db ä¸­è¯»å–æ•°æ®è¿”å›</li><li>å†æŠŠæ•°æ®æ”¾åˆ° cache ä¸­ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231225211235.png" alt="image.png"></p><blockquote><p><strong>åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆåˆ é™¤ cache ï¼Œåæ›´æ–° db ä¹ˆï¼Ÿ</strong></p></blockquote><p>è¿™ç§æ“ä½œä¸èƒ½è¿›è¡Œï¼Œä¼šé€ æˆæ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä¸¾ä¾‹ï¼šè¯·æ±‚ 1 å…ˆå†™æ•°æ® Aï¼Œè¯·æ±‚ 2 éšåè¯»æ•°æ® A çš„è¯ï¼Œå°±å¾ˆæœ‰å¯èƒ½äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p><p>è¯´æ˜ï¼š</p><p>å½“æœ‰ä¸€ä¸ªè¯·æ±‚ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºè¯·æ±‚1ï¼‰æ¥æ›´æ–°æŸä¸ªæ•°æ®é¡¹ï¼ˆç§°ä¸ºæ•°æ®Aï¼‰æ—¶ï¼Œä½ é¢ä¸´ä¸€ä¸ªé€‰æ‹©ï¼šæ˜¯å…ˆæ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®Aï¼Œç„¶åå†åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®Aï¼Œè¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®Aï¼Œç„¶åæ›´æ–°æ•°æ®åº“ï¼Ÿ</p><p>å¦‚æœé€‰æ‹©åè€…ï¼ˆå³å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“ï¼‰ï¼Œä¼šæœ‰ä»¥ä¸‹é£é™©ï¼š</p><ol><li><strong>è¯·æ±‚1</strong>å…ˆåˆ é™¤äº†ç¼“å­˜ä¸­çš„æ•°æ®Aã€‚</li><li>ç„¶åï¼Œåœ¨<strong>è¯·æ±‚1</strong>æ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®Aä¹‹å‰ï¼Œå¦ä¸€ä¸ªè¯·æ±‚ï¼ˆç§°ä¹‹ä¸ºè¯·æ±‚2ï¼‰æ¥è¯»å–æ•°æ®Aã€‚</li><li><strong>è¯·æ±‚2</strong>åœ¨ç¼“å­˜ä¸­æ‰¾ä¸åˆ°æ•°æ®Aï¼ˆå› ä¸ºå·²ç»è¢«åˆ é™¤ï¼‰ï¼Œæ‰€ä»¥å®ƒä»æ•°æ®åº“ä¸­è¯»å–äº†æ—§çš„æ•°æ®Aã€‚</li><li>æ­¤æ—¶ï¼Œ<strong>è¯·æ±‚1</strong>æ›´æ–°äº†æ•°æ®åº“ä¸­çš„æ•°æ®Aã€‚</li><li>ç»“æœæ˜¯ï¼Œç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®Açš„è®°å½•ï¼ˆå·²è¢«åˆ é™¤ï¼‰ï¼Œè€Œæ•°æ®åº“ä¸­æœ‰æ–°çš„æ•°æ®Aã€‚<strong>è¯·æ±‚2</strong>æŒæœ‰çš„æ˜¯è¿‡æ—¶çš„æ•°æ®ã€‚</li></ol><p>è¿™ç§æƒ…å†µå°±å¯¼è‡´äº†æ•°æ®ä¸ä¸€è‡´ï¼šç¼“å­˜å¤±æ•ˆäº†ï¼Œä½†æ˜¯è¯·æ±‚2è¯»å–åˆ°äº†æ—§çš„æ•°æ®ã€‚ä¸‹æ¬¡æœ‰è¯·æ±‚æ¥è¯»å–æ•°æ®Aæ—¶ï¼Œå®ƒä¼šå†æ¬¡ä»æ•°æ®åº“ä¸­è¯»å–å¹¶ç¼“å­˜æ–°çš„æ•°æ®Aï¼Œä½†åœ¨è¿™ä¹‹å‰ï¼Œç³»ç»Ÿä¸­å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„çŠ¶æ€ã€‚</p><p>é€šå¸¸ï¼Œæ›´å¥½çš„åšæ³•æ˜¯ï¼š</p><ol><li><strong>å…ˆæ›´æ–°æ•°æ®åº“</strong>ä¸­çš„æ•°æ®Aã€‚</li><li><strong>ç„¶ååˆ é™¤ç¼“å­˜</strong>ä¸­çš„æ•°æ®Aã€‚</li></ol><p>è¿™æ ·ï¼Œå³ä½¿åœ¨æ•°æ®åº“æ›´æ–°å’Œç¼“å­˜åˆ é™¤ä¹‹é—´æœ‰è¯»å–è¯·æ±‚ï¼Œå®ƒä¹Ÿåªä¼šè¯»åˆ°æ—§çš„æ•°æ®ï¼Œä¸€æ—¦ç¼“å­˜è¢«åˆ é™¤ï¼Œ<strong>ä¸‹ä¸€ä¸ªè¯»å–è¯·æ±‚å°†ä»æ•°æ®åº“ä¸­è·å–æœ€æ–°çš„æ•°æ®ï¼Œå¹¶æ›´æ–°ç¼“å­˜</strong>ï¼Œä»è€Œä¿æŒäº†ä¸€è‡´æ€§ã€‚</p><blockquote><p><strong>åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆæ›´æ–° dbï¼Œååˆ é™¤ cache å°±æ²¡æœ‰é—®é¢˜äº†ä¹ˆï¼Ÿ</strong></p></blockquote><p>ç†è®ºä¸Šä»ç„¶æ˜¯ä¼šå‡ºç°çš„ï¼Œä½†æ¦‚ç‡éå¸¸å°ï¼Œç¼“å­˜çš„å†™å…¥é€Ÿåº¦æ¯”æ•°æ®åº“çš„å†™å…¥é€Ÿåº¦å¿«å¾ˆå¤šã€‚</p><p>ç‰¹å®šæƒ…å†µï¼š</p><ul><li>åœ¨æ•°æ®åº“æ›´æ–°ä¹‹åï¼Œä½†åœ¨ç¼“å­˜åˆ é™¤ä¹‹å‰ï¼Œå¦‚æœå¦ä¸€ä¸ªè¯·æ±‚ï¼ˆç§°ä¸ºè¯·æ±‚2ï¼‰æ¥è¯»å–åŒä¸€æ•°æ®ï¼Œå®ƒå°†ä»ç¼“å­˜ä¸­è·å–åˆ°æ—§çš„æ•°æ®ã€‚å› ä¸ºæ­¤æ—¶ç¼“å­˜å°šæœªè¢«æ›´æ–°æˆ–åˆ é™¤ã€‚</li><li>ä¸€æ—¦ç¼“å­˜è¢«åˆ é™¤ï¼Œéšåçš„è¯·æ±‚å°†ä»æ•°æ®åº“ä¸­è¯»å–æœ€æ–°çš„æ•°æ®ï¼Œå¹¶æ›´æ–°ç¼“å­˜ã€‚ä½†åœ¨è¿™ä¸ªçŸ­æš‚çš„æ—¶æœŸå†…ï¼Œæ—§çš„ç¼“å­˜æ•°æ®å’Œæ–°çš„æ•°æ®åº“æ•°æ®ä¹‹é—´å­˜åœ¨ä¸ä¸€è‡´ã€‚</li></ul><blockquote><p><strong>Cache Aside Pattern çš„ç¼ºé™·</strong>ä»¥åŠè§£å†³æ–¹æ¡ˆ</p></blockquote><p><strong>ç¼ºé™· 1ï¼šé¦–æ¬¡è¯·æ±‚æ•°æ®ä¸€å®šä¸åœ¨ cache çš„é—®é¢˜</strong></p><p>è§£å†³åŠæ³•ï¼šå¯ä»¥å°†çƒ­ç‚¹æ•°æ®å¯ä»¥æå‰æ”¾å…¥ cache ä¸­ã€‚</p><p><strong>ç¼ºé™· 2ï¼šå†™æ“ä½œæ¯”è¾ƒé¢‘ç¹çš„è¯å¯¼è‡´ cache ä¸­çš„æ•°æ®ä¼šè¢«é¢‘ç¹è¢«åˆ é™¤ï¼Œè¿™æ ·ä¼šå½±å“ç¼“å­˜å‘½ä¸­ç‡ ã€‚</strong></p><p>è§£å†³åŠæ³•ï¼š</p><ul><li>æ•°æ®åº“å’Œç¼“å­˜æ•°æ®å¼ºä¸€è‡´åœºæ™¯ï¼š<ul><li>æ›´æ–° db çš„æ—¶å€™åŒæ ·æ›´æ–° cacheï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªé”&#x2F;åˆ†å¸ƒå¼é”æ¥ä¿è¯æ›´æ–° cache çš„æ—¶å€™ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li></ul></li><li>å¯ä»¥çŸ­æš‚åœ°å…è®¸æ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„åœºæ™¯ï¼š<ul><li>æ›´æ–° db çš„æ—¶å€™åŒæ ·æ›´æ–° cacheï¼Œä½†æ˜¯ç»™ç¼“å­˜åŠ ä¸€ä¸ªæ¯”è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®ä¸ä¸€è‡´çš„è¯å½±å“ä¹Ÿæ¯”è¾ƒå°</li></ul></li></ul><h5 id="Read-Write-Through-Patternï¼ˆè¯»å†™ç©¿é€ï¼‰"><a href="#Read-Write-Through-Patternï¼ˆè¯»å†™ç©¿é€ï¼‰" class="headerlink" title="Read&#x2F;Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰"></a>Read&#x2F;Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰</h5><p>Read&#x2F;Write Through Pattern ä¸­æœåŠ¡ç«¯æŠŠ cache è§†ä¸ºä¸»è¦æ•°æ®å­˜å‚¨ï¼Œä»ä¸­è¯»å–æ•°æ®å¹¶å°†æ•°æ®å†™å…¥å…¶ä¸­ã€‚</p><p>cache æœåŠ¡è´Ÿè´£å°†æ­¤æ•°æ®è¯»å–å’Œå†™å…¥ dbï¼Œä»è€Œå‡è½»äº†åº”ç”¨ç¨‹åºçš„èŒè´£ã€‚</p><p><strong>å†™ï¼ˆWrite Throughï¼‰ï¼š</strong></p><ul><li>å…ˆæŸ¥ cacheï¼Œcache ä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥æ›´æ–° dbã€‚</li><li>cache ä¸­å­˜åœ¨ï¼Œåˆ™å…ˆæ›´æ–° cacheï¼Œç„¶å cache æœåŠ¡è‡ªå·±æ›´æ–° dbï¼ˆ<strong>åŒæ­¥æ›´æ–° cache å’Œ db</strong>ï¼‰ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231225212801.png" alt="image.png"></p><p><strong>è¯»(Read Through)ï¼š</strong></p><ul><li>ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å› ã€‚</li><li>è¯»å–ä¸åˆ°çš„è¯ï¼Œå…ˆä» db åŠ è½½ï¼Œå†™å…¥åˆ° cache åè¿”å›å“åº”ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231225212846.png" alt="image.png"></p><p>å’Œ Cache Aside Pattern ä¸€æ ·ï¼Œ Read-Through Pattern ä¹Ÿæœ‰é¦–æ¬¡è¯·æ±‚æ•°æ®ä¸€å®šä¸å† cache çš„é—®é¢˜ï¼Œå¯¹äºçƒ­ç‚¹æ•°æ®å¯ä»¥æå‰æ”¾å…¥ç¼“å­˜ä¸­ã€‚</p><p>Read&#x2F;Write Through Patternï¼ˆè¯»å†™ç©¿é€ï¼‰è¿™ç§æ–¹å¼ä½¿ç”¨çš„ä¸å¤šï¼Œæˆ‘ä»¬å¸¸ç”¨çš„åˆ†å¸ƒå¼ç¼“å­˜Rediså¹¶æ²¡æœ‰æä¾› cache å°†æ•°æ®å†™å…¥ db çš„åŠŸèƒ½ã€‚</p><h5 id="Write-Behind-Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰"><a href="#Write-Behind-Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰" class="headerlink" title="Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰"></a>Write Behind Patternï¼ˆå¼‚æ­¥ç¼“å­˜å†™å…¥ï¼‰</h5><p>Write Behind Pattern å’Œ Read&#x2F;Write Through Pattern å¾ˆç›¸ä¼¼ï¼Œä¸¤è€…éƒ½æ˜¯ç”± cache æœåŠ¡æ¥è´Ÿè´£ cache å’Œ db çš„è¯»å†™ã€‚</p><p>ä¸åŒç‚¹ï¼š</p><ul><li>**Read&#x2F;Write Through æ˜¯åŒæ­¥æ›´æ–° cache å’Œ dbï¼Œ</li><li>Write Behind åˆ™æ˜¯åªæ›´æ–°ç¼“å­˜ï¼Œä¸ç›´æ¥æ›´æ–° dbï¼Œè€Œæ˜¯æ”¹ä¸ºå¼‚æ­¥æ‰¹é‡çš„æ–¹å¼æ¥æ›´æ–° db</li></ul><p>æ•°æ®ä¸€è‡´æ€§é£é™©å¾ˆå¤§ï¼Œä¸è¿‡Write Behind Pattern ä¸‹ db çš„å†™æ€§èƒ½éå¸¸é«˜ï¼Œéå¸¸é€‚åˆä¸€äº›æ•°æ®ç»å¸¸å˜åŒ–åˆå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æ²¡é‚£ä¹ˆé«˜çš„åœºæ™¯ï¼Œæ¯”å¦‚æµè§ˆé‡ã€ç‚¹èµé‡ã€‚</p><h3 id="2ã€Redis-çš„å¸¸ç”¨æ•°æ®ç±»å‹"><a href="#2ã€Redis-çš„å¸¸ç”¨æ•°æ®ç±»å‹" class="headerlink" title="2ã€Redis çš„å¸¸ç”¨æ•°æ®ç±»å‹"></a>2ã€Redis çš„å¸¸ç”¨æ•°æ®ç±»å‹</h3><ul><li><strong>5ç§åŸºç¡€æ•°æ®ç±»å‹</strong>ï¼Œåˆ†åˆ«æ˜¯ï¼šStringã€Listã€Setã€Zsetã€Hashã€‚</li></ul><table><thead><tr><th>ç»“æ„ç±»å‹</th><th>ç»“æ„å­˜å‚¨çš„å€¼</th><th>ç»“æ„çš„è¯»å†™èƒ½åŠ›</th></tr></thead><tbody><tr><td><strong>Stringå­—ç¬¦ä¸²</strong></td><td>å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–æµ®ç‚¹æ•°</td><td>å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ“ä½œï¼›å¯¹æ•´æ•°æˆ–æµ®ç‚¹æ•°è¿›è¡Œè‡ªå¢æˆ–è‡ªå‡æ“ä½œï¼›</td></tr><tr><td><strong>Liståˆ—è¡¨</strong></td><td>ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²</td><td>å¯¹é“¾è¡¨çš„ä¸¤ç«¯è¿›è¡Œpushå’Œpopæ“ä½œï¼Œè¯»å–å•ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼›æ ¹æ®å€¼æŸ¥æ‰¾æˆ–åˆ é™¤å…ƒç´ ï¼›</td></tr><tr><td><strong>Seté›†åˆ</strong></td><td>åŒ…å«å­—ç¬¦ä¸²çš„æ— åºé›†åˆ</td><td>å­—ç¬¦ä¸²çš„é›†åˆï¼ŒåŒ…å«åŸºç¡€çš„æ–¹æ³•æœ‰çœ‹æ˜¯å¦å­˜åœ¨æ·»åŠ ã€è·å–ã€åˆ é™¤ï¼›è¿˜åŒ…å«è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰</td></tr><tr><td><strong>Hashæ•£åˆ—</strong></td><td>åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td><td>åŒ…å«æ–¹æ³•æœ‰æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ </td></tr><tr><td><strong>Zsetæœ‰åºé›†åˆ</strong></td><td>å’Œæ•£åˆ—ä¸€æ ·ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹</td><td>å­—ç¬¦ä¸²æˆå‘˜ä¸æµ®ç‚¹æ•°åˆ†æ•°ä¹‹é—´çš„æœ‰åºæ˜ å°„ï¼›å…ƒç´ çš„æ’åˆ—é¡ºåºç”±åˆ†æ•°çš„å¤§å°å†³å®šï¼›åŒ…å«æ–¹æ³•æœ‰æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ ä»¥åŠæ ¹æ®åˆ†å€¼èŒƒå›´æˆ–æˆå‘˜æ¥è·å–å…ƒç´ </td></tr></tbody></table><ul><li><strong>ä¸‰ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹</strong>Â åˆ†åˆ«æ˜¯ HyperLogLogsï¼ˆåŸºæ•°ç»Ÿè®¡ï¼‰ï¼Œ Bitmaps (ä½å›¾) å’Œ geospatial ï¼ˆåœ°ç†ä½ç½®)</li></ul><p>Redis çš„æ•°æ®è¡¨ç¤º</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312251645493.png" alt="image.png|300"></p><p>ä¸»è¦è®²è¿°ä¸€ä¸‹ Redis çš„äº”ç§åŸºç¡€æ•°æ®ç±»å‹</p><p>ç›¸å…³çš„ä½¿ç”¨éœ€è¦ç»†è®²ä¸€ä¸‹ to be continedâ€¦.</p><h4 id="å­—ç¬¦ä¸²ï¼ˆStringsï¼‰"><a href="#å­—ç¬¦ä¸²ï¼ˆStringsï¼‰" class="headerlink" title="å­—ç¬¦ä¸²ï¼ˆStringsï¼‰"></a>å­—ç¬¦ä¸²ï¼ˆStringsï¼‰</h4><ul><li><strong>æè¿°</strong>ï¼šå­—ç¬¦ä¸²æ˜¯Redisæœ€åŸºæœ¬çš„ç±»å‹ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•å½¢å¼çš„å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬äºŒè¿›åˆ¶æ•°æ®ï¼‰ï¼Œæœ€å¤§å¯ä»¥æ”¯æŒ512MBã€‚</li><li><strong>åº•å±‚å®ç°</strong>ï¼šç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Strings, SDSï¼‰ï¼Œå®ƒå¯ä»¥æ›´æœ‰æ•ˆåœ°å¢é•¿å’Œç¼©å°ï¼Œé¿å…äº†Cå­—ç¬¦ä¸²çš„ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚</li></ul><h4 id="é›†åˆ-Sets"><a href="#é›†åˆ-Sets" class="headerlink" title="é›†åˆ(Sets)"></a>é›†åˆ(Sets)</h4><ul><li><strong>æè¿°</strong>ï¼šé›†åˆæ˜¯å­—ç¬¦ä¸²çš„æ— åºé›†åˆï¼Œä¸”é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li><li><strong>åº•å±‚å®ç°</strong>ï¼šå½“å…ƒç´ æ•°é‡è¾ƒå°‘ä¸”éƒ½æ˜¯æ•´æ•°æ—¶ï¼Œä½¿ç”¨æ•´æ•°é›†åˆï¼ˆintsetï¼‰å®ç°ï¼›å¦åˆ™ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨å®ç°ï¼Œä»¥æ”¯æŒæ›´å¤§çš„é›†åˆå’Œå¤æ‚å…ƒç´ ã€‚</li></ul><p>Redisçš„é›†åˆæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„æ— åºé›†åˆã€‚å®ƒå¯ä»¥è‡ªåŠ¨å»é‡ï¼Œéå¸¸é€‚åˆå­˜å‚¨ä¸é‡å¤çš„æ•°æ®é›†ã€‚</p><h4 id="åˆ—è¡¨-Lists"><a href="#åˆ—è¡¨-Lists" class="headerlink" title="åˆ—è¡¨(Lists)"></a>åˆ—è¡¨(Lists)</h4><ul><li><strong>æè¿°</strong>ï¼šåˆ—è¡¨ç”¨äºå­˜å‚¨ä¸€ä¸ªæœ‰åºçš„å­—ç¬¦ä¸²é›†åˆï¼Œç±»ä¼¼äºJavaçš„LinkedListï¼Œæ”¯æŒåœ¨ä¸¤ç«¯æ¨å…¥æˆ–å¼¹å‡ºå…ƒç´ ã€‚</li><li><strong>åº•å±‚å®ç°</strong>ï¼šRedisåˆ—è¡¨ä½¿ç”¨åŒå‘é“¾è¡¨ï¼ˆlinked listï¼‰å®ç°ï¼Œä¹Ÿä¼šæ ¹æ®å®é™…ä½¿ç”¨åœºæ™¯åœ¨å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰å’ŒåŒå‘é“¾è¡¨ä¹‹é—´åŠ¨æ€è½¬æ¢ã€‚å°åˆ—è¡¨ä½¿ç”¨ziplistï¼Œå¯ä»¥èŠ‚çœç©ºé—´ï¼Œå½“åˆ—è¡¨å…ƒç´ è¾ƒå¤šæˆ–å…ƒç´ å¤§å°è¾ƒå¤§æ—¶ï¼Œè½¬æ¢ä¸ºlinked listã€‚</li></ul><p>Redisåˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰æ’å…¥é¡ºåºæ’åºã€‚å®ƒå¯ä»¥ç”¨ä½œé˜Ÿåˆ—ï¼Œæ”¯æŒåœ¨åˆ—è¡¨çš„å¤´éƒ¨æˆ–å°¾éƒ¨æ·»åŠ å…ƒç´ ã€‚</p><h4 id="æœ‰åºé›†åˆï¼ˆSorted-Setsï¼‰"><a href="#æœ‰åºé›†åˆï¼ˆSorted-Setsï¼‰" class="headerlink" title="æœ‰åºé›†åˆï¼ˆSorted Setsï¼‰"></a>æœ‰åºé›†åˆï¼ˆSorted Setsï¼‰</h4><ul><li><strong>æè¿°</strong>ï¼šæœ‰åºé›†åˆä¸é›†åˆç±»ä¼¼ï¼Œä½†æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªåŒç²¾åº¦çš„åˆ†æ•°ï¼ŒRedisä¼šæ ¹æ®åˆ†æ•°å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</li><li><strong>åº•å±‚å®ç°</strong>ï¼šè·³è¡¨ï¼ˆskiplistï¼‰å’Œå“ˆå¸Œè¡¨çš„ç»“åˆã€‚è·³è¡¨ç”¨äºæŒ‰åˆ†æ•°æ’åºå’ŒèŒƒå›´æŸ¥è¯¢ï¼Œè€Œå“ˆå¸Œè¡¨åˆ™ç”¨äºå¿«é€Ÿè®¿é—®å…ƒç´ ã€‚</li></ul><p>æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°åˆ†æ•°ï¼ŒRedisé€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆ ZSet çš„åº•å±‚ç»“æ„ä½¿ç”¨è·³è¡¨å’Œå“ˆå¸Œè¡¨çš„ç»“åˆï¼Œç»†è®²ä¸€ä¸‹</p></blockquote><h4 id="å“ˆå¸Œï¼ˆHashesï¼‰"><a href="#å“ˆå¸Œï¼ˆHashesï¼‰" class="headerlink" title="å“ˆå¸Œï¼ˆHashesï¼‰"></a>å“ˆå¸Œï¼ˆHashesï¼‰</h4><ul><li><strong>æè¿°</strong>ï¼šå“ˆå¸Œæ˜¯é”®å€¼å¯¹é›†åˆï¼Œé€‚ç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</li><li><strong>åº•å±‚å®ç°</strong>ï¼šç±»ä¼¼äºåˆ—è¡¨çš„å®ç°ï¼Œå°çš„å“ˆå¸Œé›†åˆä½¿ç”¨å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰æ¥èŠ‚çœç©ºé—´ï¼Œè€Œå¤§çš„å“ˆå¸Œé›†åˆä½¿ç”¨å“ˆå¸Œè¡¨ã€‚</li></ul><p>é€‚ç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œç±»ä¼¼äºJavaçš„<code>HashMap</code>ï¼Œå¯ä»¥å°†å¤šä¸ªé”®å€¼å¯¹å­˜å‚¨åˆ°ä¸€ä¸ªRedisé”®é‡Œã€‚</p><h4 id="é«˜çº§æ•°æ®ç±»å‹"><a href="#é«˜çº§æ•°æ®ç±»å‹" class="headerlink" title="é«˜çº§æ•°æ®ç±»å‹"></a>é«˜çº§æ•°æ®ç±»å‹</h4><blockquote><p>ä½å›¾ï¼ˆBitmapsï¼‰ã€HyperLogLogsã€åœ°ç†ç©ºé—´ç´¢å¼•ï¼ˆGeospatial Indexesï¼‰</p></blockquote><p>è¿™äº›é«˜çº§æ•°æ®ç±»å‹æ”¯æŒæ›´å¤æ‚çš„æ•°æ®åœºæ™¯ï¼Œå¦‚ç»Ÿè®¡ã€åœ°ç†ä½ç½®æœåŠ¡ç­‰ã€‚</p><h3 id="3ã€Redis-åº”ç”¨ï¼ˆä½¿ç”¨åœºæ™¯ï¼‰"><a href="#3ã€Redis-åº”ç”¨ï¼ˆä½¿ç”¨åœºæ™¯ï¼‰" class="headerlink" title="3ã€Redis åº”ç”¨ï¼ˆä½¿ç”¨åœºæ™¯ï¼‰"></a>3ã€Redis åº”ç”¨ï¼ˆä½¿ç”¨åœºæ™¯ï¼‰</h3><p>Redis èƒ½åšä»€ä¹ˆ</p><ul><li>ç¼“å­˜ç³»ç»Ÿ</li><li>åˆ†å¸ƒå¼é”</li><li>è®¡æ•°å™¨&#x2F;æ’è¡Œæ¦œ</li><li>åˆ†å¸ƒå¼ sessionï¼ˆä¿å­˜ tokenï¼‰</li><li>æ¶ˆæ¯é˜Ÿåˆ—ã€å»¶æ—¶é˜Ÿåˆ—</li><li>é™æµ</li><li>å®æ—¶åˆ†æ</li></ul><blockquote><p>ç¼“å­˜ç³»ç»Ÿ</p></blockquote><ul><li>ç©¿é€ã€å‡»ç©¿ã€é›ªå´©</li><li>åŒå†™ä¸€è‡´ã€æŒä¹…åŒ–</li><li>æ•°æ®è¿‡æœŸã€æ·˜æ±°ç­–ç•¥</li></ul><blockquote><p>åˆ†å¸ƒå¼é”</p></blockquote><ul><li>setnx  redisson</li></ul><h4 id="åˆ†å¸ƒå¼é”-ğŸš©"><a href="#åˆ†å¸ƒå¼é”-ğŸš©" class="headerlink" title="åˆ†å¸ƒå¼é”  ğŸš©"></a>åˆ†å¸ƒå¼é”  ğŸš©</h4><p>è§ï¼š[[Lotteryå¾®æœåŠ¡æŠ½å¥–ç³»ç»Ÿ#2.17 è®¾è®¡æ»‘åŠ¨åº“å­˜åˆ†å¸ƒå¼é”å¤„ç†æ´»åŠ¨ç§’æ€ ğŸš©]]</p><p>æ ¸å¿ƒï¼šsetnx  redisson</p><h3 id="4-ã€Redis-æŒä¹…åŒ–æœºåˆ¶-ğŸš©"><a href="#4-ã€Redis-æŒä¹…åŒ–æœºåˆ¶-ğŸš©" class="headerlink" title="4 ã€Redis æŒä¹…åŒ–æœºåˆ¶  ğŸš©"></a>4 ã€Redis æŒä¹…åŒ–æœºåˆ¶  ğŸš©</h3><p>å®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://redis.io/topics/persistence">https://redis.io/topics/persistence</a>Â ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼šä½¿ç”¨ç¼“å­˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¯¹å†…å­˜ä¸­çš„æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ä¹Ÿå°±æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ç¡¬ç›˜ä¸­ã€‚å¤§éƒ¨åˆ†åŸå› æ˜¯ä¸ºäº†ä¹‹åé‡ç”¨æ•°æ®ï¼ˆæ¯”å¦‚é‡å¯æœºå™¨ã€æœºå™¨æ•…éšœä¹‹åæ¢å¤æ•°æ®ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸ºäº†åšæ•°æ®åŒæ­¥ï¼ˆæ¯”å¦‚ Redis é›†ç¾¤çš„ä¸»ä»èŠ‚ç‚¹é€šè¿‡ RDB æ–‡ä»¶åŒæ­¥æ•°æ®ï¼‰ã€‚</p><blockquote><p>æŒä¹…åŒ–æ–¹å¼</p></blockquote><p>Redis æ”¯æŒæŒä¹…åŒ–ï¼Œè€Œä¸”æ”¯æŒ 3 ç§æŒä¹…åŒ–æ–¹å¼:</p><ul><li>å¿«ç…§ï¼ˆsnapshottingï¼ŒRDBï¼‰</li><li>åªè¿½åŠ æ–‡ä»¶ï¼ˆappend-only file, AOFï¼‰</li><li>RDB å’Œ AOF çš„æ··åˆæŒä¹…åŒ–(Redis 4.0 æ–°å¢)</li></ul><p>ä¸ RDB æŒä¹…åŒ–ç›¸æ¯”ï¼ŒAOF æŒä¹…åŒ–çš„å®æ—¶æ€§æ›´å¥½ã€‚åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ä¸‰ç§ä¸åŒçš„ AOF æŒä¹…åŒ–æ–¹å¼ï¼ˆÂ <code>fsync</code>ç­–ç•¥ï¼‰ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">appendfsync</span> always    <span class="hljs-comment">#æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šè°ƒç”¨fsyncå‡½æ•°åŒæ­¥AOFæ–‡ä»¶,fsyncå®Œæˆåçº¿ç¨‹è¿”å›,è¿™æ ·ä¼šä¸¥é‡é™ä½Redisçš„é€Ÿåº¦</span><br>appendfsync everysec  <span class="hljs-comment">#æ¯ç§’é’Ÿè°ƒç”¨fsyncå‡½æ•°åŒæ­¥ä¸€æ¬¡AOFæ–‡ä»¶</span><br>appendfsync <span class="hljs-literal">no</span>        <span class="hljs-comment">#è®©æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶è¿›è¡ŒåŒæ­¥ï¼Œä¸€èˆ¬ä¸º30ç§’ä¸€æ¬¡</span><br></code></pre></td></tr></table></figure><p>AOF æŒä¹…åŒ–çš„<code>fsync</code>ç­–ç•¥ä¸º noã€everysec æ—¶éƒ½ä¼šå­˜åœ¨æ•°æ®ä¸¢å¤±çš„æƒ…å†µ ã€‚always ä¸‹å¯ä»¥åŸºæœ¬æ˜¯å¯ä»¥æ»¡è¶³æŒä¹…æ€§è¦æ±‚çš„ï¼Œä½†æ€§èƒ½å¤ªå·®ï¼Œå®é™…å¼€å‘è¿‡ç¨‹ä¸­ä¸ä¼šä½¿ç”¨ã€‚</p><h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><p>RDBæŒä¹…åŒ–ä¼šåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ç”Ÿæˆå†…å­˜ä¸­æ‰€æœ‰æ•°æ®çš„å¿«ç…§å¹¶ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šçš„ä¸€ä¸ªRDBæ–‡ä»¶ä¸­ã€‚</p><p>è¿™ç§æŒä¹…åŒ–æœºåˆ¶æ˜¯é€šè¿‡åˆ›å»ºæ•°æ®çš„å¿«ç…§æ¥å®ç°çš„ï¼Œå®ƒèƒ½å¤Ÿæ•è·å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®åœ¨æŸä¸€ç‰¹å®šæ—¶é—´ç‚¹ä¸Šçš„å‰¯æœ¬ã€‚</p><p>è¿™ç§å¿«ç…§ç”Ÿæˆæœºåˆ¶ä¸ä»…å…è®¸Redisè¿›è¡Œæ•°æ®å¤‡ä»½ï¼Œä»¥é˜²æ•°æ®ä¸¢å¤±ï¼Œè¿˜æ”¯æŒå°†è¿™äº›å¿«ç…§æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œå®ç°æ•°æ®çš„è¿…é€Ÿè¿ç§»æˆ–æ‰©å±•ï¼Œè¿™åœ¨æ„å»ºé«˜å¯ç”¨çš„Redisä¸»ä»å¤åˆ¶ç»“æ„ä¸­å°¤å…¶æœ‰ç”¨ã€‚æ­¤å¤–ï¼ŒRDBæ–‡ä»¶ä¹Ÿå¯ä»¥è¢«ç”¨äºç¾éš¾æ¢å¤ï¼Œå½“RedisæœåŠ¡å™¨éœ€è¦é‡å¯æ—¶ï¼Œå¯ä»¥åˆ©ç”¨è¿™äº›å¿«ç…§æ–‡ä»¶å¿«é€Ÿæ¢å¤åˆ°æŸä¸€æ—¶é—´ç‚¹çš„æ•°æ®çŠ¶æ€ã€‚</p><p>RDBæ–¹å¼çš„ä¼˜åŠ¿åœ¨äºå®ƒæä¾›äº†ä¸€ä¸ªéå¸¸ç´§å‡‘çš„æ•°æ®æ–‡ä»¶ï¼Œè¿™ä½¿å¾—æ•°æ®æ¢å¤è¿‡ç¨‹å˜å¾—éå¸¸å¿«é€Ÿå’Œé«˜æ•ˆã€‚æ­¤å¤–ï¼Œç”±äºRDBæ–‡ä»¶çš„ç”Ÿæˆæ˜¯åœ¨æœåŠ¡å™¨çš„å­è¿›ç¨‹ä¸­å®Œæˆçš„ï¼Œä¸»è¿›ç¨‹åœ¨æ­¤è¿‡ç¨‹ä¸­ä¸ä¼šè¿›è¡Œä»»ä½•ç£ç›˜I&#x2F;Oæ“ä½œï¼Œè¿™ä¿è¯äº†Redisçš„é«˜æ€§èƒ½å’Œæ•°æ®çš„ä¸€è‡´æ€§ã€‚ç„¶è€Œï¼Œä½¿ç”¨RDBä¹Ÿéœ€è¦æ³¨æ„æ•°æ®å®‰å…¨æ€§çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ä¸¤æ¬¡å¿«ç…§ä¹‹é—´çš„æ•°æ®æ›´æ”¹åœ¨å‘ç”Ÿæ•…éšœæ—¶å¯èƒ½ä¼šä¸¢å¤±ã€‚</p><blockquote><p>åŸºæœ¬ç‰¹ç‚¹</p></blockquote><ul><li>ä¼˜ç‚¹<ul><li>æ€§èƒ½é«˜ï¼šRDBæŒä¹…åŒ–å¯ä»¥åœ¨ä¸å½±å“Redisä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œåœ¨åå°å¼‚æ­¥åœ°è¿›è¡Œæ•°æ®å¿«ç…§ä¿å­˜ï¼Œå¯¹æ€§èƒ½å½±å“è¾ƒå°ã€‚</li><li>å¿«é€Ÿæ¢å¤ï¼šä½¿ç”¨RDBè¿›è¡Œæ•°æ®æ¢å¤æ¯”AOFçš„æ–¹å¼æ›´å¿«ï¼Œå› ä¸ºç›´æ¥å°†å¿«ç…§æ–‡ä»¶è¯»å–åˆ°å†…å­˜ä¸­å³å¯ã€‚</li></ul></li><li>ç¼ºç‚¹<ul><li>æ•°æ®ä¸¢å¤±ï¼šå¦‚æœRediså´©æºƒï¼Œä½ å¯èƒ½ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§ä»¥æ¥çš„æ‰€æœ‰æ•°æ®ã€‚</li><li>å¤§æ•°æ®é›†æ¢å¤æ—¶é—´è¾ƒé•¿ï¼šå¯¹äºéå¸¸å¤§çš„æ•°æ®é›†ï¼Œä¿å­˜RDBå¿«ç…§çš„æ—¶é—´å¯èƒ½ä¼šæ¯”è¾ƒé•¿</li></ul></li></ul><blockquote><p>å¿«ç…§æŒä¹…åŒ–</p></blockquote><p>å¿«ç…§æŒä¹…åŒ–æ˜¯ Redis é»˜è®¤é‡‡ç”¨çš„æŒä¹…åŒ–æ–¹å¼ï¼Œåœ¨Â <code>redis.conf</code>Â é…ç½®æ–‡ä»¶ä¸­é»˜è®¤æœ‰æ­¤ä¸‹é…ç½®ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">save</span> <span class="hljs-number">900</span> <span class="hljs-number">1</span>           #åœ¨<span class="hljs-number">900</span>ç§’(<span class="hljs-number">15</span>åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰<span class="hljs-number">1</span>ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘bgsaveå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚<br><br><span class="hljs-attribute">save</span> <span class="hljs-number">300</span> <span class="hljs-number">10</span>          #åœ¨<span class="hljs-number">300</span>ç§’(<span class="hljs-number">5</span>åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰<span class="hljs-number">10</span>ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘bgsaveå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚<br><br><span class="hljs-attribute">save</span> <span class="hljs-number">60</span> <span class="hljs-number">10000</span>        #åœ¨<span class="hljs-number">60</span>ç§’(<span class="hljs-number">1</span>åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰<span class="hljs-number">10000</span>ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘bgsaveå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚<br></code></pre></td></tr></table></figure><hr><blockquote><p>RDB åˆ›å»ºå¿«ç…§æ—¶ä¼šé˜»å¡ä¸»çº¿ç¨‹å—ï¼Ÿ</p></blockquote><p>Redis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB å¿«ç…§æ–‡ä»¶ï¼š</p><ul><li><code>save</code> : åŒæ­¥ä¿å­˜æ“ä½œï¼Œä¼šé˜»å¡ Redis ä¸»çº¿ç¨‹ï¼›</li><li><code>bgsave</code> : fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡ Redis ä¸»çº¿ç¨‹ï¼Œé»˜è®¤é€‰é¡¹ã€‚</li></ul><p>è¿™é‡Œè¯´ Redis ä¸»çº¿ç¨‹è€Œä¸æ˜¯ä¸»è¿›ç¨‹çš„ä¸»è¦æ˜¯å› ä¸º Redis å¯åŠ¨ä¹‹åä¸»è¦æ˜¯é€šè¿‡å•çº¿ç¨‹çš„æ–¹å¼å®Œæˆä¸»è¦çš„å·¥ä½œ(å¦‚æœä½ æƒ³å°†å…¶æè¿°ä¸º Redis ä¸»è¿›ç¨‹ï¼Œä¹Ÿæ²¡æ¯›ç—… )ã€‚</p><hr><h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><p>ä¸å¿«ç…§æŒä¹…åŒ–ç›¸æ¯”ï¼ŒAOF æŒä¹…åŒ–çš„å®æ—¶æ€§æ›´å¥½ã€‚</p><p>å¼€å¯ AOF æŒä¹…åŒ–åæ¯æ‰§è¡Œä¸€æ¡ä¼šæ›´æ”¹ Redis ä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼ŒRedis å°±ä¼šå°†è¯¥å‘½ä»¤å†™å…¥åˆ° AOF ç¼“å†²åŒº <code>server.aof_buf</code> ä¸­ï¼Œç„¶åå†å†™å…¥åˆ° AOF æ–‡ä»¶ä¸­ï¼ˆæ­¤æ—¶è¿˜åœ¨ç³»ç»Ÿå†…æ ¸ç¼“å­˜åŒºæœªåŒæ­¥åˆ°ç£ç›˜ï¼‰ï¼Œæœ€åå†æ ¹æ®æŒä¹…åŒ–æ–¹å¼ï¼ˆ <code>fsync</code>ç­–ç•¥ï¼‰çš„é…ç½®æ¥å†³å®šä½•æ—¶å°†ç³»ç»Ÿå†…æ ¸ç¼“å­˜åŒºçš„æ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜ä¸­çš„ã€‚</p><p>åªæœ‰åŒæ­¥åˆ°ç£ç›˜ä¸­æ‰ç®—æŒä¹…åŒ–ä¿å­˜äº†ï¼Œå¦åˆ™ä¾ç„¶å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ï¼Œæ¯”å¦‚è¯´ï¼šç³»ç»Ÿå†…æ ¸ç¼“å­˜åŒºçš„æ•°æ®è¿˜æœªåŒæ­¥ï¼Œç£ç›˜æœºå™¨å°±å®•æœºäº†ï¼Œé‚£è¿™éƒ¨åˆ†æ•°æ®å°±ç®—ä¸¢å¤±äº†ã€‚</p><p>AOF æ–‡ä»¶çš„ä¿å­˜ä½ç½®å’Œ RDB æ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡ <code>dir</code> å‚æ•°è®¾ç½®çš„ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯ <code>appendonly.aof</code></p><h5 id="å¼€å¯-AOF-æŒä¹…åŒ–æ“ä½œ"><a href="#å¼€å¯-AOF-æŒä¹…åŒ–æ“ä½œ" class="headerlink" title="å¼€å¯ AOF æŒä¹…åŒ–æ“ä½œ"></a>å¼€å¯ AOF æŒä¹…åŒ–æ“ä½œ</h5><p>é»˜è®¤æƒ…å†µä¸‹ Redis æ²¡æœ‰å¼€å¯ AOFï¼ˆappend only fileï¼‰æ–¹å¼çš„æŒä¹…åŒ–ï¼ˆRedis 6.0 ä¹‹åå·²ç»é»˜è®¤æ˜¯å¼€å¯äº†ï¼‰ï¼Œå¯ä»¥é€šè¿‡Â <code>appendonly</code>Â å‚æ•°å¼€å¯ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">appendonly</span> <span class="hljs-literal">yes</span><br></code></pre></td></tr></table></figure><h5 id="AOFæŒä¹…åŒ–çš„å®ç°è¿‡ç¨‹"><a href="#AOFæŒä¹…åŒ–çš„å®ç°è¿‡ç¨‹" class="headerlink" title="AOFæŒä¹…åŒ–çš„å®ç°è¿‡ç¨‹"></a>AOFæŒä¹…åŒ–çš„å®ç°è¿‡ç¨‹</h5><p>AOFï¼ˆAppend Only Fileï¼‰æŒä¹…åŒ–æ˜¯Redisæä¾›çš„ä¸€ç§æ•°æ®æŒä¹…åŒ–æœºåˆ¶ï¼Œé€šè¿‡è®°å½•æ‰€æœ‰å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹çš„å‘½ä»¤æ¥å®ç°æ•°æ®çš„æ¢å¤ã€‚AOFæŒä¹…åŒ–çš„å®ç°è¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªæ­¥éª¤ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯ç¡®ä¿æ•°æ®å®‰å…¨æ€§å’Œæ¢å¤èƒ½åŠ›çš„å…³é”®ç¯èŠ‚ã€‚</p><ul><li><ol><li>å‘½ä»¤è¿½åŠ ï¼ˆAppendï¼‰</li></ol><ul><li>æ‰€æœ‰å†™å‘½ä»¤ï¼ˆå¦‚<code>SET</code>ã€<code>DEL</code>ç­‰ï¼‰éƒ½ä¼šè¢«è¿½åŠ åˆ°AOFç¼“å†²åŒºä¸­ã€‚è¿™ä¸€æ­¥æ˜¯å®æ—¶çš„ï¼Œä¿è¯äº†æ‰€æœ‰å¯¹æ•°æ®çš„ä¿®æ”¹æ“ä½œéƒ½èƒ½è¢«æ•è·ã€‚</li></ul></li><li><ol start="2"><li>æ–‡ä»¶å†™å…¥ï¼ˆWriteï¼‰</li></ol><ul><li>AOFç¼“å†²åŒºä¸­çš„æ•°æ®ä¼šå‘¨æœŸæ€§åœ°å†™å…¥åˆ°AOFæ–‡ä»¶ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°<code>write</code>ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæŠŠæ•°æ®ä»ç”¨æˆ·ç©ºé—´å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´çš„ç¼“å†²åŒºä¸­ï¼Œä½†æ­¤æ—¶æ•°æ®è¿˜æ²¡æœ‰è¢«åŒæ­¥åˆ°ç£ç›˜ï¼Œåªæ˜¯å­˜å‚¨åœ¨äº†ç³»ç»Ÿçš„å†…æ ¸ç¼“å†²åŒºä¸­ã€‚</li></ul></li><li><ol start="3"><li>æ–‡ä»¶åŒæ­¥ï¼ˆFsyncï¼‰</li></ol><ul><li>æ ¹æ®é…ç½®çš„fsyncç­–ç•¥ï¼ˆå¦‚æ¯ç§’åŒæ­¥æˆ–æ¯ä¸ªå†™å‘½ä»¤åŒæ­¥ï¼‰ï¼ŒRedisä¼šå®šæœŸè°ƒç”¨<code>fsync</code>ç³»ç»Ÿè°ƒç”¨æ¥å¼ºåˆ¶å°†å†…æ ¸ç¼“å†²åŒºä¸­çš„æ•°æ®åŒæ­¥åˆ°ç£ç›˜ä¸Šã€‚<code>fsync</code>æ“ä½œä¼šé˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰çš„æ•°æ®éƒ½å®‰å…¨å†™å…¥ç£ç›˜åæ‰è¿”å›ï¼Œè¿™ä¸€æ­¥ç¡®ä¿äº†æ•°æ®çš„æŒä¹…æ€§ã€‚</li></ul></li><li><ol start="4"><li>æ–‡ä»¶é‡å†™ï¼ˆRewriteï¼‰</li></ol><ul><li>éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒAOFæ–‡ä»¶ä¼šå› ä¸ºä¸æ–­è¿½åŠ æ–°å‘½ä»¤è€Œå˜å¾—è¶Šæ¥è¶Šå¤§ã€‚Redisæä¾›äº†AOFé‡å†™æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä¸æ”¹å˜æ•°æ®æ¨¡å‹çš„å‰æä¸‹ï¼Œé€šè¿‡é‡æ–°ç”Ÿæˆä¸€ä»½ä¼˜åŒ–çš„AOFæ–‡ä»¶æ¥å‡å°æ–‡ä»¶å¤§å°ã€‚è¿™ä¸€è¿‡ç¨‹é€šè¿‡é‡å†™å¹¶å‹ç¼©AOFæ–‡ä»¶æ¥å®ç°ï¼Œç§»é™¤äº†æ–‡ä»¶ä¸­å†—ä½™çš„å‘½ä»¤ã€‚</li></ul></li><li><ol start="5"><li>é‡å¯åŠ è½½ï¼ˆLoadï¼‰</li></ol><ul><li>å½“RedisæœåŠ¡å™¨é‡å¯æ—¶ï¼Œå®ƒä¼šé‡æ–°åŠ è½½AOFæ–‡ä»¶æ¥æ¢å¤æ•°æ®çŠ¶æ€ã€‚è¿™ä¸ªè¿‡ç¨‹é€šè¿‡é€ä¸€æ‰§è¡ŒAOFæ–‡ä»¶ä¸­è®°å½•çš„å‘½ä»¤æ¥å®Œæˆï¼Œä»è€Œæ¢å¤åˆ°æœ€åä¸€æ¬¡åŒæ­¥æ—¶çš„æ•°æ®çŠ¶æ€ã€‚</li></ul></li></ul><blockquote><p>ç³»ç»Ÿè°ƒç”¨çš„ä½œç”¨</p></blockquote><ul><li>**<code>write</code>**ï¼šå°†æ•°æ®å†™å…¥ç³»ç»Ÿå†…æ ¸ç¼“å†²åŒºåå³è¿”å›ï¼Œæé«˜äº†å†™å…¥æ•ˆç‡ï¼Œä½†å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚</li><li>**<code>fsync</code>**ï¼šå¼ºåˆ¶ä»å†…æ ¸ç¼“å†²åŒºåŒæ­¥æ•°æ®åˆ°ç£ç›˜ï¼Œç¡®ä¿æ•°æ®çš„æŒä¹…åŒ–ã€‚è™½ç„¶<code>fsync</code>ä¼šå¢åŠ I&#x2F;Oå¼€é”€ï¼Œä½†å®ƒä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚</li></ul><p>AOFæŒä¹…åŒ–é€šè¿‡ç²¾ç¡®è®°å½•ä¿®æ”¹æ•°æ®åº“çš„æ¯ä¸ªæ“ä½œï¼Œå¹¶åˆ©ç”¨ç³»ç»Ÿè°ƒç”¨ç¡®ä¿è¿™äº›æ“ä½œèƒ½è¢«å®‰å…¨åœ°å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼Œä»è€Œå®ç°æ•°æ®çš„æŒä¹…åŒ–å’Œæ¢å¤ã€‚</p><p>é€‰æ‹©åˆé€‚çš„fsyncç­–ç•¥å¯ä»¥å¹³è¡¡æ€§èƒ½å’Œæ•°æ®å®‰å…¨æ€§ï¼Œè€ŒAOFé‡å†™åˆ™æ˜¯ä¼˜åŒ–ç£ç›˜ç©ºé—´å’Œæå‡æ€§èƒ½çš„æœ‰æ•ˆæ‰‹æ®µã€‚</p><hr><h4 id="æ··åˆæŒä¹…åŒ–"><a href="#æ··åˆæŒä¹…åŒ–" class="headerlink" title="æ··åˆæŒä¹…åŒ–"></a>æ··åˆæŒä¹…åŒ–</h4><p>ä»Redis 4.0ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†RDBå’ŒAOFçš„æ··åˆæŒä¹…åŒ–æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ç»“åˆäº†ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶çš„ä¼˜ç‚¹ï¼šRDBçš„å¿«é€Ÿæ¢å¤èƒ½åŠ›å’ŒAOFçš„æ•°æ®å®Œæ•´æ€§ä¿è¯ã€‚</p><p><strong>è¿™ç§æ–¹å¼å…¼é¡¾äº†æ•°æ®æ¢å¤çš„é€Ÿåº¦å’Œæ•°æ®å®‰å…¨æ€§ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦è€ƒè™‘å…¶å¯èƒ½å¸¦æ¥çš„é¢å¤–ç£ç›˜å’Œå†…å­˜èµ„æºæ¶ˆè€—ã€‚</strong></p><blockquote><p>å·¥ä½œåŸç†</p></blockquote><p>åœ¨æ··åˆæŒä¹…åŒ–æ¨¡å¼ä¸‹ï¼ŒRedisåœ¨è¿›è¡ŒAOFé‡å†™æ—¶ä¼šåŒæ—¶å°†å½“å‰å†…å­˜ä¸­çš„æ•°æ®çŠ¶æ€ä»¥RDBæ ¼å¼å†™å…¥åˆ°AOFæ–‡ä»¶çš„å¤´éƒ¨ï¼Œä¹‹åå†å°†ä»å¯åŠ¨æˆ–ä¸Šä¸€æ¬¡AOFé‡å†™ä»¥æ¥çš„æ‰€æœ‰å†™å‘½ä»¤è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚</p><p>è¿™æ ·åšçš„ç»“æœæ˜¯ä¸€ä¸ªåŒ…å«å®Œæ•´æ•°æ®å¿«ç…§ï¼ˆRDBæ ¼å¼ï¼‰ä»¥åŠä¹‹åæ‰€æœ‰å˜æ›´ï¼ˆAOFæ ¼å¼ï¼‰çš„AOFæ–‡ä»¶ã€‚</p><blockquote><p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹èƒ½å¤Ÿè¿›è¡Œå¿«é€Ÿé‡å¯å’Œä¿è¯äº†æ•°æ®å®‰å…¨</p></blockquote><ul><li><strong>å¿«é€Ÿé‡å¯</strong>ï¼šä½¿ç”¨RDBæ ¼å¼çš„æ•°æ®å¿«ç…§ä½œä¸ºAOFæ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨Redisé‡å¯æ—¶å¿«é€Ÿæ¢å¤æ•´ä¸ªæ•°æ®é›†ï¼Œå› ä¸ºåŠ è½½RDBæ ¼å¼æ•°æ®é€šå¸¸æ¯”æ‰§è¡ŒAOFæ–‡ä»¶ä¸­çš„å‘½ä»¤è¦å¿«å¾—å¤šã€‚</li><li><strong>æ•°æ®å®‰å…¨</strong>ï¼šç”±äºAOFæ—¥å¿—åŒ…å«äº†æ•°æ®å¿«ç…§ä¹‹åçš„æ‰€æœ‰å†™æ“ä½œï¼Œè¿™ç§æ··åˆæ¨¡å¼ä¿ç•™äº†AOFçš„æ•°æ®å®Œæ•´æ€§ç‰¹ç‚¹ï¼Œå³ä½¿åœ¨Rediså´©æºƒåä¹Ÿèƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚</li></ul><hr><blockquote><p>ä½¿ç”¨é…ç½®</p></blockquote><p>è¦å¯ç”¨æ··åˆæŒä¹…åŒ–ï¼Œéœ€è¦åœ¨Redisé…ç½®æ–‡ä»¶ä¸­è®¾ç½®ç›¸åº”çš„é…ç½®é¡¹ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç›¸å…³é…ç½®å‚æ•°ï¼š</p><ul><li><code>aof-use-rdb-preamble</code>ï¼šè®¾ç½®ä¸º<code>yes</code>ä»¥å¯ç”¨æ··åˆæŒä¹…åŒ–æ¨¡å¼ã€‚è¿™å‘Šè¯‰Redisåœ¨æ‰§è¡ŒAOFé‡å†™æ—¶ï¼Œå…ˆä»¥RDBæ ¼å¼å†™å…¥å½“å‰å†…å­˜å¿«ç…§ï¼Œç„¶åå†è¿½åŠ å†™å‘½ä»¤æ—¥å¿—ã€‚</li></ul><p>ç¤ºä¾‹é…ç½®ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">appendonly</span> <span class="hljs-literal">yes</span><br>aof-use-rdb-preamble <span class="hljs-literal">yes</span><br></code></pre></td></tr></table></figure><hr><blockquote><p>æ³¨æ„äº‹é¡¹</p></blockquote><ul><li>åœ¨æ··åˆæ¨¡å¼ä¸‹ï¼ŒAOFæ–‡ä»¶çš„å¤§å°å¯èƒ½ä¼šæ¯”çº¯AOFæ¨¡å¼æ›´å¤§ï¼Œå› ä¸ºå®ƒåŒ…å«äº†å®Œæ•´çš„æ•°æ®å¿«ç…§ã€‚å› æ­¤ï¼Œéœ€è¦ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ã€‚</li><li>è™½ç„¶æ··åˆæŒä¹…åŒ–æé«˜äº†æ•°æ®æ¢å¤çš„é€Ÿåº¦ï¼Œä½†åœ¨é«˜å†™å…¥è´Ÿè½½ä¸‹ï¼Œé‡å†™AOFæ–‡ä»¶å¯èƒ½ä¼šæ¶ˆè€—å¤§é‡çš„CPUå’Œç£ç›˜I&#x2F;Oèµ„æºã€‚å› æ­¤ï¼Œåº”æ ¹æ®å®é™…è´Ÿè½½å’Œèµ„æºæƒ…å†µåˆç†é…ç½®AOFé‡å†™ç­–ç•¥ã€‚</li><li>æ··åˆæŒä¹…åŒ–æ¨¡å¼ç»“åˆäº†RDBå’ŒAOFçš„ä¼˜åŠ¿ï¼Œä½†ä¹Ÿç»§æ‰¿äº†å®ƒä»¬çš„ç‰¹ç‚¹ï¼ŒåŒ…æ‹¬RDBå¿«ç…§çš„é—´éš”æ€§å’ŒAOFæ—¥å¿—çš„æŒç»­å¢é•¿ã€‚å› æ­¤ï¼Œåˆç†é…ç½®RDBå¿«ç…§å’ŒAOFé‡å†™çš„è§¦å‘æ¡ä»¶å¯¹äºç»´æŠ¤Redisçš„æ€§èƒ½å’Œæ•°æ®å®‰å…¨è‡³å…³é‡è¦ã€‚</li></ul><hr><h3 id="5ã€Redis-çº¿ç¨‹æ¨¡å‹-ğŸš©ğŸ’£"><a href="#5ã€Redis-çº¿ç¨‹æ¨¡å‹-ğŸš©ğŸ’£" class="headerlink" title="5ã€Redis çº¿ç¨‹æ¨¡å‹   ğŸš©ğŸ’£"></a>5ã€Redis çº¿ç¨‹æ¨¡å‹   ğŸš©ğŸ’£</h3><p>Redisæ˜¯ä¸€ä¸ªä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„é«˜æ€§èƒ½é”®å€¼å¯¹å­˜å‚¨ç³»ç»Ÿã€‚å®ƒçš„çº¿ç¨‹æ¨¡å‹ç‰¹åˆ«ä¹‹å¤„åœ¨äºå…¶å•çº¿ç¨‹æ¶æ„ï¼Œ</p><p>ä¸è¿‡ï¼Œä»Redis 4.0ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†ä¸€äº›å¤šçº¿ç¨‹ç‰¹æ€§æ¥å¤„ç†æŸäº›ç‰¹å®šçš„ä»»åŠ¡ï¼Œä½†æ ¸å¿ƒæ•°æ®è¯»å†™æ“ä½œä»ç„¶æ˜¯å•çº¿ç¨‹çš„ã€‚</p><blockquote><p>å•çº¿ç¨‹æ¶æ„</p></blockquote><p>åœ¨Redisçš„ä¸»è¦ç‰ˆæœ¬ä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®è¯»å†™æ“ä½œéƒ½æ˜¯ç”±ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥å¤„ç†çš„ã€‚è¿™æ„å‘³ç€åœ¨ä»»ä½•ç»™å®šæ—¶é—´ç‚¹ï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œèƒ½å¤Ÿè®¿é—®æ•°æ®é›†ã€‚è¿™ç§è®¾è®¡æœ‰å‡ ä¸ªæ˜¾è‘—çš„ä¼˜åŠ¿ï¼š</p><ul><li><strong>ç®€åŒ–æ•°æ®ç»“æ„</strong>ï¼šç”±äºä¸å­˜åœ¨å¹¶å‘æ“ä½œæ•°æ®çš„æƒ…å†µï¼ŒRediså¯ä»¥ä½¿ç”¨ç®€å•é«˜æ•ˆçš„æ•°æ®ç»“æ„æ¥å­˜å‚¨æ•°æ®ï¼Œè€Œä¸éœ€è¦æ‹…å¿ƒåŠ é”å’ŒåŒæ­¥çš„é—®é¢˜ã€‚</li><li><strong>é¿å…çº¿ç¨‹åˆ‡æ¢å’Œé”çš„å¼€é”€</strong>ï¼šçº¿ç¨‹åˆ‡æ¢å’Œé”æœºåˆ¶åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ä¼šå¼•å…¥é¢å¤–çš„å¼€é”€ã€‚Redisé€šè¿‡ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹é¿å…äº†è¿™äº›å¼€é”€ï¼Œä»è€Œæé«˜äº†æ€§èƒ½ã€‚</li><li><strong>ç®€åŒ–ç¼–ç¨‹æ¨¡å‹</strong>ï¼šå•çº¿ç¨‹æ¨¡å‹ä½¿å¾—Redisçš„ç¼–ç¨‹å’Œè°ƒè¯•å˜å¾—æ›´åŠ ç®€å•ç›´æ¥ï¼Œå› ä¸ºå¼€å‘è€…ä¸éœ€è¦è€ƒè™‘å¤æ‚çš„å¹¶å‘é—®é¢˜ã€‚</li></ul><blockquote><p>I&#x2F;Oå¤šè·¯å¤ç”¨</p></blockquote><p>Redisè™½ç„¶åœ¨æ•°æ®å¤„ç†ä¸Šé‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼Œä½†å®ƒä½¿ç”¨I&#x2F;Oå¤šè·¯å¤ç”¨æŠ€æœ¯æ¥é«˜æ•ˆåœ°å¤„ç†æˆåƒä¸Šä¸‡çš„å¹¶å‘è¿æ¥ã€‚</p><p>I&#x2F;Oå¤šè·¯å¤ç”¨å…è®¸å•ä¸ªçº¿ç¨‹åŒæ—¶ç›‘è§†å¤šä¸ªç½‘ç»œè¿æ¥ä¸Šçš„I&#x2F;Oäº‹ä»¶ï¼Œä¸€æ—¦æŸä¸ªè¿æ¥ä¸Šæœ‰æ•°æ®å¯ä»¥è¯»å–æˆ–å¯ä»¥å†™å…¥ï¼Œç›¸åº”çš„æ“ä½œå°±ä¼šè¢«æ‰§è¡Œã€‚è¿™ä½¿å¾—Redisèƒ½å¤Ÿåœ¨ä¸å¢åŠ çº¿ç¨‹æ•°é‡çš„æƒ…å†µä¸‹ï¼Œå®ç°é«˜ååé‡å’Œä½å»¶è¿Ÿã€‚</p><blockquote><p>Redis 4.0ä»¥åçš„å¤šçº¿ç¨‹</p></blockquote><p>ä»Redis 4.0å¼€å§‹ï¼Œå¼•å…¥äº†å¤šçº¿ç¨‹æ¥å¤„ç†æŸäº›ç‰¹å®šçš„ä»»åŠ¡ï¼Œä¸»è¦æ˜¯ç½‘ç»œI&#x2F;Oå’Œé”®è¿‡æœŸåˆ é™¤ç­‰æ“ä½œï¼Œä»¥å‡è½»ä¸»çº¿ç¨‹çš„è´Ÿæ‹…ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›å¤šçº¿ç¨‹å¹¶ä¸å¤„ç†æ•°æ®çš„è¯»å†™æ“ä½œï¼Œæ ¸å¿ƒæ•°æ®æ“ä½œä¾ç„¶æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ã€‚è¿™ç§è®¾è®¡æ—¨åœ¨ä¿æŒRedisæ“ä½œçš„ç®€å•æ€§å’Œé«˜æ€§èƒ½ï¼ŒåŒæ—¶æé«˜èµ„æºçš„åˆ©ç”¨ç‡ã€‚</p><blockquote><p>Redis6.0  ä¹‹åå¼•å…¥äº†å¤šçº¿ç¨‹ ï¼Ÿ</p></blockquote><h3 id="6ã€Redis-å†…å­˜ç®¡ç†-ğŸš©"><a href="#6ã€Redis-å†…å­˜ç®¡ç†-ğŸš©" class="headerlink" title="6ã€Redis å†…å­˜ç®¡ç†  ğŸš©"></a>6ã€Redis å†…å­˜ç®¡ç†  ğŸš©</h3><p>é˜…è¯»ï¼š</p><ul><li><a href="https://cloud.tencent.com/developer/article/1530553">https://cloud.tencent.com/developer/article/1530553</a></li><li><a href="https://javaguide.cn/database/redis/redis-memory-fragmentation.html">https://javaguide.cn/database/redis/redis-memory-fragmentation.html</a></li></ul><p>Redis æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„é”®å€¼å¯¹æ•°æ®åº“ï¼Œå†…å­˜ç®¡ç†æ˜¯å…¶ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½ï¼›</p><p>å…³äº Redis å†…å­˜ç®¡ç†çš„ä¸€äº›å¸¸è§æ¦‚å¿µï¼š</p><ul><li>å†…å­˜åˆ†é…å™¨<ul><li><strong>Jemalloc</strong>ï¼šRedis é»˜è®¤ä½¿ç”¨ Jemalloc ä½œä¸ºå†…å­˜åˆ†é…å™¨ï¼Œå®ƒå¯¹ç¢ç‰‡åŒ–å¤„ç†å¾—æ¯”æ ‡å‡†çš„ libc malloc æ›´åŠ é«˜æ•ˆã€‚</li></ul></li><li>è¿‡æœŸé”®å’Œå†…å­˜æ·˜æ±°<ul><li>è¿‡æœŸç­–ç•¥<ul><li>Redis å…è®¸ä¸ºé”®è®¾ç½®ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ã€‚é”®åˆ°æœŸåä¼šè¢«åˆ é™¤ï¼Œé‡Šæ”¾å†…å­˜ã€‚</li></ul></li><li>å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ˆåœ¨å†…å­˜ä½¿ç”¨è¾¾åˆ°é™åˆ¶æ—¶ï¼ŒRedis æä¾›äº†å¤šç§æ·˜æ±°ç­–ç•¥ï¼‰<ul><li><code>noeviction</code>ï¼šä¸æ·˜æ±°ä»»ä½•æ•°æ®ï¼Œåªæ˜¯è¿”å›é”™è¯¯ã€‚</li><li><code>allkeys-lru</code>ï¼šæ ¹æ®æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼ˆLRUï¼‰æ·˜æ±°æ•°æ®ã€‚</li><li><code>volatile-lru</code>ï¼šåªä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­é€‰æ‹©æ·˜æ±°ã€‚</li><li><code>allkeys-random</code>ï¼šéšæœºæ·˜æ±°ã€‚</li><li><code>volatile-random</code>ï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ä¸­éšæœºæ·˜æ±°ã€‚</li><li><code>volatile-ttl</code>ï¼šæ·˜æ±°å³å°†è¿‡æœŸçš„é”®ã€‚</li></ul></li></ul></li><li>å†…å­˜é…ç½®<ul><li><strong>maxmemory é…ç½®</strong>ï¼šå¯ä»¥åœ¨ Redis é…ç½®æ–‡ä»¶ä¸­è®¾ç½® <code>maxmemory</code> é€‰é¡¹æ¥é™åˆ¶ Redis ä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡ã€‚</li><li><strong>maxmemory-policy</strong>ï¼šå®šä¹‰å½“å†…å­˜è¾¾åˆ°é™åˆ¶æ—¶ Redis åº”è¯¥æ‰§è¡Œçš„æ·˜æ±°ç­–ç•¥ã€‚</li></ul></li><li>å†…å­˜ä½¿ç”¨ç›‘æ§<ul><li><strong>å†…å­˜ä½¿ç”¨æŒ‡æ ‡</strong>ï¼šRedis æä¾›äº†ä¸°å¯Œçš„æŒ‡æ ‡æ¥ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä¾‹å¦‚ <code>used_memory</code>ã€<code>used_memory_rss</code>ã€<code>used_memory_peak</code> ç­‰</li><li><strong>å†…å­˜ä¼˜åŒ–å‘½ä»¤</strong>ï¼šå¦‚ <code>MEMORY PURGE</code>ï¼ˆåœ¨æŸäº›ç‰ˆæœ¬ä¸­å¯ç”¨ï¼‰å¯ä»¥ç”¨æ¥å°è¯•å‡å°‘å†…å­˜ç¢ç‰‡ã€‚</li></ul></li><li>æ•°æ®ç»“æ„ä¼˜åŒ–</li><li>å†…å­˜å›æ”¶</li></ul><h4 id="è¿‡æœŸæ—¶é—´"><a href="#è¿‡æœŸæ—¶é—´" class="headerlink" title="è¿‡æœŸæ—¶é—´"></a>è¿‡æœŸæ—¶é—´</h4><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è®¾ç½®ä¿å­˜çš„ç¼“å­˜æ•°æ®çš„æ—¶å€™éƒ½ä¼šè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å› ä¸ºå†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¦‚æœç¼“å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯ä¸€ç›´ä¿å­˜çš„è¯ï¼Œåˆ†åˆ†é’Ÿç›´æ¥ Out of memoryã€‚</p><p>Redis è‡ªå¸¦äº†ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; expire key <span class="hljs-number">60</span> # æ•°æ®åœ¨ 60s åè¿‡æœŸ<br>(integer) <span class="hljs-number">1</span><br><span class="hljs-number">127.0.0.1:6379</span>&gt; setex key <span class="hljs-number">60</span> value # æ•°æ®åœ¨ 60s åè¿‡æœŸ (setex:<span class="hljs-string">[set]</span> + <span class="hljs-string">[ex]</span>pire)<br>OK<br><span class="hljs-number">127.0.0.1:6379</span>&gt; ttl key # æŸ¥çœ‹æ•°æ®è¿˜æœ‰å¤šä¹…è¿‡æœŸ<br>(integer) <span class="hljs-number">56</span><br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<strong>Redis ä¸­é™¤äº†å­—ç¬¦ä¸²ç±»å‹æœ‰è‡ªå·±ç‹¬æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„å‘½ä»¤Â <code>setex</code>Â å¤–ï¼Œå…¶ä»–æ–¹æ³•éƒ½éœ€è¦ä¾é Â <code>expire</code>Â å‘½ä»¤æ¥è®¾ç½®è¿‡æœŸæ—¶é—´ ã€‚å¦å¤–ï¼ŒÂ <code>persist</code>Â å‘½ä»¤å¯ä»¥ç§»é™¤ä¸€ä¸ªé”®çš„è¿‡æœŸæ—¶é—´ã€‚</strong></p></blockquote><p>è¿‡æœŸæ—¶é—´è¿˜å¯ä»¥ç”¨äºæŸäº›ä¸šåŠ¡åœºæ™¯ï¼šæ¯”å¦‚æ‰‹æœºçŸ­ä¿¡éªŒè¯ç çš„æœ‰æ•ˆæœŸä¿æŒåœ¨ 1 åˆ†é’Ÿï¼Œtoken ç™»å½•çš„æœ‰æ•ˆæœŸåœ¨ 1 å¤©å†…ã€‚</p><h4 id="å¦‚ä½•åˆ¤æ–­é”®æ˜¯å¦è¿‡æœŸ"><a href="#å¦‚ä½•åˆ¤æ–­é”®æ˜¯å¦è¿‡æœŸ" class="headerlink" title="å¦‚ä½•åˆ¤æ–­é”®æ˜¯å¦è¿‡æœŸ"></a>å¦‚ä½•åˆ¤æ–­é”®æ˜¯å¦è¿‡æœŸ</h4><h4 id="æ•°æ®è¿‡æœŸç­–ç•¥-ğŸš©ğŸ’£"><a href="#æ•°æ®è¿‡æœŸç­–ç•¥-ğŸš©ğŸ’£" class="headerlink" title="æ•°æ®è¿‡æœŸç­–ç•¥  ğŸš©ğŸ’£"></a>æ•°æ®è¿‡æœŸç­–ç•¥  ğŸš©ğŸ’£</h4><h4 id="æ•°æ®æ·˜æ±°ç­–ç•¥-ğŸš©ğŸ’£"><a href="#æ•°æ®æ·˜æ±°ç­–ç•¥-ğŸš©ğŸ’£" class="headerlink" title="æ•°æ®æ·˜æ±°ç­–ç•¥  ğŸš©ğŸ’£"></a>æ•°æ®æ·˜æ±°ç­–ç•¥  ğŸš©ğŸ’£</h4><h3 id="7ã€Redis-äº‹åŠ¡"><a href="#7ã€Redis-äº‹åŠ¡" class="headerlink" title="7ã€Redis äº‹åŠ¡"></a>7ã€Redis äº‹åŠ¡</h3><h4 id="ä»€ä¹ˆæ˜¯Redis-äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯Redis-äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯Redis äº‹åŠ¡"></a>ä»€ä¹ˆæ˜¯Redis äº‹åŠ¡</h4><p>ä¸æ˜¯å¾ˆæ¨èä½¿ç”¨Redisäº‹åŠ¡ï¼Œè·Ÿæˆ‘ä»¬å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“äº‹åŠ¡ä¸åŒï¼š</p><ul><li>1ã€Redis äº‹åŠ¡æ˜¯ä¸æ”¯æŒå›æ»šï¼ˆroll backï¼‰æ“ä½œçš„ï¼ŒRedis äº‹åŠ¡ä¸æ»¡è¶³åŸå­æ€§ã€‚</li><li>2ã€Redis äº‹åŠ¡çš„æŒä¹…æ€§æ˜¯æ²¡åŠæ³•ä¿è¯çš„</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202402261559889.png" alt="image.png"></p><h4 id="Lua-è„šæœ¬"><a href="#Lua-è„šæœ¬" class="headerlink" title="Lua è„šæœ¬"></a>Lua è„šæœ¬</h4><p>ä¸äº‹åŠ¡ç›¸å¯¹çš„è¯ï¼Œæ›´æ¨èä½¿ç”¨ Lua è„šæœ¬æ‰§è¡Œæ‰¹é‡ä»»åŠ¡ï¼›</p><ul><li>ä¸€æ®µ Lua è„šæœ¬å¯ä»¥è§†ä½œä¸€æ¡å‘½ä»¤æ‰§è¡Œï¼Œä¸€æ®µ Lua è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šæœ‰å…¶ä»–è„šæœ¬æˆ– Redis å‘½ä»¤åŒæ—¶æ‰§è¡Œï¼Œä¿è¯äº†æ“ä½œä¸ä¼šè¢«å…¶ä»–æŒ‡ä»¤æ’å…¥æˆ–æ‰“æ‰°ã€‚</li></ul><p>ä¸è¿‡ï¼Œå¦‚æœ Lua è„šæœ¬è¿è¡Œæ—¶å‡ºé”™å¹¶ä¸­é€”ç»“æŸï¼Œå‡ºé”™ä¹‹åçš„å‘½ä»¤æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚å¹¶ä¸”ï¼Œå‡ºé”™ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤æ˜¯æ— æ³•è¢«æ’¤é”€çš„ï¼Œæ— æ³•å®ç°ç±»ä¼¼å…³ç³»å‹æ•°æ®åº“æ‰§è¡Œå¤±è´¥å¯ä»¥å›æ»šçš„é‚£ç§åŸå­æ€§æ•ˆæœã€‚å› æ­¤ï¼Œ <strong>ä¸¥æ ¼æ¥è¯´çš„è¯ï¼Œé€šè¿‡ Lua è„šæœ¬æ¥æ‰¹é‡æ‰§è¡Œ Redis å‘½ä»¤å®é™…ä¹Ÿæ˜¯ä¸å®Œå…¨æ»¡è¶³åŸå­æ€§çš„ã€‚</strong></p><hr><p>Redisçš„Luaè„šæœ¬åŠŸèƒ½æ˜¯å…¶å¼ºå¤§ç‰¹æ€§ä¹‹ä¸€ï¼Œæä¾›äº†åœ¨RedisæœåŠ¡å™¨ç«¯æ‰§è¡Œè„šæœ¬çš„èƒ½åŠ›ã€‚è¿™å…è®¸æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œï¼Œè¿™äº›æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“åŸå­åœ°æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç”±å®¢æˆ·ç«¯é€ä¸€å‘é€å‘½ä»¤ç„¶åç”±æœåŠ¡å™¨é€ä¸€æ‰§è¡Œã€‚</p><p>Luaæ˜¯ä¸€ç§è½»é‡çº§çš„ç¼–ç¨‹è¯­è¨€ï¼Œè¢«åµŒå…¥åˆ°Redisä¸­ç”¨äºæ‰§è¡Œå¤æ‚çš„é€»è¾‘ï¼Œè¿™åœ¨å¤šä¸ªå‘½ä»¤éœ€è¦ä½œä¸ºå•ä¸ªåŸå­æ“ä½œæ‰§è¡Œæ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><blockquote><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p></blockquote><p>å‡è®¾æˆ‘ä»¬éœ€è¦æ›´æ–°ä¸€ä¸ªè®¡æ•°å™¨ï¼Œä½†åªæœ‰åœ¨å¦ä¸€ä¸ªé”®å­˜åœ¨æ—¶æ‰è¿›è¡Œæ›´æ–°ã€‚ä¸ä½¿ç”¨Luaè„šæœ¬ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å…ˆæ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨ï¼Œç„¶åå†æ›´æ–°è®¡æ•°å™¨ï¼Œè¿™ä¸¤æ­¥æ“ä½œä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</p><p>ä½¿ç”¨Luaè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">if</span> redis.<span class="hljs-keyword">call</span>(&quot;EXISTS&quot;, KEYS[<span class="hljs-number">1</span>]) == <span class="hljs-number">1</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">return</span> redis.<span class="hljs-keyword">call</span>(&quot;INCR&quot;, KEYS[<span class="hljs-number">2</span>])<br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><ul><li>è¿™ä¸ªè„šæœ¬æ¥å—ä¸¤ä¸ªé”®ä½œä¸ºè¾“å…¥ï¼š<code>KEYS[1]</code>ç”¨äºæ£€æŸ¥å­˜åœ¨æ€§ï¼Œ<code>KEYS[2]</code>æ˜¯éœ€è¦å¢åŠ çš„è®¡æ•°å™¨ã€‚å¦‚æœ<code>KEYS[1]</code>å­˜åœ¨ï¼Œè„šæœ¬å°†å¢åŠ <code>KEYS[2]</code>çš„å€¼å¹¶è¿”å›æ–°å€¼ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›0ã€‚</li></ul><p>æ‰§è¡Œè„šæœ¬æ“ä½œ(ä½¿ç”¨<code>EVAL</code>å‘½ä»¤æ‰§è¡ŒLuaè„šæœ¬)ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">EVAL <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">numkeys</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span> [<span class="hljs-tag">&lt;<span class="hljs-name">key2</span>&gt;</span> ...] [<span class="hljs-tag">&lt;<span class="hljs-name">arg</span>&gt;</span> [<span class="hljs-tag">&lt;<span class="hljs-name">arg2</span>&gt;</span> ...]]</span></span><br></code></pre></td></tr></table></figure><ul><li><code>&lt;script&gt;</code>ï¼šLuaè„šæœ¬æ–‡æœ¬ã€‚</li><li><code>&lt;numkeys&gt;</code>ï¼šè„šæœ¬ä¸­å°†è¦å¤„ç†çš„é”®çš„æ•°é‡ã€‚</li><li><code>&lt;key&gt;</code>ï¼šè„šæœ¬ä¸­ç”¨åˆ°çš„Redisé”®ã€‚</li><li><code>&lt;arg&gt;</code>ï¼šä¼ é€’ç»™è„šæœ¬çš„å…¶ä»–å‚æ•°ã€‚</li></ul><h3 id="8ã€Redis-æ€§èƒ½ä¼˜åŒ–-ğŸš©ğŸ’£"><a href="#8ã€Redis-æ€§èƒ½ä¼˜åŒ–-ğŸš©ğŸ’£" class="headerlink" title="8ã€Redis æ€§èƒ½ä¼˜åŒ–  ğŸš©ğŸ’£"></a>8ã€Redis æ€§èƒ½ä¼˜åŒ–  ğŸš©ğŸ’£</h3><h4 id="2-1-ä½¿ç”¨æ‰¹é‡æ“ä½œå‡å°‘ç½‘ç»œä¼ è¾“"><a href="#2-1-ä½¿ç”¨æ‰¹é‡æ“ä½œå‡å°‘ç½‘ç»œä¼ è¾“" class="headerlink" title="2.1  ä½¿ç”¨æ‰¹é‡æ“ä½œå‡å°‘ç½‘ç»œä¼ è¾“"></a>2.1  ä½¿ç”¨æ‰¹é‡æ“ä½œå‡å°‘ç½‘ç»œä¼ è¾“</h4><h4 id="2-2-å¤§é‡-key-é›†ä¸­è¿‡æœŸé—®é¢˜"><a href="#2-2-å¤§é‡-key-é›†ä¸­è¿‡æœŸé—®é¢˜" class="headerlink" title="2.2 å¤§é‡ key é›†ä¸­è¿‡æœŸé—®é¢˜"></a>2.2 å¤§é‡ key é›†ä¸­è¿‡æœŸé—®é¢˜</h4><h4 id="2-3-å¤§-Key"><a href="#2-3-å¤§-Key" class="headerlink" title="2.3 å¤§ Key"></a>2.3 å¤§ Key</h4><h4 id="2-4-çƒ­-Key"><a href="#2-4-çƒ­-Key" class="headerlink" title="2.4 çƒ­ Key"></a>2.4 çƒ­ Key</h4><h4 id="2-5-æ…¢æŸ¥è¯¢é—®é¢˜"><a href="#2-5-æ…¢æŸ¥è¯¢é—®é¢˜" class="headerlink" title="2.5  æ…¢æŸ¥è¯¢é—®é¢˜"></a>2.5  æ…¢æŸ¥è¯¢é—®é¢˜</h4><blockquote><p>ä¸ºä»€ä¹ˆä¼šæœ‰æ…¢æŸ¥è¯¢é—®é¢˜</p></blockquote><p>Redis ä¸­çš„å¤§éƒ¨åˆ†å‘½ä»¤éƒ½æ˜¯ O(1)æ—¶é—´å¤æ‚åº¦ï¼Œä½†ä¹Ÿæœ‰å°‘éƒ¨åˆ† O(n) æ—¶é—´å¤æ‚åº¦çš„å‘½ä»¤å’Œä¸€äº›æ—¶é—´å¤æ‚åº¦å¯èƒ½åœ¨ O(N) ä»¥ä¸Šçš„å‘½ä»¤ï¼›</p><p>ç”±äºè¿™äº›å‘½ä»¤æ‰§è¡Œæ—¶é—´å¤æ‚åº¦è¾ƒé«˜ï¼Œï¼Œæœ‰æ—¶å€™ä¹Ÿä¼šå…¨è¡¨æ‰«æï¼Œéšç€ n çš„å¢å¤§ï¼Œæ‰§è¡Œè€—æ—¶ä¹Ÿä¼šè¶Šé•¿ã€‚</p><p>ç”±äºè¿™äº›å‘½ä»¤æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ï¼Œæœ‰æ—¶å€™ä¹Ÿä¼šå…¨è¡¨æ‰«æï¼Œéšç€ n çš„å¢å¤§ï¼Œæ‰§è¡Œè€—æ—¶ä¹Ÿä¼šè¶Šé•¿ã€‚</p><hr><p>O(n) æ—¶é—´å¤æ‚åº¦çš„å‘½ä»¤ï¼š</p><ul><li><code>KEYS *</code>ï¼šä¼šè¿”å›æ‰€æœ‰ç¬¦åˆè§„åˆ™çš„ keyã€‚</li><li><code>HGETALL</code>ï¼šä¼šè¿”å›ä¸€ä¸ª Hash ä¸­æ‰€æœ‰çš„é”®å€¼å¯¹ã€‚</li><li><code>LRANGE</code>ï¼šä¼šè¿”å› List ä¸­æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ã€‚</li><li><code>SMEMBERS</code>ï¼šè¿”å› Set ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</li><li><code>SINTER</code>&#x2F;<code>SUNION</code>&#x2F;<code>SDIFF</code>ï¼šè®¡ç®—å¤šä¸ª Set çš„äº¤é›†&#x2F;å¹¶é›†&#x2F;å·®é›†ã€‚</li><li>â€¦â€¦</li></ul><p>æ—¶é—´å¤æ‚åº¦å¯èƒ½åœ¨ O(N) ä»¥ä¸Šçš„å‘½ä»¤ï¼š</p><ul><li><code>ZRANGE</code>&#x2F;<code>ZREVRANGE</code>ï¼šè¿”å›æŒ‡å®š Sorted Set ä¸­æŒ‡å®šæ’åèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚æ—¶é—´å¤æ‚åº¦ä¸º O(log(n)+m)ï¼Œn ä¸ºæ‰€æœ‰å…ƒç´ çš„æ•°é‡ï¼Œ m ä¸ºè¿”å›çš„å…ƒç´ æ•°é‡ï¼Œå½“ m å’Œ n ç›¸å½“å¤§æ—¶ï¼ŒO(n) çš„æ—¶é—´å¤æ‚åº¦æ›´å°ã€‚</li><li><code>ZREMRANGEBYRANK</code>&#x2F;<code>ZREMRANGEBYSCORE</code>ï¼šç§»é™¤ Sorted Set ä¸­æŒ‡å®šæ’åèŒƒå›´&#x2F;æŒ‡å®š score èŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ã€‚æ—¶é—´å¤æ‚åº¦ä¸º O(log(n)+m)ï¼Œn ä¸ºæ‰€æœ‰å…ƒç´ çš„æ•°é‡ï¼Œ m è¢«åˆ é™¤å…ƒç´ çš„æ•°é‡ï¼Œå½“ m å’Œ n ç›¸å½“å¤§æ—¶ï¼ŒO(n) çš„æ—¶é—´å¤æ‚åº¦æ›´å°ã€‚</li><li>â€¦â€¦</li></ul><hr><blockquote><p>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</p></blockquote><p>Redisæ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ä¸€ç§ç”¨æ¥è®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šé˜ˆå€¼çš„å‘½ä»¤çš„åŠŸèƒ½ã€‚</p><p>æŸ¥è¯¢æ—¥å¿—é€šè¿‡ä¸¤ä¸ªé…ç½®å‚æ•°æ§åˆ¶ï¼š</p><ol><li><code>slowlog-log-slower-than</code>ï¼šè®¾ç½®æ‰§è¡Œæ—¶é—´è¶…è¿‡å¤šå°‘å¾®ç§’çš„å‘½ä»¤ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚é»˜è®¤å€¼æ˜¯10000å¾®ç§’ï¼ˆå³10æ¯«ç§’ï¼‰ã€‚å¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™è®°å½•æ‰€æœ‰çš„å‘½ä»¤ï¼›å¦‚æœè®¾ç½®ä¸ºè´Ÿæ•°ï¼Œåˆ™ä¸è®°å½•ä»»ä½•å‘½ä»¤ã€‚</li><li><code>slowlog-max-len</code>ï¼šè®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—çš„æœ€å¤§é•¿åº¦ã€‚å½“æ–°çš„å‘½ä»¤è¢«è®°å½•è€Œæ—¥å¿—é•¿åº¦è¶…è¿‡è¿™ä¸ªè®¾ç½®æ—¶ï¼Œæœ€æ—§çš„è®°å½•ä¼šè¢«ç§»é™¤ã€‚</li></ol><p>è¿™äº›å‚æ•°å¯ä»¥åœ¨Redisé…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>CONFIG SET</code>å‘½ä»¤åŠ¨æ€è®¾ç½®ã€‚</p><p>ä¾‹å¦‚ï¼ŒåŠ¨æ€è®¾ç½®è®°å½•æ‰§è¡Œæ—¶é—´è¶…è¿‡20æ¯«ç§’çš„å‘½ä»¤ï¼Œä¸”æ…¢æŸ¥è¯¢æ—¥å¿—æœ€å¤§é•¿åº¦ä¸º128ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">CONFIG <span class="hljs-built_in">SET</span> slowlog-log-slower-than 20000<span class="hljs-built_in"></span><br><span class="hljs-built_in">CONFIG </span><span class="hljs-built_in">SET</span> slowlog-max-len 128<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">SLOWLOG <span class="hljs-built_in">GET</span> 10<br></code></pre></td></tr></table></figure><p><code>SLOWLOG GET</code>Â å‘½ä»¤é»˜è®¤è¿”å›æœ€è¿‘ 10 æ¡çš„çš„æ…¢æŸ¥è¯¢å‘½ä»¤ï¼Œä¹Ÿè‡ªå·±å¯ä»¥æŒ‡å®šè¿”å›çš„æ…¢æŸ¥è¯¢å‘½ä»¤çš„æ•°é‡Â <code>SLOWLOG GET N</code></p><p>æ¯æ¡æ…¢æŸ¥è¯¢æ—¥å¿—åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li>å”¯ä¸€çš„æ…¢æŸ¥è¯¢ID</li><li>å‘½ä»¤æ‰§è¡Œçš„æ—¶é—´æˆ³</li><li>å‘½ä»¤çš„æ‰§è¡Œæ—¶é•¿ï¼ˆå¾®ç§’ï¼‰</li><li>å‘½ä»¤åŠå…¶å‚æ•°</li></ul><blockquote><p>é‡ç½®æ…¢æŸ¥è¯¢æ—¥å¿—</p></blockquote><p>ä½¿ç”¨<code>SLOWLOG RESET</code>å‘½ä»¤å¯ä»¥æ¸…ç©ºå½“å‰çš„æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">SLOWLOG RESET</span><br></code></pre></td></tr></table></figure><h4 id="2-6-Redis-å†…å­˜ç¢ç‰‡"><a href="#2-6-Redis-å†…å­˜ç¢ç‰‡" class="headerlink" title="2.6 Redis å†…å­˜ç¢ç‰‡"></a>2.6 Redis å†…å­˜ç¢ç‰‡</h4><blockquote><p>ä»€ä¹ˆæ˜¯å†…å­˜ç¢ç‰‡</p></blockquote><p>å†…å­˜ç¢ç‰‡æ˜¯ä¸å¯ç”¨çš„ç©ºé—²å†…å­˜, </p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240202075109.png" alt="image.png|500"></p><blockquote><p>Redis ä¸ºä»€ä¹ˆä¼šæœ‰å†…å­˜ç¢ç‰‡</p></blockquote><p>å¸¸è§çš„ä¸¤ä¸ªåŸå› ï¼š</p><ul><li><ol><li><strong>Redis å­˜å‚¨å­˜å‚¨æ•°æ®çš„æ—¶å€™å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„å†…å­˜ç©ºé—´å¯èƒ½ä¼šå¤§äºæ•°æ®å®é™…éœ€è¦çš„å­˜å‚¨ç©ºé—´ã€‚</strong></li></ol></li><li><ol start="2"><li><strong>é¢‘ç¹ä¿®æ”¹ Redis ä¸­çš„æ•°æ®ä¹Ÿä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</strong></li></ol></li></ul><p>Redis çš„å†…å­˜ç¢ç‰‡åŒ–æ˜¯æŒ‡éšç€ Redis è¿è¡Œæ—¶é—´çš„å¢é•¿å’Œæ•°æ®çš„é¢‘ç¹æ›´æ–°ï¼Œå†…å­˜åˆ†é…å’Œé‡Šæ”¾å¯èƒ½å¯¼è‡´å¯ç”¨å†…å­˜è¢«åˆ†å‰²æˆå°å—ï¼Œä»è€Œé™ä½äº†å†…å­˜çš„åˆ©ç”¨æ•ˆç‡ã€‚å†…å­˜ç¢ç‰‡åŒ–åœ¨ Redis ä¸­æ˜¯ä¸€ä¸ªé‡è¦çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒå¯ä»¥å½±å“æ€§èƒ½å¹¶å¯¼è‡´å†…å­˜ä½¿ç”¨é‡ä¸å¿…è¦åœ°å¢åŠ ã€‚</p><blockquote><p>ä½•æ—¶äº§ç”Ÿå†…å­˜ç¢ç‰‡</p></blockquote><ol><li><strong>é¢‘ç¹çš„å°å¯¹è±¡åˆ†é…å’Œé‡Šæ”¾</strong>ï¼š<ul><li>å½“åº”ç”¨é¢‘ç¹åœ°åˆ›å»ºå’Œåˆ é™¤å°å¯¹è±¡æ—¶ï¼Œå¦‚é¢‘ç¹åœ°è®¾ç½®å’Œåˆ é™¤é”®å€¼å¯¹ã€‚</li><li>è¿™ç§æ“ä½œä¼šå¯¼è‡´å†…å­˜ä¸­å‡ºç°å¾ˆå¤šå°çš„ã€ä¸è¿ç»­çš„ç©ºé—´ï¼Œé€ æˆç¢ç‰‡ã€‚</li></ul></li><li><strong>ç‰¹å®šçš„æ•°æ®ç±»å‹æ“ä½œ</strong>ï¼š<ul><li>æŸäº›æ•°æ®ç±»å‹çš„æ“ä½œï¼Œå¦‚å¯¹åˆ—è¡¨ã€é›†åˆå’Œå“ˆå¸Œçš„é¢‘ç¹ä¿®æ”¹ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´å†…å­˜ç¢ç‰‡åŒ–ã€‚</li></ul></li><li><strong>å¤§é‡å†™å…¥åçš„åˆ é™¤</strong>ï¼š<ul><li>å½“å¤§é‡æ•°æ®è¢«å†™å…¥ Redis å¹¶ä¸”ä¹‹ååˆè¢«åˆ é™¤æ—¶ï¼Œå°¤å…¶æ˜¯è¿™äº›æ•°æ®çš„å¤§å°ä¸ä¸€æ—¶ã€‚</li></ul></li></ol><blockquote><p>å¦‚ä½•å¤„ç†å’Œå‡å°‘å†…å­˜ç¢ç‰‡åŒ–</p></blockquote><ol><li><strong>ç›‘æ§å†…å­˜ç¢ç‰‡ç‡</strong>ï¼š<ul><li>ä½¿ç”¨ <code>INFO memory</code> å‘½ä»¤ç›‘æ§å†…å­˜ç¢ç‰‡ç‡ï¼ˆ<code>mem_fragmentation_ratio</code>ï¼‰ã€‚å¦‚æœç¢ç‰‡ç‡é«˜ï¼ˆä¾‹å¦‚å¤§äº 1.5ï¼‰ï¼Œåˆ™å¯èƒ½éœ€è¦é‡‡å–æªæ–½ã€‚</li></ul></li><li><strong>å®šæœŸé‡å¯</strong>ï¼š<ul><li>å®šæœŸé‡å¯ Redis æœåŠ¡å¯ä»¥å‡å°‘ç¢ç‰‡åŒ–ï¼Œä½†è¿™å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡ä¸­æ–­ã€‚</li></ul></li><li><strong>å†…å­˜ç¢ç‰‡æ•´ç†</strong>ï¼š<ul><li>åœ¨ Redis 4.0 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>MEMORY PURGE</code> å‘½ä»¤ï¼ˆåœ¨æŸäº›ç‰ˆæœ¬ä¸­å¯ç”¨ï¼‰æ¥å°è¯•å‡å°‘å†…å­˜ç¢ç‰‡ã€‚</li><li>ä½¿ç”¨ <code>redis-cli --intrinsic-latency</code> å‘½ä»¤æ£€æµ‹å†…å­˜ç¢ç‰‡æ•´ç†è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿã€‚</li></ul></li><li><strong>ä½¿ç”¨æ›´å¤§çš„å¯¹è±¡</strong>ï¼š<ul><li>å¯¹äºé«˜é¢‘æ“ä½œçš„æ•°æ®ï¼Œè€ƒè™‘å°†å¤šä¸ªå°å¯¹è±¡åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„å¯¹è±¡ã€‚</li></ul></li><li><strong>è°ƒæ•´å†…å­˜åˆ†é…å™¨é…ç½®</strong>ï¼š<ul><li>è°ƒæ•´ Jemalloc åˆ†é…å™¨çš„é…ç½®ï¼Œå¯èƒ½æœ‰åŠ©äºå‡å°‘ç¢ç‰‡åŒ–ã€‚</li></ul></li><li><strong>åº”ç”¨å±‚ä¼˜åŒ–</strong>ï¼š<ul><li>åœ¨åº”ç”¨å±‚ä¼˜åŒ–æ•°æ®è®¿é—®æ¨¡å¼ï¼Œå‡å°‘é¢‘ç¹çš„å°å¯¹è±¡å†™å…¥å’Œåˆ é™¤ã€‚</li></ul></li><li><strong>æ•°æ®ç»“æ„é€‰æ‹©</strong>ï¼š<ul><li>æ ¹æ®ä½¿ç”¨åœºæ™¯åˆç†é€‰æ‹©æ•°æ®ç»“æ„ï¼Œæœ‰äº›æ•°æ®ç»“æ„å¯èƒ½æ›´å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</li></ul></li></ol><blockquote><p>å®é™…ä¸šåŠ¡åœºæ™¯ä¸‹çš„åº”å¯¹ç­–ç•¥</p></blockquote><p>åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„ä½¿ç”¨åœºæ™¯å’Œæ•°æ®æ¨¡å¼æ¥ç¡®å®šæœ€ä½³çš„å¤„ç†å†…å­˜ç¢ç‰‡åŒ–çš„ç­–ç•¥ã€‚é€šå¸¸ï¼Œéœ€è¦å®šæœŸç›‘æ§ Redis çš„å†…å­˜ç¢ç‰‡ç‡ï¼Œå¹¶åœ¨ç¢ç‰‡åŒ–è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶é‡‡å–ç›¸åº”æªæ–½ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œ Redis çš„é‡å¯æˆ–å†…å­˜ç¢ç‰‡æ•´ç†ï¼Œä»¥å‡å°‘å¯¹ä¸šåŠ¡çš„å½±å“ã€‚åŒæ—¶ï¼Œä¼˜åŒ–æ•°æ®è®¿é—®æ¨¡å¼å’Œé€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼Œä¹Ÿå¯ä»¥åœ¨é•¿æœŸå†…æœ‰æ•ˆå‡å°‘å†…å­˜ç¢ç‰‡åŒ–çš„å‘ç”Ÿã€‚</p><h3 id="9ã€Redis-ç”Ÿäº§é—®é¢˜-ğŸš©"><a href="#9ã€Redis-ç”Ÿäº§é—®é¢˜-ğŸš©" class="headerlink" title="9ã€Redis ç”Ÿäº§é—®é¢˜  ğŸš©"></a>9ã€Redis ç”Ÿäº§é—®é¢˜  ğŸš©</h3><div style="background-color: #f2c867; color: #34495e; padding: 15px; border: 2px solid #bdc3c7; border-radius: 5px;">  <strong>Redis ç”Ÿäº§é—®é¢˜ï¼š</strong>ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©ã€æ•°æ®ä¸€è‡´æ€§ã€Redis é˜»å¡</div><h4 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h4><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡å½“è¯·æ±‚çš„æ•°æ®æ—¢ä¸åœ¨ç¼“å­˜ä¸­ä¹Ÿä¸å­˜åœ¨äºæ•°æ®åº“ä¸­æ—¶ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥åˆ°è¾¾æ•°æ®åº“å±‚çš„ç°è±¡ã€‚</p><p>è¿™é€šå¸¸å‘ç”Ÿåœ¨è¯·æ±‚éæ³•æˆ–ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼ˆè¿™ç±»æ•°æ®ä¸ä¼šè¢«ç¼“å­˜ï¼‰ï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šç©¿è¿‡ç¼“å­˜å±‚ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ã€‚</p><p>å¦‚æœæœ‰å¤§é‡æ­¤ç±»æŸ¥è¯¢ï¼Œ<strong>æ•°æ®åº“å¯èƒ½ä¼šå› æ­¤æ‰¿å—è¿‡å¤§çš„å‹åŠ›</strong>ã€‚</p><blockquote><p>æˆå› </p></blockquote><ul><li>é¢‘ç¹æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼ˆå¯èƒ½æ˜¯ç”±äºé”™è¯¯çš„è¾“å…¥æˆ–æ¶æ„æ”»å‡»ï¼‰ã€‚</li></ul><blockquote><p>è§£å†³æ–¹æ¡ˆ</p></blockquote><ul><li><strong>ç©ºå¯¹è±¡ç¼“å­˜</strong>ï¼ˆç¼“å­˜ç©ºç»“æœï¼‰<ul><li>å³ä½¿æŸä¸ªå€¼åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥åœ¨ç¼“å­˜ä¸­å­˜å‚¨ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå¯¹è±¡æˆ–ç©ºå€¼ï¼Œå¹¶è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ã€‚</li><li>è¿™æ ·ï¼Œç›¸åŒçš„æ— æ•ˆè¯·æ±‚åœ¨è¿™ä¸ªè¿‡æœŸæ—¶é—´å†…ä¼šç›´æ¥å¾—åˆ°ç¼“å­˜ä¸­çš„ç©ºç»“æœï¼Œè€Œä¸ä¼šå†æ¬¡æŸ¥è¯¢æ•°æ®åº“ã€‚</li><li>ç¼ºç‚¹ï¼šå¯èƒ½ä¼šå¯¼è‡´æœŸé—´ä½¿ç”¨å†…å­˜è¾ƒé«˜ï¼Œç¼“å­˜èµ„æºæµªè´¹</li></ul></li><li><strong>å¸ƒéš†è¿‡æ»¤å™¨</strong><ul><li>åœ¨æŸ¥è¯¢ä¹‹å‰ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­æ•°æ®æ˜¯å¦å¯èƒ½å­˜åœ¨ã€‚å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ç©ºé—´æ•ˆç‡é«˜ä½†å¯èƒ½æœ‰ä¸€å®šè¯¯åˆ¤ç‡çš„æ•°æ®ç»“æ„ã€‚</li></ul></li></ul><h5 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h5><p>å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥å‚è€ƒçš„ä¸€ä¸ªé“¾æ¥ï¼š <a href="https://mp.weixin.qq.com/s/DeqJfw51tPJvdwAkq3iPdg">https://mp.weixin.qq.com/s/DeqJfw51tPJvdwAkq3iPdg</a></p><hr><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰</p><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§ç©ºé—´æ•ˆç‡é«˜çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼Œç”¨äºåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒå¯èƒ½ä¼šæœ‰ä¸€å®šçš„è¯¯åˆ¤ç‡ï¼ˆå³è®¤ä¸ºå…ƒç´ å­˜åœ¨äºé›†åˆä¸­ï¼Œä½†å®é™…ä¸Šå¹¶ä¸å­˜åœ¨ï¼‰ï¼Œä½†ä¸ä¼šæ¼æŠ¥ï¼ˆå³å¦‚æœå®ƒè¯´å…ƒç´ ä¸åœ¨é›†åˆä¸­ï¼Œé‚£ä¹ˆå…ƒç´ ç»å¯¹ä¸åœ¨é›†åˆä¸­ï¼‰ã€‚</p><p>é€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨é¢„å…ˆåˆ¤æ–­è¯·æ±‚çš„æ•°æ®æ˜¯å¦å¯èƒ½å­˜åœ¨ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å¯¹ä¸å­˜åœ¨çš„æ•°æ®è¿›è¡ŒæŸ¥è¯¢ã€‚</p><blockquote><p>ç»„æˆ</p></blockquote><p>æˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹ä½œç”±äºŒè¿›åˆ¶å‘é‡ï¼ˆæˆ–è€…è¯´ä½æ•°ç»„ï¼‰å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰ä¸¤éƒ¨åˆ†ç»„æˆçš„æ•°æ®ç»“æ„</p><blockquote><p>å·¥ä½œåŸç†</p></blockquote><p>å¸ƒéš†è¿‡æ»¤å™¨åº•å±‚åŸºäºä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡ï¼ˆä½æ•°ç»„ï¼‰å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰ã€‚</p><p>å…·ä½“å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>åˆå§‹åŒ–</strong>ï¼šå¼€å§‹æ—¶ï¼Œå¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªåŒ…å«mä½çš„æ•°ç»„ï¼Œæ‰€æœ‰ä½éƒ½è®¾ç½®ä¸º0ã€‚</li><li><strong>æ·»åŠ å…ƒç´ </strong>ï¼šå½“å‘è¿‡æ»¤å™¨æ·»åŠ ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ ä¼šè¢«kä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«è®¡ç®—å“ˆå¸Œå€¼ï¼Œæ¯ä¸ªå“ˆå¸Œå‡½æ•°å°†äº§ç”Ÿä¸€ä¸ªæ•°ç»„èŒƒå›´å†…çš„ä½ç½®ã€‚ç„¶åå°†è¿™äº›ä½ç½®çš„ä½éƒ½è®¾ç½®ä¸º1ã€‚</li><li><strong>æŸ¥è¯¢å…ƒç´ </strong>ï¼šè¦æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ï¼Œåªéœ€å¯¹è¯¥å…ƒç´ ä½¿ç”¨ç›¸åŒçš„kä¸ªå“ˆå¸Œå‡½æ•°å¾—åˆ°kä¸ªä½ç½®ï¼Œå¦‚æœè¿™äº›ä½ç½®çš„ä½éƒ½æ˜¯1ï¼Œåˆ™è®¤ä¸ºå…ƒç´ å¯èƒ½åœ¨é›†åˆä¸­ï¼ˆå­˜åœ¨è¯¯åˆ¤ï¼‰ã€‚å¦‚æœä»»ä½•ä¸€ä¸ªä½æ˜¯0ï¼Œåˆ™å…ƒç´ ä¸€å®šä¸åœ¨é›†åˆä¸­ã€‚</li></ol><blockquote><p>å…·ä½“ä½¿ç”¨ç¤ºä¾‹ï¼›</p></blockquote><p>Redis v4.0 ä¹‹åæœ‰äº† Moduleï¼ˆæ¨¡å—&#x2F;æ’ä»¶ï¼‰ åŠŸèƒ½ï¼ŒRedis Modules è®© Redis å¯ä»¥ä½¿ç”¨å¤–éƒ¨æ¨¡å—æ‰©å±•å…¶åŠŸèƒ½ ã€‚</p><p>é¦–å…ˆéœ€è¦ç¡®ä¿ä½ çš„Rediså®ä¾‹å·²ç»å®‰è£…äº†RedisBloomæ¨¡å—ã€‚å®‰è£…åï¼Œä½¿ç”¨è¯¥æ¨¡å—æä¾›çš„å‘½ä»¤æ¥åˆ›å»ºå’Œç®¡ç†å¸ƒéš†è¿‡æ»¤å™¨ã€‚</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment">#åŸºæœ¬çš„RedisBloomå¸ƒéš†è¿‡æ»¤å™¨å‘½ä»¤</span><br><span class="hljs-comment">#BF.ADDï¼šå‘å¸ƒéš†è¿‡æ»¤å™¨æ·»åŠ å…ƒç´ : å‘åä¸º`myBloomFilter`çš„å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ·»åŠ å…ƒç´ `item`ã€‚</span><br>BF.ADD myBloomFilter <span class="hljs-built_in">item</span><br><br><span class="hljs-comment">#BF.EXISTSï¼šæ£€æŸ¥ç»™å®šçš„å…ƒç´ æ˜¯å¦å¯èƒ½å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</span><br><span class="hljs-comment">#å¦‚æœå‘½ä»¤è¿”å›1ï¼Œè¡¨ç¤º`item`å¯èƒ½å­˜åœ¨äºè¿‡æ»¤å™¨ä¸­ï¼›å¦‚æœè¿”å›0ï¼Œåˆ™`item`ç»å¯¹ä¸åœ¨è¿‡æ»¤å™¨ä¸­ã€‚</span><br><span class="hljs-comment">#- BF.MADDï¼šå‘å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ·»åŠ å¤šä¸ªå…ƒç´ ã€‚</span><br><span class="hljs-comment">#- BF.MEXISTSï¼šæ£€æŸ¥å¤šä¸ªå…ƒç´ æ˜¯å¦å¯èƒ½å­˜åœ¨äºå¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚</span><br>BF.EXISTS myBloomFilter <span class="hljs-built_in">item</span><br></code></pre></td></tr></table></figure><blockquote><p>å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä»€ä¹ˆæ—¶å€™åŠ è½½çš„ï¼Ÿ</p></blockquote><p>ä¸€èˆ¬æ˜¯é¢„åŠ è½½ï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„åŠ è½½é€šå¸¸åœ¨ç³»ç»Ÿå¯åŠ¨æˆ–åœ¨ç»´æŠ¤çª—å£è¿›è¡Œï¼Œå› æ­¤å¯¹å®æ—¶æ€§çš„å½±å“å¯ä»¥æ§åˆ¶ã€‚</p><p>ä¸€æ—¦å¸ƒéš†è¿‡æ»¤å™¨å»ºç«‹ï¼Œå…¶æŸ¥è¯¢æ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œå¯¹åœ¨çº¿æœåŠ¡å‡ ä¹æ²¡æœ‰å½±å“ã€‚</p><p>ä¸€èˆ¬æ˜¯åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶ï¼Œå¯¹äºæ•°æ®åº“ä¸­å·²æœ‰çš„æ•°æ®ï¼Œä¼šå°†å…¶é”®ï¼ˆæˆ–æ ‡è¯†ï¼‰æ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œä»è€Œå®ç°è¿‡æ»¤æ‰ä¸å­˜åœ¨çš„æ•°æ®ã€‚</p><h4 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h4><p>ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡ç¼“å­˜ä¸­æŸä¸ªçƒ­ç‚¹keyçªç„¶å¤±æ•ˆï¼ˆè¿‡æœŸï¼‰ï¼Œå¯¼è‡´å¤§é‡å¹¶å‘è¯·æ±‚ç›´æ¥è½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…å‹åŠ›å‰§å¢çš„ç°è±¡ã€‚</p><p>ä¸ç¼“å­˜ç©¿é€ä¸åŒï¼Œç¼“å­˜å‡»ç©¿æ˜¯é’ˆå¯¹åŸæœ¬å°±å­˜åœ¨äºç¼“å­˜ä¸­çš„çƒ­ç‚¹æ•°æ®ã€‚</p><blockquote><p>ç¼“å­˜å‡»ç©¿çš„é—®é¢˜</p></blockquote><ul><li>çƒ­ç‚¹æ•°æ®åœ¨ç¼“å­˜ä¸­çªç„¶è¿‡æœŸï¼Œè€Œæ­¤æ—¶æ­£æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿™äº›æ•°æ®ã€‚</li><li>æ ¸å¿ƒåœ¨äºçƒ­ç‚¹keyå¤±æ•ˆç¬é—´ï¼Œæ‰€æœ‰å¯¹è¿™ä¸ªkeyçš„è¯·æ±‚éƒ½ä¼šç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯¹æ•°æ®åº“é€ æˆè¾ƒå¤§å‹åŠ›ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´æ•°æ®åº“ç˜«ç—ªã€‚</li></ul><blockquote><p>è§£å†³æ–¹æ¡ˆ</p></blockquote><ul><li><strong>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</strong><ul><li>å¯¹äºä¸€äº›çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥è®¾ç½®å…¶ç¼“å­˜æ°¸ä¸è¿‡æœŸï¼Œæˆ–è€…è®¾ç½®ä¸€ä¸ªéå¸¸é•¿çš„è¿‡æœŸæ—¶é—´ï¼Œä»è€Œé¿å…ç¼“å­˜å‡»ç©¿é—®é¢˜ã€‚</li><li>ä½†è¿™ç§æ–¹æ³•éœ€è¦å®šæœŸæ‰‹åŠ¨æˆ–é€šè¿‡ç¨‹åºæ›´æ–°ç¼“å­˜ï¼Œä»¥ä¿è¯æ•°æ®çš„æ–°é²œåº¦</li></ul></li><li><strong>äº’æ–¥é”</strong><ul><li>åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œä½¿ç”¨äº’æ–¥é”æˆ–åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªè¯·æ±‚å»æ•°æ®åº“æŸ¥è¯¢æ•°æ®å¹¶é‡æ–°ç¼“å­˜ã€‚</li><li>å…¶ä»–è¯·æ±‚ç­‰å¾…ç¼“å­˜åŠ è½½å®Œæˆåå†è®¿é—®ç¼“å­˜</li></ul></li><li>æå‰é¢„çƒ­<ul><li>åœ¨ç¼“å­˜å³å°†è¿‡æœŸå‰ï¼Œåå°å¼‚æ­¥ç¨‹åºæå‰æ›´æ–°ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿çƒ­ç‚¹æ•°æ®åœ¨ç¼“å­˜ä¸­å§‹ç»ˆæ˜¯å¯ç”¨çš„</li></ul></li><li><strong>äºŒçº§ç¼“å­˜ç­–ç•¥</strong><ul><li>ä¸ºçƒ­ç‚¹æ•°æ®è®¾ç½®ä¸¤çº§ç¼“å­˜ï¼Œç¬¬ä¸€çº§ç¼“å­˜æ­£å¸¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼›ç¬¬äºŒçº§ç¼“å­˜è®¾ç½®è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ã€‚å½“ç¬¬ä¸€çº§ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œè¯·æ±‚å¯ä»¥è®¿é—®ç¬¬äºŒçº§ç¼“å­˜ï¼ŒåŒæ—¶å¼‚æ­¥æ›´æ–°ç¬¬ä¸€çº§ç¼“å­˜å’Œç¬¬äºŒçº§ç¼“å­˜æ•°æ®ã€‚</li></ul></li></ul><blockquote><p>äº’æ–¥é”çš„ä½¿ç”¨</p></blockquote><p>å½“ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä¸æ˜¯æ‰€æœ‰è¯·æ±‚éƒ½å»æ•°æ®åº“åŠ è½½æ•°æ®ï¼Œè€Œæ˜¯ä½¿ç”¨æŸç§äº’æ–¥æœºåˆ¶ï¼ˆå¦‚åˆ†å¸ƒå¼é”ï¼‰ä¿è¯åªæœ‰ä¸€ä¸ªè¯·æ±‚å»æ•°æ®åº“æŸ¥è¯¢æ•°æ®å¹¶åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œå…¶ä»–è¯·æ±‚ç­‰å¾…ç¼“å­˜åŠ è½½å®Œæˆåå†è®¿é—®ç¼“å­˜ã€‚è¿™ç§æ–¹å¼å¯ä»¥æœ‰æ•ˆå‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚</p><p>ç¤ºä¾‹ä¼ªä»£ç ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">cache</span>.get(key) == <span class="hljs-built_in">null</span>) &#123;<br>    <span class="hljs-keyword">if</span> (lock.tryLock()) &#123;<br>        <span class="hljs-comment">// åªæœ‰è·å¾—é”çš„è¯·æ±‚å»æ•°æ®åº“æŸ¥è¯¢å¹¶æ›´æ–°ç¼“å­˜</span><br>        <span class="hljs-built_in">data</span> = database.find(key);<br>        <span class="hljs-keyword">cache</span>.<span class="hljs-built_in">set</span>(key, <span class="hljs-built_in">data</span>);<br>        lock.unlock();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// å…¶ä»–è¯·æ±‚ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•</span><br>        <span class="hljs-keyword">Thread</span>.sleep(<span class="hljs-number">100</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">cache</span>.get(key);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨äº’æ–¥é”é˜²æ­¢ç¼“å­˜å‡»ç©¿çš„å…·ä½“æ­¥éª¤ï¼š</p><ul><li>1ã€æ£€æŸ¥ç¼“å­˜</li><li>2ã€å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥</li><li>3ã€åœ¨è®¿é—®æ•°æ®åº“ä¹‹å‰ï¼Œå°è¯•å¯¹è¿™ä¸ªç‰¹å®šçš„æ•°æ®è¯·æ±‚è·å–ä¸€ä¸ªäº’æ–¥é”ã€‚<ul><li>å¦‚æœ<strong>è·å–é”æˆåŠŸ</strong>ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥ï¼›è¿™æ„å‘³ç€å½“å‰è¯·æ±‚è¢«é€‰ä¸­ä¸ºå»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®å¹¶æ›´æ–°ç¼“å­˜çš„è¯·æ±‚ã€‚</li><li>å¦‚æœ<strong>è·å–é”å¤±è´¥</strong>ï¼Œå½“å‰è¯·æ±‚è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚ç„¶åå›åˆ°æ­¥éª¤1é‡æ–°æ£€æŸ¥ç¼“å­˜ï¼ˆå› ä¸ºæ­¤æ—¶ç¼“å­˜å¯èƒ½å·²ç»è¢«æ›´æ–°ï¼‰ã€‚</li></ul></li><li>4ã€æŸ¥è¯¢æ•°æ®åº“</li><li>5ã€æ›´æ–°ç¼“å­˜<ul><li>å°†æŸ¥è¯¢åˆ°çš„æ•°æ®æ›´æ–°åˆ°ç¼“å­˜ä¸­ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªåˆç†çš„è¿‡æœŸæ—¶é—´ã€‚è¿™ä¸€æ­¥å¾ˆå…³é”®ï¼Œå®ƒä¿è¯äº†åç»­çš„è¯·æ±‚å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚</li></ul></li><li>6ã€é‡Šæ”¾é”<ul><li>å®Œæˆæ•°æ®åº“æŸ¥è¯¢å’Œç¼“å­˜æ›´æ–°åï¼Œé‡Šæ”¾æ­¥éª¤2ä¸­è·å–çš„é”ï¼Œå…è®¸å…¶ä»–ç­‰å¾…çš„è¯·æ±‚ç»§ç»­æ‰§è¡Œ</li></ul></li></ul><hr><blockquote><p>æå‰é¢„çƒ­</p></blockquote><p>æå‰é¢„çƒ­çš„æ“ä½œå…¶å®å¹¶ä¸æ­¢è‡ªåŠ¨å»¶é•¿è¿‡æœŸæ—¶é—´ï¼›è¿˜åŒ…æ‹¬é™æ€é¢„çƒ­ã€è‡ªåŠ¨é¢„çƒ­ï¼ˆæ‰‹åŠ¨&#x2F;è‡ªåŠ¨å°†çƒ­ç‚¹æ•°æ®æå‰æ”¾å…¥ç¼“å­˜ï¼‰ï¼›</p><p>è‡ªåŠ¨å»¶è¿Ÿçš„å®ç°ç¤ºä¾‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># æ£€æŸ¥keyçš„å‰©ä½™è¿‡æœŸæ—¶é—´</span><br><span class="hljs-attribute">TTL</span> hot_key<br><br><span class="hljs-comment"># å¦‚æœè¿”å›çš„å‰©ä½™æ—¶é—´å°‘äº60ç§’ï¼Œåˆ™å»¶é•¿è¿‡æœŸæ—¶é—´</span><br><span class="hljs-attribute">EXPIRE</span> hot_key <span class="hljs-number">300</span><br></code></pre></td></tr></table></figure><hr><blockquote><p>äºŒçº§ç¼“å­˜ç­–ç•¥</p></blockquote><p>äºŒçº§ç¼“å­˜ç»“æ„è®¾è®¡é€šå¸¸æ¶‰åŠåœ¨ç°æœ‰çš„ç¼“å­˜ç³»ç»Ÿï¼ˆç¬¬ä¸€çº§ç¼“å­˜ï¼‰ä¹‹å¤–ï¼Œé¢å¤–è®¾ç½®ä¸€ä¸ªç¼“å­˜å±‚ï¼ˆç¬¬äºŒçº§ç¼“å­˜ï¼‰ï¼Œè¿™ä¸ªé¢å¤–çš„ç¼“å­˜å±‚å¯ä»¥æ˜¯åŒä¸€ç§ç¼“å­˜æŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸åŒçš„ç¼“å­˜æŠ€æœ¯ï¼Œå…·ä½“å–å†³äºéœ€æ±‚å’Œç¯å¢ƒã€‚</p><p>ç¼“å­˜æŠ€æœ¯é€‰æ‹©</p><ul><li><strong>ç¬¬ä¸€çº§ç¼“å­˜</strong>ï¼šé€šå¸¸ä½äºåº”ç”¨æœåŠ¡å™¨å†…éƒ¨ï¼Œå¦‚å†…å­˜ä¸­çš„å¯¹è±¡ç¼“å­˜ï¼ˆä¾‹å¦‚ï¼ŒJavaä¸­çš„HashMapæˆ–Guava Cacheï¼‰ã€‚ç¬¬ä¸€çº§ç¼“å­˜çš„ä¸»è¦ç›®çš„æ˜¯æä¾›é«˜é€Ÿè®¿é—®ï¼Œå‡å°‘ç½‘ç»œå»¶è¿Ÿã€‚</li><li><strong>ç¬¬äºŒçº§ç¼“å­˜</strong>ï¼šé€šå¸¸ä½äºåº”ç”¨æœåŠ¡å™¨å¤–éƒ¨ï¼Œå¯ä»¥æ˜¯åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿï¼ˆä¾‹å¦‚Redisæˆ–Memcachedï¼‰ã€‚ç¬¬äºŒçº§ç¼“å­˜ç”¨äºå­˜å‚¨æ›´å¤šæ•°æ®ï¼Œæä¾›ç›¸å¯¹è¾ƒé•¿çš„æ•°æ®ä¿å­˜æ—¶é—´ï¼Œä¿è¯æ•°æ®çš„æŒä¹…æ€§å’Œç¨³å®šæ€§ã€‚</li></ul><p>ä¸¤çº§ç¼“å­˜å¯ä»¥è®¾ç½®ä¸åŒçš„è¿‡æœŸç­–ç•¥ï¼š</p><ul><li>ç¬¬ä¸€çº§ç¼“å­˜é€šå¸¸è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œä»¥ä¿è¯æ•°æ®çš„æ–°é²œæ€§ã€‚</li><li>ç¬¬äºŒçº§ç¼“å­˜å¯ä»¥è®¾ç½®è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ï¼Œæˆ–æ ¹æ®éœ€è¦ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä½œä¸ºä¸€ä¸ªç¨³å®šçš„æ•°æ®å¤‡ä»½ã€‚</li></ul><hr><h4 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h4><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡ç¼“å­˜ä¸­<strong>å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸ</strong>ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œå¯èƒ½ä¼šä½¿æ•°æ®åº“å‹åŠ›è¿‡å¤§ç”šè‡³å´©æºƒã€‚</p><blockquote><p>æˆå› </p></blockquote><ul><li>ç¼“å­˜è®¾ç½®äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸã€‚</li><li>ç¼“å­˜æœåŠ¡å´©æºƒï¼Œæ‰€æœ‰æ•°æ®ä¸¢å¤±ã€‚</li></ul><blockquote><p>è§£å†³æ–¹æ¡ˆ</p></blockquote><ul><li><strong>ä¸åŒçš„è¿‡æœŸæ—¶é—´</strong>ï¼šä¸ºç¼“å­˜æ•°æ®è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œé¿å…åŒæ—¶è¿‡æœŸã€‚ï¼ˆå¯ä»¥åœ¨è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´æ—¶åŠ å…¥éšæœºå€¼ï¼‰</li><li><strong>ç¼“å­˜æ•°æ®é¢„çƒ­</strong>ï¼šç³»ç»Ÿå¯åŠ¨æ—¶é¢„å…ˆåŠ è½½çƒ­ç‚¹æ•°æ®åˆ°ç¼“å­˜ä¸­ã€‚</li><li>é™æµé™çº§ï¼šåœ¨ç³»ç»Ÿå…¥å£å¤„ä½¿ç”¨é™æµé™çº§ç­–ç•¥ï¼Œé¿å…åœ¨ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œçªå‘æµé‡ç›´æ¥æ‰“åˆ°æ•°æ®åº“ã€‚</li><li>ä½¿ç”¨å¤šçº§ç¼“å­˜ç­–ç•¥</li><li><strong>ä½¿ç”¨é«˜å¯ç”¨çš„ç¼“å­˜æ¶æ„</strong>ï¼šæ¯”å¦‚ä½¿ç”¨Redisé›†ç¾¤ï¼Œæé«˜ç¼“å­˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®¹é”™èƒ½åŠ›ã€‚</li></ul><hr><p>æ€»ç»“ä¸€ä¸‹ä¸Šé¢çš„ä¸‰ä¸ªå¸¸è§çš„ç”Ÿäº§é—®é¢˜ï¼šç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©ï¼›</p><ul><li>1ã€ç¼“å­˜ç©¿é€æŒ‡çš„ä¸å­˜åœ¨çš„æ•°æ®è¿›è¡Œè®¿é—®ç¼“å­˜ï¼Œå¹¶æ‰“åˆ°æ•°æ®åº“ä¸­ï¼Œè§£å†³æ–¹æ¡ˆä¸€èˆ¬æœ‰ï¼šç©ºå¯¹è±¡ç¼“å­˜ã€å¸ƒéš†è¿‡æ»¤å™¨</li><li>2ã€ç¼“å­˜å‡»ç©¿å’Œç¼“å­˜é›ªå´©æœ‰ç‚¹åƒï¼Œéƒ½æ˜¯ç¼“å­˜å¤±æ•ˆï¼Œä½†å‰è€…ä¸€èˆ¬æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œåè€…æ˜¯å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸï¼›<ul><li>çƒ­ç‚¹æ•°æ®å»ºè®®åšä¸€ä¸‹é¢„çƒ­å¤„ç†ï¼Œåœ¨å¿«è¦è¿‡æœŸçš„æ—¶å€™è¿›è¡Œå¤„ç†ä¸€ä¸‹ï¼›æˆ–è€…è¯´å¸¸ç”¨çš„ä¸¤ç§å¤„ç†æ–¹æ¡ˆï¼š<ul><li>è®¾ç½®çƒ­ç‚¹æ•°æ®ä¸è¿‡æœŸï¼Œä¸è¿‡åç»­éœ€è¦æ‰‹åŠ¨è¿›è¡Œæ›´æ–°ç¼“å­˜æˆ–è€…ç¨‹åºæ›´æ–°</li><li>è®¾ç½®äº’æ–¥é”ï¼Œä¿è¯åŒä¸€æ—¶åˆ»è®¿é—®ç¼“å­˜çš„æ•°æ®ï¼ˆç¼“å­˜ä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼‰ï¼Œæ­¤æ—¶åªæœ‰ä¸€ä¸ª</li></ul></li><li>å¤§é‡æ•°æ®è¿‡æœŸå»ºè®®ä½¿ç”¨éšæœºè¿‡æœŸæ—¶é—´ï¼ŒåŒæ—¶å¯ä»¥è®¾ç½®ä¸€ä¸‹é™æµï¼Œé˜²æ­¢å¤§é‡æ•°æ®åŒæ—¶è¯·æ±‚ï¼›ä¹Ÿå¯ä»¥è®¾ç½®å¤šçº§çš„ä¸€ä¸ªç¼“å­˜ç­–ç•¥æ“ä½œã€‚</li></ul></li></ul><hr><h4 id="æ•°æ®ä¸€è‡´æ€§-ğŸš©"><a href="#æ•°æ®ä¸€è‡´æ€§-ğŸš©" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§  ğŸš©"></a>æ•°æ®ä¸€è‡´æ€§  ğŸš©</h4><blockquote><p>å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§</p></blockquote><p>é˜…è¯»ï¼š</p><ul><li>ç›¸å…³æ–‡ç« æ¨èï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzIyOTYxNDI5OA==&mid=2247487312&idx=1&sn=fa19566f5729d6598155b5c676eee62d&chksm=e8beb8e5dfc931f3e35655da9da0b61c79f2843101c130cf38996446975014f958a6481aacf1&scene=178&cur_album_id=1699766580538032128#rd">ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº† </a>ã€‚</li></ul><p>ç®€ä»‹ç›¸å…³å†…å®¹ï¼šæˆ‘ä»¬è€ƒè™‘å¼•å…¥ ç¼“å­˜ æ˜¯æ‰“ç®—æé«˜è¯»æ€§èƒ½ï¼Œå¼•å…¥ç¼“å­˜åï¼Œä¹‹å‰æ”¾å…¥åˆ°æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œç°åœ¨éœ€è¦æ”¾åˆ°æ•°æ®ä¸­å­˜å–ï¼Œæˆ‘ä»¬éœ€è¦æ€ä¹ˆæ“ä½œï¼Ÿ â†’ </p><ul><li>å…¨é‡æ•°æ®åˆ·åˆ°ç¼“å­˜ä¸­ï¼ˆæœ€ç®€å•ï¼‰<ul><li>æ•°æ®åº“çš„æ•°æ®ï¼Œå…¨é‡åˆ·å…¥ç¼“å­˜ï¼ˆä¸è®¾ç½®å¤±æ•ˆæ—¶é—´ï¼‰</li><li>å†™è¯·æ±‚åªæ›´æ–°æ•°æ®åº“ï¼Œä¸æ›´æ–°ç¼“å­˜</li><li>å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œ<strong>å®šæ—¶</strong>æŠŠæ•°æ®åº“çš„æ•°æ®ï¼Œæ›´æ–°åˆ°ç¼“å­˜ä¸­</li></ul></li><li>ç¼“å­˜ä¸­åªä¿ç•™æœ€è¿‘è®¿é—®çš„ã€Œçƒ­æ•°æ®ã€<ul><li>å†™è¯·æ±‚ä¾æ—§åªå†™æ•°æ®åº“</li><li>è¯»è¯·æ±‚å…ˆè¯»ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ™ä»æ•°æ®åº“è¯»å–ï¼Œå¹¶é‡å»ºç¼“å­˜</li><li>åŒæ—¶ï¼Œå†™å…¥ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œéƒ½è®¾ç½®å¤±æ•ˆæ—¶é—´</li></ul></li><li>æ›´æ–°æ•°æ®åº“ + æ›´æ–°ç¼“å­˜<ul><li>ä¸æ¨èæ›´æ–°æ•°æ®åº“ + æ›´æ–°ç¼“å­˜çš„æ–¹æ¡ˆ</li><li>å†™åˆ°ç¼“å­˜ä¸­çš„å€¼ï¼Œå¹¶ä¸æ˜¯ä¸æ•°æ®åº“ä¸­çš„å€¼ä¸€ä¸€å¯¹åº”çš„ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå†ç»è¿‡ä¸€ç³»åˆ—ã€Œè®¡ç®—ã€å¾—å‡ºä¸€ä¸ªå€¼ï¼Œæ‰æŠŠè¿™ä¸ªå€¼æ‰å†™åˆ°ç¼“å­˜ä¸­</li></ul></li><li>æ—è·¯ç¼“å­˜æ¨¡å¼: é‡åˆ°å†™è¯·æ±‚çš„æ—¶å€™æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ cache</li></ul><p>æ€è€ƒï¼š</p><ul><li>ä¸€æ—¦æˆ‘ä»¬å†³å®šä½¿ç”¨ç¼“å­˜ï¼Œé‚£å¿…ç„¶è¦é¢ä¸´ä¸€è‡´æ€§é—®é¢˜ã€‚æ€§èƒ½å’Œä¸€è‡´æ€§å°±åƒå¤©å¹³çš„ä¸¤ç«¯ï¼Œæ— æ³•åšåˆ°éƒ½æ»¡è¶³è¦æ±‚ã€‚</li><li>æ—¢ç„¶å†³å®šä½¿ç”¨ç¼“å­˜ï¼Œå°±å¿…é¡»å®¹å¿ã€Œä¸€è‡´æ€§ã€é—®é¢˜ï¼Œæˆ‘ä»¬åªèƒ½å°½å¯èƒ½åœ°å»é™ä½é—®é¢˜å‡ºç°çš„æ¦‚ç‡ã€‚</li></ul><blockquote><p>ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´</p></blockquote><p>ä¸€èˆ¬æ˜¯é‡‡ç”¨ï¼šCache Aside Patternï¼ˆæ—è·¯ç¼“å­˜æ¨¡å¼ï¼‰: é‡åˆ°å†™è¯·æ±‚çš„æ—¶å€™æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ cache</p><p>è¿™ç§æƒ…å†µä¸‹å‘ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µæ¯”è¾ƒå°ï¼Œ</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨æ•°æ®åº“æ›´æ–°å’Œç¼“å­˜åˆ é™¤ä¹‹é—´æœ‰è¯»å–è¯·æ±‚ï¼Œå®ƒä¹Ÿåªä¼šè¯»åˆ°æ—§çš„æ•°æ®ï¼Œä¸€æ—¦ç¼“å­˜è¢«åˆ é™¤ï¼Œä¸‹ä¸€ä¸ªè¯»å–è¯·æ±‚å°†ä»æ•°æ®åº“ä¸­è·å–æœ€æ–°çš„æ•°æ®ï¼Œå¹¶æ›´æ–°ç¼“å­˜ï¼Œä»è€Œä¿æŒäº†ä¸€è‡´æ€§ã€‚</p><p>éœ€è¦é¿å…ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´éœ€è¦è€ƒè™‘çš„ç‚¹ï¼šé¿å…ç¬¬äºŒæ­¥æ“ä½œã€åˆ é™¤ cacheã€‘å¤±è´¥</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ç¼“å­˜å¤±æ•ˆæ—¶é—´å˜çŸ­ï¼ˆä¸æ¨èï¼Œæ²»æ ‡ä¸æ²»æœ¬ï¼‰<ol><li>æˆ‘ä»¬è®©ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´å˜çŸ­ï¼Œè¿™æ ·çš„è¯ç¼“å­˜å°±ä¼šä»æ•°æ®åº“ä¸­åŠ è½½æ•°æ®ã€‚</li></ol></li><li>å¢åŠ  cache æ›´æ–°é‡è¯•æœºåˆ¶ï¼ˆå¸¸ç”¨ï¼‰<ol><li>å¦‚æœ cache æœåŠ¡å½“å‰ä¸å¯ç”¨å¯¼è‡´ç¼“å­˜åˆ é™¤å¤±è´¥çš„è¯ï¼Œæˆ‘ä»¬å°±éš”ä¸€æ®µæ—¶é—´è¿›è¡Œé‡è¯•ï¼Œ</li><li>é‡è¯•æ¬¡æ•°å¯ä»¥è‡ªå·±å®šã€‚å¦‚æœå¤šæ¬¡é‡è¯•è¿˜æ˜¯å¤±è´¥çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå½“å‰æ›´æ–°å¤±è´¥çš„ key å­˜å…¥é˜Ÿåˆ—ä¸­ï¼Œç­‰ç¼“å­˜æœåŠ¡å¯ç”¨ä¹‹åï¼Œå†å°†ç¼“å­˜ä¸­å¯¹åº”çš„ key åˆ é™¤å³å¯ã€‚</li></ol></li></ol><blockquote><p>ç¬¬äºŒç§æ–¹å¼é‡‡ç”¨æ–¹æ¡ˆï¼š</p></blockquote><ol><li>å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—æ¥è¿›è¡Œå¼‚æ­¥é‡è¯•æ“ä½œï¼ˆå°†åˆ é™¤ cache æ“ä½œæ”¾åœ¨æ¶ˆè´¹è€…è¿™æ­¥æ“ä½œï¼‰ </li><li>è®¢é˜…æ•°æ®åº“å˜æ›´æ—¥å¿—ï¼Œå†æ“ä½œç¼“å­˜</li></ol><hr><p>å½“ç¼“å­˜æ“ä½œå¤±è´¥æ—¶ï¼Œé€šè¿‡è®¾ç½®é‡è¯•æœºåˆ¶æ¥ç¡®ä¿ç¼“å­˜æœ€ç»ˆèƒ½å¤Ÿä¸æ•°æ®åº“æ•°æ®ä¿æŒä¸€è‡´ã€‚å…·ä½“æ­¥éª¤åŒ…æ‹¬ï¼š</p><p>A. <strong>ç›´æ¥é‡è¯•</strong></p><p>åœ¨ç¼“å­˜æ“ä½œï¼ˆå¦‚åˆ é™¤ã€æ›´æ–°ï¼‰å¤±è´¥æ—¶ï¼Œç«‹å³è¿›è¡Œé‡è¯•ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé¿å…æ— é™é‡è¯•ã€‚</p><p>B. <strong>å»¶æ—¶é‡è¯•</strong></p><p>å¦‚æœç›´æ¥é‡è¯•ä»ç„¶å¤±è´¥ï¼Œå¯ä»¥å°†å¤±è´¥çš„æ“ä½œå»¶æ—¶ä¸€æ®µæ—¶é—´åå†é‡è¯•ï¼Œå»¶æ—¶é‡è¯•å¯ä»¥é€šè¿‡å®šæ—¶ä»»åŠ¡æˆ–å»¶æ—¶é˜Ÿåˆ—å®ç°ã€‚</p><p>C. <strong>å¤±è´¥é˜Ÿåˆ—</strong></p><p>å¦‚æœé‡è¯•å¤šæ¬¡åä»ç„¶å¤±è´¥ï¼Œå°†æ›´æ–°å¤±è´¥çš„keyå­˜å…¥ä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—ä¸­ã€‚ç­‰åˆ°ç¼“å­˜æœåŠ¡æ¢å¤æ­£å¸¸åï¼Œå†ç»Ÿä¸€å¤„ç†è¿™äº›å¤±è´¥çš„æ“ä½œã€‚</p><blockquote><p>å…·ä½“å®æ–½æ–¹æ¡ˆ</p></blockquote><p>å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¼‚æ­¥é‡è¯•ï¼‰</p><ul><li><strong>æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯å¯é æ€§</strong>ï¼šå†™åˆ°é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼ŒæˆåŠŸæ¶ˆè´¹ä¹‹å‰ä¸ä¼šä¸¢å¤±ï¼ˆé‡å¯é¡¹ç›®ä¹Ÿä¸æ‹…å¿ƒï¼‰</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯æ¶ˆæ¯æˆåŠŸæŠ•é€’</strong>ï¼šä¸‹æ¸¸ä»é˜Ÿåˆ—æ‹‰å–æ¶ˆæ¯ï¼ŒæˆåŠŸæ¶ˆè´¹åæ‰ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œå¦åˆ™è¿˜ä¼šç»§ç»­æŠ•é€’æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼ˆç¬¦åˆæˆ‘ä»¬é‡è¯•çš„åœºæ™¯ï¼‰</li></ul><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºå¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œ<strong>å°†éœ€è¦æ›´æ–°æˆ–åˆ é™¤çš„ç¼“å­˜æ“ä½œ</strong>ä½œä¸ºæ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œç”±æ¶ˆè´¹è€…è´Ÿè´£æ‰§è¡Œå®é™…çš„ç¼“å­˜æ›´æ–°ä»»åŠ¡ã€‚è¿™æ ·å³ä½¿ç¼“å­˜æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œä¹Ÿä¸ä¼šå½±å“ä¸»ä¸šåŠ¡æµç¨‹ï¼Œå¾…ç¼“å­˜æœåŠ¡æ¢å¤åå†é€šè¿‡æ¶ˆè´¹æ¶ˆæ¯æ¥åŒæ­¥ç¼“å­˜ã€‚</p><p>è®¢é˜…æ•°æ®åº“å˜æ›´æ—¥å¿—</p><p>å¦ä¸€ä¸ªé«˜çº§çš„æ–¹æ¡ˆæ˜¯ç›´æ¥è®¢é˜…æ•°æ®åº“çš„å˜æ›´æ—¥å¿—ï¼ˆå¦‚æœæ•°æ®åº“æ”¯æŒï¼‰ï¼Œå¦‚MySQLçš„binlogã€‚é€šè¿‡è§£æå˜æ›´æ—¥å¿—ï¼Œå¯¹ç›¸å…³ç¼“å­˜è¿›è¡Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œã€‚è¿™ç§æ–¹æ³•å¯ä»¥ç¡®ä¿ç¼“å­˜æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä½†å®ç°å¤æ‚ï¼Œå¯¹æ•°æ®åº“å’Œç¼“å­˜ç³»ç»Ÿçš„è¦æ±‚è¾ƒé«˜ã€‚</p><hr><h4 id="å“ªäº›æƒ…å†µå¯èƒ½å¯¼è‡´-Redis-é˜»å¡"><a href="#å“ªäº›æƒ…å†µå¯èƒ½å¯¼è‡´-Redis-é˜»å¡" class="headerlink" title="å“ªäº›æƒ…å†µå¯èƒ½å¯¼è‡´ Redis é˜»å¡"></a>å“ªäº›æƒ…å†µå¯èƒ½å¯¼è‡´ Redis é˜»å¡</h4><h3 id="10ã€Redis-é›†ç¾¤-ğŸš©ğŸ’£"><a href="#10ã€Redis-é›†ç¾¤-ğŸš©ğŸ’£" class="headerlink" title="10ã€Redis é›†ç¾¤  ğŸš©ğŸ’£"></a>10ã€Redis é›†ç¾¤  ğŸš©ğŸ’£</h3><p>çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡å­—ï¼š <a href="https://www.yuque.com/snailclimb/mf2z3k/ks9olb19hc9wse5k">https://www.yuque.com/snailclimb/mf2z3k/ks9olb19hc9wse5k</a></p><p>é‡Œé¢è®²è¿°äº†ä» ä¸»ä»èŠ‚ç‚¹å¤åˆ¶ â†’  å“¨å…µæœºåˆ¶ Sentinel  â†’ Redis é›†ç¾¤Cluster ï¼ˆè‡ªåŠ¨é…ç½®äº†å“¨å…µæ¨¡å¼ï¼Œä¸”å»ºè®®è‡³å°‘ä¸€ä¸»ä¸€ä»èŠ‚ç‚¹ï¼Œä¸‰ä¸ªä¸»èŠ‚ç‚¹ä»¥ä¸Šçš„å•æ•°èŠ‚ç‚¹é›†ç¾¤æ¨¡å¼ï¼‰</p><h4 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h4><p>ç®€å•æ¥è¯´ï¼Œä¸»ä»å¤åˆ¶å°±æ˜¯å°†ä¸€å°Redisä¸»èŠ‚ç‚¹çš„æ•°æ®å¤åˆ¶åˆ°å…¶ä»–çš„Redisä»èŠ‚ç‚¹ä¸­ï¼Œå°½æœ€å¤§å¯èƒ½ä¿è¯Redisä¸»èŠ‚<br>ç‚¹å’Œä»èŠ‚ç‚¹çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚</p><ul><li>ä¸€ä¸ªRedisæœåŠ¡å™¨å……å½“ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ï¼Œè€Œä¸€ä¸ªæˆ–å¤šä¸ªRedisæœåŠ¡å™¨å……å½“ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰</li><li>ä»èŠ‚ç‚¹çš„æ•°æ®ä¼šè‡ªåŠ¨ä¸ä¸»èŠ‚ç‚¹ä¿æŒåŒæ­¥ï¼Œè¿™æ ·å°±èƒ½åœ¨å¤šä¸ªèŠ‚ç‚¹é—´åˆ†æ‹…è¯»è¯·æ±‚çš„å‹åŠ›ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†æ•°æ®çš„å†—ä½™å¤‡ä»½ã€‚</li></ul><p>ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºçŸ³ï¼ŒRedis Sentinelä»¥åŠRedis Clusteréƒ½ä¾èµ–äºä¸»ä»å¤åˆ¶ã€‚</p><p>ä¸»ä»å¤åˆ¶è¿™ç§æ–¹æ¡ˆä¸ä»…ä¿éšœäº†Redis æœåŠ¡çš„é«˜å¯ç”¨ï¼Œè¿˜å®ç°äº†è¯»å†™åˆ†ç¦»ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¹¶å‘é‡ï¼Œå°¤å…¶æ˜¯è¯»å¹¶å‘<br>é‡ã€‚</p><blockquote><p>ä¸»ä»å¤åˆ¶ä¸‹ä»èŠ‚ç‚¹ä¼šä¸»åŠ¨åˆ é™¤è¿‡æœŸæ•°æ®å—ï¼Ÿ</p></blockquote><p>æˆ‘ä»¬çŸ¥é“ï¼ŒRdå¼•sä¸­å¸¸ç”¨çš„è¿‡æœŸæ•°æ®çš„åˆ é™¤ç­–èƒ³æœ‰ä¸¤ä¸ª</p><ul><li>æƒ°æ€§åˆ é™¤ï¼šåªä¼šåœ¨å–å‡ºkeyçš„æ—¶å€™æ‰å¯¹æ•°æ®è¿›è¡Œè¿‡æœŸæ£€æŸ¥ã€‚è¿™æ ·å¯¹CPUæœ€å‹å¥½ï¼Œä½†æ˜¯å¯èƒ½ä¼šé€ æˆå¤ªå¤šè¿‡æœŸkeyæ²¡æœ‰è¢«åˆ é™¤ã€‚</li><li>å®šæœŸåˆ é™¤ï¼šæ¯éš”ä¸€æ®µæ—¶é—´æŠ½å–ä¸€æ‰¹keyæ‰§è¡Œåˆ é™¤è¿‡æœŸ key æ“ä½œã€‚å¹¶ä¸”ï¼ŒRedisåº•å±‚ä¼šé€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹CPUæ—¶é—´çš„å½±å“ã€‚</li></ul><p>å®šæœŸåˆ é™¤å¯¹å†…å­˜æ›´åŠ å‹å¥½ï¼Œæƒ°æ€§åˆ é™¤å¯¹CPUæ›´åŠ å‹å¥½ã€‚ä¸¤è€…å„æœ‰åƒç§‹ï¼Œæ‰€ä»¥Rdisé‡‡ç”¨çš„æ˜¯å®šæœŸåˆ é™¤+æƒ°æ€§&#x2F;æ‡’æ±‰å¼åˆ é™¤ã€‚</p><hr><p>Rediså®ç°å®šæœŸåˆ é™¤å’Œæƒ°æ€§åˆ é™¤çš„æœºåˆ¶ï¼š</p><p>å®šæœŸåˆ é™¤ï¼ˆPeriodic Deletionï¼‰</p><ol><li><strong>å‘¨æœŸæ€§æ“ä½œ</strong>ï¼šRedisæœåŠ¡å™¨ä¼šå‘¨æœŸæ€§åœ°æ‰§è¡Œå®šæœŸåˆ é™¤æ“ä½œã€‚å…·ä½“åœ°ï¼Œå®ƒé»˜è®¤æ¯100mséšæœºæŠ½æŸ¥ä¸€äº›é”®ï¼Œå¹¶æ£€æŸ¥è¿™äº›é”®æ˜¯å¦è®¾ç½®äº†è¿‡æœŸæ—¶é—´ã€‚</li><li><strong>éšæœºæŠ½æ ·æ£€æŸ¥</strong>ï¼šåœ¨æ¯æ¬¡å®šæœŸåˆ é™¤æ“ä½œä¸­ï¼ŒRediså¹¶ä¸æ˜¯æ£€æŸ¥æ‰€æœ‰é”®ï¼Œè€Œæ˜¯ä»å½“å‰æ•°æ®åº“çš„é”®ç©ºé—´ä¸­éšæœºæŠ½å–ä¸€å®šæ•°é‡çš„é”®è¿›è¡Œæ£€æŸ¥ã€‚è¿™ä¸ªæ•°é‡å¯ä»¥é€šè¿‡é…ç½®<code>hz</code>å‚æ•°å’Œ<code>active-expire-effort</code>å‚æ•°æ¥è°ƒæ•´ã€‚</li><li><strong>åˆ é™¤è¿‡æœŸé”®</strong>ï¼šå¯¹äºæ¯ä¸ªè¢«æŠ½æŸ¥çš„é”®ï¼ŒRedisä¼šæ£€æŸ¥å…¶æ˜¯å¦å·²ç»è¿‡æœŸã€‚å¦‚æœå·²ç»è¿‡æœŸï¼Œåˆ™å°†å…¶ä»æ•°æ®åº“ä¸­åˆ é™¤ã€‚</li></ol><p>è¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘å› è¿‡æœŸé”®ç§¯ç´¯å¯¼è‡´çš„å†…å­˜æµªè´¹ï¼Œä½†ç”±äºå®ƒæ˜¯åŸºäºéšæœºæŠ½æ ·çš„ï¼Œä¸èƒ½ä¿è¯æ‰€æœ‰è¿‡æœŸé”®éƒ½ä¼šè¢«åŠæ—¶åˆ é™¤ã€‚</p><p>æƒ°æ€§åˆ é™¤ï¼ˆLazy Deletionï¼‰</p><ol><li><strong>è®¿é—®æ—¶æ£€æŸ¥</strong>ï¼šå½“å®¢æˆ·ç«¯å°è¯•è®¿é—®ä»»ä½•é”®æ—¶ï¼ŒRedisé¦–å…ˆä¼šæ£€æŸ¥è¯¥é”®æ˜¯å¦è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå¹¶åˆ¤æ–­è¯¥é”®æ˜¯å¦å·²ç»è¿‡æœŸã€‚</li><li><strong>å³æ—¶åˆ é™¤</strong>ï¼šå¦‚æœè¯¥é”®å·²ç»è¿‡æœŸï¼ŒRedisä¼šç«‹å³å°†å…¶åˆ é™¤ï¼Œç„¶åè¿”å›ä¸€ä¸ªé”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œå½“å°è¯•è·å–ä¸€ä¸ªå·²ç»è¿‡æœŸçš„é”®æ—¶ï¼Œä¼šè¿”å›<code>(nil)</code>è¡¨ç¤ºé”®ä¸å­˜åœ¨ï¼‰ã€‚</li><li><strong>æ— é¢å¤–å¼€é”€</strong>ï¼šå¯¹äºé‚£äº›ä»æœªè¢«è®¿é—®çš„è¿‡æœŸé”®ï¼Œå®ƒä»¬å°†ä¸ä¼šå ç”¨é¢å¤–çš„CPUèµ„æºè¿›è¡Œæ£€æŸ¥ã€‚è¿™æ„å‘³ç€æƒ°æ€§åˆ é™¤å‡ ä¹æ²¡æœ‰é¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚</li></ol><hr><blockquote><p>ä¸»ä»å¤åˆ¶æ–¹å¼ä¸‹çš„ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®åŒæ­¥æ–¹æ¡ˆ</p></blockquote><p>æœ‰ä¸‰ç§åŒæ­¥æ–¹æ¡ˆ</p><ul><li>Redis 2.8 ä¹‹å‰çš„ SYNC  æ–¹æ¡ˆ</li><li>Redis 2.8  PSYNC  æ–¹æ¡ˆ</li><li>Redis 4.0  PSYNC 2.0 æ–¹æ¡ˆ</li></ul><blockquote><p>å·¥ä½œåŸç†ï¼š</p></blockquote><p>to be continedâ€¦.</p><ol><li><strong>åŒæ­¥è¿‡ç¨‹</strong>ï¼šå½“ä»èŠ‚ç‚¹å¯åŠ¨å¹¶è¿æ¥åˆ°ä¸»èŠ‚ç‚¹æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ª<code>SYNC</code>å‘½ä»¤ç»™ä¸»èŠ‚ç‚¹ã€‚ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œä¼šå¼€å§‹åœ¨åå°ä¿å­˜å¿«ç…§ï¼ˆæ‰§è¡Œ<code>bgsave</code>ï¼‰ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„å†™å‘½ä»¤ã€‚å¿«ç…§å®Œæˆåï¼Œä¸»èŠ‚ç‚¹å°†å¿«ç…§æ–‡ä»¶å’Œè¿™æœŸé—´æ”¶é›†çš„æ‰€æœ‰å†™å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ã€‚ä»èŠ‚ç‚¹é¦–å…ˆåŠ è½½å¿«ç…§æ–‡ä»¶æ¥æ„å»ºæ•°æ®é›†ï¼Œç„¶åæ‰§è¡Œå†™å‘½ä»¤æ¥ä¸ä¸»èŠ‚ç‚¹çš„æ•°æ®çŠ¶æ€ä¿æŒä¸€è‡´ã€‚</li><li><strong>å‘½ä»¤ä¼ æ’­</strong>ï¼šä¸€æ—¦åˆå§‹åŒæ­¥å®Œæˆï¼Œä¸»èŠ‚ç‚¹ä¼šæŒç»­å°†æ‰€æœ‰æ¥æ”¶åˆ°çš„å†™å‘½ä»¤å®æ—¶å‘é€ç»™ä»èŠ‚ç‚¹ã€‚è¿™ä¿è¯äº†ä¸»ä»èŠ‚ç‚¹é—´æ•°æ®çš„å®æ—¶ä¸€è‡´æ€§ã€‚</li><li><strong>æ–­çº¿é‡è¿</strong>ï¼šå¦‚æœä»èŠ‚ç‚¹ä¸ä¸»èŠ‚ç‚¹é—´çš„è¿æ¥æ–­å¼€ï¼Œå½“é‡æ–°è¿æ¥åï¼Œä»èŠ‚ç‚¹ä¼šå°è¯•è‡ªåŠ¨é‡æ–°åŒæ­¥æ•°æ®ã€‚Redis 2.8ç‰ˆæœ¬åï¼Œæ”¯æŒéƒ¨åˆ†é‡åŒæ­¥ï¼ˆPSYNCï¼‰ï¼Œè¿™æ„å‘³ç€åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä»èŠ‚ç‚¹åªéœ€è¦åŒæ­¥æ–­å¼€æœŸé—´çš„æ•°æ®å˜æ›´ï¼Œè€Œä¸éœ€è¦é‡æ–°åŒæ­¥æ‰€æœ‰æ•°æ®ã€‚</li></ol><h4 id="å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰"><a href="#å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰" class="headerlink" title="å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰"></a>å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰</h4><h4 id="é›†ç¾¤ï¼ˆClusterï¼‰"><a href="#é›†ç¾¤ï¼ˆClusterï¼‰" class="headerlink" title="é›†ç¾¤ï¼ˆClusterï¼‰"></a>é›†ç¾¤ï¼ˆClusterï¼‰</h4><h3 id="11ã€Reids-ä½¿ç”¨è§„èŒƒ"><a href="#11ã€Reids-ä½¿ç”¨è§„èŒƒ" class="headerlink" title="11ã€Reids ä½¿ç”¨è§„èŒƒ"></a>11ã€Reids ä½¿ç”¨è§„èŒƒ</h3><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/database/redis/cache-basics.html">https://javaguide.cn/database/redis/cache-basics.html</a></li><li><a href="https://www.pdai.tech/md/interview/x-interview.html#_8-3-redis">https://www.pdai.tech/md/interview/x-interview.html#_8-3-redis</a></li><li><a href="https://www.cnblogs.com/powertoolsteam/p/redis.html">https://www.cnblogs.com/powertoolsteam/p/redis.html</a></li><li><a href="https://javaguide.cn/database/redis/redis-questions-02.html">https://javaguide.cn/database/redis/redis-questions-02.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NoSQL</tag>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¹¶å‘ç¼–ç¨‹_è¿›é˜¶å†…å®¹</title>
    <link href="/2023/12/08/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E8%BF%9B%E9%98%B6%E5%86%85%E5%AE%B9%EF%BC%88%E9%94%81%E6%9C%BA%E5%88%B6%EF%BC%89/"/>
    <url>/2023/12/08/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E8%BF%9B%E9%98%B6%E5%86%85%E5%AE%B9%EF%BC%88%E9%94%81%E6%9C%BA%E5%88%B6%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¤§çº²</p></blockquote><ul><li>çº¿ç¨‹æ¨¡å‹</li><li>æ‚²è§‚é”</li><li>ä¹è§‚é”</li><li>ReentrantLock<ul><li>AQS</li><li>CAS</li></ul></li></ul><p><strong>æ‚²è§‚é”å’Œä¹è§‚é”</strong></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401191517637.png" alt="image.png"></p><h3 id="1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ¨¡å‹ï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ¨¡å‹ï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ¨¡å‹ï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯çº¿ç¨‹æ¨¡å‹ï¼Ÿ</h3><blockquote><p>å…ˆå›é¡¾ä¸€ä¸‹çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ†</p></blockquote><ul><li>è¿›ç¨‹ï¼š<ul><li>ä¸€ä¸ªåœ¨å†…å­˜ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸€å—å†…å­˜ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œæ¯”å¦‚åœ¨Windowsç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªè¿è¡Œçš„xx.exeå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚</li></ul></li><li>çº¿ç¨‹<ul><li>è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œä»»åŠ¡ï¼ˆæ§åˆ¶å•å…ƒï¼‰ï¼Œè´Ÿè´£å½“å‰è¿›ç¨‹ä¸­ç¨‹åºçš„æ‰§è¡Œã€‚ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯å…±äº«æ•°æ®ã€‚</li><li>ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„<strong>å †</strong>å’Œ<strong>æ–¹æ³•åŒº</strong>èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„<strong>ç¨‹åºè®¡æ•°å™¨</strong>ã€<strong>è™šæ‹Ÿæœºæ ˆ</strong>å’Œ<strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´ä½œåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</li></ul></li></ul><p><strong>æ ¹æœ¬åŒºåˆ«</strong>ï¼šè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹æ˜¯å¤„ç†å™¨ä»»åŠ¡è°ƒåº¦å’Œæ‰§è¡Œçš„åŸºæœ¬å•ä½</p><blockquote><p>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ¨¡å‹</p></blockquote><p>å¹¶å‘ç¼–ç¨‹åœ¨è®¡ç®—æœºä¸­å¦‚ä½•å®ç°çš„ï¼Œåœ¨ Java å¼€å‘é¢†åŸŸä¸­ï¼ŒJVMçº¿ç¨‹å¯¹ä¸åŒæ“ä½œç³»ç»Ÿä¸Šçš„åŸç”Ÿçº¿ç¨‹è¿›è¡Œäº†é«˜çº§æŠ½è±¡ï¼Œä½¿å¼€å‘è€…å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ä¸ç”¨å…³æ³¨ä¸‹å±‚ç»†èŠ‚ï¼Œè€Œåªè¦ä¸“æ³¨ä¸Šå±‚å¼€å‘ã€‚</p><p>JVMçº¿ç¨‹ä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¹‹é—´å­˜åœ¨ç€æŸç§æ˜ å°„å…³ç³»ï¼Œè¿™ä¸¤ç§<strong>ä¸åŒç»´åº¦çš„çº¿ç¨‹ä¹‹é—´çš„è§„èŒƒå’Œåè®®</strong>ï¼Œå°±æ˜¯çº¿ç¨‹æ¨¡å‹ã€‚</p><blockquote><p>ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹</p></blockquote><ul><li>ç”¨æˆ·çº¿ç¨‹ï¼šç”±ç”¨æˆ·ç©ºé—´ç¨‹åºç®¡ç†å’Œè°ƒåº¦çš„çº¿ç¨‹ï¼Œè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ï¼ˆä¸“é—¨ç»™åº”ç”¨ç¨‹åºä½¿ç”¨ï¼‰ã€‚</li><li>å†…æ ¸çº¿ç¨‹ï¼šç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†å’Œè°ƒåº¦çš„çº¿ç¨‹ï¼Œè¿è¡Œåœ¨å†…æ ¸ç©ºé—´ï¼ˆåªæœ‰å†…æ ¸ç¨‹åºå¯ä»¥è®¿é—®ï¼‰ã€‚</li></ul><blockquote><p>çº¿ç¨‹æ¨¡å‹ç±»å‹</p></blockquote><p>JVMçº¿ç¨‹æ¨¡å‹æœ‰ä¸‰ç§æ¨¡å‹ï¼šä¸€å¯¹ä¸€ã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤šã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311161619698.png" alt="image.png"></p><p><strong>ä¸€å¯¹ä¸€</strong></p><p>åœ¨Jvaçº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹ï¼‰ä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹(KLT)ä¹‹é—´å»ºç«‹ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œç®€å•ç²—æš´ï¼Œä½†å¥½ç”¨ã€‚</p><ul><li>ä¼˜ç‚¹ï¼š<ul><li>æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ç‹¬ç«‹çš„è°ƒåº¦å•å…ƒï¼Œç›´æ¥åˆ©ç”¨æ“ä½œç³»ç»Ÿå†…æ ¸æä¾›çš„è°ƒåº¦åŠŸèƒ½ã€‚</li></ul></li><li>ç¼ºç‚¹ï¼š<ul><li>ç”¨æˆ·çº¿ç¨‹çš„é˜»å¡å”¤é†’ï¼Œä¼šç›´æ¥æ˜ å°„åˆ°å†…æ ¸çº¿ç¨‹ä¸Šï¼Œå®¹æ˜“<strong>å¼•èµ·é¢‘ç¹åˆ‡æ¢ï¼Œé™ä½æ€§</strong>èƒ½ã€‚ä½†æ˜¯ä¸€äº›è¯­è¨€å¼•å…¥äº†CASæ¥é¿å…ä¸€éƒ¨åˆ†çš„å†…æ ¸è°ƒç”¨ï¼Œæ¯”å¦‚Java å¼•å…¥äº†AQSè¿™ç§å‡½æ•°çº§åˆ«çš„é”ï¼Œ<strong>å‡å°‘ä½¿ç”¨å†…æ ¸çº§åˆ«çš„é”</strong>ï¼Œå°±èƒ½æå‡æ€§èƒ½ã€‚</li></ul></li></ul><p>ç›®å‰å¤§éƒ¨åˆ†ä¸»æµ JVM ä¸Šéƒ½æ˜¯é‡‡ç”¨çš„è¿™ç§çº¿ç¨‹æ¨¡å‹ã€‚</p><p><strong>å¤šå¯¹ä¸€æ¨¡å‹</strong></p><ul><li>ä¼˜ç‚¹<ul><li>ç”¨æˆ·çº¿ç¨‹çš„å¾ˆå¤šæ“ä½œå¯¹å†…æ ¸æ¥è¯´éƒ½æ˜¯é€æ˜çš„ï¼Œä¸éœ€è¦ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„é¢‘ç¹åˆ‡æ¢ï¼Œä½¿çº¿ç¨‹çš„åˆ›å»ºã€è°ƒåº¦ã€åŒæ­¥ç­‰éå¸¸å¿«ï¼š</li></ul></li><li>ç¼ºç‚¹<ul><li>å¦‚æœå…¶ä¸­ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹é˜»å¡ï¼Œå…¶ä»–ç”¨æˆ·çº¿ç¨‹ä¹Ÿæ— æ³•æ‰§è¡Œ</li><li>è¿™ç§æ¨¡å‹ä¸‹ï¼Œå†…æ ¸å¹¶ä¸çŸ¥é“ç”¨æˆ·æ€æœ‰å“ªäº›çº¿ç¨‹ï¼Œè°ƒåº¦å’Œä¼˜å…ˆçº§ç­‰ä¸å®Œæ•´ã€‚</li></ul></li></ul><p><strong>å¤šå¯¹å¤šæ¨¡å‹</strong></p><ul><li>ä¼˜ç‚¹ï¼šå…¼å…·å‰ä¸¤è€…çš„ä¼˜ç‚¹</li><li>ç¼ºç‚¹ï¼šå®ç°å¤æ‚</li></ul><p>ç›®å‰ä¸»æµè¯­è¨€ä¸­ï¼ŒJava ä½¿ç”¨çš„æ˜¯ ä¸€å¯¹ä¸€çº¿ç¨‹æ¨¡å‹ï¼›Go è¯­è¨€ä½¿ç”¨çš„æ˜¯ å¤šå¯¹å¤šçº¿ç¨‹æ¨¡å‹ï¼›Python çš„ gevent ä½¿ç”¨çš„å¤šå¯¹ä¸€çº¿ç¨‹æ¨¡å‹ã€‚</p><h3 id="2ã€æ‚²è§‚é”æœºåˆ¶"><a href="#2ã€æ‚²è§‚é”æœºåˆ¶" class="headerlink" title="2ã€æ‚²è§‚é”æœºåˆ¶"></a>2ã€æ‚²è§‚é”æœºåˆ¶</h3><p>åœ¨äº†è§£æ‚²è§‚é”æœºåˆ¶å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯é”ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯é”"><a href="#ä»€ä¹ˆæ˜¯é”" class="headerlink" title="ä»€ä¹ˆæ˜¯é”"></a>ä»€ä¹ˆæ˜¯é”</h4><p>åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œä¼šå‡ºç°å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªèµ„æºè¿›è¡Œäº‰æŠ¢çš„æƒ…å†µï¼Œå‡è®¾Açº¿ç¨‹å¯¹èµ„æºæ­£åœ¨è¿›è¡Œä¿®æ”¹ï¼Œæ­¤æ—¶<br>Bçº¿ç¨‹æ­¤æ—¶åˆå¯¹èµ„æºè¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™å°±å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†é”æœºåˆ¶ï¼Œ<strong>é€šè¿‡ä¸€ç§æŠ½è±¡çš„â€œé”â€æ¥å¯¹èµ„æºè¿›è¡Œé”å®š</strong>ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æŒæœ‰â€œé”â€çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…â€œé”â€ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨ä¸´ç•Œèµ„æºä¸Šå¯¹çº¿ç¨‹è¿›è¡Œä¸€ç§ä¸²è¡ŒåŒ–ã€‚</p><h4 id="Javaè¯­è¨€çš„é”æœºåˆ¶"><a href="#Javaè¯­è¨€çš„é”æœºåˆ¶" class="headerlink" title="Javaè¯­è¨€çš„é”æœºåˆ¶"></a>Javaè¯­è¨€çš„é”æœºåˆ¶</h4><blockquote><p>Java è™šæ‹Ÿæœºçš„å†…å­˜ç»“æ„</p></blockquote><p>åœ¨äº†è§£ Javaè¯­è¨€é”æœºåˆ¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¯¹ç®€å•äº†è§£ä¸€ä¸‹ Java è™šæ‹Ÿæœºçš„å†…å­˜ç»“æ„ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231116222015.png" alt="image.png"></p><p>JVM è¿è¡Œæ—¶å†…å­˜ç»“æ„ä¸»è¦åŒ…å«äº†äº”ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>ç¨‹åºè®¡æ•°å™¨(PCå¯„å­˜å™¨)ã€</li><li>JVMæ ˆã€</li><li>Nativeæ–¹æ³•æ ˆã€</li><li>å †ã€</li><li>æ–¹æ³•åŒºã€‚</li></ul><p>ä¸Šå›¾ä¸­ï¼Œçº¢è‰²åŒºåŸŸæ˜¯å„ä¸ªçº¿ç¨‹ç§æœ‰çš„ã€‚è¿™ä¸ªåŒºåŸŸä¸­çš„æ•°æ®ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹ç«äº‰çš„å…³ç³»ã€‚</p><p>è€Œè“è‰²åŒºåŸŸä¸­çš„æ•°æ®è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå…¶ä¸­Jvaå †ä¸­å­˜æ”¾çš„æ˜¯å¤§é‡å¯¹è±¡ï¼Œæ–¹æ³•åŒºä¸­<strong>å­˜æ”¾ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜<br>é‡</strong>ç­‰æ•°æ®ã€‚</p><p>å½“å¤šä¸ªçº¿ç¨‹åœ¨ç«äº‰å…¶ä¸­çš„ä¸€äº›æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿéš¾ä»¥é¢„æ–™çš„å¼‚å¸¸æƒ…å†µã€‚åœ¨ç¨‹åºå¼€å‘ä¸­ï¼Œé”çš„ä¸»è¦åº”ç”¨èŒƒå›´å°±æ˜¯åœ¨æ•°æ®å…±äº«åŒºåŸŸã€‚</p><p>åœ¨ä»£ç å±‚é¢ï¼ŒJvva ä¸»è¦é‡‡ç”¨äº†ä¸¤ç§å®ç°æ–¹å¼ï¼š</p><ul><li>1.åŸºäºObjectçš„æ‚²è§‚é”ã€‚</li><li>2.åŸºäºCASçš„ä¹è§‚é”ã€‚</li></ul><p>æœ¬ç« ä¸»è¦è®²è§£åŸºäºObjectçš„æ‚²è§‚é”ã€‚</p><blockquote><p>æ‚²è§‚é”æœºåˆ¶</p></blockquote><p>æ‚²è§‚é”æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œè®¤ä¸ºå…±äº«èµ„æº<strong>æ¯æ¬¡è¢«è®¿é—®çš„æ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜</strong>(æ¯”å¦‚å…±äº«æ•°æ®è¢«ä¿®æ”¹)ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨è·å–èµ„æºæ“ä½œçš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹æƒ³æ‹¿åˆ°è¿™ä¸ªèµ„æºå°±ä¼šé˜»å¡ç›´åˆ°é”è¢«ä¸Šä¸€ä¸ªæŒæœ‰è€…é‡Šæ”¾ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹</strong>ã€‚</p><blockquote><p>åŸºäºObjectçš„æ‚²è§‚é”</p></blockquote><p>åœ¨Javaä¸­ï¼Œæ¯ä¸ªObject,ä¹Ÿå°±æ˜¯æ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰ä¸€æŠŠé”ï¼Œè¿™æŠŠé”å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ï¼Œè®°å½•äº†å½“å‰å¯¹è±¡è¢«å“ªä¸ªçº¿ç¨‹å ç”¨ã€‚</p><blockquote><p>å¯¹è±¡å’Œå¯¹è±¡å¤´çš„ç»“æ„</p></blockquote><p><strong>Java å¯¹è±¡</strong></p><p>Javaå¯¹è±¡åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>å¯¹è±¡å¤´</li><li>å®ä¾‹æ•°æ®</li><li>å¯¹é½å¡«å……å­—èŠ‚</li></ul><p>å…¶ä¸­å¯¹é½å¡«å……å­—èŠ‚æ˜¯ä¸ºäº†æ»¡è¶³â€œJavaå¯¹è±¡å¤§å°æ˜¯8å­—èŠ‚çš„å€æ•°â€è¿™ä¸€æ¡ä»¶è€Œè®¾è®¡çš„ï¼Œä¸ºå¯¹è±¡å¯¹é½å¡«å……äº†ä¸€äº›æ— ç”¨å­—èŠ‚ã€‚</p><p>å®ä¾‹æ•°æ®æ˜¯åœ¨åˆå§‹åŒ–å¯¹è±¡æ—¶è®¾å®šçš„å±æ€§å’ŒçŠ¶æ€ç­‰å†…å®¹ã€‚</p><p><strong>å¯¹è±¡å¤´</strong></p><p>å¯¹è±¡å¤´å­˜æ”¾äº†ä¸€äº›å¯¹è±¡æœ¬èº«çš„è¿è¡Œæ—¶ä¿¡æ¯ã€‚å¯¹è±¡å¤´åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼š</p><ul><li>Mark Word</li><li>Class Pointer</li></ul><p>ç›¸è¾ƒäºå®ä¾‹æ•°æ®ï¼Œå¯¹è±¡å¤´å±äºä¸€äº›é¢å¤–çš„å­˜å‚¨å¼€é”€ï¼Œå®ƒè¢«è®¾è®¡å¾—æå°ï¼ˆä¸€èˆ¬ä¸º232btæˆ–264bt) æ¥æå‡æ•ˆç‡ã€‚</p><p>Class Pointeræ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å½“å‰å¯¹è±¡ç±»å‹æ‰€åœ¨æ–¹æ³•åŒºä¸­çš„Classä¿¡æ¯ï¼›</p><p>Mark Word å­˜å‚¨äº†<strong>å¾ˆå¤šå½“å‰å¯¹è±¡çš„è¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯</strong>ï¼Œæ¯”å¦‚ HashCode.ã€é”çŠ¶æ€æ ‡å¿—ã€æŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€åå‘çº¿ç¨‹ IDã€é”æ ‡å¿—ä½ç­‰ç­‰ã€‚</p><p>å¯ä»¥é€šè¿‡ä¸‹é¢è¿™å¼ è¡¨å¯¹ Mark Wordæœ‰ä¸€ä¸ªæ›´ç›´è§‚çš„è®¤è¯†ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231116223405.png" alt="image.png"></p><p>â€œé”â€çš„ä¿¡æ¯å­˜å‚¨åœ¨å¯¹è±¡å¤´çš„Mark Wordä¸­ã€‚Mark Word çš„æœ€åä¸¤ä½ï¼Œä»£è¡¨é”æ ‡å¿—ä½ï¼Œåˆ†åˆ«å¯¹åº”â€œæ— é”â€ã€â€œåå‘é”â€ã€â€œè½»é‡çº§é”â€ã€â€œé‡é‡çº§é”â€å››ç§çŠ¶æ€ã€‚</p><p>åœ¨Javaä¸­ï¼Œå¯ç”¨å¯¹è±¡é”çš„æ–¹å¼æ˜¯ä½¿ç”¨<code>synchronized</code>å…³é”®å­—ã€‚</p><h4 id="å¯¹è±¡é”çš„å››ç§çŠ¶æ€"><a href="#å¯¹è±¡é”çš„å››ç§çŠ¶æ€" class="headerlink" title="å¯¹è±¡é”çš„å››ç§çŠ¶æ€"></a>å¯¹è±¡é”çš„å››ç§çŠ¶æ€</h4><p>é”ä¸»è¦å­˜åœ¨å››ç§çŠ¶æ€ï¼Œä¾æ¬¡æ˜¯ï¼šæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€ï¼Œä»–ä»¬ä¼šéšç€ç«äº‰çš„æ¿€çƒˆè€Œé€æ¸å‡çº§ã€‚</p><p>é”å¯ä»¥å‡çº§ä¸å¯é™çº§ï¼Œè¿™ç§ç­–ç•¥æ˜¯ä¸ºäº†æé«˜è·å¾—é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡</p><h3 id="3ã€ä¹è§‚é”æœºåˆ¶"><a href="#3ã€ä¹è§‚é”æœºåˆ¶" class="headerlink" title="3ã€ä¹è§‚é”æœºåˆ¶"></a>3ã€ä¹è§‚é”æœºåˆ¶</h3><p>ä¹è§‚é”ï¼šä¹è§‚é”æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œå³ä¸ä¼šå»è€ƒè™‘åˆ«çš„çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­åœ¨æ­¤æœŸé—´åˆ«çš„çº¿ç¨‹æœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ã€‚</p><p>Java ä¸­çš„ä¹è§‚é”ä¸€èˆ¬æ˜¯<strong>åŸºäº CAS åŸè¯­ æ¥</strong>è¿›è¡Œçš„ï¼ˆå¦‚<code>AtomicInteger</code>ï¼‰ï¼›è€ŒCAS æ˜¯ä¸€ç§åŸè¯­æ“ä½œï¼Œä»–ä¹Ÿç”¨äºäº†æ‚²è§‚é”ä¸­  ReentrantLock çš„é”çŠ¶æ€ç®¡ç†ã€‚</p><hr><p>åœ¨å¤šä¸ªçº¿ç¨‹å¯¹äºåŒä¸€ä¸ªèµ„æºè¿›è¡Œè®¿é—®çš„è®¿é—®ï¼Œäº’æ–¥é”çš„æ–¹å¼æ˜¯æ‚²è§‚çš„ï¼Œåœ¨çº¿ç¨‹è®¿é—®çš„æ—¶å€™ï¼Œäº’æ–¥é”ä¼šé”å®šèµ„æºï¼Œ<strong>åªä¾›ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ï¼Œè€Œé˜»å¡å…¶ä»–çº¿ç¨‹</strong>ï¼Œè®©å…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚</p><p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒåŒæ­¥ä»£ç å—æ‰§è¡Œçš„è€—æ—¶è¿œè¿œå°äºçº¿ç¨‹åˆ‡æ¢çš„è€—æ—¶ï¼Œè¿™ç§æƒ…å†µä¸‹ä½¿ç”¨äº’æ–¥é”å¯¹æ€§èƒ½æ˜¯ä¸å¤ªåˆ’ç®—çš„ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œç›´æ¥åœ¨ç”¨æˆ·æ€å¯¹çº¿ç¨‹çš„åˆ‡æ¢è¿›è¡Œç®¡ç†ï¼Œæ•ˆç‡æ›´é«˜ã€‚å®é™…æ“ä½œçš„æ—¶å€™æ˜¯é€šè¿‡æ¯æ¬¡ä½¿ç”¨åŒæ­¥åŸè¯­å¯¹å…±äº«èµ„æºè¿›è¡Œé”å®šï¼Œè®©çº¿ç¨‹åå¤â€œä¹è§‚â€åœ°å»å°è¯•è·å–å…±äº«èµ„æºï¼Œå¦‚æœå‘ç°ç©ºé—²ï¼Œé‚£ä¹ˆä½¿ç”¨ï¼Œå¦‚æœè¢«å ç”¨ï¼Œé‚£ä¹ˆç»§ç»­â€œä¹è§‚â€åœ°é‡è¯•ã€‚</p><blockquote><p>ä¹è§‚é”å’Œæ‚²è§‚é”<br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231207231904.png" alt="image.png"></p></blockquote><blockquote><p>CAS</p></blockquote><p>åœ¨ Java ä¸­ï¼Œå®ç°è¿™ç§åŒæ­¥åŸè¯­çš„ç®—æ³•æ˜¯ CAS (Compare And Swap)ã€‚</p><p>ç®€å•ç¿»è¯‘æ˜¯ï¼šæ¯”è¾ƒç„¶åäº¤æ¢</p><p>CASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼šå†…å­˜ä½ç½®ï¼ˆè¦æ›´æ–°çš„å˜é‡ï¼‰ã€é¢„æœŸåŸå€¼å’Œæ–°å€¼ã€‚</p><p><strong>å·¥ä½œåŸç†</strong></p><ol><li><strong>æ£€æŸ¥å’Œæ›´æ–°</strong>ï¼š<ul><li>CASé¦–å…ˆæ£€æŸ¥<strong>ç›®æ ‡å†…å­˜ä½ç½®çš„å½“å‰å€¼</strong>æ˜¯å¦ä¸é¢„æœŸåŸå€¼ç›¸åŒã€‚å¦‚æœç›¸åŒï¼Œå®ƒä¼šå°†è¯¥å†…å­˜ä½ç½®çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ã€‚</li><li>å¦‚æœç›®æ ‡å€¼å·²è¢«å…¶ä»–çº¿ç¨‹æ”¹å˜ï¼ˆä¸ç­‰äºé¢„æœŸåŸå€¼ï¼‰ï¼ŒCASæ“ä½œå¤±è´¥ã€‚</li></ul></li><li><strong>æ— é”æ“ä½œ</strong>ï¼š<ul><li>CASæä¾›äº†ä¸€ç§æ— éœ€é”å®šçš„æ–¹å¼æ¥å®ç°å¹¶å‘æ§åˆ¶ï¼Œå‡å°‘äº†é”çš„å¼€é”€å’Œå¤æ‚æ€§ã€‚</li></ul></li></ol><div style="border: 1px solid #999; border-radius: 5px; padding: 10px;">    CASæ“ä½œæ˜¯åŸå­æ€§çš„ã€‚</div><h3 id="4ã€æ‚²è§‚é”å’Œä¹è§‚é”"><a href="#4ã€æ‚²è§‚é”å’Œä¹è§‚é”" class="headerlink" title="4ã€æ‚²è§‚é”å’Œä¹è§‚é”"></a>4ã€æ‚²è§‚é”å’Œä¹è§‚é”</h3><h4 id="æ‚²è§‚é”ç¤ºä¾‹"><a href="#æ‚²è§‚é”ç¤ºä¾‹" class="headerlink" title="æ‚²è§‚é”ç¤ºä¾‹"></a>æ‚²è§‚é”ç¤ºä¾‹</h4><p>åœ¨Javaä¸­ï¼Œæ‚²è§‚é”é€šå¸¸æ˜¯é€šè¿‡<code>synchronized</code>å…³é”®å­—æˆ–<code>ReentrantLock</code>ç±»å®ç°çš„ã€‚</p><p><code>synchronized</code> ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> PessimisticLockExample &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-keyword">count</span> = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> increment() &#123;<br>        <span class="hljs-keyword">count</span>++;  <span class="hljs-comment">// ä»…å½“æŒæœ‰å¯¹è±¡é”æ—¶ï¼Œæ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œ</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">int</span> getCount() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">count</span>;  <span class="hljs-comment">// åŒæ ·ï¼Œéœ€è¦æŒæœ‰å¯¹è±¡é”æ‰èƒ½æ‰§è¡Œ</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨<code>synchronized</code>å…³é”®å­—é”å®šäº†æ•´ä¸ªæ–¹æ³•ã€‚</p><p>å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥<code>increment</code>æˆ–<code>getCount</code>æ–¹æ³•æ—¶ï¼Œå®ƒå¿…é¡»å…ˆè·å¾—è¿™ä¸ªå¯¹è±¡çš„é”ã€‚åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œå…¶ä»–ä»»ä½•è¯•å›¾è¿›å…¥è¿™äº›åŒæ­¥æ–¹æ³•çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ã€‚</p><h4 id="ä¹è§‚é”ç¤ºä¾‹"><a href="#ä¹è§‚é”ç¤ºä¾‹" class="headerlink" title="ä¹è§‚é”ç¤ºä¾‹"></a>ä¹è§‚é”ç¤ºä¾‹</h4><p>ä¹è§‚é”é€šå¸¸æ˜¯é€šè¿‡CASï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰æ“ä½œå®ç°çš„ã€‚</p><p>åœ¨Javaä¸­ï¼Œ<code>AtomicInteger</code>ç±»æä¾›äº†ä¸€ç§ä½¿ç”¨ä¹è§‚é”çš„æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨<code>AtomicInteger</code>å®ç°ä¹è§‚é”çš„ç¤ºä¾‹ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">OptimisticLockExample</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> AtomicInteger count = <span class="hljs-keyword">new</span> <span class="hljs-type">AtomicInteger</span>(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">public</span> void increment() &#123;<br>        int currentValue;<br>        int <span class="hljs-keyword">new</span><span class="hljs-type">Value</span>;<br>        <span class="hljs-keyword">do</span> &#123;<br>            currentValue = count.<span class="hljs-keyword">get</span>(); <span class="hljs-comment">// è·å–å½“å‰å€¼</span><br>            <span class="hljs-keyword">new</span><span class="hljs-type">Value</span> = currentValue + <span class="hljs-number">1</span>; <span class="hljs-comment">// è®¡ç®—æ–°å€¼</span><br>        &#125; <span class="hljs-keyword">while</span> (!count.compareAndSet(currentValue, <span class="hljs-keyword">new</span><span class="hljs-type">Value</span>)); <span class="hljs-comment">// CASæ“ä½œ</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> int getCount() &#123;<br>        <span class="hljs-keyword">return</span> count.<span class="hljs-keyword">get</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>AtomicInteger</code>çš„<code>compareAndSet</code>æ–¹æ³•å®ç°äº†CASæ“ä½œã€‚</p><p>å®ƒä¼šæ¯”è¾ƒ<code>count</code>çš„å½“å‰å€¼å’Œ<code>currentValue</code>ã€‚å¦‚æœç›¸åŒï¼Œå®ƒä¼šæ›´æ–°<code>count</code>ä¸º<code>newValue</code>ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯æ— é”çš„ï¼Œå³ä½¿åœ¨å¹¶å‘ç¯å¢ƒä¸‹ä¹Ÿä¸ä¼šé˜»å¡å…¶ä»–çº¿ç¨‹ã€‚å¦‚æœ<code>count</code>çš„å€¼åœ¨æ­¤æœŸé—´è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œ<code>compareAndSet</code>ä¼šè¿”å›<code>false</code>ï¼Œå¾ªç¯ç»§ç»­ï¼Œç›´åˆ°æ›´æ–°æˆåŠŸã€‚</p><blockquote><p>å¯¹æ¯”</p></blockquote><ul><li><strong>æ‚²è§‚é”</strong>ï¼ˆ<code>synchronized</code>ï¼Œ<code>ReentrantLock</code>ï¼‰é€‚ç”¨äºå†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œå› ä¸ºå®ƒé˜²æ­¢äº†å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™å…¥ï¼Œå‡å°‘äº†å†²çªã€‚</li><li><strong>ä¹è§‚é”</strong>ï¼ˆå¦‚<code>AtomicInteger</code>çš„CASæ“ä½œï¼‰é€‚ç”¨äºè¯»æ“ä½œå¤šçš„åœºæ™¯ï¼Œå®ƒä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œä½†åœ¨å†™æ“ä½œé¢‘ç¹çš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´é«˜é‡è¯•æˆæœ¬ã€‚</li></ul><h3 id="5ã€ReentrantLock-â˜†"><a href="#5ã€ReentrantLock-â˜†" class="headerlink" title="5ã€ReentrantLock   â˜†"></a>5ã€ReentrantLock   â˜†</h3><p>çº¿ç¨‹è€ƒå¯Ÿçš„ä¸€ä¸ªé‡ç‚¹ï¼Œä¸€ä¸ªæ˜¯ <code>synchronized</code>å…³é”®å­—ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ <code>ReentrantLock</code>ç±»ã€‚</p><p>è¿™å¥è¯å¯ä»¥é˜è¿° ReentrantLock çš„å¤§éƒ¨åˆ†æ“ä½œï¼š</p><p><code>ReentrantLock</code> é‡Œé¢æœ‰ä¸€ä¸ªå†…éƒ¨ç±» <code>Sync</code>ï¼Œ<code>Sync</code> ç»§æ‰¿ AQSï¼ˆ<code>AbstractQueuedSynchronizer</code>ï¼‰ï¼Œæ·»åŠ é”å’Œé‡Šæ”¾é”çš„å¤§éƒ¨åˆ†æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨ <code>Sync</code> ä¸­å®ç°çš„ã€‚<code>Sync</code> æœ‰å…¬å¹³é” <code>FairSync</code> å’Œéå…¬å¹³é” <code>NonfairSync</code> ä¸¤ä¸ªå­ç±»ã€‚</p><p>å»ºè®®å¯ä»¥ç›´æ¥çœ‹ä¸€ä¸‹â€œæºç è§£æâ€è¿™ä¸€éƒ¨åˆ†ã€‚</p><h4 id="ReentrantLock-çš„åŸºç¡€ä½¿ç”¨"><a href="#ReentrantLock-çš„åŸºç¡€ä½¿ç”¨" class="headerlink" title="ReentrantLock çš„åŸºç¡€ä½¿ç”¨"></a>ReentrantLock çš„åŸºç¡€ä½¿ç”¨</h4><p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œæ‚²è§‚é”æ˜¯ä¸€ç§ç­–ç•¥ï¼Œå®ƒå‡è®¾æœ€åçš„æƒ…å†µï¼šå³åœ¨å¤šä¸ªçº¿ç¨‹å°è¯•åŒæ—¶è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œä¼šå‘ç”Ÿå†²çªã€‚å› æ­¤ï¼Œæ‚²è§‚é”åœ¨è®¿é—®ä»»ä½•å…±äº«èµ„æºä¹‹å‰ä¼šå…ˆé”å®šå®ƒï¼Œä»¥é˜²æ­¢å…¶ä»–çº¿ç¨‹çš„è®¿é—®ï¼Œç›´åˆ°å®ƒå®Œæˆæ“ä½œå¹¶é‡Šæ”¾é”ã€‚</p><blockquote><p>ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰</p></blockquote><p><code>ReentrantLock</code> æ˜¯ä¸€ä¸ªå¯é‡å…¥çš„äº’æ–¥é”ï¼Œå®ƒæä¾›äº†æ¯” <code>synchronized</code> å…³é”®å­—æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œå¦‚å¯ä¸­æ–­çš„é”è·å–æ“ä½œã€å…¬å¹³é”ç­–ç•¥ã€é”ç»‘å®šå¤šä¸ªæ¡ä»¶ç­‰ã€‚</p><blockquote><p>åŸºäº AQS çš„å®ç°</p></blockquote><ul><li>AQS æä¾›äº†ä¸€ç§ç®¡ç†é”çŠ¶æ€çš„æ¡†æ¶ï¼Œå¹¶å¤„ç†äº†çº¿ç¨‹çš„æ’é˜Ÿå’Œé˜»å¡ã€‚åœ¨ <code>ReentrantLock</code> çš„å®ç°ä¸­ï¼ŒAQS è´Ÿè´£ç»´æŠ¤ä¸€ä¸ªè¡¨ç¤ºé”çŠ¶æ€çš„å˜é‡å’Œä¸€ä¸ªç”±ç­‰å¾…é”çš„çº¿ç¨‹ç»„æˆçš„é˜Ÿåˆ—ã€‚</li><li>å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å– <code>ReentrantLock</code> æ—¶ï¼ŒAQS ä¼šæ£€æŸ¥é”çš„çŠ¶æ€ï¼Œç„¶åè¦ä¹ˆæˆäºˆé”ï¼ˆå¦‚æœå½“å‰æœªè¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼‰ï¼Œè¦ä¹ˆå°†å°è¯•è·å–é”çš„çº¿ç¨‹æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚</li></ul><blockquote><p>æ‚²è§‚é”çš„ç‰¹æ€§</p></blockquote><ul><li><code>ReentrantLock</code> ä½œä¸ºä¸€ç§æ‚²è§‚é”ï¼Œæ˜¯åŸºäºè¿™æ ·çš„å‡è®¾ï¼šå¦‚æœä¸é‡‡å–æªæ–½ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºä¼šå¯¼è‡´é—®é¢˜ã€‚å› æ­¤ï¼Œå®ƒåœ¨ä¿®æ”¹èµ„æºä¹‹å‰å…ˆåŠ é”ï¼Œé˜²æ­¢å…¶ä»–çº¿ç¨‹åŒæ—¶è¿›è¡Œå†™æ“ä½œã€‚</li><li>è¿™ä¸ä¹è§‚é”çš„ç­–ç•¥ä¸åŒï¼Œä¹è§‚é”å…è®¸å¤šä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼Œä½†åœ¨å®é™…ä¿®æ”¹æ•°æ®æ—¶æ£€æŸ¥æ˜¯å¦å­˜åœ¨å†²çªã€‚</li></ul><p>ç¤ºä¾‹</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs csharp">import java.util.concurrent.locks.ReentrantLock;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ReentrantLockExample</span> &#123;<br>    <span class="hljs-keyword">private</span> final ReentrantLock <span class="hljs-keyword">lock</span> = <span class="hljs-keyword">new</span> ReentrantLock();<br>    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">increment</span>()</span> &#123;<br>        <span class="hljs-keyword">lock</span>.<span class="hljs-keyword">lock</span>();  <span class="hljs-comment">// è·å–é”</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            count++;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">lock</span>.unlock();  <span class="hljs-comment">// é‡Šæ”¾é”</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">getCount</span>()</span> &#123;<br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¿®æ”¹ <code>count</code> å˜é‡ä¹‹å‰è·å–äº†é”ï¼Œå¹¶åœ¨æ“ä½œå®Œæˆåé‡Šæ”¾äº†é”ã€‚</p><p>è¿™ç¡®ä¿äº†å³ä½¿å¤šä¸ªçº¿ç¨‹å°è¯•åŒæ—¶è°ƒç”¨ <code>increment</code> æ–¹æ³•ï¼Œ<code>count</code> çš„å¢åŠ ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h4 id="ReentrantLock-çš„å®ç°åŸç†"><a href="#ReentrantLock-çš„å®ç°åŸç†" class="headerlink" title="ReentrantLock çš„å®ç°åŸç†"></a>ReentrantLock çš„å®ç°åŸç†</h4><p><code>ReentrantLock</code> æ˜¯ Java å¹¶å‘åŒ…ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼ŒåŸºäº AQS å®ç°ã€‚</p><p>åŸºæœ¬åŸç†</p><ol><li><strong>å¯é‡å…¥æ€§</strong>ï¼š<ul><li><code>ReentrantLock</code> æ˜¯ä¸€ä¸ªå¯é‡å…¥é”ã€‚è¿™æ„å‘³ç€åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€ä¸ªé”è€Œä¸ä¼šå‘ç”Ÿæ­»é”ã€‚è¿™æ˜¯é€šè¿‡ä¸ºæ¯ä¸ªé”ç»´æŠ¤ä¸€ä¸ªæŒæœ‰è®¡æ•°å’Œä¸€ä¸ªæŒ‡å‘å½“å‰æŒæœ‰é”çš„çº¿ç¨‹çš„å¼•ç”¨æ¥å®ç°çš„ã€‚</li></ul></li><li><strong>åŸºäº AQS</strong>ï¼š<ul><li><code>ReentrantLock</code> çš„å®ç°ä¾èµ–äº AQSã€‚AQS ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„ volatile å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ª FIFO é˜Ÿåˆ—æ¥ç®¡ç†é‚£äº›ç­‰å¾…è·å–é”çš„çº¿ç¨‹ã€‚</li></ul></li><li><strong>é”çš„çŠ¶æ€</strong>ï¼š<ul><li>åœ¨ <code>ReentrantLock</code> ä¸­ï¼Œé”çš„çŠ¶æ€æ˜¯ç”± AQS çš„åŒæ­¥çŠ¶æ€å˜é‡æ¥è¡¨ç¤ºçš„ã€‚çŠ¶æ€ä¸º 0 è¡¨ç¤ºé”æ˜¯å¯ç”¨çš„ï¼ŒçŠ¶æ€ä¸º 1 è¡¨ç¤ºé”è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œå¤§äº 1 è¡¨ç¤ºåŒä¸€ä¸ªçº¿ç¨‹é‡å…¥äº†è¿™ä¸ªé”ã€‚</li></ul></li><li><strong>è·å–é”</strong>ï¼š<ul><li>å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå¦‚æœåŒæ­¥çŠ¶æ€ä¸º 0ï¼ŒAQS ä¼šå°è¯•é€šè¿‡ CASï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰æ“ä½œå°†çŠ¶æ€è®¾ç½®ä¸º 1ï¼Œä»è€Œè·å–é”ã€‚</li><li>å¦‚æœé”å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼ˆåŒæ­¥çŠ¶æ€é 0ï¼‰ï¼Œé‚£ä¹ˆå°è¯•è·å–é”çš„çº¿ç¨‹ä¼šè¢«åŠ å…¥åˆ° AQS ç»´æŠ¤çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚</li></ul></li><li><strong>é‡Šæ”¾é”</strong>ï¼š<ul><li>å½“çº¿ç¨‹å®Œæˆä»»åŠ¡åï¼Œå®ƒä¼šè°ƒç”¨ <code>unlock</code> æ–¹æ³•æ¥é‡Šæ”¾é”ã€‚è¿™å°†å‡å°‘ AQS åŒæ­¥çŠ¶æ€çš„è®¡æ•°ã€‚å½“è®¡æ•°é™åˆ° 0 æ—¶ï¼Œé”è¢«å®Œå…¨é‡Šæ”¾ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªçº¿ç¨‹å°†æœ‰æœºä¼šè·å–é”ã€‚</li></ul></li></ol><p>å…¬å¹³æ€§å’Œéå…¬å¹³æ€§</p><ul><li><strong>å…¬å¹³é”</strong>ï¼šåœ¨å…¬å¹³æ¨¡å¼ä¸‹ï¼Œ<code>ReentrantLock</code> ä¼šæŒ‰ç…§çº¿ç¨‹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç­‰å¾…é¡ºåºæ¥è·å–é”ã€‚è¿™æ„å‘³ç€é¦–å…ˆè¿›å…¥ç­‰å¾…é˜Ÿåˆ—çš„çº¿ç¨‹å°†å…ˆè·å¾—é”ã€‚</li><li><strong>éå…¬å¹³é”</strong>ï¼šåœ¨éå…¬å¹³æ¨¡å¼ä¸‹ï¼Œå½“é”å¯ç”¨æ—¶ï¼Œä»»ä½•è¯·æ±‚å®ƒçš„çº¿ç¨‹éƒ½æœ‰æœºä¼šè·å–é”ã€‚è¿™å¯èƒ½ä¸ä¼šéµå®ˆç­‰å¾…é˜Ÿåˆ—ä¸­çš„é¡ºåºã€‚</li></ul><p>æ€§èƒ½è€ƒé‡</p><ul><li><strong>é€‰æ‹©å…¬å¹³æ€§</strong>ï¼šå…¬å¹³é”é€šå¸¸ä¼šæœ‰è¾ƒä½çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒä¸¥æ ¼æŒ‰ç…§ç­‰å¾…é˜Ÿåˆ—æ¥åˆ†é…é”ï¼Œä½†å®ƒå¯ä»¥å‡å°‘çº¿ç¨‹é¥¥é¥¿çš„æƒ…å†µã€‚</li><li><strong>é€‰æ‹©éå…¬å¹³æ€§</strong>ï¼šéå…¬å¹³é”å¯èƒ½ä¼šæœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œä½†å¯èƒ½å¯¼è‡´çº¿ç¨‹é¥¥é¥¿ï¼Œå› ä¸ºæŸäº›çº¿ç¨‹å¯èƒ½ä¼šé•¿æ—¶é—´ç­‰å¾…è€Œä¸å¾—ä¸é¢‘ç¹åœ°é‡æ–°è°ƒåº¦ã€‚</li></ul><p><code>ReentrantLock</code> æä¾›äº†ä¸€ç§çµæ´»çš„é”å®šæœºåˆ¶ï¼Œé€šè¿‡ AQS å®ç°äº†å¯é‡å…¥æ€§å’Œå¯é€‰çš„å…¬å¹³æ€§ã€‚</p><p>å®ƒå…è®¸æ›´ç»†ç²’åº¦çš„é”æ§åˆ¶ï¼Œä»è€Œåœ¨é«˜åº¦ç«äº‰çš„ç¯å¢ƒä¸­æä¾›æ¯”å†…ç½® <code>synchronized</code> æ›´é«˜çš„æ€§èƒ½å’Œæ›´å¼ºçš„åŠŸèƒ½ã€‚</p><h4 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h4><h5 id="ReentrantLock-ç±»ç»“æ„"><a href="#ReentrantLock-ç±»ç»“æ„" class="headerlink" title="ReentrantLock ç±»ç»“æ„"></a>ReentrantLock ç±»ç»“æ„</h5><p><code>ReentrantLock</code> æœ¬èº«æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„ç±»ï¼Œå®ƒä¾èµ–äºå†…éƒ¨ç±» <code>Sync</code> çš„å®ç°ï¼Œè€Œ <code>Sync</code> æ˜¯ <code>AbstractQueuedSynchronizer</code> çš„å­ç±»ã€‚</p><p>åœ¨ <code>ReentrantLock</code> ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦çš„å†…éƒ¨ç±»ï¼š<code>FairSync</code> å’Œ <code>NonfairSync</code>ï¼Œåˆ†åˆ«å¯¹åº”å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReentrantLock</span> <span class="hljs-title">implements</span> <span class="hljs-title">Lock</span>, <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Sync</span> sync;<br><br>    <span class="hljs-keyword">abstract</span> static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractQueuedSynchronizer</span> </span>&#123;<br>        <span class="hljs-comment">// ... å®ç°ç»†èŠ‚</span><br>    &#125;<br><br>    static <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NonfairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Sync</span> </span>&#123;<br>        <span class="hljs-comment">// ... éå…¬å¹³é”å®ç°</span><br>    &#125;<br><br>    static <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Sync</span> </span>&#123;<br>        <span class="hljs-comment">// ... å…¬å¹³é”å®ç°</span><br>    &#125;<br><br>    <span class="hljs-comment">// æ„é€ å‡½æ•°ç­‰å…¶ä»–æ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Sync-ç±»"><a href="#Sync-ç±»" class="headerlink" title="Sync ç±»"></a>Sync ç±»</h5><p><code>Sync</code> ç±»æ˜¯ <code>AbstractQueuedSynchronizer</code> çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†å¤§éƒ¨åˆ†ä¸é”çŠ¶æ€ç®¡ç†ç›¸å…³çš„åŠŸèƒ½ã€‚</p><p>å®ƒä½¿ç”¨ AQS çš„çŠ¶æ€å˜é‡æ¥è¡¨ç¤ºé”çš„æŒæœ‰æ¬¡æ•°ï¼Œä»¥åŠæŒæœ‰é”çš„çº¿ç¨‹ã€‚</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-keyword">abstract</span> static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractQueuedSynchronizer</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> boolean isHeldExclusively() &#123;<br>        <span class="hljs-keyword">return</span> getExclusiveOwnerThread() == <span class="hljs-type">Thread</span>.currentThread();<br>    &#125;<br><br>    <span class="hljs-keyword">final</span> void lock() &#123;<br>        acquire(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// å…¶ä»–æ–¹æ³•ï¼ŒåŒ…æ‹¬ tryAcquire, tryRelease ç­‰</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°"><a href="#å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°" class="headerlink" title="å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°"></a>å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°</h5><p><code>FairSync</code> å’Œ <code>NonfairSync</code> ç±»é‡å†™äº† <code>tryAcquire</code> æ–¹æ³•ä»¥æä¾›ä¸åŒçš„é”è·å–ç­–ç•¥ã€‚</p><ul><li><strong>éå…¬å¹³é”</strong>ï¼ˆ<code>NonfairSync</code>ï¼‰ï¼šåœ¨å°è¯•è·å–é”æ—¶ï¼Œä¼šç«‹å³å°è¯•æ”¹å˜çŠ¶æ€ï¼Œè€Œä¸æ£€æŸ¥ç­‰å¾…é˜Ÿåˆ—ã€‚</li><li><strong>å…¬å¹³é”</strong>ï¼ˆ<code>FairSync</code>ï¼‰ï¼šåœ¨å°è¯•è·å–é”ä¹‹å‰ï¼Œä¼šæ£€æŸ¥ç­‰å¾…é˜Ÿåˆ—ï¼Œä»¥ç¡®ä¿é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å…ˆè·å¾—æœåŠ¡ã€‚</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs scala">static <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NonfairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Sync</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> boolean tryAcquire(int acquires) &#123;<br>        <span class="hljs-comment">// å®ç°éå…¬å¹³çš„é”è·å–é€»è¾‘</span><br>    &#125;<br>&#125;<br><br>static <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FairSync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Sync</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> boolean tryAcquire(int acquires) &#123;<br>        <span class="hljs-comment">// å®ç°å…¬å¹³çš„é”è·å–é€»è¾‘</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="AbstractQueuedSynchronizerï¼ˆAQSï¼‰"><a href="#AbstractQueuedSynchronizerï¼ˆAQSï¼‰" class="headerlink" title="AbstractQueuedSynchronizerï¼ˆAQSï¼‰"></a>AbstractQueuedSynchronizerï¼ˆAQSï¼‰</h5><p>AQS æ˜¯å®ç°é”å’Œå…¶ä»–åŒæ­¥å™¨çš„æ¡†æ¶ã€‚å®ƒä½¿ç”¨ä¸€ä¸ª int ç±»å‹çš„ volatile å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥ç®¡ç†é‚£äº›æœªèƒ½æˆåŠŸè·å–åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹ã€‚</p><ul><li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šAQS æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥æ“ä½œå…¶çŠ¶æ€å˜é‡ï¼Œå¦‚ <code>getState()</code>, <code>setState(int)</code> å’Œ <code>compareAndSetState(int, int)</code>ã€‚</li><li><strong>é˜Ÿåˆ—ç®¡ç†</strong>ï¼šAQS ç»´æŠ¤äº†ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå½“çº¿ç¨‹å°è¯•è·å–èµ„æºå¤±è´¥æ—¶ï¼Œå®ƒä¼šè¢«åŠ å…¥åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­ã€‚</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs scala">public <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AbstractQueuedSynchronizer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractOwnableSynchronizer</span> <span class="hljs-title">implements</span> <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> transient volatile <span class="hljs-type">Node</span> head;<br>    <span class="hljs-keyword">private</span> transient volatile <span class="hljs-type">Node</span> tail;<br>    <span class="hljs-keyword">private</span> volatile int state;<br><br>    <span class="hljs-comment">// å†…éƒ¨ç±» Nodeï¼Œé˜Ÿåˆ—èŠ‚ç‚¹çš„å®šä¹‰</span><br>    static <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span> </span>&#123;<br>        <span class="hljs-comment">// Node çš„ç»“æ„å’Œæ–¹æ³•</span><br>    &#125;<br><br>    <span class="hljs-comment">// çŠ¶æ€ç®¡ç†å’Œé˜Ÿåˆ—æ“ä½œçš„æ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="é”çš„è·å–ä¸é‡Šæ”¾"><a href="#é”çš„è·å–ä¸é‡Šæ”¾" class="headerlink" title="é”çš„è·å–ä¸é‡Šæ”¾"></a>é”çš„è·å–ä¸é‡Šæ”¾</h5><ul><li><strong>è·å–é”</strong>ï¼šå½“ <code>ReentrantLock</code> çš„ <code>lock()</code> æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº† <code>Sync</code> ç±»çš„ <code>acquire</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆä¼šè°ƒç”¨ <code>tryAcquire</code> æ–¹æ³•ã€‚<code>tryAcquire</code> çš„å…·ä½“å®ç°å–å†³äºæ˜¯ <code>FairSync</code> è¿˜æ˜¯ <code>NonfairSync</code>ã€‚</li><li><strong>é‡Šæ”¾é”</strong>ï¼š<code>unlock()</code> æ–¹æ³•è°ƒç”¨ <code>Sync</code> ç±»çš„ <code>release</code> æ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨<code>tryRelease</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæ›´æ–°åŒæ­¥çŠ¶æ€ï¼Œå¹¶åœ¨çŠ¶æ€å˜ä¸º 0 æ—¶ï¼ˆå³é”è¢«å®Œå…¨é‡Šæ”¾æ—¶ï¼‰ï¼Œå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹.</li></ul><h5 id="è·å–é”çš„è¿‡ç¨‹"><a href="#è·å–é”çš„è¿‡ç¨‹" class="headerlink" title="è·å–é”çš„è¿‡ç¨‹"></a>è·å–é”çš„è¿‡ç¨‹</h5><ol><li>å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>lock()</code> æ–¹æ³•æ—¶ï¼Œå®ƒå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ <code>Sync</code> ç±»ä¸­çš„ <code>acquire(int)</code> æ–¹æ³•ã€‚</li><li><code>acquire(int)</code> æ–¹æ³•ä¼šè°ƒç”¨é‡å†™çš„ <code>tryAcquire(int)</code> æ–¹æ³•ï¼ˆå–å†³äºæ˜¯ <code>FairSync</code> è¿˜æ˜¯ <code>NonfairSync</code>ï¼‰ã€‚<ul><li>åœ¨ <code>NonfairSync</code> ä¸­ï¼Œå®ƒä¼šç«‹å³å°è¯•è·å–é”ï¼Œä¸ç®¡å…¶ä»–çº¿ç¨‹æ˜¯å¦åœ¨ç­‰å¾…ã€‚</li><li>åœ¨ <code>FairSync</code> ä¸­ï¼Œå®ƒä¼šå…ˆæ£€æŸ¥é˜Ÿåˆ—ï¼Œä»¥ç¡®ä¿æ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…æ—¶é—´æ›´é•¿ã€‚</li></ul></li></ol><h5 id="é‡Šæ”¾é”çš„è¿‡ç¨‹"><a href="#é‡Šæ”¾é”çš„è¿‡ç¨‹" class="headerlink" title="é‡Šæ”¾é”çš„è¿‡ç¨‹"></a>é‡Šæ”¾é”çš„è¿‡ç¨‹</h5><ol><li>å½“çº¿ç¨‹è°ƒç”¨ <code>unlock()</code> æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨ <code>Sync</code> ç±»çš„ <code>release(int)</code> æ–¹æ³•ã€‚</li><li><code>release(int)</code> æ–¹æ³•å†…éƒ¨ä¼šè°ƒç”¨ <code>tryRelease(int)</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯é”çš„æŒæœ‰è€…ï¼Œå¹¶å°è¯•å°†åŒæ­¥çŠ¶æ€è®¾ç½®å› 0ã€‚</li><li>å¦‚æœåŒæ­¥çŠ¶æ€æˆåŠŸè®¾ç½®å› 0ï¼Œè¡¨ç¤ºé”å·²ç»è¢«é‡Šæ”¾ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„å…¶ä»–çº¿ç¨‹å¯èƒ½ä¼šè¢«å”¤é†’å¹¶å°è¯•è·å–é”ã€‚</li></ol><h5 id="AQS-ä¸­çš„ç­‰å¾…é˜Ÿåˆ—"><a href="#AQS-ä¸­çš„ç­‰å¾…é˜Ÿåˆ—" class="headerlink" title="AQS ä¸­çš„ç­‰å¾…é˜Ÿåˆ—"></a>AQS ä¸­çš„ç­‰å¾…é˜Ÿåˆ—</h5><p>AQS ä½¿ç”¨ä¸€ä¸ªå†…éƒ¨çš„ FIFO é˜Ÿåˆ—æ¥ç®¡ç†é‚£äº›æ— æ³•è·å–åˆ°é”çš„çº¿ç¨‹ã€‚</p><p>æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªçº¿ç¨‹ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æ— æ³•è·å–åˆ°é”æ—¶ï¼Œå®ƒä¼šè¢«åŒ…è£…æˆä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—çš„æœ«å°¾ã€‚å½“é”è¢«é‡Šæ”¾æ—¶ï¼Œé˜Ÿåˆ—å¤´éƒ¨çš„èŠ‚ç‚¹ä¼šè¢«å”¤é†’å¹¶å°è¯•å†æ¬¡è·å–é”ã€‚</p><h5 id="CAS-åœ¨-AQS-ä¸­çš„ä½¿ç”¨"><a href="#CAS-åœ¨-AQS-ä¸­çš„ä½¿ç”¨" class="headerlink" title="CAS åœ¨ AQS ä¸­çš„ä½¿ç”¨"></a>CAS åœ¨ AQS ä¸­çš„ä½¿ç”¨</h5><p>AQS ä½¿ç”¨ CAS æ“ä½œæ¥å®‰å…¨åœ°ä¿®æ”¹åŒæ­¥çŠ¶æ€ã€‚è¿™æ˜¯ä¸€ç§æ— é”çš„åŸå­æ“ä½œï¼Œå¯ä»¥ä¿è¯å³ä½¿åœ¨å¤šä¸ªçº¿ç¨‹åŒæ—¶å°è¯•ä¿®æ”¹çŠ¶æ€æ—¶ï¼ŒåŒæ­¥çŠ¶æ€çš„æ›´æ–°ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚</p><blockquote><p>æ€»ç»“</p></blockquote><p><code>ReentrantLock</code> çš„å®ç°ä¾èµ–äº AQS çš„å¼ºå¤§åŠŸèƒ½ï¼Œæä¾›äº†ä¸€ç§çµæ´»ä¸”é«˜æ•ˆçš„æ–¹å¼æ¥å¤„ç†å¹¶å‘ç¼–ç¨‹ä¸­çš„åŒæ­¥é—®é¢˜ã€‚</p><p>é€šè¿‡å°†é”çš„å…·ä½“å®ç°ç»†èŠ‚å§”æ‰˜ç»™ AQSï¼Œ<code>ReentrantLock</code> ä¸ä»…æä¾›äº†åŸºæœ¬çš„é”åŠŸèƒ½ï¼Œè¿˜æ”¯æŒå¦‚å…¬å¹³æ€§&#x2F;éå…¬å¹³æ€§é€‰æ‹©ã€æ¡ä»¶å˜é‡ã€ä»¥åŠé”çš„å¯é‡å…¥æ€§ç­‰é«˜çº§ç‰¹æ€§ã€‚</p><h3 id="5ã€synchronized"><a href="#5ã€synchronized" class="headerlink" title="5ã€synchronized"></a>5ã€synchronized</h3><p>è¿™éƒ¨åˆ†å†…å®¹çš„é”å‡çº§çŠ¶æ€ç›¸å…³å†…å®¹æœ‰å¿…è¦é˜è¿°ä¸€ä¸‹ï¼ˆæ— é”çŠ¶æ€ã€åå‘é”çŠ¶æ€ã€è½»é‡çº§é”çŠ¶æ€ã€é‡é‡çº§é”çŠ¶æ€ï¼‰</p><h4 id="é”å‡çº§è¿‡ç¨‹"><a href="#é”å‡çº§è¿‡ç¨‹" class="headerlink" title="é”å‡çº§è¿‡ç¨‹"></a>é”å‡çº§è¿‡ç¨‹</h4><blockquote><p>è¯´ä¸€ä¸‹åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ï¼ˆé”å‡çº§è¿‡ç¨‹ï¼‰ã€‚</p></blockquote><p>åœ¨Javaä¸­ï¼Œä¸ºäº†ä¼˜åŒ–åŒæ­¥æ“ä½œçš„æ€§èƒ½ï¼Œå¼•å…¥äº†åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”çš„æ¦‚å¿µã€‚</p><p>è¿™äº›é”æ˜¯å¯¹<code>synchronized</code>å…³é”®å­—çš„ä¼˜åŒ–ï¼Œæ—¨åœ¨å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚åœ¨ä¸åŒç«äº‰æ¡ä»¶ä¸‹ï¼Œé”å¯ä»¥ä»åå‘é”å‡çº§åˆ°è½»é‡çº§é”ï¼Œå†å‡çº§åˆ°é‡é‡çº§é”ã€‚</p><p>åå‘é”ï¼ˆBiased Lockingï¼‰</p><ul><li><strong>ç›®çš„</strong>ï¼šåœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—çš„æƒ…å†µä¸‹ï¼Œå‡å°‘ä¸å¿…è¦çš„é”ç«äº‰å¼€é”€ã€‚</li><li><strong>åŸç†</strong>ï¼šå½“é”è¢«ç¬¬ä¸€æ¬¡è·å–æ—¶ï¼Œå®ƒä¼šå°†é”å¯¹è±¡çš„å¤´éƒ¨ä¿¡æ¯æ ‡è®°ä¸ºåå‘æ¨¡å¼ï¼Œå¹¶è®°å½•è·å–å®ƒçš„çº¿ç¨‹IDã€‚ä¹‹åï¼Œè¯¥çº¿ç¨‹è¿›å…¥åŒæ­¥å—æ—¶ä¸éœ€è¦å†è¿›è¡ŒåŒæ­¥ã€‚</li><li><strong>å‡çº§æ¡ä»¶</strong>ï¼šå½“æœ‰å¦ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–è¿™ä¸ªé”æ—¶ï¼Œåå‘é”ä¼šå‡çº§ä¸ºè½»é‡çº§é”ã€‚</li></ul><p> è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰</p><ul><li><strong>ç›®çš„</strong>ï¼šåœ¨æ— æ˜æ˜¾çº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼Œå‡å°‘ä¼ ç»Ÿçš„é”æœºåˆ¶ï¼ˆé‡é‡çº§é”ï¼‰çš„æ€§èƒ½æ¶ˆè€—ã€‚</li><li><strong>åŸç†</strong>ï¼šçº¿ç¨‹åœ¨è·å–é”æ—¶ï¼Œä¼šåœ¨æ ˆå¸§ä¸­åˆ›å»ºä¸€ä¸ªé”è®°å½•ï¼ˆLock Recordï¼‰ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡çš„å¤´éƒ¨ä¿¡æ¯ã€‚ç„¶åï¼Œå°è¯•ä½¿ç”¨CASï¼ˆCompare And Swapï¼‰æ“ä½œæ›¿æ¢å¯¹è±¡å¤´éƒ¨ä¿¡æ¯ï¼Œå°†å…¶æŒ‡å‘é”è®°å½•ã€‚å¦‚æœæˆåŠŸï¼Œçº¿ç¨‹è·å¾—é”ï¼›å¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå…¶ä»–çº¿ç¨‹ç«äº‰é”ã€‚</li><li><strong>å‡çº§æ¡ä»¶</strong>ï¼šå½“å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€ä¸ªé”æ—¶ï¼Œè½»é‡çº§é”ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚</li></ul><p>é‡é‡çº§é”ï¼ˆHeavyweight Lockingï¼‰</p><ul><li><strong>ç›®çš„</strong>ï¼šåœ¨å¼ºç«äº‰æ¡ä»¶ä¸‹ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li><li><strong>åŸç†</strong>ï¼šå½“é”å¤„äºé‡é‡çº§çŠ¶æ€æ—¶ï¼Œçº¿ç¨‹å°è¯•è·å–é”å¤±è´¥ï¼Œä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚è¿™éœ€è¦æ“ä½œç³»ç»Ÿçš„å¸®åŠ©ï¼Œä»£ä»·æ¯”è½»é‡çº§é”å’Œåå‘é”è¦é«˜ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šé‡é‡çº§é”æ˜¯æœ€ä¼ ç»Ÿçš„åŒæ­¥æ–¹å¼ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹é¢‘ç¹ç«äº‰åŒä¸€ä¸ªé”æ—¶ï¼Œä½¿ç”¨é‡é‡çº§é”å¯ä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚</li></ul><p>é”å‡çº§è¿‡ç¨‹</p><ol><li><strong>åˆå§‹çŠ¶æ€</strong>ï¼šæ–°åˆ›å»ºçš„é”å¯¹è±¡é»˜è®¤æ˜¯æ— é”çŠ¶æ€ã€‚</li><li><strong>åå‘é”</strong>ï¼šå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—æ—¶ï¼Œé”ä¼šå˜ä¸ºåå‘é”ã€‚è¯¥çº¿ç¨‹åç»­è¿›å…¥åŒæ­¥å—ä¸éœ€è¦çœŸæ­£çš„é”æ“ä½œã€‚</li><li><strong>è½»é‡çº§é”</strong>ï¼šå½“æœ‰å¦ä¸€ä¸ªçº¿ç¨‹å°è¯•è·å–è¿™ä¸ªåå‘é”æ—¶ï¼Œå¦‚æœæŒæœ‰åå‘é”çš„çº¿ç¨‹ä¸æ´»è·ƒï¼Œåå‘é”å¯ä»¥æ’¤é”€å¹¶å‡çº§ä¸ºè½»é‡çº§é”ã€‚</li><li><strong>é‡é‡çº§é”</strong>ï¼šå¦‚æœè½»é‡çº§é”çš„è‡ªæ—‹å¤±è´¥ï¼ˆå³å¤šä¸ªçº¿ç¨‹ç«äº‰åŒä¸€ä¸ªé”ï¼‰ï¼Œåˆ™å‡çº§ä¸ºé‡é‡çº§é”ã€‚</li></ol><p>ç±»æ¯”</p><p>å¯ä»¥å°†è¿™äº›é”çš„å‡çº§è¿‡ç¨‹ç±»æ¯”ä¸ºä¸åŒå®‰å…¨çº§åˆ«çš„é—¨ç¦ç³»ç»Ÿï¼š</p><ul><li><strong>åå‘é”</strong>ï¼šç±»ä¼¼äºä¸€æ‰‡åªå…è®¸ä¸€ä¸ªç‰¹å®šå‘˜å·¥è¿›å…¥çš„é—¨ã€‚åªè¦æ˜¯è¿™ä¸ªå‘˜å·¥ï¼Œé—¨ä¼šè‡ªåŠ¨æ‰“å¼€ï¼Œæ— éœ€ä»»ä½•éªŒè¯ã€‚</li><li><strong>è½»é‡çº§é”</strong>ï¼šç±»ä¼¼äºæœ‰ä¸€ä¸ªç®€å•çš„é”ç³»ç»Ÿï¼Œå‘˜å·¥éœ€è¦åˆ·å¡ï¼ˆCASæ“ä½œï¼‰è¿›å…¥ï¼Œå¦‚æœé—¨æ²¡æœ‰è¢«å…¶ä»–äººä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆå¿«ã€‚</li><li><strong>é‡é‡çº§é”</strong>ï¼šå¦‚æœé—¨ç»å¸¸è¢«å¤šäººåŒæ—¶å°è¯•ä½¿ç”¨ï¼Œç³»ç»Ÿä¼šå‡çº§åˆ°ä¸€ä¸ªæœ‰ä¿å®‰çš„æ›´å¤æ‚çš„é—¨ç¦ç³»ç»Ÿï¼Œæ¥ç¡®ä¿æ¯æ¬¡åªæœ‰ä¸€ä¸ªäººè¿›å…¥ã€‚</li></ul><hr><p>å‚è€ƒ:</p><ul><li><a href="https://blog.csdn.net/wang_yong_hui_1234/article/details/130165866">https://blog.csdn.net/wang_yong_hui_1234/article/details/130165866</a></li><li><a href="https://www.bilibili.com/video/BV12K411G7Fg">https://www.bilibili.com/video/BV12K411G7Fg</a></li><li><a href="https://javaguide.cn/java/concurrent/java-concurrent-questions-01.html">https://javaguide.cn/java/concurrent/java-concurrent-questions-01.html</a></li><li><a href="https://www.bilibili.com/video/BV1z44y1X7BJ">https://www.bilibili.com/video/BV1z44y1X7BJ</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>Thread</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>thread</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå­¦ä¹ _SpringMVC</title>
    <link href="/2023/12/05/Spring%E5%AD%A6%E4%B9%A0_SpringMVC/"/>
    <url>/2023/12/05/Spring%E5%AD%A6%E4%B9%A0_SpringMVC/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€ä»€ä¹ˆæ˜¯SpringMVC"><a href="#1ã€ä»€ä¹ˆæ˜¯SpringMVC" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯SpringMVC"></a>1ã€ä»€ä¹ˆæ˜¯SpringMVC</h3><p>SpringMVCæ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºæ„å»ºWebåº”ç”¨ç¨‹åºï¼Œé‡‡ç”¨äº†ç»å…¸çš„MVCè®¾è®¡æ¨¡å¼ã€‚</p><p>MVCè‹±æ–‡æ˜¯Model View Controllerï¼Œæ˜¯æ¨¡å‹(model)ï¼è§†å›¾(view)ï¼æ§åˆ¶å™¨(controller)çš„ç¼©å†™ï¼Œä¸€ç§è½¯ä»¶è®¾è®¡è§„èŒƒã€‚æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§è§£è€¦ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å°†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ã€æ˜¾ç¤ºåˆ†ç¦»æ¥ç»„ç»‡ä»£ç ã€‚</p><ol><li><strong>æ¨¡å‹ï¼ˆModelï¼‰ï¼š</strong><ul><li>æ¨¡å‹ä»£è¡¨åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®ã€‚åœ¨SpringMVCä¸­ï¼Œæ¨¡å‹é€šå¸¸æ˜¯ä¸€ä¸ªPOJOï¼ˆPlain Old Java Objectï¼‰ç±»ï¼Œè´Ÿè´£å°è£…ä¸šåŠ¡æ•°æ®ã€‚</li><li>æ¨¡å‹å¯¹è±¡å­˜å‚¨åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ç­‰ã€‚</li></ul></li><li><strong>è§†å›¾ï¼ˆViewï¼‰ï¼š</strong><ul><li>è§†å›¾è´Ÿè´£æ¸²æŸ“æ¨¡å‹æ•°æ®å¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚åœ¨SpringMVCä¸­ï¼Œè§†å›¾é€šå¸¸æ˜¯JSPï¼ˆJavaServer Pagesï¼‰æˆ–Thymeleafç­‰æ¨¡æ¿å¼•æ“ã€‚</li><li>è§†å›¾è´Ÿè´£å°†æ¨¡å‹çš„æ•°æ®ä»¥ç”¨æˆ·å‹å¥½çš„æ–¹å¼å‘ˆç°ï¼Œä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚</li></ul></li><li><strong>æ§åˆ¶å™¨ï¼ˆControllerï¼‰ï¼š</strong><ul><li>æ§åˆ¶å™¨æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚å¹¶å†³å®šè°ƒç”¨å“ªä¸ªä¸šåŠ¡é€»è¾‘å¤„ç†æ–¹æ³•ã€‚åœ¨SpringMVCä¸­ï¼Œæ§åˆ¶å™¨é€šå¸¸æ˜¯ä¸€ä¸ªç±»ï¼Œä½¿ç”¨æ³¨è§£æ¥æ ‡è¯†å¤„ç†è¯·æ±‚çš„æ–¹æ³•ã€‚</li><li>æ§åˆ¶å™¨å¤„ç†è¯·æ±‚åï¼Œè°ƒç”¨é€‚å½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œè·å–æˆ–æ›´æ–°æ¨¡å‹æ•°æ®ï¼Œç„¶åé€‰æ‹©åˆé€‚çš„è§†å›¾æ¥æ¸²æŸ“å“åº”ã€‚</li></ul></li><li><strong>å‰ç«¯æ§åˆ¶å™¨ï¼ˆFront Controllerï¼‰ï¼š</strong><ul><li>SpringMVC ä½¿ç”¨DispatcherServletä½œä¸ºå‰ç«¯æ§åˆ¶å™¨ï¼Œå®ƒæ˜¯Servletçš„ä¸€ä¸ªå­ç±»ï¼Œè´Ÿè´£æ‹¦æˆªæ‰€æœ‰è¿›å…¥åº”ç”¨çš„è¯·æ±‚ã€‚</li><li>DispatcherServletå°†è¯·æ±‚åˆ†å‘ç»™ç›¸åº”çš„å¤„ç†å™¨ï¼ˆControllerï¼‰ï¼Œå¹¶å°†æ¨¡å‹æ•°æ®ä¼ é€’ç»™åˆé€‚çš„è§†å›¾è¿›è¡Œæ¸²æŸ“ã€‚</li></ul></li><li><strong>å¤„ç†å™¨æ˜ å°„å™¨å’Œè§†å›¾è§£æå™¨ï¼š</strong><ul><li>å¤„ç†å™¨æ˜ å°„å™¨è´Ÿè´£å°†è¯·æ±‚æ˜ å°„åˆ°åˆé€‚çš„æ§åˆ¶å™¨ï¼Œæ ¹æ®è¯·æ±‚URLæ‰¾åˆ°å¯¹åº”çš„å¤„ç†å™¨ã€‚</li><li>è§†å›¾è§£æå™¨è´Ÿè´£å°†é€»è¾‘è§†å›¾åè§£æä¸ºå®é™…çš„è§†å›¾å¯¹è±¡ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªè§†å›¾æ¥å‘ˆç°æ¨¡å‹æ•°æ®ã€‚</li></ul></li></ol><h3 id="2ã€SpringMVCçš„æ ¸å¿ƒç»„ä»¶"><a href="#2ã€SpringMVCçš„æ ¸å¿ƒç»„ä»¶" class="headerlink" title="2ã€SpringMVCçš„æ ¸å¿ƒç»„ä»¶"></a>2ã€SpringMVCçš„æ ¸å¿ƒç»„ä»¶</h3><ul><li><strong><code>DispatcherServlet</code><strong>ï¼š</strong>æ ¸å¿ƒçš„ä¸­å¤®å¤„ç†å™¨</strong>ï¼Œè´Ÿè´£æ¥æ”¶è¯·æ±‚ã€åˆ†å‘ï¼Œå¹¶ç»™äºˆå®¢æˆ·ç«¯å“åº”ã€‚</li><li><strong><code>HandlerMapping</code><strong>ï¼š</strong>å¤„ç†å™¨æ˜ å°„å™¨</strong>ï¼Œæ ¹æ® URL å»åŒ¹é…æŸ¥æ‰¾èƒ½å¤„ç†çš„ <code>Handler</code> ï¼Œå¹¶ä¼šå°†è¯·æ±‚æ¶‰åŠåˆ°çš„æ‹¦æˆªå™¨å’Œ <code>Handler</code> ä¸€èµ·å°è£…ã€‚</li><li><strong><code>HandlerAdapter</code><strong>ï¼š</strong>å¤„ç†å™¨é€‚é…å™¨</strong>ï¼Œæ ¹æ® <code>HandlerMapping</code> æ‰¾åˆ°çš„ <code>Handler</code> ï¼Œé€‚é…æ‰§è¡Œå¯¹åº”çš„ <code>Handler</code>ï¼›</li><li><strong><code>Handler</code><strong>ï¼š</strong>è¯·æ±‚å¤„ç†å™¨</strong>ï¼Œå¤„ç†å®é™…è¯·æ±‚çš„å¤„ç†å™¨ã€‚</li><li><strong><code>ViewResolver</code><strong>ï¼š</strong>è§†å›¾è§£æå™¨</strong>ï¼Œæ ¹æ® <code>Handler</code> è¿”å›çš„é€»è¾‘è§†å›¾ &#x2F; è§†å›¾ï¼Œè§£æå¹¶æ¸²æŸ“çœŸæ­£çš„è§†å›¾ï¼Œå¹¶ä¼ é€’ç»™ <code>DispatcherServlet</code> å“åº”å®¢æˆ·ç«¯</li></ul><h3 id="3ã€SpringMVCçš„å·¥ä½œåŸç†"><a href="#3ã€SpringMVCçš„å·¥ä½œåŸç†" class="headerlink" title="3ã€SpringMVCçš„å·¥ä½œåŸç†"></a>3ã€SpringMVCçš„å·¥ä½œåŸç†</h3><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312061453227.png" alt="image.png"></p><p><strong>æµç¨‹è¯´æ˜ï¼ˆé‡è¦ï¼‰ï¼š</strong></p><ol><li>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘é€è¯·æ±‚ï¼Œ <code>DispatcherServlet</code>æ‹¦æˆªè¯·æ±‚ã€‚</li><li><code>DispatcherServlet</code> æ ¹æ®è¯·æ±‚ä¿¡æ¯è°ƒç”¨ <code>HandlerMapping</code> ã€‚<code>HandlerMapping</code> æ ¹æ® URL å»åŒ¹é…æŸ¥æ‰¾èƒ½å¤„ç†çš„ <code>Handler</code>ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸è¯´çš„ <code>Controller</code> æ§åˆ¶å™¨ï¼‰ ï¼Œå¹¶ä¼šå°†è¯·æ±‚æ¶‰åŠåˆ°çš„æ‹¦æˆªå™¨å’Œ <code>Handler</code> ä¸€èµ·å°è£…ã€‚</li><li><code>DispatcherServlet</code> è°ƒç”¨ <code>HandlerAdapter</code>é€‚é…å™¨æ‰§è¡Œ <code>Handler</code> ã€‚</li><li><code>Handler</code> å®Œæˆå¯¹ç”¨æˆ·è¯·æ±‚çš„å¤„ç†åï¼Œä¼šè¿”å›ä¸€ä¸ª <code>ModelAndView</code> å¯¹è±¡ç»™<code>DispatcherServlet</code>ï¼Œ<code>ModelAndView</code> é¡¾åæ€ä¹‰ï¼ŒåŒ…å«äº†æ•°æ®æ¨¡å‹ä»¥åŠç›¸åº”çš„è§†å›¾çš„ä¿¡æ¯ã€‚<code>Model</code> æ˜¯è¿”å›çš„æ•°æ®å¯¹è±¡ï¼Œ<code>View</code> æ˜¯ä¸ªé€»è¾‘ä¸Šçš„ <code>View</code>ã€‚</li><li><code>ViewResolver</code> ä¼šæ ¹æ®é€»è¾‘ <code>View</code> æŸ¥æ‰¾å®é™…çš„ <code>View</code>ã€‚</li><li><code>DispaterServlet</code> æŠŠè¿”å›çš„ <code>Model</code> ä¼ ç»™ <code>View</code>ï¼ˆè§†å›¾æ¸²æŸ“ï¼‰ã€‚</li><li>æŠŠ <code>View</code> è¿”å›ç»™è¯·æ±‚è€…ï¼ˆæµè§ˆå™¨ï¼‰</li></ol><p>to be continedâ€¦.</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://www.pdai.tech/md/spring/spring-x-framework-springmvc.html">https://www.pdai.tech/md/spring/spring-x-framework-springmvc.html</a></li><li><a href="https://javaguide.cn/system-design/framework/spring/spring-knowledge-and-questions-summary.html#spring-mvc">https://javaguide.cn/system-design/framework/spring/spring-knowledge-and-questions-summary.html#spring-mvc</a></li><li><a href="https://blog.csdn.net/Zhangsama1/article/details/131237139">https://blog.csdn.net/Zhangsama1/article/details/131237139</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå­¦ä¹ _AOP</title>
    <link href="/2023/12/05/Spring%E5%AD%A6%E4%B9%A0_AOP/"/>
    <url>/2023/12/05/Spring%E5%AD%A6%E4%B9%A0_AOP/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€ä»€ä¹ˆæ˜¯AOP"><a href="#1ã€ä»€ä¹ˆæ˜¯AOP" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯AOP"></a>1ã€ä»€ä¹ˆæ˜¯AOP</h3><p>AOPï¼ˆAspect-Oriented Programming:é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œé€šè¿‡åœ¨ä»£ç ä¸­æ¨ªå‘æ’å…¥å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ï¼‰ï¼Œå®ç°å¯¹åº”ç”¨ç¨‹åºæ¨¡å—åŒ–ã€å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§çš„æå‡ã€‚</p><p>AOP åˆ‡é¢ç¼–ç¨‹æ¶‰åŠåˆ°çš„ä¸€äº›ä¸“ä¸šæœ¯è¯­ï¼š</p><table><thead><tr><th>æœ¯è¯­</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ç›®æ ‡(Target)</td><td>è¢«é€šçŸ¥çš„å¯¹è±¡</td></tr><tr><td>ä»£ç†(Proxy)</td><td>å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„ä»£ç†å¯¹è±¡</td></tr><tr><td>è¿æ¥ç‚¹(JoinPoint)</td><td>ç›®æ ‡å¯¹è±¡çš„æ‰€å±ç±»ä¸­ï¼Œå®šä¹‰çš„æ‰€æœ‰æ–¹æ³•å‡ä¸ºè¿æ¥ç‚¹</td></tr><tr><td>åˆ‡å…¥ç‚¹(Pointcut)</td><td>è¢«åˆ‡é¢æ‹¦æˆª &#x2F; å¢å¼ºçš„è¿æ¥ç‚¹ï¼ˆåˆ‡å…¥ç‚¹ä¸€å®šæ˜¯è¿æ¥ç‚¹ï¼Œè¿æ¥ç‚¹ä¸ä¸€å®šæ˜¯åˆ‡å…¥ç‚¹ï¼‰</td></tr><tr><td>é€šçŸ¥(Advice)</td><td>å¢å¼ºçš„é€»è¾‘ &#x2F; ä»£ç ï¼Œä¹Ÿå³æ‹¦æˆªåˆ°ç›®æ ‡å¯¹è±¡çš„è¿æ¥ç‚¹ä¹‹åè¦åšçš„äº‹æƒ…</td></tr><tr><td>åˆ‡é¢(Aspect)</td><td>åˆ‡å…¥ç‚¹(Pointcut)+é€šçŸ¥(Advice)</td></tr><tr><td>Weaving(ç»‡å…¥)</td><td>å°†é€šçŸ¥åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡ï¼Œè¿›è€Œç”Ÿæˆä»£ç†å¯¹è±¡çš„è¿‡ç¨‹åŠ¨ä½œ</td></tr></tbody></table><h3 id="2ã€Spring-AOP-çš„å®ç°"><a href="#2ã€Spring-AOP-çš„å®ç°" class="headerlink" title="2ã€Spring AOP çš„å®ç°"></a>2ã€Spring AOP çš„å®ç°</h3><p>Spring AOPåŸºäºåŠ¨æ€ä»£ç†å®ç°ï¼Œ</p><ul><li>å¯¹äºå®ç°äº†æ¥å£çš„å¯¹è±¡ï¼Œä½¿ç”¨JDK Proxyåˆ›å»ºä»£ç†å¯¹è±¡ï¼›</li><li>å¯¹äºæœªå®ç°æ¥å£çš„å¯¹è±¡ï¼Œä½¿ç”¨Cglibç”Ÿæˆè¢«ä»£ç†å¯¹è±¡çš„å­ç±»ã€‚</li></ul><p>Spring AOPè¿˜é›†æˆäº†AspectJï¼ŒAspectJæ˜¯Javaç”Ÿæ€ç³»ç»Ÿä¸­æœ€å®Œæ•´çš„AOPæ¡†æ¶ï¼Œæ‹¥æœ‰æ›´å¤šåŠŸèƒ½ï¼Œç‰¹åˆ«åœ¨åˆ‡é¢è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œé€‰æ‹©AspectJç›¸æ¯”Spring AOPæ›´ä¸ºé«˜æ•ˆã€‚</p><hr><p>Springçš„AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰å…è®¸å¼€å‘è€…å®šä¹‰æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—ã€äº‹åŠ¡ç®¡ç†ç­‰ï¼‰ï¼Œè¿™äº›å…³æ³¨ç‚¹é€šå¸¸ä¸ä¸šåŠ¡é€»è¾‘çš„ä¸»æµç¨‹è§£è€¦ï¼Œå¯ä»¥è·¨è¶Šåº”ç”¨çš„å¤šä¸ªç‚¹ã€‚AOPé€šè¿‡åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å°†ä»£ç æ³¨å…¥åˆ°æŒ‡å®šä½ç½®æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè€Œè¿™æ­£æ˜¯é€šè¿‡â€œä»£ç†â€å®Œæˆçš„ã€‚</p><p>å®ç°AOPçš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ol><li><strong>JDKåŠ¨æ€ä»£ç†</strong>ï¼šé€‚ç”¨äºé‚£äº›å®ç°äº†æ¥å£çš„å¯¹è±¡ã€‚å®ƒé€šè¿‡åå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå°†æ¨ªåˆ‡é€»è¾‘ç»‡å…¥åˆ°è¿™äº›å¯¹è±¡ä¸­ã€‚</li><li><strong>CGLIBä»£ç†</strong>ï¼šé€‚ç”¨äºæ²¡æœ‰å®ç°æ¥å£çš„å¯¹è±¡ã€‚å®ƒé€šè¿‡åº•å±‚çš„å­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆè¢«ä»£ç†å¯¹è±¡çš„å­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­æ³¨å…¥æ¨ªåˆ‡é€»è¾‘ã€‚</li></ol><hr><h4 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h4><p>ä»‹ç»ä¸€ä¸‹ç›¸å…³çš„åŠŸèƒ½</p><p>åœ¨ Java AOP ï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ä¸­ï¼ŒåŠ¨æ€ä»£ç†æ˜¯ä¸€ç§å®ç°æœºåˆ¶ï¼Œå®ƒåœ¨è¿è¡Œæ—¶åˆ›å»ºä¸€ä¸ªå®ç°äº†ä¸€ç»„æ¥å£çš„ä»£ç†å¯¹è±¡ã€‚è¿™ä¸ªä»£ç†å¯¹è±¡å¯ä»¥åœ¨åŸæœ‰å¯¹è±¡æ–¹æ³•è°ƒç”¨å‰åæ‰§è¡Œé¢å¤–çš„æ“ä½œï¼ˆå¦‚æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ç­‰ï¼‰ï¼Œè€Œæ— éœ€ä¿®æ”¹åŸæœ‰å¯¹è±¡çš„ä»£ç ã€‚è¿™ç§æœºåˆ¶ä¸»è¦é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°ï¼šåŸºäºæ¥å£çš„ JDK åŠ¨æ€ä»£ç†å’ŒåŸºäºç±»çš„ä»£ç†ï¼ˆä¾‹å¦‚ä½¿ç”¨ CGLIB æˆ– ByteBuddyï¼‰ã€‚</p><blockquote><p>JDK åŠ¨æ€ä»£ç†</p></blockquote><p>JDK åŠ¨æ€ä»£ç†ä½¿ç”¨ <code>java.lang.reflect.Proxy</code> ç±»å’Œ <code>java.lang.reflect.InvocationHandler</code> æ¥å£å®ç°ã€‚è¿™ç§ä»£ç†æ–¹å¼è¦æ±‚ç›®æ ‡å¯¹è±¡å¿…é¡»å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚</p><p><strong>å·¥ä½œåŸç†</strong></p><ol><li><strong>æ¥å£å®ç°</strong>ï¼šåŠ¨æ€ä»£ç†ç±»å¿…é¡»å®ç°ç›®æ ‡ç±»çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚</li><li><strong>åˆ›å»ºä»£ç†å®ä¾‹</strong>ï¼šé€šè¿‡ <code>Proxy.newProxyInstance</code> æ–¹æ³•åˆ›å»ºä»£ç†å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ï¼š<ul><li>ç±»åŠ è½½å™¨ï¼ˆç”¨äºå®šä¹‰ä»£ç†ç±»ï¼‰</li><li>ä¸€ç»„æ¥å£ï¼ˆä»£ç†ç±»å°†å®ç°çš„æ¥å£ï¼‰</li><li><code>InvocationHandler</code> å®ç°ï¼ˆæ‰€æœ‰æ–¹æ³•è°ƒç”¨éƒ½ä¼šè½¬å‘åˆ°è¿™ä¸ªè°ƒç”¨å¤„ç†å™¨ï¼‰</li></ul></li><li><strong>æ–¹æ³•è°ƒç”¨</strong>ï¼šå½“ä»£ç†å®ä¾‹çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œè°ƒç”¨ä¼šè¢«è½¬å‘åˆ° <code>InvocationHandler</code> çš„ <code>invoke</code> æ–¹æ³•ã€‚åœ¨ <code>invoke</code> æ–¹æ³•ä¸­ï¼Œå¯ä»¥åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œå…¶ä»–æ“ä½œã€‚</li></ol><p>é€šè¿‡ <code>point.getTarget()</code> è·å–ç›®æ ‡å®ä¾‹</p><p>åœ¨ AOP æ¡†æ¶ä¸­ï¼Œå½“æ–¹æ³•æ‰§è¡Œè¢«æ‹¦æˆªï¼ˆå¦‚é€šè¿‡åˆ‡ç‚¹æŒ‡å®šçš„æ–¹æ³•ï¼‰ï¼ŒAOP æ¡†æ¶åˆ›å»ºä¸€ä¸ª <code>JoinPoint</code> å®ä¾‹ï¼Œè¯¥å®ä¾‹å°è£…äº†æœ‰å…³å½“å‰æ–¹æ³•è°ƒç”¨çš„ä¿¡æ¯ã€‚<code>JoinPoint</code> æä¾›äº† <code>getTarget()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼ˆåŸå§‹å¯¹è±¡ï¼‰ï¼Œå³ä½¿å½“å‰æ‰§è¡Œçš„æ˜¯ä»£ç†æ–¹æ³•ã€‚å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬æ“ä½œçš„æ˜¯ä»£ç†å®ä¾‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>getTarget()</code> è®¿é—®åˆ°åŸå§‹çš„ç›®æ ‡ç±»å®ä¾‹ã€‚</p><blockquote><p>CGLIB åŠ¨æ€ä»£ç†</p></blockquote><p>CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯å¦ä¸€ç§åŠ¨æ€ä»£ç†æ–¹å¼ï¼Œå®ƒä¸éœ€è¦æ¥å£ã€‚CGLIB é€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»å¹¶åœ¨è¿è¡Œæ—¶ç”Ÿæˆå­ç±»æ¥å®ç°ä»£ç†ã€‚</p><p>å·¥ä½œåŸç†</p><ol><li><strong>å­ç±»ç”Ÿæˆ</strong>ï¼šCGLIB åœ¨è¿è¡Œæ—¶ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œå¹¶è¦†ç›–å…¶æ–¹æ³•ä»¥æä¾›å¢å¼ºçš„åŠŸèƒ½ã€‚</li><li><strong>æ–¹æ³•è°ƒç”¨</strong>ï¼šå½“è°ƒç”¨ä»£ç†å®ä¾‹çš„æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨ç”± CGLIB ç”Ÿæˆçš„å­ç±»ä¸­çš„æ–¹æ³•ã€‚åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œå¯ä»¥åœ¨è°ƒç”¨å®é™…çš„ç›®æ ‡æ–¹æ³•å‰åæ’å…¥è‡ªå®šä¹‰çš„è¡Œä¸ºã€‚</li></ol><p>ä½¿ç”¨åœºæ™¯ä¸é€‰æ‹©</p><ul><li><strong>JDK åŠ¨æ€ä»£ç†</strong>é€‚ç”¨äºç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£çš„æƒ…å†µã€‚ç”±äºåªéœ€ä»£ç†æ¥å£æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼ä¸ä¼šä»£ç†ç±»çš„å±æ€§ï¼Œé€šå¸¸æ€§èƒ½è¾ƒå¥½ã€‚</li><li><strong>CGLIB åŠ¨æ€ä»£ç†</strong>é€‚ç”¨äºç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£çš„æƒ…å†µã€‚å®ƒé€šè¿‡ç”Ÿæˆå­ç±»æ¥å®ç°ä»£ç†ï¼Œæ›´ä¸ºå¼ºå¤§ä½†é€šå¸¸æ¯” JDK åŠ¨æ€ä»£ç†ç•¥æ…¢ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒAOP é€šè¿‡åŠ¨æ€ä»£ç†æŠ€æœ¯æä¾›äº†ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æœºåˆ¶ï¼Œå…è®¸å¼€å‘è€…åœ¨ä¸ä¿®æ”¹åŸå§‹ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¢åŠ é¢å¤–çš„åŠŸèƒ½ã€‚é€šè¿‡ <code>point.getTarget()</code> è·å–åˆ°çš„æ˜¯ä»£ç†è°ƒç”¨ä¸­çš„åŸå§‹å¯¹è±¡ï¼Œç¡®ä¿äº†å³ä½¿åœ¨ä»£ç†ç¯å¢ƒä¸­ï¼Œä¹Ÿèƒ½æ­£ç¡®åœ°å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://www.pdai.tech/md/spring/spring-x-framework-aop.html">https://www.pdai.tech/md/spring/spring-x-framework-aop.html</a></li><li><a href="https://javaguide.cn/system-design/framework/spring/spring-knowledge-and-questions-summary.html#spring-aop">https://javaguide.cn/system-design/framework/spring/spring-knowledge-and-questions-summary.html#spring-aop</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Stream</title>
    <link href="/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Stream/"/>
    <url>/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Stream/</url>
    
    <content type="html"><![CDATA[<p>Stream ç»„ä»¶æ˜¯ç”¨äºå°è£…æ¶ˆæ¯é˜Ÿåˆ—æ¥ä½¿ç”¨çš„ï¼ŒBusè¿™ä¸ªç»„ä»¶ä¸€èˆ¬ä¼šç»“åˆ Stream ä½¿ç”¨ï¼›</p><p>çœ‹ä¸€èˆ¬æ€§æ–‡æ¡£è§£é‡Šï¼Œä¸»è¦æ˜¯å›´ç»• Bus å¯ä»¥åšåˆ°é…ç½®çš„åŠ¨æ€åˆ·æ–°ã€äº‹ä»¶çš„ä¼ é€’ã€‚å…·ä½“ä½¿ç”¨çš„æ—¶å€™å¯ä»¥çœ‹ä¸€ä¸‹ç›¸å…³å†…å®¹ã€‚</p><p>ä¸‹é¢å†…å®¹æ˜¯å¼•ç”¨ ChatGpt çš„å†…å®¹ï¼Œåˆ†åˆ«æ˜¯ Stream å’Œ Bus çš„åŸºæœ¬ä½¿ç”¨ã€‚</p><h3 id="1ã€Spring-Cloud-Streamçš„ä½¿ç”¨"><a href="#1ã€Spring-Cloud-Streamçš„ä½¿ç”¨" class="headerlink" title="1ã€Spring Cloud Streamçš„ä½¿ç”¨"></a>1ã€Spring Cloud Streamçš„ä½¿ç”¨</h3><p>Spring Cloud Stream æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡æ¶æ„çš„æ¡†æ¶ï¼Œå®ƒåŸºäºSpring Bootå’ŒSpring Integrationï¼Œæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥å®ç°å„ä¸ªå¾®æœåŠ¡ç»„ä»¶ä¹‹é—´çš„æ¶ˆæ¯é€šä¿¡ã€‚</p><p>ä»¥ä¸‹æ˜¯Spring Cloud Streamçš„åŸºæœ¬ä½¿ç”¨æ­¥éª¤ï¼š</p><blockquote><ol><li>å¼•å…¥ä¾èµ–</li></ol></blockquote><p>åœ¨é¡¹ç›®çš„ <code>pom.xml</code> æ–‡ä»¶ä¸­ï¼Œæ·»åŠ  Spring Cloud Stream çš„ä¾èµ–ï¼š</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-stream-</span><span class="hljs-template-variable">&#123;binder&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p><code>&#123;binder&#125;</code> å¯ä»¥æ˜¯ä¸åŒçš„æ¶ˆæ¯ä¸­é—´ä»¶çš„åç§°ï¼Œæ¯”å¦‚ RabbitMQã€Kafka ç­‰ã€‚</p><blockquote><ol start="2"><li>é…ç½®æ¶ˆæ¯ä¸­é—´ä»¶</li></ol></blockquote><p>åœ¨ <code>application.properties</code> æˆ– <code>application.yml</code> æ–‡ä»¶ä¸­é…ç½®æ¶ˆæ¯ä¸­é—´ä»¶çš„è¿æ¥ä¿¡æ¯ï¼Œä»¥ RabbitMQ ä¸ºä¾‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">stream:</span><br>      <span class="hljs-attr">bindings:</span><br>        <span class="hljs-attr">output:</span><br>          <span class="hljs-attr">destination:</span> <span class="hljs-string">my-output-topic</span><br>          <span class="hljs-attr">binder:</span> <span class="hljs-string">rabbit</span> <span class="hljs-comment"># RabbitMQçš„binder</span><br>      <span class="hljs-attr">rabbit:</span><br>        <span class="hljs-attr">bindings:</span><br>          <span class="hljs-attr">output:</span><br>            <span class="hljs-attr">exchangeType:</span> <span class="hljs-string">topic</span><br>            <span class="hljs-attr">routingKeyExpression:</span> <span class="hljs-string">&#x27;my-output-topic&#x27;</span><br></code></pre></td></tr></table></figure><blockquote><ol start="3"><li>å‘é€æ¶ˆæ¯</li></ol></blockquote><p>åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <code>Source</code> æ¥å£å®šä¹‰æ¶ˆæ¯å‘é€çš„è¾“å‡ºé€šé“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.cloud.stream.annotation.Output;<br><span class="hljs-keyword">import</span> org.springframework.messaging.MessageChannel;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MySource</span> &#123;<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">OUTPUT</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;output&quot;</span>;<br><br>    <span class="hljs-meta">@Output(OUTPUT)</span><br>    MessageChannel <span class="hljs-title function_">output</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨éœ€è¦å‘é€æ¶ˆæ¯çš„åœ°æ–¹æ³¨å…¥ <code>MySource</code>ï¼Œå¹¶ä½¿ç”¨ <code>output()</code> æ–¹æ³•å‘é€æ¶ˆæ¯ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">messaging</span>.<span class="hljs-property">Message</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">messaging</span>.<span class="hljs-property">support</span>.<span class="hljs-property">MessageBuilder</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageSenderService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">MySource</span> mySource;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> payload</span>) &#123;<br>        <span class="hljs-title class_">Message</span>&lt;<span class="hljs-title class_">String</span>&gt; message = <span class="hljs-title class_">MessageBuilder</span>.<span class="hljs-title function_">withPayload</span>(payload).<span class="hljs-title function_">build</span>();<br>        mySource.<span class="hljs-title function_">output</span>().<span class="hljs-title function_">send</span>(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ol start="4"><li>æ¥æ”¶æ¶ˆæ¯</li></ol></blockquote><p>åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <code>@StreamListener</code> æ³¨è§£å®šä¹‰æ¶ˆæ¯æ¥æ”¶çš„è¾“å…¥é€šé“ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.cloud.stream.<span class="hljs-keyword">annotation</span>.StreamListener;<br><span class="hljs-keyword">import</span> org.springframework.messaging.handler.<span class="hljs-keyword">annotation</span>.Payload;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageReceiverService</span> &#123;<br><br>    <span class="hljs-meta">@StreamListener(MySource.INPUT)</span><br>    <span class="hljs-keyword">public</span> void receiveMessage(<span class="hljs-meta">@Payload</span> String payload) &#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;Received message: &quot;</span> + payload);<br>        <span class="hljs-comment">// å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ol start="5"><li>è¿è¡Œæ—¶ç»‘å®š</li></ol></blockquote><p>Spring Cloud Stream ä¼šåœ¨è¿è¡Œæ—¶å°†æ¶ˆæ¯é€šé“ç»‘å®šåˆ°æ¶ˆæ¯ä¸­é—´ä»¶ä¸Šï¼Œä½¿å¾—æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶å¯ä»¥ä¸åº•å±‚çš„æ¶ˆæ¯ä¸­é—´ä»¶è§£è€¦ã€‚æ ¹æ®é…ç½®çš„ <code>&#123;binder&#125;</code> ä¸åŒï¼Œå¯ä»¥æ”¯æŒ RabbitMQã€Kafkaã€ActiveMQ ç­‰å¤šç§æ¶ˆæ¯ä¸­é—´ä»¶ã€‚</p><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ Spring Cloud Stream åœ¨å¾®æœåŠ¡ä¸­å®ç°æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶ï¼Œä»è€Œæ„å»ºæ¶ˆæ¯é©±åŠ¨çš„å¾®æœåŠ¡æ¶æ„ã€‚</p><h3 id="2ã€SpringCloud-Bus-çš„ä½¿ç”¨"><a href="#2ã€SpringCloud-Bus-çš„ä½¿ç”¨" class="headerlink" title="2ã€SpringCloud Bus çš„ä½¿ç”¨"></a>2ã€SpringCloud Bus çš„ä½¿ç”¨</h3><p>Spring Cloud Busæ˜¯ä¸€ä¸ªç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¼ æ’­äº‹ä»¶çš„å·¥å…·ï¼Œå®ƒå»ºç«‹åœ¨Spring Cloud Streamä¹‹ä¸Šã€‚å®ƒå…è®¸å¾®æœåŠ¡æ¶æ„ä¸­çš„ç»„ä»¶ä¹‹é—´è¿›è¡Œæ¶ˆæ¯æ¨é€ï¼Œå®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°ã€äº‹ä»¶çš„ä¼ é€’ç­‰åŠŸèƒ½ã€‚</p><p>ä»¥ä¸‹æ˜¯Spring Cloud Busçš„åŸºæœ¬ä½¿ç”¨æ­¥éª¤ï¼š</p><blockquote><ol><li>å¼•å…¥ä¾èµ–</li></ol></blockquote><p>åœ¨é¡¹ç›®çš„<code>pom.xml</code>æ–‡ä»¶ä¸­æ·»åŠ Spring Cloud Busçš„ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ç¤ºä¾‹ä¸­ä½¿ç”¨äº†AMQPï¼ˆAdvanced Message Queuing Protocolï¼‰ä½œä¸ºæ¶ˆæ¯ä¼ é€’çš„ä¸­é—´ä»¶ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¦‚Kafkaç­‰ã€‚</p><blockquote><ol start="2"><li>é…ç½®æ¶ˆæ¯ä¸­é—´ä»¶</li></ol></blockquote><p>åœ¨<code>application.properties</code>æˆ–<code>application.yml</code>ä¸­é…ç½®æ¶ˆæ¯ä¸­é—´ä»¶çš„è¿æ¥ä¿¡æ¯ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span><br></code></pre></td></tr></table></figure><blockquote><ol start="3"><li>é…ç½®Bus</li></ol></blockquote><p>åœ¨å¾®æœåŠ¡çš„<code>application.properties</code>æˆ–<code>application.yml</code>ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">bus:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><blockquote><p>4.å‘é€æ¶ˆæ¯</p></blockquote><p>åœ¨ä»»æ„å¾®æœåŠ¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨Spring Cloud Buså‘é€æ¶ˆæ¯æ¥è§¦å‘äº‹ä»¶ã€‚å¯ä»¥ä½¿ç”¨HTTP POSTè¯·æ±‚å‘<code>/actuator/bus-refresh</code>ç«¯ç‚¹å‘é€åˆ·æ–°è¯·æ±‚ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -X POST http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span><span class="hljs-regexp">/actuator/</span>bus-refresh<br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¼šè§¦å‘Spring Cloud Buså‘é€ä¸€ä¸ªåˆ·æ–°äº‹ä»¶ï¼Œç„¶åå„ä¸ªå¾®æœåŠ¡éƒ½ä¼šæ¥æ”¶åˆ°è¿™ä¸ªäº‹ä»¶ï¼Œä»è€Œè§¦å‘é…ç½®çš„åˆ·æ–°æ“ä½œã€‚</p><blockquote><ol start="5"><li>æ¥æ”¶æ¶ˆæ¯</li></ol></blockquote><p>åœ¨å¾®æœåŠ¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>@RefreshScope</code>æ³¨è§£æ ‡è®°ä¸€ä¸ªç±»ï¼Œä½¿å¾—è¯¥ç±»ä¸­çš„é…ç½®åœ¨æ¥æ”¶åˆ°åˆ·æ–°äº‹ä»¶æ—¶èƒ½å¤Ÿé‡æ–°åŠ è½½ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.cloud.context.config.<span class="hljs-keyword">annotation</span>.RefreshScope;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RefreshScope</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyController</span> &#123;<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;my.property&#125;</span>&quot;</span>)</span><br>    <span class="hljs-keyword">private</span> String myProperty;<br><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/property&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> String getProperty() &#123;<br>        <span class="hljs-keyword">return</span> myProperty;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ<code>@RefreshScope</code>æ³¨è§£ä½¿å¾—<code>MyController</code>ç±»ä¸­çš„é…ç½®åœ¨æ¥æ”¶åˆ°åˆ·æ–°äº‹ä»¶æ—¶ä¼šé‡æ–°åŠ è½½ã€‚</p><p>é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨Spring Cloud Buså®ç°åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¼ æ’­äº‹ä»¶ï¼Œä¾‹å¦‚åŠ¨æ€åˆ·æ–°é…ç½®ã€ä¼ é€’æ¶ˆæ¯ç­‰ã€‚</p><p>to be continedâ€¦..</p>]]></content>
    
    
    <categories>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springcloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Seata</title>
    <link href="/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Seata/"/>
    <url>/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Seata/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#1ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"></a>1ã€ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>é¦–å…ˆç†è§£ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¼šç”¨åˆ°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>åœ¨åˆ†å¸ƒå¼æœåŠ¡ä¸­ï¼ŒæœåŠ¡Aä¸­é€šè¿‡feignæ¥è°ƒç”¨æœåŠ¡Bçš„æ–¹æ³•ï¼Œä½†æ˜¯æœåŠ¡Bçš„æ–¹æ³•å¹¶ä¸å½’å±äºæœåŠ¡Açš„äº‹åŠ¡ä½“ç³»ä¸­ï¼Œå› æ­¤å¦‚æœæ­¤æ—¶æœåŠ¡BæŠ¥é”™ï¼Œå¹¶ä¸ä¼šå¯¼è‡´å·²ç»æ‰§è¡Œäº†çš„æœåŠ¡Açš„æ“ä½œå›é€€ã€‚</p><p>æƒ³è¦è®©æœåŠ¡Aå›é€€ï¼Œé‚£ä¹ˆå°±è¦è®©æœåŠ¡Bçº³å…¥åˆ°æœåŠ¡Açš„äº‹åŠ¡ä½“ç³»ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸¤è€…æ˜¯åŒä¸€ä¸ªäº‹åŠ¡IDã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå®ƒ<strong>å¯ä»¥è·¨è¶ŠæœåŠ¡æ¥å®ç°äº‹åŠ¡</strong>ã€‚</p><p>æƒ³è¦å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæˆ‘ä»¬æœ‰å¤šç§æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡åƒredisè¿™æ ·çš„ä¸­é—´ä»¶æ¥å®ç°ã€‚</p><p>ä½†ä¹Ÿå¯ä»¥ç”¨åˆ°æˆ‘ä»¬ä»Šå¤©ä»‹ç»çš„seataç»„ä»¶æ¥å®ç°ã€‚ç”šè‡³å‘å±•è‡³ä»Šï¼Œä¸€èˆ¬æˆ‘ä»¬è°ˆåˆ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒåŸºæœ¬ä¸Šseataå·²ç»æˆäº†æˆ‘ä»¬çš„ä¸äºŒé€‰æ‹©ã€‚</p><h3 id="2ã€Seata-æ˜¯ä»€ä¹ˆ"><a href="#2ã€Seata-æ˜¯ä»€ä¹ˆ" class="headerlink" title="2ã€Seata æ˜¯ä»€ä¹ˆ"></a>2ã€Seata æ˜¯ä»€ä¹ˆ</h3><p>Seata æ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œä¸ºå¾®æœåŠ¡æ¶æ„æä¾›äº†å¼ºä¸€è‡´æ€§çš„åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒã€‚æä¾›äº†å…¨å±€äº‹åŠ¡ç®¡ç†å’Œæœ¬åœ°äº‹åŠ¡åè°ƒçš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨äºç¡®ä¿å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´çš„äº‹åŠ¡æ“ä½œçš„ä¸€è‡´æ€§ï¼›æä¾›äº† ATã€TCCã€SAGAå’ŒXAç­‰å‡ ç§äº‹åŠ¡æ¨¡å¼ã€‚</p><p>å¸¸è§çš„ä¸¤ç§åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ï¼šAT æ¨¡å‹ï¼ˆåŸºäº TCCï¼ŒTry-Confirm-Cancelï¼‰å’Œ TCC æ¨¡å‹ï¼ˆåŸºäºä¸¤é˜¶æ®µæäº¤ï¼‰ã€‚</p><blockquote><p>ATæ¨¡å‹</p></blockquote><p>é»˜è®¤ä½¿ç”¨çš„æ˜¯ ATæ¨¡å¼</p><ol><li>åœ¨ä¸šåŠ¡è¡¨æ‰€åœ¨çš„æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºundo_logçš„è¡¨ï¼Œç”¨äºè®°å½•å›æ»šSQLï¼Œå³ä¸æ‰§è¡ŒSQLç›¸åçš„SQLï¼ˆä¾‹å¦‚ï¼Œæ‰§è¡Œinsertåˆ™å¯¹åº”deleteï¼‰ã€‚</li><li>å½“ä¸šåŠ¡è¡¨æ‰§è¡Œæ“ä½œæ—¶ï¼ŒSeataä¼šè§£ææ‰§è¡Œçš„SQLï¼Œç”Ÿæˆå›æ»šSQLå¹¶å­˜å‚¨åˆ°undo_logè¡¨ä¸­ã€‚</li><li>åœ¨æœ¬åœ°äº‹åŠ¡æäº¤å‰ï¼Œå‘SeataæœåŠ¡ç«¯æ³¨å†Œåˆ†æ”¯ï¼Œç”³è¯·ä¸šåŠ¡è¡¨ä¸­å¯¹åº”æ•°æ®è¡Œçš„å…¨å±€é”ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥æ•°æ®è¿›è¡Œæ›´æ–°æ“ä½œã€‚</li><li>æœ¬åœ°äº‹åŠ¡æäº¤æ—¶ï¼Œä¸šåŠ¡æ•°æ®çš„æ›´æ–°å’Œç”Ÿæˆçš„undo logä¸€èµ·æäº¤ã€‚</li><li>å°†æœ¬åœ°äº‹åŠ¡æ‰§è¡Œç»“æœæŠ¥å‘Šç»™SeataæœåŠ¡ç«¯ï¼Œå¤šä¸ªæœåŠ¡çš„æœ¬åœ°äº‹åŠ¡ä½¿ç”¨ç›¸åŒçš„äº‹åŠ¡IDå’Œåˆ†æ”¯IDè®°å½•åœ¨SeataæœåŠ¡ç«¯ã€‚</li><li>å¦‚æœæŸä¸ªæœ¬åœ°äº‹åŠ¡å‘ç”Ÿé”™è¯¯ï¼ŒSeataæœåŠ¡ç«¯å‘èµ·å¯¹åº”åˆ†æ”¯çš„å›æ»šè¯·æ±‚ã€‚</li><li>åŒæ—¶å¼€å¯æœ¬åœ°äº‹åŠ¡ï¼Œé€šè¿‡äº‹åŠ¡IDå’Œåˆ†æ”¯IDæŸ¥è¯¢undo_logè¡¨ï¼Œæ‰§è¡Œå›æ»šSQLï¼Œå¹¶å°†æ‰§è¡Œç»“æœæŠ¥å‘Šç»™SeataæœåŠ¡ç«¯ã€‚</li><li>å¦‚æœæ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼ŒSeataæœåŠ¡ç«¯ä¼šåœ¨å¯¹åº”åˆ†æ”¯ä¸Šå‘èµ·è¯·æ±‚ï¼Œå¼‚æ­¥æ‰¹é‡åˆ é™¤undo_logè¡¨ä¸­çš„è®°å½•ã€‚</li></ol><p>æ€»ä½“æ¥è¯´ï¼ŒSeataæœåŠ¡ç«¯è®°å½•äº†æ‰€æœ‰æœ¬åœ°äº‹åŠ¡ï¼ŒåŒæ—¶åœ¨æ¯ä¸ªåº“ä¸­è®°å½•äº† undo logã€‚</p><p>å½“å‘ç”Ÿé”™è¯¯æ—¶ï¼Œé€šè¿‡äº‹åŠ¡IDå’Œåˆ†æ”¯IDæ‰¾åˆ°åŒä¸€ç»„çš„æ‰€æœ‰æœ¬åœ°äº‹åŠ¡ï¼Œåˆ©ç”¨è®°å½•çš„undo logç»Ÿä¸€å›é€€æ•°æ®ã€‚</p><h3 id="3ã€ä½¿ç”¨-Seata-çš„åŸºæœ¬æ­¥éª¤"><a href="#3ã€ä½¿ç”¨-Seata-çš„åŸºæœ¬æ­¥éª¤" class="headerlink" title="3ã€ä½¿ç”¨ Seata çš„åŸºæœ¬æ­¥éª¤"></a>3ã€ä½¿ç”¨ Seata çš„åŸºæœ¬æ­¥éª¤</h3><p>seataåˆ†ä¸ºæœåŠ¡ç«¯ï¼ˆTCï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆTM,RMï¼‰,</p><p>å®¢æˆ·ç«¯é€šè¿‡å¼•å…¥jaråŒ…æ¥ä½¿ç”¨ã€‚æœåŠ¡ç«¯éœ€è¦æˆ‘ä»¬å•ç‹¬å®‰è£…ã€‚</p><ul><li>TC(Transaction Coordinator)ï¼šäº‹åŠ¡åè°ƒå™¨ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œåè°ƒå’Œè½å®å…¨å±€äº‹åŠ¡çš„å›æ»šæäº¤</li><li>TM(Transaction Manager)ï¼šæ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šçš„å†³è®®</li><li>RM(Resource Manager)ï¼šæ§åˆ¶åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œã€çŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥å—TCçš„æŒ‡ä»¤ï¼Œé©±åŠ¨æœ¬åœ°äº‹åŠ¡çš„æäº¤å’Œå›æ»š</li></ul><h4 id="1-éƒ¨ç½²-Seata-æœåŠ¡å™¨"><a href="#1-éƒ¨ç½²-Seata-æœåŠ¡å™¨" class="headerlink" title="1. éƒ¨ç½² Seata æœåŠ¡å™¨"></a>1. éƒ¨ç½² Seata æœåŠ¡å™¨</h4><p>æœåŠ¡ç«¯ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/seata/seata/releases">https://github.com/seata/seata/releases</a></p><p>éƒ¨ç½²è¿‡ç¨‹ï¼šç•¥</p><h4 id="2-seataå®¢æˆ·ç«¯é…ç½®"><a href="#2-seataå®¢æˆ·ç«¯é…ç½®" class="headerlink" title="2. seataå®¢æˆ·ç«¯é…ç½®"></a>2. seataå®¢æˆ·ç«¯é…ç½®</h4><p>åœ¨å¾®æœåŠ¡çš„é¡¹ç›®ä¸­ï¼Œæ·»åŠ  Seata çš„ä¾èµ–ã€‚å¦‚æœä½¿ç”¨ Mavenï¼Œå¯ä»¥åœ¨é¡¹ç›®çš„ <code>pom.xml</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.seata<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Â·-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- è¯·æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ç‰ˆæœ¬ --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p><p>åœ¨å¾®æœåŠ¡çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½® Seata å®¢æˆ·ç«¯ã€‚é€šå¸¸éœ€è¦æŒ‡å®š Seata æœåŠ¡å™¨çš„åœ°å€ç­‰ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼š</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">seata:</span><br>  application-id: my-app<br>  tx-service-group: my-tx-group<br><span class="hljs-symbol">  enabled:</span> true<br><span class="hljs-symbol">  config:</span><br><span class="hljs-symbol">    type:</span> nacos<br><span class="hljs-symbol">    nacos:</span><br><span class="hljs-symbol">      serverAddr:</span> nacos-server:<span class="hljs-number">8848</span><br><span class="hljs-symbol">      groupId:</span> SEATA_GROUP<br><span class="hljs-symbol">      namespace:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-symbol">  registry:</span><br><span class="hljs-symbol">    type:</span> nacos<br><span class="hljs-symbol">    nacos:</span><br><span class="hljs-symbol">      serverAddr:</span> nacos-server:<span class="hljs-number">8848</span><br><span class="hljs-symbol">      groupId:</span> SEATA_GROUP<br><span class="hljs-symbol">      namespace:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-symbol">  service:</span><br><span class="hljs-symbol">    vgroup:</span> <span class="hljs-string">&quot;my-tx-group&quot;</span><br><span class="hljs-symbol">    group:</span> <span class="hljs-string">&quot;my-tx-group&quot;</span><br></code></pre></td></tr></table></figure><h4 id="æ·»åŠ äº‹åŠ¡æ³¨è§£"><a href="#æ·»åŠ äº‹åŠ¡æ³¨è§£" class="headerlink" title="æ·»åŠ äº‹åŠ¡æ³¨è§£"></a>æ·»åŠ äº‹åŠ¡æ³¨è§£</h4><p>ä½¿ç”¨ @GlobalTransactional æ³¨è§£</p><p>åœ¨éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹æ³•ä¸Šï¼Œä½¿ç”¨ <code>@GlobalTransactional</code> æ³¨è§£æ ‡è®°ã€‚è¿™ä¸ªæ³¨è§£è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•éœ€è¦å‚ä¸å…¨å±€äº‹åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> io.seata.spring.annotation.GlobalTransactional;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> &#123;<br><br>    <span class="hljs-meta">@GlobalTransactional(rollbackFor = Exception.class)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">businessMethod</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/github_38592071/article/details/131136986">https://blog.csdn.net/github_38592071/article/details/131136986</a></li><li><a href="https://juejin.cn/post/7087551217781620749">https://juejin.cn/post/7087551217781620749</a></li><li><a href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springcloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_OpenFeign</title>
    <link href="/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_OpenFeign/"/>
    <url>/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_OpenFeign/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€æœåŠ¡è°ƒç”¨"><a href="#1ã€æœåŠ¡è°ƒç”¨" class="headerlink" title="1ã€æœåŠ¡è°ƒç”¨"></a>1ã€æœåŠ¡è°ƒç”¨</h3><h4 id="æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡è°ƒç”¨"><a href="#æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡è°ƒç”¨" class="headerlink" title="æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡è°ƒç”¨"></a>æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡è°ƒç”¨</h4><p>åœ¨Spring Cloud Alibabaç”Ÿæ€ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡è°ƒç”¨çš„æ ¸å¿ƒç»„ä»¶æ˜¯ <strong>Nacos Discovery</strong> å’Œ <strong>Feign</strong>ã€‚</p><blockquote><p>Nacos Discovery</p></blockquote><p>Nacosæ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†å¹³å°ï¼Œå®ƒæä¾›äº†æœåŠ¡æ³¨å†Œä¸å‘ç°çš„åŠŸèƒ½ï¼Œå¯ä»¥è®©å¾®æœåŠ¡åº”ç”¨åœ¨æ³¨å†Œåˆ°Nacosæ³¨å†Œä¸­å¿ƒåï¼Œæ–¹ä¾¿åœ°å‘ç°å…¶ä»–æœåŠ¡ï¼Œå¹¶å®ç°æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ã€‚é€šè¿‡Nacos Discoveryï¼ŒæœåŠ¡ä¹‹é—´çš„å…³ç³»å’Œä½ç½®ä¿¡æ¯èƒ½å¤Ÿå¾—åˆ°ç»´æŠ¤ï¼Œå®ç°äº†æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°ã€‚</p><blockquote><p>Feign</p></blockquote><p>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„WebæœåŠ¡å®¢æˆ·ç«¯ï¼Œå®ƒç®€åŒ–äº†æœåŠ¡è°ƒç”¨çš„è¿‡ç¨‹ã€‚é€šè¿‡åœ¨æ¥å£ä¸Šæ·»åŠ æ³¨è§£ï¼ŒFeignèƒ½å¤Ÿè‡ªåŠ¨æ„é€ HTTPè¯·æ±‚å¹¶å°†å…¶å‘é€åˆ°æœåŠ¡æä¾›æ–¹ã€‚åœ¨Spring Cloud Alibabaä¸­ï¼ŒFeignä¸Nacos Discoveryé›†æˆï¼Œå¯ä»¥ä½¿ç”¨Feignæ¥å‘èµ·æœåŠ¡è°ƒç”¨ï¼Œè€ŒNacos Discoveryåˆ™ç”¨äºæœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ã€‚</p><h4 id="å¾®æœåŠ¡é—´çš„è°ƒç”¨æ–¹å¼"><a href="#å¾®æœåŠ¡é—´çš„è°ƒç”¨æ–¹å¼" class="headerlink" title="å¾®æœåŠ¡é—´çš„è°ƒç”¨æ–¹å¼"></a>å¾®æœåŠ¡é—´çš„è°ƒç”¨æ–¹å¼</h4><blockquote><p>å¾®æœåŠ¡è°ƒç”¨</p></blockquote><p>å¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡æ–¹å¼å¸¸è§çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">RPC</span> ä»£è¡¨ï¼šdubbo  <br>HTTP ä»£è¡¨ï¼šSpringCloud<br></code></pre></td></tr></table></figure><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæœ€å¸¸è§çš„åœºæ™¯å°±æ˜¯å¾®æœåŠ¡é—´çš„ç›¸äº’è°ƒç”¨ã€‚</p><p>åœ¨ SpringCloud ä¸­ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨ HTTP  æ¥è¿›è¡Œå¾®æœåŠ¡çš„é€šä¿¡ï¼Œå¾®æœåŠ¡é—´çš„ç›¸äº’è°ƒç”¨æ–¹å¼ä¸»è¦æœ‰<code>RestTemplate</code>ã€<code>Feign</code>Â ã€å’Œ<code>OpenFeign</code></p><blockquote><p>RestTemplate</p></blockquote><p>RestTemplate æ˜¯ä» Spring3.0 å¼€å§‹æ”¯æŒçš„ä¸€ä¸ª http è¯·æ±‚å·¥å…·ï¼Œè¿™ä¸ªè¯·æ±‚å·¥å…·æ˜¯ Spring è‡ªå¸¦çš„</p><p>RestTemplate æä¾›äº†å¸¸è§çš„ REST è¯·æ±‚æ–¹æ³•æ¨¡æ¿ï¼Œå¦‚ GETã€POSTã€PUTã€DELETE è¯·æ±‚ä»¥åŠä¸€äº›é€šç”¨çš„è¯·æ±‚æ‰§è¡Œæ–¹æ³• exchange å’Œ execute æ–¹æ³•</p><blockquote><p>Feign</p></blockquote><p>Feign æ˜¯ Spring Cloud ç»„ä»¶ä¸­çš„ä¸€ä¸ª<code>å£°æ˜å¼</code>çš„<code>è½»é‡çº§ RESTful çš„ HTTP æœåŠ¡å®¢æˆ·ç«¯</code></p><p>Feign å†…ç½®äº† Ribbonï¼Œç”¨æ¥åš<code>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</code>ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ï¼›</p><blockquote><p>OpenFeign</p></blockquote><p>OpenFeign æ˜¯ Spring Cloud åœ¨ Feign çš„åŸºç¡€ä¸Šæ”¯æŒ SpringMVC çš„æ³¨è§£ï¼Œå¦‚ @RequesMapping ç­‰ç­‰ã€‚</p><p>OpenFeign çš„ @FeignClient å¯ä»¥è§£æ SpringMVC çš„ @RequestMapping æ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡</p><blockquote><p>OpenFeign å’Œ Feign ç»„ä»¶çš„åŒºåˆ«å’Œå…³è”</p></blockquote><p>OpenFeign æ˜¯ Feign çš„å¢å¼ºç‰ˆï¼Œå®ƒæ˜¯ Spring Cloud å¯¹ Feign è¿›è¡Œäº†æ‰©å±•å’Œä¼˜åŒ–çš„ç»“æœã€‚è™½ç„¶ä¸¤è€…æœ‰å…³è”ï¼Œä½†åœ¨ä¸€äº›åŠŸèƒ½å’Œä½¿ç”¨ä¸Šå­˜åœ¨ä¸€äº›åŒºåˆ«ã€‚</p><p><strong>Feign:</strong></p><ul><li>Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„WebæœåŠ¡å®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–æœåŠ¡è°ƒç”¨çš„è¿‡ç¨‹ã€‚</li><li>å®ƒåŸºäºæ¥å£å®šä¹‰ï¼Œé€šè¿‡æ·»åŠ æ³¨è§£ï¼Œå¯ä»¥è½»æ¾åœ°å‘èµ·HTTPè¯·æ±‚ã€‚</li><li>åœ¨åŸå§‹çš„ Spring Cloud ä¸­ï¼ŒFeign çš„é»˜è®¤å®ç°ä¸æ”¯æŒ Spring MVC æ³¨è§£ï¼Œå› æ­¤ä½¿ç”¨èµ·æ¥æœ‰ä¸€äº›é™åˆ¶ã€‚</li></ul><p><strong>OpenFeign:</strong></p><ul><li>OpenFeign æ˜¯å¯¹ Feign çš„å¢å¼ºï¼Œå®ƒå¼•å…¥äº†å¯¹ Spring MVC æ³¨è§£çš„æ”¯æŒï¼Œä½¿å¾— Feign åœ¨ä½¿ç”¨ä¸Šæ›´åŠ çµæ´»ã€‚</li><li>OpenFeign æä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ç»§æ‰¿æ€§ã€æ”¯æŒ Spring Cloud Contractã€æ”¯æŒå¤šéƒ¨åˆ†è¯·æ±‚å’Œå“åº”ç­‰ã€‚</li><li>OpenFeign å¯ä»¥é€šè¿‡ <code>@FeignClient</code> æ³¨è§£çš„ <code>contextId</code> å±æ€§æ¥å®ç°å¤šä¸ª Feign å®¢æˆ·ç«¯å®ä¾‹ä¹‹é—´çš„éš”ç¦»ã€‚</li></ul><p>åœ¨Spring Cloudé¡¹ç›®ä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨ <code>@FeignClient</code> æ³¨è§£ï¼Œå®é™…ä¸Šé»˜è®¤æ˜¯ä½¿ç”¨çš„ OpenFeignã€‚</p><p>Spring Cloud åœ¨ Hoxton.RELEASE ç‰ˆæœ¬ä¹‹å<strong>é»˜è®¤ä½¿ç”¨ OpenFeignï¼Œè€Œä¸æ˜¯åŸå§‹çš„ Feignã€‚</strong></p><p>å…³äºä½¿ç”¨ <code>@FeignClient</code> æ³¨è§£åˆ›å»º Feign å®¢æˆ·ç«¯çš„ä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@FeignClient(name = <span class="hljs-string">&quot;example-service&quot;</span>, url = <span class="hljs-string">&quot;http://example.com&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ExampleFeignClient</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/hello&quot;</span>)</span><br>    String hello();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œ<code>@FeignClient</code> æ³¨è§£æŒ‡å®šäº†æœåŠ¡çš„åç§°å’ŒURLï¼Œ<code>ExampleFeignClient</code> æ¥å£å®šä¹‰äº†æœåŠ¡è°ƒç”¨çš„å¥‘çº¦ã€‚é€šè¿‡æ·»åŠ  <code>@GetMapping</code> æ³¨è§£ï¼Œå®ç°äº†å¯¹æœåŠ¡æä¾›è€…çš„ <code>/hello</code> æ¥å£çš„è°ƒç”¨ã€‚</p><p>æ€»ä½“è€Œè¨€ï¼ŒOpenFeign æ˜¯å¯¹ Feign çš„å¢å¼ºç‰ˆæœ¬ï¼Œæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œæ›´å¥½çš„çµæ´»æ€§ï¼Œè€Œåœ¨ Spring Cloud ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸é€šè¿‡ <code>@FeignClient</code> æ³¨è§£æ¥ä½¿ç”¨ OpenFeignã€‚</p><h3 id="2ã€OpenFeign-çš„ä½¿ç”¨"><a href="#2ã€OpenFeign-çš„ä½¿ç”¨" class="headerlink" title="2ã€OpenFeign çš„ä½¿ç”¨"></a>2ã€OpenFeign çš„ä½¿ç”¨</h3><h4 id="FeignClientçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•"><a href="#FeignClientçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•" class="headerlink" title="@FeignClientçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•"></a><code>@FeignClient</code>çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•</h4><p><code>@FeignClient</code> æ˜¯ Spring Cloud ä¸­ç”¨äºå£°æ˜å¼RESTå®¢æˆ·ç«¯çš„æ³¨è§£ã€‚é€šè¿‡ä½¿ç”¨è¯¥æ³¨è§£ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œè€Œä¸éœ€è¦å®ç°è¯¥æ¥å£ï¼ŒSpring Cloudä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆè¯¥æ¥å£çš„å®ç°ç±»ï¼Œç”¨äºå‘èµ·æœåŠ¡é—´çš„HTTPè¯·æ±‚ã€‚</p><p>ä»¥ä¸‹æ˜¯<code>@FeignClient</code>çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼š</p><blockquote><p><strong>ç®€å•ä½¿ç”¨ï¼š</strong></p></blockquote><p>åœ¨ä¸€ä¸ªæ¥å£ä¸Šæ·»åŠ  <code>@FeignClient</code> æ³¨è§£ï¼Œå¹¶æŒ‡å®šè¦è°ƒç”¨çš„æœåŠ¡åç§°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;<br><br><span class="hljs-meta">@FeignClient(name = <span class="hljs-string">&quot;example-service&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ExampleFeignClient</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/hello&quot;</span>)</span><br>    String hello();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œ<code>ExampleFeignClient</code> æ¥å£ç”¨äºè°ƒç”¨åä¸º â€œexample-serviceâ€ çš„å¾®æœåŠ¡ï¼Œå…¶ä¸­ <code>@GetMapping(&quot;/hello&quot;)</code> å®šä¹‰äº†è°ƒç”¨æœåŠ¡çš„è·¯å¾„ã€‚</p><blockquote><p>æŒ‡å®š URL</p></blockquote><p>å¯ä»¥é€šè¿‡ <code>url</code> å±æ€§æŒ‡å®šæœåŠ¡çš„URLï¼Œè€Œä¸æ˜¯é€šè¿‡æœåŠ¡åç§°è¿›è¡Œè°ƒç”¨ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@FeignClient(name = <span class="hljs-string">&quot;example-service&quot;</span>, url = <span class="hljs-string">&quot;http://example.com&quot;</span>)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ExampleFeignClient</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/hello&quot;</span>)</span><br>    String hello();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡çš„URLè¢«ç¡¬ç¼–ç ä¸º â€œ<a href="http://example.com"./">http://example.com&quot;ã€‚</a></p><blockquote><p><strong>æŒ‡å®šFallback</strong></p></blockquote><p>å¯ä»¥é€šè¿‡ <code>fallback</code> å±æ€§æŒ‡å®šä¸€ä¸ªå®ç°äº† <code>ExampleFeignClient</code> æ¥å£çš„ç±»ï¼Œä½œä¸ºè°ƒç”¨å¤±è´¥æ—¶çš„é™çº§å¤„ç†ã€‚</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta">@FeignClient</span>(name = <span class="hljs-string">&quot;example-service&quot;</span>, fallback = ExampleFeignClientFallback.class)<br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">interface</span> <span class="hljs-title">ExampleFeignClient</span> </span>&#123;<br><br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/hello&quot;</span>)<br>    <span class="hljs-keyword">String</span> hello();<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleFeignClientFallback</span> <span class="hljs-keyword"><span class="hljs-keyword">implements</span> <span class="hljs-type">ExampleFeignClient</span></span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> hello() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Fallback Hello&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“è°ƒç”¨æœåŠ¡å¤±è´¥æ—¶ï¼Œä¼šæ‰§è¡Œ <code>ExampleFeignClientFallback</code> ä¸­çš„é€»è¾‘ã€‚</p><blockquote><p><strong>æŒ‡å®šDecoderå’ŒEncoder</strong></p></blockquote><p>å¯ä»¥é€šè¿‡ <code>decoder</code> å’Œ <code>encoder</code> å±æ€§æŒ‡å®šè‡ªå®šä¹‰çš„è§£ç å™¨å’Œç¼–ç å™¨ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@FeignClient(name = <span class="hljs-string">&quot;example-service&quot;</span>, decoder = MyDecoder.class, encoder = MyEncoder.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ExampleFeignClient</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/hello&quot;</span>)</span><br>    String hello();<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyDecoder</code> å’Œ <code>MyEncoder</code> åˆ†åˆ«æ˜¯è‡ªå®šä¹‰çš„è§£ç å™¨å’Œç¼–ç å™¨ã€‚</p><p>è¿™äº›æ˜¯ <code>@FeignClient</code> æ³¨è§£çš„åŸºæœ¬ç”¨æ³•ï¼Œé€šè¿‡çµæ´»ä½¿ç”¨è¿™äº›å±æ€§ï¼Œå¯ä»¥å®ç°æ›´å¤šå®šåˆ¶åŒ–çš„æœåŠ¡è°ƒç”¨é…ç½®ã€‚</p><p>to be continuedâ€¦.</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/IT__learning/article/details/116349843">https://blog.csdn.net/IT__learning/article/details/116349843</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springcloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Gateway</title>
    <link href="/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Gateway/"/>
    <url>/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Gateway/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€å¾®æœåŠ¡ç½‘å…³æ˜¯ä»€ä¹ˆ"><a href="#1ã€å¾®æœåŠ¡ç½‘å…³æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€å¾®æœåŠ¡ç½‘å…³æ˜¯ä»€ä¹ˆ"></a>1ã€å¾®æœåŠ¡ç½‘å…³æ˜¯ä»€ä¹ˆ</h3><p>å¾®æœåŠ¡ç½‘å…³æ˜¯ä¸€ä¸ªä½äºå¾®æœåŠ¡æ¶æ„å‰ç«¯çš„æœåŠ¡ï¼Œä½œä¸ºå®¢æˆ·ç«¯å’Œåç«¯å¾®æœåŠ¡ä¹‹é—´çš„ä¸­ä»‹ã€‚å®ƒçš„ä½œç”¨æ˜¯é›†ä¸­å¤„ç†å’Œç®¡ç†å¾®æœåŠ¡ç³»ç»Ÿçš„ä¸€äº›å…±äº«çš„éä¸šåŠ¡åŠŸèƒ½ï¼Œæä¾›ç»Ÿä¸€çš„å…¥å£ï¼ŒåŒæ—¶å¯ä»¥è¿›è¡Œè·¯ç”±ã€è½¬å‘ã€è¿‡æ»¤ã€ç›‘æ§ç­‰æ“ä½œã€‚</p><blockquote><p>Gateway çš„åŸºæœ¬åŠŸèƒ½</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312041349886.png" alt="image.png"></p><ol><li><strong>è·¯ç”±è½¬å‘ï¼š</strong><ul><li>ç½‘å…³è´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ ¹æ®é…ç½®çš„è·¯ç”±è§„åˆ™å°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„å¾®æœåŠ¡ã€‚è¿™æœ‰åŠ©äºå®ç°å‰åç«¯çš„è§£è€¦ï¼Œä½¿å¾—å¾®æœåŠ¡å¯ä»¥ç‹¬ç«‹æ¼”è¿›ã€‚</li></ul></li><li><strong>æµé‡æ§åˆ¶ï¼š</strong><ul><li>ç½‘å…³å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œæµé‡æ§åˆ¶ï¼Œé™åˆ¶æ¯ä¸ªå¾®æœåŠ¡çš„è®¿é—®é¢‘ç‡ï¼Œé˜²æ­¢æŸä¸ªå¾®æœåŠ¡è¢«è¿‡åº¦è¯·æ±‚è€Œå½±å“æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</li></ul></li><li><strong>ç†”æ–­ä¿æŠ¤ï¼š</strong><ul><li>ç½‘å…³å¯ä»¥å®ç°ç†”æ–­ä¿æŠ¤ï¼Œå½“æŸä¸ªå¾®æœåŠ¡å‡ºç°æ•…éšœæˆ–è¶…æ—¶æ—¶ï¼Œç½‘å…³å¯ä»¥å¿«é€Ÿæ‹¦æˆªè¯·æ±‚ï¼Œé¿å…è¯·æ±‚å †ç§¯å¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„å´©æºƒã€‚Sentinelæ˜¯ä¸€ç§ä¸“æ³¨äºæµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤çš„å¼€æºæ¡†æ¶ï¼Œå®ƒæä¾›äº†æ›´ä¸°å¯Œçš„ç†”æ–­ä¿æŠ¤åŠŸèƒ½ï¼Œå› æ­¤æœ‰äº›é¡¹ç›®é€‰æ‹©å¼•å…¥Sentinelæ¥å¢å¼ºç†”æ–­ä¿æŠ¤èƒ½åŠ›ã€‚</li></ul></li><li><strong>æ—¥å¿—ç›‘æ§ï¼š</strong><ul><li>ç½‘å…³é€šå¸¸ä¼šè®°å½•è¯·æ±‚å’Œå“åº”çš„æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æœ‰åŠ©äºè¿›è¡Œç³»ç»Ÿçš„ç›‘æ§å’Œæ•…éšœæ’æŸ¥ã€‚ä¸šåŠ¡æ—¥å¿—å’Œé“¾è·¯è¿½è¸ªä¹Ÿæ˜¯é‡è¦çš„ç›‘æ§æ‰‹æ®µã€‚</li></ul></li><li><strong>å®‰å…¨è®¤è¯ï¼š</strong><ul><li>ç½‘å…³å¯ä»¥æä¾›å®‰å…¨è®¤è¯æœºåˆ¶ï¼Œç¡®ä¿åªæœ‰ç»è¿‡è®¤è¯å’Œæˆæƒçš„ç”¨æˆ·æ‰èƒ½è®¿é—®å¾®æœåŠ¡ã€‚è¿™å¯ä»¥é€šè¿‡é›†æˆæ¡†æ¶ï¼ˆå¦‚Spring Securityï¼‰æˆ–ä½¿ç”¨ä¸“é—¨çš„è®¤è¯æœåŠ¡æ¥å®ç°ã€‚</li></ul></li></ol><blockquote><p>å…³äº Gateway çš„ç†”æ–­ä¿æŠ¤åŠŸèƒ½çš„è¯´æ˜</p></blockquote><p>Spring Cloud Gatewayè‡ªèº«å…·å¤‡åŸºæœ¬çš„ç†”æ–­ä¿æŠ¤æœºåˆ¶ï¼Œå¯ä»¥åœ¨é…ç½®ä¸­è®¾ç½®æ–­è·¯å™¨çš„ä¸€äº›å‚æ•°ï¼Œä½†ç›¸å¯¹ç®€å•ã€‚å¯¹äºä¸€äº›æ›´å¤æ‚çš„ç†”æ–­ã€é™æµã€é™çº§ç­‰åœºæ™¯ï¼Œå¯èƒ½éœ€è¦å¼•å…¥ä¸“é—¨çš„æ¡†æ¶å¦‚Sentinelã€‚</p><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚æ¥é€‰æ‹©æ˜¯å¦å¼•å…¥Sentinelã€‚å¦‚æœé¡¹ç›®å¯¹ç†”æ–­ä¿æŠ¤ç­‰åŠŸèƒ½çš„éœ€æ±‚ç›¸å¯¹ç®€å•ï¼ŒGatewayçš„åŸºæœ¬ç†”æ–­ä¿æŠ¤è¶³å¤Ÿä½¿ç”¨ã€‚å¦‚æœéœ€è¦æ›´å¤æ‚çš„æµé‡æ§åˆ¶å’Œç†”æ–­é™çº§ç­–ç•¥ï¼Œå¼•å…¥Sentinelå¯èƒ½ä¼šæ›´ä¸ºåˆé€‚ã€‚</p><blockquote><p>æœåŠ¡ç½‘å…³å’Œæµé‡ç½‘å…³çš„åŒºåˆ«</p></blockquote><p>å¯¹äº Nginx å’Œ Gateway çš„ä¸¤è€…åŒºåˆ«ï¼š</p><p>æµé‡ç½‘å…³ï¼ˆå¦‚Nignx)æä¾›å…¨å±€æ€§çš„ã€ä¸åç«¯ä¸šåŠ¡åº”ç”¨æ— å…³çš„ç­–ç•¥ï¼Œä¾‹å¦‚ HTTPSè¯ä¹¦å¸è½½ã€Webé˜²ç«å¢™ã€å…¨å±€æµé‡ç›‘æ§ç­‰ã€‚</p><p>å¾®æœåŠ¡ç½‘å…³ï¼ˆå¦‚Spring Cloud Gatewayï¼‰æ˜¯æŒ‡ä¸ä¸šåŠ¡ç´§è€¦åˆçš„ã€æä¾›å•ä¸ªä¸šåŠ¡åŸŸçº§åˆ«çš„ç­–ç•¥ï¼Œå¦‚æœåŠ¡æ²»ç†ã€èº«ä»½è®¤è¯ç­‰ã€‚</p><p>æµé‡ç½‘å…³è´Ÿè´£å—åŒ—å‘æµé‡è°ƒåº¦åŠå®‰å…¨é˜²æŠ¤ï¼Œå¾®æœåŠ¡ç½‘å…³è´Ÿè´£ä¸œè¥¿å‘æµé‡è°ƒåº¦åŠæœåŠ¡æ²»ç†ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202312041354467.png" alt="image.png|400"></p><h4 id="ç‰ˆæœ¬åŒºåˆ†"><a href="#ç‰ˆæœ¬åŒºåˆ†" class="headerlink" title="ç‰ˆæœ¬åŒºåˆ†"></a>ç‰ˆæœ¬åŒºåˆ†</h4><ul><li><strong>2.0.x ç‰ˆæœ¬</strong>ï¼šå¼•å…¥äº†åŸºäºWebFluxçš„ååº”å¼ç¼–ç¨‹æ¨¡å‹ï¼Œä¸å†ä½¿ç”¨ä¼ ç»Ÿçš„Servlet APIã€‚æä¾›äº†åŸºæœ¬çš„è·¯ç”±ã€è¿‡æ»¤åŠŸèƒ½ã€‚</li><li><strong>2.1.x ç‰ˆæœ¬</strong>ï¼šå¢åŠ äº†å¯¹WebSocketçš„æ”¯æŒï¼Œæ”¹è¿›äº†è·¯ç”±æ–­è¨€å’Œè¿‡æ»¤å™¨çš„åŠŸèƒ½ã€‚</li><li><strong>2.2.x ç‰ˆæœ¬</strong>ï¼šå¼•å…¥äº†æ›´å¤šçš„è·¯ç”±æ–­è¨€å’Œè¿‡æ»¤å™¨ï¼Œå¢å¼ºäº†å®‰å…¨æ€§å’Œå¯ç®¡ç†æ€§ã€‚</li><li><strong>3.0.x ç‰ˆæœ¬</strong>ï¼šæ›´æ–°äº†åº•å±‚çš„Spring Bootå’ŒSpring Frameworkçš„ç‰ˆæœ¬ï¼Œæ”¯æŒæœ€æ–°çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</li></ul><p>ä¸€èˆ¬è¯´æˆ‘ä»¬å¸¸è§çš„æ˜¯2.2 ç‰ˆæœ¬å°±è¡Œ</p><h3 id="2ã€Gateway-çš„æ­å»ºå’Œä½¿ç”¨"><a href="#2ã€Gateway-çš„æ­å»ºå’Œä½¿ç”¨" class="headerlink" title="2ã€Gateway çš„æ­å»ºå’Œä½¿ç”¨"></a>2ã€Gateway çš„æ­å»ºå’Œä½¿ç”¨</h3><blockquote><p>ç½‘å…³çš„æ­å»º</p></blockquote><p>ç•¥</p><blockquote><p>Spring Cloud Gateway çš„é…ç½®é¡¹</p></blockquote><p>Spring Cloud Gatewayçš„æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬è·¯ç”±ï¼ˆRouteï¼‰ã€æ–­è¨€ï¼ˆPredicateï¼‰å’Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰ã€‚</p><p>è¿™äº›æ¦‚å¿µå…±åŒæ„æˆäº†Gatewayçš„åŸºç¡€ï¼Œç”¨äºå®šä¹‰è¯·æ±‚çš„è·¯ç”±è§„åˆ™ã€è¯·æ±‚çš„åŒ¹é…æ¡ä»¶å’Œè¯·æ±‚çš„å¤„ç†æµç¨‹ã€‚</p><blockquote><p>è·¯ç”±</p></blockquote><p>è·¯ç”±å®šä¹‰äº†è¯·æ±‚åº”è¯¥è¢«å®šå‘åˆ°å“ªä¸ªç›®æ ‡æœåŠ¡ã€‚æ¯ä¸ªè·¯ç”±éƒ½åŒ…å«ä¸€ä¸ªå”¯ä¸€çš„IDã€ç›®æ ‡URIã€ä¸€ç»„æ–­è¨€å’Œè¿‡æ»¤å™¨ã€‚é€šè¿‡é…ç½®å¤šä¸ªè·¯ç”±ï¼Œå¯ä»¥å®ç°å¯¹è¯·æ±‚çš„åŠ¨æ€è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ã€‚</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">spring</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">cloud</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">gateway</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">routes</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">id: example</span><br>          <span class="hljs-attribute">uri</span><span class="hljs-punctuation">:</span> <span class="hljs-string">http://example.com</span><br>          <span class="hljs-attribute">predicates</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/example/**</span><br>          <span class="hljs-attribute">filters</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=1</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®è¡¨ç¤ºå°†ä»¥<code>/example/**</code>è·¯å¾„å¼€å¤´çš„è¯·æ±‚è½¬å‘åˆ°<code>http://example.com</code>ï¼Œå¹¶åœ¨è½¬å‘æ—¶å»æ‰è·¯å¾„çš„ç¬¬ä¸€ä¸ªæ®µï¼ˆStripPrefix&#x3D;1ï¼‰ã€‚</p><blockquote><p>æ–­è¨€</p></blockquote><p>æ–­è¨€å®šä¹‰äº†è¯·æ±‚åŒ¹é…çš„æ¡ä»¶ï¼Œå½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå¯¹åº”çš„è·¯ç”±è§„åˆ™ç”Ÿæ•ˆã€‚æ–­è¨€å¯ä»¥åŸºäºè¯·æ±‚çš„è·¯å¾„ã€æ–¹æ³•ã€å¤´éƒ¨ä¿¡æ¯ç­‰è¿›è¡ŒåŒ¹é…ã€‚</p><blockquote><p>è¿‡æ»¤å™¨</p></blockquote><p>è¿‡æ»¤å™¨æ˜¯å¤„ç†è¯·æ±‚å’Œå“åº”çš„é€»è¾‘çš„ç»„ä»¶ï¼Œå®ƒä»¬å¯ä»¥ä¿®æ”¹è¯·æ±‚å’Œå“åº”ï¼Œå®ç°ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚æ·»åŠ å¤´ä¿¡æ¯ã€ä¿®æ”¹è¯·æ±‚ä½“ã€è¿›è¡Œè®¤è¯ç­‰</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">spring</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">cloud</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">gateway</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">routes</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">id: example</span><br>          <span class="hljs-attribute">uri</span><span class="hljs-punctuation">:</span> <span class="hljs-string">http://example.com</span><br>          <span class="hljs-attribute">predicates</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/example/**</span><br>          <span class="hljs-attribute">filters</span><span class="hljs-punctuation">:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=1</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">AddRequestHeader=X-Header=foo</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®ä¸­çš„è¿‡æ»¤å™¨<code>AddRequestHeader=X-Header=foo</code>è¡¨ç¤ºåœ¨è½¬å‘è¯·æ±‚å‰ï¼Œå‘è¯·æ±‚å¤´ä¸­æ·»åŠ ä¸€ä¸ªåä¸º<code>X-Header</code>çš„å¤´ï¼Œå…¶å€¼ä¸º<code>foo</code>ã€‚</p><blockquote><p>Gatewayé›†æˆ nacos æ³¨å†Œä¸­å¿ƒå®ç°æœåŠ¡å‘ç°</p></blockquote><p>ç•¥</p><blockquote><p>Gateway æ•´åˆ Apollo å®ç°åŠ¨æ€è·¯ç”±é…ç½®</p></blockquote><p>ç•¥</p><blockquote><p>è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†å™¨</p></blockquote><p>to be continedâ€¦.</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/yao583224426/article/details/122216804">https://blog.csdn.net/yao583224426/article/details/122216804</a></li><li><a href="https://cloud.tencent.com/developer/article/2135737">https://cloud.tencent.com/developer/article/2135737</a></li><li><a href="https://spring.io/projects/spring-cloud-gateway">https://spring.io/projects/spring-cloud-gateway</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springcloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Sentinel</title>
    <link href="/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Sentinel/"/>
    <url>/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Sentinel/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨ç±»ä¼¼äº Sleuthï¼Œåœ¨å¯¹åº”æœåŠ¡æ·»åŠ ä¾èµ–å’Œæ³¨è§£é…ç½®åï¼ŒSentinel èƒ½å¤Ÿå¯¹æœåŠ¡åšä¸€ä¸ªæœåŠ¡æµé‡ç›‘å¬ï¼Œè¿›è¡Œç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ç­‰æ“ä½œã€‚</p><p><strong>Sentinel æ§åˆ¶å°çš„ä¸‹è½½</strong></p><p>ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/alibaba/Sentinel/releases/tag/1.8.3">https://github.com/alibaba/Sentinel/releases/tag/1.8.3</a></p><p>æ³¨æ„çš„ä¸€äº›å†…å®¹</p><ul><li>æ³¨è§£ä½¿ç”¨ï¼ˆæœåŠ¡ç¨‹åºä¸­ä½¿ç”¨ï¼‰</li><li>æµæ§è§„åˆ™</li><li>ç†”æ–­è§„åˆ™</li><li>ç³»ç»Ÿè§„åˆ™</li></ul><p>åŸºæœ¬å­¦ä¹ å’Œä½¿ç”¨ï¼š <a href="https://blog.csdn.net/Adda_Chen/article/details/126694546">https://blog.csdn.net/Adda_Chen/article/details/126694546</a></p><p>Sentinel å¯ä»¥ç®€å•çš„åˆ†ä¸º Sentinel æ ¸å¿ƒåº“å’Œ Dashboardæ§åˆ¶å°ã€‚æ ¸å¿ƒåº“ä¸ä¾èµ– Dashboardï¼Œä½†æ˜¯ç»“åˆ Dashboard å¯ä»¥å–å¾—æœ€å¥½çš„æ•ˆæœã€‚</p><p>æˆ‘ä»¬è¯´çš„èµ„æºï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼ŒæœåŠ¡ï¼ŒæœåŠ¡é‡Œçš„æ–¹æ³•ï¼Œç”šè‡³æ˜¯ä¸€æ®µä»£ç ã€‚ä½¿ç”¨ Sentinel æ¥è¿›è¡Œèµ„æºä¿æŠ¤ï¼Œä¸»è¦åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤:</p><ul><li>å®šä¹‰èµ„æº</li><li>å®šä¹‰è§„åˆ™</li><li>æ£€éªŒè§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ</li></ul><p>ç­‰å®é™…ä½¿ç”¨å†çœ‹ä¸€ä¸‹å…·ä½“ä½¿ç”¨ç¤ºä¾‹</p><hr><p>Sentinel æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾é¢å‘åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„é«˜å¯ç”¨æ€§ä¿éšœç»„ä»¶ï¼Œä¸»è¦ç”¨äºæµé‡æ§åˆ¶ï¼ˆé™æµï¼‰ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰ï¼Œä»¥ä¿éšœå¾®æœåŠ¡æˆ–åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»å¤šä¸ªç»´åº¦ç›‘æ§ã€è®°å½•å’Œå¤„ç†æœåŠ¡è°ƒç”¨æƒ…å†µï¼Œæ”¯æŒä¸°å¯Œçš„æµé‡æ§åˆ¶ç­–ç•¥ï¼Œå¦‚QPSé™æµã€çº¿ç¨‹æ•°é™æµã€ç†”æ–­é™çº§ç­‰ã€‚</p><p>æ ¸å¿ƒç‰¹æ€§</p><ul><li><strong>ä¸°å¯Œçš„æµé‡æ§åˆ¶ç­–ç•¥</strong>ï¼šæ”¯æŒåŸºäºQPSçš„é™æµã€åŸºäºå“åº”æ—¶é—´çš„ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰ç­–ç•¥ã€‚</li><li><strong>å®æ—¶ç›‘æ§</strong>ï¼šæä¾›å®æ—¶çš„ç›‘æ§æ•°æ®å±•ç¤ºï¼Œå¸®åŠ©å¿«é€Ÿå®šä½æµé‡æ§åˆ¶æ•ˆæœå’Œç³»ç»ŸçŠ¶æ€ã€‚</li><li><strong>è§„åˆ™åŠ¨æ€æ¨é€</strong>ï¼šæ”¯æŒåŠ¨æ€è§„åˆ™é…ç½®ï¼Œæ— éœ€é‡å¯åº”ç”¨å³å¯å®æ—¶ç”Ÿæ•ˆã€‚</li><li><strong>å¹¿æ³›çš„æ¡†æ¶æ•´åˆ</strong>ï¼šæä¾›äº†å¯¹Spring Cloudã€Dubboã€gRPCç­‰å¤šç§å¾®æœåŠ¡æ¡†æ¶çš„é€‚é…ï¼Œæ–¹ä¾¿åœ¨å„ç§å¾®æœåŠ¡æ¶æ„ä¸‹ä½¿ç”¨ã€‚</li></ul><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><p>ä»¥åœ¨Spring Cloudé¡¹ç›®ä¸­ä½¿ç”¨Sentinelä¸ºä¾‹ï¼Œé¦–å…ˆéœ€è¦æ·»åŠ Sentinelçš„Starterä¾èµ–åˆ°é¡¹ç›®çš„<code>pom.xml</code>æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>ç‰ˆæœ¬å·<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>å®šä¹‰è§„åˆ™</p></blockquote><p>Sentinel æ”¯æŒé€šè¿‡ç¡¬ç¼–ç ã€æ–‡ä»¶é…ç½®ã€æ§åˆ¶å°é…ç½®ç­‰å¤šç§æ–¹å¼å®šä¹‰è§„åˆ™ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æµé‡æ§åˆ¶è§„åˆ™ç¤ºä¾‹ï¼Œé€šè¿‡ç¡¬ç¼–ç çš„æ–¹å¼å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.alibaba.csp.sentinel.Entry;<br><span class="hljs-keyword">import</span> com.alibaba.csp.sentinel.SphU;<br><span class="hljs-keyword">import</span> com.alibaba.csp.sentinel.slots.block.BlockException;<br><span class="hljs-keyword">import</span> com.alibaba.csp.sentinel.slots.block.RuleConstant;<br><span class="hljs-keyword">import</span> com.alibaba.csp.sentinel.slots.block.flow.FlowRule;<br><span class="hljs-keyword">import</span> com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SentinelDemo</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// é…ç½®è§„åˆ™</span><br>        initFlowRules();<br>        <br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">try</span> (<span class="hljs-type">Entry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> SphU.entry(<span class="hljs-string">&quot;HelloWorld&quot;</span>)) &#123;<br>                <span class="hljs-comment">// è¢«ä¿æŠ¤çš„é€»è¾‘</span><br>                System.out.println(<span class="hljs-string">&quot;hello world&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (BlockException ex) &#123;<br>                <span class="hljs-comment">// å¤„ç†è¢«æµé‡æ§åˆ¶åçš„é€»è¾‘</span><br>                System.out.println(<span class="hljs-string">&quot;blocked!&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initFlowRules</span><span class="hljs-params">()</span> &#123;<br>        List&lt;FlowRule&gt; rules = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">FlowRule</span> <span class="hljs-variable">rule</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlowRule</span>();<br>        rule.setResource(<span class="hljs-string">&quot;HelloWorld&quot;</span>);<br>        rule.setGrade(RuleConstant.FLOW_GRADE_QPS);<br>        <span class="hljs-comment">// Set limit QPS to 20.</span><br>        rule.setCount(<span class="hljs-number">20</span>);<br>        rules.add(rule);<br>        FlowRuleManager.loadRules(rules);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„æµé‡æ§åˆ¶è§„åˆ™ï¼Œå¯¹åä¸º<code>HelloWorld</code>çš„èµ„æºè¿›è¡Œé™æµï¼Œé™åˆ¶å…¶QPSï¼ˆæ¯ç§’æŸ¥è¯¢ç‡ï¼‰ä¸è¶…è¿‡20ã€‚</p><p>å¯åŠ¨å’Œæµ‹è¯•</p><ul><li>å°†ä¸Šè¿°ä»£ç æ·»åŠ åˆ°Spring Booté¡¹ç›®ä¸­ã€‚</li><li>å¯åŠ¨Spring Bootåº”ç”¨ã€‚</li><li>è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨JMeteræˆ–å…¶ä»–å·¥å…·æ¨¡æ‹Ÿé«˜å¹¶å‘è¯·æ±‚ã€‚</li><li>è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼ŒéªŒè¯é™æµæ•ˆæœã€‚</li></ul><blockquote><p>ä½¿ç”¨Sentinelæ§åˆ¶å°</p></blockquote><p>Sentinelè¿˜æä¾›äº†ä¸€ä¸ªæ§åˆ¶å°ï¼ˆSentinel Dashboardï¼‰ï¼Œé€šè¿‡å®ƒå¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°ç®¡ç†è§„åˆ™å’Œç›‘æ§åº”ç”¨çŠ¶æ€ã€‚ä½¿ç”¨æ§åˆ¶å°ï¼Œå¯ä»¥åŠ¨æ€ä¿®æ”¹é™æµè§„åˆ™ã€æŸ¥çœ‹å®æ—¶ç›‘æ§æ•°æ®ç­‰ã€‚</p><ul><li>ä¸‹è½½å¹¶å¯åŠ¨Sentinelæ§åˆ¶å°ã€‚</li><li>åœ¨åº”ç”¨ä¸­é…ç½®æ§åˆ¶å°åœ°å€ã€‚</li><li>è®¿é—®æ§åˆ¶å°ï¼Œæ·»åŠ æˆ–ä¿®æ”¹è§„åˆ™ï¼ŒæŸ¥çœ‹ç›‘æ§æ•°æ®ã€‚</li></ul><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/qq_36903261/article/details/106899215">https://blog.csdn.net/qq_36903261/article/details/106899215</a></li><li><a href="https://blog.csdn.net/qq_38374397/article/details/125603109">https://blog.csdn.net/qq_38374397/article/details/125603109</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springcloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RabbitMQçš„å®‰è£…ä¸ä½¿ç”¨</title>
    <link href="/2023/12/03/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RabbitMQ%E7%9A%84%E5%AE%89%E8%A3%85/"/>
    <url>/2023/12/03/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RabbitMQ%E7%9A%84%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€windowsä¸‹rabbitMQ-çš„å®‰è£…"><a href="#1ã€windowsä¸‹rabbitMQ-çš„å®‰è£…" class="headerlink" title="1ã€windowsä¸‹rabbitMQ çš„å®‰è£…"></a>1ã€windowsä¸‹rabbitMQ çš„å®‰è£…</h3><p>RabbitMQæœåŠ¡ç«¯ä»£ç æ˜¯ä½¿ç”¨å¹¶å‘å¼è¯­è¨€Erlangç¼–å†™çš„ï¼Œå®‰è£…Rabbit MQçš„å‰ææ˜¯éœ€è¦å®‰è£…ä¸€ä¸‹Erlang</p><p>Erlang ä¸‹è½½åœ°å€ï¼š <a href="https://www.erlang.org/downloads">https://www.erlang.org/downloads</a></p><p>ç¯å¢ƒå˜é‡é…ç½®</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs haml">ERLANG_HOME<br><span class="hljs-tag">%<span class="hljs-selector-tag">ERLANG_HOME</span></span>%\bin<br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231203233950.png" alt="image.png"></p><p>æ‰“å¼€ cmd è¾“å…¥ erl -version å‡ºç°ç‰ˆæœ¬å·å³å®‰è£…æˆåŠŸ</p><blockquote><p>RabbitMQ</p></blockquote><p>rabbitmq ä¸‹è½½åœ°å€ï¼š <a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></p><p>ä¸‹è½½è¿›è¡Œå®‰è£…æ“ä½œã€‚</p><p>CMD è¿›å…¥ç»ˆç«¯ è¿›å…¥åˆ°å®‰è£…ç›®å½• æ‰§è¡Œ rabbitmq-plugins enable rabbitmq_management å‘½ä»¤å®‰è£…ç®¡ç†é¡µé¢çš„æ’ä»¶ï¼Œ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231203234341.png" alt="image.png"></p><p>å¯åŠ¨rabbitMQæœåŠ¡ï¼šrabbitmq-service.bat start</p><p>åŒå‡» rabbitmq-service.bat å³å®Œæˆå®‰è£…ã€‚ï¼ˆå…³é—­çš„è¯æ‰‹åŠ¨åœ¨æœåŠ¡åˆ—è¡¨è¿›è¡Œå…³é—­ä¸€ä¸‹ï¼‰</p><p>ç™»é™†ï¼š <a href="http://127.0.0.1:15672/">http://127.0.0.1:15672/</a></p><p>åˆå§‹çš„é»˜è®¤ç”¨æˆ·åŠå¯†ç éƒ½æ˜¯Â <code>guest</code>Â ï¼Œ è¾“å…¥åå³å¯ç™»å½•</p><h3 id="2ã€centos-ç³»ç»Ÿä¸‹-rabbitMQ-çš„å®‰è£…"><a href="#2ã€centos-ç³»ç»Ÿä¸‹-rabbitMQ-çš„å®‰è£…" class="headerlink" title="2ã€centos ç³»ç»Ÿä¸‹ rabbitMQ çš„å®‰è£…"></a>2ã€centos ç³»ç»Ÿä¸‹ rabbitMQ çš„å®‰è£…</h3><h4 id="RabbitMQ-æœåŠ¡å®‰è£…"><a href="#RabbitMQ-æœåŠ¡å®‰è£…" class="headerlink" title="RabbitMQ æœåŠ¡å®‰è£…"></a>RabbitMQ æœåŠ¡å®‰è£…</h4><p>ç•¥</p><h4 id="Dockerå®¹å™¨æ–¹å¼å®‰è£…RabbitMQ"><a href="#Dockerå®¹å™¨æ–¹å¼å®‰è£…RabbitMQ" class="headerlink" title="Dockerå®¹å™¨æ–¹å¼å®‰è£…RabbitMQ"></a>Dockerå®¹å™¨æ–¹å¼å®‰è£…RabbitMQ</h4><p>1ã€æ‹‰å–é•œåƒï¼ˆé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼‰</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">docker pull rabbitmq<br></code></pre></td></tr></table></figure><p>2ã€å¯åŠ¨RabbitMQå®¹å™¨</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -d --hostname myRabbitMQ --name rabbit -p <span class="hljs-number">5672</span>:<span class="hljs-number">5672</span> -p <span class="hljs-number">15672</span>:<span class="hljs-number">15672</span> rabbitmq<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤çš„ç»„æˆéƒ¨åˆ†è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li><code>docker run</code>ï¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ã€‚</li><li><code>-d</code>ï¼šä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œå³å®¹å™¨åœ¨åå°è¿è¡Œã€‚</li><li><code>--hostname myRabbitMQ</code>ï¼šä¸ºå®¹å™¨è®¾ç½®ä¸»æœºåï¼ˆ<code>myRabbitMQ</code>ï¼‰ã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦æ›´æ”¹è¿™ä¸ªå€¼ã€‚</li><li><code>--name rabbit</code>ï¼šè®¾ç½®å®¹å™¨çš„åç§°ï¼ˆ<code>rabbit</code>ï¼‰ã€‚è¿™ä¹Ÿå¯ä»¥æ ¹æ®ä½ çš„å‘½åçº¦å®šæ¥æ›´æ”¹ã€‚</li><li><code>-p 5672:5672</code>ï¼šå°†å®¹å™¨å†…éƒ¨çš„ 5672 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 5672 ç«¯å£ã€‚5672 ç«¯å£æ˜¯ RabbitMQ çš„é»˜è®¤AMQPç«¯å£ã€‚</li><li><code>-p 15672:15672</code>ï¼šå°†å®¹å™¨å†…çš„ 15672 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 15672 ç«¯å£ã€‚15672 ç«¯å£æ˜¯ RabbitMQ ç®¡ç†ç•Œé¢ï¼ˆManagement Consoleï¼‰çš„é»˜è®¤ç«¯å£ã€‚</li><li><code>rabbitmq</code>ï¼šæŒ‡å®šè¦ä½¿ç”¨çš„ Docker é•œåƒã€‚</li></ul><p>åœ¨ Docker å‘½ä»¤ä¸­ä½¿ç”¨ <code>-p</code> å‚æ•°æ¥æ˜ å°„ç«¯å£æ—¶ï¼Œæ ¼å¼ä¸º <code>-p &lt;å®¿ä¸»æœºç«¯å£&gt;:&lt;å®¹å™¨ç«¯å£&gt;</code>ã€‚</p><p>å¼€æ”¾ä¸€ä¸‹ç«¯å£</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --permanent --add-port=5672/tcp</span><br>firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --permanent --add-port=15672/tcp</span><br>firewall-<span class="hljs-keyword">cmd</span><span class="language-bash"> --reload      <span class="hljs-comment"># é‡å¯é˜²ç«å¢™</span></span><br></code></pre></td></tr></table></figure><p>è®¿é—®æ§åˆ¶å°ç•Œé¢</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//linuxip:15672</span><br></code></pre></td></tr></table></figure><p>ç”¨æˆ·åå’Œå¯†ç é»˜è®¤éƒ½æ˜¯guest</p><p>3ã€å¼€å¯ Web ç•Œé¢ç®¡æ§å°æ’ä»¶</p><p>å¯¹äº Docker å®¹å™¨ä¸­çš„ RabbitMQ</p><p>å¦‚æœä½ æ˜¯é€šè¿‡ Docker å®¹å™¨è¿è¡Œ RabbitMQï¼Œå¹¶ä¸”æƒ³è¦å¯ç”¨ç®¡ç†æ§åˆ¶å°ï¼Œé€šå¸¸æœ€ç®€å•çš„æ–¹å¼æ˜¯ç›´æ¥ä½¿ç”¨å¸¦æœ‰ç®¡ç†æ’ä»¶çš„ RabbitMQ é•œåƒã€‚ä¾‹å¦‚ï¼š</p><p><code>docker run -d --hostname myRabbitMQ --name some-rabbit -p 5672:5672 -p 15672:15672 rabbitmq:3-management</code></p><p>åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œ<code>rabbitmq:3-management</code> é•œåƒå·²ç»åŒ…å«äº†ç®¡ç†æ’ä»¶ã€‚å¦‚æœä½ å·²ç»è¿è¡Œäº†ä¸€ä¸ªä¸åŒ…å«ç®¡ç†æ’ä»¶çš„ RabbitMQ å®¹å™¨ï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å¯ç”¨ç®¡ç†æ’ä»¶ï¼š</p><ol><li><p>æ‰¾å‡ºä½ çš„ RabbitMQ å®¹å™¨çš„ ID æˆ–åç§°ï¼š</p><p> <code>docker ps</code></p></li><li><p>è¿›å…¥å®¹å™¨ï¼š</p><p> <code>docker exec -it [å®¹å™¨IDæˆ–åç§°] bash</code></p></li><li><p>åœ¨å®¹å™¨å†…éƒ¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯ç”¨ç®¡ç†æ’ä»¶ï¼š</p><p> <code>rabbitmq-plugins enable rabbitmq_management</code></p></li><li><p>é€€å‡ºå®¹å™¨ï¼š</p><p> <code>exit</code></p></li><li><p>é‡å¯ RabbitMQ å®¹å™¨ä»¥åº”ç”¨æ›´æ”¹ã€‚</p></li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> restart<span class="hljs-meta"> [å®¹å™¨åç§°æˆ–ID]</span><br></code></pre></td></tr></table></figure><p>ä¸€æ—¦å®Œæˆï¼Œä½ å°±å¯ä»¥é€šè¿‡<code>http://linuxip:15672</code></p><p>è®¿é—® RabbitMQ çš„ç®¡ç†ç•Œé¢ã€‚ç¡®ä¿ä½ å·²ç»å°† 15672 ç«¯å£æ˜ å°„åˆ°äº†å®¿ä¸»æœºä¸Šã€‚</p><hr><p>å‚è€ƒï¼š </p><ul><li><a href="https://blog.csdn.net/u011709538/article/details/131396367">https://blog.csdn.net/u011709538/article/details/131396367</a></li><li><a href="https://zhuanlan.zhihu.com/p/609676322?utm_id=0">https://zhuanlan.zhihu.com/p/609676322?utm_id=0</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>MQ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>MQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‰ç«¯ä¾èµ–å¸¸è§æŠ¥é”™è§£å†³æ–¹æ¡ˆ</title>
    <link href="/2023/12/03/%E5%89%8D%E7%AB%AF%E4%BE%9D%E8%B5%96%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2023/12/03/%E5%89%8D%E7%AB%AF%E4%BE%9D%E8%B5%96%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<blockquote><p>é—®é¢˜1ï¼š npmé”™è¯¯â€”â€”npm ERR! code ERESOLVE è§£å†³æ–¹æ³•</p></blockquote><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">npm ERR! code ERESOLVE<br>npm ERR! ERESOLVE unable to resolve dependency tree<br>npm ERR!<br>npm ERR! While resolving: vol.vue3@<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span><br>npm ERR! Found: vue@<span class="hljs-number">3.2</span>.<span class="hljs-number">20</span><br>npm ERR! node_modules/vue<br>npm ERR!   vue@<span class="hljs-string">&quot;^3.0.0&quot;</span> from the root project<br>npm ERR!<br>npm ERR! Could not resolve dependency:<br>npm ERR! peer vue@<span class="hljs-string">&quot;^2.5.17&quot;</span> from element-ui@<span class="hljs-number">2.15</span>.<span class="hljs-number">6</span><br>npm ERR! node_modules/element-ui<br>npm ERR!   element-ui@<span class="hljs-string">&quot;*&quot;</span> from the root project<br>npm ERR!<br>npm ERR! Fix the upstream dependency conflict, or retry<br>npm ERR! this command with --force, or --legacy-peer-deps<br>npm ERR! to accept an incorrect (and potentially broken) dependency resolution.<br>npm ERR!<br>npm ERR! See C:\Users\Administrator\AppData\Local\npm-cache\eresolve-report.txt for a full report.<br> <br>npm ERR! A complete log of this run can be found in:<br>npm ERR!     C:\Users\Administrator\AppData\Local\npm-cache\_logs\<span class="hljs-number">2021</span>-<span class="hljs-number">10</span>-<span class="hljs-number">11</span>T06_27_44_908Z-debug.log<br></code></pre></td></tr></table></figure><p>åœ¨å®‰è£…ç»„ä»¶çš„æ—¶å€™å‡ºç°ä»¥ä¸Šé—®é¢˜ï¼Œnpmç‰ˆæœ¬é—®é¢˜æŠ¥é”™</p><p>è§£å†³æ–¹æ³•ï¼š</p><p>åœ¨å‘½ä»¤åé¢åŠ ä¸Š</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-comment">--legacy-peer-deps</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>node</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonç¯å¢ƒå®‰è£…</title>
    <link href="/2023/12/03/Python%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/"/>
    <url>/2023/12/03/Python%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€python-3-9-ç‰ˆæœ¬å®‰è£…"><a href="#1ã€python-3-9-ç‰ˆæœ¬å®‰è£…" class="headerlink" title="1ã€python 3.9 ç‰ˆæœ¬å®‰è£…"></a>1ã€python 3.9 ç‰ˆæœ¬å®‰è£…</h3><p>ä¸‹è½½åœ°å€ï¼š <a href="https://www.python.org/downloads/release/python-396/">https://www.python.org/downloads/release/python-396/</a></p><p>å‚è€ƒï¼š <a href="https://blog.csdn.net/qq_53280175/article/details/121107748">https://blog.csdn.net/qq_53280175/article/details/121107748</a></p><p>ä¸‹è½½é“¾æ¥ï¼š <a href="https://www.python.org/ftp/python/3.9.6/python-3.9.6-amd64.exe">https://www.python.org/ftp/python/3.9.6/python-3.9.6-amd64.exe</a></p><p>è¿™é‡Œä¸‹è½½çš„æ˜¯ win 64 ä½å®‰è£…ç‰ˆ</p><p>å®‰è£…çš„æ—¶å€™å‹¾é€‰ä¸€ä¸‹  Add Python 3.9 to PATH</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231203214357.png" alt="image.png"></p><p>é€‰æ‹©è‡ªå®šä¹‰å®‰è£…</p><p>æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼Œcmd çª—å£è¾“å…¥ä¸€ä¸‹ <code>python</code> çœ‹ä¸€ä¸‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231203214605.png" alt="image.png"></p><h3 id="2ã€é™çº§pythonä¸º2-0-ç‰ˆæœ¬"><a href="#2ã€é™çº§pythonä¸º2-0-ç‰ˆæœ¬" class="headerlink" title="2ã€é™çº§pythonä¸º2.0 ç‰ˆæœ¬"></a>2ã€é™çº§pythonä¸º2.0 ç‰ˆæœ¬</h3><p>ç”±äºç‰ˆæœ¬å‰ç«¯é¡¹ç›® node-sass å®‰è£…å¤±è´¥ï¼Œéƒ¨åˆ†å»ºè®®æ˜¯é™çº§ Python ä¸º 2.x ç‰ˆæœ¬ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹å®é™…æ“ä½œã€‚</p><p>æ‰¾äº†ä¸€ä¸ª 2.7.2 ç‰ˆæœ¬ï¼š<a href="https://www.python.org/downloads/release/python-273/">https://www.python.org/downloads/release/python-273/</a></p><p>ä»ç„¶é€‰æ‹©å®‰è£…ç‰ˆæœ¬</p><p>å®‰è£…å®ŒæˆååŠ ä¸€ä¸‹ Path ç¯å¢ƒå˜é‡ï¼ˆåˆ é™¤ä¹‹å‰çš„ï¼‰</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">xxx\Pytho<span class="hljs-symbol">n27</span><br></code></pre></td></tr></table></figure><p>è¾“å…¥ <code>Python -V</code> éªŒè¯é‡Šæ”¾å®‰è£…æˆåŠŸ</p><p>å®é™…æ“ä½œåœ¨è¿™ä¸€æ­¥è¾“å…¥åï¼Œæ²¡åæ˜ ï¼Œ<strong>ä½¿ç”¨å®Œæ•´è·¯å¾„è¿è¡Œ Python</strong> å´åˆæ˜¯æ­£å¸¸çš„</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">D</span>:\<span class="hljs-number">02</span>_Soft\xxxxx\Python27\python.exe -V<br></code></pre></td></tr></table></figure><p>å®é™…çš„ä¸€ä¸ªæ“ä½œï¼Œ<strong>éœ€è¦è®¾ç½®pathä¼˜å…ˆçº§ï¼ŒæŠŠpythonçš„è·¯å¾„æ”¾ç½®é¡¶éƒ¨</strong></p>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxç³»ç»Ÿä¸‹ javaç¯å¢ƒå˜é‡çš„é…ç½®</title>
    <link href="/2023/12/03/linux%E7%B3%BB%E7%BB%9F%E4%B8%8BJava%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%9A%84%E9%85%8D%E7%BD%AE/"/>
    <url>/2023/12/03/linux%E7%B3%BB%E7%BB%9F%E4%B8%8BJava%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%9A%84%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h3 id="linuxç³»ç»Ÿä¸‹-javaç¯å¢ƒå˜é‡çš„é…ç½®"><a href="#linuxç³»ç»Ÿä¸‹-javaç¯å¢ƒå˜é‡çš„é…ç½®" class="headerlink" title="linuxç³»ç»Ÿä¸‹ javaç¯å¢ƒå˜é‡çš„é…ç½®"></a>linuxç³»ç»Ÿä¸‹ javaç¯å¢ƒå˜é‡çš„é…ç½®</h3><p>è¾“å…¥<code>echo $JAVA_HOME</code>ç»“æœä¸ºç©ºï¼Œè¯´æ˜æ²¡æœ‰é…ç½®javaç¯å¢ƒå˜é‡</p><p>æŸ¥çœ‹yumå®‰è£…çš„jdkåœ¨å“ªä¸ªç›®å½•ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> -l /etc/alternatives/java<br></code></pre></td></tr></table></figure><p>é»˜è®¤å®‰è£…è·¯å¾„æ˜¯åœ¨ <code>/usr/lib/jvm</code></p><p>é…ç½®ç¯å¢ƒå˜é‡  <code>vim /etc/profile</code></p><p>è¿½åŠ å†…å®¹</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">JAVA_HOME</span>=/usr/local/lib/java/jdk1.8.0_231 <br><span class="hljs-built_in">export</span> <span class="hljs-attribute">JRE_HOME</span>=<span class="hljs-variable">$&#123;JAVA_HOME&#125;</span>/jre  <br><span class="hljs-built_in">export</span> <span class="hljs-attribute">CLASSPATH</span>=.:$&#123;JAVA_HOME&#125;/lib:<span class="hljs-variable">$&#123;JRE_HOME&#125;</span>/lib  <br><span class="hljs-built_in">export</span>  <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$&#123;JAVA_HOME&#125;</span>/bin:$PATH<br></code></pre></td></tr></table></figure><p>åˆ·æ–°ç¯å¢ƒå˜é‡é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><blockquote><p>å¸è½½é‡è£…</p></blockquote><p>å¸è½½å‚è€ƒï¼ˆLinuxä¸Šå¸è½½JDKï¼‰ï¼š <a href="https://blog.csdn.net/weixin_44990104/article/details/117589372">https://blog.csdn.net/weixin_44990104/article/details/117589372</a></p><p>linuxå®‰è£…jdk8è¯¦ç»†æ­¥éª¤ï¼Œå‚è€ƒï¼š <a href="https://blog.csdn.net/qq_33794744/article/details/107838128">https://blog.csdn.net/qq_33794744/article/details/107838128</a></p>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>jdk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>centos7 å®‰è£… nacos æ“ä½œ</title>
    <link href="/2023/12/03/centos7%E5%AE%89%E8%A3%85nacos%E6%93%8D%E4%BD%9C/"/>
    <url>/2023/12/03/centos7%E5%AE%89%E8%A3%85nacos%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h3 id="centos7-å®‰è£…-nacos-æ“ä½œ"><a href="#centos7-å®‰è£…-nacos-æ“ä½œ" class="headerlink" title="centos7 å®‰è£… nacos æ“ä½œ"></a>centos7 å®‰è£… nacos æ“ä½œ</h3><p>å‰æéœ€è¦ï¼šé¡¹ç›®è¿è¡Œç¯å¢ƒéœ€è¦å®‰è£… nacos </p><p>åœ¨ centos ä¸­è¿›è¡Œå®‰è£…nacosï¼Œè¿™é‡Œæ¼”ç¤ºå®‰è£…ç‰ˆæœ¬æ˜¯ 1.3.2ï¼Œ</p><p>ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/alibaba/nacos/releases/tag/1.3.2">https://github.com/alibaba/nacos/releases/tag/1.3.2</a></p><p>nacos è¿è¡Œéœ€è¦å…ˆå®‰è£…ä¸€ä¸‹ JDK ç¯å¢ƒï¼Œæ³¨æ„ä¸€ä¸‹</p><p>å¯ä»¥è‡ªå·±ç‚¹å‡»ä¸‹è½½   <code>nacos-server-1.3.2.tar.gz</code></p><p>æˆ–è€…åœ¨ Linuxç³»ç»Ÿä¸­ä¸‹è½½å‘½ä»¤ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> https://github.com/alibaba/nacos/releases/download/<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>/nacos-server-<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>.tar.gz<br></code></pre></td></tr></table></figure><p>ä¸‹è½½å®Œå‹ç¼©åŒ…ä¹‹åï¼Œä¸Šä¼ æŒ‡æœåŠ¡å™¨ä»»æ„ç›®å½•ï¼Œè¿›è¡Œè§£å‹</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxvf nacos-server-<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>.tar.gz<br></code></pre></td></tr></table></figure><p>è§£å‹åä¼šç”Ÿæˆ nacos æ–‡ä»¶å¤¹ï¼Œè¿›å…¥åˆ° nacos ç›®å½•ï¼Œè¾“å…¥å‘½ä»¤å¯åŠ¨(ä»¥å•æœºçš„å½¢å¼å¯åŠ¨)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bin/startup.sh -m standalone<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦æŒä¹…åŒ– é…ç½®åˆ°mysqlï¼Œåˆ™è°ƒæ•´nacosçš„é…ç½®</p><p>å¦‚æœä½ çš„æœåŠ¡å™¨å¼€äº†é˜²ç«å¢™ï¼Œåˆ™éœ€è¦å¼€æ”¾ç›¸åº”çš„ç«¯å£</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#å¼€æ”¾ç«¯å£</span><br>firewall-cmd <span class="hljs-params">--zone=public</span> <span class="hljs-params">--add-port=8848/tcp</span> <span class="hljs-params">--permanent</span> <br><span class="hljs-comment"># é‡å¯é˜²ç«å¢™ </span><br>firewall-cmd <span class="hljs-params">--reload</span><br><span class="hljs-comment"># æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£åˆ—è¡¨ </span><br>firewall-cmd <span class="hljs-params">--list-port</span><br></code></pre></td></tr></table></figure><p>nacosé»˜è®¤çš„å¯åŠ¨ç«¯å£æ˜¯ 8848ï¼Œè®¿é—®Â <code>http://ip:ç«¯å£/nacos</code>Â å³å¯çœ‹åˆ°ç™»å½•é¡µé¢.é»˜è®¤çš„ç”¨æˆ·åå¯†ç æ˜¯Â <code>nacos/naocs</code>ï¼Œç™»å½•å³å¯ä½¿ç”¨</p><h3 id="Docker-çš„æ–¹å¼å®‰è£…-Nacos"><a href="#Docker-çš„æ–¹å¼å®‰è£…-Nacos" class="headerlink" title="Docker çš„æ–¹å¼å®‰è£… Nacos"></a>Docker çš„æ–¹å¼å®‰è£… Nacos</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> pull nacos/nacos-server:<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span><br><span class="hljs-attribute">docker</span> images | grep nacos-server<br></code></pre></td></tr></table></figure><p>éƒ¨ç½²è¿è¡Œ(æ”¹ä¸€ä¸‹ MYSQL çš„ IP åœ°å€)</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> --name nacos-server -e <span class="hljs-attribute">MODE</span>=standalone -e <span class="hljs-attribute">MYSQL_SERVICE_HOST</span>=192.168.56.105 -e <span class="hljs-attribute">MYSQL_SERVICE_PORT</span>=3306 -e <span class="hljs-attribute">MYSQL_SERVICE_DB_NAME</span>=t_nacos -e <span class="hljs-attribute">MYSQL_SERVICE_USER</span>=root -e  <span class="hljs-attribute">MYSQL_SERVICE_PASSWORD</span>=123456 -p 8848:8848 -d nacos/nacos-server:1.3.2<br></code></pre></td></tr></table></figure><p>è®¿é—®Â <code>http://192.168.56.105:8848/nacos</code></p><p>æ•°æ®åº“æ‰§è¡Œä¸€ä¸‹ sql è¯­å¥ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸‹ nacos_config æ•°æ®åº“</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Copyright 1999-2018 Alibaba Group Holding Ltd.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"> * you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"> * You may obtain a copy of the License at</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"> * See the License for the specific language governing permissions and</span><br><span class="hljs-comment"> * limitations under the License.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = config_info   */</span><br><span class="hljs-comment">/******************************************/</span><br>CREATE TABLE `config_info` (<br>  `id` bigint(<span class="hljs-number">20</span>) <span class="hljs-literal">NOT</span> NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,<br>  `dat<span class="hljs-built_in">a_id</span>` varchar(<span class="hljs-number">255</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;dat<span class="hljs-built_in">a_id</span>&#x27;,<br>  `group_id` varchar(<span class="hljs-number">255</span>) DEFAULT NULL,<br>  `content` longtext <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;content&#x27;,<br>  `md5` varchar(<span class="hljs-number">32</span>) DEFAULT NULL COMMENT &#x27;md5&#x27;,<br>  `gmt_create` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;,<br>  `gmt_modified` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;ä¿®æ”¹æ—¶é—´&#x27;,<br>  `src_user` text COMMENT &#x27;source user&#x27;,<br>  `src_ip` varchar(<span class="hljs-number">20</span>) DEFAULT NULL COMMENT &#x27;source ip&#x27;,<br>  `app_name` varchar(<span class="hljs-number">128</span>) DEFAULT NULL,<br>  `tenant_id` varchar(<span class="hljs-number">128</span>) DEFAULT &#x27;&#x27; COMMENT &#x27;ç§Ÿæˆ·å­—æ®µ&#x27;,<br>  `c_desc` varchar(<span class="hljs-number">256</span>) DEFAULT NULL,<br>  `c_use` varchar(<span class="hljs-number">64</span>) DEFAULT NULL,<br>  `effect` varchar(<span class="hljs-number">64</span>) DEFAULT NULL,<br>  `type` varchar(<span class="hljs-number">64</span>) DEFAULT NULL,<br>  `c_schema` text,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uk_configinfo_datagrouptenant` (`dat<span class="hljs-built_in">a_id</span>`,`group_id`,`tenant_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;config_info&#x27;<span class="hljs-comment">;</span><br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = config_info_aggr   */</span><br><span class="hljs-comment">/******************************************/</span><br>CREATE TABLE `config_info_aggr` (<br>  `id` bigint(<span class="hljs-number">20</span>) <span class="hljs-literal">NOT</span> NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,<br>  `dat<span class="hljs-built_in">a_id</span>` varchar(<span class="hljs-number">255</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;dat<span class="hljs-built_in">a_id</span>&#x27;,<br>  `group_id` varchar(<span class="hljs-number">255</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;group_id&#x27;,<br>  `datum_id` varchar(<span class="hljs-number">255</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;datum_id&#x27;,<br>  `content` longtext <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;å†…å®¹&#x27;,<br>  `gmt_modified` datetime <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;ä¿®æ”¹æ—¶é—´&#x27;,<br>  `app_name` varchar(<span class="hljs-number">128</span>) DEFAULT NULL,<br>  `tenant_id` varchar(<span class="hljs-number">128</span>) DEFAULT &#x27;&#x27; COMMENT &#x27;ç§Ÿæˆ·å­—æ®µ&#x27;,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`dat<span class="hljs-built_in">a_id</span>`,`group_id`,`tenant_id`,`datum_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;å¢åŠ ç§Ÿæˆ·å­—æ®µ&#x27;<span class="hljs-comment">;</span><br><br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = config_info_beta   */</span><br><span class="hljs-comment">/******************************************/</span><br>CREATE TABLE `config_info_beta` (<br>  `id` bigint(<span class="hljs-number">20</span>) <span class="hljs-literal">NOT</span> NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,<br>  `dat<span class="hljs-built_in">a_id</span>` varchar(<span class="hljs-number">255</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;dat<span class="hljs-built_in">a_id</span>&#x27;,<br>  `group_id` varchar(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;group_id&#x27;,<br>  `app_name` varchar(<span class="hljs-number">128</span>) DEFAULT NULL COMMENT &#x27;app_name&#x27;,<br>  `content` longtext <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;content&#x27;,<br>  `bet<span class="hljs-built_in">a_ips</span>` varchar(<span class="hljs-number">1024</span>) DEFAULT NULL COMMENT &#x27;betaIps&#x27;,<br>  `md5` varchar(<span class="hljs-number">32</span>) DEFAULT NULL COMMENT &#x27;md5&#x27;,<br>  `gmt_create` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;,<br>  `gmt_modified` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;ä¿®æ”¹æ—¶é—´&#x27;,<br>  `src_user` text COMMENT &#x27;source user&#x27;,<br>  `src_ip` varchar(<span class="hljs-number">20</span>) DEFAULT NULL COMMENT &#x27;source ip&#x27;,<br>  `tenant_id` varchar(<span class="hljs-number">128</span>) DEFAULT &#x27;&#x27; COMMENT &#x27;ç§Ÿæˆ·å­—æ®µ&#x27;,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uk_configinfobet<span class="hljs-built_in">a_datagrouptenant</span>` (`dat<span class="hljs-built_in">a_id</span>`,`group_id`,`tenant_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;config_info_beta&#x27;<span class="hljs-comment">;</span><br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = config_info_tag   */</span><br><span class="hljs-comment">/******************************************/</span><br>CREATE TABLE `config_info_tag` (<br>  `id` bigint(<span class="hljs-number">20</span>) <span class="hljs-literal">NOT</span> NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,<br>  `dat<span class="hljs-built_in">a_id</span>` varchar(<span class="hljs-number">255</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;dat<span class="hljs-built_in">a_id</span>&#x27;,<br>  `group_id` varchar(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;group_id&#x27;,<br>  `tenant_id` varchar(<span class="hljs-number">128</span>) DEFAULT &#x27;&#x27; COMMENT &#x27;tenant_id&#x27;,<br>  `tag_id` varchar(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;tag_id&#x27;,<br>  `app_name` varchar(<span class="hljs-number">128</span>) DEFAULT NULL COMMENT &#x27;app_name&#x27;,<br>  `content` longtext <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;content&#x27;,<br>  `md5` varchar(<span class="hljs-number">32</span>) DEFAULT NULL COMMENT &#x27;md5&#x27;,<br>  `gmt_create` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;,<br>  `gmt_modified` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;ä¿®æ”¹æ—¶é—´&#x27;,<br>  `src_user` text COMMENT &#x27;source user&#x27;,<br>  `src_ip` varchar(<span class="hljs-number">20</span>) DEFAULT NULL COMMENT &#x27;source ip&#x27;,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`dat<span class="hljs-built_in">a_id</span>`,`group_id`,`tenant_id`,`tag_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;config_info_tag&#x27;<span class="hljs-comment">;</span><br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = config_tags_relation   */</span><br><span class="hljs-comment">/******************************************/</span><br>CREATE TABLE `config_tags_relation` (<br>  `id` bigint(<span class="hljs-number">20</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;id&#x27;,<br>  `tag_name` varchar(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;tag_name&#x27;,<br>  `tag_type` varchar(<span class="hljs-number">64</span>) DEFAULT NULL COMMENT &#x27;tag_type&#x27;,<br>  `dat<span class="hljs-built_in">a_id</span>` varchar(<span class="hljs-number">255</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;dat<span class="hljs-built_in">a_id</span>&#x27;,<br>  `group_id` varchar(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;group_id&#x27;,<br>  `tenant_id` varchar(<span class="hljs-number">128</span>) DEFAULT &#x27;&#x27; COMMENT &#x27;tenant_id&#x27;,<br>  `nid` bigint(<span class="hljs-number">20</span>) <span class="hljs-literal">NOT</span> NULL AUTO_INCREMENT,<br>  PRIMARY KEY (`nid`),<br>  UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),<br>  KEY `idx_tenant_id` (`tenant_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;config_tag_relation&#x27;<span class="hljs-comment">;</span><br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = group_capacity   */</span><br><span class="hljs-comment">/******************************************/</span><br>CREATE TABLE `group_capacity` (<br>  `id` bigint(<span class="hljs-number">20</span>) unsigned <span class="hljs-literal">NOT</span> NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®ID&#x27;,<br>  `group_id` varchar(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;&#x27; COMMENT &#x27;Group IDï¼Œç©ºå­—ç¬¦è¡¨ç¤ºæ•´ä¸ªé›†ç¾¤&#x27;,<br>  `quota` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;é…é¢ï¼Œ<span class="hljs-number">0</span>è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;,<br>  `usage` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;ä½¿ç”¨é‡&#x27;,<br>  `max_size` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ<span class="hljs-number">0</span>è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;,<br>  `max_aggr_count` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°ï¼Œï¼Œ<span class="hljs-number">0</span>è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;,<br>  `max_aggr_size` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ<span class="hljs-number">0</span>è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;,<br>  `max_history_count` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;,<br>  `gmt_create` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;,<br>  `gmt_modified` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;ä¿®æ”¹æ—¶é—´&#x27;,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uk_group_id` (`group_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;é›†ç¾¤ã€å„Groupå®¹é‡ä¿¡æ¯è¡¨&#x27;<span class="hljs-comment">;</span><br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = his_config_info   */</span><br><span class="hljs-comment">/******************************************/</span><br>CREATE TABLE `his_config_info` (<br>  `id` bigint(<span class="hljs-number">64</span>) unsigned <span class="hljs-literal">NOT</span> NULL,<br>  `nid` bigint(<span class="hljs-number">20</span>) unsigned <span class="hljs-literal">NOT</span> NULL AUTO_INCREMENT,<br>  `dat<span class="hljs-built_in">a_id</span>` varchar(<span class="hljs-number">255</span>) <span class="hljs-literal">NOT</span> NULL,<br>  `group_id` varchar(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL,<br>  `app_name` varchar(<span class="hljs-number">128</span>) DEFAULT NULL COMMENT &#x27;app_name&#x27;,<br>  `content` longtext <span class="hljs-literal">NOT</span> NULL,<br>  `md5` varchar(<span class="hljs-number">32</span>) DEFAULT NULL,<br>  `gmt_create` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP,<br>  `gmt_modified` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP,<br>  `src_user` text,<br>  `src_ip` varchar(<span class="hljs-number">20</span>) DEFAULT NULL,<br>  `op_type` char(<span class="hljs-number">10</span>) DEFAULT NULL,<br>  `tenant_id` varchar(<span class="hljs-number">128</span>) DEFAULT &#x27;&#x27; COMMENT &#x27;ç§Ÿæˆ·å­—æ®µ&#x27;,<br>  PRIMARY KEY (`nid`),<br>  KEY `idx_gmt_create` (`gmt_create`),<br>  KEY `idx_gmt_modified` (`gmt_modified`),<br>  KEY `idx_did` (`dat<span class="hljs-built_in">a_id</span>`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;å¤šç§Ÿæˆ·æ”¹é€ &#x27;<span class="hljs-comment">;</span><br><br><br><span class="hljs-comment">/******************************************/</span><br><span class="hljs-comment">/*   æ•°æ®åº“å…¨å = nacos_config   */</span><br><span class="hljs-comment">/*   è¡¨åç§° = tenant_capacity   */</span><br><span class="hljs-comment">/******************************************/</span><br>CREATE TABLE `tenant_capacity` (<br>  `id` bigint(<span class="hljs-number">20</span>) unsigned <span class="hljs-literal">NOT</span> NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®ID&#x27;,<br>  `tenant_id` varchar(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;&#x27; COMMENT &#x27;Tenant ID&#x27;,<br>  `quota` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;é…é¢ï¼Œ<span class="hljs-number">0</span>è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;,<br>  `usage` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;ä½¿ç”¨é‡&#x27;,<br>  `max_size` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;å•ä¸ªé…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ<span class="hljs-number">0</span>è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;,<br>  `max_aggr_count` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;èšåˆå­é…ç½®æœ€å¤§ä¸ªæ•°&#x27;,<br>  `max_aggr_size` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;å•ä¸ªèšåˆæ•°æ®çš„å­é…ç½®å¤§å°ä¸Šé™ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œ<span class="hljs-number">0</span>è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼&#x27;,<br>  `max_history_count` int(<span class="hljs-number">10</span>) unsigned <span class="hljs-literal">NOT</span> NULL DEFAULT &#x27;<span class="hljs-number">0</span>&#x27; COMMENT &#x27;æœ€å¤§å˜æ›´å†å²æ•°é‡&#x27;,<br>  `gmt_create` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;,<br>  `gmt_modified` datetime <span class="hljs-literal">NOT</span> NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;ä¿®æ”¹æ—¶é—´&#x27;,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uk_tenant_id` (`tenant_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;ç§Ÿæˆ·å®¹é‡ä¿¡æ¯è¡¨&#x27;<span class="hljs-comment">;</span><br><br><br>CREATE TABLE `tenant_info` (<br>  `id` bigint(<span class="hljs-number">20</span>) <span class="hljs-literal">NOT</span> NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,<br>  `kp` varchar(<span class="hljs-number">128</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;kp&#x27;,<br>  `tenant_id` varchar(<span class="hljs-number">128</span>) default &#x27;&#x27; COMMENT &#x27;tenant_id&#x27;,<br>  `tenant_name` varchar(<span class="hljs-number">128</span>) default &#x27;&#x27; COMMENT &#x27;tenant_name&#x27;,<br>  `tenant_desc` varchar(<span class="hljs-number">256</span>) DEFAULT NULL COMMENT &#x27;tenant_desc&#x27;,<br>  `create_source` varchar(<span class="hljs-number">32</span>) DEFAULT NULL COMMENT &#x27;create_source&#x27;,<br>  `gmt_create` bigint(<span class="hljs-number">20</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;,<br>  `gmt_modified` bigint(<span class="hljs-number">20</span>) <span class="hljs-literal">NOT</span> NULL COMMENT &#x27;ä¿®æ”¹æ—¶é—´&#x27;,<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),<br>  KEY `idx_tenant_id` (`tenant_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;tenant_info&#x27;<span class="hljs-comment">;</span><br><br>CREATE TABLE `users` (<br>`username` varchar(<span class="hljs-number">50</span>) <span class="hljs-literal">NOT</span> NULL PRIMARY KEY,<br>`password` varchar(<span class="hljs-number">500</span>) <span class="hljs-literal">NOT</span> NULL,<br>`enabled` boolean <span class="hljs-literal">NOT</span> NULL<br>)<span class="hljs-comment">;</span><br><br>CREATE TABLE `roles` (<br>`username` varchar(<span class="hljs-number">50</span>) <span class="hljs-literal">NOT</span> NULL,<br>`role` varchar(<span class="hljs-number">50</span>) <span class="hljs-literal">NOT</span> NULL,<br>UNIQUE INDEX `idx_user_role` (`username` ASC, `role` ASC) USING BTREE<br>)<span class="hljs-comment">;</span><br><br>CREATE TABLE `permissions` (<br>    `role` varchar(<span class="hljs-number">50</span>) <span class="hljs-literal">NOT</span> NULL,<br>    `resource` varchar(<span class="hljs-number">255</span>) <span class="hljs-literal">NOT</span> NULL,<br>    `action` varchar(<span class="hljs-number">8</span>) <span class="hljs-literal">NOT</span> NULL,<br>    UNIQUE INDEX `uk_role_permission` (`role`,`resource`,`action`) USING BTREE<br>)<span class="hljs-comment">;</span><br><br>INSERT INTO users (username, password, enabled) VALUES (&#x27;nacos&#x27;, &#x27;$<span class="hljs-number">2</span>a$<span class="hljs-number">10</span>$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;, <span class="hljs-literal">TRUE</span>)<span class="hljs-comment">;</span><br><br>INSERT INTO roles (username, role) VALUES (&#x27;nacos&#x27;, &#x27;ROLE_ADMIN&#x27;)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nacos</tag>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å†…ç½‘ç©¿é€å·¥å…·Neutrino-Proxy</title>
    <link href="/2023/12/01/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7Neutrino-Proxy/"/>
    <url>/2023/12/01/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7Neutrino-Proxy/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€åŸºæœ¬ä»‹ç»"><a href="#1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="1ã€åŸºæœ¬ä»‹ç»"></a>1ã€åŸºæœ¬ä»‹ç»</h3><p>ä¸€æ¬¾ç®€å•æ˜“ç”¨çš„å†…ç½‘ç©¿é€ä½¿ç”¨å·¥å…·</p><p>å®˜ç½‘ï¼š <a href="https://neutrino-proxy.dromara.org/">https://neutrino-proxy.dromara.org/</a></p><p>é¡¹ç›®åœ°å€ï¼š <a href="https://gitee.com/dromara/neutrino-proxy/releases">https://gitee.com/dromara/neutrino-proxy/releases</a></p><p>éƒ¨ç½²æ–¹å¼æœ‰ä¸‰ç§ï¼Œè¿™é‡Œé€šè¿‡åŸç”Ÿéƒ¨ç½²çš„æ–¹å¼è¿›è¡Œå¯åŠ¨</p><p>åŸç”Ÿéƒ¨ç½²çš„æ–¹å¼éœ€è¦ä¸‹è½½zipåŒ…ï¼Œè¿›è¡Œè§£å‹ï¼Œç„¶åå¯åŠ¨ exe æ–‡ä»¶ã€‚éƒ¨åˆ†exeç¨‹åºåŒä¸€ç›®å½•ä¸‹æœ‰Pom.xmlé…ç½®æ–‡ä»¶ï¼Œå¯è¿›è¡Œä¿®æ”¹å¯¹åº”é…ç½®ã€‚</p><p>æœåŠ¡å™¨ä¸‹è½½<code>neutrino-proxy-server-ubuntu-20.04-native.zip</code>æ–‡ä»¶ï¼Œ</p><p>å®¢æˆ·ç«¯ä¸‹è½½<code>neutrino-proxy-client-windows-2022-native.zip</code></p><h3 id="2ã€æœåŠ¡ç«¯éƒ¨ç½²"><a href="#2ã€æœåŠ¡ç«¯éƒ¨ç½²" class="headerlink" title="2ã€æœåŠ¡ç«¯éƒ¨ç½²"></a>2ã€æœåŠ¡ç«¯éƒ¨ç½²</h3><blockquote><p>éƒ¨ç½²æœåŠ¡å™¨ç«¯</p></blockquote><h4 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h4><p>é»˜è®¤å…ˆé‡‡ç”¨åŸç”Ÿé…ç½®h2æ•°æ®åº“ï¼Œï¼ˆè¿™ç§æ•°æ®åº“çš„ç¼ºç‚¹æ˜¯æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœéœ€è¦æŒä¹…åŒ–æ”¾åˆ°æœ¬åœ°ï¼Œå»ºè®®ä¿®æ”¹é…ç½®ä¸º mysql æ•°æ®åº“ï¼‰</p><p>åŸé…ç½®</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-symbol">data:</span><br>  <span class="hljs-symbol">db:</span><br>    <span class="hljs-comment"># æ•°æ®åº“ç±»å‹ï¼Œç›®å‰æ”¯æŒh2ã€mysqlã€mariadb</span><br>    <span class="hljs-symbol">type:</span> <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">DB_TYPE</span><span class="hljs-symbol">:h2</span>&#125;<br>    <span class="hljs-comment"># æ•°æ®åº“è¿æ¥URL</span><br>    <span class="hljs-symbol">url:</span> <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">DB_URL</span><span class="hljs-symbol">:jdbc</span><span class="hljs-symbol">:h2</span><span class="hljs-symbol">:file</span><span class="hljs-symbol">:</span>./data/db;<span class="hljs-variable constant_">MODE</span>=<span class="hljs-title class_">My</span>SQL;<span class="hljs-variable constant_">AUTO_SERVER</span>=<span class="hljs-variable constant_">TRUE</span>&#125;<br>    <span class="hljs-comment"># æ•°æ®åº“ç”¨æˆ·å</span><br>    <span class="hljs-symbol">username:</span> <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">DB_USER</span><span class="hljs-symbol">:</span>&#125;<br>    <span class="hljs-comment"># æ•°æ®åº“å¯†ç </span><br>    <span class="hljs-symbol">password:</span> <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">DB_PASSWORD</span><span class="hljs-symbol">:</span>&#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®(ä¿®æ”¹ä¸ºMySQLæ•°æ®åº“)</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-symbol">data:</span><br>  <span class="hljs-symbol">db:</span><br>    <span class="hljs-comment"># æ•°æ®åº“ç±»å‹ï¼Œç›®å‰æ”¯æŒh2ã€mysqlã€mariadb</span><br>    <span class="hljs-symbol">type:</span> <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">DB_TYPE</span><span class="hljs-symbol">:mysql</span>&#125; <br>    <span class="hljs-symbol">url:</span> <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">DB_URL</span><span class="hljs-symbol">:jdbc</span><span class="hljs-symbol">:mysql</span><span class="hljs-symbol">://localhost</span><span class="hljs-symbol">:</span><span class="hljs-number">3306</span>/neutrino-proxy&#125;<br>    <span class="hljs-comment"># æ•°æ®åº“ç”¨æˆ·å</span><br>    <span class="hljs-symbol">username:</span> <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">DB_USER</span><span class="hljs-symbol">:root</span>&#125;<br>    <span class="hljs-comment"># æ•°æ®åº“å¯†ç </span><br>    <span class="hljs-symbol">password:</span> <span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">DB_PASSWORD</span><span class="hljs-symbol">:yourpassword</span>&#125;<br></code></pre></td></tr></table></figure><p>å…³äºä¸Šé¢çš„é…ç½®é¡¹ï¼Œå¦‚æœä¸æ¸…æ¥šï¼Œå»ºè®®ç›´æ¥ä¸‹è½½Giteeé¡¹ç›®ï¼Œè‡ªå·±æŸ¥çœ‹é¡¹ç›®ä»£ç ï¼Œæœç´¢å¯¹åº”é…ç½®å†…å®¹å‚æ•°ã€‚</p><p>æºç å»ºè®®ä¹Ÿå­¦ä¹ ä¸€ä¸‹ï¼Œå®ƒè¿™é‡Œå¯¹åº”çš„é…ç½®æ–‡ä»¶æ˜¯ï¼šDbConfiguration</p><h4 id="éƒ¨ç½²è¿è¡Œ"><a href="#éƒ¨ç½²è¿è¡Œ" class="headerlink" title="éƒ¨ç½²è¿è¡Œ"></a>éƒ¨ç½²è¿è¡Œ</h4><p>å®é™…æ“ä½œï¼š</p><p>1ã€å°†ä¸‹è½½æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨çš„æŸä¸ªç›®å½•ä¸‹ï¼Œè¿›è¡Œè§£å‹æ“ä½œï¼š</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs axapta">unzip  neutrino-proxy-<span class="hljs-keyword">server</span>-ubuntu<span class="hljs-number">-20.04</span>-native.zip<br><br><span class="hljs-meta">#å¯åŠ¨æœåŠ¡ç«¯å¯æ‰§è¡Œç¨‹åº</span><br>./neutrino-proxy-<span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><ul><li>æœåŠ¡ç«¯éƒ¨ç½²æˆåŠŸåï¼Œè®¿é—®http:&#x2F;&#x2F;{æœåŠ¡ç«¯IP}:8888æ‰“å¼€åå°ç®¡ç†é¡µé¢ã€‚ä½¿ç”¨é»˜è®¤çš„ç®¡ç†å‘˜å¸å·ç™»å½•ï¼šadmin&#x2F;123456</li><li>æ‰“å¼€ä»£ç†é…ç½®&gt;Licenseç®¡ç†é¡µé¢ï¼Œç³»ç»Ÿå·²ç»è‡ªåŠ¨ä¸ºç®¡ç†å‘˜åˆå§‹åŒ–äº†ä¸€æ¡Licenseè®°å½•ï¼Œå¤åˆ¶è¯¥LicenseKeyå¤‡ç”¨ï¼Œåç»­å®¢æˆ·ç«¯é…ç½®éœ€è¦ã€‚</li></ul><p>2ã€å°† exe ç¨‹åºåå°è¿è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">nohup</span> ./neutrino-proxy-server &amp;<br></code></pre></td></tr></table></figure><p><code>nohup</code> å‘½ä»¤ç”¨äºå¿½ç•¥æŒ‚æ–­ä¿¡å·ï¼ˆSIGHUPï¼‰ï¼Œå¹¶ä¸” <code>&amp;</code> ç¬¦å·ç”¨äºå°†ç¨‹åºæ”¾åˆ°åå°è¿è¡Œã€‚</p><p><code>nohup.out</code> æ–‡ä»¶é€šå¸¸ä¼šç”Ÿæˆåœ¨ä½ è¿è¡Œ <code>nohup</code> å‘½ä»¤çš„å½“å‰å·¥ä½œç›®å½•ï¼ˆcurrent working directoryï¼‰ã€‚å¦‚æœä½ æ²¡æœ‰æŒ‡å®šå…·ä½“çš„è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼Œ<code>nohup</code> é»˜è®¤å°†è¾“å‡ºé‡å®šå‘åˆ° <code>nohup.out</code> æ–‡ä»¶</p><p>å…³é—­åå°ç¨‹åº</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment">#æŸ¥çœ‹è¿›ç¨‹å·PID</span><br>ps aux | <span class="hljs-keyword">grep</span> neutrino-proxy-server<br><span class="hljs-comment">#æ€æ­»è¿›ç¨‹</span><br><span class="hljs-keyword">kill</span> &lt;PID&gt;<br></code></pre></td></tr></table></figure><p>åå°è¿è¡Œçš„æ—¶å€™å‘ç°ä½¿ç”¨ xshell ç›´æ¥å¯åŠ¨ç¨‹åºä¼šéšç€å…³é—­ ssh è¿æ¥è€Œä¸­æ–­è¿è¡Œï¼Œè¿™é‡Œæ˜¯é‡‡ç”¨ screen + nohup çš„æ–¹å¼è¿è¡Œç¨‹åºã€‚</p><p>ä¸Šé¢è¿™ç§æ–¹å¼åœ¨å…³é—­ ssh è¿æ¥åï¼Œä¼šè¯ä¸­çš„è¿›ç¨‹å°±ç›´æ¥å…³é—­äº†ã€‚å°è¯•ä¸€ä¸‹ screen çš„ä½¿ç”¨</p><p><code>screen</code> æ˜¯ä¸€ä¸ªç»ˆç«¯å¤ç”¨å·¥å…·ï¼Œå®ƒå…è®¸ä½ åœ¨ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­åˆ›å»ºå¤šä¸ªè™šæ‹Ÿç»ˆç«¯ï¼Œå¹¶åœ¨è¿™äº›è™šæ‹Ÿç»ˆç«¯ä¸­è¿è¡Œä¸åŒçš„ç¨‹åºã€‚é€šè¿‡ä½¿ç”¨ <code>screen</code>ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªä¼šè¯ä¸­ä¿æŒä½ çš„ç¨‹åºåœ¨åå°è¿è¡Œï¼Œå³ä½¿ä½ å…³é—­äº†SSHè¿æ¥ä¹Ÿä¸ä¼šå½±å“è¿™äº›ç¨‹åºçš„æ‰§è¡Œ</p><p>å®‰è£…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">sudo yum <span class="hljs-keyword">install</span> screen<br></code></pre></td></tr></table></figure><ol><li><p><strong>å¯åŠ¨ä¸€ä¸ªæ–°çš„ <code>screen</code> ä¼šè¯ï¼š</strong><br> <code>screen</code><br> è¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>screen</code> ä¼šè¯ï¼Œå¹¶å°†ä½ åˆ‡æ¢åˆ°è¯¥ä¼šè¯ä¸­ã€‚</p></li><li><p><strong>åœ¨ <code>screen</code> ä¼šè¯ä¸­è¿è¡Œä½ çš„ç¨‹åºï¼š</strong></p><p> åœ¨ <code>screen</code> ä¼šè¯ä¸­ï¼Œä½ å¯ä»¥è¿è¡Œä½ çš„ç¨‹åºï¼Œæ¯”å¦‚ï¼š</p><p> <code>./your_program.exe</code><br> å¦‚æœä½ éœ€è¦åœ¨ç¨‹åºåå°è¿è¡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>Ctrl + A</code> ç„¶åæŒ‰ä¸‹ <code>d</code> é”®ï¼Œè¿™ä¼šå°† <code>screen</code> ä¼šè¯æ”¾å…¥åå°ï¼Œä½†ä¼šè¯ä¸­çš„ç¨‹åºä»åœ¨è¿è¡Œã€‚</p></li><li><p><strong>åˆ—å‡º <code>screen</code> ä¼šè¯ï¼š</strong><br> <code>screen -ls</code><br> è¿™å°†æ˜¾ç¤ºå½“å‰æ‰€æœ‰çš„ <code>screen</code> ä¼šè¯ã€‚</p></li><li><p><strong>é‡æ–°è¿æ¥åˆ° <code>screen</code> ä¼šè¯ï¼š</strong></p><p> å¦‚æœä½ å…³é—­äº†ç»ˆç«¯æˆ–æ–­å¼€äº†SSHè¿æ¥ï¼Œä½ å¯ä»¥é‡æ–°è¿æ¥åˆ°ä¹‹å‰åˆ›å»ºçš„ <code>screen</code> ä¼šè¯ï¼š<br> <code>screen -r</code><br> å¦‚æœæœ‰å¤šä¸ªä¼šè¯ï¼Œä½ å¯èƒ½éœ€è¦æŒ‡å®šè¦è¿æ¥çš„ä¼šè¯IDï¼Œä¾‹å¦‚ï¼š<br> <code>screen -r &lt;session_id&gt;</code></p></li><li><p><strong>é€€å‡º <code>screen</code> ä¼šè¯ï¼š</strong></p><p> åœ¨ <code>screen</code> ä¼šè¯ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>exit</code> æˆ–è€… <code>Ctrl + D</code> æ¥é€€å‡ºã€‚</p></li></ol><p>è¿™æ˜¯ <code>screen</code> çš„åŸºæœ¬ç”¨æ³•ã€‚</p><h3 id="3ã€å®¢æˆ·ç«¯éƒ¨ç½²"><a href="#3ã€å®¢æˆ·ç«¯éƒ¨ç½²" class="headerlink" title="3ã€å®¢æˆ·ç«¯éƒ¨ç½²"></a>3ã€å®¢æˆ·ç«¯éƒ¨ç½²</h3><blockquote><p>éƒ¨ç½²å®¢æˆ·ç«¯</p></blockquote><p>éœ€è¦ä¸‹è½½åä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">neutrino:</span><br>  <span class="hljs-attr">proxy:</span><br>    <span class="hljs-attr">tunnel:</span><br>      <span class="hljs-comment"># sslè¯ä¹¦å¯†é’¥ï¼ˆä½¿ç”¨jjaråŒ…å†…è‡ªå¸¦çš„è¯ä¹¦ï¼Œåˆ™æ­¤å¤„æ— éœ€ä¿®æ”¹ï¼‰</span><br>      <span class="hljs-attr">key-store-password:</span> <span class="hljs-number">123456</span><br>      <span class="hljs-comment"># sslè¯ä¹¦ç®¡ç†å¯†é’¥ï¼ˆä½¿ç”¨jjaråŒ…å†…è‡ªå¸¦çš„è¯ä¹¦ï¼Œåˆ™æ­¤å¤„æ— éœ€ä¿®æ”¹ã€‚è‡ªå®šä¹‰è¯ä¹¦ï¼Œåˆ™æ­¤å¤„é…ç½®å¯¹åº”çš„è·¯å¾„ï¼‰</span><br>      <span class="hljs-attr">jks-path:</span> <span class="hljs-string">classpath:/test.jks</span><br>      <span class="hljs-comment"># ä»£ç†æœåŠ¡ç«¯IP</span><br>      <span class="hljs-attr">server-ip:</span> <span class="hljs-string">xxxx</span><br>      <span class="hljs-comment"># ä»£ç†æœåŠ¡ç«¯IP, è‹¥æ˜¯ésslç«¯å£ï¼Œåˆ™ssl-enableéœ€è¦é…ç½®ä¸ºfalse</span><br>      <span class="hljs-attr">server-port:</span> <span class="hljs-number">9002</span><br>      <span class="hljs-comment"># æ˜¯å¦å¯ç”¨ssl</span><br>      <span class="hljs-attr">ssl-enable:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-comment"># licenseKeyï¼Œå®¢æˆ·ç«¯å‡­è¯ã€‚æ­¤å¤„éœ€è¦é…ç½®åˆšåˆšä»ç®¡ç†åå°å¤åˆ¶çš„LicenseKey</span><br>      <span class="hljs-attr">license-key:</span> <span class="hljs-string">xxxx</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ³¨æ„çš„åœ°æ–¹å°±æ˜¯ 9002 è¿™ä¸ªç«¯å£ï¼Œéœ€è¦æˆ‘ä»¬å»çœ‹ä¸€ä¸‹æœåŠ¡å™¨ç«¯çš„é…ç½®æ–‡ä»¶å¯¹åº”çš„ç«¯å£ï¼Œå®ƒé»˜è®¤æ˜¯ 9002 ï¼Œéœ€è¦åœ¨é˜²ç«å¢™ç«¯å£å¼€å¯ä¸€ä¸‹ï¼Œ<strong>æˆ–è€…æ”¹ä¸€ä¸‹è¿™ä¸ªç«¯å£é…ç½®</strong></p><p>å¦‚æœæ˜¯ trueï¼Œå¯¹åº”çš„æ˜¯ SSL_PORT  ä¸‹å‚æ•°</p><p>server-port  â†’  æœåŠ¡ç«¯ç«¯å£(å¯¹åº”æœåŠ¡ç«¯app.ymlä¸­çš„ tunnel.portã€tunnel.ssl-port)</p><p>ç„¶åå¤åˆ¶ä¸€ä¸‹å®¢æˆ·ç«¯å‡­è¯å³å¯</p><p>å¦‚æœå‡ºç°é—®é¢˜ï¼Œå»ºè®®å…ˆåˆ æ‰æ–‡ä»¶é‡æ–°è§£å‹ï¼Œå†é…ç½®ä¸€éï¼Œé‡æ–°å¯åŠ¨ã€‚</p><p>Linux å®¢æˆ·ç«¯é…ç½®åŒç†ã€‚ï¼ˆæ³¨æ„æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹åº”ä¸€ä¸ªå‡­è¯ï¼‰</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">unzip</span>  neutrino-proxy-client-ubuntu-<span class="hljs-number">20</span>.<span class="hljs-number">04</span>-native.zip<br><span class="hljs-attribute">cd</span> neutrino-proxy-client-ubuntu-<span class="hljs-number">20</span>.<span class="hljs-number">04</span>-native<br><br><span class="hljs-attribute">screen</span><br><br><span class="hljs-attribute">nohup</span> ./neutrino-proxy-client &amp;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>computer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Zipkin</title>
    <link href="/2023/12/01/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Sleuth+Zipkin/"/>
    <url>/2023/12/01/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Sleuth+Zipkin/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€ä»€ä¹ˆæ˜¯-Sleuth"><a href="#1ã€ä»€ä¹ˆæ˜¯-Sleuth" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯ Sleuth"></a>1ã€ä»€ä¹ˆæ˜¯ Sleuth</h3><p>Sleuthæ˜¯Spring Cloudçš„ç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒä¸ºSpring Cloudå®ç°äº†ä¸€ç§åˆ†å¸ƒå¼è¿½è¸ªè§£å†³æ–¹æ¡ˆã€‚</p><p>ä¸€èˆ¬æ˜¯å’Œ zipkin æˆ–è€…å…¶ä»–åŸºäºæ—¥å¿—çš„è¿½è¸ªç³»ç»Ÿä¸€èµ·ä½¿ç”¨çš„ã€‚</p><p>ç®€å•ç†è§£ï¼šsleuth æ˜¯é“¾è·¯è¿½è¸ªå™¨ï¼Œå°†é“¾è·¯ä¿¡æ¯æ”¾åˆ°æ—¥å¿—ä¸­ï¼Œzipkin æ˜¯é“¾è·¯åˆ†æå™¨ï¼Œå°†é“¾è·¯æ—¥å¿—è¿›è¡Œå¯è§†åŒ–åˆ†æå’Œèšåˆæ£€ç´¢ã€‚</p><h3 id="2ã€Zipkinæ˜¯ä»€ä¹ˆ"><a href="#2ã€Zipkinæ˜¯ä»€ä¹ˆ" class="headerlink" title="2ã€Zipkinæ˜¯ä»€ä¹ˆ"></a>2ã€Zipkinæ˜¯ä»€ä¹ˆ</h3><p>Zipkinæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿã€‚å®ƒæœ‰åŠ©äºæ”¶é›†å¯¹æœåŠ¡æ¶æ„ä¸­çš„å»¶è¿Ÿé—®é¢˜è¿›è¡Œæ•…éšœæ’é™¤æ‰€éœ€çš„è®¡æ—¶æ•°æ®ã€‚åŠŸèƒ½åŒ…æ‹¬æ”¶é›†å’ŒæŸ¥æ‰¾è¿™äº›æ•°æ®ã€‚</p><p>Zipkin is a distributed tracing system. It helps gather timing data needed to troubleshoot latency problems in service architectures. Features include both the collection and lookup of this data.</p><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œéšç€ä¸šåŠ¡çš„ä¸æ–­æ‰©å¼ ï¼ŒæœåŠ¡ä¹‹é—´äº’ç›¸è°ƒç”¨ä¼šè¶Šæ¥è¶Šå¤æ‚ã€‚è€ŒZipkinèƒ½æ”¶é›†æœåŠ¡ä¸­çš„ä¸€äº›æ•°æ®ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡æ˜æ˜¾çš„å¯è§†åŒ–æ•ˆæœå»æŸ¥çœ‹é“¾è·¯ä¸­çš„æƒ…å†µï¼ˆæ”¯æŒæ—¥å¿—èšåˆï¼Œè¿›è¡Œå¯è§†åŒ–å±•ç¤ºå’Œå…¨æ–‡æ£€ç´¢ï¼‰ã€‚</p><p><strong>åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼ˆDistributed Tracingï¼‰</strong>ï¼š å°†ä¸€æ¬¡åˆ†å¸ƒå¼è¯·æ±‚è¿˜åŸæˆè°ƒç”¨é“¾è·¯ï¼Œè¿›è¡Œæ—¥å¿—è®°å½•ï¼Œæ€§èƒ½ç›‘æ§å¹¶å°†ä¸€æ¬¡åˆ†å¸ƒå¼è¯·æ±‚çš„è°ƒç”¨æƒ…å†µé›†ä¸­å±•ç¤ºã€‚æ¯”å¦‚å„ä¸ªæœåŠ¡èŠ‚ç‚¹ä¸Šçš„è€—æ—¶ã€è¯·æ±‚å…·ä½“åˆ°è¾¾å“ªå°æœºå™¨ä¸Šã€æ¯ä¸ªæœåŠ¡èŠ‚ç‚¹çš„è¯·æ±‚çŠ¶æ€ç­‰ç­‰ã€‚</p><p>å¸¸ç”¨çš„é“¾è·¯è¿½è¸ªæŠ€æœ¯è¿˜æœ‰å¥½å‡ ç§ï¼Œæœ‰å…´è¶£å¯ä»¥å»äº†è§£ä¸€ä¸‹ã€‚</p><ul><li><a href="https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/">https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/</a></li><li><a href="https://logging.apache.org/log4j/2.x/">https://logging.apache.org/log4j/2.x/</a></li><li><a href="https://github.com/pinpoint-apm/pinpoint">https://github.com/pinpoint-apm/pinpoint</a></li></ul><hr><h3 id="3ã€Sleuthå…¥é—¨"><a href="#3ã€Sleuthå…¥é—¨" class="headerlink" title="3ã€Sleuthå…¥é—¨"></a>3ã€Sleuthå…¥é—¨</h3><blockquote><p>Sleuth æœ¯è¯­</p></blockquote><ul><li>Trace (ä¸€æ¡å®Œæ•´é“¾è·¯â€“åŒ…å«å¾ˆå¤šspan(å¾®æœåŠ¡æ¥å£))<ul><li>ç”±ä¸€ç»„Trace Idï¼ˆè´¯ç©¿æ•´ä¸ªé“¾è·¯ï¼‰ç›¸åŒçš„Spanä¸²è”å½¢æˆä¸€ä¸ªæ ‘çŠ¶ç»“æ„ã€‚ä¸ºäº†å®ç°è¯·æ±‚è·Ÿè¸ªï¼Œå½“è¯·æ±‚åˆ°è¾¾åˆ†å¸ƒå¼ç³»ç»Ÿçš„å…¥å£ç«¯ç‚¹æ—¶ï¼Œåªéœ€è¦æœåŠ¡è·Ÿè¸ªæ¡†æ¶ä¸ºè¯¥è¯·æ±‚åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ï¼ˆå³TraceIdï¼‰ï¼ŒåŒæ—¶åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå†…éƒ¨æµè½¬çš„æ—¶å€™ï¼Œæ¡†æ¶å§‹ç»ˆä¿æŒä¼ é€’è¯¥å”¯ä¸€å€¼ï¼Œç›´åˆ°æ•´ä¸ªè¯·æ±‚çš„è¿”å›ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¯¥å”¯ä¸€æ ‡è¯†å°†æ‰€æœ‰çš„è¯·æ±‚ä¸²è”èµ·æ¥ï¼Œå½¢æˆä¸€æ¡å®Œæ•´çš„è¯·æ±‚é“¾è·¯ã€‚</li></ul></li><li>Span<ul><li>ä»£è¡¨äº†ä¸€ç»„åŸºæœ¬çš„å·¥ä½œå•å…ƒã€‚ä¸ºäº†ç»Ÿè®¡å„å¤„ç†å•å…ƒçš„å»¶è¿Ÿï¼Œå½“è¯·æ±‚åˆ°è¾¾å„ä¸ªæœåŠ¡ç»„ä»¶çš„æ—¶å€™ï¼Œä¹Ÿé€šè¿‡ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼ˆSpanIdï¼‰æ¥æ ‡è®°å®ƒçš„å¼€å§‹ã€å…·ä½“è¿‡ç¨‹å’Œç»“æŸã€‚é€šè¿‡SpanIdçš„å¼€å§‹å’Œç»“æŸæ—¶é—´æˆ³ï¼Œå°±èƒ½ç»Ÿè®¡è¯¥spançš„è°ƒç”¨æ—¶é—´ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è·å–å¦‚äº‹ä»¶çš„åç§°ã€‚è¯·æ±‚ä¿¡æ¯ç­‰å…ƒæ•°æ®ã€‚</li></ul></li><li>Annotation<ul><li>ç”¨å®ƒè®°å½•ä¸€æ®µæ—¶é—´å†…çš„äº‹ä»¶ï¼Œå†…éƒ¨ä½¿ç”¨çš„é‡è¦æ³¨é‡Šï¼š<ul><li>csï¼ˆClient Sendï¼‰å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ï¼Œå¼€å§‹ä¸€ä¸ªè¯·æ±‚çš„ç”Ÿå‘½</li><li>srï¼ˆServer Receivedï¼‰æœåŠ¡ç«¯æ¥å—åˆ°è¯·æ±‚å¼€å§‹è¿›è¡Œå¤„ç†ï¼Œ srï¼cs &#x3D; ç½‘ç»œå»¶è¿Ÿï¼ˆæœåŠ¡è°ƒç”¨çš„æ—¶é—´ï¼‰</li><li>ssï¼ˆServer Sendï¼‰æœåŠ¡ç«¯å¤„ç†å®Œæ¯•å‡†å¤‡å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œss - sr &#x3D; æœåŠ¡å™¨ä¸Šçš„è¯·æ±‚å¤„ç†æ—¶é—´</li><li>crï¼ˆClient Reveivedï¼‰å®¢æˆ·ç«¯æ¥å—åˆ°æœåŠ¡ç«¯çš„å“åº”ï¼Œè¯·æ±‚ç»“æŸã€‚ cr - sr &#x3D; è¯·æ±‚çš„æ€»æ—¶é—´</li></ul></li></ul></li></ul><blockquote><p>Sleuth ä½¿ç”¨</p></blockquote><p>åœ¨pom.xmlæ–‡ä»¶æ·»åŠ Sleuthä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-comment">&lt;!--sleuthä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é¡¹ç›®æ•´åˆ sleuth åï¼Œåœ¨æ—¥å¿—è¾“å‡ºä¼šå¤šä¸€äº›é“¾è·¯ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬åœ¨å¯åŠ¨è¿™ä¸ªå¾®æœåŠ¡åï¼Œè°ƒç”¨å…¶ä¸­æŸä¸ªè¯·æ±‚ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°è§‚å¯Ÿåˆ°sleuthçš„æ—¥å¿—è¾“å‡º</p><h3 id="4ã€é“¾è·¯è§£å†³æ–¹æ¡ˆ-Sleuth-Zipkin"><a href="#4ã€é“¾è·¯è§£å†³æ–¹æ¡ˆ-Sleuth-Zipkin" class="headerlink" title="4ã€é“¾è·¯è§£å†³æ–¹æ¡ˆ SleuthÂ +Â Zipkin"></a>4ã€é“¾è·¯è§£å†³æ–¹æ¡ˆ <strong>Sleuth</strong>Â +Â <strong>Zipkin</strong></h3><p>ä½¿ç”¨ Zipkin éœ€è¦ä¸‹è½½ä¸€ä¸‹ä»–çš„æœåŠ¡ç«¯ï¼š <a href="https://zipkin.io/pages/quickstart.html">https://zipkin.io/pages/quickstart.html</a></p><p>å®˜æ–¹æ–‡æ¡£é‡Œé¢æœ‰ä»‹ç»ä»–å¯¹åº”çš„ä¸‹è½½å’Œå¯åŠ¨æ–¹å¼ã€‚</p><p>é€šè¿‡æµè§ˆå™¨è®¿é—®Â <a href="http://localhost:9411/">http://localhost:9411</a>è®¿é—®</p><p>Zipkin è·Ÿ Nacos ç±»ä¼¼ï¼Œéœ€è¦å¯åŠ¨ä»–çš„æœåŠ¡ç«¯ç¨‹åºï¼Œå¹¶åœ¨å¾®æœåŠ¡æ¨¡å—ä¸­æ·»åŠ å®¢æˆ·ç«¯ç›¸å…³çš„é…ç½®ã€‚</p><blockquote><p><strong>Sleuth</strong>Â +Â <strong>Zipkin</strong> é›†æˆ</p></blockquote><p>è¿™é‡Œæ˜¯é€‰ç”¨ ZipKinå®¢æˆ·ç«¯å’ŒSleuth è¿›è¡Œé›†æˆã€‚</p><p>ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#é…ç½®zipkin</span><br>  <span class="hljs-attr">zipkin:</span><br>    <span class="hljs-attr">base-url:</span> <span class="hljs-string">http://192.168.31.60:9411</span><br>    <span class="hljs-attr">discovery-client-enabled:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># ä¸è¦è®©nacosæŠŠzipkinæ³¨å†Œè¿›å»ï¼ˆå¯ä»¥ä¸å†™ï¼‰</span><br>  <span class="hljs-attr">sleuth:</span><br>    <span class="hljs-attr">sampler:</span><br>      <span class="hljs-attr">probability:</span> <span class="hljs-number">1.0</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨åï¼Œä¾¿å¯ä»¥åœ¨ Zipkin è§‚å¯Ÿè¯¥æœåŠ¡ä¸‹çš„è¯·æ±‚é“¾è·¯ã€‚</p><blockquote><p>æŒä¹…åŒ–æ“ä½œ</p></blockquote><p>Zipkin é»˜è®¤æ˜¯å°†æ•°æ®ä¿å­˜åˆ°å†…å­˜ï¼Œç”Ÿäº§ç¯å¢ƒä¸€èˆ¬æ˜¯é€‰æ‹©æŒä¹…åŒ–åˆ°æœ¬åœ°ã€‚</p><p><strong>Zipkin</strong>Â æä¾›å¯æ’æ‹”æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œä¸‹é¢è¿™äº›éƒ½æ”¯æŒï¼šIn-Memoryã€MySqlã€Cassandra ä»¥åŠ Elasticsearchã€‚</p><blockquote><p>ä½¿ç”¨mysqlå®ç°æ•°æ®æŒä¹…åŒ–æ“ä½œ</p></blockquote><p>ç•¥ï¼Œå¾…æ›´æ–°</p><p>to be continedâ€¦.</p><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://zipkin.io/pages/quickstart">https://zipkin.io/pages/quickstart</a></li><li><a href="https://blog.csdn.net/qq_40587263/article/details/117338097">https://blog.csdn.net/qq_40587263/article/details/117338097</a></li><li><a href="https://zhuanlan.zhihu.com/p/71024024">https://zhuanlan.zhihu.com/p/71024024</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springcloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDB_åŸºæœ¬æ“ä½œ</title>
    <link href="/2023/11/30/MongoDB_%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
    <url>/2023/11/30/MongoDB_%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<p>mongodb çš„æ•°æ®åº“ä¸­çš„ä¸€ç§ï¼Œæ˜¯é¢å‘æ–‡æ¡£å­˜å‚¨çš„æ•°æ®åº“ï¼›</p><p>ä»–çš„æ¦‚å¿µå’Œå…³ç³»å‹æ•°æ®æœ‰äº›åŒºåˆ«ã€‚</p><p>è·Ÿ MySQL ç±»ä¼¼ï¼Œä»–èƒ½å¤Ÿæ‰§è¡Œ CRUDï¼Œäº‹åŠ¡ï¼Œç´¢å¼• ç­‰æ“ä½œã€‚</p><p>åœ¨æŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œå¯¹äºé«˜å¹¶å‘ã€æµ·é‡æ•°æ®è¯»å†™ã€é«˜å¯ç”¨ã€æå¯æ‰©å±•æœ‰éœ€æ±‚ï¼Œæ•°æ®é‡å¤§ï¼Œå†™å…¥é¢‘ç‡ï¼Œä»·å€¼è¾ƒä½ï¼Œå¯¹äº‹åŠ¡æ€§è¦æ±‚ä¸é«˜çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ MongoDBæ¥å®ç°æ•°æ®çš„å­˜å‚¨ã€‚</p><h4 id="ä½“ç³»ç»“æ„"><a href="#ä½“ç³»ç»“æ„" class="headerlink" title="ä½“ç³»ç»“æ„"></a>ä½“ç³»ç»“æ„</h4><ul><li>database collectino document  field index</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311301336438.png" alt="image.png"></p><blockquote><p>ä»€ä¹ˆæ˜¯ MongoDB </p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/feb9bb3170c4dbf4d079301e2e2b7f6.png" alt="feb9bb3170c4dbf4d079301e2e2b7f6.png"></p><h4 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h4><p>åœ¨Spring Bootåº”ç”¨ä¸­é›†æˆMongoDBæ¥è¿›è¡Œæ•°æ®çš„CRUDæ“ä½œ</p><p>é¦–å…ˆï¼Œåœ¨ä½ çš„<code>pom.xml</code>æ–‡ä»¶ä¸­æ·»åŠ Spring Bootçš„Starter Data MongoDBä¾èµ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- æ·»åŠ Spring Bootçš„Webæ”¯æŒ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨<code>application.properties</code>æˆ–<code>application.yml</code>é…ç½®æ–‡ä»¶ä¸­é…ç½®MongoDBçš„è¿æ¥ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># application.properties</span><br>spring.data.mongodb.uri=mongodb://yourUsername:yourPassword@localhost:27017/yourDatabase<br></code></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨YAMLæ ¼å¼ï¼š</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-meta"># application.yml</span><br><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol">  data:</span><br><span class="hljs-symbol">    mongodb:</span><br><span class="hljs-symbol">      uri:</span> mongodb:<span class="hljs-comment">//yourUsername:yourPassword@localhost:27017/yourDatabase</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºå®ä½“ç±»</p><p>å®šä¹‰ä¸€ä¸ªMongoDBçš„æ–‡æ¡£ç±»ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.<span class="hljs-keyword">annotation</span>.Id;<br><span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.mongodb.core.mapping.Document;<br><br><span class="hljs-meta">@Document</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> String id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <br>    <span class="hljs-comment">// çœç•¥æ„é€ å‡½æ•°ã€Getterå’ŒSetteræ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç»§æ‰¿<code>MongoRepository</code>çš„æ¥å£ç”¨äºæ•°æ®è®¿é—®ã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">UserRepository</span> <span class="hljs-symbol">extends</span> <span class="hljs-symbol">MongoRepository</span>&lt;<span class="hljs-symbol">User</span>, <span class="hljs-symbol">String</span>&gt; &#123;<br>    <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å®šä¹‰ä¸€äº›æ ¹æ®å­—æ®µæŸ¥è¯¢çš„æ–¹æ³•ï¼ŒSpring Dataä¼šè‡ªåŠ¨å®ç°</span><br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªRESTæ§åˆ¶å™¨æ¥å¤„ç†HTTPè¯·æ±‚ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;<br><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">annotation</span>.*;<br><br><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">List</span>;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">&quot;/users&quot;</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserRepository</span> userRepository;<br>    <br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span> <span class="hljs-title function_">addUser</span>(<span class="hljs-params"><span class="hljs-meta">@RequestBody</span> User user</span>) &#123;<br>        <span class="hljs-keyword">return</span> userRepository.<span class="hljs-title function_">save</span>(user);<br>    &#125;<br>    <br>    <span class="hljs-meta">@GetMapping</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">User</span>&gt; <span class="hljs-title function_">getUsers</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> userRepository.<span class="hljs-title function_">findAll</span>();<br>    &#125;<br>    <br>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span> <span class="hljs-title function_">getUserById</span>(<span class="hljs-params"><span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">String</span> id</span>) &#123;<br>        <span class="hljs-keyword">return</span> userRepository.<span class="hljs-title function_">findById</span>(id).<span class="hljs-title function_">orElse</span>(<span class="hljs-literal">null</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@PutMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">User</span> <span class="hljs-title function_">updateUser</span>(<span class="hljs-params"><span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">String</span> id, <span class="hljs-meta">@RequestBody</span> User updatedUser</span>) &#123;<br>        updatedUser.<span class="hljs-title function_">setId</span>(id);<br>        <span class="hljs-keyword">return</span> userRepository.<span class="hljs-title function_">save</span>(updatedUser);<br>    &#125;<br>    <br>    <span class="hljs-meta">@DeleteMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params"><span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">String</span> id</span>) &#123;<br>        userRepository.<span class="hljs-title function_">deleteById</span>(id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/efew212efe/article/details/124524863">https://blog.csdn.net/efew212efe/article/details/124524863</a></li><li><a href="https://www.mongodb.com/docs/manual/">https://www.mongodb.com/docs/manual/</a></li><li><a href="https://www.runoob.com/mongodb/mongodb-tutorial.html">https://www.runoob.com/mongodb/mongodb-tutorial.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>MongoDB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mongodb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windowså¸¸ç”¨æ“ä½œ</title>
    <link href="/2023/11/30/windows%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    <url>/2023/11/30/windows%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h4 id="æŸ¥çœ‹çº¿ç¨‹"><a href="#æŸ¥çœ‹çº¿ç¨‹" class="headerlink" title="æŸ¥çœ‹çº¿ç¨‹"></a>æŸ¥çœ‹çº¿ç¨‹</h4><blockquote><p>windows_æŸ¥çœ‹ç«¯å£è¢«å ç”¨æƒ…å†µã€ç»“æŸè¿›ç¨‹</p></blockquote><p>æŸ¥çœ‹æŒ‡å®šç«¯å£å ç”¨æƒ…å†µï¼ˆç«¯å£å¼•å·æœ‰æ²¡æœ‰éƒ½å¯ä»¥ï¼Œæ­¤å¤„ä»¥5040ä¸ºä¾‹ï¼‰</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">netstat -aon<span class="hljs-string">|findstr 5040</span><br></code></pre></td></tr></table></figure><p>æ ¹æ®PIDæŸ¥çœ‹ç›¸åº”çš„è¿›ç¨‹æˆ–ç¨‹åº(ä¹Ÿå¯ä»¥ä»»åŠ¡ç®¡ç†å™¨æŸ¥çœ‹)</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">tasklist<span class="hljs-string">|findstr 5340</span><br></code></pre></td></tr></table></figure><p>ç»“æŸè¿›ç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">taskkill /f /t /im è¿›ç¨‹å<br></code></pre></td></tr></table></figure><h4 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h4><p>é¦–å…ˆï¼Œç¡®ä¿æ‚¨çš„ Windows æœºå™¨ä¸Šå®‰è£…äº† Telnet å®¢æˆ·ç«¯ã€‚å¦‚æœæœªå®‰è£…ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥å®‰è£…ï¼š</p><ol><li>æ‰“å¼€â€œæ§åˆ¶é¢æ¿â€ã€‚</li><li>é€‰æ‹©â€œç¨‹åºâ€æˆ–â€œç¨‹åºå’ŒåŠŸèƒ½â€ã€‚</li><li>ç‚¹å‡»â€œå¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½â€ã€‚</li><li>åœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼Œæ‰¾åˆ°â€œTelnet å®¢æˆ·ç«¯â€ï¼Œå‹¾é€‰å®ƒï¼Œç„¶åç‚¹å‡»â€œç¡®å®šâ€å®Œæˆå®‰è£…ã€‚</li></ol><p>å®‰è£…åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥æŸä¸ªç«¯å£ï¼ˆä¾‹å¦‚ TCP ç«¯å£ 9876ï¼‰æ˜¯å¦å¯ä»¥ä»æ‚¨çš„è®¡ç®—æœºè®¿é—®ç‰¹å®šçš„ IP åœ°å€ï¼ˆä¾‹å¦‚ 192.168.56.105ï¼‰ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">telnet</span> <span class="hljs-number">192.168.56.105</span> <span class="hljs-number">9876</span><br></code></pre></td></tr></table></figure><p>å¦‚æœè¿æ¥æˆåŠŸï¼ŒTelnet é€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªç©ºç™½å±å¹•æˆ–ç›¸åº”çš„æ¬¢è¿æ¶ˆæ¯ã€‚å¦‚æœè¿æ¥å¤±è´¥ï¼ŒTelnet ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œæ¯”å¦‚è¯´â€œæ— æ³•æ‰“å¼€åˆ°ä¸»æœºçš„è¿æ¥ã€‚ åœ¨ç«¯å£ 9876: è¿æ¥å¤±è´¥ã€‚â€</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>computer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vimå¸¸ç”¨æ“ä½œ</title>
    <link href="/2023/11/29/vim%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"/>
    <url>/2023/11/29/vim%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h4 id="é€€å‡ºç¼–è¾‘å™¨"><a href="#é€€å‡ºç¼–è¾‘å™¨" class="headerlink" title="é€€å‡ºç¼–è¾‘å™¨"></a>é€€å‡ºç¼–è¾‘å™¨</h4><ul><li>wqï¼šä¿å­˜å½“å‰æ–‡ä»¶å¹¶é€€å‡º</li><li>wqaï¼šä¿å­˜æ‰€æœ‰æ–‡ä»¶å¹¶é€€å‡º</li><li>q!ï¼š ä¸ä¿å­˜ï¼Œå¼ºåˆ¶é€€å‡º</li><li>qa!ï¼š æœ‰å¤šä¸ªæ–‡ä»¶è¢«æ‰“å¼€ï¼ŒåŒæ—¶é€€å‡º</li></ul><hr><p>å‚è€ƒ</p><ul><li><a href="https://zhuanlan.zhihu.com/p/89042423">https://zhuanlan.zhihu.com/p/89042423</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
      <tag>vim</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springå­¦ä¹ _åŸºç¡€å†…å®¹</title>
    <link href="/2023/11/27/Spring%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/"/>
    <url>/2023/11/27/Spring%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¤§çº²</p></blockquote><ul><li>Spring æ¦‚å¿µ</li><li>å¸¸ç”¨æ¨¡å—</li><li>IOC</li><li>AOP</li><li>Spring äº‹åŠ¡</li><li>Spring MVC</li></ul><h3 id="Spring-ä»‹ç»"><a href="#Spring-ä»‹ç»" class="headerlink" title="Spring ä»‹ç»"></a>Spring ä»‹ç»</h3><blockquote><p>ä»€ä¹ˆæ˜¯Spring</p></blockquote><p>Spring æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¼€æºJavaå¼€å‘æ¡†æ¶ï¼Œæ—¨åœ¨æé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡ä»¥åŠç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¸¸è¯´çš„ Spring æ¡†æ¶æŒ‡çš„æ˜¯ Spring Framework, ä»–æ˜¯å¤šæ¨¡å—çš„ä¸€ä¸ªé›†åˆï¼Œè¿™äº›æ¨¡å—èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿çš„å¸®åŠ©æˆ‘ä»¬æ¥è¿›è¡Œå¼€å‘ã€‚</p><p>Spring æœ‰å¾ˆå¤šç‰¹æ€§ï¼Œä¹Ÿæ”¯æŒå¾ˆå¤šåŠŸèƒ½ï¼Œäº†è§£Spring æ¡†æ¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä»å®ƒæ”¯æŒçš„ IOC å’Œ AOP è¿™ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½æ¥æœ€å¼€å§‹è®¤è¯†å®ƒã€‚</p><p><strong>ç›®å‰Spring æœ€å¤§çš„ä¸€ä¸ªä¼˜åŠ¿æ˜¯å®ƒæ„å»ºäº†ä¸€ä¸ªéå¸¸ä¸é”™çš„Javaç”Ÿæ€ï¼Œä½ èƒ½å¤Ÿåœ¨è¿™é‡Œé¢æ‰¾åˆ°ä¸åŒéœ€æ±‚éœ€è¦çš„å¤„ç†æ–¹æ¡ˆã€‚</strong></p><p>Spring çš„å®˜ç½‘ï¼š <a href="https://spring.io/">https://spring.io/</a></p><p>Githubåœ°å€ï¼š <a href="https://github.com/spring-projects/spring-framework">https://github.com/spring-projects/spring-framework</a></p><p>Spring çš„å…·ä½“æ¨¡å—å¯ä»¥æ”¾åé¢äº†è§£ï¼Œä¸»è¦æ¨¡å—äº†è§£ä¸‹ã€‚</p><p>Spring 5.x ä¸»è¦æ¨¡å—</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231201212051.png" alt="image.png"><br>å„ä¸ªæ¨¡å—çš„ä¾èµ–å…³ç³»</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231201212107.png" alt="image.png"></p><blockquote><p>Core Container</p></blockquote><p>å…¶ä¸­ä¸»è¦æ¨¡å—ä¸­ï¼ŒCore Container  æ˜¯ Spring æ¡†æ¶çš„æ ¸å¿ƒæ¨¡å—ï¼Œä¹Ÿæ˜¯åŸºç¡€æ¨¡å—ï¼Œå®ƒæä¾›äº† IOC çš„ä¾èµ–æ³¨å…¥åŠŸèƒ½ï¼ŒSpring çš„<strong>å…¶ä»–æ¨¡å—å®ç°çš„åŠŸèƒ½ä¹Ÿæ˜¯åœ¨ä¾èµ–è¯¥æ¨¡å—çš„åŸºç¡€ä¸Šè¿›è¡Œå®ç°çš„</strong>ã€‚</p><p>Core Container çš„å­æ¨¡å—ï¼š</p><ul><li><strong>spring-core</strong>ï¼šSpring æ¡†æ¶åŸºæœ¬çš„æ ¸å¿ƒå·¥å…·ç±»ã€‚</li><li><strong>spring-beans</strong>ï¼šæä¾›å¯¹ bean çš„åˆ›å»ºã€é…ç½®å’Œç®¡ç†ç­‰åŠŸèƒ½çš„æ”¯æŒã€‚</li><li><strong>spring-context</strong>ï¼šæä¾›å¯¹å›½é™…åŒ–ã€äº‹ä»¶ä¼ æ’­ã€èµ„æºåŠ è½½ç­‰åŠŸèƒ½çš„æ”¯æŒã€‚</li><li><strong>spring-expression</strong>ï¼šæä¾›å¯¹è¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼‰ SpEL çš„æ”¯æŒï¼Œåªä¾èµ–äº core æ¨¡å—ï¼Œä¸ä¾èµ–äºå…¶ä»–æ¨¡å—ï¼Œå¯ä»¥å•ç‹¬ä½¿ç”¨</li></ul><blockquote><p>AOP</p></blockquote><ul><li><strong>spring-aspects</strong>ï¼šè¯¥æ¨¡å—ä¸ºä¸ AspectJ çš„é›†æˆæä¾›æ”¯æŒã€‚</li><li><strong>spring-aop</strong>ï¼šæä¾›äº†é¢å‘åˆ‡é¢çš„ç¼–ç¨‹å®ç°ã€‚</li><li><strong>spring-instrument</strong>ï¼šæä¾›äº†ä¸º JVM æ·»åŠ ä»£ç†ï¼ˆagentï¼‰çš„åŠŸèƒ½ã€‚ å…·ä½“æ¥è®²ï¼Œå®ƒä¸º Tomcat æä¾›äº†ä¸€ä¸ªç»‡å…¥ä»£ç†ï¼Œèƒ½å¤Ÿä¸º Tomcat ä¼ é€’ç±»æ–‡ ä»¶ï¼Œå°±åƒè¿™äº›æ–‡ä»¶æ˜¯è¢«ç±»åŠ è½½å™¨åŠ è½½çš„ä¸€æ ·ã€‚(è¿™ä¸ªæ¨¡å—çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™)</li></ul><h3 id="Spring-å¾ªç¯ä¾èµ–-ğŸš©"><a href="#Spring-å¾ªç¯ä¾èµ–-ğŸš©" class="headerlink" title="Spring å¾ªç¯ä¾èµ–  ğŸš©"></a>Spring å¾ªç¯ä¾èµ–  ğŸš©</h3><p>å‚è€ƒï¼š <a href="https://wx.zsxq.com/dweb2/index/columns/48418884588288">https://wx.zsxq.com/dweb2/index/columns/48418884588288</a></p><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/system-design/framework/spring/spring-knowledge-and-questions-summary.html">https://javaguide.cn/system-design/framework/spring/spring-knowledge-and-questions-summary.html</a></li><li><a href="https://www.pdai.tech/md/spring/spring.html">https://www.pdai.tech/md/spring/spring.html</a></li><li><a href="https://blog.csdn.net/Mixzi/article/details/123980213">https://blog.csdn.net/Mixzi/article/details/123980213</a></li><li><a href="https://www.moguit.cn/info/794">https://www.moguit.cn/info/794</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ¡†æ¶</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windowsæ—§ç”µè„‘é‡è£…CentOs7ç³»ç»Ÿåˆ¶ä½œä¸ºä¸ªäººæœåŠ¡å™¨</title>
    <link href="/2023/11/26/%E6%97%A7%E7%94%B5%E8%84%91%E6%94%B9%E9%80%A0%E4%B8%BA%E4%B8%AA%E4%BA%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <url>/2023/11/26/%E6%97%A7%E7%94%B5%E8%84%91%E6%94%B9%E9%80%A0%E4%B8%BA%E4%B8%AA%E4%BA%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<p>å¦‚æœéœ€è¦å°†ä¸€å° winodws ç”µè„‘é‡è£…ä¸º centos ç³»ç»Ÿï¼Œéœ€è¦åˆ†ä¸ºä¸‹é¢å‡ æ­¥</p><ul><li>1ã€å…ˆå¯¹ windows è¿›è¡Œç£ç›˜æ ¼å¼åŒ–æ“ä½œ</li><li>2ã€é€šè¿‡ iso æ–‡ä»¶è¿›è¡Œå¯¹æŸä¸ªUç›˜åˆ»å½•æ“ä½œ</li><li>3ã€ç”µè„‘é€šè¿‡è¿™ä¸ªUç›˜è¿›è¡Œå®‰è£… centos ç³»ç»Ÿ</li><li>4ã€åŸºæœ¬é…ç½®ä¸ä½¿ç”¨</li></ul><p>å…·ä½“æ“ä½œè§å¦‚ä¸‹å†…å®¹ï¼š</p><h3 id="1ã€æ ¼å¼åŒ–windows-çš„ç›˜ç¬¦"><a href="#1ã€æ ¼å¼åŒ–windows-çš„ç›˜ç¬¦" class="headerlink" title="1ã€æ ¼å¼åŒ–windows çš„ç›˜ç¬¦"></a>1ã€æ ¼å¼åŒ–windows çš„ç›˜ç¬¦</h3><p>é‡æ–°å®‰è£… centos ç³»ç»Ÿå‰ï¼Œéœ€è¦åœ¨ window ç³»ç»Ÿä¸‹å…ˆè¿›å…¥PEç¯å¢ƒï¼Œå°†åŸæ¥è£…æœ‰Windowsç³»ç»Ÿçš„ç›˜ç¬¦ä½¿ç”¨åˆ†åŒºå·¥å…·æ ¼å¼åŒ–ä¸ºFAT32æ ¼å¼.</p><blockquote><p>åˆ¶ä½œUç›˜å¯åŠ¨ç›˜</p></blockquote><p>ä½¿ç”¨è€æ¯›æ¡ƒUç›˜å¯åŠ¨å·¥å…·åˆ¶ä½œUç›˜å¯åŠ¨ç›˜:  <a href="http://lmt.psydrj.com/udisk.html">http://lmt.psydrj.com/udisk.html</a></p><p>æ¨¡å¼é€‰æ‹©USBâ€”HDDï¼Œæ ¼å¼é€‰æ‹©â€œNTFSâ€ï¼›åˆ¶ä½œå®Œæˆåï¼Œå¯ä»¥é€‰æ‹©æ¨¡æ‹Ÿå¯åŠ¨æµ‹è¯•ï¼Œè‹¥èƒ½å¤Ÿè¿›å…¥è€æ¯›æ¡ƒwinpeä¸»èœå•ï¼Œå³è¡¨ç¤ºè€æ¯›æ¡ƒUç›˜å¯åŠ¨ç›˜åˆ¶ä½œæˆåŠŸã€‚ã€è¿™é‡Œä¸»è¦æ˜¯è¦ç”¨åˆ°ä»–çš„ç¬¬å››ä¸ª DiskGenius å·¥å…·ã€‘</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231126214740.png" alt="image.png"></p><p>é‡æ–°å¯åŠ¨ç”µè„‘ï¼Œè¿›å…¥bios</p><p>ç•Œé¢ä¼šè®©ä½ é€‰æ‹©ä¸€ä¸ª boot device ï¼Œä½ è¿™é‡Œæ ¹æ®è‹±æ–‡é€‰æ‹©ä¸€ä¸‹ U ç›˜å¯åŠ¨ï¼ˆç•Œé¢æ˜¯æ˜¾ç¤ºçš„Uç›˜åç§°ï¼‰</p><p>ç„¶åä¼šè¿›å…¥åˆ°ä¸Šé¢å›¾ç‰‡çš„å†…å®¹ï¼ˆé€‰æ‹©  DiskGenius ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231126220736.png" alt="image.png"></p><p>é€‰æ‹©å¿«é€Ÿåˆ†åŒºï¼Œé€‰æ‹©åˆ†åŒºç±»å‹FAT32ï¼Œé€‰æ‹© 1 ä¸ªåˆ†åŒºï¼Œ</p><h3 id="2ã€é‡è£…-centos-ç³»ç»Ÿ"><a href="#2ã€é‡è£…-centos-ç³»ç»Ÿ" class="headerlink" title="2ã€é‡è£… centos ç³»ç»Ÿ"></a>2ã€é‡è£… centos ç³»ç»Ÿ</h3><p>ä¸‹è½½å¥½ centos7 çš„é•œåƒæ–‡ä»¶ï¼š </p><ul><li><a href="https://man.linuxde.net/download/CentOS_7_4">https://man.linuxde.net/download/CentOS_7_4</a></li><li><a href="http://mirrors.aliyun.com/centos/7/isos/x86_64/">http://mirrors.aliyun.com/centos/7/isos/x86_64/</a></li></ul><h4 id="åˆ»å½•æ“ä½œ"><a href="#åˆ»å½•æ“ä½œ" class="headerlink" title="åˆ»å½•æ“ä½œ"></a>åˆ»å½•æ“ä½œ</h4><p>ä¸‹è½½ UltraISO è½¯ç¢Ÿé€š </p><p>æ ¼å¼åŒ–ä¹‹å‰çš„Uç›˜ï¼Œæ ¼å¼åŒ–ä¸º FAT32 æ–‡ä»¶ç³»ç»Ÿï¼ˆæˆ–è€…å‡†å¤‡ç¬¬äºŒä¸ªUç›˜ï¼‰</p><p>é€‰æ‹©å†™å…¥ç¡¬ç›˜æ˜ åƒ</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231126222516.png" alt="image.png"></p><p>å†™å…¥æ–¹å¼é»˜è®¤ï¼ˆUSB-HDD+ï¼‰ï¼Œå•å‡»ä¾¿æºå¯åŠ¨ï¼Œå•å‡»å†™å…¥æ–°çš„é©±åŠ¨å™¨å¼•å¯¼æ‰‡åŒºï¼Œå•å‡»Syslinuxã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231126222715.png" alt="image.png"></p><p>å®Œæ¯•åï¼Œå•å‡»ä¸‹æ–¹å†™å…¥ï¼Œç­‰å¾…è¿›åº¦æ¡æ»¡å†™å…¥å®Œæ¯•ã€‚</p><blockquote><p>è®°ï¼šä¸­é—´é‡åˆ°ä¸€æ¬¡ æç¤ºæ ¼å¼åŒ–é‡æ–°æ“ä½œ</p></blockquote><p>UltraISOçš„è½¯ä»¶æç¤ºå…¶å®æ˜¯å‡†ç¡®çš„ï¼Œä½†å´æ˜¯ç¨‹åºå‘˜æ€ç»´ä¸‹ç§‘å­¦ç´ å…»çº§åˆ«çš„æç¤ºã€‚è¿™é‡Œçš„å»ºè®®æ ¼å¼åŒ–Uç›˜åå†è¯•ï¼Œæ„æ€æ˜¯å»ºè®®ä½ åˆ é™¤æ‰€æœ‰åˆ†åŒºåé‡è¯•</p><p>è§£å†³å¤„ç†ï¼š</p><ul><li>1ã€ä¸‹è½½ DiskGenius æ ¼å¼åŒ–æ‰€æœ‰åˆ†åŒº </li><li>2ã€ç”¨win+Ræ‰“å¼€cmdï¼Œè¾“å…¥â€œdiskpartâ€    è¾“å…¥â€œlist diskâ€æŸ¥çœ‹æ‰€æœ‰ç£ç›˜   ä¾æ®å¤§å°é€‰ä¸­å¯¹åº”ç£ç›˜â€œselect disk xâ€    è¾“å…¥â€œcleanâ€åˆ é™¤æ‰€æœ‰åˆ†åŒº</li></ul><p>ç¬¬ä¸€ç§æ–¹å¼çš„ä¸‹è½½åœ°å€ï¼š <a href="https://xiazai.zol.com.cn/detail/33/327603.shtml">https://xiazai.zol.com.cn/detail/33/327603.shtml</a></p><p>æ ¼å¼åŒ–è½¬æ¢ç›˜ç¬¦ä¸ºFAT32æ ¼å¼</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231126234720.png" alt="image.png|500"></p><p>å®é™…æ“ä½œçš„æ—¶å€™æ˜¾ç¤ºè®¾å¤‡å†™å…¥é”™è¯¯ 55</p><p>ä¹Ÿè¯•äº†ä¸€ä¸‹ç½‘ä¸Šè¯´çš„é€šè¿‡ç®¡ç†å‘˜è¿è¡Œï¼Œæˆ–è€…ä¸Šé¢è¯´çš„æ ¼å¼åŒ–æ“ä½œï¼Œéƒ½ä¸è¡Œï¼›æœ€åé€šè¿‡ä¹°äº†ä¸€ä¸ªæ–°çš„ U ç›˜è§£å†³ã€‚</p><blockquote><p>é€šè¿‡ balenaEtcher è¿›è¡Œåˆ»å½•æ“ä½œ</p></blockquote><p>ä¸‹è½½åœ°å€ï¼š</p><ul><li><a href="https://www.ssdtop.com/balenaetcher.html">https://www.ssdtop.com/balenaetcher.html</a></li><li><a href="https://github.com/balena-io/etcher/releases">https://github.com/balena-io/etcher/releases</a></li></ul><p>ä¸‹è½½  balenaEtcher è¿›è¡Œåˆ»å½•æ“ä½œï¼Œè¿˜æ˜¯å¤±è´¥</p><p>çŒœæµ‹å¤§æ¦‚æ˜¯Uç›˜æœ‰é—®é¢˜ï¼Œæˆ–è€…æ¢ä¸€å°ç”µè„‘è¿›è¡Œæ“ä½œï¼›è¿™é‡Œé€‰æ‹©é‡æ–°è´­ä¹°ä¸€ä¸ªæ–°çš„ U ç›˜è¿›è¡Œæ“ä½œ</p><p>Laterâ€¦</p><p>æ–° Uç›˜ é€šè¿‡ DiskGenius æ ¼å¼åŒ–Uç›˜åˆ†åŒºï¼Œå†é€šè¿‡ UltraISO æˆåŠŸè¿›è¡Œäº†åˆ»å½•æ“ä½œã€‚</p><hr><h4 id="é‡è£…ç³»ç»Ÿ"><a href="#é‡è£…ç³»ç»Ÿ" class="headerlink" title="é‡è£…ç³»ç»Ÿ"></a>é‡è£…ç³»ç»Ÿ</h4><p>å°† U ç›˜ æ’å…¥éœ€è¦é‡è£…çš„ç”µè„‘å¹¶å¼€æœºã€‚å¦‚æœå·²ç»è®¾ç½®å®Œæ¯•ä»¥USBä¸ºç¬¬ä¸€å¯åŠ¨é¡¹ï¼Œåˆ™ä¸ç”¨å†æ¬¡è¿›å…¥biosç•Œé¢ã€‚</p><p>æ²¡æœ‰çš„è¯å†è¿›å…¥ä¸€æ¬¡ï¼Œé€šè¿‡ USB å¯åŠ¨ã€‚</p><blockquote><p>å®‰è£…æ“ä½œ</p></blockquote><ul><li>1ã€é€‰æ‹©Install CentOS 7</li><li>2ã€æŒ‰å›è½¦é”®</li><li>3ã€æˆåŠŸè¿›å…¥CentOSç³»ç»Ÿå›¾å½¢åŒ–çš„å®‰è£…ç•Œé¢åï¼Œè¿›è¡Œåˆå§‹åŒ–</li></ul><p>åˆå§‹åŒ–é…ç½®</p><ul><li>â‘ ä¸­æ–‡ï¼ˆè¯­è¨€ï¼‰</li><li>â‘¡è½¯ä»¶é€‰æ‹©ï¼šGNOMEæ¡Œé¢</li><li>â‘¢å®‰è£…ä½ç½®ï¼šé€‰æ‹©ç£ç›˜ï¼Œæ‰‹åŠ¨åˆ†åŒºï¼ˆé€‰æ‹©â€œæˆ‘è¦é…ç½®åˆ†åŒºâ€ï¼‰<ul><li>&#x2F;boot     ä¹Ÿå¯ä»¥ä¸æ·»åŠ      1G</li><li>&#x2F;swap   äº¤äº’åˆ†åŒº             2G</li><li>&#x2F;            æ ¹ç›®å½•ï¼Œåˆ†é…å‰©ä¸‹æ‰€æœ‰ç©ºé—´</li></ul></li></ul><blockquote><p>åˆå§‹åŒ–é…ç½®</p></blockquote><p>â‘¡è½¯ä»¶é€‰æ‹©</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231127234606.png" alt="image.png"></p><p>â‘¢æ·»åŠ æ–°æŒ‚è½½ç‚¹ &#x2F;boot</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231127234855.png" alt="image.png"></p><p><strong>è®¾ç½®å¥½åç‚¹å‡»å®Œæˆï¼Œé€‰æ‹©æ¥å—æ›´æ”¹</strong></p><blockquote><p>ç½‘ç»œä¸ä¸»æœºå</p></blockquote><p>ç½‘ç»œä¸ä¸»æœºåï¼š<strong>æ‰“å¼€ç½‘ç»œï¼Œè‡ªå·±è®¾ç½®ä¸€ä¸ªä¸»æœºåï¼Œç„¶åç‚¹å‡»å®Œæˆ</strong></p><blockquote><p>ç”¨æˆ·è®¾ç½®</p></blockquote><p>å¼€å§‹å®‰è£…</p><ul><li><strong>ç‚¹å‡»è®¾ç½®rootå¯†ç </strong></li><li>ç­‰å¾…è¿‡ç¨‹ä¸­å¯ä»¥ <strong>åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·</strong></li></ul><blockquote><p>é‡å¯ç”µè„‘åé…ç½®å†…å®¹</p></blockquote><p>é‡å¯ç”µè„‘</p><p><strong>é‡å¯åè¿›å…¥åˆå§‹è®¾ç½®ç•Œé¢ï¼Œæ¥å—è®¸å¯ï¼Œç„¶åç‚¹å‡»å®Œæˆé…ç½®</strong>  â†’ å®Œæˆé…ç½®</p><p><strong>ç­‰å¾…ï¼Œç„¶åæ¥åˆ°ç™»å½•é¡µé¢ï¼Œæˆ‘ä»¬é€‰æ‹©æœªåˆ—å‡ºï¼Œç„¶åè¾“å…¥rootå’Œrootçš„å¯†ç ï¼Œç„¶åç‚¹å‡»ç™»å½•ã€‚</strong></p><p><strong>æ¥åˆ°æ¡Œé¢ï¼Œæˆ‘ä»¬é€‰æ‹©è¯­è¨€ä¸ºä¸­æ–‡</strong></p><p><strong>å…³é—­ä½ç½®æœåŠ¡</strong></p><p>è·³è¿‡åœ¨çº¿è´¦å·</p><hr><h3 id="3ã€ä½¿ç”¨-windows-è®¿é—®åŒä¸€ä¸ªå±€åŸŸç½‘ä¸‹çš„-linux-ç³»ç»Ÿ"><a href="#3ã€ä½¿ç”¨-windows-è®¿é—®åŒä¸€ä¸ªå±€åŸŸç½‘ä¸‹çš„-linux-ç³»ç»Ÿ" class="headerlink" title="3ã€ä½¿ç”¨ windows è®¿é—®åŒä¸€ä¸ªå±€åŸŸç½‘ä¸‹çš„ linux ç³»ç»Ÿ"></a>3ã€ä½¿ç”¨ windows è®¿é—®åŒä¸€ä¸ªå±€åŸŸç½‘ä¸‹çš„ linux ç³»ç»Ÿ</h3><p>è®¾ç½®å®Œæˆåï¼Œè¿æ¥åŒä¸€ä¸ªwife</p><p>åœ¨ windows ä¸­ä½¿ç”¨ xshell&#x2F;termius å·¥å…·è®¿é—®å³å¯</p><h3 id="4ã€å†…ç½‘ç©¿é€çš„ä½¿ç”¨"><a href="#4ã€å†…ç½‘ç©¿é€çš„ä½¿ç”¨" class="headerlink" title="4ã€å†…ç½‘ç©¿é€çš„ä½¿ç”¨"></a>4ã€å†…ç½‘ç©¿é€çš„ä½¿ç”¨</h3><p>ç•¥</p><p>æš‚æœªæœ‰è¿™ä¸ªéœ€æ±‚ï¼Œåç»­è€ƒè™‘ä½¿ç”¨ã€‚</p><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://blog.csdn.net/m0_59302403/article/details/132119884">https://blog.csdn.net/m0_59302403/article/details/132119884</a></li><li><a href="https://blog.csdn.net/weixin_42292697/article/details/110285529">https://blog.csdn.net/weixin_42292697/article/details/110285529</a></li><li><a href="https://www.bilibili.com/video/BV1c3411T7Td">https://www.bilibili.com/video/BV1c3411T7Td</a></li><li><a href="https://blog.csdn.net/m0_51545690/article/details/123238360">https://blog.csdn.net/m0_51545690/article/details/123238360</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>éšè®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>computer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸ªäººåœ¨çº¿ç½‘ç›˜_ZFile</title>
    <link href="/2023/11/26/%E4%B8%AA%E4%BA%BA%E5%9C%A8%E7%BA%BF%E7%BD%91%E7%9B%98_ZFile/"/>
    <url>/2023/11/26/%E4%B8%AA%E4%BA%BA%E5%9C%A8%E7%BA%BF%E7%BD%91%E7%9B%98_ZFile/</url>
    
    <content type="html"><![CDATA[<p>çœ‹åˆ°æœ‰ä¸€ä¸ªè¿˜ä¸é”™çš„é¡¹ç›®ï¼Œæœ‰æ—¶å€™éœ€è¦å°†æ–‡ä»¶æ”¾ç½®åœ¨äº‘ç«¯ï¼Œè¿™é‡Œå­¦ä¹ ä½¿ç”¨ä¸€ä¸‹è¿™ä¸ªå·¥å…·ã€‚ï¼ˆæ”¯æŒé¢„è§ˆæ“ä½œï¼‰</p><p>é¡¹ç›®åœ°å€ï¼š <a href="https://github.com/zfile-dev/zfile">https://github.com/zfile-dev/zfile</a></p><p>éƒ¨ç½²æ–‡æ¡£åœ°å€ï¼š <a href="https://docs.zfile.vip/">https://docs.zfile.vip/</a></p><h3 id="1ã€é¡¹ç›®è¿è¡Œ"><a href="#1ã€é¡¹ç›®è¿è¡Œ" class="headerlink" title="1ã€é¡¹ç›®è¿è¡Œ"></a>1ã€é¡¹ç›®è¿è¡Œ</h3><p>ä¸‹è½½é¡¹ç›®åï¼Œéœ€è¦ç³»ç»Ÿé‡Œé¢æœ‰ JDK8 çš„ç¯å¢ƒ</p><blockquote><p>Centos ç³»ç»Ÿè¿è¡Œ</p></blockquote><blockquote><p>å®‰è£… JDK8</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">yum</span> install -y java-<span class="hljs-number">1</span>.<span class="hljs-number">8</span>.<span class="hljs-number">0</span>-openjdk unzip<br></code></pre></td></tr></table></figure><blockquote><p>ä¸‹è½½å¹¶è§£å‹</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> ZFILE_INSTALL_PATH=~/zfile                        <span class="hljs-comment"># å£°æ˜å®‰è£…åˆ°çš„è·¯å¾„</span><br><span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$ZFILE_INSTALL_PATH</span> &amp;&amp; <span class="hljs-built_in">cd</span> <span class="hljs-variable">$ZFILE_INSTALL_PATH</span>   <span class="hljs-comment"># åˆ›å»ºæ–‡ä»¶å¤¹å¹¶è¿›å…¥</span><br>wget --no-check-certificate https://c.jun6.net/ZFILE/zfile-release.war          <span class="hljs-comment"># ä¸‹è½½ zfile æœ€æ–°ç‰ˆ</span><br>unzip zfile-release.war &amp;&amp; <span class="hljs-built_in">rm</span> -rf zfile-release.war      <span class="hljs-comment"># è§£å‹å¹¶åˆ é™¤å‹ç¼©åŒ…</span><br><span class="hljs-built_in">chmod</span> +x <span class="hljs-variable">$ZFILE_INSTALL_PATH</span>/bin/*.sh                    <span class="hljs-comment"># æˆæƒå¯åŠ¨åœæ­¢è„šæœ¬</span><br></code></pre></td></tr></table></figure><p>ZFile æä¾›äº†ä¸€ä¸ª åœ¨çº¿ä¸‹è½½è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æœ¬åœ°ä¸‹è½½åè‡ªå®šä¹‰è®¾å¤‡æŸäº›å†…å®¹åï¼Œæ‰“åŒ…ä¸º war ï¼Œæ”¾ç½®åœ¨ linux ç³»ç»Ÿä¸Šè¿è¡Œã€‚</p><p>å¦‚éœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶è·¯å¾„ä¸ºï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">~<span class="hljs-regexp">/zfile/</span>WEB-INF<span class="hljs-regexp">/classes/</span>application.properties<br></code></pre></td></tr></table></figure><hr><p>å®‰è£…è¯´æ˜</p><p>ä¸‹é¢å‘½ä»¤ä¸­ç¬¬ä¸€è¡Œè¡¨ç¤ºé»˜è®¤å®‰è£…åˆ°ç”¨æˆ·ç›®å½•ä¸‹:Â <code>~/zfile</code>Â ä¸‹ã€‚</p><p>å¯¹äºÂ <code>root</code>Â ç”¨æˆ·,Â <code>~</code>Â &#x3D;Â <code>/root</code>,Â <code>~/zfile</code>Â è¡¨ç¤ºåœ¨Â <code>/root/zfile</code>Â è·¯å¾„ä¸‹ã€‚</p><p>å¯¹äºå…¶ä»–ç”¨æˆ·,Â <code>~</code>Â &#x3D;Â <code>/home/ç”¨æˆ·å</code>Â è¡¨ç¤ºåœ¨Â <code>/home/ç”¨æˆ·å/</code>Â è·¯å¾„ä¸‹ã€‚å¦‚å¯¹äºÂ <code>oracle</code>Â ç”¨æˆ·,Â <code>~/zfile</code>Â åˆ™è¡¨ç¤ºå®‰è£…åœ¨Â <code>/home/oracle/zfile</code>Â ä¸‹ã€‚</p><p>å¦‚éœ€æ›´æ”¹å®‰è£…è·¯å¾„, è¯·è‡ªè¡Œä¿®æ”¹ï¼Œå¦‚Â <code>export ZFILE_INSTALL_PATH=/data/zfile</code>ï¼Œè¡¨ç¤ºå®‰è£…åœ¨Â <code>/data/zfile</code>Â è·¯å¾„ä¸‹ã€‚</p><hr><h3 id="2ã€å¯åŠ¨é¡¹ç›®"><a href="#2ã€å¯åŠ¨é¡¹ç›®" class="headerlink" title="2ã€å¯åŠ¨é¡¹ç›®"></a>2ã€å¯åŠ¨é¡¹ç›®</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">~<span class="hljs-regexp">/zfile/</span>bin/start.sh       <span class="hljs-comment"># å¯åŠ¨</span><br></code></pre></td></tr></table></figure><hr><p>å¯åŠ¨åæµè§ˆå™¨è®¿é—®Â <strong><code>http://ip:8080</code></strong>Â å³å¯ï¼Œå¦‚å¯åŠ¨åæ— æ³•è®¿é—®ï¼Œè¯·æ£€æŸ¥Â <strong><code>ç«¯å£æ˜¯å¦å†²çª</code></strong>Â æˆ–Â <code>é˜²ç«å¢™/å®‰å…¨ç»„æ˜¯å¦å¼€å¯</code>ã€‚</p><p>ç®€å•æ£€æŸ¥æ–¹å¼ä¸ºåœ¨æœåŠ¡å™¨æ‰§è¡ŒÂ <code>curl http://127.0.0.1:8080</code></p><ul><li>å¦‚è¿”å›Â <code>curl: (7) Failed connect to 127.0.0.1:8080; Connection refused</code>Â è¡¨ç¤ºæœªå¯åŠ¨æˆåŠŸã€‚</li><li>å¦‚è¿”å›Â <code>&lt;!DOCTYPE html&gt; &lt;html lang=&quot;zh-CN&quot;&gt;â€¦â€¦</code>Â ç­‰å­—æ ·è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼Œå¦‚å¯åŠ¨æˆåŠŸä½†é€šè¿‡æœåŠ¡å™¨ IP æ— æ³•è®¿é—®ï¼Œé‚£ä¸€èˆ¬å°±æ˜¯é˜²ç«å¢™&#x2F;å®‰å…¨ç»„æœªæ”¾è¡Œç«¯å£é—®é¢˜ã€‚</li></ul><hr><p>æ›´æ–°ç¨‹åºå‰åŠ¡å¿…åœæ­¢ç¨‹åºå†è¿›è¡Œæ“ä½œ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">~<span class="hljs-regexp">/zfile/</span>bin/start.sh       <span class="hljs-comment"># å¯åŠ¨</span><br>~<span class="hljs-regexp">/zfile/</span>bin/stop.sh        <span class="hljs-comment"># åœæ­¢</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Elasticsearch_åŸºç¡€å†…å®¹</title>
    <link href="/2023/11/26/Elasticsearch_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/"/>
    <url>/2023/11/26/Elasticsearch_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/</url>
    
    <content type="html"><![CDATA[<p><code>Elasticsearch</code>æ˜¯ä¸€ä¸ªå¼€æºçš„é«˜æ‰©å±•çš„åˆ†å¸ƒå¼å…¨æ–‡æ£€ç´¢å¼•æ“ï¼Œå®ƒå¯ä»¥è¿‘ä¹å®æ—¶çš„å­˜å‚¨ã€æ£€ç´¢æ•°æ®ï¼›æœ¬ èº«æ‰©å±•æ€§å¾ˆå¥½ï¼Œå¯ä»¥æ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç†PBçº§åˆ«çš„æ•°æ®ã€‚</p><p>ESä¹Ÿä½¿ç”¨Javaå¼€å‘å¹¶ä½¿ç”¨ Lucene ä½œä¸ºå…¶æ ¸å¿ƒæ¥å® ç°æ‰€æœ‰ç´¢å¼•å’Œæœç´¢çš„åŠŸèƒ½ï¼Œå®ƒçš„ç›®çš„æ˜¯é€šè¿‡ç®€å•çš„RESTful APIæ¥éšè—Luceneçš„å¤æ‚æ€§ï¼Œä»è€Œè®©å…¨æ–‡æœç´¢å˜å¾—  ç®€å•ã€‚</p><blockquote><p>Elasticsearchæ¯”ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“å¦‚ä¸‹ï¼š</p></blockquote><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-title class_">Relational</span> <span class="hljs-variable constant_">DB</span> â€&gt; <span class="hljs-title class_">Databases</span> â€&gt; <span class="hljs-title class_">Tables</span> â€&gt; <span class="hljs-title class_">Rows</span> â€&gt; <span class="hljs-title class_">Columns</span>  </span><br><span class="hljs-meta prompt_">&gt;</span> <span class="language-javascript"><span class="hljs-title class_">Elasticsearch</span> â€&gt; <span class="hljs-title class_">Indices</span> â€&gt; <span class="hljs-title class_">Types</span> â€&gt; <span class="hljs-title class_">Documents</span> â€&gt; <span class="hljs-title class_">Fields</span></span><br></code></pre></td></tr></table></figure><p>to be continedâ€¦..</p><p>å‚è€ƒ</p><ul><li><a href="https://elasticsearch.bookhub.tech/getting_started/">https://elasticsearch.bookhub.tech/getting_started/</a></li><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</a></li><li><a href="https://www.cnblogs.com/coderxz/p/13268417.html">https://www.cnblogs.com/coderxz/p/13268417.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/516698885">https://zhuanlan.zhihu.com/p/516698885</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>ä¸­é—´ä»¶</category>
      
      <category>Elasticsearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>elasticsearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vueå­¦ä¹ _åŸºç¡€å†…å®¹</title>
    <link href="/2023/11/26/Vue%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/"/>
    <url>/2023/11/26/Vue%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¤§çº²</p></blockquote><ul><li>Vue åŸºç¡€</li><li>Vue è¯­æ³•</li><li>ç»„ä»¶åŒ–å¼€å‘</li><li>è·¯ç”±</li><li>webpack</li><li>è„šæ‰‹æ¶</li></ul><p>to be continedâ€¦</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://cn.vuejs.org/">https://cn.vuejs.org/</a></li><li><a href="https://blog.csdn.net/fmk1023/article/details/111381876">https://blog.csdn.net/fmk1023/article/details/111381876</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>Vue</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mavenå·¥å…·_åŸºç¡€ä½¿ç”¨</title>
    <link href="/2023/11/24/Maven%E5%B7%A5%E5%85%B7_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"/>
    <url>/2023/11/24/Maven%E5%B7%A5%E5%85%B7_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€Maven-ä¸‹è½½ä¸å®‰è£…"><a href="#1ã€Maven-ä¸‹è½½ä¸å®‰è£…" class="headerlink" title="1ã€Maven ä¸‹è½½ä¸å®‰è£…"></a>1ã€Maven ä¸‹è½½ä¸å®‰è£…</h3><p>ç•¥</p><h3 id="2ã€Mavené…ç½®æ–‡ä»¶ä¿®æ”¹"><a href="#2ã€Mavené…ç½®æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="2ã€Mavené…ç½®æ–‡ä»¶ä¿®æ”¹"></a>2ã€Mavené…ç½®æ–‡ä»¶ä¿®æ”¹</h3><blockquote><p>maven é…ç½®æ–‡ä»¶å†…å®¹</p></blockquote><p>è®¾ç½®æœ¬åœ°ä»“åº“è·¯å¾„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--è®¾ç½®æœ¬åœ°ä»“åº“è·¯å¾„--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">localRepository</span>&gt;</span>D:\java\maven\localRepository<span class="hljs-tag">&lt;/<span class="hljs-name">localRepository</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®é˜¿é‡Œäº‘ç§æœï¼ˆæˆ–æ¢æˆè‡ªå·±å…¬å¸æ­å»ºçš„ç§æœï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- åœ¨mirrorsæ ‡ç­¾é‡Œæ·»åŠ mirroræ ‡ç­¾ï¼Œå¹¶æŒ‡å®šé˜¿é‡Œäº‘ç§æœä¸‹è½½ä¾èµ–ä¼šå¿«ç‚¹ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>alimaven<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>aliyun maven<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½® maven é»˜è®¤jdkç‰ˆæœ¬</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- åœ¨å·²æœ‰çš„profilesæ ‡ç­¾ä¸­æ·»åŠ profileæ ‡ç­¾ï¼Œé™å®šmavené¡¹ç›®é»˜è®¤çš„jdkç‰ˆæœ¬ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>myjdk<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span>    <br>        <span class="hljs-tag">&lt;<span class="hljs-name">activeByDefault</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">activeByDefault</span>&gt;</span>    <br>        <span class="hljs-tag">&lt;<span class="hljs-name">jdk</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">jdk</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>    <br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>    <br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.compilerVersion</span>&gt;</span> <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>    <br><span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br> <br><span class="hljs-comment">&lt;!-- è®©å¢åŠ çš„ profileç”Ÿæ•ˆ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">activeProfiles</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">activeProfile</span>&gt;</span>myjdk<span class="hljs-tag">&lt;/<span class="hljs-name">activeProfile</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">activeProfiles</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®åä¸ºäº‘</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>huaweicloud<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.huaweicloud.com/repository/maven/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é˜¿é‡Œäº‘:   <a href="https://developer.aliyun.com/mvn/guide">https://developer.aliyun.com/mvn/guide</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>aliyunmaven<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>*<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>é˜¿é‡Œäº‘å…¬å…±ä»“åº“<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¸‹é¢è¿™ä¸ªè®ºç‚¹ï¼Œé…ç½®çš„æ—¶å€™æ³¨æ„ä¸€ä¸‹ï¼š<strong>ä¸€ä¸ªä»“åº“åªèƒ½å¯¹åº”ä¸€ä¸ªé•œåƒï¼Œå½“æœ‰å¤šä¸ªé•œåƒçš„mirrorOfæŒ‡å®šäº†åŒä¸€ä¸ªä»“åº“ï¼Œmavenåªä¼šä»ç¬¬ä¸€ä¸ªåŒ¹é…çš„ä»“åº“ä¸­è¿›è¡ŒæŸ¥æ‰¾</strong></p><h3 id="3ã€IDEA-é…ç½®-maven"><a href="#3ã€IDEA-é…ç½®-maven" class="headerlink" title="3ã€IDEA é…ç½® maven"></a>3ã€IDEA é…ç½® maven</h3><blockquote><p>IDEA é…ç½® maven</p></blockquote><p>å¿«æ·æŸ¥æ‰¾æ¡†ä¸­è¾“å…¥mavenï¼ŒæŸ¥æ‰¾ä¸mavenç›¸å…³çš„è®¾ç½®ï¼Œç„¶åç‚¹å‡»maven</p><p>ä¿®æ”¹mavençš„è·¯å¾„ï¼ˆä½¿ç”¨æœ¬åœ°çš„Mavenï¼‰ï¼Œä»¥åŠä¿®æ”¹settingsæ–‡ä»¶çš„ä½ç½®å’Œæœ¬åœ°ä»“åº“çš„ä½ç½®</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311242131645.png" alt="image.png"></p><p>IDEA  æœ‰çš„ç‰ˆæœ¬ä¸‹é¢æœ‰ä¸€ä¸ª   use settings from .mvn&#x2F;maven.config  é€‰é¡¹ï¼Œè¿›è¡Œå‹¾é€‰</p><p>ä»–çš„æ„æ€æ˜¯ï¼š mvn(directory):  ä½äºé¡¹ç›®çš„é¡¶çº§ç›®å½•ä¸­ï¼Œæ–‡ä»¶ maven.configã€jvm.configå’Œextensions.xml åŒ…å«è¿è¡ŒMavençš„é¡¹ç›®ç‰¹å®šé…ç½®ã€‚è¿™ä¸ªç›®å½•åº”è¯¥æ˜¯é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦è¢«ç‰ˆæœ¬ç®¡ç†å·¥å…·ç®¡ç†</p><blockquote><p>æ¨èé…ç½®ï¼šè®¾ç½®mavenåœ¨ä¸è”ç½‘çš„æƒ…å†µä¸‹ä½¿ç”¨æœ¬åœ°æ’ä»¶</p></blockquote><p>ä¸€èˆ¬ä½¿ç”¨mavenä¸ºæˆ‘ä»¬æä¾›å¥½çš„éª¨æ¶æ—¶ï¼Œæ˜¯éœ€è¦è”ç½‘çš„ï¼Œé…ç½®è¿™ä¸ªï¼Œå¯ä»¥åœ¨æ²¡æœ‰ç½‘è·¯çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ­£å¸¸åˆ›å»ºå·¥ç¨‹ï¼Œå¹¶ä»ä¹‹å‰å·²ç»ä½¿ç”¨è¿‡çš„å·¥ç¨‹ä¸­æ‰¾åˆ°ç›¸åº”çš„éª¨æ¶ã€‚ï¼ˆæ ¹æ®éª¨æ¶åˆ›å»ºé¡¹ç›®é€Ÿåº¦ä¼šåŠ å¿«ï¼‰</p><p>è¾“å…¥å†…å®¹ï¼š<code>-DarchetypeCatalog=internal</code></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311242133069.png" alt="image.png"></p><p>è¾“å…¥å†…å®¹ï¼š<code>-DarchetypeCatalog=internal</code></p><h3 id="4ã€IDEAå¯¼å…¥é¡¹ç›®åmaven-å¸¸è§æŠ¥é”™"><a href="#4ã€IDEAå¯¼å…¥é¡¹ç›®åmaven-å¸¸è§æŠ¥é”™" class="headerlink" title="4ã€IDEAå¯¼å…¥é¡¹ç›®åmaven å¸¸è§æŠ¥é”™"></a>4ã€IDEAå¯¼å…¥é¡¹ç›®åmaven å¸¸è§æŠ¥é”™</h3><p>æ–¹æ³•ä¸€ï¼šæ”¹ä¸€ä¸‹ maven é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ mirror ä»“åº“ä½ç½®ï¼Œé‡æ–°å¯¼å…¥é¡¹ç›®ï¼Œé‡æ–°åŠ è½½ maven ä¾èµ–</p><p>æ–¹æ³•äºŒï¼šIDEA  æœ‰çš„ç‰ˆæœ¬ä¸‹é¢æœ‰ä¸€ä¸ª   use settings from .mvn&#x2F;maven.config  é€‰é¡¹ï¼Œä¸è¿›è¡Œå‹¾é€‰è¯•ä¸€ä¸‹</p><p>æ–¹æ³•ä¸‰ï¼šå»ä¸€ä¸‹ä»“åº“åœ°å€ï¼ŒæŸ¥çœ‹æ˜¯å¦æ˜¯å¦æœ‰è¯¥ç‰ˆæœ¬ä¾èµ–ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ”¹ä¸€ä¸‹ç‰ˆæœ¬ï¼Œæˆ–è€…æ‰‹åŠ¨ä¸‹è½½ï¼Œæ‰‹åŠ¨å¯¼å…¥åˆ°æœ¬åœ°ä»“åº“ä¸­</p><blockquote><p>æŠ¥é”™1ï¼šè§£å†³Maven â€˜parent.relativePathâ€˜ of POM</p></blockquote><p>é”™è¯¯åˆ†æ  </p><p>å­æ¨¡å—çš„parentå†™çš„ä¸æ˜¯çˆ¶æ¨¡å—ï¼Œè€Œæ˜¯ç»§æ‰¿äº†springboot</p><p>è§£å†³æ–¹æ³•  </p><p>åœ¨è¯¥<code>&lt;parent&gt;</code>æ ‡ç­¾ä¸­åŠ ä¸Š<code>&lt;relativePath /&gt;</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>   /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>æŠ¥é”™2ï¼šå¯¹äºç±»ä¼¼äºxxx-maven-pluginçš„æ’ä»¶æŠ¥çº¢</p></blockquote><p>ç±»ä¼¼äºè¿™æ ·çš„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>wagon-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>    <br></code></pre></td></tr></table></figure><p>æŠ¥çº¢å°±ç›´æ¥ç”¨ä¸äº†äº†</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ä¾èµ–çš„æ–¹å¼è§£å†³ï¼ˆåŸæ¥çš„æ’ä»¶å°±æ˜¯ä¸Šé¢çš„ä»£ç <strong>ä¸è¦åˆ </strong>ï¼‰:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>wagon-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/yang_yzl11/article/details/120764764">https://blog.csdn.net/yang_yzl11/article/details/120764764</a></li><li><a href="https://blog.csdn.net/qq_42057154/article/details/106114515">https://blog.csdn.net/qq_42057154/article/details/106114515</a></li><li><a href="https://www.cnblogs.com/SherlockLynn/p/15079467.html">https://www.cnblogs.com/SherlockLynn/p/15079467.html</a></li><li><a href="https://blog.csdn.net/qq_38217990/article/details/129257106">https://blog.csdn.net/qq_38217990/article/details/129257106</a></li><li><a href="https://zhuanlan.zhihu.com/p/653017610">https://zhuanlan.zhihu.com/p/653017610</a></li><li><a href="https://blog.csdn.net/qq_39505065/article/details/111559890">https://blog.csdn.net/qq_39505065/article/details/111559890</a></li><li><a href="https://blog.csdn.net/m0_46682011/article/details/120626933">https://blog.csdn.net/m0_46682011/article/details/120626933</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>maven</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Nacos</title>
    <link href="/2023/11/24/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Nacos/"/>
    <url>/2023/11/24/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Nacos/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€Nacos-æ˜¯ä»€ä¹ˆ"><a href="#1ã€Nacos-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€Nacos æ˜¯ä»€ä¹ˆ"></a>1ã€Nacos æ˜¯ä»€ä¹ˆ</h3><p>Nacos æ˜¯ä¸€ä¸ªæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ï¼›è‡´åŠ›äºå¸®åŠ©å‘ç°ã€é…ç½®å’Œç®¡ç†å¾®æœåŠ¡ã€‚</p><h3 id="2ã€ä¸‹è½½ä¸è¿è¡Œ"><a href="#2ã€ä¸‹è½½ä¸è¿è¡Œ" class="headerlink" title="2ã€ä¸‹è½½ä¸è¿è¡Œ"></a>2ã€ä¸‹è½½ä¸è¿è¡Œ</h3><p>ä¸‹è½½åœ°å€ï¼š <a href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></p><p>windowsç‰ˆæœ¬ä½¿ç”¨<code>nacos-server-x.x.x.zip</code>åŒ…å³å¯</p><p>å°†è¿™ä¸ªåŒ…è§£å‹åˆ°ä»»æ„éä¸­æ–‡ç›®å½•ä¸‹ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231124154048.png" alt="image.png"><br>ç›®å½•è¯´æ˜ï¼š</p><ul><li>binï¼šå¯åŠ¨è„šæœ¬</li><li>confï¼šé…ç½®æ–‡ä»¶</li></ul><p>Nacosçš„é»˜è®¤ç«¯å£æ˜¯8848ï¼Œå¦‚æœç”µè„‘ä¸Šçš„å…¶å®ƒè¿›ç¨‹å ç”¨äº†8848ç«¯å£ï¼Œå…ˆå°è¯•å…³é—­è¯¥è¿›ç¨‹ã€‚</p><p><strong>å¦‚æœæ— æ³•å…³é—­å ç”¨8848ç«¯å£çš„è¿›ç¨‹</strong>ï¼Œä¹Ÿå¯ä»¥è¿›å…¥nacosçš„confç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£<br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231124154144.png" alt="image.png"></p><p>å…³äº nacos-mysql.sql å’Œ schema.sql çš„è¯´æ˜ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426171956.png" alt="image.png"><br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240426171957.png" alt="image.png"></p><blockquote><p>å¯åŠ¨å‘½ä»¤(Windows)</p></blockquote><p>å¯åŠ¨éå¸¸ç®€å•ï¼Œè¿›å…¥binç›®å½•</p><p>å¯åŠ¨å‘½ä»¤(standaloneä»£è¡¨ç€å•æœºæ¨¡å¼è¿è¡Œï¼Œéé›†ç¾¤æ¨¡å¼):</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">startup.<span class="hljs-built_in">cmd</span> -m standalone<br></code></pre></td></tr></table></figure><blockquote><p>è®¿é—®</p></blockquote><p>åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ï¼š <a href="http://127.0.0.1:8848/nacos">http://127.0.0.1:8848/nacos</a> </p><p>é»˜è®¤çš„è´¦å·å’Œå¯†ç éƒ½æ˜¯nacos</p><blockquote><p>Namespace+Group+DataIDä¸‰è€…çš„å…³ç³»</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311250024118.png" alt="image.png|400"></p><blockquote><p>å¤šç¯å¢ƒé…ç½®</p></blockquote><p>ç•¥</p><h3 id="3ã€Nacos-çš„åŸºæœ¬ä½¿ç”¨"><a href="#3ã€Nacos-çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="3ã€Nacos çš„åŸºæœ¬ä½¿ç”¨"></a>3ã€Nacos çš„åŸºæœ¬ä½¿ç”¨</h3><h4 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h4><p>åœ¨Â spring-cloud-alibaba-service çš„ä¸»å¯åŠ¨ç±»ä¸Šï¼Œä½¿ç”¨ @EnableDiscoveryClient æ³¨è§£å¼€å¯ Nacos æœåŠ¡å‘ç°åŠŸèƒ½</p><p>ä½ è®¿é—®è¯¥æœåŠ¡ä¸‹çš„æŸä¸ªè¯·æ±‚é“¾æ¥ï¼Œå†æŸ¥çœ‹ nacos â€œæœåŠ¡ç®¡ç†â€ä¸‹çš„â€œæœåŠ¡åˆ—è¡¨â€ï¼Œä¼šå‘ç°å·²ç»æ³¨å†Œä¸Šäº†ã€‚</p><p>ä¸€èˆ¬åœ¨æ¶ˆè´¹ç«¯ä¼šå¼•å…¥Â spring-cloud-loadbalancer è¿›è¡Œè°ƒç”¨æœåŠ¡æä¾›è€…æä¾›çš„æœåŠ¡</p><hr><p>å‚è€ƒï¼š <a href="https://cloud.tencent.com/developer/article/2226330">https://cloud.tencent.com/developer/article/2226330</a></p><p>æœåŠ¡å‘ç°æ˜¯å…ˆè·å–æœ¬åœ°ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰æœ¬åœ°ç¼“å­˜ï¼Œå°±è¯·æ±‚<code>Nacos Server</code>æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œå¦‚æœ<code>Nacos Server</code>æŒ‚äº†ï¼Œä¹Ÿä¸ä¼šå½±å“æœåŠ¡çš„è°ƒç”¨ã€‚</p><p>æœåŠ¡å‘ç°ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240423182313.png" alt="image.png"></p><h4 id="é…ç½®ä¸­å¿ƒ"><a href="#é…ç½®ä¸­å¿ƒ" class="headerlink" title="é…ç½®ä¸­å¿ƒ"></a>é…ç½®ä¸­å¿ƒ</h4><blockquote><p><strong>åŠ¨æ€è·å–é…ç½®å†…å®¹</strong></p></blockquote><p>åœ¨åº”ç”¨çš„ POM æ–‡ä»¶ä¸­å¼•å…¥Â spring-cloud-starter-alibaba-nacos-config ï¼Œå¯å®ç°é…ç½®çš„è·å–ä¸åŠ¨æ€åˆ·æ–°</p><p>ç¤ºä¾‹ </p><p>bootstrap.yml æ–‡ä»¶é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">3377</span> <span class="hljs-comment">#ç«¯å£å·</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">config-client</span> <span class="hljs-comment">#æœåŠ¡å</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span> <span class="hljs-comment">#NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span><br>      <span class="hljs-attr">config:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span> <span class="hljs-comment">#Nacosä½œä¸ºé…ç½®ä¸­å¿ƒåœ°å€</span><br>        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span> <span class="hljs-comment">#æŒ‡å®šyamlæ ¼å¼çš„é…ç½®</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span> <span class="hljs-comment">#æ¿€æ´» dev çš„é…ç½®</span><br></code></pre></td></tr></table></figure><p>åœ¨Â icu.luoqi.nacos.controller åŒ…ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºÂ ConfigClientController çš„ Controller ç±»ï¼Œå¹¶åœ¨è¯¥ç±»ä¸Šä½¿ç”¨ @RefreshScope æ³¨è§£å®ç°é…ç½®çš„è‡ªåŠ¨æ›´æ–°ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;<br><span class="hljs-keyword">import</span> org.springframework.cloud.context.config.<span class="hljs-keyword">annotation</span>.RefreshScope;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;<br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RefreshScope</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigClientController</span> &#123;<br><br>    <span class="hljs-meta">@Value(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;config.info&#125;</span>&quot;</span>)</span><br>    <span class="hljs-keyword">private</span> String ConfigInfo;<br>    <br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/config/info&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> String getConfigInfo()&#123;<br>        <span class="hljs-keyword">return</span> ConfigInfo;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸»å¯åŠ¨ç±»ä¸Šï¼Œä½¿ç”¨ @EnableDiscoveryClient æ³¨è§£å¼€å¯æœåŠ¡å‘ç°åŠŸèƒ½</p><p>å¯åŠ¨ Nacos Serverï¼Œå¹¶åœ¨ Nacos Server æ§åˆ¶å°çš„â€œé…ç½®ç®¡ç†â€ä¸‹çš„â€œé…ç½®åˆ—è¡¨â€ä¸­ï¼Œç‚¹å‡»â€œ+â€æŒ‰é’®ï¼Œæ–°å»ºå¦‚ä¸‹é…ç½®</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">Data ID</span><span class="hljs-punctuation">:</span> <span class="hljs-string">       config-client-dev.yaml</span><br><br><span class="hljs-attribute">Group</span><span class="hljs-punctuation">:</span> <span class="hljs-string">         DEFAULT_GROUP</span><br><br><span class="hljs-attribute">é…ç½®æ ¼å¼</span><span class="hljs-punctuation">:</span> <span class="hljs-string">      YAML</span><br><br><span class="hljs-attribute">é…ç½®å†…å®¹</span><span class="hljs-punctuation">:</span> <span class="hljs-string">      config:</span><br>                   <span class="hljs-attribute">info</span><span class="hljs-punctuation">:</span> <span class="hljs-string">xxxx</span><br></code></pre></td></tr></table></figure><p>åœ¨ Nacos Server ä¸­ï¼Œé…ç½®çš„ dataIdï¼ˆå³ Data IDï¼‰çš„å®Œæ•´æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span>&#123;prefix&#125;-<span class="hljs-symbol">$</span>&#123;spring.profiles.active&#125;.<span class="hljs-symbol">$</span>&#123;<span class="hljs-keyword">file</span>-extension&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨è¯¥æœåŠ¡ï¼Œå¹¶ä½¿ç”¨æµè§ˆå™¨è®¿é—®â€œ<a href="http://localhost:3377/config/info%E2%80%9D%EF%BC%8C">http://localhost:3377/config/infoâ€ï¼Œ</a></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå®ç°ä¸é‡å¯åå°æœåŠ¡ï¼Œå½“ä½ æ‰‹åŠ¨ä¿®æ”¹ nacos çš„é…ç½®æ—¶ï¼Œèƒ½å¤ŸåŠ¨æ€è·å–åˆ°é…ç½®å†…å®¹ã€‚</p><blockquote><p>Nacos Configé…ç½®é›†çš„ä¸‰ç§æ–¹å¼å’ŒåŠ è½½é¡ºåº</p></blockquote><ul><li>é€šè¿‡ spring.cloud.nacos.config.shared-configs é…ç½®é¡¹ï¼Œæ”¯æŒå¤šä¸ªå…±äº« Nacos é…ç½®é›†ã€‚</li><li>é€šè¿‡ spring.cloud.nacos.config.extension-configs é…ç½®é¡¹ï¼Œæ”¯æŒå¤šä¸ªæ‹“å±• Nacos é…ç½®é›†ã€‚</li><li>é€šè¿‡ spring.cloud.nacos.config.name é…ç½®é¡¹ï¼Œæ”¯æŒä¸€ä¸ª Nacos é…ç½®é›†ã€‚</li></ul><p>å½“ä¸‰ç§æ–¹å¼å…±åŒä½¿ç”¨æ—¶ï¼Œå®ƒä»¬çš„ä¼˜å…ˆçº§å…³ç³»æ˜¯ï¼šA &lt; B &lt; Cã€‚å¦å¤–ï¼ŒA å’Œ B çš„å‘½åå¸¦æœ‰â€œå…±äº«â€æˆ–æ˜¯â€œæ‹“å±•â€ï¼Œæ²¡æœ‰ä»»ä½•å«ä¹‰ï¼Œåªæ˜¯ä¼˜å…ˆçº§ä¸åŒ</p><h3 id="4ã€æ³¨æ„äº‹é¡¹"><a href="#4ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="4ã€æ³¨æ„äº‹é¡¹"></a>4ã€æ³¨æ„äº‹é¡¹</h3><p>å‘½åç©ºé—´idç”¨äºå”¯ä¸€æ ‡è¯†å‘½åç©ºé—´ï¼ŒÂ æ–°å»ºå‘½åç©ºé—´æ—¶å€™ï¼Œå¦‚æœä¸å¡«å†™å‘½åç©ºé—´idï¼Œåˆ™ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå‘½åç©ºé—´idï¼Œç”Ÿæˆè§„åˆ™ä¸ºUUIDæ–¹å¼ã€‚</p><p>ä½†åœ¨spring é¡¹ç›®ä¸­é›†æˆnacos çš„æ—¶å€™ï¼Œé…ç½®æ–‡ä»¶ä¸­å¡«å†™çš„namespaceå°±æ˜¯å‘½åç©ºé—´çš„id</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311260000905.png" alt="image.png"></p><p>å› æ­¤å°½é‡ä¿æŒnacosçš„å‘½åç©ºé—´åç§°å’Œid ä¸€è‡´</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311260002165.png" alt="image.png"></p><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/qq_36903261/article/details/106835279">https://blog.csdn.net/qq_36903261/article/details/106835279</a></li><li><a href="https://m.biancheng.net/springcloud/nacos.html">https://m.biancheng.net/springcloud/nacos.html</a></li><li><a href="https://nacos.io/zh-cn/docs/v2/ecology/use-nacos-with-spring-cloud.html">https://nacos.io/zh-cn/docs/v2/ecology/use-nacos-with-spring-cloud.html</a></li><li><a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html">https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html</a></li><li><a href="https://blog.csdn.net/weixin_45397785/article/details/128076533">https://blog.csdn.net/weixin_45397785/article/details/128076533</a></li><li><a href="https://blog.csdn.net/ysj1241267542/article/details/112562611">https://blog.csdn.net/ysj1241267542/article/details/112562611</a></li><li><a href="https://blog.csdn.net/u010520146/article/details/118703413">https://blog.csdn.net/u010520146/article/details/118703413</a></li><li><a href="https://blog.csdn.net/wangwei021933/article/details/129590430">https://blog.csdn.net/wangwei021933/article/details/129590430</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>springcloud</tag>
      
      <tag>nacos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo_å®ç°åœ¨ç™¾åº¦ä¸­æœç´¢åˆ°è‡ªå·±çš„åšå®¢</title>
    <link href="/2023/11/24/hexo_%E5%AE%9E%E7%8E%B0%E5%9C%A8%E7%99%BE%E5%BA%A6%E4%B8%AD%E6%90%9C%E7%B4%A2%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/"/>
    <url>/2023/11/24/hexo_%E5%AE%9E%E7%8E%B0%E5%9C%A8%E7%99%BE%E5%BA%A6%E4%B8%AD%E6%90%9C%E7%B4%A2%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>1ã€æ³¨å†Œä¸€ä¸ªç™¾åº¦ç«™é•¿è´¦å·</p></blockquote><p>åœ°å€ï¼š <a href="https://ziyuan.baidu.com/?castk=LTE=">https://ziyuan.baidu.com/?castk=LTE%3D</a></p><p>éªŒè¯ç½‘ç«™æ‰€æœ‰æƒï¼š <a href="https://ziyuan.baidu.com/site/index">https://ziyuan.baidu.com/site/index</a></p><p>æ‰“å¼€ä¹‹åè¾“å…¥ä½ çš„åšå®¢é¦–é¡µåœ°å€ï¼Œå¯ä»¥æ˜¯<code>Github Pages</code>æˆ–è€…<code>Vercel</code>çš„åœ°å€ï¼Œç„¶åç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚</p><p>ç«™ç‚¹é¢†åŸŸï¼š ä¿¡æ¯æŠ€æœ¯</p><p>éªŒè¯ï¼šé€‰æ‹©ç¬¬äºŒç§éªŒè¯æ–¹å¼  â†’  HTML éªŒè¯</p><p><strong>æœ¬åšå®¢ä½¿ç”¨çš„æ˜¯ fluid ä¸»é¢˜</strong>ï¼Œ</p><p>è¿›å…¥åšå®¢ç›®å½•ä¸‹Â <code>scripts</code>Â æ–‡ä»¶å¤¹ï¼ˆå¦‚ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰ï¼Œåœ¨é‡Œé¢åˆ›å»ºä»»æ„åç§°çš„ js æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼ˆcontent è§ç™¾åº¦å…·ä½“éªŒè¯å†…å®¹)ï¼š</p><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scilab">hexo.extend.filter.register(<span class="hljs-string">&#x27;theme_inject&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(injects)</span> &#123;</span><br>  injects.head.raw(<span class="hljs-string">&#x27;home&#x27;</span>,<span class="hljs-string">&#x27;&lt;meta name=&quot;</span>baidu-site-verification<span class="hljs-string">&quot; content=&quot;</span>xxxxxxxxxxxxxxx<span class="hljs-string">&quot; /&gt;&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>åœ¨åšå®¢ <code>_config.yml</code> æ–‡ä»¶åŠ ä¸€å¥ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">baidu_site_verification:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å‘å¸ƒä½ çš„åšå®¢ï¼Œåœ¨åšå®¢é¦–é¡µæŒ‰<code>F12</code>ï¼Œå¦‚æœåœ¨<code>head</code>æ ‡ç­¾ä¸­çœ‹åˆ°äº†éªŒè¯æ ‡ç­¾åˆ™æˆåŠŸäº†ã€‚</p><p>ç‚¹å‡»éªŒè¯æŒ‰é’®ï¼Œå¦‚æœæ²¡é—®é¢˜åˆ™å·²æˆåŠŸã€‚</p><blockquote><p>2ã€ç«™ç‚¹åœ°å›¾åŠŸèƒ½</p></blockquote><p>éœ€è¦ç”Ÿæˆä¸€ä¸ªç«™ç‚¹åœ°å›¾</p><p>å…ˆç¡®è®¤ä¸€ä¸‹ <code>_config.yml</code> é…ç½®é‡Œé¢çš„ URL å€¼ï¼Œå¦‚æœä¸æ˜¯æ”¹ä¸ºè‡ªå·±çš„åŸŸååœ°å€ã€‚</p><p>åšå®¢ç›®å½•æ‰§è¡Œå‘½ä»¤</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">npm <span class="hljs-keyword">install </span>hexo-generator-sitemap --save        <span class="hljs-comment">#å®‰è£…sitemapæ’ä»¶</span><br>npm <span class="hljs-keyword">install </span>hexo-generator-<span class="hljs-keyword">baidu-sitemap </span>--save  <span class="hljs-comment">#å®‰è£…baidu-sitemapæ’ä»¶</span><br><br>  <br>hexo g Â <span class="hljs-comment">#ç”Ÿæˆç½‘ç«™é™æ€æ–‡ä»¶åˆ°publicæ–‡ä»¶å¤¹</span><br></code></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„publicç›®å½•ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼Œâ€œsitemap.xml â€å’Œ â€œbaidusitemap.xmlâ€</p></blockquote><p>å…¶ä¸­â€œsitemap.xmlâ€æ–‡ä»¶æ˜¯æœç´¢å¼•æ“é€šç”¨çš„æ–‡ä»¶ï¼Œ</p><p>â€œbaidusitemap.xmlâ€æ˜¯ç™¾åº¦ä¸“ç”¨çš„sitemapæ–‡ä»¶ï¼Œ</p><blockquote><p>3ã€æäº¤sitemapåˆ°ç™¾åº¦èµ„æºæœç´¢å¹³å°</p></blockquote><p>é€‰æ‹©èµ„æºæäº¤ï¼Œç‚¹å‡»æ™®é€šæ”¶å½•ï¼Œé€‰æ‹©sitemapï¼Œ <a href="https://ziyuan.baidu.com/linksubmit/index">https://ziyuan.baidu.com/linksubmit/index</a></p><p>å¡«å†™ç½‘ç«™åœ°å€ï¼Œä¾‹ï¼šâ€œåŸŸå&#x2F;baidusitemap.xmlâ€ï¼Œç‚¹å‡»æäº¤ï¼Œè¿‡ä¸€æ®µæ—¶é—´ååšå®¢å°±å¯ä»¥åœ¨ç™¾åº¦ä¸­æœç´ åˆ°ã€‚</p><p>ä¸ªäººä½¿ç”¨çš„æ—¶å€™è¿™ä¸€æ­¥æ˜¾ç¤ºæäº¤ä¸Šé™æ˜¯ 0 ï¼›åªèƒ½ä½¿ç”¨ä»–æ‰‹åŠ¨æäº¤çš„æ–¹å¼ï¼Œè€Œä¸”åªèƒ½æ˜¯è®¿é—®é“¾æ¥ã€‚</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/Passerby_Wang/article/details/124704475">https://blog.csdn.net/Passerby_Wang/article/details/124704475</a></li><li><a href="https://py-wang.blog.csdn.net/article/details/121202486">https://py-wang.blog.csdn.net/article/details/121202486</a></li><li><a href="https://cloud.tencent.com/developer/article/2317858">https://cloud.tencent.com/developer/article/2317858</a></li><li><a href="https://fluid-dev.github.io/hexo-fluid-docs/advance/#fluid-%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81">https://fluid-dev.github.io/hexo-fluid-docs/advance/#fluid-%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81</a></li><li><a href="https://zhuanlan.zhihu.com/p/150999914">https://zhuanlan.zhihu.com/p/150999914</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>é™æ€é¡µ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vercelçš„å¼€ç®±ä½¿ç”¨_åŒæ­¥Hexoé™æ€åšå®¢</title>
    <link href="/2023/11/23/Vercel%E7%9A%84%E5%BC%80%E7%AE%B1%E4%BD%BF%E7%94%A8_%E5%90%8C%E6%AD%A5Hexo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/"/>
    <url>/2023/11/23/Vercel%E7%9A%84%E5%BC%80%E7%AE%B1%E4%BD%BF%E7%94%A8_%E5%90%8C%E6%AD%A5Hexo%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<p>å®˜ç½‘ï¼š <a href="https://vercel.com/">https://vercel.com/</a></p><p>éƒ¨ç½²æ— è„‘å¼å¯¼å…¥ Github åŸé¡¹ç›®ï¼Œç„¶åè¿›è¡Œ deploy å°±è¡Œã€‚å‘½ä»¤å¯ä»¥è‡ªå®šä¹‰è®¾ç½®ï¼Œä¸€èˆ¬æ˜¯ hexo -s ä¹‹ç±»çš„ã€‚(Vercelsæ˜¯æ”¯æŒä½ æ¨é€ä»£ç åˆ°Githubçš„æ—¶å€™ä½ åœ¨Vercelçš„é¡¹ç›®ä¹Ÿæ˜¯ä¼šè¿›è¡Œè‡ªåŠ¨æ›´æ–°çš„)</p><p>ç‚¹å‡»éƒ¨ç½²çš„æ—¶å€™é¡¹ç›®é…ç½®æ·»åŠ è‡ªå®šä¹‰åŸŸåæ“ä½œï¼š</p><p>Setting â†’  Domains â†’  é€‰æ‹©æ·»åŠ è§£æåŸŸå</p><p>å®˜ç½‘æ–‡æ¡£å‚è€ƒçš„è§£æåŸŸååœ°å€</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311240050203.png" alt="image.png"></p><p>å®é™…æ“ä½œè®°å½•ï¼š</p><p>ä¸ªäººä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„åŸŸåè§£æï¼Œåœ¨å¯¹åº”åŸŸåä¸‹æ·»åŠ äº†è¿™ä¸€æ¡è®°å½•<br>ï¼ˆå¯¹åº” çš„è®°å½•å€¼æ˜¯ <code>cname.vercel-dns.com</code> ï¼Œè®°å½•ç±»å‹éœ€è¦æ˜¯ CNAMEï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311240052961.png" alt="image.png"></p><p>domain é€‰æ‹©ç¼–è¾‘å¯¹åº”çš„åŸŸååœ°å€: </p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">varcel. + ä½ çš„é˜¿é‡Œäº‘åŸŸå<br></code></pre></td></tr></table></figure><p>æœ€åéƒ¨ç½²è®¿é—®æˆåŠŸã€‚</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://juejin.cn/post/7143067114025254919">https://juejin.cn/post/7143067114025254919</a></li><li><a href="https://zhuanlan.zhihu.com/p/646818470">https://zhuanlan.zhihu.com/p/646818470</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>é™æ€é¡µ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è˜‘è‡åšå®¢é¡¹ç›®_Day01</title>
    <link href="/2023/11/23/%E8%98%91%E8%8F%87%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE_Day01/"/>
    <url>/2023/11/23/%E8%98%91%E8%8F%87%E5%8D%9A%E5%AE%A2%E9%A1%B9%E7%9B%AE_Day01/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€é¡¹ç›®ä¸‹è½½"><a href="#1ã€é¡¹ç›®ä¸‹è½½" class="headerlink" title="1ã€é¡¹ç›®ä¸‹è½½"></a>1ã€é¡¹ç›®ä¸‹è½½</h3><p>é¡¹ç›®ä¸‹è½½åœ°å€ï¼š <a href="https://gitee.com/moxi159753/mogu_blog_v2">https://gitee.com/moxi159753/mogu_blog_v2</a></p><h3 id="2ã€é¡¹ç›®åç«¯å¯åŠ¨"><a href="#2ã€é¡¹ç›®åç«¯å¯åŠ¨" class="headerlink" title="2ã€é¡¹ç›®åç«¯å¯åŠ¨"></a>2ã€é¡¹ç›®åç«¯å¯åŠ¨</h3><p>åç«¯é¡¹ç›®å¯åŠ¨ï¼š</p><p>ç›¸å…³ç¯å¢ƒéœ€è¦å…ˆå¯åŠ¨å’Œè¿è¡Œ</p><p><code>nacos</code>ï¼Œ<code>nginx</code>ï¼Œ<code>rabbitmq</code>ï¼ŒÂ <code>redis</code>ï¼Œ<code>mysql</code>ï¼Œ</p><p>æ¨¡å—å¯åŠ¨ï¼š</p><p><code>mogu-gateway</code>ï¼Œ<code>mogu-sms</code>ï¼Œ<code>mogu-picture</code>ï¼ŒÂ <code>mogu-web</code>,Â <code>mogu-admin</code></p><blockquote><p>é…ç½® Nacos</p></blockquote><p>æ¨¡å—å¯åŠ¨å‰å…ˆé…ç½®ä¸€ä¸‹ nacos </p><p>mogu çš„å¯åŠ¨æ–¹å¼æ˜¯å°†æ•°æ®æ”¾åœ¨äº† mysql æ•°æ®åº“ä¸­ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…ˆæ‰§è¡Œå®ƒé¡¹ç›®ä¸­çš„ nacos_config.sql è„šæœ¬</p><p>åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ nacos_configï¼Œå°†é…ç½®å¯¼å…¥åˆ°mysqlä¸­</p><p>è§£å‹nacos åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶åè¿›å…¥ confç›®å½•ï¼Œæ‰“å¼€ application.propertiesæ–‡ä»¶</p><p>åœ¨æ–‡ä»¶çš„æœ«å°¾æ·»åŠ mysqlçš„é…ç½®ä¿¡æ¯ï¼Œæ³¨æ„mysqlçš„è´¦å·å’Œå¯†ç </p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># mysqlé…ç½®</span><br><span class="hljs-attr">spring.datasource.platform</span>=mysql<br><span class="hljs-attr">db.num</span>=<span class="hljs-number">1</span><br><span class="hljs-attr">db.url.0</span>=jdbc:mysql://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3306</span>/nacos_config?characterEncoding=utf8&amp;connectTimeout=<span class="hljs-number">1000</span>&amp;socketTimeout=<span class="hljs-number">3000</span>&amp;autoReconnect=<span class="hljs-literal">true</span>&amp;serverTimezone=UTC<br><span class="hljs-attr">db.user</span>=root<br><span class="hljs-attr">db.password</span>=root<br></code></pre></td></tr></table></figure><p>åˆ°nacosä¸‹çš„ bin ç›®å½•ï¼Œå¯åŠ¨æœåŠ¡</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">startup.<span class="hljs-built_in">cmd</span> -m standalone<br></code></pre></td></tr></table></figure><p>è®¿é—®ï¼š <a href="http://127.0.0.1:8848/nacos/#/login">http://127.0.0.1:8848/nacos/#/login</a></p><p>å¯åŠ¨æ¨¡å—å‰å…ˆå°† dev å‘½åç©ºé—´ä¸‹çš„ é…ç½®æ–‡ä»¶å¯¹åº”çš„ redis, zipkin,mysql,rabbitmqçš„é…ç½®æ–‡ä»¶æ”¹ä¸€ä¸‹</p><p>å¯åŠ¨ä¸€ä¸‹ ç›¸åº”æœåŠ¡</p><blockquote><p>æ‰§è¡Œä¸€ä¸‹æ•°æ®åº“SQL è„šæœ¬</p></blockquote><blockquote><p>ä¿®æ”¹ä¸€ä¸‹ Nacos é…ç½®æ–‡ä»¶</p></blockquote><blockquote><p>ä¾æ¬¡å¯åŠ¨æœåŠ¡ï¼š<code>mogu-gateway</code>ï¼Œ<code>mogu-sms</code>ï¼Œ<code>mogu-picture</code>ï¼ŒÂ <code>mogu-web</code>,Â <code>mogu-admin</code></p></blockquote><p>å¦‚æœæ˜¾ç¤º zipkin è¿æ¥å¤±è´¥ï¼Œå°è¯•ä¿®æ”¹ä¸€ä¸‹é…ç½®ï¼Œæ·»åŠ ä¸€ä¸‹ serviceName</p><p>Spring Cloud Sleuthé…ç½®ä¸­è®¾ç½®æœåŠ¡åç§°çš„ç¤ºä¾‹ï¼š</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">spring:</span><br><span class="hljs-symbol">  sleuth:</span><br><span class="hljs-symbol">    sampler:</span><br><span class="hljs-symbol">      probability:</span> <span class="hljs-number">1.0</span><br><span class="hljs-symbol">    zipkin:</span><br><span class="hljs-symbol">      baseUrl:</span> http:<span class="hljs-comment">//192.168.31.79:9411</span><br><span class="hljs-symbol">      serviceName:</span> your-service-name<br></code></pre></td></tr></table></figure><p>åç«¯å¯åŠ¨æˆåŠŸåï¼Œèƒ½å¤ŸæŸ¥çœ‹åˆ°å¯¹åº”çš„Swaggeræ¥å£æ–‡æ¡£</p><blockquote><p>nacosç‰ˆæœ¬ï¼šswagger-uiä½¿ç”¨çš„æ˜¯3.Xï¼Œè®¿é—®çš„é¡µé¢æ˜¯Â <a href="http://localhost:8601/swagger-ui/index.html">http://localhost:8601/swagger-ui/index.html</a><br>sms æœåŠ¡é‡Œé¢æœ‰çŸ­ä¿¡å’Œé‚®ç®±çš„é…ç½®ï¼Œä¹Ÿæ³¨æ„æ”¹ä¸€ä¸‹</p></blockquote><hr><h3 id="3ã€å‰ç«¯é¡¹ç›®å¯åŠ¨"><a href="#3ã€å‰ç«¯é¡¹ç›®å¯åŠ¨" class="headerlink" title="3ã€å‰ç«¯é¡¹ç›®å¯åŠ¨"></a>3ã€å‰ç«¯é¡¹ç›®å¯åŠ¨</h3><blockquote><p>vue_mogu_admin</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># æŒ‡å®šnode-sassçš„å›½å†…é•œåƒæº</span><br>npm i node-sass <span class="hljs-attribute">--sass_binary_site</span>=https://npm.taobao.org/mirrors/node-sass<br><br><span class="hljs-comment"># ä½¿ç”¨æ·˜å®é•œåƒæºè¿›è¡Œä¾èµ–å®‰è£…ï¼Œè§£å†³å›½å†…ä¸‹è½½ç¼“æ…¢çš„é—®é¢˜(å‡ºç°è­¦å‘Šå¯ä»¥å¿½ç•¥)</span><br>npm install <span class="hljs-attribute">--registry</span>=https://registry.npm.taobao.org<br><br><span class="hljs-comment"># å¯åŠ¨é¡¹ç›®</span><br>npm <span class="hljs-built_in">run</span> dev<br><br><span class="hljs-comment">#æ‰“åŒ…é¡¹ç›®ï¼ˆåœ¨éƒ¨ç½²çš„æ—¶å€™æ‰éœ€è¦ä½¿ç”¨ï¼‰</span><br>npm <span class="hljs-built_in">run</span> build<br></code></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®æˆåŠŸåï¼Œä¼šè·³è½¬åˆ°ï¼šlocalhost:9528 ï¼Œ</p><p>é»˜è®¤è´¦å·å¯†ç ï¼š admin, mogu2018 </p><p>å®é™…åœ¨è¿è¡Œé¡¹ç›®çš„æ—¶å€™ï¼Œç¬¬ä¸€æ­¥æœ‰äº›é—®é¢˜ï¼Œåšäº†ä»¥ä¸‹æ“ä½œï¼š</p><ul><li><ol><li>æ›´æ–°äº†ä¸€ä¸‹ä¾èµ–ç‰ˆæœ¬ï¼šâ€html-webpack-pluginâ€:Â â€œ3.2.0â€,</li></ol></li><li><ol start="2"><li>å°†windows ä¸‹çš„ 3.x çš„python ç‰ˆæœ¬é™çº§å®‰è£…ä¸º 2.x ç‰ˆæœ¬ï¼Œä¸”ä¸è¶…è¿‡ 2.7</li></ol></li><li><ol start="3"><li>å®‰è£…äº† Visual C++ Build Tools for Visual Studio 2015</li></ol></li></ul><p>å…³äºç¬¬ä¸‰æ­¥ï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://my.visualstudio.com/Downloads?q=C++%20build">Downloads &amp; Keys - Visual Studio Subscriptions</a></p><p>åœ¨ç±»å‹å¤„é€‰æ‹©DVDï¼Œç„¶åä¸‹è½½ä¸‹æ¥ï¼Œè§£å‹ç¼©åè¿è¡Œå…¶ä¸­çš„exeæ–‡ä»¶</p><blockquote><p>vue_mogu_web</p></blockquote><p>ä¸ä¸Šé¢ä¸€è‡´ï¼Œè®¿é—®ç•Œé¢ï¼šlocalhost:9527</p><p>å®é™…æ“ä½œï¼Œæœ‰ä¸€äº›æ›´æ”¹</p><ul><li><ol><li>ç”±äºä¾èµ–ä¸­ â€œnode-sassâ€:Â â€œ^4.14.1â€, éœ€è¦å’Œ node ç‰ˆæœ¬å¯¹åº”ï¼Œè¿™é‡Œåˆ‡æ¢ Node 14 ç‰ˆæœ¬ï¼ˆä½¿ç”¨NVM)</li></ol></li><li><ol start="2"><li>å†æ¬¡æ‰§è¡Œä¸Šé¢ç›¸åŒçš„è¿è¡Œå‘½ä»¤</li></ol></li><li><ol start="3"><li>é‡åˆ°è¿è¡Œå‘½ä»¤å¯ä»¥å°è¯•å…ˆåˆ é™¤node_module æ–‡ä»¶å¤¹å†æ‰§è¡Œï¼Œæˆ–è€…æ‰§è¡Œ <code>npm cache clean --force</code> å†è¯•ä¸€ä¸‹ã€‚</li></ol></li></ul><p>è‡³æ­¤ï¼Œé¡¹ç›®æ˜¯èƒ½å¤Ÿå®Œæ•´è¿è¡Œå¹¶åœ¨æµè§ˆå™¨ä¸Šé¢è®¿é—®ã€‚</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://gitee.com/moxi159753/mogu_blog_v2.git">https://gitee.com/moxi159753/mogu_blog_v2.git</a></li><li><a href="https://moxi159753.gitee.io/mogu_blog_doc/#/README">https://moxi159753.gitee.io/mogu_blog_doc/#/README</a></li><li><a href="https://blog.csdn.net/colleges/article/details/123769410">https://blog.csdn.net/colleges/article/details/123769410</a></li><li><a href="https://www.jb51.net/article/281818.htm">https://www.jb51.net/article/281818.htm</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Eureka</title>
    <link href="/2023/11/22/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Eureka/"/>
    <url>/2023/11/22/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Eureka/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€Eureka-æ˜¯ä»€ä¹ˆ"><a href="#1ã€Eureka-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€Eureka æ˜¯ä»€ä¹ˆ"></a>1ã€Eureka æ˜¯ä»€ä¹ˆ</h3><p>Eureka æ˜¯ä¸€ä¸ªNetflix å¼€æºçš„æœåŠ¡å‘ç°ç»„ä»¶ï¼ŒåŒ…æ‹¬ Server å’Œ Client ä¸¤éƒ¨åˆ†ã€‚åœ¨ Spring Cloud å­é¡¹ç›® Spring Cloud Netflix ä¸­ã€‚</p><blockquote><p>æœåŠ¡æ³¨å†Œä¸å‘ç°</p></blockquote><p>Eurekaé‡‡ç”¨äº†CSçš„è®¾è®¡æ¶æ„ï¼ŒEureka Serverä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚</p><p>è€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨Eurekaçš„å®¢æˆ·ç«¯è¿æ¥åˆ°Eureka Serverå¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚</p><p>è¿™æ ·ç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡Eureka Serveræ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</p><p>åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­ï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€‚å½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰è‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯æ¯”å¦‚æœåŠ¡åœ°å€é€šè®¯åœ°å€ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚å¦ä¸€æ–¹ï¼ˆæ¶ˆè´¹è€…æœåŠ¡æä¾›è€…)ï¼Œä»¥è¯¥åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡é€šè®¯åœ°å€ï¼Œç„¶åå†å®ç°æœ¬åœ°RPCè°ƒç”¨ã€‚</p><p>RPCè¿œç¨‹è°ƒç”¨æ¡†æ¶æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šåœ¨äºæ³¨å†Œä¸­å¿ƒï¼Œå› ä¸ºä½¿ç”¨æ³¨å†Œä¸­å¿ƒç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»ï¼ˆæœåŠ¡æ²»ç†æ¦‚å¿µï¼‰ã€‚åœ¨ä»»ä½• rpc è¿œç¨‹æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼ˆå­˜æ”¾æœåŠ¡åœ°å€ç›¸å…³ä¿¡æ¯ï¼ˆæ¥å£åœ°å€ï¼‰)</p><p>Eureka ç³»ç»Ÿæ¶æ„ï¼ˆå³å›¾æ˜¯Dubboçš„æ¶æ„ï¼‰<br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311222335266.png" alt="image.png"></p><blockquote><p>Eureka Server ä¸ Eureka Client</p></blockquote><p>Eureka Server æä¾›æœåŠ¡æ³¨å†ŒæœåŠ¡ï¼Œå„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨ Eureka Serverä¸­è¿›è¡Œæ³¨å†Œï¼Œè¿™æ ·EurekaServerä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°ã€‚</p><p>Eureka Clienté€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®ï¼Œ Eureka Client æ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–Eureka Serverçš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢(round-robin)è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚</p><p>åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘Eureka Serverå‘é€å¿ƒè·³ï¼ˆé»˜è®¤å‘¨æœŸä¸º30ç§’ï¼‰ã€‚å¦‚æœEureka Server åœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEurekaServerå°†ä¼šä»æœåŠ¡æ³¨å†Œè¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤ï¼ˆé»˜è®¤90ç§’ï¼‰</p><h3 id="2ã€åŸºæœ¬ä½¿ç”¨"><a href="#2ã€åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2ã€åŸºæœ¬ä½¿ç”¨"></a>2ã€åŸºæœ¬ä½¿ç”¨</h3><blockquote><p>æœåŠ¡ç«¯</p></blockquote><p>pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--çƒ­éƒ¨ç½²å·¥å…·--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">7001</span><br><br><span class="hljs-comment">#Eurekaé…ç½®</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span> <span class="hljs-comment">#EurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">false</span>   <span class="hljs-comment">#è¡¨ç¤ºæ˜¯å¦å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">false</span>   <span class="hljs-comment">#ä¸ºfalseè¡¨ç¤ºè‡ªå·±æ˜¯æ³¨å†Œä¸­å¿ƒ</span><br>    <span class="hljs-attr">service-url:</span>    <span class="hljs-comment">#ç›‘æ§é¡µé¢</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨ç±»</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@EnableEurekaServer</span> <span class="hljs-comment">//å¯åŠ¨æœåŠ¡å‘ç°ï¼Œæ¥å—æ³¨å†Œ</span><br><span class="hljs-variable">@SpringBootApplication</span><br>public class EurekaServer_7001 &#123;<br><br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) &#123;<br>        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(EurekaServer_7001.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨é¡¹ç›®ï¼Œè®¿é—® <a href="http://localhost:7001/">http://localhost:7001/</a></p><blockquote><p>å®¢æˆ·ç«¯</p></blockquote><p>pom</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.7.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>application</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#Eurekaé…ç½®</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka/</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">springcloud-provider-dept-8001</span>   <span class="hljs-comment"># ä¿®æ”¹eurekaä¸Šçš„é»˜è®¤æè¿°ä¿¡æ¯</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># true,å¯ä»¥æ˜¾ç¤ºæœåŠ¡çš„IPåœ°å€</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨ç±»</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@SpringBootApplication</span><br><span class="hljs-variable">@EnableEurekaClient</span><br>public class DeptProvider_8001 &#123;<br><br>    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) &#123;<br>        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(DeptProvider_8001.class,args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>to be continedâ€¦.</p><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/qq_36903261/article/details/106551120">https://blog.csdn.net/qq_36903261/article/details/106551120</a></li><li><a href="https://blog.csdn.net/qq_45078781/article/details/118671285">https://blog.csdn.net/qq_45078781/article/details/118671285</a></li><li><a href="https://www.bilibili.com/video/BV18E411x7eT">https://www.bilibili.com/video/BV18E411x7eT</a></li><li><a href="https://zhuanlan.zhihu.com/p/142941185">https://zhuanlan.zhihu.com/p/142941185</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¾®æœåŠ¡</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>springcloud</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€šè¿‡RestTemplateè¿›è¡Œè¿œç¨‹è°ƒç”¨</title>
    <link href="/2023/11/22/%E9%80%9A%E8%BF%87RestTemplate%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8/"/>
    <url>/2023/11/22/%E9%80%9A%E8%BF%87RestTemplate%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>RestTemplate æ˜¯ä» Spring3.0 å¼€å§‹æ”¯æŒçš„ä¸€ä¸ª HTTP è¯·æ±‚å·¥å…·ï¼Œå®ƒæä¾›äº†å¸¸è§çš„RESTè¯·æ±‚æ–¹æ¡ˆçš„æ¨¡ç‰ˆã€‚å¯¹äºè¿œç¨‹è¯·æ±‚è¿›è¡Œäº†ä¸€å®šå°è£…ï¼Œä»è€Œé€šè¿‡å»ºè®®é…ç½®å¯ä»¥å®ç°è¿œç¨‹è°ƒç”¨ã€‚</p><p>ä»–åº•å±‚ç”¨çš„æ˜¯ JDK çš„ HTTP è¯·æ±‚</p><ol><li>æ·»åŠ ä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.2.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>httpclient<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.5.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>é…ç½®ç±»</li></ol><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> com.example.demo.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.http.client.ClientHttpRequestFactory;<br><span class="hljs-keyword">import</span> org.springframework.http.client.SimpleClientHttpRequestFactory;<br><span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * RestTemplateé…ç½®ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">RestTemplateConfig</span> </span>&#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RestTemplate restTemplate(ClientHttpRequestFactory factory)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-type">RestTemplate</span>(factory);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ClientHttpRequestFactory simpleClientHttpRequestFactory()&#123;<br>        SimpleClientHttpRequestFactory factory = <span class="hljs-keyword">new</span> <span class="hljs-type">SimpleClientHttpRequestFactory</span>();<br>        factory.setReadTimeout(<span class="hljs-number">5000</span>);<span class="hljs-comment">//å•ä½ä¸ºms</span><br>        factory.setConnectTimeout(<span class="hljs-number">5000</span>);<span class="hljs-comment">//å•ä½ä¸ºms</span><br>        <span class="hljs-keyword">return</span> factory;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="3"><li>ç¤ºä¾‹è°ƒç”¨æ“ä½œ</li></ol><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-keyword">public</span> static <span class="hljs-keyword">final</span> String PAYMENT_URL = <span class="hljs-string">&quot;http://localhost:8001&quot;</span>;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> RestTemplate restTemplate;<br><br>    <span class="hljs-comment">//å› ä¸ºæµè§ˆå™¨åªæ”¯æŒgetè¯·æ±‚ï¼Œä¸ºäº†æ–¹ä¾¿è¿™é‡Œå°±ç”¨get</span><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/consumer/payment/create&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; create(Payment payment)&#123;<br>        log.info(<span class="hljs-string">&quot;********æ’å…¥çš„æ•°æ®ï¼š&quot;</span> + payment);<br>        <span class="hljs-comment">//postForObjectåˆ†åˆ«æœ‰ä¸‰ä¸ªå‚æ•°ï¼šè¯·æ±‚åœ°å€ï¼Œè¯·æ±‚å‚æ•°ï¼Œè¿”å›çš„å¯¹è±¡ç±»å‹</span><br>        <span class="hljs-keyword">return</span> restTemplate.postForObject(PAYMENT_URL + <span class="hljs-string">&quot;/payment/create&quot;</span>, payment, CommonResult.<span class="hljs-keyword">class</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(<span class="hljs-string">&quot;/consumer/payment/get/&#123;id&#125;&quot;</span>)</span><br>    <span class="hljs-keyword">public</span> CommonResult&lt;Payment&gt; getPayment(<span class="hljs-meta">@PathVariable(<span class="hljs-string">&quot;id&quot;</span>)</span> <span class="hljs-built_in">Long</span> id)&#123;<br>        log.info(<span class="hljs-string">&quot;********æŸ¥è¯¢çš„idï¼š&quot;</span> + id);<br>        <span class="hljs-comment">//getForObjectä¸¤ä¸ªå‚æ•°ï¼šè¯·æ±‚åœ°å€ï¼Œè¿”å›çš„å¯¹è±¡ç±»å‹</span><br>        <span class="hljs-keyword">return</span> restTemplate.getForObject(PAYMENT_URL + <span class="hljs-string">&quot;/payment/get/&quot;</span> + id, CommonResult.<span class="hljs-keyword">class</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>to be continedâ€¦ </p><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/weixin_44073321/article/details/102804615">https://blog.csdn.net/weixin_44073321/article/details/102804615</a></li><li><a href="https://blog.csdn.net/weixin_43702146/article/details/116567707">https://blog.csdn.net/weixin_43702146/article/details/116567707</a></li><li><a href="https://blog.csdn.net/dqxiaoxiao/article/details/114375873">https://blog.csdn.net/dqxiaoxiao/article/details/114375873</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>é¡¹ç›®</category>
      
      <category>ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>spring</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¸¸è§å·¥ç¨‹æŠ¥é”™é—®é¢˜</title>
    <link href="/2023/11/22/%E5%B8%B8%E8%A7%81%E5%B7%A5%E7%A8%8B%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98/"/>
    <url>/2023/11/22/%E5%B8%B8%E8%A7%81%E5%B7%A5%E7%A8%8B%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>to be continedâ€¦.</p>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>project</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Chapters1_æé™ä¸è¿ç»­</title>
    <link href="/2023/11/21/Chapters1_%E6%9E%81%E9%99%90%E4%B8%8E%E8%BF%9E%E7%BB%AD/"/>
    <url>/2023/11/21/Chapters1_%E6%9E%81%E9%99%90%E4%B8%8E%E8%BF%9E%E7%BB%AD/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€æ˜ å°„ä¸å‡½æ•°"><a href="#1ã€æ˜ å°„ä¸å‡½æ•°" class="headerlink" title="1ã€æ˜ å°„ä¸å‡½æ•°"></a>1ã€æ˜ å°„ä¸å‡½æ•°</h3><p>å­¦ä¹ æé™å‰ï¼Œå…ˆäº†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œå¯¹äºå‡½æ•°æ•´ä¸ªå†…å®¹æœ‰ä¸€ä¸ªè®¤è¯†ã€‚</p><h4 id="å‡½æ•°çš„æ¦‚å¿µ"><a href="#å‡½æ•°çš„æ¦‚å¿µ" class="headerlink" title="å‡½æ•°çš„æ¦‚å¿µ"></a>å‡½æ•°çš„æ¦‚å¿µ</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210437941.png" alt="image.png"></p><p>å®šä¹‰ï¼šå®šä¹‰åŸŸå†…<strong>ä»»ä½•</strong>å…ƒç´ ï¼Œéƒ½åœ¨å€¼åŸŸä¸­æœ‰<strong>å”¯ä¸€</strong>çš„å…ƒç´ ä¸ä¹‹å¯¹åº”ã€‚</p><p>å‡½æ•°æ¦‚å¿µæœ‰ä¸¤ä¸ªåŸºæœ¬è¦ç´ ï¼šå®šä¹‰åŸŸã€å¯¹åº”æ³•åˆ™ã€‚</p><p>ç†è§£ï¼šå‡½æ•°æ˜¯ç ”ç©¶å…³ç³»çš„ï¼Œæ˜¯åœ¨ç ”ç©¶ä¸¤ä¸ªå˜é‡ä¹‹é—´çš„å…³ç³»ã€‚å…·ä½“æ¥è¯´ï¼Œå‡½æ•°æ˜¯ç ”ç©¶å› å˜é‡æ˜¯æ€ä¹ˆéšç€è‡ªå˜é‡çš„å˜åŒ–è€Œå˜åŒ–çš„ã€‚</p><blockquote><p>ä¸¾ä¾‹</p></blockquote><p>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨é€Ÿåº¦ä¸º40km&#x2F;hçš„åŒ€é€Ÿè¿åŠ¨è¿‡ç¨‹ä¸­ï¼Œè·¯ç¨‹éšæ—¶é—´çš„å˜åŒ–è€Œå˜åŒ–ï¼š</p><ul><li>æ—¶é—´æ˜¯1æ—¶ï¼Œè·¯ç¨‹æ˜¯40ï¼›</li><li>æ—¶é—´æ˜¯2æ—¶ï¼Œè·¯ç¨‹å°±æ˜¯80ã€‚</li></ul><p>è·¯ç¨‹&#x3D;40 * æ—¶é—´ã€‚è·¯ç¨‹å°±å«åšæ—¶é—´çš„å‡½æ•°ã€‚</p><p>ä½†ä¸æ˜¯æœ‰å…³ç³»å°±æ˜¯å‡½æ•°ï¼Œä¸æ˜¯å› å˜é‡éšè‡ªå˜é‡å˜åŒ–å°±æ˜¯å‡½æ•°ã€‚è¿˜å¾—æ»¡è¶³ä¸€ä¸ªé‡è¦çš„æ¡ä»¶ï¼šå¯¹äºè‡ªå˜é‡çš„æ¯ä¸€ä¸ªå–å€¼ï¼Œå› å˜é‡éƒ½æœ‰å”¯ä¸€çš„å€¼ä¸å®ƒå¯¹åº”ï¼</p><p>ä¾‹å¦‚ï¼Œä¸Šè¿°åŒ€é€Ÿè¿åŠ¨è¿‡ç¨‹ä¸­ï¼Œæ—¶é—´æ¯å–ä¸€ä¸ªå€¼ï¼Œå¯¹åº”è®¡ç®—å‡ºè·¯ç¨‹ä¹Ÿæ˜¯ä¸€ä¸ªå€¼ã€‚</p><p>åä¾‹ï¼š|y|&#x3D;xï¼Œåœ¨è¿™ä¸ªå¼å­é‡Œï¼Œyä¹Ÿéšxçš„å˜åŒ–è€Œå˜åŒ–ï¼Œä½†x&#x3D;1æ—¶ï¼Œy&#x3D;1æˆ–â€”1ï¼Œæœ‰ä¸¤ä¸ªå€¼äº†ã€‚é‚£yå°±ä¸æ˜¯xçš„å‡½æ•°äº†ã€‚</p><p>æ‰€ä»¥ï¼Œå‡½æ•°æ˜¯ä¸¤ä¸ªå˜é‡ä¹‹é—´çš„ç‰¹æ®Šå…³ç³»</p><h4 id="å‡ ä¸ªå¸¸è§å‡½æ•°"><a href="#å‡ ä¸ªå¸¸è§å‡½æ•°" class="headerlink" title="å‡ ä¸ªå¸¸è§å‡½æ•°"></a>å‡ ä¸ªå¸¸è§å‡½æ•°</h4><ul><li>ç»å¯¹å€¼å‡½æ•°</li><li>ç¬¦å·å‡½æ•°</li><li>å–æ•´å‡½æ•°</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210449362.png" alt="image.png"></p><h4 id="å‡½æ•°çš„ç‰¹æ€§"><a href="#å‡½æ•°çš„ç‰¹æ€§" class="headerlink" title="å‡½æ•°çš„ç‰¹æ€§"></a>å‡½æ•°çš„ç‰¹æ€§</h4><ul><li>æœ‰ç•Œæ€§</li><li>å•è°ƒæ€§</li><li>å¥‡å¶æ€§</li><li>å‘¨æœŸæ€§</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210452693.png" alt="image.png"></p><h4 id="åå‡½æ•°ä¸å¤åˆå‡½æ•°"><a href="#åå‡½æ•°ä¸å¤åˆå‡½æ•°" class="headerlink" title="åå‡½æ•°ä¸å¤åˆå‡½æ•°"></a>åå‡½æ•°ä¸å¤åˆå‡½æ•°</h4><blockquote><p>åå‡½æ•°</p></blockquote><p>å®šä¹‰ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210455686.png" alt="image.png"></p><blockquote><p>å¤åˆå‡½æ•°</p></blockquote><p>å¤åˆæ¡ä»¶ï¼šå†…å±‚å‡½æ•°å€¼åŸŸä¸å¤–å±‚å‡½æ•°å®šä¹‰åŸŸçš„äº¤é›†éç©º</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210456045.png" alt="image.png"></p><h4 id="å‡½æ•°çš„è¿ç®—"><a href="#å‡½æ•°çš„è¿ç®—" class="headerlink" title="å‡½æ•°çš„è¿ç®—"></a>å‡½æ•°çš„è¿ç®—</h4><p>å‡½æ•°çš„è¿ç®—ï¼ˆåŠ å‡ä¹˜é™¤ï¼‰</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210457870.png" alt="image.png"></p><p>å…¶ä¸­å‡½æ•°ç›¸é™¤çš„æ—¶å€™ g(x) ä¸ç­‰äº 0 </p><p>ç›¸å…³å®šç†ï¼šä»»ä½•ä¸€ä¸ªå‡½æ•°(å®šä¹‰åŸŸå¯¹ç§°)éƒ½å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¥‡å‡½æ•°å’Œä¸€ä¸ªå¶å‡½æ•°ï¼Œä½¿å¾—è¿™ä¸ªå‡½æ•°ç­‰äºå¶å‡½æ•°åŠ å¥‡å‡½æ•°</p><blockquote><p>ä¾‹é¢˜ï¼ˆè¯æ˜é¢˜ï¼‰</p></blockquote><p>ä»¥å‡½æ•°çš„è¿ç®—è¯æ˜:ä»»ç»™f(x)çš„å®šä¹‰åŸŸä¸º(-L,L),è¯æ˜å¿…å­˜åœ¨(-L,L)ä¸Šçš„å¶å‡½æ•°g(x)ä»¥åŠå¥‡å‡½æ•°h(x),ä½¿å¾—f(x)&#x3D;g(x)+h(x)</p><p>è§£æï¼š</p><p>æ ¹æ®å‰é¢å‡½æ•°ç‰¹å¾ä¸­çš„å¥‡å¶æ€§ï¼Œå¯ä»¥å¾—çŸ¥ å¥‡å‡½æ•° h( -x ) &#x3D; -h(x) ; å¶å‡½æ•° g(-x) &#x3D; g(x)</p><p>å…ˆå‡è®¾å­˜åœ¨è¿™æ ·çš„å¥‡å¶å‡½æ•°ï¼Œ</p><p>to be improveâ€¦.</p><p>è§£ç­”ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210502430.png" alt="image.png"></p><h4 id="åˆç­‰å‡½æ•°"><a href="#åˆç­‰å‡½æ•°" class="headerlink" title="åˆç­‰å‡½æ•°"></a>åˆç­‰å‡½æ•°</h4><p>å®šä¹‰ï¼šç”±å¸¸æ•°å’ŒåŸºæœ¬åˆç­‰å‡½æ•°ç»è¿‡æœ‰é™æ¬¡çš„åŠ ã€å‡ã€ä¹˜ã€ é™¤å’Œå¤åˆæ‰€å¾—åˆ°ä¸”èƒ½ç”¨ä¸€ä¸ªè§£æå¼è¡¨ç¤ºçš„å‡½æ•°,ç§°ä¸ºåˆç­‰å‡½æ•°</p><blockquote><p>åŸºæœ¬åˆç­‰å‡½æ•°</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210504661.png" alt="image.png"></p><blockquote><p>å…³äºåä¸‰è§’å‡½æ•°</p></blockquote><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210505070.png" alt="image.png"></p><blockquote><p>å†…å®¹å°ç»“</p></blockquote><ul><li>å‡½æ•°çš„å®šä¹‰åŠå‡½æ•°çš„äºŒè¦ç´ <ul><li>å®šä¹‰åŸŸ</li><li>å¯¹åº”æ³•åˆ™</li></ul></li><li>å‡½æ•°çš„ç‰¹æ€§<ul><li>æœ‰ç•Œæ€§ï¼Œå•è°ƒæ€§ï¼Œå¥‡å¶æ€§ï¼Œå‘¨æœŸæ€§</li></ul></li><li>å¤åˆå‡½æ•°ä¸åå‡½æ•°</li><li>åŸºæœ¬åˆç­‰å‡½æ•°ä¸åˆç­‰å‡½æ•°</li></ul><h3 id="2ã€æ•°åˆ—çš„æé™"><a href="#2ã€æ•°åˆ—çš„æé™" class="headerlink" title="2ã€æ•°åˆ—çš„æé™"></a>2ã€æ•°åˆ—çš„æé™</h3><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210548604.png" alt="image.png"></p><blockquote><p>ä¾‹é¢˜</p></blockquote><p>ç”¨å®šä¹‰è¯æ˜ä¸‹åˆ—æé™</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210550053.png" alt="image.png"></p><h4 id="æ”¶æ•›å‡½æ•°çš„æ€§è´¨"><a href="#æ”¶æ•›å‡½æ•°çš„æ€§è´¨" class="headerlink" title="æ”¶æ•›å‡½æ•°çš„æ€§è´¨"></a>æ”¶æ•›å‡½æ•°çš„æ€§è´¨</h4><p>æ”¶æ•›å‡½æ•°çš„æ€§è´¨</p><ul><li>å”¯ä¸€æ€§<ul><li>æ”¶æ•›æ•°åˆ—çš„æé™å”¯ä¸€</li></ul></li><li>æœ‰ç•Œæ€§<ul><li>æ”¶æ•›æ•°åˆ—å¿…æœ‰ç•Œ</li></ul></li><li>ä¿å·æ€§</li><li>ä»»ä¸€å­æ•°åˆ—æ”¶æ•›äºåŒä¸€æé™</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210553054.png" alt="image.png"></p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311210554140.png" alt="image.png"></p><p>to be continedâ€¦</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://zhuanlan.zhihu.com/p/563178651">https://zhuanlan.zhihu.com/p/563178651</a></li><li><a href="https://www.zhihu.com/question/457091692/answer/2763695044">https://www.zhihu.com/question/457091692/answer/2763695044</a></li><li><a href="https://zhuanlan.zhihu.com/p/31206539">https://zhuanlan.zhihu.com/p/31206539</a></li><li>ã€Šæ­¦å¿ è¯¦é«˜æ•°é›¶åŸºç¡€ã€‹</li></ul>]]></content>
    
    
    <categories>
      
      <category>è€ƒè¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginx_åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2023/11/20/Nginx_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2023/11/20/Nginx_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€å¯åŠ¨Nginx"><a href="#1ã€å¯åŠ¨Nginx" class="headerlink" title="1ã€å¯åŠ¨Nginx"></a>1ã€å¯åŠ¨Nginx</h3><blockquote><p>Windows ä¸‹å¯åŠ¨ nginx</p></blockquote><p>åœ¨ä¸‹è½½ nginx åï¼Œåœ¨nginxå®‰è£…ç›®å½•çš„ç»å¯¹è·¯å¾„çš„æ¡†æ¡†å†…è¾“å…¥Â <code>cmd</code></p><p>ç›´æ¥è¾“å…¥Â <code>nginx</code>Â æˆ–è€…Â <code>start nginx</code>ï¼Œç„¶åå›è½¦ï¼Œå°±å¯ä»¥å¯åŠ¨nginx</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">nginx<br><span class="hljs-comment">#æ¨èè¿™ä¸€ç§</span><br><span class="hljs-literal">start</span> nginx<br></code></pre></td></tr></table></figure><p>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥Â <code>localhost:80</code>ï¼Œç„¶åå†å›è½¦, æŸ¥çœ‹æ˜¯å¦æœ‰ nginx è®¿é—®ä¸»é¡µï¼Œå¦‚æœæœ‰ï¼Œåˆ™å¯åŠ¨æˆåŠŸã€‚</p><p>ä¸€èˆ¬è®¿é—®é—®é¢˜æ˜¯ç«¯å£å ç”¨ï¼Œå¯ä»¥æ”¹ä¸€ä¸‹ nginx è®¿é—®ç«¯å£ï¼Œæˆ–è€…æ€æ‰å¯¹åº”è¿›ç¨‹ã€‚</p><p>å…³é—­nginxçš„å‘½ä»¤ï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment">#å¿«é€Ÿå…³é—­</span><br>nginx -s <span class="hljs-literal">stop</span><br><span class="hljs-comment">#ä¼˜é›…å…³é—­</span><br>nginx -s quit<br></code></pre></td></tr></table></figure><p>é‡æ–°åŠ è½½</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nginx -s reload</span><br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯åŠ¨ nginx åä¼šå‡ºç°ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹ï¼Œå…¶ä¸­ 1 ä¸ªæ˜¯ä¸»çº¿ç¨‹ï¼Œå¦å¤– n ä¸ªæ˜¯å·¥ä½œè¿›ç¨‹ã€‚ï¼ˆé€šè¿‡ä½¿ç”¨å¤šä¸ªå·¥ä½œè¿›ç¨‹æ¥å¹¶è¡Œå¤„ç†è¯·æ±‚ï¼Œä»è€Œå®ç°é«˜æ€§èƒ½å’Œé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ï¼‰</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNginxå¯èƒ½ä¼šæ ¹æ®ä½ çš„æœåŠ¡å™¨çš„CPUæ ¸å¿ƒæ•°è‡ªåŠ¨è®¾ç½®å·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œä»¥æœ€å¤§åŒ–åˆ©ç”¨ç¡¬ä»¶èµ„æºã€‚</p><p>å¦‚ä½•åŒºåˆ†ï¼Œä¸€èˆ¬åœ¨ windows ç¯å¢ƒä¸‹ï¼ŒPID è¾ƒå°çš„é‚£ä¸ªæ˜¯å…ˆå¯åŠ¨çš„ï¼ˆPIDè¾ƒå°çš„é‚£ä¸ªè¿›ç¨‹é€šå¸¸æ˜¯é¦–å…ˆå¯åŠ¨çš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸»è¿›ç¨‹ã€‚ï¼‰</p><p><code>tasklist /fi &quot;IMAGENAME eq nginx.exe</code>ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤æˆ–è€…åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸Šçœ‹å¯¹åº”çš„çº¿ç¨‹ä¿¡æ¯</p><p>linux ç¯å¢ƒä¸‹ï¼Œå¯ä»¥é€šè¿‡ <code>ps aux | grep nginx</code>  æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯</p><p>ä¼šæœ‰ç±»ä¼¼è¾“å‡º</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>     <span class="hljs-number">12345</span>  <span class="hljs-number">0</span>.<span class="hljs-number">0</span>  <span class="hljs-number">0</span>.<span class="hljs-number">1</span>  <span class="hljs-number">123456</span>  <span class="hljs-number">7890</span> ?        Ss   Apr10   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> nginx: master process /usr/sbin/nginx -g daemon <span class="hljs-literal">off</span>;<br><span class="hljs-attribute">nginx</span>    <span class="hljs-number">12346</span>  <span class="hljs-number">0</span>.<span class="hljs-number">0</span>  <span class="hljs-number">0</span>.<span class="hljs-number">2</span>  <span class="hljs-number">123457</span>  <span class="hljs-number">7891</span> ?        S    Apr10   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> nginx: worker process<br></code></pre></td></tr></table></figure><h3 id="é€šè¿‡-nginx-è®¿é—®æœåŠ¡å™¨æ–‡ä»¶ï¼ˆé¢„è§ˆï¼‰"><a href="#é€šè¿‡-nginx-è®¿é—®æœåŠ¡å™¨æ–‡ä»¶ï¼ˆé¢„è§ˆï¼‰" class="headerlink" title="é€šè¿‡ nginx è®¿é—®æœåŠ¡å™¨æ–‡ä»¶ï¼ˆé¢„è§ˆï¼‰"></a>é€šè¿‡ nginx è®¿é—®æœåŠ¡å™¨æ–‡ä»¶ï¼ˆé¢„è§ˆï¼‰</h3><p>è¿™é‡Œæ¼”ç¤ºæ“ä½œæ˜¯åœ¨ docker å®¹å™¨ä¸­è¿›è¡Œçš„ï¼Œåœ¨å®¹å™¨å†…éƒ¨ï¼ŒNginxçš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸ä½äº<code>/etc/nginx/nginx.conf</code>æˆ–<code>/etc/nginx/conf.d/</code>ç›®å½•ä¸‹ã€‚</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">vi /etc/nginx/nginx.conf<br><br>###ä¿®æ”¹åé‡æ–°åŠ è½½<br>nginx -s reload<br></code></pre></td></tr></table></figure><p>å®é™…æ“ä½œè¿™é‡Œ vi æ˜¾ç¤ºä¸å­˜åœ¨å‘½ä»¤ï¼Œçœ‹äº†ä¸€ä¸‹å»ºè®®ï¼šå¯¹äºç”Ÿäº§ç¯å¢ƒçš„å®¹å™¨ï¼Œç›´æ¥è¿›å…¥å®¹å™¨ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶ä¸æ˜¯æœ€ä½³å®è·µã€‚æœ€å¥½æ˜¯é€šè¿‡æ›´æ–°é…ç½®æ–‡ä»¶å’Œé‡æ–°éƒ¨ç½²å®¹å™¨çš„æ–¹å¼æ¥ç®¡ç†æ›´æ”¹</p><p>çœ‹äº†ä¸€ä¸‹ Portainer å·¥å…·ä¸­é‡Œé¢æ˜¯å†™äº†æ˜ å°„è·¯å¾„çš„ï¼Œæ ¹æ®æç¤ºæ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼š&#x2F;home&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240321202905.png" alt="image.png"></p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><p><strong>é…ç½®ä¸€ä¸ªæ–°çš„serverå—æˆ–ä¿®æ”¹ç°æœ‰çš„serverå—</strong>ï¼Œä»¥æŒ‡å‘ä½ çš„æ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">server &#123;<br>    listen 80;<br>    192.168.0.21; <span class="hljs-comment"># æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ–IPåœ°å€</span><br><br>    location /files &#123;<br>        <span class="hljs-built_in">alias</span> /root/wJF/shareFiles/; <span class="hljs-comment"># æŒ‡å‘å®é™…çš„æ–‡ä»¶ç›®å½•</span><br>        autoindex on; <span class="hljs-comment"># å¼€å¯ç›®å½•åˆ—è¡¨</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡å¯å®¹å™¨</p><p>è®¿é—®ï¼š<a href="http://192.168.0.21/files">http://192.168.0.21/files</a></p><p>ä¿®æ­£ï¼š</p><p>å¯åŠ¨å‘½ä»¤çš„åŸå› ï¼Œç„¶åç”±äºæ˜¯ Docker å®¹å™¨å†…ï¼Œéœ€è¦æŒ‚è½½è·¯å¾„ï¼Œéœ€è¦æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶å’Œå¯åŠ¨å‘½ä»¤</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br><span class="hljs-attribute">server_name</span> <span class="hljs-number">192.168.0.21</span>; <span class="hljs-comment"># æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ–IPåœ°å€</span><br><br><span class="hljs-section">location</span> /files &#123; <br><span class="hljs-attribute">alias</span> /usr/share/nginx/shareFile/; <span class="hljs-comment"># æŒ‡å‘å®é™…çš„æ–‡ä»¶ç›®å½•</span><br><span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>; <span class="hljs-comment"># å¼€å¯ç›®å½•åˆ—è¡¨</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨å‘½ä»¤</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy">docker run \<br>-p <span class="hljs-number">9002</span>:<span class="hljs-number">80</span> \<br>--name nginx \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/conf/</span>nginx.<span class="hljs-attr">conf:</span><span class="hljs-regexp">/etc/</span>nginx/nginx.conf \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/conf/</span>conf.<span class="hljs-attr">d:</span><span class="hljs-regexp">/etc/</span>nginx/conf.d \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/log:/</span><span class="hljs-keyword">var</span><span class="hljs-regexp">/log/</span>nginx \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/html:/</span>usr<span class="hljs-regexp">/share/</span>nginx/html \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/shareFile/</span>:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>shareFile \<br>-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/ssl:/</span>etc<span class="hljs-regexp">/nginx/</span>ssl \<br>-d <span class="hljs-attr">nginx:</span>latest<br></code></pre></td></tr></table></figure><p>è®¿é—®ï¼š <a href="http://192.168.0.21:9002/files/">http://192.168.0.21:9002/files/</a></p><hr><p>docker å®¹å™¨å†…è®¿é—®æœ‰ç‚¹é—®é¢˜ï¼Œæ”¹ä¸ºåœ¨ windows æœ¬åœ°ç¯å¢ƒä¸‹æ“ä½œ</p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8087</span>;<br><span class="hljs-attribute">server_name</span> localhost; <span class="hljs-comment"># æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ–IPåœ°å€</span><br><br><span class="hljs-section">location</span> /files &#123;<br><span class="hljs-attribute">alias</span> D:/01_LQ/DiaryLearn/Java/Nginx/test/; <span class="hljs-comment"># æŒ‡å‘å®é™…çš„æ–‡ä»¶ç›®å½•</span><br><span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>; <span class="hljs-comment"># å¼€å¯ç›®å½•åˆ—è¡¨</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒç«¯å£ 80 å…³é—­ä¸€ä¸‹ï¼Œæ­£å¸¸è®¿é—® <a href="http://localhost:8087/files">http://localhost:8087/files</a> èƒ½å¤Ÿæ˜¾ç¤ºå¯¹åº”æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸è¦æ˜¯ä¸­æ–‡çš„ï¼Œæ”¯æŒ pdf é¢„è§ˆå’Œä¸‹è½½æ“ä½œã€‚</p><hr><h4 id="ä»ç›®æ ‡æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶"><a href="#ä»ç›®æ ‡æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä»ç›®æ ‡æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶"></a>ä»ç›®æ ‡æœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶</h4><p>ç»è¿‡ä¸Šé¢çš„é…ç½®åï¼Œä½ èƒ½å¤Ÿåœ¨æµè§ˆå™¨è¿›è¡Œè®¿é—®ç›¸å…³æ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œå¦‚æœä½ éœ€è¦ä¸‹è½½ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢æ“ä½œï¼š</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">curl</span> -O <span class="hljs-number">192.168.0.21:9002</span>/files/MQ.pdf<br><br>wget <span class="hljs-number">192.168.0.21:9002</span>/files/MQ.pdf (Liinux)<br></code></pre></td></tr></table></figure><h3 id="ä¸Šä¼ æ–‡ä»¶æ“ä½œ"><a href="#ä¸Šä¼ æ–‡ä»¶æ“ä½œ" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶æ“ä½œ"></a>ä¸Šä¼ æ–‡ä»¶æ“ä½œ</h3><p>åšä¸€ä¸ªç®€æ˜“çš„åå‘ä»£ç†å°±è¡Œï¼Œåç«¯æœåŠ¡å¯ä»¥ä½¿ç”¨ Java çš„ç¨‹åºæˆ–è€…å…¶ä»–çš„</p><p>çœ‹äº†ä¸€ä¸‹ç›¸å…³çš„æ“ä½œè¯´æ˜ï¼Œä¸€èˆ¬éƒ½æ˜¯ é€šè¿‡ä»£ç†æ“ä½œæ¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ æ“ä½œçš„ï¼Œç„¶ååœ¨æ–‡ä»¶ä¸Šä¼ è¿‡ç¨‹ä¸­ï¼Œå¯¹äº nginx çš„é…ç½®æ˜¯æœ‰ä¸€äº›é…ç½®é¡¹é…ç½®çš„ã€‚</p><p>äº†è§£ä¸€äº›å…³äºå¤§æ–‡ä»¶ä¼ è¾“æ—¶å¯èƒ½ä¼šç”¨çš„é…ç½®é¡¹ï¼š</p><table><thead><tr><th>é…ç½®é¡¹</th><th>æè¿°</th></tr></thead><tbody><tr><td>client_max_body_size</td><td>è®¾ç½®è¯·æ±‚ä½“å…è®¸æœ€å¤§ä½“ç§¯</td></tr><tr><td>client_header_timeout</td><td>ç­‰å¾…å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚å¤´çš„è¶…æ—¶æ—¶é—´</td></tr><tr><td>client_body_timeout</td><td>è®¾ç½®è¯»å–è¯·æ±‚ä½“çš„è¶…æ—¶æ—¶é—´</td></tr><tr><td>proxy_read_timeout</td><td>è®¾ç½®è¯·æ±‚è¢«åç«¯æœåŠ¡å™¨è¯»å–æ—¶ï¼ŒNginxç­‰å¾…çš„æœ€é•¿æ—¶é—´</td></tr><tr><td>proxy_send_timeout</td><td>è®¾ç½®</td></tr></tbody></table><p>åœ¨ä¼ è¾“å¤§æ–‡ä»¶æ—¶ï¼Œ<code>client_max_body_size</code>ã€<code>client_header_timeout</code>ã€<code>proxy_read_timeout</code>ã€<code>proxy_send_timeout</code>è¿™å››ä¸ªå‚æ•°å€¼éƒ½å¯ä»¥æ ¹æ®è‡ªå·±é¡¹ç›®çš„å®é™…æƒ…å†µæ¥é…ç½®ã€‚</p><p>å®é™…æ“ä½œè¿›è¡Œçš„é…ç½®</p><p>nginx.conf</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br><span class="hljs-attribute">listen</span> <span class="hljs-number">8087</span>;<br><span class="hljs-attribute">server_name</span> localhost; <span class="hljs-comment"># æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ–IPåœ°å€ </span><br><br><span class="hljs-section">location</span> /files &#123;<br><span class="hljs-attribute">alias</span> D:/01_LQ/DiaryLearn/Java/Nginx/test/download/; <span class="hljs-comment"># æŒ‡å‘å®é™…çš„æ–‡ä»¶ç›®å½•</span><br><span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>; <span class="hljs-comment"># å¼€å¯ç›®å½•åˆ—è¡¨</span><br>&#125;<br><br><span class="hljs-section">location</span> /upload &#123;<br><span class="hljs-comment">#æŒ‡å®šå®¢æˆ·ç«¯è¯·æ±‚ä½“çš„ä¸´æ—¶å­˜å‚¨è·¯å¾„ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸Šä¼ çš„æ•°æ®éå¸¸å¤§ï¼Œä¸èƒ½ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ï¼ŒNginxä¼šå°†æ¥æ”¶åˆ°çš„æ•°æ®æµåˆ†å—å†™å…¥è¿™ä¸ªä¸´æ—¶æ–‡ä»¶å¤¹ã€‚</span><br><span class="hljs-attribute">client_body_temp_path</span> D:/01_LQ/DiaryLearn/Java/Nginx/test/uploads/<span class="hljs-number">1</span>/;<br><span class="hljs-comment">#è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„å¤§å°é™åˆ¶ä¸º5MBã€‚å¦‚æœè¯·æ±‚ä½“çš„å¤§å°è¶…è¿‡è¿™ä¸ªå€¼ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°ä¸€ä¸ªè¡¨ç¤ºè¯·æ±‚å®ä½“è¿‡å¤§çš„413é”™è¯¯ã€‚</span><br><span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">5m</span>;<br><span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br><span class="hljs-comment">#æ‰€æœ‰åŒ¹é…/uploadçš„è¯·æ±‚å°†è¢«è½¬å‘åˆ°æœ¬æœºçš„8080ç«¯å£çš„HTTPæœåŠ¡å™¨ã€‚è¿™æ„å‘³ç€å®é™…å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„æ˜¯ç›‘å¬åœ¨8080ç«¯å£çš„æœåŠ¡å™¨ã€‚</span><br><span class="hljs-attribute">proxy_pass</span> http://localhost:8080/system/file/upload;<br><span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>java çš„åç«¯ä»£ç ç¤ºä¾‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@RestController</span>  <br><span class="hljs-meta">@RequestMapping(<span class="hljs-string">&quot;/system/file&quot;</span>)</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUploadController</span> &#123;  <br>  <br>    <span class="hljs-meta">@PostMapping(<span class="hljs-string">&quot;/upload&quot;</span>)</span>  <br>    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; handleFileUpload(<span class="hljs-meta">@RequestParam(<span class="hljs-string">&quot;file&quot;</span>)</span> MultipartFile file) &#123;  <br>        String message = <span class="hljs-string">&quot;&quot;</span>;  <br>        <span class="hljs-keyword">try</span> &#123;  <br>            <span class="hljs-comment">// ç›®æ ‡ç›®å½•è·¯å¾„å­—ç¬¦ä¸²  </span><br>            String directory = <span class="hljs-string">&quot;D:/01_LQ/DiaryLearn/Java/Nginx/test/uploads/2/&quot;</span>;  <br>            <span class="hljs-comment">// é€šè¿‡Paths.get()è½¬æ¢ä¸ºPathå¯¹è±¡  </span><br>            Path path = Paths.<span class="hljs-keyword">get</span>(directory);  <br>            <span class="hljs-comment">// ç¡®ä¿ç›®å½•å­˜åœ¨  </span><br>            Files.createDirectories(path);  <br>            <span class="hljs-comment">// è§£æè·¯å¾„ä¸æ–‡ä»¶åŸå§‹åç§°ç»„åˆä¸ºæ–°è·¯å¾„  </span><br>            Path filePath = path.resolve(file.getOriginalFilename());  <br>            <span class="hljs-comment">// ä¿å­˜æ–‡ä»¶  </span><br>            Files.copy(file.getInputStream(), filePath);  <br>  <br>            message = <span class="hljs-string">&quot;You successfully uploaded &quot;</span> + file.getOriginalFilename() + <span class="hljs-string">&quot;!&quot;</span>;  <br>            <span class="hljs-keyword">return</span> ResponseEntity.status(<span class="hljs-number">200</span>).body(message);  <br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;  <br>            message = <span class="hljs-string">&quot;Failed to upload &quot;</span> + file.getOriginalFilename() + <span class="hljs-string">&quot; due to &quot;</span> + e.getMessage();  <br>            <span class="hljs-keyword">return</span> ResponseEntity.status(<span class="hljs-number">500</span>).body(message);  <br>        &#125;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>é…ç½®å¤´ç›¸å…³çš„å†…å®¹æ³¨æ„ä¸€ä¸‹ã€‚</p><p>è¿™é‡Œæ”¹å–„ä¸€ä¸‹ä¸Šè¿°çš„ java æ–‡ä»¶ä¼ è¾“ä»£ç </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@PostMapping(<span class="hljs-string">&quot;/upload&quot;</span>)</span>  <br><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; handleFileUpload(<span class="hljs-meta">@RequestParam(<span class="hljs-string">&quot;file&quot;</span>)</span> MultipartFile file) &#123;  <br>    String message = <span class="hljs-string">&quot;&quot;</span>;  <br>    <span class="hljs-keyword">if</span> (file.isEmpty()) &#123;  <br>        <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).body(<span class="hljs-string">&quot;The file is empty.&quot;</span>);  <br>    &#125;  <br>  <br>    <span class="hljs-comment">// ç›®æ ‡ç›®å½•è·¯å¾„å­—ç¬¦ä¸²  </span><br>    String directory = <span class="hljs-string">&quot;D:/01_LQ/DiaryLearn/Java/Nginx/test/uploads/2/&quot;</span>;  <br>    <span class="hljs-comment">// é€šè¿‡Paths.get()è½¬æ¢ä¸ºPathå¯¹è±¡  </span><br>    Path path = Paths.<span class="hljs-keyword">get</span>(directory);  <br>  <br>    <span class="hljs-keyword">try</span> &#123;  <br>        <span class="hljs-comment">// ç¡®ä¿ç›®å½•å­˜åœ¨  </span><br>        Files.createDirectories(path);  <br>  <br>        <span class="hljs-comment">// è§£æè·¯å¾„ä¸æ–‡ä»¶åŸå§‹åç§°ç»„åˆä¸ºæ–°è·¯å¾„  </span><br>        Path filePath = path.resolve(file.getOriginalFilename());  <br>  <br>        <span class="hljs-comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨  </span><br>        <span class="hljs-keyword">if</span> (Files.exists(filePath)) &#123;  <br>            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).body(<span class="hljs-string">&quot;File already exists: &quot;</span> + file.getOriginalFilename());  <br>        &#125;  <br>  <br>        <span class="hljs-comment">// ä¿å­˜æ–‡ä»¶  </span><br>        <span class="hljs-keyword">try</span> (InputStream inputStream = file.getInputStream()) &#123;  <br>            Files.copy(inputStream, filePath);  <br>        &#125;  <br>  <br>        message = <span class="hljs-string">&quot;2 You successfully uploaded &quot;</span> + file.getOriginalFilename() + <span class="hljs-string">&quot;!&quot;</span>;  <br>        <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.OK).body(message);  <br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;  <br>        message = <span class="hljs-string">&quot;Failed to upload &quot;</span> + file.getOriginalFilename() + <span class="hljs-string">&quot; due to &quot;</span> + e.getMessage();  <br>        <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(message);  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦çš„åŒºåˆ«æ˜¯æ·»åŠ äº† try-with-resources ï¼ˆæ³¨æ„æ·»åŠ ä¸€ä¸‹ï¼‰</p><p><code>try-with-resources</code>è¯­å¥å¯ä»¥è‡ªåŠ¨ç®¡ç†èµ„æºï¼Œç¡®ä¿åœ¨è¯­å¥ç»“æŸæ—¶è‡ªåŠ¨å…³é—­èµ„æºï¼Œè¿™å¯¹äºæ–‡ä»¶ä¸Šä¼ ä¸­çš„è¾“å…¥æµéå¸¸æœ‰ç”¨ã€‚</p><h3 id="æ–‡ä»¶ä¼ è¾“"><a href="#æ–‡ä»¶ä¼ è¾“" class="headerlink" title="æ–‡ä»¶ä¼ è¾“"></a>æ–‡ä»¶ä¼ è¾“</h3><p>nginx åº”è¯¥ä¸æ”¯æŒæ–‡ä»¶ä¼ è¾“ï¼Œéœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶è¿›è¡Œæ–‡ä»¶ä¼ è¾“ï¼Œæ¯”å¦‚ sftp ç­‰ã€‚</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://blog.csdn.net/weixin_44251179/article/details/129700793">https://blog.csdn.net/weixin_44251179/article/details/129700793</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docsifyä½¿ç”¨æ•™ç¨‹</title>
    <link href="/2023/11/19/Docsify%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"/>
    <url>/2023/11/19/Docsify%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€å¿«é€Ÿå¼€å§‹"><a href="#1ã€å¿«é€Ÿå¼€å§‹" class="headerlink" title="1ã€å¿«é€Ÿå¼€å§‹"></a>1ã€å¿«é€Ÿå¼€å§‹</h3><p>å…¨å±€å®‰è£…Â <code>docsify-cli</code>Â å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºåŠåœ¨æœ¬åœ°é¢„è§ˆç”Ÿæˆçš„æ–‡æ¡£ã€‚</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">npm i docsify-<span class="hljs-keyword">cli</span> -g<br></code></pre></td></tr></table></figure><blockquote><p>åˆå§‹åŒ–é¡¹ç›®</p></blockquote><p>å¦‚æœæƒ³åœ¨é¡¹ç›®çš„Â <code>./docs</code>Â ç›®å½•é‡Œå†™æ–‡æ¡£ï¼Œç›´æ¥é€šè¿‡Â <code>init</code>Â åˆå§‹åŒ–é¡¹ç›®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docsify init ./docs<br></code></pre></td></tr></table></figure><blockquote><p>å¼€å§‹å†™æ–‡æ¡£</p></blockquote><p>åˆå§‹åŒ–æˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°Â <code>./docs</code>Â ç›®å½•ä¸‹åˆ›å»ºçš„å‡ ä¸ªæ–‡ä»¶</p><ul><li><code>index.html</code>Â å…¥å£æ–‡ä»¶</li><li><code>README.md</code>Â ä¼šåšä¸ºä¸»é¡µå†…å®¹æ¸²æŸ“</li><li><code>.nojekyll</code>Â ç”¨äºé˜»æ­¢ GitHub Pages å¿½ç•¥æ‰ä¸‹åˆ’çº¿å¼€å¤´çš„æ–‡ä»¶</li></ul><p>ç›´æ¥ç¼–è¾‘Â <code>docs/README.md</code>Â å°±èƒ½æ›´æ–°æ–‡æ¡£å†…å®¹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ·»åŠ æ›´å¤šé¡µé¢ã€‚</p><blockquote><p>æœ¬åœ°é¢„è§ˆ</p></blockquote><p>é€šè¿‡è¿è¡ŒÂ <code>docsify serve</code>Â å¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®æ—¶é¢„è§ˆæ•ˆæœã€‚</p><p>é»˜è®¤è®¿é—®åœ°å€Â <a href="http://localhost:3000/">http://localhost:3000</a>Â ã€‚</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docsify serve docs</span><br></code></pre></td></tr></table></figure><h3 id="2ã€å¤šé¡µæ–‡æ¡£è®¾ç½®"><a href="#2ã€å¤šé¡µæ–‡æ¡£è®¾ç½®" class="headerlink" title="2ã€å¤šé¡µæ–‡æ¡£è®¾ç½®"></a>2ã€å¤šé¡µæ–‡æ¡£è®¾ç½®</h3><p>åœ¨ docsify ä¸­ï¼Œä½ è®¿é—®çš„æ–‡æ¡£ URL è·¯å¾„åœ°å€å’Œä½ çš„æ–‡æ¡£æ–‡ä»¶å¤¹ç»“æ„æ˜¯ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼ˆå®ç°å¤šçº§è·¯ç”±ï¼‰ï¼›</p><p>æ¯”å¦‚ä½ åœ¨ doc æ–‡ä»¶å¤¹ä¸­åˆ›å»º<code>guide.md</code>ã€<code>zh-cn/READEME.md</code>ã€<code>zh-cn/guide.md</code>ï¼Œç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dos">.<br>â”œâ”€â”€ README.<span class="hljs-built_in">md</span><br>â”œâ”€â”€ guide.<span class="hljs-built_in">md</span><br>â”œâ”€â”€ index.html<br>â””â”€â”€ zh-cn<br>    â”œâ”€â”€ README.<span class="hljs-built_in">md</span><br>    â””â”€â”€ guide.<span class="hljs-built_in">md</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬è®¿é—®å¦‚ä¸‹urlå³å¯ä»¥è®¿é—®åˆ°å¯¹åº”çš„é¡µé¢ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">README.md=&gt; http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">3000</span><span class="hljs-regexp">/#/</span><br>guide.md=&gt; http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">3000</span><span class="hljs-regexp">/#/gui</span>de<br><span class="hljs-regexp">/zh-cn/</span>README.md  =&gt; http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">3000</span><span class="hljs-regexp">/#/</span>zh-cn/<br><span class="hljs-regexp">/zh-cn/gui</span>de.md   =&gt; http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">3000</span><span class="hljs-regexp">/#/</span>zh-cn/guide<br><br></code></pre></td></tr></table></figure><h3 id="3ã€å®šåˆ¶åŒ–é…ç½®"><a href="#3ã€å®šåˆ¶åŒ–é…ç½®" class="headerlink" title="3ã€å®šåˆ¶åŒ–é…ç½®"></a>3ã€å®šåˆ¶åŒ–é…ç½®</h3><h4 id="ä¾§è¾¹æ è®¾ç½®"><a href="#ä¾§è¾¹æ è®¾ç½®" class="headerlink" title="ä¾§è¾¹æ è®¾ç½®"></a>ä¾§è¾¹æ è®¾ç½®</h4><p>éœ€è¦å…ˆåœ¨ docs&#x2F;index.html ä¸­ä¿®æ”¹ä¸€ä¸‹é…ç½®ï¼Œå¼€å¯ä¾§è¾¹æ çš„é€‰é¡¹æ·»åŠ <code>loadSiderbar: true</code></p><p>è¿™æ ·è®¾ç½®åå°±ä¼šåŠ è½½ Docsify ç›®å½•ä¸‹çš„ _ sidebar.md æ–‡ä»¶,  è¿›è¡ŒåŠ è½½è€Œæ¸²æŸ“æˆæˆ‘ä»¬å®šåˆ¶çš„ä¾§è¾¹æ </p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">// å¼€å¯ä¾§è¾¹æ å®šåˆ¶,åŠ è½½_sidebar.md </span><br>loadSidebar: <span class="hljs-literal">true</span>,<br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311201949003.png" alt="image.png"></p><p>æˆ‘ä»¬åœ¨ docs ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªÂ <code>_sidebar.md</code>Â æ–‡ä»¶ï¼Œé‡Œé¢å¯ä»¥å¯¹ä¾§è¾¹æ è¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚è¿™é‡Œé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- docs/_sidebar.md --&gt;</span><br><br>* [é¦–é¡µ](/) <br>* [guide](/guide)<br>* [zh-cn](zh-cn/)<br>* [zh-cn guide](zh-cn/guide)<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ MarkDown ä¸­çš„è¶…é“¾æ¥è¯­æ³•ï¼Œåé¢çš„è·¯å¾„å¯¹åº”ç€ä¸Šè¿°å¤šé¡µæ–‡æ¡£çš„è·¯ç”±è·¯å¾„</p><p>æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šé¡µé¢çš„æ ‡é¢˜ï¼Œæ¯”å¦‚è¿™é‡ŒæŒ‡å®šé¦–é¡µçš„æ ‡é¢˜ä¸ºhome ã€åé¢æ·»åŠ åŒå¼•å·è¿›è¡Œåˆ«åã€‘</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- docs/_sidebar.md --&gt;</span><br><br>* [é¦–é¡µ](/ &quot;home&quot;) <br>* [guide](/guide)<br>* [zh-cn](zh-cn/)<br>* [zh-cn guide](zh-cn/guide)<br></code></pre></td></tr></table></figure><h4 id="ä¾§è¾¹æ åµŒå¥—è®¾ç½®"><a href="#ä¾§è¾¹æ åµŒå¥—è®¾ç½®" class="headerlink" title="ä¾§è¾¹æ åµŒå¥—è®¾ç½®"></a>ä¾§è¾¹æ åµŒå¥—è®¾ç½®</h4><p>åœ¨å¯¹åº”å­ç›®å½• docs&#x2F;zh-cn ä¸‹åˆ›å»ºä¸€ä¸ªÂ <code>_sidebar.md</code> æ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- docs/zh-cn/_sidebar.md --&gt;</span><br><br>* [zh-ché¦–é¡µ](/zh-cn) <br>* [zh-cn guide](zh-cn/guide)<br></code></pre></td></tr></table></figure><p>_ sidebar.md çš„åŠ è½½é€»è¾‘æ˜¯ä»æ¯å±‚ç›®å½•ä¸‹è·å–æ–‡ä»¶ï¼Œå¦‚æœå½“å‰ç›®å½•ä¸å­˜åœ¨è¯¥æ–‡ä»¶åˆ™å›é€€åˆ°ä¸Šä¸€çº§ç›®å½•ã€‚<br>ä¾‹å¦‚å½“å‰è·¯å¾„ä¸º &#x2F;zh-cn åˆ™ä» &#x2F;zh-cn&#x2F;_ sidebar.md è·å–æ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä» &#x2F;_ sidebar.md è·å–ï¼Œ</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ index.html ä¸­å¦‚ä¸‹é…ç½®è¡¨ç¤ºé»˜è®¤éƒ½èµ°æ ¹è·¯å¾„ä¸‹çš„Â <code>_sidebar.md</code>Â æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-variable language_">window</span>.<span class="hljs-property">$docsify</span> = &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">loadSidebar</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">    <span class="hljs-attr">alias</span>: &#123;</span><br><span class="language-javascript">      <span class="hljs-string">&#x27;/.*/_sidebar.md&#x27;</span>: <span class="hljs-string">&#x27;/_sidebar.md&#x27;</span></span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="å¼€å¯ç›®å½•åŠŸèƒ½"><a href="#å¼€å¯ç›®å½•åŠŸèƒ½" class="headerlink" title="å¼€å¯ç›®å½•åŠŸèƒ½"></a>å¼€å¯ç›®å½•åŠŸèƒ½</h4><p>è‡ªå®šä¹‰ä¾§è¾¹æ åŒæ—¶ä¹Ÿå¯ä»¥å¼€å¯ç›®å½•åŠŸèƒ½ã€‚è®¾ç½®Â <code>subMaxLevel</code>Â é…ç½®é¡¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- index.html --&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">  <span class="hljs-variable language_">window</span>.<span class="hljs-property">$docsify</span> = &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">loadSidebar</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">    <span class="hljs-comment">// å¼€å¯ç›®å½•,æœ€å¤§å±‚çº§ä¸º2</span></span><br><span class="language-javascript">    <span class="hljs-attr">subMaxLevel</span>: <span class="hljs-number">2</span></span><br><span class="language-javascript">  &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="ç›®å½•æŠ˜å åŠŸèƒ½"><a href="#ç›®å½•æŠ˜å åŠŸèƒ½" class="headerlink" title="ç›®å½•æŠ˜å åŠŸèƒ½"></a>ç›®å½•æŠ˜å åŠŸèƒ½</h4><p>éœ€è¦å¼•å…¥ä¸€ä¸‹ docsify-sidebar-collapse æ ·å¼ , å…·ä½“é…ç½®å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge,chrome=1&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;Description&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css&quot;</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- æ–‡ä»¶å¤¹æ ·å¼ --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;//cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/sidebar-folder.min.css&quot;</span> /&gt;</span><br>  <span class="hljs-comment">&lt;!-- ç®­å¤´æ ·å¼ --&gt;</span><br>  <span class="hljs-comment">&lt;!-- &lt;link rel=&quot;stylesheet&quot; href=&quot;//cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/sidebar.min.css&quot; /&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-variable language_">window</span>.<span class="hljs-property">$docsify</span> = &#123;</span><br><span class="language-javascript">      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&#x27;</span>,</span><br><span class="language-javascript">      <span class="hljs-attr">repo</span>: <span class="hljs-string">&#x27;&#x27;</span>,</span><br><span class="language-javascript">  <span class="hljs-comment">// å¼€å¯ä¾§è¾¹æ å®šåˆ¶,åŠ è½½_sidebar.md </span></span><br><span class="language-javascript">  <span class="hljs-attr">loadSidebar</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">  <span class="hljs-comment">// å¼€å¯ç›®å½•,æœ€å¤§å±‚çº§ä¸º2</span></span><br><span class="language-javascript">  <span class="hljs-attr">subMaxLevel</span>: <span class="hljs-number">2</span>,</span><br><span class="language-javascript">  <span class="hljs-attr">alias</span>: &#123;</span><br><span class="language-javascript">    <span class="hljs-string">&#x27;/.*/_sidebar.md&#x27;</span>: <span class="hljs-string">&#x27;/_sidebar.md&#x27;</span></span><br><span class="language-javascript">  &#125;,</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- Docsify v4 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//cdn.jsdelivr.net/npm/docsify@4&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- ä¾§è¾¹æ ç›®å½•æŠ˜å  --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/docsify-sidebar-collapse.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="å¯¼èˆªæ "><a href="#å¯¼èˆªæ " class="headerlink" title="å¯¼èˆªæ "></a>å¯¼èˆªæ </h4><p>æ·»åŠ å¯¼èˆªæ æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯ç›´æ¥åˆ° index.html ä¸­æ·»åŠ ï¼ŒäºŒæ˜¯å’Œä¾§è¾¹æ ç±»ä¼¼ï¼Œé€šè¿‡ md æ–‡ä»¶çš„å½¢å¼æ¥æ·»åŠ ã€‚</p><blockquote><p><strong>é€šè¿‡mdæ–‡ä»¶æ¥æ·»åŠ </strong></p></blockquote><p>é¦–å…ˆåœ¨ index.html ä¸­é…ç½®Â <code>loadNavbar</code>ï¼Œé»˜è®¤åŠ è½½çš„æ–‡ä»¶ä¸ºÂ <code>_navbar.md</code> </p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">// å¼€å¯å¯¼èˆªæ ,åŠ è½½_navbar.md </span><br>loadNavbar: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><blockquote><p>åµŒå¥—åˆ—è¡¨</p></blockquote><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs scss">&lt;!-- _navbar<span class="hljs-selector-class">.md</span> --&gt;<br><br>* å…¥é—¨<br>  * <span class="hljs-selector-attr">[å¿«é€Ÿå¼€å§‹]</span>(zh-cn/quickstart.md)<br>  * <span class="hljs-selector-attr">[å¤šé¡µæ–‡æ¡£]</span>(zh-cn/more-pages.md)<br>  * <span class="hljs-selector-attr">[å®šåˆ¶å¯¼èˆªæ ]</span>(zh-cn/custom-navbar.md)<br>  * <span class="hljs-selector-attr">[å°é¢]</span>(zh-cn/cover.md)<br><br><br>* é…ç½®<br>  * <span class="hljs-selector-attr">[é…ç½®é¡¹]</span>(zh-cn/configuration.md)<br>  * <span class="hljs-selector-attr">[ä¸»é¢˜]</span>(zh-cn/themes.md)<br>  * <span class="hljs-selector-attr">[ä½¿ç”¨æ’ä»¶]</span>(zh-cn/plugins.md)<br>  * <span class="hljs-selector-attr">[Markdown é…ç½®]</span>(zh-cn/markdown.md)<br>  * <span class="hljs-selector-attr">[ä»£ç é«˜äº®]</span>(zh-cn/language-highlight.md)<br></code></pre></td></tr></table></figure><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311202158957.png" alt="image.png"></p><h4 id="å°é¢"><a href="#å°é¢" class="headerlink" title="å°é¢"></a>å°é¢</h4><p>åœ¨ index.html ä¸­è®¾ç½®Â <code>coverpage</code>Â å‚æ•°å¼€å¯å°é¢åŠŸèƒ½</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">// å¼€å¯å°é¢,åŠ è½½_coverpage.md</span><br>coverpage: <span class="hljs-literal">true</span>,<br></code></pre></td></tr></table></figure><p>åœ¨æ–‡æ¡£æ ¹ç›®å½•åˆ›å»ºÂ <code>_coverpage.md</code>Â æ–‡ä»¶ï¼Œç”¨äºé…ç½®å°é¢å†…å®¹</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># docsify <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span></span>3.5<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span></span></span><br><br><span class="hljs-quote">&gt; ä¸€ä¸ªç¥å¥‡çš„æ–‡æ¡£ç½‘ç«™ç”Ÿæˆå™¨ã€‚</span><br><br><span class="hljs-bullet">-</span> ç®€å•ã€è½»ä¾¿ (å‹ç¼©å ~21kB)<br><span class="hljs-bullet">-</span> æ— éœ€ç”Ÿæˆ html æ–‡ä»¶<br><span class="hljs-bullet">-</span> ä¼—å¤šä¸»é¢˜<br><br>[<span class="hljs-string">GitHub</span>](<span class="hljs-link">https://github.com/docsifyjs/docsify/</span>)<br></code></pre></td></tr></table></figure><p>ç›®å‰çš„èƒŒæ™¯æ˜¯éšæœºç”Ÿæˆçš„æ¸å˜è‰²ï¼Œå¯ä»¥è‡ªå®šä¹‰èƒŒæ™¯è‰²æˆ–è€…èƒŒæ™¯å›¾ã€‚åœ¨æ–‡æ¡£æœ«å°¾ç”¨æ·»åŠ å›¾ç‰‡çš„ Markdown è¯­æ³•è®¾ç½®èƒŒæ™¯ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ç½‘ç«™å›¾æ ‡ --&gt;</span><br>![logo](_media/icon.jpg)<br><br># docsify <span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>3.5<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><br><br>&gt; ä¸€ä¸ªç¥å¥‡çš„æ–‡æ¡£ç½‘ç«™ç”Ÿæˆå™¨ã€‚<br><br>- ç®€å•ã€è½»ä¾¿ (å‹ç¼©å ~21kB)<br>- æ— éœ€ç”Ÿæˆ html æ–‡ä»¶<br>- ä¼—å¤šä¸»é¢˜<br><br>[GitHub](https://github.com/docsifyjs/docsify/)<br><br><span class="hljs-comment">&lt;!-- èƒŒæ™¯å›¾ç‰‡ --&gt;</span><br>![](_media/ç©å®¶.png)<br><br><span class="hljs-comment">&lt;!-- èƒŒæ™¯è‰² --&gt;</span><br>![color](#f0f0f0)<br></code></pre></td></tr></table></figure><p>é€šå¸¸å°é¢å’Œé¦–é¡µæ˜¯åŒæ—¶å‡ºç°çš„ï¼Œä½ å¯ä»¥å°†å°é¢ç‹¬ç«‹å‡ºæ¥</p><p>é…ç½®ï¼ˆåªåœ¨è®¿é—®ä¸»é¡µæ—¶åŠ è½½å°é¢ï¼‰ï¼š</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="hljs-keyword">window</span>.<span class="hljs-variable">$docsify</span> = &#123;<br>  onlyCover:<span class="hljs-built_in"> false</span>,<br>&#125;;<br></code></pre></td></tr></table></figure><h4 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h4><p>è§ï¼š <a href="https://docsify.js.org/#/zh-cn/themes">https://docsify.js.org/#/zh-cn/themes</a></p><h3 id="4ã€åŸºäºnginx-docsifyæ­å»º"><a href="#4ã€åŸºäºnginx-docsifyæ­å»º" class="headerlink" title="4ã€åŸºäºnginx + docsifyæ­å»º"></a>4ã€åŸºäºnginx + docsifyæ­å»º</h3><p>nginx é…ç½®æ–‡ä»¶ä¸­ï¼Œåœ¨Â <code>http</code>Â å—å†…æ·»åŠ ä¸€ä¸ªæ–°çš„Â <code>server</code>Â é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">location /docs &#123;<br><span class="hljs-built_in">alias</span> D:/shareDocs/docs; <span class="hljs-comment"># ä¿®æ”¹ä¸ºä½ çš„ Docsify é¡¹ç›®ç»å¯¹è·¯å¾„</span><br>index index.html;<br>try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒ</p><ul><li><a href="https://docsify.js.org/#/zh-cn/quickstart">https://docsify.js.org/#/zh-cn/quickstart</a></li><li><a href="https://www.cnblogs.com/Can-daydayup/p/15413267.html">https://www.cnblogs.com/Can-daydayup/p/15413267.html</a></li><li><a href="https://ysgstudyhards.github.io/Docsify-Guide/#/README">https://ysgstudyhards.github.io/Docsify-Guide/#/README</a></li><li><a href="https://blog.csdn.net/qq_45173404/article/details/122683872">https://blog.csdn.net/qq_45173404/article/details/122683872</a></li><li><a href="https://developer.aliyun.com/article/1266542">https://developer.aliyun.com/article/1266542</a></li><li><a href="https://clotliu.com/archives/docsify-advanced">https://clotliu.com/archives/docsify-advanced</a></li><li><a href="https://www.cnblogs.com/yangstar/articles/16690435.html">https://www.cnblogs.com/yangstar/articles/16690435.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>é™æ€é¡µ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NoSQL_åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2023/11/19/NoSQL_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2023/11/19/NoSQL_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€NoSQL-æ˜¯ä»€ä¹ˆ"><a href="#1ã€NoSQL-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€NoSQL æ˜¯ä»€ä¹ˆ"></a>1ã€NoSQL æ˜¯ä»€ä¹ˆ</h3><p>NoSQLï¼ˆNot Only SQL çš„ç¼©å†™ï¼‰æ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ï¼Œä¸»è¦é’ˆå¯¹çš„æ˜¯é”®å€¼ã€æ–‡æ¡£ä»¥åŠå›¾å½¢ç±»å‹æ•°æ®å­˜å‚¨ã€‚å¹¶ä¸”ï¼ŒNoSQL æ•°æ®åº“å¤©ç”Ÿæ”¯æŒåˆ†å¸ƒå¼ï¼Œæ•°æ®å†—ä½™å’Œæ•°æ®åˆ†ç‰‡ç­‰ç‰¹æ€§ï¼Œæ—¨åœ¨æä¾›å¯æ‰©å±•çš„é«˜å¯ç”¨é«˜æ€§èƒ½æ•°æ®å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚</p><p>NoSQL æ•°æ®åº“ä»£è¡¨ï¼šHBaseã€Cassandraã€MongoDBã€Redisã€‚</p><h4 id="SQL-å’Œ-NoSQL-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#SQL-å’Œ-NoSQL-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="SQL å’Œ NoSQL æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>SQL å’Œ NoSQL æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4><table><thead><tr><th></th><th>SQL æ•°æ®åº“</th><th>NoSQL æ•°æ®åº“</th></tr></thead><tbody><tr><td>æ•°æ®å­˜å‚¨æ¨¡å‹</td><td>ç»“æ„åŒ–å­˜å‚¨ï¼Œå…·æœ‰å›ºå®šè¡Œå’Œåˆ—çš„è¡¨æ ¼</td><td>éç»“æ„åŒ–å­˜å‚¨ã€‚æ–‡æ¡£ï¼šJSON æ–‡æ¡£ï¼Œé”®å€¼ï¼šé”®å€¼å¯¹ï¼Œå®½åˆ—ï¼šåŒ…å«è¡Œå’ŒåŠ¨æ€åˆ—çš„è¡¨ï¼Œå›¾ï¼šèŠ‚ç‚¹å’Œè¾¹</td></tr><tr><td>å‘å±•å†ç¨‹</td><td>å¼€å‘äº 1970 å¹´ä»£ï¼Œé‡ç‚¹æ˜¯å‡å°‘æ•°æ®é‡å¤</td><td>å¼€å‘äº 2000 å¹´ä»£åæœŸï¼Œé‡ç‚¹æ˜¯æå‡å¯æ‰©å±•æ€§ï¼Œå‡å°‘å¤§è§„æ¨¡æ•°æ®çš„å­˜å‚¨æˆæœ¬</td></tr><tr><td>ä¾‹å­</td><td>Oracleã€MySQLã€Microsoft SQL Serverã€PostgreSQL</td><td>æ–‡æ¡£ï¼šMongoDBã€CouchDBï¼Œé”®å€¼ï¼šRedisã€DynamoDBï¼Œå®½åˆ—ï¼šCassandraã€ HBaseï¼Œå›¾è¡¨ï¼šNeo4jã€ Amazon Neptuneã€Giraph</td></tr><tr><td>ACID å±æ€§</td><td>æä¾›åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§ (ACID) å±æ€§</td><td>é€šå¸¸ä¸æ”¯æŒ ACID äº‹åŠ¡ï¼Œä¸ºäº†å¯æ‰©å±•ã€é«˜æ€§èƒ½è¿›è¡Œäº†æƒè¡¡ï¼Œå°‘éƒ¨åˆ†æ”¯æŒæ¯”å¦‚ MongoDB ã€‚ä¸è¿‡ï¼ŒMongoDB å¯¹ ACID äº‹åŠ¡ çš„æ”¯æŒå’Œ MySQL è¿˜æ˜¯æœ‰æ‰€åŒºåˆ«çš„ã€‚</td></tr><tr><td>æ€§èƒ½</td><td>æ€§èƒ½é€šå¸¸å–å†³äºç£ç›˜å­ç³»ç»Ÿã€‚è¦è·å¾—æœ€ä½³æ€§èƒ½ï¼Œé€šå¸¸éœ€è¦ä¼˜åŒ–æŸ¥è¯¢ã€ç´¢å¼•å’Œè¡¨ç»“æ„ã€‚</td><td>æ€§èƒ½é€šå¸¸ç”±åº•å±‚ç¡¬ä»¶é›†ç¾¤å¤§å°ã€ç½‘ç»œå»¶è¿Ÿä»¥åŠè°ƒç”¨åº”ç”¨ç¨‹åºæ¥å†³å®šã€‚</td></tr><tr><td>æ‰©å±•</td><td>å‚ç›´ï¼ˆä½¿ç”¨æ€§èƒ½æ›´å¼ºå¤§çš„æœåŠ¡å™¨è¿›è¡Œæ‰©å±•ï¼‰ã€è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨</td><td>æ¨ªå‘ï¼ˆå¢åŠ æœåŠ¡å™¨çš„æ–¹å¼æ¨ªå‘æ‰©å±•ï¼Œé€šå¸¸æ˜¯åŸºäºåˆ†ç‰‡æœºåˆ¶ï¼‰</td></tr><tr><td>ç”¨é€”</td><td>æ™®é€šä¼ä¸šçº§çš„é¡¹ç›®çš„æ•°æ®å­˜å‚¨</td><td>ç”¨é€”å¹¿æ³›æ¯”å¦‚å›¾æ•°æ®åº“æ”¯æŒåˆ†æå’Œéå†è¿æ¥æ•°æ®ä¹‹é—´çš„å…³ç³»ã€é”®å€¼æ•°æ®åº“å¯ä»¥å¤„ç†å¤§é‡æ•°æ®æ‰©å±•å’Œæé«˜çš„çŠ¶æ€å˜åŒ–</td></tr><tr><td>æŸ¥è¯¢è¯­æ³•</td><td>ç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ (SQL)</td><td>æ•°æ®è®¿é—®è¯­æ³•å¯èƒ½å› æ•°æ®åº“è€Œå¼‚</td></tr></tbody></table><h4 id="NoSQL-æ•°æ®åº“æœ‰å“ªäº›ç±»å‹ï¼Ÿ"><a href="#NoSQL-æ•°æ®åº“æœ‰å“ªäº›ç±»å‹ï¼Ÿ" class="headerlink" title="NoSQL æ•°æ®åº“æœ‰å“ªäº›ç±»å‹ï¼Ÿ"></a>NoSQL æ•°æ®åº“æœ‰å“ªäº›ç±»å‹ï¼Ÿ</h4><p>NoSQL æ•°æ®åº“ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸‹é¢å››ç§ç±»å‹ï¼š</p><ul><li><strong>é”®å€¼</strong>ï¼šé”®å€¼æ•°æ®åº“æ˜¯ä¸€ç§è¾ƒç®€å•çš„æ•°æ®åº“ï¼Œå…¶ä¸­æ¯ä¸ªé¡¹ç›®éƒ½åŒ…å«é”®å’Œå€¼ã€‚è¿™æ˜¯æä¸ºçµæ´»çš„ NoSQL æ•°æ®åº“ç±»å‹ï¼Œå› ä¸ºåº”ç”¨å¯ä»¥å®Œå…¨æ§åˆ¶ value å­—æ®µä¸­å­˜å‚¨çš„å†…å®¹ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚Redis å’Œ DynanoDB æ˜¯ä¸¤æ¬¾éå¸¸æµè¡Œçš„é”®å€¼æ•°æ®åº“ã€‚</li><li><strong>æ–‡æ¡£</strong>ï¼šæ–‡æ¡£æ•°æ®åº“ä¸­çš„æ•°æ®è¢«å­˜å‚¨åœ¨ç±»ä¼¼äº JSONï¼ˆJavaScript å¯¹è±¡è¡¨ç¤ºæ³•ï¼‰å¯¹è±¡çš„æ–‡æ¡£ä¸­ï¼Œéå¸¸æ¸…æ™°ç›´è§‚ã€‚æ¯ä¸ªæ–‡æ¡£åŒ…å«æˆå¯¹çš„å­—æ®µå’Œå€¼ã€‚è¿™äº›å€¼é€šå¸¸å¯ä»¥æ˜¯å„ç§ç±»å‹ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ã€æ•°ç»„æˆ–å¯¹è±¡ç­‰ï¼Œå¹¶ä¸”å®ƒä»¬çš„ç»“æ„é€šå¸¸ä¸å¼€å‘è€…åœ¨ä»£ç ä¸­ä½¿ç”¨çš„å¯¹è±¡ä¿æŒä¸€è‡´ã€‚MongoDB å°±æ˜¯ä¸€æ¬¾éå¸¸æµè¡Œçš„æ–‡æ¡£æ•°æ®åº“ã€‚</li><li><strong>å›¾å½¢</strong>ï¼šå›¾å½¢æ•°æ®åº“æ—¨åœ¨è½»æ¾æ„å»ºå’Œè¿è¡Œä¸é«˜åº¦è¿æ¥çš„æ•°æ®é›†ä¸€èµ·ä½¿ç”¨çš„åº”ç”¨ç¨‹åºã€‚å›¾å½¢æ•°æ®åº“çš„å…¸å‹ä½¿ç”¨æ¡ˆä¾‹åŒ…æ‹¬ç¤¾äº¤ç½‘ç»œã€æ¨èå¼•æ“ã€æ¬ºè¯ˆæ£€æµ‹å’ŒçŸ¥è¯†å›¾å½¢ã€‚Neo4j å’Œ Giraph æ˜¯ä¸¤æ¬¾éå¸¸æµè¡Œçš„å›¾å½¢æ•°æ®åº“ã€‚</li><li><strong>å®½åˆ—</strong>ï¼šå®½åˆ—å­˜å‚¨æ•°æ®åº“éå¸¸é€‚åˆéœ€è¦å­˜å‚¨å¤§é‡çš„æ•°æ®ã€‚Cassandra å’Œ HBase æ˜¯ä¸¤æ¬¾éå¸¸æµè¡Œçš„å®½åˆ—å­˜å‚¨æ•°æ®åº“ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231119123254.png" alt="image.png"></p><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/database/nosql.html">https://javaguide.cn/database/nosql.html</a></li><li><a href="https://www.ibm.com/cn-zh/topics/nosql-databases">https://www.ibm.com/cn-zh/topics/nosql-databases</a></li><li><a href="https://zhuanlan.zhihu.com/p/345342966">https://zhuanlan.zhihu.com/p/345342966</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>NoSQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NoSQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ’ä»¶å®ç°Obsidianå®æ—¶åŒæ­¥</title>
    <link href="/2023/11/17/%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0Obsidian%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/"/>
    <url>/2023/11/17/%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0Obsidian%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€æ’ä»¶ä¸‹è½½å’ŒæœåŠ¡å®‰è£…"><a href="#1ã€æ’ä»¶ä¸‹è½½å’ŒæœåŠ¡å®‰è£…" class="headerlink" title="1ã€æ’ä»¶ä¸‹è½½å’ŒæœåŠ¡å®‰è£…"></a>1ã€æ’ä»¶ä¸‹è½½å’ŒæœåŠ¡å®‰è£…</h3><p>ä½¿ç”¨æ’ä»¶ï¼š Self-hosted LiveSync</p><p>åœ¨æœåŠ¡å™¨ä¸Šé¢å®‰è£… docker åï¼Œ</p><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ <code>local.ini</code></p><p>å¤åˆ¶ä»¥ä¸‹å†…å®¹</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[couchdb]</span><br><span class="hljs-attr">single_node</span>=<span class="hljs-literal">true</span><br><br><span class="hljs-section">[chttpd]</span><br><span class="hljs-attr">require_valid_user</span> = <span class="hljs-literal">true</span><br><br><span class="hljs-section">[chttpd_auth]</span><br><span class="hljs-attr">require_valid_user</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">authentication_redirect</span> = /_utils/session.html<br><br><span class="hljs-section">[httpd]</span><br><span class="hljs-attr">WWW-Authenticate</span> = Basic realm=<span class="hljs-string">&quot;couchdb&quot;</span><br><span class="hljs-attr">enable_cors</span> = <span class="hljs-literal">true</span><br><br><span class="hljs-section">[cors]</span><br><span class="hljs-attr">origins</span> = app://obsidian.md,capacitor://localhost,http://localhost<br><span class="hljs-attr">credentials</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">headers</span> = accept, authorization, content-type, origin, referer<br><span class="hljs-attr">methods</span> = GET, PUT, POST, HEAD, DELETE<br><span class="hljs-attr">max_age</span> = <span class="hljs-number">3600</span><br></code></pre></td></tr></table></figure><p>å°†è¯¥æ–‡ä»¶ç§»åŠ¨åˆ° <code>/opt/couchdb</code>ç›®å½•ä¸‹</p><p>è¿è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-built_in">run</span> -d --restart always -e <span class="hljs-attribute">COUCHDB_USER</span>=luo -e <span class="hljs-attribute">COUCHDB_PASSWORD</span>=luo123 -v /opt/couchdb/local.ini:/opt/couchdb/etc/local.ini -p 6900:5984 couchdb<br></code></pre></td></tr></table></figure><p>å…¶ä¸­:</p><ul><li><code>COUCHDB_USER</code>Â åé¢çš„æ˜¯ä½ çš„ç”¨æˆ·å</li><li><code>COUCHDB_PASSWORD</code>Â åé¢çš„æ˜¯ä½ çš„å¯†ç </li><li><code>/opt/couchdb/local.ini</code>Â æ˜¯é…ç½®æ–‡ä»¶çš„è·¯å¾„</li><li><code>/opt/couchdb/db</code>Â æ˜¯æ•°æ®åº“çš„è·¯å¾„</li><li><code>-p 6900:5984</code>Â å‰é¢çš„ 6900 æ˜¯æš´éœ²åœ¨å¤–çš„ç«¯å£ã€‚</li></ul><p>æ£€æŸ¥æ˜¯å¦è¿è¡ŒæˆåŠŸ</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">sudo docker <span class="hljs-keyword">ps</span> |<span class="hljs-keyword">grep</span> couchdb<br></code></pre></td></tr></table></figure><h3 id="2ã€æ’ä»¶é…ç½®"><a href="#2ã€æ’ä»¶é…ç½®" class="headerlink" title="2ã€æ’ä»¶é…ç½®"></a>2ã€æ’ä»¶é…ç½®</h3><p>æ‰“å¼€Obsidiançš„è®¾ç½®-ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œåœ¨æ’ä»¶å¸‚åœºå®‰è£…<code>Self-hosted LiveSync</code></p><blockquote><p>å®¢æˆ·ç«¯é…ç½®</p></blockquote><p>å®‰è£…å¹¶å¯ç”¨åæ‰“å¼€æ’ä»¶çš„è®¾ç½®ç•Œé¢ï¼Œå¡«å†™ç®­å¤´å†…å®¹ï¼ŒURI ä¸ºåˆšåˆšçš„<code>http://IP+ç«¯å£ï¼ˆ6900ï¼‰</code>ï¼Œä¾‹å¦‚ï¼š<code>http://127.0.0.1:6900</code>ï¼Œ</p><p>Username å’Œ Password ä¸ºå‰é¢çš„å‚æ•°è®¾ç½®çš„å†…å®¹ï¼Œ</p><p>Database name å¯ä»¥è‡ªå·±å–ï¼Œæ³¨æ„ä¸è¦å¡«å¤§å†™å­—æ¯ï¼Œå®Œæˆåç‚¹å‡»test æŒ‰é’®</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231118230051.png" alt="image.png"></p><p>å³ä¸Šè§’å‡ºç°Â <code>Connect to æ•°æ®åº“å</code>ï¼Œåˆ™ä¸ºè¿æ¥æˆåŠŸ</p><p>å¦‚æœä½ ä¹‹å‰é…ç½®è¿æ¥è¿‡ï¼Œå¹¶å­˜æ”¾è¿‡æ•°æ®ï¼Œä½ è¿æ¥åä¼šå°†å¯¹åº”çš„æ•°æ®åº“ä¸­çš„æ–‡ä»¶åŒæ­¥åˆ°ä½ ç›®å‰çš„å·¥ä½œç©ºé—´ä¸­ï¼›ä¹Ÿå¯ä»¥ç†è§£ä»–çš„æ•°æ®æ˜¯å­˜æ”¾åœ¨äº†æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“ï¼Œè®¾å¤‡è¿æ¥è¯¥æœåŠ¡åçš„åŒæ­¥æ“ä½œï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨æ“ä½œæ›´æ–°æœåŠ¡å™¨ä¸Šé¢çš„æ•°æ®åº“æ–‡ä»¶å†…å®¹ï¼Œç„¶åæ›´æ–°å¯¹åº”æ˜ å°„å†…å®¹åˆ°è®¾å¤‡çš„Obsidianæ–‡ä»¶ä¸­ã€‚</p><p>å®Œæˆåç‚¹å‡»ä¸‹é¢çš„check ï¼Œå°†æ‰€æœ‰æç¤ºé”™è¯¯çš„é€‰æ‹©fixï¼Œç„¶åå†æ¬¡ç‚¹å‡»check ï¼Œç›´åˆ°æ²¡æœ‰é”™è¯¯</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231118230528.png" alt="image.png"></p><p>åˆ’åˆ°æœ€ä¸‹æ–¹ï¼Œé€‰æ‹©ç«¯å¯¹ç«¯åŠ å¯†ï¼ˆEnd to End Encryptionï¼‰ï¼Œåœ¨è¾“å…¥æ¡†ä¸­è®¾ç½®å¯†ç ï¼Œç‚¹å‡»å¯ç”¨</p><p><strong>å¦‚æœä»…æƒ³è¦åŒæ­¥æ–‡ç« æ— éœ€å¼€å¯ç«¯å¯¹ç«¯åŠ å¯†</strong></p><p>åœ¨Sync Setting é€‰é¡¹å¡ä¸­ï¼Œé€‰æ‹©LiveSyncï¼ˆå®æ—¶åŒæ­¥ï¼‰ï¼Œç‚¹å‡»Applyå¯ç”¨</p><p>å»ºè®®å¯ç”¨Â <code>Use Trash for deleted files</code>ï¼ˆåˆ é™¤æ–‡ä»¶åˆ°å›æ”¶ç«™ï¼‰</p><p>å»ºè®®å¯ç”¨Â <code>Miscellaneous</code>Â é€‰é¡¹å¡ä¸­çš„Â <code>Show staus inside editor</code>Â ï¼ˆä¼šåœ¨ç¼–è¾‘å™¨å³ä¸Šè§’æ˜¾ç¤ºçŠ¶æ€ï¼‰</p><blockquote><p>å¤åˆ¶é…ç½®åˆ°å…¶ä»–è®¾å¤‡</p></blockquote><p>åœ¨æ’ä»¶Setup wizard é€‰é¡¹å¡ä¸­ï¼Œç‚¹å‡»Â <code>Copy Setup URI</code>ï¼Œå¼¹å‡ºçš„å¯¹è¯æ¡†è®¾ç½®å¯†ç ï¼Œå³å¯å¤åˆ¶å½“å‰çš„é…ç½®ä¿¡æ¯</p><p>å¤åˆ¶åæ‰“å¼€è‡ªå·±éœ€è¦åŒæ­¥çš„è®¾å¤‡ç‚¹å‡»Open setup URI ç²˜è´´å¤åˆ¶çš„å†…å®¹ï¼Œè¾“å…¥è®¾ç½®çš„å¯†ç ï¼Œç‚¹å‡»ç¬¬ä¸€ä¸ª</p><hr><p>å‚è€ƒ</p><ul><li><a href="https://sspai.com/post/82161#">https://sspai.com/post/82161#</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>obsidian</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dokcerå…¥é—¨_åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2023/11/17/Docker%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2023/11/17/Docker%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<h3 id="1ã€ä»€ä¹ˆæ˜¯-Docker"><a href="#1ã€ä»€ä¹ˆæ˜¯-Docker" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯ Docker"></a>1ã€ä»€ä¹ˆæ˜¯ Docker</h3><blockquote><p>ç†è§£è™šæ‹ŸåŒ–æŠ€æœ¯</p></blockquote><p>äººä»¬ä¸ºäº†æé«˜ç³»ç»ŸåŠç¡¬ä»¶èµ„æºçš„åˆ©ç”¨ç‡è€Œå¼•å…¥äº†<strong>è™šæ‹ŸåŒ–æŠ€æœ¯</strong>ã€‚è™šæ‹ŸåŒ–æ˜¯ä¸€ç§<strong>èµ„æºç®¡ç†æŠ€æœ¯</strong>ï¼Œå®ƒå¯ä»¥å„ç§å®ä½“èµ„æºæŠ½åƒåå†åˆ†éš”ï¼Œä»è€Œæ‰“ç ´å®ä½“ç»“æ„çš„é™åˆ¶ï¼Œæœ€å¤§ç¨‹åº¦çš„æé«˜èµ„æºçš„åˆ©ç”¨ç‡ã€‚</p><p>è™šæ‹ŸåŒ–çš„ç›®çš„æ˜¯ä¸ºäº†åœ¨åŒä¸€ä¸ªä¸»æœºä¸Šè¿è¡Œå¤šä¸ªç³»ç»Ÿæˆ–åº”ç”¨ï¼Œä»è€Œæé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ï¼Œå¹¶å¸¦æ¥é™ä½æˆæœ¬ã€æ–¹ä¾¿ç®¡ç†å’Œå®¹é”™å®¹ç¾ç­‰å¥½å¤„ã€‚</p><p>ä»å®ç°å½¢å¼æ¥åˆ†ï¼Œè™šæ‹ŸåŒ–æŠ€æœ¯å¯åˆ†ä¸ºåŸºäºç¡¬ä»¶çš„è™šæ‹ŸåŒ–å’ŒåŸºäºè½¯ä»¶çš„è™šæ‹ŸåŒ–ã€‚</p><blockquote><p>åŸºäºè½¯ä»¶çš„è™šæ‹ŸåŒ–</p></blockquote><p>è½¯ä»¶è™šæ‹ŸåŒ–æ˜¯åˆ©ç”¨è½¯ä»¶æŠ€æœ¯ï¼Œåœ¨ç°æœ‰çš„ç‰©ç†å¹³å°ä¸Šå®ç°å¯¹ç‰©ç†å¹³å°è®¿é—®çš„æˆªè·å’Œæ¨¡æ‹Ÿã€‚</p><p>å¯¹è½¯ä»¶è™šæ‹ŸåŒ–è¿›è¡Œç»†åˆ†ï¼Œåˆå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li>å®Œå…¨è™šæ‹ŸåŒ–</li><li>ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–</li><li>éƒ¨åˆ†è™šæ‹ŸåŒ–</li><li>å¹³è¡Œè™šæ‹ŸåŒ–</li><li>æ“ä½œç³»ç»Ÿå±‚è™šæ‹ŸåŒ–</li></ul><p>Dockerå®¹å™¨æŠ€æœ¯å°±æ˜¯å±äºæ“ä½œç³»ç»Ÿå±‚è™šæ‹ŸåŒ–çš„èŒƒç•´ã€‚</p><p>è™šæ‹ŸåŒ–æ˜¯é€šè¿‡è½¯ä»¶çš„æ–¹å¼æ¨¡æ‹Ÿå®ä½“æœåŠ¡å™¨ï¼Œå…¶åˆè¡·æ˜¯ä¸ºäº†è§£å†³â€œä¸€ç§åº”ç”¨å ç”¨ä¸€å°æœåŠ¡å™¨â€æ¨¡å¼æ‰€å¸¦æ¥çš„æœåŠ¡å™¨æ•°é‡å‰§å¢çš„é—®é¢˜ï¼Œä»è€Œé™ä½æ•°æ®ä¸­å¿ƒå¤æ‚åº¦ï¼Œç®€åŒ–ç®¡ç†éš¾åº¦ã€‚</p><blockquote><p>è™šæ‹Ÿæœºå’ŒDocker</p></blockquote><p>å®¹å™¨è™šæ‹ŸåŒ–çš„æ˜¯æ“ä½œç³»ç»Ÿè€Œä¸æ˜¯ç¡¬ä»¶ï¼Œå®¹å™¨ä¹‹é—´æ˜¯å…±äº«åŒä¸€å¥—æ“ä½œç³»ç»Ÿèµ„æºã€‚</p><p>è™šæ‹ŸæœºæŠ€æœ¯æ˜¯è™šæ‹Ÿå‡ºä¸€å¥—ç¡¬ä»¶åï¼Œåœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿã€‚å› æ­¤å®¹å™¨çš„éš”ç¦»çº§åˆ«ä¼šç¨ä½ä¸€äº›ã€‚</p><blockquote><p>è™šæ‹Ÿæœºå’Œ Docker çš„å¯¹æ¯”<br><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311171252304.png" alt="image.png"></p></blockquote><blockquote><p>å›¾è§£ç‰©ç†æœº,è™šæ‹Ÿæœºä¸å®¹å™¨</p></blockquote><p>ç‰©ç†æœº</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311171456074.png" alt="image.png"></p><p>è™šæ‹Ÿæœº</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311171456887.png" alt="image.png"><br>å®¹å™¨</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311171457700.png" alt="image.png"></p><p>è™šæ‹Ÿæœºå’ŒDockerå®¹å™¨å„è‡ªæœ‰è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œ<strong>è™šæ‹Ÿæœºæ›´æ“…é•¿äºå½»åº•éš”ç¦»æ•´ä¸ªè¿è¡Œç¯å¢ƒ</strong>ã€‚ä¾‹å¦‚ï¼Œäº‘æœåŠ¡æä¾›å•†é€šå¸¸é‡‡ç”¨è™šæ‹ŸæœºæŠ€æœ¯éš”ç¦»ä¸åŒçš„ç”¨æˆ·ã€‚</p><p>è€ŒÂ <strong>Docker é€šå¸¸ç”¨äºéš”ç¦»ä¸åŒçš„åº”ç”¨</strong>Â ï¼Œä¾‹å¦‚å‰ç«¯ï¼Œåç«¯ä»¥åŠæ•°æ®åº“ã€‚</p><h3 id="2ã€Docker-åŸºæœ¬æ¦‚å¿µ"><a href="#2ã€Docker-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="2ã€Docker åŸºæœ¬æ¦‚å¿µ"></a>2ã€Docker åŸºæœ¬æ¦‚å¿µ</h3><p>Docker åŒ…æ‹¬ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µ:</p><ul><li><strong>é•œåƒï¼ˆImageï¼‰</strong>ï¼šDocker é•œåƒï¼ˆImageï¼‰ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ª root æ–‡ä»¶ç³»ç»Ÿã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ ubuntu:16.04 å°±åŒ…å«äº†å®Œæ•´çš„ä¸€å¥— Ubuntu16.04 æœ€å°ç³»ç»Ÿçš„ root æ–‡ä»¶ç³»ç»Ÿã€‚</li><li><strong>å®¹å™¨ï¼ˆContainerï¼‰</strong>ï¼šé•œåƒï¼ˆImageï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ç±»å’Œå®ä¾‹ä¸€æ ·ï¼Œ<strong>é•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“</strong>ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚</li><li><strong>ä»“åº“ï¼ˆRepositoryï¼‰</strong>ï¼šä»“åº“å¯çœ‹æˆä¸€ä¸ªä»£ç æ§åˆ¶ä¸­å¿ƒï¼Œç”¨æ¥ä¿å­˜é•œåƒã€‚</li></ul><blockquote><p><strong>Docker Registry å…¬å¼€æœåŠ¡å’Œç§æœ‰ Docker Registry</strong></p></blockquote><p><strong>Docker Registry å…¬å¼€æœåŠ¡</strong> æ˜¯å¼€æ”¾ç»™ç”¨æˆ·ä½¿ç”¨ã€å…è®¸ç”¨æˆ·ç®¡ç†é•œåƒçš„ Registry æœåŠ¡ã€‚ä¸€èˆ¬è¿™ç±»å…¬å¼€æœåŠ¡å…è®¸ç”¨æˆ·å…è´¹ä¸Šä¼ ã€ä¸‹è½½å…¬å¼€çš„é•œåƒï¼Œå¹¶å¯èƒ½æä¾›æ”¶è´¹æœåŠ¡ä¾›ç”¨æˆ·ç®¡ç†ç§æœ‰é•œåƒã€‚</p><p>æœ€å¸¸ä½¿ç”¨çš„ Registry å…¬å¼€æœåŠ¡æ˜¯å®˜æ–¹çš„ <strong>Docker Hub</strong> ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤çš„ Registryï¼Œå¹¶æ‹¥æœ‰å¤§é‡çš„é«˜è´¨é‡çš„å®˜æ–¹é•œåƒï¼Œç½‘å€ä¸ºï¼š<a href="https://hub.docker.com/" title="https://hub.docker.com/">https://hub.docker.com/open in new window</a> ã€‚å®˜æ–¹æ˜¯è¿™æ ·ä»‹ç» Docker Hub çš„ï¼š</p><blockquote><p>Docker Hub æ˜¯ Docker å®˜æ–¹æä¾›çš„ä¸€é¡¹æœåŠ¡ï¼Œç”¨äºä¸æ‚¨çš„å›¢é˜ŸæŸ¥æ‰¾å’Œå…±äº«å®¹å™¨é•œåƒã€‚</p></blockquote><p>æ¯”å¦‚æˆ‘ä»¬æƒ³è¦æœç´¢è‡ªå·±æƒ³è¦çš„é•œåƒï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311171534204.png" alt="image.png"></p><p>åœ¨ Docker Hub çš„æœç´¢ç»“æœä¸­ï¼Œæœ‰å‡ é¡¹å…³é”®çš„ä¿¡æ¯æœ‰åŠ©äºæˆ‘ä»¬é€‰æ‹©åˆé€‚çš„é•œåƒï¼š</p><ul><li><strong>OFFICIAL Image</strong>ï¼šä»£è¡¨é•œåƒä¸º Docker å®˜æ–¹æä¾›å’Œç»´æŠ¤ï¼Œç›¸å¯¹æ¥è¯´ç¨³å®šæ€§å’Œå®‰å…¨æ€§è¾ƒé«˜ã€‚</li><li><strong>Stars</strong>ï¼šå’Œç‚¹èµå·®ä¸å¤šçš„æ„æ€ï¼Œç±»ä¼¼ GitHub çš„ Starã€‚</li><li><strong>Downloads</strong>ï¼šä»£è¡¨é•œåƒè¢«æ‹‰å–çš„æ¬¡æ•°ï¼ŒåŸºæœ¬ä¸Šèƒ½å¤Ÿè¡¨ç¤ºé•œåƒè¢«ä½¿ç”¨çš„é¢‘åº¦ã€‚</li></ul><p>é™¤äº†ç›´æ¥é€šè¿‡ Docker Hub ç½‘ç«™æœç´¢é•œåƒè¿™ç§æ–¹å¼å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ <code>docker search</code> è¿™ä¸ªå‘½ä»¤æœç´¢ Docker Hub ä¸­çš„é•œåƒï¼Œæœç´¢çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">âœ  ~ docker <span class="hljs-keyword">search</span> mysql<br><span class="hljs-type">NAME</span>                              DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED<br>mysql                             MySQL <span class="hljs-keyword">is</span> a widely used, <span class="hljs-keyword">open</span>-source relationâ€¦   <span class="hljs-number">8763</span>                [OK]<br>mariadb                           MariaDB <span class="hljs-keyword">is</span> a community-developed fork <span class="hljs-keyword">of</span> MySâ€¦   <span class="hljs-number">3073</span>                [OK]<br>mysql/mysql-<span class="hljs-keyword">server</span>                Optimized MySQL <span class="hljs-keyword">Server</span> Docker images. <span class="hljs-keyword">Create</span>â€¦   <span class="hljs-number">650</span>                                     [OK]<br></code></pre></td></tr></table></figure><p>åœ¨å›½å†…è®¿é—®<strong>Docker Hub</strong> å¯èƒ½ä¼šæ¯”è¾ƒæ…¢å›½å†…ä¹Ÿæœ‰ä¸€äº›äº‘æœåŠ¡å•†æä¾›ç±»ä¼¼äº Docker Hub çš„å…¬å¼€æœåŠ¡ã€‚æ¯”å¦‚ <a href="https://www.aliyun.com/product/containerservice?utm_content=se_1292836" title="é˜¿é‡Œäº‘é•œåƒåº“">é˜¿é‡Œäº‘é•œåƒåº“</a>ã€‚</p><p>é™¤äº†ä½¿ç”¨å…¬å¼€æœåŠ¡å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥åœ¨ <strong>æœ¬åœ°æ­å»ºç§æœ‰ Docker Registry</strong> ã€‚</p><p>Docker å®˜æ–¹æä¾›äº† Docker Registry é•œåƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åšä¸ºç§æœ‰ Registry æœåŠ¡ã€‚å¼€æºçš„ Docker Registry é•œåƒåªæä¾›äº† Docker Registry API çš„æœåŠ¡ç«¯å®ç°ï¼Œè¶³ä»¥æ”¯æŒ docker å‘½ä»¤ï¼Œä¸å½±å“ä½¿ç”¨ã€‚ä½†ä¸åŒ…å«å›¾å½¢ç•Œé¢ï¼Œä»¥åŠé•œåƒç»´æŠ¤ã€ç”¨æˆ·ç®¡ç†ã€è®¿é—®æ§åˆ¶ç­‰é«˜çº§åŠŸèƒ½ã€‚</p><h3 id="3ã€åŸºæœ¬å‘½ä»¤"><a href="#3ã€åŸºæœ¬å‘½ä»¤" class="headerlink" title="3ã€åŸºæœ¬å‘½ä»¤"></a>3ã€åŸºæœ¬å‘½ä»¤</h3><h4 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">docker <span class="hljs-keyword">version</span> <span class="hljs-comment"># æŸ¥çœ‹dockerç‰ˆæœ¬</span><br>docker images <span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å·²ä¸‹è½½é•œåƒï¼Œç­‰ä»·äºï¼šdocker image ls å‘½ä»¤</span><br>docker container <span class="hljs-keyword">ls</span> <span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</span><br>docker ps <span class="hljs-comment">#æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br>docker image prune <span class="hljs-comment"># æ¸…ç†ä¸´æ—¶çš„ã€æ²¡æœ‰è¢«ä½¿ç”¨çš„é•œåƒæ–‡ä»¶ã€‚-a, --all: åˆ é™¤æ‰€æœ‰æ²¡æœ‰ç”¨çš„é•œåƒï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸´æ—¶æ–‡ä»¶ï¼›</span><br></code></pre></td></tr></table></figure><h4 id="æ‹‰å–é•œåƒ"><a href="#æ‹‰å–é•œåƒ" class="headerlink" title="æ‹‰å–é•œåƒ"></a>æ‹‰å–é•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker search mysql <span class="hljs-comment"># æŸ¥çœ‹mysqlç›¸å…³é•œåƒ</span><br>docker pull mysql:5.7 <span class="hljs-comment"># æ‹‰å–mysqlé•œåƒ</span><br>docker image <span class="hljs-built_in">ls</span> <span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å·²ä¸‹è½½é•œåƒ</span><br></code></pre></td></tr></table></figure><h4 id="åˆ é™¤é•œåƒ"><a href="#åˆ é™¤é•œåƒ" class="headerlink" title="åˆ é™¤é•œåƒ"></a>åˆ é™¤é•œåƒ</h4><p>æ¯”å¦‚æˆ‘ä»¬è¦åˆ é™¤æˆ‘ä»¬ä¸‹è½½çš„ mysql é•œåƒã€‚</p><p>é€šè¿‡ <code>docker rmi [image]</code> ï¼ˆç­‰ä»·äº<code>docker image rm [image]</code>ï¼‰åˆ é™¤é•œåƒä¹‹å‰é¦–å…ˆè¦ç¡®ä¿è¿™ä¸ªé•œåƒæ²¡æœ‰è¢«å®¹å™¨å¼•ç”¨ï¼ˆå¯ä»¥é€šè¿‡æ ‡ç­¾åç§°æˆ–è€…é•œåƒ ID åˆ é™¤ï¼‰ã€‚</p><p>é€šè¿‡æˆ‘ä»¬å‰é¢è®²çš„<code>docker ps</code>å‘½ä»¤å³å¯æŸ¥çœ‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">âœ  ~ docker ps<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES<br>c4cd691d9f80        mysql:5.7           <span class="hljs-string">&quot;docker-entrypoint.sâ€¦&quot;</span>   7 weeks ago         Up 12 days          0.0.0.0:3306-&gt;3306/tcp, 33060/tcp   mysql<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° mysql æ­£åœ¨è¢« id ä¸º c4cd691d9f80 çš„å®¹å™¨å¼•ç”¨ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆé€šè¿‡ <code>docker stop c4cd691d9f80</code> æˆ–è€… <code>docker stop mysql</code>æš‚åœè¿™ä¸ªå®¹å™¨ã€‚</p><p>ç„¶åæŸ¥çœ‹ mysql é•œåƒçš„ id</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">âœ  ~ docker images<br>REPOSITORY              <span class="hljs-keyword">TAG</span>                 <span class="hljs-title">IMAGE</span> ID            CREATED             SIZE<br>mysql                   <span class="hljs-number">5.7</span>                 f6509bac4980        <span class="hljs-number">3</span> months ago        <span class="hljs-number">373M</span>B<br></code></pre></td></tr></table></figure><p>é€šè¿‡ IMAGE ID æˆ–è€… REPOSITORY åå­—å³å¯åˆ é™¤</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">docker</span> rmi f6509bac4980 <span class="hljs-comment">#  æˆ–è€… docker rmi mysql</span><br></code></pre></td></tr></table></figure><h3 id="4ã€Build-Ship-and-Run"><a href="#4ã€Build-Ship-and-Run" class="headerlink" title="4ã€Build Ship and Run"></a>4ã€Build Ship and Run</h3><p>æœç´¢ Docker å®˜ç½‘ï¼Œä¼šå‘ç°å¦‚ä¸‹çš„å­—æ ·ï¼š<strong>â€œDocker - Build, Ship, and Run Any App, Anywhereâ€</strong>ã€‚</p><ul><li><strong>Buildï¼ˆæ„å»ºé•œåƒï¼‰</strong>ï¼šé•œåƒå°±åƒæ˜¯é›†è£…ç®±åŒ…æ‹¬æ–‡ä»¶ä»¥åŠè¿è¡Œç¯å¢ƒç­‰ç­‰èµ„æºã€‚</li><li><strong>Shipï¼ˆè¿è¾“é•œåƒï¼‰</strong>ï¼šä¸»æœºå’Œä»“åº“é—´è¿è¾“ï¼Œè¿™é‡Œçš„ä»“åº“å°±åƒæ˜¯è¶…çº§ç å¤´ä¸€æ ·ã€‚</li><li><strong>Run ï¼ˆè¿è¡Œé•œåƒï¼‰</strong>ï¼šè¿è¡Œçš„é•œåƒå°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®¹å™¨å°±æ˜¯è¿è¡Œç¨‹åºçš„åœ°æ–¹ã€‚</li></ul><p>Docker è¿è¡Œè¿‡ç¨‹æ˜¯ä¼šå»ä»“åº“æŠŠé•œåƒæ‹‰åˆ°æœ¬åœ°ï¼Œç„¶åç”¨ä¸€æ¡å‘½ä»¤æŠŠé•œåƒè¿è¡Œèµ·æ¥å˜æˆå®¹å™¨ã€‚</p><p>Docker ä¹Ÿè¢«ç§°ä¸ºç å¤´å·¥äººæˆ–ç å¤´è£…å¸å·¥ï¼Œè¿™å’Œ Docker çš„ä¸­æ–‡ç¿»è¯‘<strong>æ¬è¿å·¥äºº</strong>å¦‚å‡ºä¸€è¾™ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311171603190.png" alt="image.png"></p><hr><p>å‚è€ƒ</p><ul><li><a href="https://javaguide.cn/tools/docker/docker-intro.html">https://javaguide.cn/tools/docker/docker-intro.html</a></li><li><a href="https://www.pdai.tech/md/devops/docker/docker-01-docker-vm.html">https://www.pdai.tech/md/devops/docker/docker-01-docker-vm.html</a></li><li><a href="https://www.pdai.tech/md/devops/docker/docker-03-basic2.html">https://www.pdai.tech/md/devops/docker/docker-03-basic2.html</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¹¶å‘ç¼–ç¨‹_åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2023/11/15/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2023/11/15/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¤§çº²</p></blockquote><ul><li>çº¿ç¨‹åŸºç¡€æ¦‚å¿µ</li><li>Java çº¿ç¨‹</li><li>ç”Ÿå‘½å‘¨æœŸ</li><li>åˆ›å»ºçº¿ç¨‹</li><li>çº¿ç¨‹çš„è°ƒç”¨æ–¹æ³•</li><li>Synchronized å’Œ Lock</li></ul><p>çº¿ç¨‹</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202401191403753.png" alt="image.png"></p><h3 id="1ã€åŸºç¡€æ¦‚å¿µ"><a href="#1ã€åŸºç¡€æ¦‚å¿µ" class="headerlink" title="1ã€åŸºç¡€æ¦‚å¿µ"></a>1ã€åŸºç¡€æ¦‚å¿µ</h3><h4 id="è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹"></a>è¿›ç¨‹å’Œçº¿ç¨‹</h4><h5 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h5><p>åœ¨è®¡ç®—æœºiä¸­ï¼Œç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œä½†è¿™äº›æŒ‡ä»¤è¦è¿è¡Œï¼Œæ•°æ®è¦è¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½è‡³CPU,æ•°æ®åŠ è½½è‡³å†…å­˜ã€‚åœ¨æŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚</p><p>è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„ã€‚å½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºçš„ä»£ç è‡³å†…å­˜ï¼Œè¿™æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚</p><h5 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h5><p>ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™CPUæ‰§è¡Œï¼Œä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚</p><p>æ€»ç»“ï¼š</p><p>çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œçš„æœ€å°å•ä½ï¼Œå®ƒæ˜¯è¿›ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œå…±äº«è¿›ç¨‹çš„èµ„æºã€‚</p><p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºå’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ¯ä¸ªè¿›ç¨‹è‡³å°‘åŒ…å«ä¸€ä¸ªçº¿ç¨‹ã€‚</p><p><strong>åŒºåˆ«</strong>ï¼šè¿›ç¨‹æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè€Œçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼›è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æˆæœ¬è¾ƒé«˜ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢è¾ƒæ…¢ï¼Œçº¿ç¨‹é—´é€šä¿¡å’Œåˆ‡æ¢æˆæœ¬è¾ƒä½ï¼›çº¿ç¨‹æ˜¯å®ç°å¤šä»»åŠ¡çš„æœ€å°å•ä½ï¼Œè¿›ç¨‹æ˜¯æ‹¥æœ‰èµ„æºçš„æœ€å°å•ä½ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240308231739.png" alt="image.png"></p><hr><h4 id="å¹¶è¡Œå’Œå¹¶å‘"><a href="#å¹¶è¡Œå’Œå¹¶å‘" class="headerlink" title="å¹¶è¡Œå’Œå¹¶å‘"></a>å¹¶è¡Œå’Œå¹¶å‘</h4><ul><li>å¹¶è¡Œï¼šä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šçš„ä½œä¸šåœ¨åŒä¸€Â <strong>æ—¶åˆ»</strong>Â æ‰§è¡Œã€‚</li><li>å¹¶å‘ï¼šä¸¤ä¸ªåŠä¸¤ä¸ªä»¥ä¸Šçš„ä½œä¸šåœ¨åŒä¸€Â <strong>æ—¶é—´æ®µ</strong>Â å†…æ‰§è¡Œã€‚</li></ul><p>æœ€å…³é”®çš„ç‚¹æ˜¯ï¼šæ˜¯å¦æ˜¯Â <strong>åŒæ—¶</strong>Â æ‰§è¡Œ</p><hr><p>è§£é‡Š2ï¼šå¹¶è¡Œå’Œå¹¶å‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>åœ¨å•æ ¸CPUçš„æƒ…å†µä¸‹ï¼š</p><ul><li>å•æ ¸CPUä¸‹çº¿ç¨‹å®é™…è¿˜æ˜¯ä¸²è¡Œæ‰§è¡Œçš„</li><li>æ“ä½œç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªç»„ä»¶å«åšä»»åŠ¡è°ƒåº¦å™¨ï¼Œå°†cpuçš„æ—¶é—´ç‰‡(windowsä¸‹æ—¶é—´ç‰‡æœ€å°çº¦ä¸º15æ¯«ç§’)åˆ†ç»™ä¸åŒçš„ç¨‹åºä½¿ç”¨ï¼Œåªæ˜¯ç”±äºcpuåœ¨çº¿ç¨‹é—´ï¼ˆæ—¶é—´ç‰‡å¾ˆçŸ­ï¼‰çš„åˆ‡æ¢éå¸¸å¿«ï¼Œäººç±»æ„Ÿè§‰æ˜¯åŒæ—¶è¿è¡Œçš„ã€‚</li><li>æ€»ç»“ä¸ºä¸€å¥è¯å°±æ˜¯ï¼šå¾®è§‚ä¸²è¡Œï¼Œå®è§‚å¹¶è¡Œ</li></ul><p>ä¸€èˆ¬ä¼šå°†è¿™ç§çº¿ç¨‹è½®æµä½¿ç”¨ CPUçš„åšæ³• ç§°ä¸ºå¹¶å‘(concurrentï¼‰</p><p>åœ¨å¤šæ ¸ CPU çš„æƒ…å†µä¸‹ï¼š</p><p>æ¯ä¸ªæ ¸(core)éƒ½å¯ä»¥è°ƒåº¦è¿è¡Œçº¿ç¨‹ï¼Œè¿™æ—¶å€™çº¿ç¨‹å¯ä»¥æ˜¯å¹¶è¡Œçš„ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240304152134.png" alt="image.png"></p><p>æ€»ç»“</p><p>ç°åœ¨éƒ½æ˜¯å¤šæ ¸CPU,åœ¨å¤šæ ¸CPUä¸‹</p><ul><li>å¹¶å‘æ˜¯åŒä¸€æ—¶é—´<strong>åº”å¯¹</strong>å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ï¼Œå¤šä¸ªçº¿ç¨‹è½®æµä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªCPU</li><li>å¹¶è¡Œæ˜¯åŒä¸€æ—¶é—´<strong>åŠ¨æ‰‹</strong>åšå¤šä»¶äº‹æƒ…çš„èƒ½åŠ›ï¼Œ4æ ¸CPUåŒæ—¶æ‰§è¡Œ4ä¸ªçº¿ç¨‹</li></ul><hr><h4 id="åŒæ­¥å’Œå¼‚æ­¥"><a href="#åŒæ­¥å’Œå¼‚æ­¥" class="headerlink" title="åŒæ­¥å’Œå¼‚æ­¥"></a>åŒæ­¥å’Œå¼‚æ­¥</h4><p>åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«</p><ul><li><strong>åŒæ­¥</strong>ï¼šå‘å‡ºä¸€ä¸ªè°ƒç”¨ä¹‹åï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œ è¯¥è°ƒç”¨å°±ä¸å¯ä»¥è¿”å›ï¼Œä¸€ç›´ç­‰å¾…ã€‚</li><li><strong>å¼‚æ­¥</strong>ï¼šè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œ<strong>ä¸ç”¨ç­‰å¾…è¿”å›ç»“æœ</strong>ï¼Œè¯¥è°ƒç”¨ç›´æ¥è¿”å›ã€‚</li></ul><h3 id="2ã€ä»€ä¹ˆæ˜¯Java-çº¿ç¨‹"><a href="#2ã€ä»€ä¹ˆæ˜¯Java-çº¿ç¨‹" class="headerlink" title="2ã€ä»€ä¹ˆæ˜¯Java çº¿ç¨‹"></a>2ã€ä»€ä¹ˆæ˜¯Java çº¿ç¨‹</h3><p>åœ¨ JDK 1.2 åŠä»¥åï¼ŒJava çº¿ç¨‹åŸºäºåŸç”Ÿçº¿ç¨‹ï¼ˆNative Threadsï¼‰å®ç°ï¼Œ JVM ç›´æ¥ä½¿ç”¨æ“ä½œç³»ç»ŸåŸç”Ÿçš„å†…æ ¸çº§çº¿ç¨‹ï¼ˆå†…æ ¸çº¿ç¨‹ï¼‰æ¥å®ç° Java çº¿ç¨‹ï¼Œç”±æ“ä½œç³»ç»Ÿå†…æ ¸è¿›è¡Œçº¿ç¨‹çš„è°ƒåº¦å’Œç®¡ç†ã€‚</p><p>ç”¨ä¸€å¥è¯æ¦‚æ‹¬ Java çº¿ç¨‹å’Œæ“ä½œç³»ç»Ÿçº¿ç¨‹çš„å…³ç³»ï¼š<strong>ç°åœ¨çš„ Java çº¿ç¨‹çš„æœ¬è´¨å…¶å®å°±æ˜¯æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹</strong>ã€‚</p><p>åœ¨ Windows å’Œ Linux ç­‰ä¸»æµæ“ä½œç³»ç»Ÿä¸­ï¼ŒJava çº¿ç¨‹é‡‡ç”¨çš„æ˜¯ä¸€å¯¹ä¸€çš„çº¿ç¨‹æ¨¡å‹ï¼Œä¸€ä¸ª Java çº¿ç¨‹å¯¹åº”ä¸€ä¸ªç³»ç»Ÿå†…æ ¸çº¿ç¨‹ã€‚</p><h3 id="3ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåŠäº”ç§åŸºæœ¬çŠ¶æ€"><a href="#3ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåŠäº”ç§åŸºæœ¬çŠ¶æ€" class="headerlink" title="3ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåŠäº”ç§åŸºæœ¬çŠ¶æ€"></a>3ã€çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåŠäº”ç§åŸºæœ¬çŠ¶æ€</h3><p>äº”ç§åŸºæœ¬çŠ¶æ€ï¼šæ–°å»ºï¼Œå°±ç»ªï¼Œé˜»å¡ï¼Œè¿è¡Œï¼Œæ­»äº¡</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311161130480.png" alt="image.png"></p><p>å…³äºJavaä¸­çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹ä¸‹é¢è¿™å¼ è¾ƒä¸ºç»å…¸çš„å›¾ï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311161129688.png" alt="image.png"></p><p>ä¸Šå›¾ä¸­åŸºæœ¬ä¸Šå›Šæ‹¬äº†Javaä¸­å¤šçº¿ç¨‹å„é‡è¦çŸ¥è¯†ç‚¹ã€‚æŒæ¡äº†ä¸Šå›¾ä¸­çš„å„çŸ¥è¯†ç‚¹ï¼ŒJavaä¸­çš„å¤šçº¿ç¨‹ä¹Ÿå°±åŸºæœ¬ä¸ŠæŒæ¡äº†ã€‚ä¸»è¦åŒ…æ‹¬ï¼š</p><p>Javaçº¿ç¨‹å…·æœ‰äº”ä¸­åŸºæœ¬çŠ¶æ€</p><ul><li>æ–°å»ºçŠ¶æ€ï¼ˆNewï¼‰<ul><li>å½“çº¿ç¨‹å¯¹è±¡å¯¹åˆ›å»ºåï¼Œå³è¿›å…¥äº†æ–°å»ºçŠ¶æ€ï¼Œå¦‚ï¼šThread t &#x3D; new MyThread();</li></ul></li><li>å°±ç»ªçŠ¶æ€ï¼ˆRunnableï¼‰<ul><li>å½“è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•ï¼ˆt.start();ï¼‰ï¼Œçº¿ç¨‹å³è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚</li><li>å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹ï¼Œåªæ˜¯è¯´æ˜æ­¤çº¿ç¨‹å·²ç»åšå¥½äº†å‡†å¤‡ï¼Œéšæ—¶ç­‰å¾…CPUè°ƒåº¦æ‰§è¡Œï¼Œå¹¶ä¸æ˜¯è¯´æ‰§è¡Œäº†t.start()æ­¤çº¿ç¨‹ç«‹å³å°±ä¼šæ‰§è¡Œï¼›</li></ul></li><li>è¿è¡ŒçŠ¶æ€ï¼ˆRunningï¼‰<ul><li>å½“CPUå¼€å§‹è°ƒåº¦å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹æ—¶ï¼Œæ­¤æ—¶çº¿ç¨‹æ‰å¾—ä»¥çœŸæ­£æ‰§è¡Œï¼Œå³è¿›å…¥åˆ°è¿è¡ŒçŠ¶æ€ã€‚</li><li>æ³¨ï¼šå°± ç»ªçŠ¶æ€æ˜¯è¿›å…¥åˆ°è¿è¡ŒçŠ¶æ€çš„å”¯ä¸€å…¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹è¦æƒ³è¿›å…¥è¿è¡ŒçŠ¶æ€æ‰§è¡Œï¼Œé¦–å…ˆå¿…é¡»å¤„äºå°±ç»ªçŠ¶æ€ä¸­</li></ul></li><li>é˜»å¡çŠ¶æ€ï¼ˆBlockedï¼‰<ul><li>å¤„äºè¿è¡ŒçŠ¶æ€ä¸­çš„çº¿ç¨‹ç”±äºæŸç§åŸå› ï¼Œæš‚æ—¶æ”¾å¼ƒå¯¹CPUçš„ä½¿ç”¨æƒï¼Œåœæ­¢æ‰§è¡Œï¼Œæ­¤æ—¶è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°å…¶è¿›å…¥åˆ°å°±ç»ªçŠ¶æ€ï¼Œæ‰ æœ‰æœºä¼šå†æ¬¡è¢«CPUè°ƒç”¨ä»¥è¿›å…¥åˆ°è¿è¡ŒçŠ¶æ€ã€‚</li><li>æ ¹æ®é˜»å¡äº§ç”Ÿçš„åŸå› ä¸åŒï¼Œé˜»å¡çŠ¶æ€åˆå¯ä»¥åˆ†ä¸ºä¸‰ç§<ul><li><strong>1.ç­‰å¾…é˜»å¡ï¼šè¿è¡ŒçŠ¶æ€ä¸­çš„çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•ï¼Œä½¿æœ¬çº¿ç¨‹è¿›å…¥åˆ°ç­‰å¾…é˜»å¡çŠ¶æ€</strong>ï¼›</li><li><strong>2.åŒæ­¥é˜»å¡ :</strong> çº¿ç¨‹åœ¨è·å–synchronizedåŒæ­¥é”å¤±è´¥(å› ä¸ºé”è¢«å…¶å®ƒçº¿ç¨‹æ‰€å ç”¨)ï¼Œå®ƒä¼šè¿›å…¥åŒæ­¥é˜»å¡çŠ¶æ€ï¼›</li><li><strong>3.å…¶ä»–é˜»å¡ :</strong> é€šè¿‡è°ƒç”¨çº¿ç¨‹çš„sleep()æˆ–join()æˆ–å‘å‡ºäº†I&#x2F;Oè¯·æ±‚æ—¶ï¼Œçº¿ç¨‹ä¼šè¿›å…¥åˆ°é˜»å¡çŠ¶æ€ã€‚å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I&#x2F;Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚</li></ul></li></ul></li><li>æ­»äº¡çŠ¶æ€ï¼ˆDeadï¼‰<ul><li>çº¿ç¨‹æ‰§è¡Œå®Œäº†æˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†run()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚</li></ul></li></ul><blockquote><p>Javaå¤šçº¿ç¨‹çš„å°±ç»ªã€è¿è¡Œå’Œæ­»äº¡çŠ¶æ€</p></blockquote><p>å°±ç»ªçŠ¶æ€è½¬æ¢ä¸ºè¿è¡ŒçŠ¶æ€ï¼šå½“æ­¤çº¿ç¨‹å¾—åˆ°å¤„ç†å™¨èµ„æºï¼›</p><p>è¿è¡ŒçŠ¶æ€è½¬æ¢ä¸ºå°±ç»ªçŠ¶æ€ï¼šå½“æ­¤çº¿ç¨‹ä¸»åŠ¨è°ƒç”¨yield()æ–¹æ³•æˆ–åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¤±å»å¤„ç†å™¨èµ„æºã€‚</p><p>è¿è¡ŒçŠ¶æ€è½¬æ¢ä¸ºæ­»äº¡çŠ¶æ€ï¼šå½“æ­¤çº¿ç¨‹çº¿ç¨‹æ‰§è¡Œä½“æ‰§è¡Œå®Œæ¯•æˆ–å‘ç”Ÿäº†å¼‚å¸¸ã€‚</p><p>æ­¤å¤„éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šå½“è°ƒç”¨çº¿ç¨‹çš„yield()æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬æ¢ä¸ºå°±ç»ªçŠ¶æ€ï¼Œä½†æ¥ä¸‹æ¥CPUè°ƒåº¦å°±ç»ªçŠ¶æ€ä¸­çš„å“ªä¸ªçº¿ç¨‹å…·æœ‰ä¸€å®šçš„éšæœºæ€§ï¼Œå› æ­¤ï¼Œå¯èƒ½ä¼šå‡ºç°Açº¿ç¨‹è°ƒç”¨äº†yield()æ–¹æ³•åï¼Œæ¥ä¸‹æ¥CPUä»ç„¶è°ƒåº¦äº†Açº¿ç¨‹çš„æƒ…å†µã€‚</p><hr><p>åœ¨ Java çš„ Thread ç±»ä¸­ï¼Œæœ‰ä¸€ä¸ª State çš„æšä¸¾</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs pf">/**<br> * A thread <span class="hljs-keyword">state</span>.  A thread can be <span class="hljs-keyword">in</span> one of the following states:<br> * <span class="hljs-variable">&lt;ul&gt;</span><br> * <span class="hljs-variable">&lt;li&gt;</span>&#123;@link <span class="hljs-comment">#NEW&#125;&lt;br&gt;</span><br> *     A thread that has not yet started is <span class="hljs-keyword">in</span> this <span class="hljs-keyword">state</span>.<br> *     &lt;/li&gt;<br> * <span class="hljs-variable">&lt;li&gt;</span>&#123;@link <span class="hljs-comment">#RUNNABLE&#125;&lt;br&gt;</span><br> *     A thread executing <span class="hljs-keyword">in</span> the Java virtual machine is <span class="hljs-keyword">in</span> this <span class="hljs-keyword">state</span>.<br> *     &lt;/li&gt;<br> * <span class="hljs-variable">&lt;li&gt;</span>&#123;@link <span class="hljs-comment">#BLOCKED&#125;&lt;br&gt;</span><br> *     A thread that is blocked waiting <span class="hljs-keyword">for</span> a monitor lock<br> *     is <span class="hljs-keyword">in</span> this <span class="hljs-keyword">state</span>.<br> *     &lt;/li&gt;<br> * <span class="hljs-variable">&lt;li&gt;</span>&#123;@link <span class="hljs-comment">#WAITING&#125;&lt;br&gt;</span><br> *     A thread that is waiting indefinitely <span class="hljs-keyword">for</span> another thread <span class="hljs-keyword">to</span><br> *     perform a particular action is <span class="hljs-keyword">in</span> this <span class="hljs-keyword">state</span>.<br> *     &lt;/li&gt;<br> * <span class="hljs-variable">&lt;li&gt;</span>&#123;@link <span class="hljs-comment">#TIMED_WAITING&#125;&lt;br&gt;</span><br> *     A thread that is waiting <span class="hljs-keyword">for</span> another thread <span class="hljs-keyword">to</span> perform an action<br> *     <span class="hljs-keyword">for</span> up <span class="hljs-keyword">to</span> a specified waiting time is <span class="hljs-keyword">in</span> this <span class="hljs-keyword">state</span>.<br> *     &lt;/li&gt;<br> * <span class="hljs-variable">&lt;li&gt;</span>&#123;@link <span class="hljs-comment">#TERMINATED&#125;&lt;br&gt;</span><br> *     A thread that has exited is <span class="hljs-keyword">in</span> this <span class="hljs-keyword">state</span>.<br> *     &lt;/li&gt;<br> * &lt;/ul&gt;<br> *<br> * <span class="hljs-variable">&lt;p&gt;</span><br> * A thread can be <span class="hljs-keyword">in</span> only one <span class="hljs-keyword">state</span> at a given point <span class="hljs-keyword">in</span> time.<br> * These states are virtual machine states which do not reflect<br> * <span class="hljs-literal">any</span> operating system thread states.<br> *<br> * @since   <span class="hljs-number">1.5</span><br> * @see <span class="hljs-comment">#getState</span><br> */<br>public enum State &#123;<br>    /**<br>     * Thread <span class="hljs-keyword">state</span> <span class="hljs-keyword">for</span> a thread which has not yet started.<br>     */<br>    NEW,<br><br>    /**<br>     * Thread <span class="hljs-keyword">state</span> <span class="hljs-keyword">for</span> a runnable thread.  A thread <span class="hljs-keyword">in</span> the runnable<br>     * <span class="hljs-keyword">state</span> is executing <span class="hljs-keyword">in</span> the Java virtual machine but it may<br>     * be waiting <span class="hljs-keyword">for</span> other resources <span class="hljs-keyword">from</span> the operating system<br>     * such as processor.<br>     */<br>    RUNNABLE,<br><br>    /**<br>     * Thread <span class="hljs-keyword">state</span> <span class="hljs-keyword">for</span> a thread blocked waiting <span class="hljs-keyword">for</span> a monitor lock.<br>     * A thread <span class="hljs-keyword">in</span> the blocked <span class="hljs-keyword">state</span> is waiting <span class="hljs-keyword">for</span> a monitor lock<br>     * <span class="hljs-keyword">to</span> enter a synchronized <span class="hljs-built_in">block</span>/method or<br>     * reenter a synchronized <span class="hljs-built_in">block</span>/method after calling<br>     * &#123;@link Object<span class="hljs-comment">#wait() Object.wait&#125;.</span><br>     */<br>    BLOCKED,<br><br>    /**<br>     * Thread <span class="hljs-keyword">state</span> <span class="hljs-keyword">for</span> a waiting thread.<br>     * A thread is <span class="hljs-keyword">in</span> the waiting <span class="hljs-keyword">state</span> due <span class="hljs-keyword">to</span> calling one of the<br>     * following methods:<br>     * <span class="hljs-variable">&lt;ul&gt;</span><br>     *   <span class="hljs-variable">&lt;li&gt;</span>&#123;@link Object<span class="hljs-comment">#wait() Object.wait&#125; with no timeout&lt;/li&gt;</span><br>     *   <span class="hljs-variable">&lt;li&gt;</span>&#123;@link <span class="hljs-comment">#join() Thread.join&#125; with no timeout&lt;/li&gt;</span><br>     *   <span class="hljs-variable">&lt;li&gt;</span>&#123;@link LockSupport<span class="hljs-comment">#park() LockSupport.park&#125;&lt;/li&gt;</span><br>     * &lt;/ul&gt;<br>     *<br>     * <span class="hljs-variable">&lt;p&gt;</span>A thread <span class="hljs-keyword">in</span> the waiting <span class="hljs-keyword">state</span> is waiting <span class="hljs-keyword">for</span> another thread <span class="hljs-keyword">to</span><br>     * perform a particular action.<br>     *<br>     * For example, a thread that has called <span class="hljs-variable">&lt;tt&gt;</span>Object.wait()&lt;/tt&gt;<br>     * <span class="hljs-keyword">on</span> an object is waiting <span class="hljs-keyword">for</span> another thread <span class="hljs-keyword">to</span> call<br>     * <span class="hljs-variable">&lt;tt&gt;</span>Object.notify()&lt;/tt&gt; or <span class="hljs-variable">&lt;tt&gt;</span>Object.notifyAll()&lt;/tt&gt; <span class="hljs-keyword">on</span><br>     * that object. A thread that has called <span class="hljs-variable">&lt;tt&gt;</span>Thread.join()&lt;/tt&gt;<br>     * is waiting <span class="hljs-keyword">for</span> a specified thread <span class="hljs-keyword">to</span> terminate.<br>     */<br>    WAITING,<br><br>    /**<br>     * Thread <span class="hljs-keyword">state</span> <span class="hljs-keyword">for</span> a waiting thread with a specified waiting time.<br>     * A thread is <span class="hljs-keyword">in</span> the timed waiting <span class="hljs-keyword">state</span> due <span class="hljs-keyword">to</span> calling one of<br>     * the following methods with a specified positive waiting time:<br>     * <span class="hljs-variable">&lt;ul&gt;</span><br>     *   <span class="hljs-variable">&lt;li&gt;</span>&#123;@link <span class="hljs-comment">#sleep Thread.sleep&#125;&lt;/li&gt;</span><br>     *   <span class="hljs-variable">&lt;li&gt;</span>&#123;@link Object<span class="hljs-comment">#wait(long) Object.wait&#125; with timeout&lt;/li&gt;</span><br>     *   <span class="hljs-variable">&lt;li&gt;</span>&#123;@link <span class="hljs-comment">#join(long) Thread.join&#125; with timeout&lt;/li&gt;</span><br>     *   <span class="hljs-variable">&lt;li&gt;</span>&#123;@link LockSupport<span class="hljs-comment">#parkNanos LockSupport.parkNanos&#125;&lt;/li&gt;</span><br>     *   <span class="hljs-variable">&lt;li&gt;</span>&#123;@link LockSupport<span class="hljs-comment">#parkUntil LockSupport.parkUntil&#125;&lt;/li&gt;</span><br>     * &lt;/ul&gt;<br>     */<br>    TIMED_WAITING,<br><br>    /**<br>     * Thread <span class="hljs-keyword">state</span> <span class="hljs-keyword">for</span> a terminated thread.<br>     * The thread has completed execution.<br>     */<br>    TERMINATED;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ†ææµç¨‹å›¾</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240304154734.png" alt="image.png"></p><blockquote><p>é¢è¯•é¢˜ï¼š1.çº¿ç¨‹åŒ…æ‹¬å“ªäº›çŠ¶æ€</p></blockquote><p>æ–°å»º(NEW)ã€å¯è¿è¡Œ(RUNNABLE)ã€é˜»å¡(BLOCKED)ã€ç­‰å¾…(WAITING)ã€æ—¶é—´ç­‰å¾…(TIMED_WALTING)ã€ç»ˆæ­¢(TERMINATED)</p><blockquote><p>é¢è¯•é¢˜ï¼š2.çº¿ç¨‹çŠ¶æ€ä¹‹é—´æ˜¯å¦‚ä½•å˜åŒ–çš„</p></blockquote><ul><li>åˆ›å»ºçº¿ç¨‹å¯¹è±¡æ˜¯æ–°å»ºçŠ¶æ€</li><li>è°ƒç”¨äº†stat()æ–¹æ³•è½¬å˜ä¸º<strong>å¯æ‰§è¡ŒçŠ¶æ€</strong></li><li>çº¿ç¨‹è·å–åˆ°äº†CPUçš„æ‰§è¡Œæƒï¼Œæ‰§è¡Œç»“æŸæ˜¯<strong>ç»ˆæ­¢çŠ¶æ€</strong></li><li>åœ¨å¯æ‰§è¡ŒçŠ¶æ€çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰è·å– CPU çš„æ‰§è¡Œæƒï¼Œå¯èƒ½ä¼šåˆ‡æ¢å…¶ä»–çŠ¶æ€<ul><li>å¦‚æœæ²¡æœ‰è·å–é”(synchronized æˆ–Iock)è¿›å…¥<strong>é˜»å¡çŠ¶æ€</strong>ï¼Œè·å¾—é”å†åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€</li><li>å¦‚æœçº¿ç¨‹è°ƒç”¨äº†wait()æ–¹æ³•è¿›å…¥<strong>ç­‰å¾…çŠ¶æ€</strong>ï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨notify()å”¤é†’åå¯åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€</li><li>å¦‚æœçº¿ç¨‹è°ƒç”¨äº†sleep(50)æ–¹æ³•ï¼Œè¿›å…¥<strong>è®¡æ—¶ç­‰å¾…çŠ¶æ€</strong>ï¼Œåˆ°æ—¶é—´åå¯åˆ‡æ¢ä¸ºå¯æ‰§è¡ŒçŠ¶æ€</li></ul></li></ul><h3 id="4ã€åˆ›å»ºçº¿ç¨‹"><a href="#4ã€åˆ›å»ºçº¿ç¨‹" class="headerlink" title="4ã€åˆ›å»ºçº¿ç¨‹"></a>4ã€åˆ›å»ºçº¿ç¨‹</h3><h4 id="çº¿ç¨‹åˆ›å»º-ğŸš©"><a href="#çº¿ç¨‹åˆ›å»º-ğŸš©" class="headerlink" title="çº¿ç¨‹åˆ›å»º ğŸš©"></a>çº¿ç¨‹åˆ›å»º ğŸš©</h4><p>åœ¨Javaä¸­ï¼Œæœ‰ä¸‰ç§å¸¸è§çš„çº¿ç¨‹åˆ›å»ºæ–¹å¼ï¼šä½¿ç”¨Threadç±»ã€å®ç°Runnableæ¥å£å’Œå®ç°Callableæ¥å£ã€‚</p><ol><li>Threadç±»ï¼šThreadç±»æ˜¯ Java æä¾›çš„ä¸€ä¸ªçº¿ç¨‹ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿Threadç±»æ¥åˆ›å»ºçº¿ç¨‹ã€‚<strong>é€šè¿‡é‡å†™Threadç±»çš„run()æ–¹æ³•æ¥å®šä¹‰çº¿ç¨‹çš„æ‰§è¡Œé€»è¾‘</strong>ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// çº¿ç¨‹çš„æ‰§è¡Œé€»è¾‘</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹</span><br><span class="hljs-type">MyThread</span> <span class="hljs-variable">myThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();<br>myThread.start();<br></code></pre></td></tr></table></figure><ol start="2"><li>Runnable æ¥å£ï¼šRunnableæ¥å£æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°Runnableæ¥å£æ¥åˆ›å»ºçº¿ç¨‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRunnableæ¥å£å¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ç±»ï¼Œ<strong>è€Œæ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œéœ€è¦é€šè¿‡Threadç±»æ¥åˆ›å»ºçº¿ç¨‹</strong>å¹¶æ‰§è¡Œä»»åŠ¡ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// çº¿ç¨‹çš„æ‰§è¡Œé€»è¾‘</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹</span><br><span class="hljs-type">MyRunnable</span> <span class="hljs-variable">myRunnable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>();<br><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(myRunnable);<br>thread.start();<br></code></pre></td></tr></table></figure><ol start="3"><li>Callableæ¥å£ï¼šCallableæ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œä¸Runnableæ¥å£ç±»ä¼¼ï¼Œå¯ä»¥é€šè¿‡å®ç°Callableæ¥å£æ¥åˆ›å»ºçº¿ç¨‹ã€‚ä¸åŒçš„æ˜¯ï¼Œ<strong>Callableæ¥å£çš„call()æ–¹æ³•å¯ä»¥è¿”å›ä¸€ä¸ªç»“æœï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸</strong>ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;Integer&gt; &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// çº¿ç¨‹çš„æ‰§è¡Œé€»è¾‘</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>; <span class="hljs-comment">// è¿”å›ä¸€ä¸ªç»“æœ</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹</span><br><span class="hljs-type">MyCallable</span> <span class="hljs-variable">myCallable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallable</span>();<br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor();<br>Future&lt;Integer&gt; future = executorService.submit(myCallable);<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨Threadç±»åˆ›å»ºçº¿ç¨‹æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ï¼Œä½†æ˜¯ç”±äºJavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œæ‰€ä»¥å¦‚æœå·²ç»æœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œå°±ä¸èƒ½å†ç›´æ¥ä½¿ç”¨Threadç±»åˆ›å»ºçº¿ç¨‹ã€‚</li><li>å®ç°Runnableæ¥å£æ˜¯ä¸€ç§æ›´åŠ çµæ´»çš„æ–¹å¼ï¼Œå¯ä»¥é¿å…å•ç»§æ‰¿çš„é™åˆ¶ï¼Œè¿˜å¯ä»¥å…±äº«æ•°æ®ã€‚</li><li>Callableæ¥å£ä¸Runnableæ¥å£ç±»ä¼¼ï¼Œä½†å¯ä»¥è¿”å›ä¸€ä¸ªç»“æœï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚å¯ä»¥é€šè¿‡ExecutorServiceçš„submit()æ–¹æ³•æ¥æ‰§è¡ŒCallableä»»åŠ¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è¯¥å¯¹è±¡è·å–ä»»åŠ¡çš„ç»“æœã€‚</li></ul><hr><p>è¡¥å……ï¼š</p><p>Callable + FutureTask</p><p><code>Callable</code>æ¥å£ä¸<code>Runnable</code>æ¥å£ç±»ä¼¼ï¼Œä½†å®ƒå¯ä»¥è¿”å›æ‰§è¡Œç»“æœï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚ä½¿ç”¨<code>Callable</code>æ—¶é€šå¸¸é…åˆ<code>FutureTask</code>æˆ–çº¿ç¨‹æ± ï¼ˆ<code>ExecutorService</code>ï¼‰æ¥ä½¿ç”¨ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.Callable;<br><span class="hljs-keyword">import</span> java.util.concurrent.ExecutionException;<br><span class="hljs-keyword">import</span> java.util.concurrent.FutureTask;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallableFutureTaskExample</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºCallableå¯¹è±¡</span><br>        Callable&lt;Integer&gt; callableTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callable</span>&lt;Integer&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                System.out.println(<span class="hljs-string">&quot;å¼€å§‹è®¡ç®—...&quot;</span>);<br>                Thread.sleep(<span class="hljs-number">2000</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—è¿‡ç¨‹</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-number">123</span>; <span class="hljs-comment">// è¿”å›è®¡ç®—ç»“æœ</span><br>            &#125;<br>        &#125;;<br><br>        <span class="hljs-comment">// å°†Callableä¸FutureTaskå…³è”</span><br>        FutureTask&lt;Integer&gt; futureTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(callableTask);<br><br>        <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹æ‰§è¡ŒFutureTask</span><br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask);<br>        thread.start();<br><br>        <span class="hljs-comment">// æ‰§è¡Œå…¶ä»–ä»»åŠ¡...</span><br>        System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œå…¶ä»–ä»»åŠ¡...&quot;</span>);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è·å–è®¡ç®—ç»“æœï¼Œå¦‚æœè®¡ç®—æœªå®Œæˆåˆ™é˜»å¡ç­‰å¾…</span><br>            <span class="hljs-type">Integer</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> futureTask.get();<br>            System.out.println(<span class="hljs-string">&quot;è®¡ç®—ç»“æœ: &quot;</span> + result);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException | ExecutionException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>FutureTask</code>æ˜¯<code>Future</code>æ¥å£çš„ä¸€ä¸ªå®ç°ï¼Œå®ƒå°è£…äº†<code>Callable</code>ä»»åŠ¡çš„æ‰§è¡Œã€‚</p><p>é€šè¿‡å°†<code>Callable</code>å®ä¾‹ä¼ é€’ç»™<code>FutureTask</code>çš„æ„é€ å™¨,  ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œ<code>FutureTask</code>ã€‚</p><hr><p>ä¸€èˆ¬åœ¨é¡¹ç›®ä¸­ä¼šä½¿ç”¨çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</p><p>ä½¿ç”¨çº¿ç¨‹æ± æ‰§è¡Œ<code>Runnable</code>ä»»åŠ¡çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;<br><span class="hljs-keyword">import</span> java.util.concurrent.Executors;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolExample</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </span><br>        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2</span>);<br><br>        <span class="hljs-comment">// æäº¤Runnableä»»åŠ¡</span><br>        executor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;Asynchronous task&quot;</span>);<br>            &#125;<br>        &#125;);<br><br>        <span class="hljs-comment">// å¦ä¸€ç§æäº¤Runnableä»»åŠ¡çš„æ–¹å¼ï¼Œä½¿ç”¨Java 8çš„Lambdaè¡¨è¾¾å¼</span><br>        executor.submit(() -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;Asynchronous task with lambda&quot;</span>);<br>        &#125;);<br><br>        <span class="hljs-comment">// å…³é—­çº¿ç¨‹æ± </span><br>        executor.shutdown();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå›ºå®šå¤§å°ä¸º2çš„çº¿ç¨‹æ± ï¼Œå¹¶æäº¤äº†ä¸¤ä¸ª<code>Runnable</code>ä»»åŠ¡ã€‚ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„æ˜¯å¯ä»¥é‡ç”¨çº¿ç¨‹ï¼Œå‡å°‘çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œä»¥åŠå¯ä»¥æ§åˆ¶å¹¶å‘çº¿ç¨‹çš„æ•°é‡ã€‚</p><hr><p>å…±æœ‰å››ç§æ–¹å¼å¯ä»¥åˆ›å»ºçº¿ç¨‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>ç»§æ‰¿Threadç±»</li><li>å®ç° runnable æ¥å£</li><li>å®ç° Callable æ¥å£</li><li>çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹ï¼ˆé¡¹ç›®ä¸­ä½¿ç”¨æ–¹å¼ï¼‰</li></ul><blockquote><p>é¢è¯•é¢˜ï¼š runnableå’Œcallableæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></blockquote><p>å‚è€ƒå›ç­”ï¼š</p><ul><li>1.Runnableæ¥å£ run æ–¹æ³•æ²¡æœ‰è¿”å›å€¼</li><li>2.Callableæ¥å£ call æ–¹æ³•æœ‰è¿”å›å€¼ï¼Œæ˜¯ä¸ªæ³›å‹ï¼Œå’ŒFutureã€FutureTaskié…åˆå¯ä»¥ç”¨æ¥è·å–å¼‚æ­¥æ‰§è¡Œçš„ç»“æœ</li><li>3.Callableæ¥å£çš„ call() æ–¹æ³•å…è®¸æŠ›å‡ºå¼‚å¸¸ï¼›è€ŒRunnableæ¥å£çš„runOæ–¹æ³•çš„å¼‚å¸¸åªèƒ½åœ¨å†…éƒ¨æ¶ˆåŒ–ï¼Œä¸èƒ½ç»§ç»­ä¸ŠæŠ›</li></ul><blockquote><p>é¢è¯•é¢˜ï¼šçº¿ç¨‹çš„run() å’Œstart() æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></blockquote><ul><li>start():ç”¨æ¥å¯åŠ¨çº¿ç¨‹ï¼Œé€šè¿‡è¯¥çº¿ç¨‹è°ƒç”¨runæ–¹æ³•æ‰§è¡Œrunæ–¹æ³•ä¸­æ‰€å®šä¹‰çš„é€»è¾‘ä»£ç ã€‚startæ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>run():å°è£…äº†è¦è¢«çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œå¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ã€‚</li></ul><h4 id="å†™æ³•ç®€åŒ–"><a href="#å†™æ³•ç®€åŒ–" class="headerlink" title="å†™æ³•ç®€åŒ–"></a>å†™æ³•ç®€åŒ–</h4><blockquote><p>å†™æ³•ç®€åŒ–ï¼ˆJava 8)</p></blockquote><ul><li><strong>æ–¹å¼ä¸€ï¼š</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>()&#123; <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123; <br>        System.out.println(<span class="hljs-string">&quot;thread run ...&quot;</span>);<br>    &#125;<br>&#125;;<br><br>thread.start();<br></code></pre></td></tr></table></figure><p>ç®€åŒ–åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; System.out.println(<span class="hljs-string">&quot;thread run ...&quot;</span>));<br><br>thread.start();<br></code></pre></td></tr></table></figure><ul><li><strong>æ–¹å¼äºŒï¼š</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123; <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123; <br>        System.out.println(<span class="hljs-string">&quot;runnable run ...&quot;</span>);<br>    &#125;<br>&#125;);<br><br>thread.start();<br></code></pre></td></tr></table></figure><p>ç®€åŒ–åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; System.out.println(<span class="hljs-string">&quot;runnable run ...&quot;</span>));<br><br>thread.start();<br></code></pre></td></tr></table></figure><ul><li><strong>æ–¹å¼ä¸‰ï¼š</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">Callable&lt;Integer&gt; callable = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callable</span>() &#123; <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123; <br>        System.out.println(<span class="hljs-string">&quot;callable run ...&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">521</span>;<br>    &#125;<br>&#125;;<br><span class="hljs-type">FutureTask</span> <span class="hljs-variable">futureTask</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>(callable);<br><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask);<br>thread.start();<br></code></pre></td></tr></table></figure><p>ç®€åŒ–åï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>(() -&gt; &#123; <br>    System.out.println(<span class="hljs-string">&quot;callable run ...&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">521</span>;<br>&#125;));<br><br>thread.start();<br></code></pre></td></tr></table></figure><hr><h4 id="å¸¸è§é¢è¯•é¢˜"><a href="#å¸¸è§é¢è¯•é¢˜" class="headerlink" title="å¸¸è§é¢è¯•é¢˜"></a>å¸¸è§é¢è¯•é¢˜</h4><h5 id="é¡ºåºæ‰§è¡Œ"><a href="#é¡ºåºæ‰§è¡Œ" class="headerlink" title="é¡ºåºæ‰§è¡Œ"></a>é¡ºåºæ‰§è¡Œ</h5><p>å¸¸è§çš„ä¸€é“é¢è¯•é¢˜ï¼šæ–°å»ºT1ã€T2ã€T3ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ</p><p>è¦ä¿è¯ä¸‰ä¸ªçº¿ç¨‹T1ã€T2ã€T3æŒ‰é¡ºåºæ‰§è¡Œï¼Œå³å…ˆæ‰§è¡ŒT1ï¼ŒT1æ‰§è¡Œå®Œæ¯•åæ‰§è¡ŒT2ï¼ŒT2æ‰§è¡Œå®Œæ¯•åæ‰§è¡ŒT3ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§æ–¹æ³•æ¥å®ç°ã€‚è¿™é‡Œæä¾›ä¸‰ç§å¸¸è§çš„æ–¹æ³•ï¼š</p><p>æ–¹æ³•1ï¼šä½¿ç”¨<code>join()</code>æ–¹æ³•</p><p><code>join()</code>æ–¹æ³•å¯ä»¥ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹å®Œæˆåå†ç»§ç»­æ‰§è¡Œã€‚</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs livescript">public <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadOrder</span> &#123;<br>    public <span class="hljs-keyword">static</span> <span class="hljs-literal">void</span> main(<span class="hljs-built_in">String</span>[] args) &#123;<br>        Thread t1 = <span class="hljs-keyword">new</span> Thread<span class="hljs-function"><span class="hljs-params">(() -&gt; System.out.println(<span class="hljs-string">&quot;T1 is running&quot;</span>))</span>;</span><br><span class="hljs-function">        <span class="hljs-title">Thread</span> <span class="hljs-title">t2</span> = <span class="hljs-title">new</span> <span class="hljs-title">Thread</span><span class="hljs-params">(() -&gt; System.out.println(<span class="hljs-string">&quot;T2 is running&quot;</span>))</span>;</span><br><span class="hljs-function">        <span class="hljs-title">Thread</span> <span class="hljs-title">t3</span> = <span class="hljs-title">new</span> <span class="hljs-title">Thread</span><span class="hljs-params">(() -&gt; System.out.println(<span class="hljs-string">&quot;T3 is running&quot;</span>))</span>;</span><br><span class="hljs-function">        </span><br><span class="hljs-function">        <span class="hljs-title">try</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">t1</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">            <span class="hljs-title">t1</span>.<span class="hljs-title">join</span><span class="hljs-params">()</span>; // ç­‰å¾…<span class="hljs-title">t1</span>æ‰§è¡Œå®Œæ¯•</span><br><span class="hljs-function">            </span><br><span class="hljs-function">            <span class="hljs-title">t2</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">            <span class="hljs-title">t2</span>.<span class="hljs-title">join</span><span class="hljs-params">()</span>; // ç­‰å¾…<span class="hljs-title">t2</span>æ‰§è¡Œå®Œæ¯•</span><br><span class="hljs-function">            </span><br><span class="hljs-function">            <span class="hljs-title">t3</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">            <span class="hljs-title">t3</span>.<span class="hljs-title">join</span><span class="hljs-params">()</span>; // ç­‰å¾…<span class="hljs-title">t3</span>æ‰§è¡Œå®Œæ¯•</span><br><span class="hljs-function">        &#125; <span class="hljs-title">catch</span> <span class="hljs-params">(InterruptedException e)</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">e</span>.<span class="hljs-title">printStackTrace</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">        &#125;</span><br><span class="hljs-function">    &#125;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><p>æ–¹æ³•2ï¼šä½¿ç”¨<code>wait()</code>å’Œ<code>notify()/notifyAll()</code>æ–¹æ³•</p><p>é€šè¿‡å¯¹è±¡ç›‘è§†å™¨çš„<code>wait()</code>å’Œ<code>notify()</code>æ–¹æ³•æ¥æ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚è¿™ç§æ–¹æ³•ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç¡®ä¿<code>wait()</code>å’Œ<code>notify()</code>è°ƒç”¨åœ¨åŒæ­¥å—ä¸­ã€‚</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs livescript">public <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadOrder</span> &#123;<br>    public <span class="hljs-keyword">static</span> <span class="hljs-literal">void</span> main(<span class="hljs-built_in">String</span>[] args) &#123;<br>        final <span class="hljs-built_in">Object</span> lock = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>();<br>        Thread t1 = <span class="hljs-keyword">new</span> Thread<span class="hljs-function"><span class="hljs-params">(() -&gt; &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">            synchronized (lock) &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">                System.out.println(<span class="hljs-string">&quot;T1 is running&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">                lock.notify(); <span class="hljs-regexp">// å”¤é†’ç­‰å¾…lockå¯¹è±¡çš„ä¸€ä¸ªçº¿ç¨‹</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">            &#125;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        &#125;);</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        </span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        Thread t2 = new Thread(() -&gt; &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">            synchronized (lock) &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                try &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                    lock.wait(); //</span> ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°lockå¯¹è±¡è¢«å”¤é†’</span></span><br><span class="hljs-params"><span class="hljs-function">                    System.out.println(<span class="hljs-string">&quot;T2 is running&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">                    lock.notify(); <span class="hljs-regexp">// å”¤é†’ç­‰å¾…lockå¯¹è±¡çš„ä¸€ä¸ªçº¿ç¨‹</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                &#125; catch (InterruptedException e) &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                    e.printStackTrace();</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                &#125;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">            &#125;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        &#125;);</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        </span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">        Thread t3 = new Thread(() -&gt; &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">            synchronized (lock) &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                try &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                    lock.wait(); //</span> ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ç›´åˆ°lockå¯¹è±¡è¢«å”¤é†’</span></span><br><span class="hljs-params"><span class="hljs-function">                    System.out.println(<span class="hljs-string">&quot;T3 is running&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">                    e.printStackTrace();</span></span><br><span class="hljs-params"><span class="hljs-function">                &#125;</span></span><br><span class="hljs-params"><span class="hljs-function">            &#125;</span></span><br><span class="hljs-params"><span class="hljs-function">        &#125;)</span>;</span><br><span class="hljs-function"></span><br><span class="hljs-function">        <span class="hljs-title">try</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">t2</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">            <span class="hljs-title">t3</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">            <span class="hljs-title">Thread</span>.<span class="hljs-title">sleep</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span>; // ç¡®ä¿<span class="hljs-title">t2</span>å’Œ<span class="hljs-title">t3</span>å¯åŠ¨å¹¶è¿›å…¥<span class="hljs-title">wait</span>çŠ¶æ€</span><br><span class="hljs-function">            <span class="hljs-title">t1</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">        &#125; <span class="hljs-title">catch</span> <span class="hljs-params">(InterruptedException e)</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">e</span>.<span class="hljs-title">printStackTrace</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">        &#125;</span><br><span class="hljs-function">    &#125;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><p>æ–¹æ³•3ï¼šä½¿ç”¨<code>CountDownLatch</code></p><p><code>CountDownLatch</code>æ˜¯ä¸€ä¸ªåŒæ­¥è¾…åŠ©ç±»ï¼Œç”¨äºå»¶è¿Ÿçº¿ç¨‹çš„è¿›åº¦ç›´åˆ°å…¶è¾¾åˆ°ç»ˆæ­¢çŠ¶æ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadOrder</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>);<br>        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1</span>);<br>        <br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;T1 is running&quot;</span>);<br>            latch1.countDown(); <span class="hljs-comment">// å‡å°‘è®¡æ•°</span><br>        &#125;);<br>        <br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                latch1.await(); <span class="hljs-comment">// ç­‰å¾…latch1è®¡æ•°åˆ°è¾¾0</span><br>                System.out.println(<span class="hljs-string">&quot;T2 is running&quot;</span>);<br>                latch2.countDown(); <span class="hljs-comment">// å‡å°‘è®¡æ•°</span><br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;);<br>        <br>        <span class="hljs-type">Thread</span> <span class="hljs-variable">t3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                latch2.await(); <span class="hljs-comment">// ç­‰å¾…latch2è®¡æ•°åˆ°è¾¾0</span><br>                System.out.println(<span class="hljs-string">&quot;T3 is running&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;);<br>        <br>        t1.start();<br>        t2.start();<br>        t3.start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸‰ç§æ–¹æ³•å„æœ‰ç‰¹ç‚¹ï¼Œå¯ä»¥æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©æœ€é€‚åˆçš„ä¸€ç§æ¥ä¿è¯çº¿ç¨‹æŒ‰é¡ºåºæ‰§è¡Œã€‚</p><hr><blockquote><p>é¢è¯•é¢˜ï¼šæ–°å»ºT1ã€T2ã€T3ä¸‰ä¸ªçº¿ç¨‹ï¼Œå¦‚ä½•ä¿è¯å®ƒä»¬æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ</p></blockquote><p>å¯ä»¥ä½¿ç”¨çº¿ç¨‹ä¸­çš„ join æ–¹æ³•è§£å†³</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240304162424.png" alt="image.png"></p><h5 id="åœæ­¢çº¿ç¨‹"><a href="#åœæ­¢çº¿ç¨‹" class="headerlink" title="åœæ­¢çº¿ç¨‹"></a>åœæ­¢çº¿ç¨‹</h5><blockquote><p>å¦‚ä½•åœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Ÿ</p></blockquote><p>æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥åœæ­¢çº¿ç¨‹</p><ul><li>ä½¿ç”¨é€€å‡ºæ ‡å¿—ï¼Œä½¿çº¿ç¨‹æ­£å¸¸é€€å‡ºï¼Œä¹Ÿå°±æ˜¯å½“ run æ–¹æ³•å®Œæˆåçº¿ç¨‹ç»ˆæ­¢</li><li>ä½¿ç”¨stopæ–¹æ³•å¼ºè¡Œç»ˆæ­¢ï¼ˆä¸æ¨èï¼Œæ–¹æ³•å·²ä½œåºŸï¼‰</li><li>ä½¿ç”¨interruptæ–¹æ³•ä¸­æ–­çº¿ç¨‹<ul><li>æ‰“æ–­é˜»å¡çš„çº¿ç¨‹(sleep,wait,join) çš„çº¿ç¨‹ï¼Œçº¿ç¨‹ä¼šæŠ›å‡º InterruptedException å¼‚å¸¸</li><li>æ‰“æ–­æ­£å¸¸çš„çº¿ç¨‹ï¼Œå¯ä»¥æ ¹æ®æ‰“æ–­çŠ¶æ€æ¥æ ‡è®°æ˜¯å¦é€€å‡ºçº¿ç¨‹</li></ul></li></ul><h3 id="5ã€çº¿ç¨‹åŸºæœ¬æ–¹æ³•"><a href="#5ã€çº¿ç¨‹åŸºæœ¬æ–¹æ³•" class="headerlink" title="5ã€çº¿ç¨‹åŸºæœ¬æ–¹æ³•"></a>5ã€çº¿ç¨‹åŸºæœ¬æ–¹æ³•</h3><blockquote><p>æ³¨æ„ï¼šæ ‡é»„è‰²çš„æ–¹æ³•ä»£è¡¨æ˜¯ <code>static</code>â€‹ æ–¹æ³•ï¼Œå¯ç›´æ¥ç±»åè°ƒç”¨ï¼Œæ— éœ€åˆ›å»ºå¯¹è±¡ã€‚</p></blockquote><table><thead><tr><th>åç§°</th><th>æè¿°</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td>â€‹<code>start()</code>â€‹</td><td>å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œ<br />åœ¨æ–°çš„çº¿ç¨‹è¿è¡Œ run æ–¹æ³•</td><td>start æ–¹æ³•åªæ˜¯è®©çº¿ç¨‹è¿›å…¥å°±ç»ªï¼Œé‡Œé¢ä»£ç ä¸ä¸€å®šç«‹åˆ»<br />è¿è¡Œï¼ˆCPU çš„æ—¶é—´ç‰‡è¿˜æ²¡åˆ†ç»™å®ƒï¼‰ã€‚æ¯ä¸ªçº¿ç¨‹å¯¹è±¡çš„<br />startæ–¹æ³•åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœè°ƒç”¨äº†å¤šæ¬¡ä¼šå‡ºç°<br />IllegalThreadStateException</td></tr><tr><td>â€‹<code>run()</code>â€‹</td><td>æ–°çº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨çš„æ–¹æ³•</td><td>å¦‚æœåœ¨æ„é€  Thread å¯¹è±¡æ—¶ä¼ é€’äº† Runnable å‚æ•°ï¼Œåˆ™<br />çº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨ Runnable ä¸­çš„ run æ–¹æ³•ï¼Œå¦åˆ™é»˜<br />è®¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä½†å¯ä»¥åˆ›å»º Thread çš„å­ç±»å¯¹è±¡ï¼Œ<br />æ¥è¦†ç›–é»˜è®¤è¡Œä¸º</td></tr><tr><td>â€‹<code>join()</code>â€‹</td><td>ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ</td><td></td></tr><tr><td>â€‹<code>join(long n)</code>â€‹</td><td>ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸï¼Œ<br />æœ€å¤šç­‰å¾… n æ¯«ç§’</td><td></td></tr><tr><td>â€‹<code>getId()</code>â€‹</td><td>è·å–çº¿ç¨‹é•¿æ•´å‹çš„ id</td><td>id å”¯ä¸€</td></tr><tr><td>â€‹<code>getName()</code>â€‹</td><td>è·å–çº¿ç¨‹å</td><td></td></tr><tr><td>â€‹<code>setName(String name)</code>â€‹</td><td>ä¿®æ”¹çº¿ç¨‹å</td><td></td></tr><tr><td>â€‹<code>getPriority()</code>â€‹</td><td>è·å–çº¿ç¨‹ä¼˜å…ˆçº§</td><td></td></tr><tr><td>â€‹<code>setPriority(int priority)</code>â€‹</td><td>ä¿®æ”¹çº¿ç¨‹ä¼˜å…ˆçº§</td><td>Java ä¸­è§„å®šçº¿ç¨‹ä¼˜å…ˆçº§æ˜¯1~10 çš„æ•´æ•°ï¼Œè¾ƒå¤§çš„ä¼˜å…ˆçº§<br />èƒ½æé«˜è¯¥çº¿ç¨‹è¢« CPU è°ƒåº¦çš„æœºç‡</td></tr><tr><td>â€‹<code>getState()</code>â€‹</td><td>è·å–çº¿ç¨‹çŠ¶æ€</td><td>Java ä¸­çº¿ç¨‹çŠ¶æ€æ˜¯ç”¨ 6 ä¸ª enum è¡¨ç¤ºï¼Œåˆ†åˆ«ä¸ºï¼š<br />NEW, RUNNABLE, BLOCKED, WAITING,<br />TIMED_WAITING, TERMINATED</td></tr><tr><td>â€‹<code>interrupt()</code>â€‹</td><td>æ‰“æ–­çº¿ç¨‹</td><td>å¦‚æœè¢«æ‰“æ–­çº¿ç¨‹æ­£åœ¨ sleepï¼Œwaitï¼Œjoin ä¼šå¯¼è‡´è¢«<br />æ‰“æ–­çš„çº¿ç¨‹æŠ›å‡º InterruptedExceptionï¼Œå¹¶æ¸…é™¤<br />æ‰“æ–­æ ‡è®°ï¼›å¦‚æœæ‰“æ–­æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œåˆ™ä¼šè®¾ç½®<br />æ‰“æ–­æ ‡è®°ï¼›park çš„çº¿ç¨‹è¢«æ‰“æ–­ï¼Œä¹Ÿä¼šè®¾ç½®æ‰“æ–­æ ‡è®°</td></tr><tr><td><font color=Coral>interrupted()</font></td><td>åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­</td><td>ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®°</td></tr><tr><td>â€‹<code>isInterrupted()</code>â€‹</td><td>åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­</td><td>ä¸ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®°</td></tr><tr><td>â€‹<code>isAlive()</code>â€‹</td><td>åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å­˜æ´»</td><td></td></tr><tr><td>â€‹<code>isDaemon()</code>â€‹</td><td>åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯å®ˆæŠ¤çº¿ç¨‹</td><td></td></tr><tr><td>â€‹<code>setDaemon(boolean on)</code>â€‹</td><td>è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹</td><td></td></tr><tr><td><font color=Coral>currentThread()</font></td><td>è·å–å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹</td><td></td></tr><tr><td><font color=Coral>sleep(long n)</font></td><td>è®©å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ næ¯«ç§’ï¼Œ<br />ä¼‘çœ æ—¶è®©å‡º CPU çš„æ—¶é—´ç‰‡<br />ç»™å…¶å®ƒçº¿ç¨‹</td><td></td></tr><tr><td><font color=Coral>yield()</font></td><td>æç¤ºçº¿ç¨‹è°ƒåº¦å™¨è®©å‡ºå½“å‰çº¿ç¨‹<br />å¯¹ CPU çš„ä½¿ç”¨</td><td>ä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•å’Œè°ƒè¯•ï¼Œå®ƒçš„å…·ä½“çš„å®ç°ä¾èµ–äº<br />æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h4 id="å¸¸è§é¢è¯•é¢˜-1"><a href="#å¸¸è§é¢è¯•é¢˜-1" class="headerlink" title="å¸¸è§é¢è¯•é¢˜"></a>å¸¸è§é¢è¯•é¢˜</h4><blockquote><p>é¢è¯•é¢˜ï¼šnotify()å’ŒnotifyAll()æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></blockquote><ul><li>notifyAll:å”¤é†’æ‰€æœ‰waitçš„çº¿ç¨‹</li><li>notify:åªéšæœºå”¤é†’ä¸€ä¸ªwaitçº¿ç¨‹</li></ul><h5 id="wait-å’Œ-sleep"><a href="#wait-å’Œ-sleep" class="headerlink" title="wait å’Œ sleep"></a>wait å’Œ sleep</h5><blockquote><p>é¢è¯•é¢˜ï¼šåœ¨javaä¸­waitå’Œsleepæ–¹æ³•çš„ä¸åŒï¼Ÿ</p></blockquote><ul><li>å…±åŒç‚¹<ul><li>wait(),wait(long)å’Œsleep(long)çš„æ•ˆæœéƒ½æ˜¯è®©å½“å‰çº¿ç¨‹æš‚æ—¶æ”¾å¼ƒCPUçš„ä½¿ç”¨æƒï¼Œè¿›å…¥é˜»å¡çŠ¶æ€</li></ul></li><li>ä¸åŒç‚¹<ul><li>1.æ–¹æ³•å½’å±ä¸åŒ<ul><li>sleep(long)æ˜¯Threadçš„é™æ€æ–¹æ³•</li><li>è€Œwait(),wait(long)éƒ½æ˜¯Objectçš„æˆå‘˜æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰</li></ul></li><li>2ã€é†’æ¥æ—¶æœºä¸åŒ<ul><li>æ‰§è¡Œsleep(long)å’Œwait(long)çš„çº¿ç¨‹éƒ½ä¼šåœ¨ç­‰å¾…ç›¸åº”æ¯«ç§’åé†’æ¥</li><li>wait(long)å’Œwait0è¿˜å¯ä»¥è¢«notifyå”¤é†’ï¼Œwait()å¦‚æœä¸å”¤é†’å°±ä¸€ç›´ç­‰ä¸‹å»</li><li>å®ƒä»¬éƒ½å¯ä»¥è¢«æ‰“æ–­å”¤é†’</li></ul></li><li>3.é”ç‰¹æ€§ä¸åŒï¼ˆé‡ç‚¹ï¼‰<ul><li>waitæ–¹æ³•çš„è°ƒç”¨å¿…é¡»å…ˆè·å–waitå¯¹è±¡çš„é”ï¼Œè€Œsleepåˆ™æ— æ­¤é™åˆ¶</li><li>waitæ–¹æ³•æ‰§è¡Œåä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹è·å¾—è¯¥å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒcpu,ä½†ä½ ä»¬è¿˜å¯ä»¥ç”¨ï¼‰</li><li>è€Œsleepå¦‚æœåœ¨synchronizedä»£ç å—ä¸­æ‰§è¡Œï¼Œå¹¶ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒcpu,ä½ ä»¬ä¹Ÿç”¨ä¸äº†ï¼‰</li></ul></li></ul></li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WaitSleepExample</span> &#123;<br>    private <span class="hljs-keyword">static</span> final <span class="hljs-built_in">Object</span> LOCK = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>();<br><br>    public <span class="hljs-keyword">static</span> <span class="hljs-literal">void</span> main(<span class="hljs-built_in">String</span>[] args) &#123;<br>        <span class="hljs-regexp">// åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç­‰å¾…æ“ä½œ</span><br><span class="hljs-regexp">        Thread waitThread = new Thread(() -&gt; &#123;</span><br><span class="hljs-regexp">            synchronized (LOCK) &#123; //</span> å¿…é¡»åœ¨åŒæ­¥å—å†…è°ƒç”¨waitï¼Œè¿™è¡¨ç¤ºå¿…é¡»æŒæœ‰å¯¹è±¡çš„é”<br>                <span class="hljs-keyword">try</span> &#123;<br>                    System.out.println(<span class="hljs-string">&quot;Wait Thread: Holding lock, now wait&quot;</span>);<br>                    LOCK.wait(); <span class="hljs-regexp">// è°ƒç”¨waitæ–¹æ³•åï¼Œå½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾LOCKå¯¹è±¡ä¸Šçš„é”ï¼Œå¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€</span><br><span class="hljs-regexp">                    System.out.println(&quot;Wait Thread: Exited wait&quot;);</span><br><span class="hljs-regexp">                &#125; catch (InterruptedException e) &#123;</span><br><span class="hljs-regexp">                    e.printStackTrace();</span><br><span class="hljs-regexp">                &#125;</span><br><span class="hljs-regexp">            &#125;</span><br><span class="hljs-regexp">        &#125;);</span><br><span class="hljs-regexp"></span><br><span class="hljs-regexp">        //</span> åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç¡çœ æ“ä½œ<br>        Thread sleepThread = <span class="hljs-keyword">new</span> Thread<span class="hljs-function"><span class="hljs-params">(() -&gt; &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">            synchronized (LOCK) &#123; <span class="hljs-regexp">// è¿›å…¥åŒæ­¥å—ï¼ŒæŒæœ‰LOCKå¯¹è±¡çš„é”</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                try &#123;</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                    System.out.println(&quot;Sleep Thread: Holding lock, now sleep&quot;);</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                    Thread.sleep(1000); //</span> è°ƒç”¨sleepæ–¹æ³•ï¼Œä½†ä¸ä¼šé‡Šæ”¾LOCKå¯¹è±¡ä¸Šçš„é”</span></span><br><span class="hljs-params"><span class="hljs-function">                    System.out.println(<span class="hljs-string">&quot;Sleep Thread: Exited sleep&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">                    e.printStackTrace();</span></span><br><span class="hljs-params"><span class="hljs-function">                &#125;</span></span><br><span class="hljs-params"><span class="hljs-function">            &#125;</span></span><br><span class="hljs-params"><span class="hljs-function">        &#125;)</span>;</span><br><span class="hljs-function"></span><br><span class="hljs-function">        // åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œé€šçŸ¥æ“ä½œ</span><br><span class="hljs-function">        <span class="hljs-title">Thread</span> <span class="hljs-title">notifyThread</span> = <span class="hljs-title">new</span> <span class="hljs-title">Thread</span><span class="hljs-params">(() -&gt; &#123;</span></span><br><span class="hljs-params"><span class="hljs-function">            synchronized (LOCK) &#123; <span class="hljs-regexp">// è¿›å…¥åŒæ­¥å—ï¼ŒæŒæœ‰LOCKå¯¹è±¡çš„é”</span></span></span><br><span class="hljs-regexp"><span class="hljs-params"><span class="hljs-function">                //</span> å‘é€é€šçŸ¥ï¼Œå‘Šè¯‰ç­‰å¾…åœ¨LOCKå¯¹è±¡ä¸Šçš„çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œ</span></span><br><span class="hljs-params"><span class="hljs-function">                LOCK.notifyAll();</span></span><br><span class="hljs-params"><span class="hljs-function">                System.out.println(<span class="hljs-string">&quot;Notify Thread: Sent notification&quot;</span>);</span></span><br><span class="hljs-params"><span class="hljs-function">            &#125;</span></span><br><span class="hljs-params"><span class="hljs-function">        &#125;)</span>;</span><br><span class="hljs-function"></span><br><span class="hljs-function">        <span class="hljs-title">waitThread</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>; // å¯åŠ¨ç­‰å¾…çº¿ç¨‹</span><br><span class="hljs-function">        <span class="hljs-title">try</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">Thread</span>.<span class="hljs-title">sleep</span><span class="hljs-params">(<span class="hljs-number">500</span>)</span>; // ç¡®ä¿<span class="hljs-title">waitThread</span>å…ˆæ‰§è¡Œ</span><br><span class="hljs-function">        &#125; <span class="hljs-title">catch</span> <span class="hljs-params">(InterruptedException e)</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">e</span>.<span class="hljs-title">printStackTrace</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">        &#125;</span><br><span class="hljs-function">        <span class="hljs-title">sleepThread</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>; // å¯åŠ¨ç¡çœ çº¿ç¨‹</span><br><span class="hljs-function">        <span class="hljs-title">try</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">Thread</span>.<span class="hljs-title">sleep</span><span class="hljs-params">(<span class="hljs-number">500</span>)</span>; // ç¡®ä¿<span class="hljs-title">sleepThread</span>æœ‰æœºä¼šæ‰§è¡Œ</span><br><span class="hljs-function">        &#125; <span class="hljs-title">catch</span> <span class="hljs-params">(InterruptedException e)</span> &#123;</span><br><span class="hljs-function">            <span class="hljs-title">e</span>.<span class="hljs-title">printStackTrace</span><span class="hljs-params">()</span>;</span><br><span class="hljs-function">        &#125;</span><br><span class="hljs-function">        <span class="hljs-title">notifyThread</span>.<span class="hljs-title">start</span><span class="hljs-params">()</span>; // å¯åŠ¨é€šçŸ¥çº¿ç¨‹</span><br><span class="hljs-function">    &#125;</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><ul><li><strong>å…³äºé”çš„ä¸åŒå¤„ç†</strong>ï¼š<ul><li><strong><code>wait()</code>æ–¹æ³•</strong>ï¼šè°ƒç”¨<code>wait()</code>æ—¶ï¼Œçº¿ç¨‹å¿…é¡»æŒæœ‰å¯¹è±¡çš„é”ï¼ˆè¿™æ˜¯é€šè¿‡åœ¨<code>synchronized</code>å—å†…è°ƒç”¨<code>wait()</code>æ¥ä¿è¯çš„ï¼‰ã€‚ä¸€æ—¦<code>wait()</code>è¢«è°ƒç”¨ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾è¿™ä¸ªå¯¹è±¡ä¸Šçš„é”ï¼Œå…è®¸å…¶ä»–çº¿ç¨‹è·å–è¿™ä¸ªé”ã€‚å½“å…¶ä»–çº¿ç¨‹åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨<code>notify()</code>æˆ–<code>notifyAll()</code>æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹æ‰æœ‰æœºä¼šé‡æ–°è·å–é”å¹¶ç»§ç»­æ‰§è¡Œã€‚</li><li><strong><code>sleep()</code>æ–¹æ³•</strong>ï¼šä¸<code>wait()</code>ä¸åŒï¼Œè°ƒç”¨<code>sleep()</code>æ—¶çº¿ç¨‹ä¸ä¼šé‡Šæ”¾ä»»ä½•æŒæœ‰çš„é”ã€‚å³ä½¿æ˜¯åœ¨<code>synchronized</code>å—å†…è°ƒç”¨<code>sleep()</code>ï¼Œå½“å‰çº¿ç¨‹ä»ç„¶ä¼šä¿æŒå¯¹é”çš„æŒæœ‰ï¼Œç›´åˆ°<code>sleep()</code>å®Œæˆã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰æŸä¸ªå¯¹è±¡é”çš„åŒæ—¶è°ƒç”¨äº†<code>sleep()</code>ï¼Œå…¶ä»–æƒ³è¦è®¿é—®è¿™ä¸ªåŒæ­¥å—çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°ç¡çœ çº¿ç¨‹é†’æ¥å¹¶é€€å‡ºåŒæ­¥å—ï¼Œé‡Šæ”¾é”ã€‚</li></ul></li></ul><p>â†’  ä½¿ç”¨ sleep çš„æ—¶å€™åŒæ­¥å—ä»£ç çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚</p><h3 id="6ã€Synchronized-å’Œ-Lock-çš„ä½¿ç”¨"><a href="#6ã€Synchronized-å’Œ-Lock-çš„ä½¿ç”¨" class="headerlink" title="6ã€Synchronized å’Œ Lock çš„ä½¿ç”¨"></a>6ã€Synchronized å’Œ Lock çš„ä½¿ç”¨</h3><p>å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œé”æ˜¯ç»å¸¸éœ€è¦ç”¨åˆ°çš„ã€‚è¿™é‡Œè®²è¿°ä¸€ä¸‹ Synchronized å’Œ Lock çš„ä½¿ç”¨ã€‚</p><p>Synchronized æ˜¯ Java å¹¶å‘ç¼–ç¨‹ ä¸­å¾ˆé‡è¦çš„å…³é”®å­—ï¼Œå¦å¤–ä¸€ä¸ªå¾ˆé‡è¦çš„æ˜¯ volatileã€‚</p><p>Syncronized çš„ç›®çš„æ˜¯ä¸€æ¬¡<strong>åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ç”±ä»–ä¿®é¥°çš„ä»£ç æ®µ</strong>ï¼Œä»è€Œå…è®¸ä»–ä»¬è¿›è¡Œè‡ªæˆ‘ä¿æŠ¤ã€‚</p><p>Lock æ˜¯ Javaå¹¶å‘ç¼–ç¨‹ä¸­<strong>å¾ˆé‡è¦çš„ä¸€ä¸ªæ¥å£</strong>ï¼Œå®ƒè¦æ¯” Synchronized å…³é”®å­—æ›´èƒ½ç›´è¯‘â€é”â€çš„æ¦‚å¿µï¼ŒLockéœ€è¦<strong>æ‰‹åŠ¨åŠ é”å’Œæ‰‹åŠ¨è§£é”</strong>ï¼Œä¸€èˆ¬é€šè¿‡ lock.lock() æ–¹æ³•æ¥è¿›è¡ŒåŠ é”ï¼Œ é€šè¿‡ lock.unlock() æ–¹æ³•è¿›è¡Œè§£é”ã€‚ä¸ Lock å…³è”å¯†åˆ‡çš„é”æœ‰ ReetrantLock å’Œ ReadWriteLockã€‚</p><h4 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a>Synchronized</h4><blockquote><p>åœ¨æ–¹æ³•ä¸Šä½¿ç”¨ Synchronized</p></blockquote><p>æ–¹æ³•å£°æ˜æ—¶ä½¿ç”¨ï¼Œæ”¾åœ¨èŒƒå›´æ“ä½œç¬¦ä¹‹å,è¿”å›ç±»å‹å£°æ˜ä¹‹å‰ã€‚å³ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è¯¥æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹è¦æƒ³åœ¨æ­¤æ—¶è°ƒç”¨è¯¥æ–¹æ³•ï¼Œåªèƒ½æ’é˜Ÿç­‰å€™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> number;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">numIncrease</span><span class="hljs-params">()</span>&#123;<br>  number++;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>åœ¨æŸä¸ªä»£ç æ®µä½¿ç”¨ Synchronized</p></blockquote><p>å¯ä»¥åœ¨æŸä¸ªä»£ç å—ä¸Šä½¿ç”¨ Synchronized å…³é”®å­—ï¼Œè¡¨ç¤ºåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æŸä¸ªä»£ç æ®µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">numDecrease</span><span class="hljs-params">(Object num)</span>&#123;<br>  <span class="hljs-keyword">synchronized</span> (num)&#123;<br>    number++;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨ Synchronized é”ä½æ•´ä¸ªå¯¹è±¡</p></blockquote><p>synchronizedåé¢æ‹¬å·é‡Œæ˜¯ä¸€å¯¹è±¡ï¼Œæ­¤æ—¶çº¿ç¨‹è·å¾—çš„æ˜¯å¯¹è±¡é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>    <span class="hljs-comment">// ...</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h4><p>Lock æ˜¯ Javaå¹¶å‘ç¼–ç¨‹ä¸­<strong>å¾ˆé‡è¦çš„ä¸€ä¸ªæ¥å£</strong>ï¼Œç›¸å…³æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lock</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span>;<br>    Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨æ–¹æ³•</p><ul><li>lock()<ul><li>ç”¨æ¥è·å–é”ã€‚å¦‚æœé”è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œåˆ™è¿›è¡Œç­‰å¾…ã€‚</li><li>å¦‚æœé‡‡ç”¨Lockï¼Œå¿…é¡»ä¸»åŠ¨å»é‡Šæ”¾é”ï¼Œå¹¶ä¸”åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”</li></ul></li><li>tryLock()<ul><li>æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå®ƒè¡¨ç¤ºç”¨æ¥å°è¯•è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å›trueï¼Œå¦‚æœè·å–å¤±è´¥ï¼ˆå³é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰ï¼Œåˆ™è¿”å›falseï¼Œ</li><li>è¿™ä¸ªæ–¹æ³•æ— è®ºå¦‚ä½•éƒ½ä¼šç«‹å³è¿”å›ã€‚åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¸ä¼šä¸€ç›´ç­‰å¾…ã€‚</li></ul></li><li>tryLock(long time, TimeUnit unit)<ul><li>å’ŒtryLock()æ–¹æ³•æ˜¯ç±»ä¼¼</li><li>åœ¨æ‹¿ä¸åˆ°é”æ—¶<strong>ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´</strong>ï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜æ‹¿ä¸åˆ°é”ï¼Œå°±è¿”å›falseã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å›trueã€‚</li></ul></li><li>lockInterruptibly()<ul><li>å»è·å–é”æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–é”ï¼Œåˆ™è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼Œå³<strong>ä¸­æ–­çº¿ç¨‹çš„ç­‰å¾…çŠ¶æ€</strong>ã€‚</li><li>å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ lock.lockInterruptibly() æƒ³è·å–æŸä¸ªé”æ—¶ï¼Œå‡è‹¥æ­¤æ—¶çº¿ç¨‹Aè·å–åˆ°äº†é”ï¼Œè€Œçº¿ç¨‹Båªæœ‰åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå¯¹çº¿ç¨‹Bè°ƒç”¨ threadB.interrupt() æ–¹æ³•èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹Bçš„ç­‰å¾…è¿‡ç¨‹ã€‚</li><li>ç”±äº lockInterruptibly() çš„å£°æ˜ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰€ä»¥ lock.lockInterruptibly() å¿…é¡»æ”¾åœ¨tryå—ä¸­æˆ–è€…åœ¨è°ƒç”¨lockInterruptibly() çš„æ–¹æ³•å¤–å£°æ˜æŠ›å‡º InterruptedExceptionã€‚</li></ul></li></ul><blockquote><p>ä»£ç ç¤ºä¾‹ï¼š</p></blockquote><p>lock()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> ...;<br>lock.lock();<br><span class="hljs-keyword">try</span>&#123;<br>    <span class="hljs-comment">//å¤„ç†ä»»åŠ¡</span><br>&#125;<span class="hljs-keyword">catch</span>(Exception ex)&#123;<br>     <br>&#125;<span class="hljs-keyword">finally</span>&#123;<br>    lock.unlock();   <span class="hljs-comment">//é‡Šæ”¾é”</span><br>&#125;<br></code></pre></td></tr></table></figure><p>tryLock()</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Lock</span> lock = ...;<br><span class="hljs-keyword">if</span>(lock.<span class="hljs-title function_">tryLock</span>()) &#123;<br>     <span class="hljs-keyword">try</span>&#123;<br>         <span class="hljs-comment">//å¤„ç†ä»»åŠ¡</span><br>     &#125;<span class="hljs-keyword">catch</span>(<span class="hljs-title class_">Exception</span> ex)&#123;<br>         <br>     &#125;<span class="hljs-keyword">finally</span>&#123;<br>         lock.<span class="hljs-title function_">unlock</span>();   <span class="hljs-comment">//é‡Šæ”¾é”</span><br>     &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-comment">//å¦‚æœä¸èƒ½è·å–é”ï¼Œåˆ™ç›´æ¥åšå…¶ä»–äº‹æƒ…</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>lockInterruptibly()</strong> </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript">public <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span>() throws <span class="hljs-title class_">InterruptedException</span> &#123;<br>    lock.<span class="hljs-title function_">lockInterruptibly</span>();<br>    <span class="hljs-keyword">try</span> &#123;<br>     <span class="hljs-comment">//.....</span><br>    &#125;<br>    <span class="hljs-keyword">finally</span> &#123;<br>        lock.<span class="hljs-title function_">unlock</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨Lockå¿…é¡»åœ¨try{}catch{}å—ä¸­è¿›è¡Œï¼Œå¹¶ä¸”å°†<strong>é‡Šæ”¾é”çš„æ“ä½œæ”¾åœ¨finallyå—ä¸­è¿›è¡Œ</strong>ï¼Œä»¥ä¿è¯é”ä¸€å®šè¢«è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚</p><blockquote><p>æ³¨æ„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”ä¹‹åï¼Œæ˜¯ä¸ä¼šè¢«interrupt()æ–¹æ³•ä¸­æ–­çš„ã€‚<br>å•ç‹¬è°ƒç”¨ interrupt() æ–¹æ³•ä¸èƒ½ä¸­æ–­æ­£åœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„çº¿ç¨‹ï¼Œåªèƒ½<strong>ä¸­æ–­é˜»å¡è¿‡ç¨‹ä¸­çš„çº¿ç¨‹</strong>ã€‚å› æ­¤å½“é€šè¿‡lockInterruptibly()æ–¹æ³•è·å–æŸä¸ªé”æ—¶ï¼Œå¦‚æœä¸èƒ½è·å–åˆ°ï¼Œ<strong>åªæœ‰è¿›è¡Œç­‰å¾…çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¯ä»¥å“åº”ä¸­æ–­çš„</strong>ã€‚<br>è€Œ<strong>ç”¨synchronizedä¿®é¥°çš„è¯</strong>ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å¤„äºç­‰å¾…æŸä¸ªé”çš„çŠ¶æ€ï¼Œæ˜¯æ— æ³•è¢«ä¸­æ–­çš„ï¼Œåªæœ‰ä¸€ç›´ç­‰å¾…ä¸‹å»ã€‚</p></blockquote><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://javaguide.cn/java/concurrent/java-concurrent-questions-01.html">https://javaguide.cn/java/concurrent/java-concurrent-questions-01.html</a></li><li><a href="https://www.cnblogs.com/fmgao-technology/p/11077543.html">https://www.cnblogs.com/fmgao-technology/p/11077543.html</a></li><li><a href="https://caochenlei.blog.csdn.net/article/details/119992847">https://caochenlei.blog.csdn.net/article/details/119992847</a></li><li><a href="https://cloud.tencent.com/developer/article/1497476">https://cloud.tencent.com/developer/article/1497476</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>Thread</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>thread</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaé›†åˆ_HashMapå­¦ä¹ </title>
    <link href="/2023/11/15/Java%E9%9B%86%E5%90%88_HashMap%E5%AD%A6%E4%B9%A0/"/>
    <url>/2023/11/15/Java%E9%9B%86%E5%90%88_HashMap%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<p>å°† HashMap çš„ç›¸å…³å†…å®¹å•ç‹¬æ‹¿å‡ºæ¥è®²ä¸€ä¸‹</p><h3 id="1ã€åŸºç¡€æ¦‚å¿µ"><a href="#1ã€åŸºç¡€æ¦‚å¿µ" class="headerlink" title="1ã€åŸºç¡€æ¦‚å¿µ"></a>1ã€åŸºç¡€æ¦‚å¿µ</h3><p>HashMap ä¸»è¦ç”¨æ¥å­˜æ”¾é”®å€¼å¯¹ï¼ŒåŸºäºå“ˆå¸Œè¡¨çš„ Map æ¥å£å®ç°ï¼Œæ˜¯å¸¸ç”¨çš„ Java é›†åˆä¹‹ä¸€ã€‚</p><p>HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚</p><p>å®ƒå¯ä»¥å­˜å‚¨ null çš„ key å’Œ valueï¼Œä½† null ä½œä¸ºé”®åªèƒ½æœ‰ä¸€ä¸ªï¼Œnull ä½œä¸ºå€¼å¯ä»¥æœ‰å¤šä¸ª</p><p><strong>åº•å±‚æ•°æ®ç»“æ„</strong>ï¼š</p><ul><li>JDK1.8 ä¹‹å‰ HashMap ç”± æ•°ç»„+é“¾è¡¨ ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€è§£å†³å†²çªï¼‰ã€‚</li><li>JDK1.8 ä»¥åçš„ <code>HashMap</code> åœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºç­‰äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚</li></ul><p><strong>æ‰©å……æœºåˆ¶</strong>ï¼š<code>HashMap</code> é»˜è®¤çš„åˆå§‹åŒ–å¤§å°ä¸º 16ã€‚ä¹‹åæ¯æ¬¡æ‰©å……ï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„ 2 å€ã€‚å¹¶ä¸”ï¼Œ <code>HashMap</code> æ€»æ˜¯ä½¿ç”¨ 2 çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°ã€‚</p><blockquote><p>HashMapçš„å¸¸ç”¨æ–¹æ³•</p></blockquote><ul><li>1ã€put(K key, V value)ï¼š å°†é”®ï¼ˆkeyï¼‰&#x2F;å€¼ï¼ˆvalueï¼‰æ˜ å°„å­˜æ”¾åˆ°Mapé›†åˆä¸­ã€‚</li><li>2ã€get(Object key)ï¼š è¿”å›æŒ‡å®šé”®æ‰€æ˜ å°„çš„å€¼ï¼Œæ²¡æœ‰è¯¥keyå¯¹åº”çš„å€¼åˆ™è¿”å› nullã€‚</li><li>3ã€size()ï¼š è¿”å›Mapé›†åˆä¸­æ•°æ®æ•°é‡ã€‚</li><li>4ã€clear()ï¼š æ¸…ç©ºMapé›†åˆã€‚</li><li>5ã€isEmpty()ï¼š åˆ¤æ–­Mapé›†åˆä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</li><li>6ã€remove(Object key)ï¼š åˆ é™¤Mapé›†åˆä¸­é”®ä¸ºkeyçš„æ•°æ®å¹¶è¿”å›å…¶æ‰€å¯¹åº”valueå€¼ã€‚</li><li>7ã€values()ï¼š è¿”å›Mapé›†åˆä¸­æ‰€æœ‰valueç»„æˆçš„ä»¥Collectionæ•°æ®ç±»å‹æ ¼å¼æ•°æ®ã€‚</li><li>8ã€containsKey(Object key)ï¼š åˆ¤æ–­é›†åˆä¸­æ˜¯å¦åŒ…å«æŒ‡å®šé”®ï¼ŒåŒ…å«è¿”å› trueï¼Œå¦åˆ™è¿”å›falseã€‚</li><li>9ã€containsValue(Object value)ï¼š åˆ¤æ–­é›†åˆä¸­æ˜¯å¦åŒ…å«æŒ‡å®šå€¼ï¼ŒåŒ…å«è¿”å› trueï¼Œå¦åˆ™è¿”å›falseã€‚</li><li>10ã€keySet()ï¼š è¿”å›Mapé›†åˆä¸­æ‰€æœ‰keyç»„æˆçš„Seté›†åˆã€‚</li><li>11ã€entrySet()ï¼š å°†Mapé›†åˆæ¯ä¸ªkey-valueè½¬æ¢ä¸ºä¸€ä¸ªEntryå¯¹è±¡å¹¶è¿”å›ç”±æ‰€æœ‰çš„Entryå¯¹è±¡ç»„æˆçš„Seté›†åˆã€‚</li></ul><blockquote><p>HashMap å¸¸ç”¨æ–¹æ³•æµ‹è¯•</p></blockquote><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs sas">package map;<br><br>import java.util.Collection;<br>import java.util.HashMap;<br>import java.util.<span class="hljs-keyword">Set</span>;<br><br>public class HashMapDemo &#123;<br><br>    public static void mai<span class="hljs-meta">n</span>(String[] args) &#123;<br>        HashMap&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();<br>        // é”®ä¸èƒ½é‡å¤ï¼Œå€¼å¯ä»¥é‡å¤<br>        map.<span class="hljs-meta">put</span>(<span class="hljs-string">&quot;san&quot;</span>, <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);<br>        map.<span class="hljs-meta">put</span>(<span class="hljs-string">&quot;si&quot;</span>, <span class="hljs-string">&quot;æå››&quot;</span>);<br>        map.<span class="hljs-meta">put</span>(<span class="hljs-string">&quot;wu&quot;</span>, <span class="hljs-string">&quot;ç‹äº”&quot;</span>);<br>        map.<span class="hljs-meta">put</span>(<span class="hljs-string">&quot;wang&quot;</span>, <span class="hljs-string">&quot;è€ç‹&quot;</span>);<br>        map.<span class="hljs-meta">put</span>(<span class="hljs-string">&quot;wang&quot;</span>, <span class="hljs-string">&quot;è€ç‹2&quot;</span>);// è€ç‹è¢«è¦†ç›–<br>        map.<span class="hljs-meta">put</span>(<span class="hljs-string">&quot;lao&quot;</span>, <span class="hljs-string">&quot;è€ç‹&quot;</span>);<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;-------ç›´æ¥è¾“å‡ºhashmap:-------&quot;</span>);<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(map);<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * éå†HashMap</span><br><span class="hljs-comment">         */</span><br>        // 1.è·å–Mapä¸­çš„æ‰€æœ‰é”®<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;-------foreachè·å–Mapä¸­æ‰€æœ‰çš„é”®:------&quot;</span>);<br>        <span class="hljs-keyword">Set</span>&lt;String&gt; keys = map.keySet();<br>        for (String <span class="hljs-keyword">key</span> : keys) &#123;<br>            System.<span class="hljs-keyword">out</span>.pr<span class="hljs-meta">int</span>(<span class="hljs-keyword">key</span>+<span class="hljs-string">&quot;  &quot;</span>);<br>        &#125;<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>();//æ¢è¡Œ<br>        // 2.è·å–Mapä¸­æ‰€æœ‰å€¼<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;-------foreachè·å–Mapä¸­æ‰€æœ‰çš„å€¼:------&quot;</span>);<br>        Collection&lt;String&gt; values = map.values();<br>        for (String value : values) &#123;<br>            System.<span class="hljs-keyword">out</span>.pr<span class="hljs-meta">int</span>(value+<span class="hljs-string">&quot;  &quot;</span>);<br>        &#125;<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>();//æ¢è¡Œ<br>        // 3.å¾—åˆ°<span class="hljs-keyword">key</span>çš„å€¼çš„åŒæ—¶å¾—åˆ°<span class="hljs-keyword">key</span>æ‰€å¯¹åº”çš„å€¼<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;-------å¾—åˆ°keyçš„å€¼çš„åŒæ—¶å¾—åˆ°keyæ‰€å¯¹åº”çš„å€¼:-------&quot;</span>);<br>        <span class="hljs-keyword">Set</span>&lt;String&gt; keys2 = map.keySet();<br>        for (String <span class="hljs-keyword">key</span> : keys2) &#123;<br>            System.<span class="hljs-keyword">out</span>.pr<span class="hljs-meta">int</span>(<span class="hljs-keyword">key</span> + <span class="hljs-string">&quot;ï¼š&quot;</span> + map.get(<span class="hljs-keyword">key</span>)+<span class="hljs-string">&quot;   &quot;</span>);<br><br>        &#125;<br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * å¦‚æœæ—¢è¦éå†keyåˆè¦valueï¼Œé‚£ä¹ˆå»ºè®®è¿™ç§æ–¹å¼ï¼Œå› ä¸ºå¦‚æœå…ˆè·å–keySetç„¶åå†æ‰§è¡Œmap.get(key)ï¼Œmapå†…éƒ¨ä¼šæ‰§è¡Œä¸¤æ¬¡éå†ã€‚</span><br><span class="hljs-comment">         * ä¸€æ¬¡æ˜¯åœ¨è·å–keySetçš„æ—¶å€™ï¼Œä¸€æ¬¡æ˜¯åœ¨éå†æ‰€æœ‰keyçš„æ—¶å€™ã€‚</span><br><span class="hljs-comment">         */</span><br>        // å½“æˆ‘è°ƒç”¨<span class="hljs-meta">put</span>(<span class="hljs-keyword">key</span>,value)æ–¹æ³•çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šæŠŠ<span class="hljs-keyword">key</span>å’Œvalueå°è£…åˆ°<br>        // Entryè¿™ä¸ªé™æ€å†…éƒ¨ç±»å¯¹è±¡ä¸­ï¼ŒæŠŠEntryå¯¹è±¡å†æ·»åŠ åˆ°æ•°ç»„ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³è·å–<br>        // mapä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œæˆ‘ä»¬åªè¦è·å–æ•°ç»„ä¸­çš„æ‰€æœ‰Entryå¯¹è±¡ï¼Œæ¥ä¸‹æ¥<br>        // è°ƒç”¨Entryå¯¹è±¡ä¸­çš„getKey()å’ŒgetValue()æ–¹æ³•å°±èƒ½è·å–é”®å€¼å¯¹äº†<br>        <span class="hljs-keyword">Set</span>&lt;java.util.Map.Entry&lt;String, String&gt;&gt; entrys = map.entrySet();<br>        for (java.util.Map.Entry&lt;String, String&gt; entry : entrys) &#123;<br>            System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(entry.getKey() + <span class="hljs-string">&quot;--&quot;</span> + entry.getValue());<br>        &#125;<br><br>        <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * HashMapå…¶ä»–å¸¸ç”¨æ–¹æ³•</span><br><span class="hljs-comment">         */</span><br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;after map.size()ï¼š&quot;</span>+map.size());<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;after map.isEmpty()ï¼š&quot;</span>+map.isEmpty());<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(map.<span class="hljs-keyword">remove</span>(<span class="hljs-string">&quot;san&quot;</span>));<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;after map.remove()ï¼š&quot;</span>+map);<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;after map.get(si)ï¼š&quot;</span>+map.get(<span class="hljs-string">&quot;si&quot;</span>));<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;after map.containsKey(si)ï¼š&quot;</span>+map.containsKey(<span class="hljs-string">&quot;si&quot;</span>));<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;after containsValue(æå››)ï¼š&quot;</span>+map.containsValue(<span class="hljs-string">&quot;æå››&quot;</span>));<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(map.<span class="hljs-keyword">replace</span>(<span class="hljs-string">&quot;si&quot;</span>, <span class="hljs-string">&quot;æå››2&quot;</span>));<br>        System.<span class="hljs-keyword">out</span>.printl<span class="hljs-meta">n</span>(<span class="hljs-string">&quot;after map.replace(si, æå››2):&quot;</span>+map);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€åº•å±‚æ•°æ®ç»“æ„"><a href="#2ã€åº•å±‚æ•°æ®ç»“æ„" class="headerlink" title="2ã€åº•å±‚æ•°æ®ç»“æ„"></a>2ã€åº•å±‚æ•°æ®ç»“æ„</h3><h4 id="JDK1-8-ä¹‹å‰"><a href="#JDK1-8-ä¹‹å‰" class="headerlink" title="JDK1.8 ä¹‹å‰"></a>JDK1.8 ä¹‹å‰</h4><p>JDK1.8 ä¹‹å‰ HashMap åº•å±‚æ˜¯ <strong>æ•°ç»„å’Œé“¾è¡¨</strong> ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼ˆ <strong>é“¾è¡¨æ•£åˆ—</strong>ï¼‰ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231115224010.png" alt="image.png"></p><p>HashMap é€šè¿‡ key çš„ hashCode ç»è¿‡æ‰°åŠ¨å‡½æ•°å¤„ç†è¿‡åå¾—åˆ° hash å€¼ï¼Œç„¶åé€šè¿‡ <code>(n - 1) &amp; hash</code> åˆ¤æ–­å½“å‰å…ƒç´ å­˜æ”¾çš„ä½ç½®ï¼ˆè¿™é‡Œçš„ n æŒ‡çš„æ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ï¼Œå¦‚æœå½“å‰ä½ç½®å­˜åœ¨å…ƒç´ çš„è¯ï¼Œå°±åˆ¤æ–­è¯¥å…ƒç´ ä¸è¦å­˜å…¥çš„å…ƒç´ çš„ hash å€¼ä»¥åŠ key æ˜¯å¦ç›¸åŒï¼Œ<strong>å¦‚æœç›¸åŒçš„è¯ï¼Œç›´æ¥è¦†ç›–</strong>ï¼Œä¸ç›¸åŒå°±é€šè¿‡æ‹‰é“¾æ³•è§£å†³å†²çªã€‚</p><p>æ‰€è°“æ‰°åŠ¨å‡½æ•°æŒ‡çš„å°±æ˜¯ HashMap çš„ hash æ–¹æ³•ã€‚</p><p>ä½¿ç”¨ hash æ–¹æ³•ï¼ˆæ‰°åŠ¨å‡½æ•°ï¼‰æ˜¯ä¸ºäº†é˜²æ­¢ä¸€äº›å®ç°æ¯”è¾ƒå·®çš„ hashCode() æ–¹æ³• ï¼Œä½¿ç”¨æ‰°åŠ¨å‡½æ•°ä¹‹åå¯ä»¥å‡å°‘ç¢°æ’ã€‚</p><p>æ‰€è°“ <strong>â€œæ‹‰é“¾æ³•â€</strong> æ˜¯ï¼šå°†é“¾è¡¨å’Œæ•°ç»„ç›¸ç»“åˆã€‚ä¹Ÿå°±æ˜¯è¯´åˆ›å»ºä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œ<strong>æ•°ç»„ä¸­æ¯ä¸€æ ¼å°±æ˜¯ä¸€ä¸ªé“¾è¡¨</strong>ã€‚è‹¥é‡åˆ°å“ˆå¸Œå†²çªï¼Œåˆ™å°†å†²çªçš„å€¼åŠ åˆ°é“¾è¡¨ä¸­å³å¯ã€‚</p><p><strong>hash æ–¹æ³•</strong></p><p>JDK 1.8 HashMap çš„ hash æ–¹æ³•æºç :</p><p>JDK 1.8 çš„ hash æ–¹æ³• ç›¸æ¯”äº JDK 1.7 hash æ–¹æ³•æ›´åŠ ç®€åŒ–ï¼Œä½†æ˜¯åŸç†ä¸å˜</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs processing">  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span>(<span class="hljs-built_in">Object</span> <span class="hljs-built_in">key</span>) &#123;<br>    <span class="hljs-type">int</span> h;<br>    <span class="hljs-comment">// key.hashCode()ï¼šè¿”å›æ•£åˆ—å€¼ä¹Ÿå°±æ˜¯hashcode</span><br>    <span class="hljs-comment">// ^ï¼šæŒ‰ä½å¼‚æˆ–</span><br>    <span class="hljs-comment">// &gt;&gt;&gt;:æ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½</span><br>    <span class="hljs-title function_">return</span> (<span class="hljs-built_in">key</span> == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : (h = <span class="hljs-built_in">key</span>.<span class="hljs-property">hashCode</span>()) ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p> JDK1.7 çš„ HashMap çš„ hash æ–¹æ³•æºç .</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">hash</span><span class="hljs-params">(<span class="hljs-type">int</span> h)</span> </span>&#123;<br>    <span class="hljs-comment">// This function ensures that hashCodes that differ only by</span><br>    <span class="hljs-comment">// constant multiples at each bit position have a bounded</span><br>    <span class="hljs-comment">// number of collisions (approximately 8 at default load factor).</span><br><br>    h ^= (h &gt;&gt;&gt; <span class="hljs-number">20</span>) ^ (h &gt;&gt;&gt; <span class="hljs-number">12</span>);<br>    <span class="hljs-keyword">return</span> h ^ (h &gt;&gt;&gt; <span class="hljs-number">7</span>) ^ (h &gt;&gt;&gt; <span class="hljs-number">4</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›¸æ¯”äº JDK1.8 çš„ hash æ–¹æ³• ï¼ŒJDK 1.7 çš„ hash æ–¹æ³•çš„æ€§èƒ½ç¨å·®ä¸€ç‚¹ï¼Œå› ä¸ºæ¯•ç«Ÿæ‰°åŠ¨äº† 4 æ¬¡ã€‚</p><h4 id="JDK1-8-ä¹‹å"><a href="#JDK1-8-ä¹‹å" class="headerlink" title="JDK1.8 ä¹‹å"></a>JDK1.8 ä¹‹å</h4><p>å½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰æ—¶ï¼Œä¼šé¦–å…ˆè°ƒç”¨ <code>treeifyBin()</code>æ–¹æ³•ã€‚</p><p>è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ® HashMap æ•°ç»„æ¥å†³å®šæ˜¯å¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚åªæœ‰å½“æ•°ç»„é•¿åº¦å¤§äºæˆ–è€…ç­‰äº 64 çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šæ‰§è¡Œè½¬æ¢çº¢é»‘æ ‘æ“ä½œï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚</p><p>å¦åˆ™ï¼Œå°±æ˜¯åªæ˜¯æ‰§è¡Œ <code>resize()</code> æ–¹æ³•å¯¹æ•°ç»„æ‰©å®¹ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231115223309.png" alt="image.png"></p><h4 id="HashMap-çš„ç±»å±æ€§"><a href="#HashMap-çš„ç±»å±æ€§" class="headerlink" title="HashMap çš„ç±»å±æ€§"></a>HashMap çš„ç±»å±æ€§</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-symbol">HashMap</span>&lt;<span class="hljs-symbol">K,<span class="hljs-symbol">V</span></span>&gt; <span class="hljs-symbol">extends</span> <span class="hljs-symbol">AbstractMap</span>&lt;<span class="hljs-symbol">K,<span class="hljs-symbol">V</span></span>&gt; <span class="hljs-symbol">implements</span> <span class="hljs-symbol">Map</span>&lt;<span class="hljs-symbol">K,<span class="hljs-symbol">V</span></span>&gt;, <span class="hljs-symbol">Cloneable, <span class="hljs-symbol">Serializable</span></span> &#123;<br>    <span class="hljs-comment">// åºåˆ—å·</span><br>    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> long serialVersionUID = <span class="hljs-number">362498820763181265</span>L;<br>    <span class="hljs-comment">// é»˜è®¤çš„åˆå§‹å®¹é‡æ˜¯16</span><br>    static <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> DEFAULT_INITIAL_CAPACITY = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">4</span>;<br>    <span class="hljs-comment">// æœ€å¤§å®¹é‡</span><br>    static <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> MAXIMUM_CAPACITY = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>;<br>    <span class="hljs-comment">// é»˜è®¤çš„è´Ÿè½½å› å­</span><br>    static <span class="hljs-keyword">final</span> <span class="hljs-built_in">float</span> DEFAULT_LOAD_FACTOR = <span class="hljs-number">0.75f</span>;<br>    <span class="hljs-comment">// å½“æ¡¶(bucket)ä¸Šçš„ç»“ç‚¹æ•°å¤§äºç­‰äºè¿™ä¸ªå€¼æ—¶ä¼šè½¬æˆçº¢é»‘æ ‘</span><br>    static <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> TREEIFY_THRESHOLD = <span class="hljs-number">8</span>;<br>    <span class="hljs-comment">// å½“æ¡¶(bucket)ä¸Šçš„ç»“ç‚¹æ•°å°äºç­‰äºè¿™ä¸ªå€¼æ—¶æ ‘è½¬é“¾è¡¨</span><br>    static <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> UNTREEIFY_THRESHOLD = <span class="hljs-number">6</span>;<br>    <span class="hljs-comment">// æ¡¶ä¸­ç»“æ„è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹åº”çš„tableçš„æœ€å°å®¹é‡</span><br>    static <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> MIN_TREEIFY_CAPACITY = <span class="hljs-number">64</span>;<br>    <span class="hljs-comment">// å­˜å‚¨å…ƒç´ çš„æ•°ç»„ï¼Œæ€»æ˜¯2çš„å¹‚æ¬¡å€</span><br>    transient Node&lt;k,v&gt;[] table;<br>    <span class="hljs-comment">// å­˜æ”¾å…·ä½“å…ƒç´ çš„é›†</span><br>    transient Set&lt;map.entry&lt;k,v&gt;&gt; entrySet;<br>    <span class="hljs-comment">// å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼Œæ³¨æ„è¿™ä¸ªä¸ç­‰äºæ•°ç»„çš„é•¿åº¦ã€‚</span><br>    transient <span class="hljs-built_in">int</span> size;<br>    <span class="hljs-comment">// æ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹mapç»“æ„çš„è®¡æ•°å™¨</span><br>    transient <span class="hljs-built_in">int</span> modCount;<br>    <span class="hljs-comment">// é˜ˆå€¼(å®¹é‡*è´Ÿè½½å› å­) å½“å®é™…å¤§å°è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹</span><br>    <span class="hljs-built_in">int</span> threshold;<br>    <span class="hljs-comment">// è´Ÿè½½å› å­</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-built_in">float</span> loadFactor;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‡ ä¸ªé‡è¦çš„å­—æ®µ</p><ul><li>loadFactor   è´Ÿè½½å› å­</li><li>threshold   é˜ˆå€¼ï¼ˆHashMap å®é™…èƒ½å­˜å‚¨çš„å¤§å°ï¼‰</li><li>DEFAULT_INITIAL_CAPACITY  é»˜è®¤åˆå§‹å®¹é‡</li><li>MAXIMUM_CAPACITY  æœ€å¤§å®¹é‡</li><li>size   HashMapå®é™…å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°</li><li>modCount     HashMapçš„ç»“æ„è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œç”¨äºè¿­ä»£å™¨</li></ul><blockquote><p>loadFactor è´Ÿè½½å› å­</p></blockquote><p>loadFactor è´Ÿè½½å› å­ æ˜¯æ§åˆ¶æ•°ç»„å­˜æ”¾æ•°æ®çš„ç–å¯†ç¨‹åº¦ï¼ŒloadFactor è¶Šè¶‹è¿‘äº 1ï¼Œé‚£ä¹ˆ æ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®(entry)ä¹Ÿå°±è¶Šå¤šï¼Œä¹Ÿå°±è¶Šå¯†ï¼Œä¹Ÿå°±æ˜¯ä¼šè®©é“¾è¡¨çš„é•¿åº¦å¢åŠ ï¼ŒloadFactor è¶Šå°ï¼Œä¹Ÿå°±æ˜¯è¶‹è¿‘äº 0ï¼Œæ•°ç»„ä¸­å­˜æ”¾çš„æ•°æ®(entry)ä¹Ÿå°±è¶Šå°‘ï¼Œä¹Ÿå°±è¶Šç¨€ç–ã€‚</p><p>loadFactor å¤ªå¤§å¯¼è‡´æŸ¥æ‰¾å…ƒç´ æ•ˆç‡ä½ï¼Œå¤ªå°å¯¼è‡´æ•°ç»„çš„åˆ©ç”¨ç‡ä½ï¼Œå­˜æ”¾çš„æ•°æ®ä¼šå¾ˆåˆ†æ•£ã€‚<strong>loadFactor çš„é»˜è®¤å€¼ä¸º 0.75f</strong> ï¼Œæ˜¯å®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¸´ç•Œå€¼ã€‚</p><p>HashMap ç»™å®šçš„é»˜è®¤å®¹é‡ä¸º 16ï¼Œè´Ÿè½½å› å­ä¸º 0.75ã€‚<br>Map åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¸æ–­çš„å¾€é‡Œé¢å­˜æ”¾æ•°æ®ï¼Œå½“æ•°é‡è¶…è¿‡äº† 16 * 0.75 &#x3D; 12 , å°±éœ€è¦å°†å½“å‰ 16 çš„å®¹é‡è¿›è¡Œæ‰©å®¹ï¼Œè€Œæ‰©å®¹è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ° rehashã€å¤åˆ¶æ•°æ®ç­‰æ“ä½œï¼Œæ‰€ä»¥éå¸¸æ¶ˆè€—æ€§èƒ½ã€‚</p><blockquote><p>threshold   é˜ˆå€¼</p></blockquote><p><strong>threshold &#x3D; capacity * loadFactor</strong>ï¼Œé˜ˆå€¼(å®¹é‡ * è´Ÿè½½å› å­) </p><p>å½“å®é™…å¤§å°è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå°±è¦è€ƒè™‘å¯¹æ•°ç»„çš„æ‰©å¢ã€‚é˜ˆå€¼æ˜¯è¡¡é‡æ•°ç»„æ˜¯å¦éœ€è¦æ‰©å¢çš„ä¸€ä¸ªæ ‡å‡†ã€‚</p><h4 id="Node-èŠ‚ç‚¹ç±»æºç "><a href="#Node-èŠ‚ç‚¹ç±»æºç " class="headerlink" title="Node èŠ‚ç‚¹ç±»æºç "></a>Node èŠ‚ç‚¹ç±»æºç </h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// ç»§æ‰¿è‡ª Map.Entry&lt;K,V&gt;</span><br>static <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>&lt;<span class="hljs-type">K,V</span>&gt; <span class="hljs-title">implements</span> <span class="hljs-title">Map</span>.<span class="hljs-title">Entry</span>&lt;<span class="hljs-type">K,V</span>&gt; &#123;<br>       <span class="hljs-keyword">final</span> int hash;<span class="hljs-comment">// å“ˆå¸Œå€¼ï¼Œå­˜æ”¾å…ƒç´ åˆ°hashmapä¸­æ—¶ç”¨æ¥ä¸å…¶ä»–å…ƒç´ hashå€¼æ¯”è¾ƒ</span><br>       <span class="hljs-keyword">final</span> K key;<span class="hljs-comment">//é”®</span><br>       V value;<span class="hljs-comment">//å€¼</span><br>       <span class="hljs-comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span><br>       Node&lt;K,V&gt; next;<br>       <br>       Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123;<br>            <span class="hljs-keyword">this</span>.hash = hash;<br>            <span class="hljs-keyword">this</span>.key = key;<br>            <span class="hljs-keyword">this</span>.value = value;<br>            <span class="hljs-keyword">this</span>.next = next;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> K getKey()        &#123; <span class="hljs-keyword">return</span> key; &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> V getValue()      &#123; <span class="hljs-keyword">return</span> value; &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String toString() &#123; <span class="hljs-keyword">return</span> key + <span class="hljs-string">&quot;=&quot;</span> + value; &#125;<br>        <span class="hljs-comment">// é‡å†™hashCode()æ–¹æ³•</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> int hashCode() &#123;<br>            <span class="hljs-keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);<br>        &#125;<br><br><span class="hljs-comment">//ç›¸å½“äºæŠŠåŸæ¥çš„å€¼ç»™è¦†ç›–æ‰ï¼Œä½†æ˜¯è¿”å›è¢«è¦†ç›–æ‰çš„å€¼</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> V setValue(V newValue) &#123;<br>            V oldValue = value;<br>            value = newValue;<br>            <span class="hljs-keyword">return</span> oldValue;<br>        &#125;<br>        <br>        <span class="hljs-comment">// é‡å†™ equals() æ–¹æ³•</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> boolean equals(Object o) &#123;<br>            <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">this</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">if</span> (o instanceof Map.Entry) &#123;<br>                Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;<br>                <span class="hljs-keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;<br>                    Objects.equals(value, e.getValue()))<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ ‘èŠ‚ç‚¹ç±»æºç "><a href="#æ ‘èŠ‚ç‚¹ç±»æºç " class="headerlink" title="æ ‘èŠ‚ç‚¹ç±»æºç "></a>æ ‘èŠ‚ç‚¹ç±»æºç </h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs scala">static <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TreeNode&lt;K</span>,<span class="hljs-title">V&gt;</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LinkedHashMap</span>.<span class="hljs-title">Entry&lt;K</span>,<span class="hljs-title">V&gt;</span> </span>&#123;<br>        <span class="hljs-type">TreeNode</span>&lt;<span class="hljs-type">K</span>,<span class="hljs-type">V</span>&gt; parent;  <span class="hljs-comment">// çˆ¶</span><br>        <span class="hljs-type">TreeNode</span>&lt;<span class="hljs-type">K</span>,<span class="hljs-type">V</span>&gt; left;    <span class="hljs-comment">// å·¦</span><br>        <span class="hljs-type">TreeNode</span>&lt;<span class="hljs-type">K</span>,<span class="hljs-type">V</span>&gt; right;   <span class="hljs-comment">// å³</span><br>        <span class="hljs-type">TreeNode</span>&lt;<span class="hljs-type">K</span>,<span class="hljs-type">V</span>&gt; prev;    <span class="hljs-comment">// needed to unlink next upon deletion</span><br>        boolean red;           <span class="hljs-comment">// åˆ¤æ–­é¢œè‰²</span><br>        <span class="hljs-type">TreeNode</span>(int hash, <span class="hljs-type">K</span> key, <span class="hljs-type">V</span> <span class="hljs-keyword">val</span>, <span class="hljs-type">Node</span>&lt;<span class="hljs-type">K</span>,<span class="hljs-type">V</span>&gt; next) &#123;<br>            <span class="hljs-keyword">super</span>(hash, key, <span class="hljs-keyword">val</span>, next);<br>        &#125;<br>        <br>        <span class="hljs-comment">// è¿”å›æ ¹èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">TreeNode</span>&lt;<span class="hljs-type">K</span>,<span class="hljs-type">V</span>&gt; root() &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">TreeNode</span>&lt;<span class="hljs-type">K</span>,<span class="hljs-type">V</span>&gt; r = <span class="hljs-keyword">this</span>, p;;) &#123;<br>                <span class="hljs-keyword">if</span> ((p = r.parent) == <span class="hljs-literal">null</span>)<br>                    <span class="hljs-keyword">return</span> r;<br>                r = p;<br>       &#125;<br><br></code></pre></td></tr></table></figure><h3 id="3ã€HashMap-æºç åˆ†æ"><a href="#3ã€HashMap-æºç åˆ†æ" class="headerlink" title="3ã€HashMap æºç åˆ†æ"></a>3ã€HashMap æºç åˆ†æ</h3><h4 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h4><p>HashMap ä¸­æœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼Œå®ƒä»¬åˆ†åˆ«å¦‚ä¸‹ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">   <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="hljs-number">0.75</span>f;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAXIMUM_CAPACITY = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>;<br><br><span class="hljs-keyword">int</span> threshold;<br>   <br>   <span class="hljs-comment">// é»˜è®¤æ„é€ å‡½æ•°ã€‚</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">()</span> </span>&#123;<br>       <span class="hljs-keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="hljs-comment">// all   other fields defaulted</span><br>    &#125;<br><br>    <span class="hljs-comment">// åŒ…å«å¦ä¸€ä¸ªâ€œMapâ€çš„æ„é€ å‡½æ•°</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(Map&lt;? <span class="hljs-keyword">extends</span> K, ? <span class="hljs-keyword">extends</span> V&gt; m)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;<br>        putMapEntries(m, <span class="hljs-keyword">false</span>);<span class="hljs-comment">//ä¸‹é¢ä¼šåˆ†æ</span><br>    &#125;<br><br>    <span class="hljs-comment">// æŒ‡å®šâ€œå®¹é‡å¤§å°â€çš„æ„é€ å‡½æ•°</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);<br>    &#125;<br><br>    <span class="hljs-comment">// æŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œè´Ÿè½½å› å­â€çš„æ„é€ å‡½æ•°</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity, <span class="hljs-keyword">float</span> loadFactor)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Illegal initial capacity: &quot;</span> + initialCapacity);<br>        <span class="hljs-keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)<br>            initialCapacity = MAXIMUM_CAPACITY;<br>        <span class="hljs-keyword">if</span> (loadFactor &lt;= <span class="hljs-number">0</span> || Float.isNaN(loadFactor))<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Illegal load factor: &quot;</span> + loadFactor);<br>        <span class="hljs-comment">//æŒ‡å®šè´Ÿè½½å› å­</span><br>        <span class="hljs-keyword">this</span>.loadFactor = loadFactor;<br>        <span class="hljs-comment">// åˆå§‹å®¹é‡æš‚æ—¶å­˜æ”¾åˆ° threshold ï¼Œåœ¨ resize ä¸­å†èµ‹å€¼ç»™ newCap è¿›è¡Œtableåˆå§‹åŒ–</span><br>        <span class="hljs-keyword">this</span>.threshold = tableSizeFor(initialCapacity);<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¬¬äºŒä¸ªæ„é€ å‡½æ•°ä¸­è°ƒç”¨äº† putMapEntries æ–¹æ³•ï¼Œä¸‹é¢è¿›è¡Œåˆ†æï¼š</p><p><strong>putMapEntries æ–¹æ³•</strong></p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">transient</span> Node&lt;K,V&gt;[] table;<br><br><span class="hljs-keyword">final</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">putMapEntries</span><span class="hljs-params">(Map&lt;? <span class="hljs-keyword">extends</span> K, ? <span class="hljs-keyword">extends</span> V&gt; m, <span class="hljs-keyword">boolean</span> evict)</span> </span>&#123;  <br>    <span class="hljs-keyword">int</span> s = m.size();  <br>    <span class="hljs-keyword">if</span> (s &gt; <span class="hljs-number">0</span>) &#123;  <br>        <span class="hljs-comment">// åˆ¤æ–­tableæ˜¯å¦å·²ç»åˆå§‹åŒ–</span><br>        <span class="hljs-keyword">if</span> (table == <span class="hljs-keyword">null</span>) &#123; <span class="hljs-comment">// pre-size  </span><br>            <span class="hljs-comment">//å¦‚æœæœªåˆå§‹åŒ–ï¼Œs ä¸º m çš„å®é™…å…ƒç´ ä¸ªæ•°ï¼›ft=s/loadFactor =&gt; s=ft*loadFactorï¼›å…¶ä¸­ ft æŒ‡çš„æ˜¯è¦æ·»åŠ  s ä¸ªå…ƒç´ æ‰€éœ€è¦çš„æœ€å°çš„å®¹é‡</span><br>            <span class="hljs-keyword">float</span> ft = ((<span class="hljs-keyword">float</span>)s / loadFactor) + <span class="hljs-number">1.0</span>F;  <br>            <span class="hljs-comment">//ä¸æœ€å¤§å®¹é‡ä½œæ¯”è¾ƒï¼Œå¦‚æœå°äºåˆ™ t ä¸º ftï¼Œå¦åˆ™ä¸º MAXIMUM_CAPACITY</span><br>            <span class="hljs-keyword">int</span> t = ((ft &lt; (<span class="hljs-keyword">float</span>)MAXIMUM_CAPACITY) ?  <br>                     (<span class="hljs-keyword">int</span>)ft : MAXIMUM_CAPACITY);  <br>            <span class="hljs-comment">//æ ¹æ®ä¸Šé¢çš„æ„é€ å‡½æ•°ï¼Œå¯ä»¥å¾—çŸ¥æ­¤æ—¶ table æœªåˆå§‹åŒ–ï¼Œthreshold å®é™…ä¸Šæ˜¯å­˜æ”¾çš„åˆå§‹åŒ–å®¹é‡</span><br>            <span class="hljs-comment">//å¦‚æœæ·»åŠ sä¸ªå…ƒç´ æ‰€éœ€çš„æœ€å°å®¹é‡å¤§äºåˆå§‹åŒ–å®¹é‡ï¼Œåˆ™å°†æœ€å°å®¹é‡æ‰©å®¹ä¸ºæœ€æ¥è¿‘çš„2çš„å¹‚æ¬¡æ–¹å¤§å°ä½œä¸ºåˆå§‹åŒ–ã€‚ï¼ˆæ³¨æ„è¿™é‡Œä¸æ˜¯åˆå§‹åŒ–é˜ˆå€¼ï¼‰</span><br>            <span class="hljs-keyword">if</span> (t &gt; threshold)  <br>                threshold = tableSizeFor(t);  <br>        &#125;  <br>        <span class="hljs-comment">// å¦‚æœå·²ç»åˆå§‹åŒ–ï¼Œå¹¶ä¸”må…ƒç´ ä¸ªæ•°å¤§äºé˜ˆå€¼ï¼Œè¿›è¡Œæ‰©å®¹å¤„ç†</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (s &gt; threshold)  <br>            resize();  <br>        <span class="hljs-comment">// å°†mä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ è‡³HashMapä¸­ï¼Œå¦‚æœtableæœªåˆå§‹åŒ–ï¼ŒputValä¸­ä¼šè°ƒç”¨resizeåˆå§‹åŒ–æˆ–æ‰©å®¹    </span><br>        <span class="hljs-keyword">for</span> (Map.Entry&lt;? <span class="hljs-keyword">extends</span> K, ? <span class="hljs-keyword">extends</span> V&gt; e : m.entrySet()) &#123;  <br>            K key = e.getKey();  <br>            V value = e.getValue();  <br>            putVal(hash(key), key, value, <span class="hljs-keyword">false</span>, evict);  <br>        &#125;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>tableSizeFor æ–¹æ³•ï¼šè¿”å›ä¸€ä¸ªæœ€æ¥è¿‘ cap çš„2çš„å¹‚æ¬¡æ–¹å¤§å°æ•°å€¼</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs excel">static final <span class="hljs-built_in">int</span> tableSizeFor(<span class="hljs-built_in">int</span> cap) &#123;  <br>    <span class="hljs-built_in">int</span> <span class="hljs-built_in">n</span> = cap - <span class="hljs-number">1</span>;  <br>    <span class="hljs-built_in">n</span> |= <span class="hljs-built_in">n</span> &gt;&gt;&gt; <span class="hljs-number">1</span>;  <br>    <span class="hljs-built_in">n</span> |= <span class="hljs-built_in">n</span> &gt;&gt;&gt; <span class="hljs-number">2</span>;  <br>    <span class="hljs-built_in">n</span> |= <span class="hljs-built_in">n</span> &gt;&gt;&gt; <span class="hljs-number">4</span>;  <br>    <span class="hljs-built_in">n</span> |= <span class="hljs-built_in">n</span> &gt;&gt;&gt; <span class="hljs-number">8</span>;  <br>    <span class="hljs-built_in">n</span> |= <span class="hljs-built_in">n</span> &gt;&gt;&gt; <span class="hljs-number">16</span>;  <br>    return (<span class="hljs-built_in">n</span> &lt; <span class="hljs-number">0</span>) ? <span class="hljs-number">1</span> <span class="hljs-symbol">:</span> (<span class="hljs-built_in">n</span> &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY <span class="hljs-symbol">:</span> <span class="hljs-built_in">n</span> + <span class="hljs-number">1</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="put-æ–¹æ³•"><a href="#put-æ–¹æ³•" class="headerlink" title="put æ–¹æ³•"></a>put æ–¹æ³•</h4><p>HashMap åªæä¾›äº† put ç”¨äºæ·»åŠ å…ƒç´ ï¼ŒputVal æ–¹æ³•æ˜¯ put æ–¹æ³•è°ƒç”¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶æ²¡æœ‰æä¾›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs maxima">public V <span class="hljs-built_in">put</span>(K <span class="hljs-built_in">key</span>, V value) &#123;<br>    <span class="hljs-built_in">return</span> putVal(hash(<span class="hljs-built_in">key</span>), <span class="hljs-built_in">key</span>, value, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>putVal æ–¹æ³• å›¾è§£</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20231115230931.png" alt="image.png"></p><p>putVal æ–¹æ³•æ·»åŠ å…ƒç´ åˆ†æï¼š</p><ul><li>å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æ²¡æœ‰å…ƒç´  å°±ç›´æ¥æ’å…¥ã€‚</li><li>å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æœ‰å…ƒç´ å°±å’Œè¦æ’å…¥çš„ key æ¯”è¾ƒï¼Œ<ul><li>å¦‚æœ key ç›¸åŒå°±ç›´æ¥è¦†ç›–ï¼Œ</li><li>å¦‚æœ key ä¸ç›¸åŒï¼Œå°±åˆ¤æ–­ p æ˜¯å¦æ˜¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹ï¼Œ<ul><li>å¦‚æœæ˜¯å°±è°ƒç”¨<code>e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value)</code>å°†å…ƒç´ æ·»åŠ è¿›å…¥ã€‚</li><li>å¦‚æœä¸æ˜¯å°±éå†é“¾è¡¨æ’å…¥(æ’å…¥çš„æ˜¯é“¾è¡¨å°¾éƒ¨)ã€‚</li></ul></li></ul></li></ul><blockquote><p>putVal æ–¹æ³•</p></blockquote><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs arcade">final V putVal(int <span class="hljs-built_in">hash</span>, K key, V value, <span class="hljs-built_in">boolean</span> onlyIfAbsent,<br>                   <span class="hljs-built_in">boolean</span> evict) &#123;<br>    Node&lt;K,V&gt;[] <span class="hljs-literal">tab</span>; Node&lt;K,V&gt; p; int n, i;<br>    <span class="hljs-comment">// tableæœªåˆå§‹åŒ–æˆ–è€…é•¿åº¦ä¸º0ï¼Œè¿›è¡Œæ‰©å®¹</span><br>    <span class="hljs-keyword">if</span> ((<span class="hljs-literal">tab</span> = table) == <span class="hljs-literal">null</span> || (n = <span class="hljs-literal">tab</span>.<span class="hljs-built_in">length</span>) == <span class="hljs-number">0</span>)<br>        n = (<span class="hljs-literal">tab</span> = <span class="hljs-built_in">resize</span>()).<span class="hljs-built_in">length</span>;<br>    <span class="hljs-comment">// (n - 1) &amp; hash ç¡®å®šå…ƒç´ å­˜æ”¾åœ¨å“ªä¸ªæ¡¶ä¸­ï¼Œæ¡¶ä¸ºç©ºï¼Œæ–°ç”Ÿæˆç»“ç‚¹æ”¾å…¥æ¡¶ä¸­(æ­¤æ—¶ï¼Œè¿™ä¸ªç»“ç‚¹æ˜¯æ”¾åœ¨æ•°ç»„ä¸­)</span><br>    <span class="hljs-keyword">if</span> ((p = <span class="hljs-literal">tab</span>[i = (n - <span class="hljs-number">1</span>) &amp; <span class="hljs-built_in">hash</span>]) == <span class="hljs-literal">null</span>)<br>        <span class="hljs-literal">tab</span>[i] = newNode(<span class="hljs-built_in">hash</span>, key, value, <span class="hljs-literal">null</span>);<br>    <span class="hljs-comment">// æ¡¶ä¸­å·²ç»å­˜åœ¨å…ƒç´ ï¼ˆå¤„ç†hashå†²çªï¼‰</span><br>    <span class="hljs-keyword">else</span> &#123;<br>        Node&lt;K,V&gt; e; K k;<br>        <span class="hljs-comment">//å¿«é€Ÿåˆ¤æ–­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹table[i]çš„keyæ˜¯å¦ä¸æ’å…¥çš„keyä¸€æ ·ï¼Œè‹¥ç›¸åŒå°±ç›´æ¥ä½¿ç”¨æ’å…¥çš„å€¼pæ›¿æ¢æ‰æ—§çš„å€¼eã€‚</span><br>        <span class="hljs-keyword">if</span> (p.<span class="hljs-built_in">hash</span> == <span class="hljs-built_in">hash</span> &amp;&amp;<br>            ((k = p.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.<span class="hljs-built_in">equals</span>(k))))<br>                e = p;<br>        <span class="hljs-comment">// åˆ¤æ–­æ’å…¥çš„æ˜¯å¦æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p instanceof TreeNode)<br>            <span class="hljs-comment">// æ”¾å…¥æ ‘ä¸­</span><br>            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, <span class="hljs-literal">tab</span>, <span class="hljs-built_in">hash</span>, key, value);<br>        <span class="hljs-comment">// ä¸æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹åˆ™è¯´æ˜ä¸ºé“¾è¡¨ç»“ç‚¹</span><br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// åœ¨é“¾è¡¨æœ€æœ«æ’å…¥ç»“ç‚¹</span><br>            <span class="hljs-keyword">for</span> (int binCount = <span class="hljs-number">0</span>; ; ++binCount) &#123;<br>                <span class="hljs-comment">// åˆ°è¾¾é“¾è¡¨çš„å°¾éƒ¨</span><br>                <span class="hljs-keyword">if</span> ((e = p.next) == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-comment">// åœ¨å°¾éƒ¨æ’å…¥æ–°ç»“ç‚¹</span><br>                    p.next = newNode(<span class="hljs-built_in">hash</span>, key, value, <span class="hljs-literal">null</span>);<br>                    <span class="hljs-comment">// ç»“ç‚¹æ•°é‡è¾¾åˆ°é˜ˆå€¼(é»˜è®¤ä¸º 8 )ï¼Œæ‰§è¡Œ treeifyBin æ–¹æ³•</span><br>                    <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ® HashMap æ•°ç»„æ¥å†³å®šæ˜¯å¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</span><br>                    <span class="hljs-comment">// åªæœ‰å½“æ•°ç»„é•¿åº¦å¤§äºæˆ–è€…ç­‰äº 64 çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šæ‰§è¡Œè½¬æ¢çº¢é»‘æ ‘æ“ä½œï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚å¦åˆ™ï¼Œå°±æ˜¯åªæ˜¯å¯¹æ•°ç»„æ‰©å®¹ã€‚</span><br>                    <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="hljs-number">1</span>) <span class="hljs-comment">// -1 for 1st</span><br>                        treeifyBin(<span class="hljs-literal">tab</span>, <span class="hljs-built_in">hash</span>);<br>                    <span class="hljs-comment">// è·³å‡ºå¾ªç¯</span><br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-comment">// åˆ¤æ–­é“¾è¡¨ä¸­ç»“ç‚¹çš„keyå€¼ä¸æ’å…¥çš„å…ƒç´ çš„keyå€¼æ˜¯å¦ç›¸ç­‰</span><br>                <span class="hljs-keyword">if</span> (e.<span class="hljs-built_in">hash</span> == <span class="hljs-built_in">hash</span> &amp;&amp;<br>                    ((k = e.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.<span class="hljs-built_in">equals</span>(k))))<br>                    <span class="hljs-comment">// ç›¸ç­‰ï¼Œè·³å‡ºå¾ªç¯</span><br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-comment">// ç”¨äºéå†æ¡¶ä¸­çš„é“¾è¡¨ï¼Œä¸å‰é¢çš„e = p.nextç»„åˆï¼Œå¯ä»¥éå†é“¾è¡¨</span><br>                p = e;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// è¡¨ç¤ºåœ¨æ¡¶ä¸­æ‰¾åˆ°keyå€¼ã€hashå€¼ä¸æ’å…¥å…ƒç´ ç›¸ç­‰çš„ç»“ç‚¹</span><br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// è®°å½•eçš„value</span><br>            V oldValue = e.value;<br>            <span class="hljs-comment">// onlyIfAbsentä¸ºfalseæˆ–è€…æ—§å€¼ä¸ºnull</span><br>            <span class="hljs-keyword">if</span> (!onlyIfAbsent || oldValue == <span class="hljs-literal">null</span>)<br>                <span class="hljs-comment">//ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼</span><br>                e.value = value;<br>            <span class="hljs-comment">// è®¿é—®åå›è°ƒ</span><br>            afterNodeAccess(e);<br>            <span class="hljs-comment">// è¿”å›æ—§å€¼</span><br>            <span class="hljs-keyword">return</span> oldValue;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// ç»“æ„æ€§ä¿®æ”¹</span><br>    ++modCount;<br>    <span class="hljs-comment">// å®é™…å¤§å°å¤§äºé˜ˆå€¼åˆ™æ‰©å®¹</span><br>    <span class="hljs-keyword">if</span> (++size &gt; threshold)<br>        <span class="hljs-built_in">resize</span>();<br>    <span class="hljs-comment">// æ’å…¥åå›è°ƒ</span><br>    afterNodeInsertion(evict);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><strong>å¯¹æ¯” JDK1.7 put æ–¹æ³•çš„ä»£ç </strong></p></blockquote><p><strong>å¯¹äº put æ–¹æ³•çš„åˆ†æå¦‚ä¸‹ï¼š</strong></p><ul><li>â‘  å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æ²¡æœ‰å…ƒç´  å°±ç›´æ¥æ’å…¥ã€‚</li><li>â‘¡ å¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®æœ‰å…ƒç´ ï¼Œéå†ä»¥è¿™ä¸ªå…ƒç´ ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ï¼Œä¾æ¬¡å’Œæ’å…¥çš„ key æ¯”è¾ƒï¼Œå¦‚æœ key ç›¸åŒå°±ç›´æ¥è¦†ç›–ï¼Œä¸åŒå°±é‡‡ç”¨å¤´æ’æ³•æ’å…¥å…ƒç´ ã€‚</li></ul><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span>(K <span class="hljs-built_in">key</span>, V value)<br>    <span class="hljs-keyword">if</span> (table == EMPTY_TABLE) &#123;<br>    <span class="hljs-title function_">inflateTable</span>(threshold);<br>&#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">key</span> == <span class="hljs-literal">null</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">putForNullKey</span>(value);<br>    <span class="hljs-type">int</span> hash = <span class="hljs-title function_">hash</span>(<span class="hljs-built_in">key</span>);<br>    <span class="hljs-type">int</span> i = <span class="hljs-title function_">indexFor</span>(hash, table.<span class="hljs-property">length</span>);<br>    <span class="hljs-keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="hljs-literal">null</span>; e = e.<span class="hljs-property">next</span>) &#123; <span class="hljs-comment">// å…ˆéå†</span><br>        <span class="hljs-built_in">Object</span> k;<br>        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">hash</span> == hash &amp;&amp; ((k = e.<span class="hljs-property">key</span>) == <span class="hljs-built_in">key</span> || <span class="hljs-built_in">key</span>.<span class="hljs-property">equals</span>(k))) &#123;<br>            V oldValue = e.<span class="hljs-property">value</span>;<br>            e.<span class="hljs-property">value</span> = value;<br>            e.<span class="hljs-property">recordAccess</span>(<span class="hljs-variable">this</span>);<br>            <span class="hljs-keyword">return</span> oldValue;<br>        &#125;<br>    &#125;<br><br>    modCount++;<br>    <span class="hljs-title function_">addEntry</span>(hash, <span class="hljs-built_in">key</span>, value, i);  <span class="hljs-comment">// å†æ’å…¥</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="get-æ–¹æ³•"><a href="#get-æ–¹æ³•" class="headerlink" title="get æ–¹æ³•"></a>get æ–¹æ³•</h4><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs arcade">public V get(Object key) &#123;<br>    Node&lt;K,V&gt; e;<br>    <span class="hljs-keyword">return</span> (e = getNode(<span class="hljs-built_in">hash</span>(key), key)) == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : e.value;<br>&#125;<br><br>final Node&lt;K,V&gt; getNode(int <span class="hljs-built_in">hash</span>, Object key) &#123;<br>    Node&lt;K,V&gt;[] <span class="hljs-literal">tab</span>; Node&lt;K,V&gt; <span class="hljs-built_in">first</span>, e; int n; K k;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-literal">tab</span> = table) != <span class="hljs-literal">null</span> &amp;&amp; (n = <span class="hljs-literal">tab</span>.<span class="hljs-built_in">length</span>) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>        (<span class="hljs-built_in">first</span> = <span class="hljs-literal">tab</span>[(n - <span class="hljs-number">1</span>) &amp; <span class="hljs-built_in">hash</span>]) != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// æ•°ç»„å…ƒç´ ç›¸ç­‰</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">first</span>.<span class="hljs-built_in">hash</span> == <span class="hljs-built_in">hash</span> &amp;&amp; <span class="hljs-comment">// always check first node</span><br>            ((k = <span class="hljs-built_in">first</span>.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.<span class="hljs-built_in">equals</span>(k))))<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">first</span>;<br>        <span class="hljs-comment">// æ¡¶ä¸­ä¸æ­¢ä¸€ä¸ªèŠ‚ç‚¹</span><br>        <span class="hljs-keyword">if</span> ((e = <span class="hljs-built_in">first</span>.next) != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// åœ¨æ ‘ä¸­get</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">first</span> instanceof TreeNode)<br>                <span class="hljs-keyword">return</span> ((TreeNode&lt;K,V&gt;)<span class="hljs-built_in">first</span>).getTreeNode(<span class="hljs-built_in">hash</span>, key);<br>            <span class="hljs-comment">// åœ¨é“¾è¡¨ä¸­get</span><br>            <span class="hljs-keyword">do</span> &#123;<br>                <span class="hljs-keyword">if</span> (e.<span class="hljs-built_in">hash</span> == <span class="hljs-built_in">hash</span> &amp;&amp;<br>                    ((k = e.key) == key || (key != <span class="hljs-literal">null</span> &amp;&amp; key.<span class="hljs-built_in">equals</span>(k))))<br>                    <span class="hljs-keyword">return</span> e;<br>            &#125; <span class="hljs-keyword">while</span> ((e = e.next) != <span class="hljs-literal">null</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="resize-æ–¹æ³•"><a href="#resize-æ–¹æ³•" class="headerlink" title="resize æ–¹æ³•"></a>resize æ–¹æ³•</h4><p>è¿›è¡Œæ‰©å®¹ï¼Œä¼šä¼´éšç€ä¸€æ¬¡é‡æ–° hash åˆ†é…ï¼Œå¹¶ä¸”ä¼šéå† hash è¡¨ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œæ˜¯éå¸¸è€—æ—¶çš„ã€‚åœ¨ç¼–å†™ç¨‹åºä¸­ï¼Œè¦å°½é‡é¿å… resizeã€‚</p><p>resize æ–¹æ³•å®é™…ä¸Šæ˜¯å°† table åˆå§‹åŒ–å’Œ table æ‰©å®¹ è¿›è¡Œäº†æ•´åˆï¼Œåº•å±‚çš„è¡Œä¸ºéƒ½æ˜¯ç»™ table èµ‹å€¼ä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;<br>    Node&lt;K,V&gt;[] oldTab = table;<br>    int oldCap = (oldTab == <span class="hljs-literal">null</span>) ? <span class="hljs-number">0</span> : <span class="hljs-type">oldTab</span>.length;<br>    int oldThr = threshold;<br>    int <span class="hljs-keyword">new</span><span class="hljs-type">Cap</span>, <span class="hljs-keyword">new</span><span class="hljs-type">Thr</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (oldCap &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§</span><br>        <span class="hljs-keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;<br>            threshold = Integer.MAX_VALUE;<br>            <span class="hljs-keyword">return</span> oldTab;<br>        &#125;<br>        <span class="hljs-comment">// æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">new</span><span class="hljs-type">Cap</span> = oldCap &lt;&lt; <span class="hljs-number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY)<br>            <span class="hljs-keyword">new</span><span class="hljs-type">Thr</span> = oldThr &lt;&lt; <span class="hljs-number">1</span>; <span class="hljs-comment">// double threshold</span><br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (oldThr &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">// initial capacity was placed in threshold</span><br>        <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡æ—¶åˆå§‹åŒ–å®¹é‡å¤§å°æ”¾åœ¨thresholdä¸­ï¼Œæ­¤æ—¶åªéœ€è¦å°†å…¶ä½œä¸ºæ–°çš„æ•°ç»„å®¹é‡</span><br>        <span class="hljs-keyword">new</span><span class="hljs-type">Cap</span> = oldThr;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// signifies using defaults æ— å‚æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡åœ¨è¿™é‡Œè®¡ç®—å®¹é‡å’Œé˜ˆå€¼</span><br>        <span class="hljs-keyword">new</span><span class="hljs-type">Cap</span> = DEFAULT_INITIAL_CAPACITY;<br>        <span class="hljs-keyword">new</span><span class="hljs-type">Thr</span> = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span><span class="hljs-type">Thr</span> == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// åˆ›å»ºæ—¶æŒ‡å®šäº†åˆå§‹åŒ–å®¹é‡æˆ–è€…è´Ÿè½½å› å­ï¼Œåœ¨è¿™é‡Œè¿›è¡Œé˜ˆå€¼åˆå§‹åŒ–ï¼Œ</span><br>    <span class="hljs-comment">// æˆ–è€…æ‰©å®¹å‰çš„æ—§å®¹é‡å°äº16ï¼Œåœ¨è¿™é‡Œè®¡ç®—æ–°çš„resizeä¸Šé™</span><br>        float ft = (float)<span class="hljs-keyword">new</span><span class="hljs-type">Cap</span> * loadFactor;<br>        <span class="hljs-keyword">new</span><span class="hljs-type">Thr</span> = (<span class="hljs-keyword">new</span><span class="hljs-type">Cap</span> &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : <span class="hljs-type">Integer</span>.MAX_VALUE);<br>    &#125;<br>    threshold = <span class="hljs-keyword">new</span><span class="hljs-type">Thr</span>;<br>    <span class="hljs-meta">@SuppressWarnings</span>(&#123;<span class="hljs-string">&quot;rawtypes&quot;</span>,<span class="hljs-string">&quot;unchecked&quot;</span>&#125;)<br>        Node&lt;K,V&gt;[] <span class="hljs-keyword">new</span><span class="hljs-type">Tab</span> = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> <span class="hljs-type">Node</span>[<span class="hljs-keyword">new</span><span class="hljs-type">Cap</span>];<br>    table = <span class="hljs-keyword">new</span><span class="hljs-type">Tab</span>;<br>    <span class="hljs-keyword">if</span> (oldTab != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­</span><br>        <span class="hljs-keyword">for</span> (int j = <span class="hljs-number">0</span>; j &lt; oldCap; ++j) &#123;<br>            Node&lt;K,V&gt; e;<br>            <span class="hljs-keyword">if</span> ((e = oldTab[j]) != <span class="hljs-literal">null</span>) &#123;<br>                oldTab[j] = <span class="hljs-literal">null</span>;<br>                <span class="hljs-keyword">if</span> (e.next == <span class="hljs-literal">null</span>)<br>                    <span class="hljs-comment">// åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥è®¡ç®—å…ƒç´ æ–°çš„ä½ç½®å³å¯</span><br>                    <span class="hljs-keyword">new</span><span class="hljs-type">Tab</span>[e.hash &amp; (<span class="hljs-keyword">new</span><span class="hljs-type">Cap</span> - <span class="hljs-number">1</span>)] = e;<br>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e instanceof TreeNode)<br>                    <span class="hljs-comment">// å°†çº¢é»‘æ ‘æ‹†åˆ†æˆ2æ£µå­æ ‘ï¼Œå¦‚æœå­æ ‘èŠ‚ç‚¹æ•°å°äºç­‰äº UNTREEIFY_THRESHOLDï¼ˆé»˜è®¤ä¸º 6ï¼‰ï¼Œåˆ™å°†å­æ ‘è½¬æ¢ä¸ºé“¾è¡¨ã€‚</span><br>                    <span class="hljs-comment">// å¦‚æœå­æ ‘èŠ‚ç‚¹æ•°å¤§äº UNTREEIFY_THRESHOLDï¼Œåˆ™ä¿æŒå­æ ‘çš„æ ‘ç»“æ„ã€‚</span><br>                    ((TreeNode&lt;K,V&gt;)e).split(<span class="hljs-built_in">this</span>, <span class="hljs-keyword">new</span><span class="hljs-type">Tab</span>, j, oldCap);<br>                <span class="hljs-keyword">else</span> &#123;<br>                    Node&lt;K,V&gt; loHead = <span class="hljs-literal">null</span>, loTail = <span class="hljs-literal">null</span>;<br>                    Node&lt;K,V&gt; hiHead = <span class="hljs-literal">null</span>, hiTail = <span class="hljs-literal">null</span>;<br>                    Node&lt;K,V&gt; next;<br>                    <span class="hljs-keyword">do</span> &#123;<br>                        next = e.next;<br>                        <span class="hljs-comment">// åŸç´¢å¼•</span><br>                        <span class="hljs-keyword">if</span> ((e.hash &amp; oldCap) == <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-keyword">if</span> (loTail == <span class="hljs-literal">null</span>)<br>                                loHead = e;<br>                            <span class="hljs-keyword">else</span><br>                                loTail.next = e;<br>                            loTail = e;<br>                        &#125;<br>                        <span class="hljs-comment">// åŸç´¢å¼•+oldCap</span><br>                        <span class="hljs-keyword">else</span> &#123;<br>                            <span class="hljs-keyword">if</span> (hiTail == <span class="hljs-literal">null</span>)<br>                                hiHead = e;<br>                            <span class="hljs-keyword">else</span><br>                                hiTail.next = e;<br>                            hiTail = e;<br>                        &#125;<br>                    &#125; <span class="hljs-keyword">while</span> ((e = next) != <span class="hljs-literal">null</span>);<br>                    <span class="hljs-comment">// åŸç´¢å¼•æ”¾åˆ°bucketé‡Œ</span><br>                    <span class="hljs-keyword">if</span> (loTail != <span class="hljs-literal">null</span>) &#123;<br>                        loTail.next = <span class="hljs-literal">null</span>;<br>                        <span class="hljs-keyword">new</span><span class="hljs-type">Tab</span>[j] = loHead;<br>                    &#125;<br>                    <span class="hljs-comment">// åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ</span><br>                    <span class="hljs-keyword">if</span> (hiTail != <span class="hljs-literal">null</span>) &#123;<br>                        hiTail.next = <span class="hljs-literal">null</span>;<br>                        <span class="hljs-keyword">new</span><span class="hljs-type">Tab</span>[j + oldCap] = hiHead;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span><span class="hljs-type">Tab</span>;<br>&#125;<br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://javaguide.cn/java/collection/hashmap-source-code.html">https://javaguide.cn/java/collection/hashmap-source-code.html</a></li><li><a href="https://blog.csdn.net/xiao_a_ruo_ya/article/details/98882507">https://blog.csdn.net/xiao_a_ruo_ya/article/details/98882507</a></li><li><a href="https://blog.csdn.net/rain67/article/details/124043769">https://blog.csdn.net/rain67/article/details/124043769</a></li><li><a href="https://segmentfault.com/a/1190000039302830">https://segmentfault.com/a/1190000039302830</a></li><li><a href="https://blog.csdn.net/weixin_47257050/article/details/118926555">https://blog.csdn.net/weixin_47257050/article/details/118926555</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>é›†åˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>é›†åˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå­¦ä¹ çš„è½»æ¾ä¹‹æ—…</title>
    <link href="/2023/11/15/Java%E5%AD%A6%E4%B9%A0%E7%9A%84%E8%BD%BB%E6%9D%BE%E4%B9%8B%E6%97%85/"/>
    <url>/2023/11/15/Java%E5%AD%A6%E4%B9%A0%E7%9A%84%E8%BD%BB%E6%9D%BE%E4%B9%8B%E6%97%85/</url>
    
    <content type="html"><![CDATA[<p>ä¸è¦è®©å›æ—‹é•–æ‰“åˆ°ä½ çš„å½±å­ä¸Š</p><p>æ ¼å¼ï¼š </p><ul><li><a href="/2023/11/15/Java%E5%AD%A6%E4%B9%A0%E7%9A%84%E8%BD%BB%E6%9D%BE%E4%B9%8B%E6%97%85/" title="Javaå­¦ä¹ çš„è½»æ¾ä¹‹æ—…">Javaå­¦ä¹ çš„è½»æ¾ä¹‹æ—…</a></li></ul><hr><h3 id="JavaåŸºç¡€"><a href="#JavaåŸºç¡€" class="headerlink" title="JavaåŸºç¡€"></a>JavaåŸºç¡€</h3><h4 id="Java-åŸºç¡€"><a href="#Java-åŸºç¡€" class="headerlink" title="Java åŸºç¡€"></a>Java åŸºç¡€</h4><ul><li><a href="/2024/01/07/Java%E5%9F%BA%E7%A1%80_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B901/" title="JavaåŸºç¡€_åŸºç¡€å†…å®¹01">JavaåŸºç¡€_åŸºç¡€å†…å®¹01</a></li><li><a href="/2024/01/08/Java%E5%9F%BA%E7%A1%80_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B902/" title="JavaåŸºç¡€_åŸºç¡€å†…å®¹02">JavaåŸºç¡€_åŸºç¡€å†…å®¹02</a></li><li><a href="/2024/01/08/Java%E5%9F%BA%E7%A1%80_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B903/" title="JavaåŸºç¡€_åŸºç¡€å†…å®¹03">JavaåŸºç¡€_åŸºç¡€å†…å®¹03</a></li><li><a href="/2024/04/24/Java%E5%9F%BA%E7%A1%80_%E5%8F%8D%E5%B0%84/" title="JavaåŸºç¡€_åå°„">JavaåŸºç¡€_åå°„</a></li></ul><h4 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h4><ul><li><a href="/2024/01/08/Java%E5%9F%BA%E7%A1%80_IO%E5%AD%A6%E4%B9%A0/" title="JavaåŸºç¡€_åŸºç¡€å†…å®¹04">JavaåŸºç¡€_åŸºç¡€å†…å®¹04</a></li><li><a href="/2024/04/03/Java%E5%9F%BA%E7%A1%80_IO%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/" title="JavaåŸºç¡€_IOåŸºç¡€æ“ä½œ">JavaåŸºç¡€_IOåŸºç¡€æ“ä½œ</a></li></ul><h4 id="Java-8"><a href="#Java-8" class="headerlink" title="Java 8"></a><strong>Java 8</strong></h4><ul><li><a href="/2023/12/20/Java8%E6%96%B0%E7%89%B9%E6%80%A7/" title="Java8æ–°ç‰¹æ€§">Java8æ–°ç‰¹æ€§</a></li></ul><h4 id="Java-é›†åˆ"><a href="#Java-é›†åˆ" class="headerlink" title="Java é›†åˆ"></a><strong>Java é›†åˆ</strong></h4><ul><li><a href="/2023/11/14/Java%E9%9B%86%E5%90%88_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="Java é›†åˆ_åŸºç¡€æ¦‚å¿µ">Java é›†åˆ_åŸºç¡€æ¦‚å¿µ</a></li><li><a href="/2023/11/14/Java%E9%9B%86%E5%90%88_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5_%E8%A1%A5%E5%85%85%E5%86%85%E5%AE%B901/" title="Java é›†åˆ_è¿›é˜¶å†…å®¹">Java é›†åˆ_è¿›é˜¶å†…å®¹</a></li><li><a href="/2023/11/14/Java%E9%9B%86%E5%90%88_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5_%E8%A1%A5%E5%85%85%E5%86%85%E5%AE%B902/" title="Javaé›†åˆ_åŸºç¡€æ¦‚å¿µ_è¡¥å……å†…å®¹02">Javaé›†åˆ_åŸºç¡€æ¦‚å¿µ_è¡¥å……å†…å®¹02</a>  </li><li><a href="/2023/11/14/Java%E9%9B%86%E5%90%88_ArrayList%E5%AD%A6%E4%B9%A0/" title="Javaé›†åˆ_ArrayList å­¦ä¹ ">Javaé›†åˆ_ArrayList å­¦ä¹ </a></li><li><a href="/2023/11/15/Java%E9%9B%86%E5%90%88_HashMap%E5%AD%A6%E4%B9%A0/" title="Javaé›†åˆ_HashMapå­¦ä¹ ">Javaé›†åˆ_HashMapå­¦ä¹ </a></li></ul><h4 id="Javaå¤šçº¿ç¨‹-ğŸš©"><a href="#Javaå¤šçº¿ç¨‹-ğŸš©" class="headerlink" title="Javaå¤šçº¿ç¨‹   ğŸš©"></a><strong>Javaå¤šçº¿ç¨‹</strong>   ğŸš©</h4><p>çŸ¥è¯†å·</p><ul><li><a href="/2023/11/15/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="Javaå¹¶å‘ç¼–ç¨‹_åŸºç¡€æ¦‚å¿µ">Javaå¹¶å‘ç¼–ç¨‹_åŸºç¡€æ¦‚å¿µ</a></li><li><a href="/2023/12/08/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E8%BF%9B%E9%98%B6%E5%86%85%E5%AE%B9%EF%BC%88%E9%94%81%E6%9C%BA%E5%88%B6%EF%BC%89/" title="Javaå¹¶å‘ç¼–ç¨‹_è¿›é˜¶å†…å®¹">Javaå¹¶å‘ç¼–ç¨‹_è¿›é˜¶å†…å®¹</a></li><li><a href="/2024/01/15/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E7%BA%BF%E7%A8%8B%E6%B1%A0/" title="Javaå¹¶å‘ç¼–ç¨‹_çº¿ç¨‹æ± ">Javaå¹¶å‘ç¼–ç¨‹_çº¿ç¨‹æ± </a></li><li><a href="/2024/03/09/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5_%E8%A1%A5%E5%85%85%E5%86%85%E5%AE%B901/" title="Javaå¹¶å‘ç¼–ç¨‹_åŸºç¡€æ¦‚å¿µ_è¡¥å……å†…å®¹01">Javaå¹¶å‘ç¼–ç¨‹_åŸºç¡€æ¦‚å¿µ_è¡¥å……å†…å®¹01</a></li></ul><h3 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h3><ul><li><a href="/2024/03/07/JVM%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="JVMå…¥é—¨_åŸºç¡€æ¦‚å¿µ">JVMå…¥é—¨_åŸºç¡€æ¦‚å¿µ</a></li><li><a href="/2024/04/25/JVM%E5%85%A5%E9%97%A8_%E5%AD%A6%E4%B9%A002/" title="JVMå…¥é—¨_å­¦ä¹ 02">JVMå…¥é—¨_å­¦ä¹ 02</a></li></ul><p>è§†é¢‘å­¦ä¹ ï¼š</p><ul><li><a href="/2024/05/08/JVM_%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/" title="JVM_åƒåœ¾å›æ”¶æœºåˆ¶">JVM_åƒåœ¾å›æ”¶æœºåˆ¶</a>    ğŸš©</li></ul><h3 id="ç½‘ç»œé€šä¿¡"><a href="#ç½‘ç»œé€šä¿¡" class="headerlink" title="ç½‘ç»œé€šä¿¡"></a>ç½‘ç»œé€šä¿¡</h3><h4 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h4><h4 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h4><ul><li><a href="/2024/03/31/websocket%E7%9A%84%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/" title="websocketçš„åŸºç¡€ä½¿ç”¨">websocketçš„åŸºç¡€ä½¿ç”¨</a></li></ul><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><h4 id="æ•°æ®åº“åŸºç¡€"><a href="#æ•°æ®åº“åŸºç¡€" class="headerlink" title="æ•°æ®åº“åŸºç¡€"></a>æ•°æ®åº“åŸºç¡€</h4><ul><li><a href="/2023/12/24/%E6%95%B0%E6%8D%AE%E5%BA%93_%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="æ•°æ®åº“_åŸºç¡€çŸ¥è¯†">æ•°æ®åº“_åŸºç¡€çŸ¥è¯†</a></li><li><a href="/2023/12/24/%E6%95%B0%E6%8D%AE%E5%BA%93_SQL%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="æ•°æ®åº“_SQLè¯­æ³•åŸºç¡€çŸ¥è¯†">æ•°æ®åº“_SQLè¯­æ³•åŸºç¡€çŸ¥è¯†</a></li><li><a href="/2023/12/24/%E6%95%B0%E6%8D%AE%E5%BA%93_SQL%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98/" title="æ•°æ®åº“_SQLå¸¸è§é¢è¯•é¢˜">æ•°æ®åº“_SQLå¸¸è§é¢è¯•é¢˜</a></li></ul><h4 id="MySQL-â˜†-ğŸš©"><a href="#MySQL-â˜†-ğŸš©" class="headerlink" title="MySQL â˜†   ğŸš©"></a>MySQL â˜†   ğŸš©</h4><hr><ul><li><a href="/2024/03/08/MySQL%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B901/" title="MySQLå­¦ä¹ _åŸºç¡€å†…å®¹01">MySQLå­¦ä¹ _åŸºç¡€å†…å®¹01</a></li><li><a href="/2023/12/15/MySQL%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A801/" title="MySQLå­¦ä¹ _æ€§èƒ½ä¼˜åŒ–">MySQLå­¦ä¹ _æ€§èƒ½ä¼˜åŒ–</a></li><li><a href="/2024/01/29/MySQL%E5%AD%A6%E4%B9%A0_%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/" title="MySQLå­¦ä¹ _æ•°æ®åº“ç´¢å¼•">MySQLå­¦ä¹ _æ•°æ®åº“ç´¢å¼•</a></li><li><a href="/2024/04/10/MySQL%E8%B0%83%E4%BC%98%E6%93%8D%E4%BD%9C/" title="MySQLè°ƒä¼˜æ“ä½œ">MySQLè°ƒä¼˜æ“ä½œ</a></li></ul><h4 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h4><ul><li><a href="/2023/11/16/Oracle_%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/" title="Oracle_å¸¸ç”¨æ“ä½œä½¿ç”¨è®°å½•">Oracle_å¸¸ç”¨æ“ä½œä½¿ç”¨è®°å½•</a></li></ul><h4 id="NOSQL"><a href="#NOSQL" class="headerlink" title="NOSQL"></a>NOSQL</h4><ul><li><a href="/2023/11/19/NoSQL_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="NoSQL_åŸºç¡€æ¦‚å¿µ">NoSQL_åŸºç¡€æ¦‚å¿µ</a></li></ul><h4 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h4><ul><li><a href="/2023/11/30/MongoDB_%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" title="MongoDB_åŸºæœ¬æ“ä½œ">MongoDB_åŸºæœ¬æ“ä½œ</a></li></ul><h4 id="æ—¶åºæ•°æ®åº“"><a href="#æ—¶åºæ•°æ®åº“" class="headerlink" title="æ—¶åºæ•°æ®åº“"></a>æ—¶åºæ•°æ®åº“</h4><ul><li><a href="/2024/03/29/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93/" title="æ—¶åºæ•°æ®åº“">æ—¶åºæ•°æ®åº“</a></li></ul><h3 id="å¸¸ç”¨æ¡†æ¶"><a href="#å¸¸ç”¨æ¡†æ¶" class="headerlink" title="å¸¸ç”¨æ¡†æ¶"></a>å¸¸ç”¨æ¡†æ¶</h3><h4 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h4><ul><li><a href="/2023/11/27/Spring%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/" title="Springå­¦ä¹ _åŸºç¡€å†…å®¹">Springå­¦ä¹ _åŸºç¡€å†…å®¹</a></li><li><a href="/2023/12/14/Spring%E5%AD%A6%E4%B9%A0_IOC/" title="Springå­¦ä¹ _IOC">Springå­¦ä¹ _IOC</a></li><li><a href="/2023/12/05/Spring%E5%AD%A6%E4%B9%A0_AOP/" title="Springå­¦ä¹ _AOP">Springå­¦ä¹ _AOP</a></li><li><a href="/2023/12/14/Spring%E5%AD%A6%E4%B9%A0_Spring_Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F/" title="Springå­¦ä¹ _Spring_Beançš„ä½œç”¨åŸŸ">Springå­¦ä¹ _Spring_Beançš„ä½œç”¨åŸŸ</a></li><li><a href="/2023/12/18/Spring%E5%AD%A6%E4%B9%A0_Spring_Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" title="Springå­¦ä¹ _Spring_Beançš„ç”Ÿå‘½å‘¨æœŸ">Springå­¦ä¹ _Spring_Beançš„ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="/2024/02/22/Spring%E5%AD%A6%E4%B9%A0_%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0/" title="Springå­¦ä¹ _å®˜æ–¹æ–‡æ¡£å­¦ä¹ ">Springå­¦ä¹ _å®˜æ–¹æ–‡æ¡£å­¦ä¹ </a></li></ul><h4 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h4><ul><li><a href="/2023/12/05/Spring%E5%AD%A6%E4%B9%A0_SpringMVC/" title="Springå­¦ä¹ _SpringMVC">Springå­¦ä¹ _SpringMVC</a></li></ul><h4 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h4><h4 id="MybatisPlus"><a href="#MybatisPlus" class="headerlink" title="MybatisPlus"></a>MybatisPlus</h4><ul><li><a href="/2023/12/25/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0_MyBatis-Plus%E4%BD%BF%E7%94%A8/" title="æ¡†æ¶å­¦ä¹ _MyBatis-Plusä½¿ç”¨">æ¡†æ¶å­¦ä¹ _MyBatis-Plusä½¿ç”¨</a></li></ul><h4 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h4><ul><li><a href="/2024/03/31/SpringSecurity%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8/" title="SpringSecurityå­¦ä¹ ä½¿ç”¨">SpringSecurityå­¦ä¹ ä½¿ç”¨</a></li></ul><h4 id="SpringBoot-â˜†"><a href="#SpringBoot-â˜†" class="headerlink" title="SpringBoot â˜†"></a>SpringBoot â˜†</h4><ul><li><a href="/2024/02/19/SpringBoot%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/" title="SpringBootå­¦ä¹ _åŸºç¡€å†…å®¹">SpringBootå­¦ä¹ _åŸºç¡€å†…å®¹</a></li><li><a href="/2023/12/19/SpringBoot%E5%AD%A6%E4%B9%A0_SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86/" title="SpringBootå­¦ä¹ _SpringBoot è‡ªåŠ¨è£…é…åŸç†">SpringBootå­¦ä¹ _SpringBoot è‡ªåŠ¨è£…é…åŸç†</a></li></ul><h4 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h4><ul><li><a href="/2024/02/08/Dubbo%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/" title="DubboåŸºç¡€ä½¿ç”¨">DubboåŸºç¡€ä½¿ç”¨</a></li></ul><h3 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h3><h4 id="æœ¬åœ°ç¼“å­˜"><a href="#æœ¬åœ°ç¼“å­˜" class="headerlink" title="æœ¬åœ°ç¼“å­˜"></a>æœ¬åœ°ç¼“å­˜</h4><ul><li><a href="/2024/04/17/Caffeine%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98%E4%BD%BF%E7%94%A8/" title="Caffeineæœ¬åœ°ç¼“å­˜ä½¿ç”¨">Caffeineæœ¬åœ°ç¼“å­˜ä½¿ç”¨</a></li></ul><h4 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a><strong>Redis</strong></h4><ul><li><a href="/2023/12/08/Redis%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="Rediså…¥é—¨_åŸºç¡€æ¦‚å¿µ">Rediså…¥é—¨_åŸºç¡€æ¦‚å¿µ</a></li><li><a href="/2023/12/25/Redis%E5%85%A5%E9%97%A8_%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB_Redis%E5%AE%9E%E6%88%98%E7%AF%87/" title="Rediså…¥é—¨_Rediså®æˆ˜ç¯‡">Rediså…¥é—¨_Rediså®æˆ˜ç¯‡</a></li><li><a href="/2024/04/21/Redis%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/" title="Rediså…¥é—¨_åŸºç¡€æ“ä½œ">Rediså…¥é—¨_åŸºç¡€æ“ä½œ</a></li></ul><p>è§†é¢‘å­¦ä¹ ï¼š</p><ul><li><a href="/2024/05/09/%E5%8A%A8%E7%94%BB%E5%AD%A6Redis%E8%BF%9B%E9%98%B6%E5%86%85%E5%AE%B9/" title="åŠ¨ç”»å­¦Redisè¿›é˜¶å†…å®¹">åŠ¨ç”»å­¦Redisè¿›é˜¶å†…å®¹</a></li></ul><h4 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a><strong>MQ</strong></h4><ul><li><a href="/2023/12/11/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="æ¶ˆæ¯é˜Ÿåˆ—_åŸºç¡€æ¦‚å¿µ">æ¶ˆæ¯é˜Ÿåˆ—_åŸºç¡€æ¦‚å¿µ</a>   ğŸš©</li></ul><h4 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h4><ul><li><a href="/2023/12/28/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RabbitMQ_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="æ¶ˆæ¯é˜Ÿåˆ—_RabbitMQ_åŸºç¡€æ¦‚å¿µ">æ¶ˆæ¯é˜Ÿåˆ—_RabbitMQ_åŸºç¡€æ¦‚å¿µ</a></li><li><a href="/2024/02/27/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RabbitMQ_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/" title="æ¶ˆæ¯é˜Ÿåˆ—_RabbitMQ_åŸºç¡€ä½¿ç”¨">æ¶ˆæ¯é˜Ÿåˆ—_RabbitMQ_åŸºç¡€ä½¿ç”¨</a></li><li><a href="/2023/12/03/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RabbitMQ%E7%9A%84%E5%AE%89%E8%A3%85/" title="RabbitMQçš„å®‰è£…ä¸ä½¿ç”¨">RabbitMQçš„å®‰è£…ä¸ä½¿ç”¨</a></li></ul><h4 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h4><ul><li><a href="/2024/03/07/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RocketMQ_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="æ¶ˆæ¯é˜Ÿåˆ—_RocketMQ_åŸºç¡€æ¦‚å¿µ">æ¶ˆæ¯é˜Ÿåˆ—_RocketMQ_åŸºç¡€æ¦‚å¿µ</a></li><li><a href="/2023/12/21/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RocketMQ_%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/" title="æ¶ˆæ¯é˜Ÿåˆ—_RocketMQ_å®‰è£…ä¸ä½¿ç”¨">æ¶ˆæ¯é˜Ÿåˆ—_RocketMQ_å®‰è£…ä¸ä½¿ç”¨</a></li><li><a href="/2024/04/18/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_RocketMQ_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/" title="æ¶ˆæ¯é˜Ÿåˆ—_RocketMQ_åŸºç¡€ä½¿ç”¨">æ¶ˆæ¯é˜Ÿåˆ—_RocketMQ_åŸºç¡€ä½¿ç”¨</a></li></ul><h4 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h4><ul><li><a href="/2023/12/30/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97_Kafka_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/" title="æ¶ˆæ¯é˜Ÿåˆ—_Kafka_åŸºç¡€ä½¿ç”¨">æ¶ˆæ¯é˜Ÿåˆ—_Kafka_åŸºç¡€ä½¿ç”¨</a></li></ul><h4 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h4><ul><li><a href="/2023/11/26/Elasticsearch_%E5%9F%BA%E7%A1%80%E5%86%85%E5%AE%B9/" title="Elasticsearch_åŸºç¡€å†…å®¹">Elasticsearch_åŸºç¡€å†…å®¹</a></li></ul><h4 id="Netty"><a href="#Netty" class="headerlink" title="Netty"></a>Netty</h4><ul><li><a href="/2024/01/16/Netty%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/" title="NettyåŸºç¡€ä½¿ç”¨">NettyåŸºç¡€ä½¿ç”¨</a></li></ul><h4 id="Canal"><a href="#Canal" class="headerlink" title="Canal"></a>Canal</h4><ul><li><a href="/2024/03/28/Canal%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/" title="CanalåŸºç¡€ä½¿ç”¨">CanalåŸºç¡€ä½¿ç”¨</a></li></ul><h3 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h3><h4 id="å¸¸ç”¨ç»„ä»¶"><a href="#å¸¸ç”¨ç»„ä»¶" class="headerlink" title="å¸¸ç”¨ç»„ä»¶"></a>å¸¸ç”¨ç»„ä»¶</h4><ul><li><a href="/2024/03/07/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_åŸºç¡€æ¦‚å¿µ">SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_åŸºç¡€æ¦‚å¿µ</a></li><li><a href="/2024/02/28/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/" title="SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_åŸºç¡€ä½¿ç”¨">SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_åŸºç¡€ä½¿ç”¨</a></li><li><a href="/2023/11/22/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Eureka/" title="SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Eureka">SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Eureka</a></li><li><a href="/2023/11/24/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Nacos/" title="SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Nacos">SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Nacos</a></li><li><a href="/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_OpenFeign/" title="SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_OpenFeign">SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_OpenFeign</a></li><li><a href="/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Gateway/" title="SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Gateway">SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Gateway</a></li><li><a href="/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Seata/" title="SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Seata">SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Seata</a></li><li><a href="/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Stream/" title="SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Stream">SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Stream</a></li><li><a href="/2023/12/04/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Sentinel/" title="SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Sentinel">SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Sentinel</a></li><li><a href="/2023/12/01/SpringCloud_%E7%BB%84%E4%BB%B6%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8_Sleuth+Zipkin/" title="SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Zipkin">SpringCloud_ç»„ä»¶åŸºæœ¬ä½¿ç”¨_Zipkin</a></li></ul><h4 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡"></a>åˆ†å¸ƒå¼äº‹åŠ¡</h4><ul><li><a href="/2024/04/25/SpringCloud_%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" title="åˆ†å¸ƒå¼äº‹åŠ¡">åˆ†å¸ƒå¼äº‹åŠ¡</a></li></ul><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><ul><li><a href="/2023/11/17/Docker%E5%85%A5%E9%97%A8_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="Dokcerå…¥é—¨_åŸºç¡€æ¦‚å¿µ">Dokcerå…¥é—¨_åŸºç¡€æ¦‚å¿µ</a></li><li><a href="/2024/01/12/Docker%E5%85%A5%E9%97%A8_Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" title="Dockerå…¥é—¨_Dockerçš„åŸºæœ¬ä½¿ç”¨">Dockerå…¥é—¨_Dockerçš„åŸºæœ¬ä½¿ç”¨</a></li><li><a href="/2024/01/22/Kubernetes/" title="Kubernetes">Kubernetes</a></li><li><a href="/2024/01/21/Portainer%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" title="Portainerç¯å¢ƒé…ç½®">Portainerç¯å¢ƒé…ç½®</a></li><li><a href="/2024/03/29/%E4%BA%91%E5%8E%9F%E7%94%9F/" title="äº‘åŸç”Ÿ">äº‘åŸç”Ÿ</a></li></ul><h3 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h3><ul><li><a href="/2024/03/02/%E7%BC%96%E7%A8%8B_%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="ç¼–ç¨‹_è®¾è®¡æ¨¡å¼">ç¼–ç¨‹_è®¾è®¡æ¨¡å¼</a>  ğŸ’£</li></ul><h3 id="æŠ€æœ¯åœºæ™¯"><a href="#æŠ€æœ¯åœºæ™¯" class="headerlink" title="æŠ€æœ¯åœºæ™¯"></a>æŠ€æœ¯åœºæ™¯</h3><ul><li><a href="/2024/03/10/%E9%9D%A2%E8%AF%95%E7%85%8E%E7%86%AC%E6%88%90%E8%9B%8B_%E9%A1%B9%E7%9B%AE%E5%9C%BA%E6%99%AF%E9%A2%98/" title="é¢è¯•ç…ç†¬æˆè›‹_é¡¹ç›®åœºæ™¯é¢˜">é¢è¯•ç…ç†¬æˆè›‹_é¡¹ç›®åœºæ™¯é¢˜</a></li></ul><h3 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h3><ul><li><a href="/2024/03/22/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" title="åˆ†å¸ƒå¼å­˜å‚¨">åˆ†å¸ƒå¼å­˜å‚¨</a></li><li><a href="/2024/03/22/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/" title="åˆ†å¸ƒå¼æˆæƒè®¿é—®">åˆ†å¸ƒå¼æˆæƒè®¿é—®</a></li></ul><h3 id="ç³»ç»Ÿè®¾è®¡"><a href="#ç³»ç»Ÿè®¾è®¡" class="headerlink" title="ç³»ç»Ÿè®¾è®¡"></a>ç³»ç»Ÿè®¾è®¡</h3><ul><li><a href="/2024/03/22/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1_%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8/" title="ç³»ç»Ÿè®¾è®¡_æ•°æ®å®‰å…¨">ç³»ç»Ÿè®¾è®¡_æ•°æ®å®‰å…¨</a></li></ul><h3 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h3><ul><li><a href="/2023/12/11/%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E5%92%8C%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B/" title="ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯é€‰å‹">ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯é€‰å‹</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>index</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaé›†åˆ_ArrayList å­¦ä¹ </title>
    <link href="/2023/11/14/Java%E9%9B%86%E5%90%88_ArrayList%E5%AD%A6%E4%B9%A0/"/>
    <url>/2023/11/14/Java%E9%9B%86%E5%90%88_ArrayList%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<p>å°† ArrayList çš„ç›¸å…³å†…å®¹å•ç‹¬æ‹¿å‡ºæ¥è®²ä¸€ä¸‹</p><h3 id="ä¸€ã€æ ¸å¿ƒæºç "><a href="#ä¸€ã€æ ¸å¿ƒæºç " class="headerlink" title="ä¸€ã€æ ¸å¿ƒæºç "></a>ä¸€ã€æ ¸å¿ƒæºç </h3><p>è¿™é‡Œä»¥ JDK1.8 ä¸ºä¾‹ï¼Œåˆ†æä¸€ä¸‹Â <code>ArrayList</code>Â çš„åº•å±‚æºç ã€‚</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-variable">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayList</span><span class="hljs-operator">&lt;</span><span class="hljs-variable">E</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">extends</span> <span class="hljs-title class_">AbstractList</span><span class="hljs-operator">&lt;</span><span class="hljs-variable">E</span><span class="hljs-operator">&gt;</span><br>        <span class="hljs-variable">implements</span> <span class="hljs-title class_">List</span><span class="hljs-operator">&lt;</span><span class="hljs-variable">E</span><span class="hljs-operator">&gt;</span>, <span class="hljs-title class_">RandomAccess</span>, <span class="hljs-title class_">Cloneable</span>, <span class="hljs-variable">java</span>.<span class="hljs-property">io</span>.<span class="hljs-property">Serializable</span> &#123;<br>    <span class="hljs-variable">private</span> <span class="hljs-keyword">static</span> <span class="hljs-variable">final</span> <span class="hljs-variable">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">8683452581122892189</span>L;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é»˜è®¤åˆå§‹å®¹é‡å¤§å°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">private</span> <span class="hljs-keyword">static</span> <span class="hljs-variable">final</span> int <span class="hljs-variable">DEFAULT_CAPACITY</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç©ºæ•°ç»„ï¼ˆç”¨äºç©ºå®ä¾‹ï¼‰ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">private</span> <span class="hljs-keyword">static</span> <span class="hljs-variable">final</span> <span class="hljs-title class_">Object</span>[] <span class="hljs-variable">EMPTY_ELEMENTDATA</span> <span class="hljs-operator">=</span> &#123;&#125;;<br><br>    <span class="hljs-comment">//ç”¨äºé»˜è®¤å¤§å°ç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ã€‚</span><br>    <span class="hljs-comment">//æˆ‘ä»¬æŠŠå®ƒä»EMPTY_ELEMENTDATAæ•°ç»„ä¸­åŒºåˆ†å‡ºæ¥ï¼Œä»¥çŸ¥é“åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶å®¹é‡éœ€è¦å¢åŠ å¤šå°‘ã€‚</span><br>    <span class="hljs-variable">private</span> <span class="hljs-keyword">static</span> <span class="hljs-variable">final</span> <span class="hljs-title class_">Object</span>[] <span class="hljs-variable">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span> <span class="hljs-operator">=</span> &#123;&#125;;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¿å­˜ArrayListæ•°æ®çš„æ•°ç»„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">transient</span> <span class="hljs-title class_">Object</span>[] <span class="hljs-variable">elementData</span>; <span class="hljs-comment">// non-private to simplify nested class access</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ArrayList æ‰€åŒ…å«çš„å…ƒç´ ä¸ªæ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">private</span> int <span class="hljs-variable">size</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¸¦åˆå§‹å®¹é‡å‚æ•°çš„æ„é€ å‡½æ•°ï¼ˆç”¨æˆ·å¯ä»¥åœ¨åˆ›å»ºArrayListå¯¹è±¡æ—¶è‡ªå·±æŒ‡å®šé›†åˆçš„åˆå§‹å¤§å°ï¼‰</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">ArrayList</span>(int initialCapacity) &#123;<br>        <span class="hljs-keyword">if</span> (initialCapacity <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//å¦‚æœä¼ å…¥çš„å‚æ•°å¤§äº0ï¼Œåˆ›å»ºinitialCapacityå¤§å°çš„æ•°ç»„</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">elementData</span> <span class="hljs-operator">=</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">Object</span>[initialCapacity];<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (initialCapacity <span class="hljs-operator">==</span> <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//å¦‚æœä¼ å…¥çš„å‚æ•°ç­‰äº0ï¼Œåˆ›å»ºç©ºæ•°ç»„</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">elementData</span> <span class="hljs-operator">=</span> <span class="hljs-variable">EMPTY_ELEMENTDATA</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//å…¶ä»–æƒ…å†µï¼ŒæŠ›å‡ºå¼‚å¸¸</span><br>            <span class="hljs-variable">throw</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Illegal Capacity: &quot;</span> <span class="hljs-operator">+</span><br>                    initialCapacity);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é»˜è®¤æ— å‚æ„é€ å‡½æ•°</span><br><span class="hljs-comment">     * DEFAULTCAPACITY_EMPTY_ELEMENTDATA ä¸º0.åˆå§‹åŒ–ä¸º10ï¼Œä¹Ÿå°±æ˜¯è¯´åˆå§‹å…¶å®æ˜¯ç©ºæ•°ç»„ å½“æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™æ•°ç»„å®¹é‡æ‰å˜æˆ10</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">ArrayList</span>() &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">elementData</span> <span class="hljs-operator">=</span> <span class="hljs-variable">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆçš„å…ƒç´ çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§å®ƒä»¬ç”±é›†åˆçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåºã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">ArrayList</span>(<span class="hljs-title class_">Collection</span><span class="hljs-operator">&lt;</span>? <span class="hljs-variable">extends</span> <span class="hljs-variable">E</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">c</span>) &#123;<br>        <span class="hljs-comment">//å°†æŒ‡å®šé›†åˆè½¬æ¢ä¸ºæ•°ç»„</span><br>        <span class="hljs-variable">elementData</span> <span class="hljs-operator">=</span> <span class="hljs-variable">c</span>.<span class="hljs-property">toArray</span>();<br>        <span class="hljs-comment">//å¦‚æœelementDataæ•°ç»„çš„é•¿åº¦ä¸ä¸º0</span><br>        <span class="hljs-keyword">if</span> ((<span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-variable">elementData</span>.<span class="hljs-property">length</span>) <span class="hljs-operator">!=</span> <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å¦‚æœelementDataä¸æ˜¯Objectç±»å‹æ•°æ®ï¼ˆc.toArrayå¯èƒ½è¿”å›çš„ä¸æ˜¯Objectç±»å‹çš„æ•°ç»„æ‰€ä»¥åŠ ä¸Šä¸‹é¢çš„è¯­å¥ç”¨äºåˆ¤æ–­ï¼‰</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">elementData</span>.<span class="hljs-property">getClass</span>() <span class="hljs-operator">!=</span> <span class="hljs-title class_">Object</span>[].<span class="hljs-property">class</span>)<br>                <span class="hljs-comment">//å°†åŸæ¥ä¸æ˜¯Objectç±»å‹çš„elementDataæ•°ç»„çš„å†…å®¹ï¼Œèµ‹å€¼ç»™æ–°çš„Objectç±»å‹çš„elementDataæ•°ç»„</span><br>                <span class="hljs-variable">elementData</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">Arrays</span>.<span class="hljs-property">copyOf</span>(<span class="hljs-variable">elementData</span>, <span class="hljs-variable">size</span>, <span class="hljs-title class_">Object</span>[].<span class="hljs-property">class</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// å…¶ä»–æƒ…å†µï¼Œç”¨ç©ºæ•°ç»„ä»£æ›¿</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">elementData</span> <span class="hljs-operator">=</span> <span class="hljs-variable">EMPTY_ELEMENTDATA</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¿®æ”¹è¿™ä¸ªArrayListå®ä¾‹çš„å®¹é‡æ˜¯åˆ—è¡¨çš„å½“å‰å¤§å°ã€‚ åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ­¤æ“ä½œæ¥æœ€å°åŒ–ArrayListå®ä¾‹çš„å­˜å‚¨ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">trimToSize</span>() &#123;<br>        <span class="hljs-variable">modCount</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">size</span> <span class="hljs-operator">&lt;</span> <span class="hljs-variable">elementData</span>.<span class="hljs-property">length</span>) &#123;<br>            <span class="hljs-variable">elementData</span> <span class="hljs-operator">=</span> (<span class="hljs-variable">size</span> <span class="hljs-operator">==</span> <span class="hljs-number">0</span>)<br>                    ? <span class="hljs-variable">EMPTY_ELEMENTDATA</span><br>                    : <span class="hljs-title class_">Arrays</span>.<span class="hljs-property">copyOf</span>(<span class="hljs-variable">elementData</span>, <span class="hljs-variable">size</span>);<br>        &#125;<br>    &#125;<br><span class="hljs-comment">//ä¸‹é¢æ˜¯ArrayListçš„æ‰©å®¹æœºåˆ¶</span><br><span class="hljs-comment">//ArrayListçš„æ‰©å®¹æœºåˆ¶æé«˜äº†æ€§èƒ½ï¼Œå¦‚æœæ¯æ¬¡åªæ‰©å……ä¸€ä¸ªï¼Œ</span><br><span class="hljs-comment">//é‚£ä¹ˆé¢‘ç¹çš„æ’å…¥ä¼šå¯¼è‡´é¢‘ç¹çš„æ‹·è´ï¼Œé™ä½æ€§èƒ½ï¼Œè€ŒArrayListçš„æ‰©å®¹æœºåˆ¶é¿å…äº†è¿™ç§æƒ…å†µã€‚</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¦‚æœ‰å¿…è¦ï¼Œå¢åŠ æ­¤ArrayListå®ä¾‹çš„å®¹é‡ï¼Œä»¥ç¡®ä¿å®ƒè‡³å°‘èƒ½å®¹çº³å…ƒç´ çš„æ•°é‡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> minCapacity æ‰€éœ€çš„æœ€å°å®¹é‡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">ensureCapacity</span>(<span class="hljs-params">int</span> <span class="hljs-params">minCapacity</span>) &#123;<br>        <span class="hljs-comment">//å¦‚æœæ˜¯trueï¼ŒminExpandçš„å€¼ä¸º0ï¼Œå¦‚æœæ˜¯false,minExpandçš„å€¼ä¸º10</span><br>        int <span class="hljs-variable">minExpand</span> <span class="hljs-operator">=</span> (<span class="hljs-variable">elementData</span> <span class="hljs-operator">!=</span> <span class="hljs-variable">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span>)<br>                <span class="hljs-comment">// any size if not default element table</span><br>                ? <span class="hljs-number">0</span><br>                <span class="hljs-comment">// larger than default for default empty table. It&#x27;s already</span><br>                <span class="hljs-comment">// supposed to be at default size.</span><br>                : <span class="hljs-variable">DEFAULT_CAPACITY</span>;<br>        <span class="hljs-comment">//å¦‚æœæœ€å°å®¹é‡å¤§äºå·²æœ‰çš„æœ€å¤§å®¹é‡</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">minCapacity</span> <span class="hljs-operator">&gt;</span> <span class="hljs-variable">minExpand</span>) &#123;<br>            <span class="hljs-title function_">ensureExplicitCapacity</span>(<span class="hljs-variable">minCapacity</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// æ ¹æ®ç»™å®šçš„æœ€å°å®¹é‡å’Œå½“å‰æ•°ç»„å…ƒç´ æ¥è®¡ç®—æ‰€éœ€å®¹é‡ã€‚</span><br>    <span class="hljs-variable">private</span> <span class="hljs-keyword">static</span> int <span class="hljs-title function_">calculateCapacity</span>(<span class="hljs-params">Object</span>[] <span class="hljs-params">elementData</span>, <span class="hljs-params">int</span> <span class="hljs-params">minCapacity</span>) &#123;<br>        <span class="hljs-comment">// å¦‚æœå½“å‰æ•°ç»„å…ƒç´ ä¸ºç©ºæ•°ç»„ï¼ˆåˆå§‹æƒ…å†µï¼‰ï¼Œè¿”å›é»˜è®¤å®¹é‡å’Œæœ€å°å®¹é‡ä¸­çš„è¾ƒå¤§å€¼ä½œä¸ºæ‰€éœ€å®¹é‡</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">elementData</span> <span class="hljs-operator">==</span> <span class="hljs-variable">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">max</span>(<span class="hljs-variable">DEFAULT_CAPACITY</span>, <span class="hljs-variable">minCapacity</span>);<br>        &#125;<br>        <span class="hljs-comment">// å¦åˆ™ç›´æ¥è¿”å›æœ€å°å®¹é‡</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">minCapacity</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// ç¡®ä¿å†…éƒ¨å®¹é‡è¾¾åˆ°æŒ‡å®šçš„æœ€å°å®¹é‡ã€‚</span><br>    <span class="hljs-variable">private</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">ensureCapacityInternal</span>(<span class="hljs-params">int</span> <span class="hljs-params">minCapacity</span>) &#123;<br>        <span class="hljs-title function_">ensureExplicitCapacity</span>(<span class="hljs-title function_">calculateCapacity</span>(<span class="hljs-variable">elementData</span>, <span class="hljs-variable">minCapacity</span>));<br>    &#125;<br><br>    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span><br>    <span class="hljs-variable">private</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">ensureExplicitCapacity</span>(<span class="hljs-params">int</span> <span class="hljs-params">minCapacity</span>) &#123;<br>        <span class="hljs-variable">modCount</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>;<br>        <span class="hljs-comment">// overflow-conscious code</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">minCapacity</span> <span class="hljs-operator">-</span> <span class="hljs-variable">elementData</span>.<span class="hljs-property">length</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>)<br>            <span class="hljs-comment">//è°ƒç”¨growæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä»£è¡¨å·²ç»å¼€å§‹æ‰©å®¹äº†</span><br>            <span class="hljs-title function_">grow</span>(<span class="hljs-variable">minCapacity</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¦åˆ†é…çš„æœ€å¤§æ•°ç»„å¤§å°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">private</span> <span class="hljs-keyword">static</span> <span class="hljs-variable">final</span> int <span class="hljs-variable">MAX_ARRAY_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">Integer</span>.<span class="hljs-property">MAX_VALUE</span> <span class="hljs-operator">-</span> <span class="hljs-number">8</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ArrayListæ‰©å®¹çš„æ ¸å¿ƒæ–¹æ³•ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">private</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">grow</span>(<span class="hljs-params">int</span> <span class="hljs-params">minCapacity</span>) &#123;<br>        <span class="hljs-comment">// oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡</span><br>        int <span class="hljs-variable">oldCapacity</span> <span class="hljs-operator">=</span> <span class="hljs-variable">elementData</span>.<span class="hljs-property">length</span>;<br>        <span class="hljs-comment">//å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ</span><br>        <span class="hljs-comment">//æˆ‘ä»¬çŸ¥é“ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ</span><br>        int <span class="hljs-variable">newCapacity</span> <span class="hljs-operator">=</span> <span class="hljs-variable">oldCapacity</span> <span class="hljs-operator">+</span> (<span class="hljs-variable">oldCapacity</span> <span class="hljs-operator">&gt;&gt;</span> <span class="hljs-number">1</span>);<br>        <span class="hljs-comment">//ç„¶åæ£€æŸ¥æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å°éœ€è¦å®¹é‡ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠæœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ï¼Œ</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">newCapacity</span> <span class="hljs-operator">-</span> <span class="hljs-variable">minCapacity</span> <span class="hljs-operator">&lt;</span> <span class="hljs-number">0</span>)<br>            <span class="hljs-variable">newCapacity</span> <span class="hljs-operator">=</span> <span class="hljs-variable">minCapacity</span>;<br>        <span class="hljs-comment">//å†æ£€æŸ¥æ–°å®¹é‡æ˜¯å¦è¶…å‡ºäº†ArrayListæ‰€å®šä¹‰çš„æœ€å¤§å®¹é‡ï¼Œ</span><br>        <span class="hljs-comment">//è‹¥è¶…å‡ºäº†ï¼Œåˆ™è°ƒç”¨hugeCapacity()æ¥æ¯”è¾ƒminCapacityå’Œ MAX_ARRAY_SIZEï¼Œ</span><br>        <span class="hljs-comment">//å¦‚æœminCapacityå¤§äºMAX_ARRAY_SIZEï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸ºInteger.MAX_VALUEï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZEã€‚</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">newCapacity</span> <span class="hljs-operator">-</span> <span class="hljs-variable">MAX_ARRAY_SIZE</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>)<br>            <span class="hljs-variable">newCapacity</span> <span class="hljs-operator">=</span> <span class="hljs-title function_">hugeCapacity</span>(<span class="hljs-variable">minCapacity</span>);<br>        <span class="hljs-comment">// minCapacity is usually close to size, so this is a win:</span><br>        <span class="hljs-variable">elementData</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">Arrays</span>.<span class="hljs-property">copyOf</span>(<span class="hljs-variable">elementData</span>, <span class="hljs-variable">newCapacity</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//æ¯”è¾ƒminCapacityå’Œ MAX_ARRAY_SIZE</span><br>    <span class="hljs-variable">private</span> <span class="hljs-keyword">static</span> int <span class="hljs-title function_">hugeCapacity</span>(<span class="hljs-params">int</span> <span class="hljs-params">minCapacity</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">minCapacity</span> <span class="hljs-operator">&lt;</span> <span class="hljs-number">0</span>) <span class="hljs-comment">// overflow</span><br>            <span class="hljs-variable">throw</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">OutOfMemoryError</span>();<br>        <span class="hljs-title function_">return</span> (<span class="hljs-variable">minCapacity</span> <span class="hljs-operator">&gt;</span> <span class="hljs-variable">MAX_ARRAY_SIZE</span>) ?<br>                <span class="hljs-title class_">Integer</span>.<span class="hljs-property">MAX_VALUE</span> :<br>                <span class="hljs-variable">MAX_ARRAY_SIZE</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›æ­¤åˆ—è¡¨ä¸­çš„å…ƒç´ æ•°ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> int <span class="hljs-title function_">size</span>() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">size</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å› true ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">boolean</span> <span class="hljs-title function_">isEmpty</span>() &#123;<br>        <span class="hljs-comment">//æ³¨æ„=å’Œ==çš„åŒºåˆ«</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">size</span> <span class="hljs-operator">==</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¦‚æœæ­¤åˆ—è¡¨åŒ…å«æŒ‡å®šçš„å…ƒç´ ï¼Œåˆ™è¿”å›true ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">boolean</span> <span class="hljs-title function_">contains</span>(<span class="hljs-params">Object</span> <span class="hljs-params">o</span>) &#123;<br>        <span class="hljs-comment">//indexOf()æ–¹æ³•ï¼šè¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«æ­¤å…ƒç´ ï¼Œåˆ™ä¸º-1</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">indexOf</span>(<span class="hljs-variable">o</span>) <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„é¦–æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«æ­¤å…ƒç´ ï¼Œåˆ™ä¸º-1</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> int <span class="hljs-title function_">indexOf</span>(<span class="hljs-params">Object</span> <span class="hljs-params">o</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">o</span> <span class="hljs-operator">==</span> <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">for</span> (int <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> <span class="hljs-operator">&lt;</span> <span class="hljs-variable">size</span>; <span class="hljs-variable">i</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>)<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">elementData</span>[<span class="hljs-variable">i</span>] <span class="hljs-operator">==</span> <span class="hljs-literal">null</span>)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-variable">i</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">for</span> (int <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> <span class="hljs-operator">&lt;</span> <span class="hljs-variable">size</span>; <span class="hljs-variable">i</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>)<br>                <span class="hljs-comment">//equals()æ–¹æ³•æ¯”è¾ƒ</span><br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">o</span>.<span class="hljs-property">equals</span>(<span class="hljs-variable">elementData</span>[<span class="hljs-variable">i</span>]))<br>                    <span class="hljs-keyword">return</span> <span class="hljs-variable">i</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šå…ƒç´ çš„æœ€åä¸€æ¬¡å‡ºç°çš„ç´¢å¼•ï¼Œå¦‚æœæ­¤åˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å›-1ã€‚.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> int <span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-params">Object</span> <span class="hljs-params">o</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">o</span> <span class="hljs-operator">==</span> <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">for</span> (int <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-variable">size</span> <span class="hljs-operator">-</span> <span class="hljs-number">1</span>; <span class="hljs-variable">i</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span>; <span class="hljs-variable">i</span><span class="hljs-operator">-</span><span class="hljs-operator">-</span>)<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">elementData</span>[<span class="hljs-variable">i</span>] <span class="hljs-operator">==</span> <span class="hljs-literal">null</span>)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-variable">i</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">for</span> (int <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-variable">size</span> <span class="hljs-operator">-</span> <span class="hljs-number">1</span>; <span class="hljs-variable">i</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span>; <span class="hljs-variable">i</span><span class="hljs-operator">-</span><span class="hljs-operator">-</span>)<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">o</span>.<span class="hljs-property">equals</span>(<span class="hljs-variable">elementData</span>[<span class="hljs-variable">i</span>]))<br>                    <span class="hljs-keyword">return</span> <span class="hljs-variable">i</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›æ­¤ArrayListå®ä¾‹çš„æµ…æ‹·è´ã€‚ ï¼ˆå…ƒç´ æœ¬èº«ä¸è¢«å¤åˆ¶ã€‚ï¼‰</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">clone</span>() &#123;<br>        <span class="hljs-title function_">try</span> &#123;<br>            <span class="hljs-title class_">ArrayList</span><span class="hljs-operator">&lt;</span>?<span class="hljs-operator">&gt;</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> (<span class="hljs-title class_">ArrayList</span><span class="hljs-operator">&lt;</span>?<span class="hljs-operator">&gt;</span>) <span class="hljs-variable language_">super</span>.<span class="hljs-property">clone</span>();<br>            <span class="hljs-comment">//Arrays.copyOfåŠŸèƒ½æ˜¯å®ç°æ•°ç»„çš„å¤åˆ¶ï¼Œè¿”å›å¤åˆ¶åçš„æ•°ç»„ã€‚å‚æ•°æ˜¯è¢«å¤åˆ¶çš„æ•°ç»„å’Œå¤åˆ¶çš„é•¿åº¦</span><br>            <span class="hljs-variable">v</span>.<span class="hljs-property">elementData</span> <span class="hljs-operator">=</span> <span class="hljs-title class_">Arrays</span>.<span class="hljs-property">copyOf</span>(<span class="hljs-variable">elementData</span>, <span class="hljs-variable">size</span>);<br>            <span class="hljs-variable">v</span>.<span class="hljs-property">modCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">v</span>;<br>        &#125; <span class="hljs-title function_">catch</span> (<span class="hljs-title class_">CloneNotSupportedException</span> <span class="hljs-variable">e</span>) &#123;<br>            <span class="hljs-comment">// è¿™ä¸åº”è¯¥å‘ç”Ÿï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯å¯ä»¥å…‹éš†çš„</span><br>            <span class="hljs-variable">throw</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">InternalError</span>(<span class="hljs-variable">e</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»¥æ­£ç¡®çš„é¡ºåºï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰è¿”å›ä¸€ä¸ªåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚</span><br><span class="hljs-comment">     * è¿”å›çš„æ•°ç»„å°†æ˜¯â€œå®‰å…¨çš„â€ï¼Œå› ä¸ºè¯¥åˆ—è¡¨ä¸ä¿ç•™å¯¹å®ƒçš„å¼•ç”¨ã€‚ ï¼ˆæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å¿…é¡»åˆ†é…ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼‰ã€‚</span><br><span class="hljs-comment">     * å› æ­¤ï¼Œè°ƒç”¨è€…å¯ä»¥è‡ªç”±åœ°ä¿®æ”¹è¿”å›çš„æ•°ç»„ã€‚ æ­¤æ–¹æ³•å……å½“åŸºäºé˜µåˆ—å’ŒåŸºäºé›†åˆçš„APIä¹‹é—´çš„æ¡¥æ¢ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">Object</span>[] <span class="hljs-title function_">toArray</span>() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Arrays</span>.<span class="hljs-property">copyOf</span>(<span class="hljs-variable">elementData</span>, <span class="hljs-variable">size</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›ä¸€ä¸ªåŒ…å«æ­¤åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ï¼ˆä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰;</span><br><span class="hljs-comment">     * è¿”å›çš„æ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹æ˜¯æŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹ã€‚ å¦‚æœåˆ—è¡¨é€‚åˆæŒ‡å®šçš„æ•°ç»„ï¼Œåˆ™è¿”å›å…¶ä¸­ã€‚</span><br><span class="hljs-comment">     * å¦åˆ™ï¼Œå°†ä¸ºæŒ‡å®šæ•°ç»„çš„è¿è¡Œæ—¶ç±»å‹å’Œæ­¤åˆ—è¡¨çš„å¤§å°åˆ†é…ä¸€ä¸ªæ–°æ•°ç»„ã€‚</span><br><span class="hljs-comment">     * å¦‚æœåˆ—è¡¨é€‚ç”¨äºæŒ‡å®šçš„æ•°ç»„ï¼Œå…¶ä½™ç©ºé—´ï¼ˆå³æ•°ç»„çš„åˆ—è¡¨æ•°é‡å¤šäºæ­¤å…ƒç´ ï¼‰ï¼Œåˆ™ç´§è·Ÿåœ¨é›†åˆç»“æŸåçš„æ•°ç»„ä¸­çš„å…ƒç´ è®¾ç½®ä¸ºnull ã€‚</span><br><span class="hljs-comment">     * ï¼ˆè¿™ä»…åœ¨è°ƒç”¨è€…çŸ¥é“åˆ—è¡¨ä¸åŒ…å«ä»»ä½•ç©ºå…ƒç´ çš„æƒ…å†µä¸‹æ‰èƒ½ç¡®å®šåˆ—è¡¨çš„é•¿åº¦ã€‚ï¼‰</span><br><span class="hljs-comment">     */</span><br>    @<span class="hljs-title class_">SuppressWarnings</span>(<span class="hljs-string">&quot;unchecked&quot;</span>)<br>    <span class="hljs-variable">public</span> <span class="hljs-operator">&lt;</span><span class="hljs-variable">T</span><span class="hljs-operator">&gt;</span> <span class="hljs-variable">T</span>[] <span class="hljs-title function_">toArray</span>(<span class="hljs-params">T</span>[] <span class="hljs-params">a</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">a</span>.<span class="hljs-property">length</span> <span class="hljs-operator">&lt;</span> <span class="hljs-variable">size</span>)<br>            <span class="hljs-comment">// æ–°å»ºä¸€ä¸ªè¿è¡Œæ—¶ç±»å‹çš„æ•°ç»„ï¼Œä½†æ˜¯ArrayListæ•°ç»„çš„å†…å®¹</span><br>            <span class="hljs-title function_">return</span> (<span class="hljs-variable">T</span>[]) <span class="hljs-title class_">Arrays</span>.<span class="hljs-property">copyOf</span>(<span class="hljs-variable">elementData</span>, <span class="hljs-variable">size</span>, <span class="hljs-variable">a</span>.<span class="hljs-property">getClass</span>());<br>        <span class="hljs-comment">//è°ƒç”¨Systemæä¾›çš„arraycopy()æ–¹æ³•å®ç°æ•°ç»„ä¹‹é—´çš„å¤åˆ¶</span><br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">arraycopy</span>(<span class="hljs-variable">elementData</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">a</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">size</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">a</span>.<span class="hljs-property">length</span> <span class="hljs-operator">&gt;</span> <span class="hljs-variable">size</span>)<br>            <span class="hljs-variable">a</span>[<span class="hljs-variable">size</span>] <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">a</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Positional Access Operations</span><br><br>    @<span class="hljs-title class_">SuppressWarnings</span>(<span class="hljs-string">&quot;unchecked&quot;</span>)<br>    <span class="hljs-variable">E</span> <span class="hljs-title function_">elementData</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>) &#123;<br>        <span class="hljs-title function_">return</span> (<span class="hljs-variable">E</span>) <span class="hljs-variable">elementData</span>[index];<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">E</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>) &#123;<br>        <span class="hljs-title function_">rangeCheck</span>(index);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">elementData</span>(index);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æŒ‡å®šçš„å…ƒç´ æ›¿æ¢æ­¤åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">E</span> <span class="hljs-title function_">set</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>, <span class="hljs-params">E</span> <span class="hljs-params">element</span>) &#123;<br>        <span class="hljs-comment">//å¯¹indexè¿›è¡Œç•Œé™æ£€æŸ¥</span><br>        <span class="hljs-title function_">rangeCheck</span>(index);<br><br>        <span class="hljs-variable">E</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> <span class="hljs-title function_">elementData</span>(index);<br>        <span class="hljs-variable">elementData</span>[index] <span class="hljs-operator">=</span> <span class="hljs-variable">element</span>;<br>        <span class="hljs-comment">//è¿”å›åŸæ¥åœ¨è¿™ä¸ªä½ç½®çš„å…ƒç´ </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">oldValue</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">boolean</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">E</span> <span class="hljs-params">e</span>) &#123;<br>        <span class="hljs-title function_">ensureCapacityInternal</span>(<span class="hljs-variable">size</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span>);  <span class="hljs-comment">// Increments modCount!!</span><br>        <span class="hljs-comment">//è¿™é‡Œçœ‹åˆ°ArrayListæ·»åŠ å…ƒç´ çš„å®è´¨å°±ç›¸å½“äºä¸ºæ•°ç»„èµ‹å€¼</span><br>        <span class="hljs-variable">elementData</span>[<span class="hljs-variable">size</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>] <span class="hljs-operator">=</span> <span class="hljs-variable">e</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åœ¨æ­¤åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®æ’å…¥æŒ‡å®šçš„å…ƒç´ ã€‚</span><br><span class="hljs-comment">     * å…ˆè°ƒç”¨ rangeCheckForAdd å¯¹indexè¿›è¡Œç•Œé™æ£€æŸ¥ï¼›ç„¶åè°ƒç”¨ ensureCapacityInternal æ–¹æ³•ä¿è¯capacityè¶³å¤Ÿå¤§ï¼›</span><br><span class="hljs-comment">     * å†å°†ä»indexå¼€å§‹ä¹‹åçš„æ‰€æœ‰æˆå‘˜åç§»ä¸€ä¸ªä½ç½®ï¼›å°†elementæ’å…¥indexä½ç½®ï¼›æœ€åsizeåŠ 1ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>, <span class="hljs-params">E</span> <span class="hljs-params">element</span>) &#123;<br>        <span class="hljs-title function_">rangeCheckForAdd</span>(index);<br><br>        <span class="hljs-title function_">ensureCapacityInternal</span>(<span class="hljs-variable">size</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span>);  <span class="hljs-comment">// Increments modCount!!</span><br>        <span class="hljs-comment">//arraycopy()è¿™ä¸ªå®ç°æ•°ç»„ä¹‹é—´å¤åˆ¶çš„æ–¹æ³•ä¸€å®šè¦çœ‹ä¸€ä¸‹ï¼Œä¸‹é¢å°±ç”¨åˆ°äº†arraycopy()æ–¹æ³•å®ç°æ•°ç»„è‡ªå·±å¤åˆ¶è‡ªå·±</span><br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">arraycopy</span>(<span class="hljs-variable">elementData</span>, index, <span class="hljs-variable">elementData</span>, index <span class="hljs-operator">+</span> <span class="hljs-number">1</span>,<br>                <span class="hljs-variable">size</span> <span class="hljs-operator">-</span> index);<br>        <span class="hljs-variable">elementData</span>[index] <span class="hljs-operator">=</span> <span class="hljs-variable">element</span>;<br>        <span class="hljs-variable">size</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤è¯¥åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ å°†ä»»ä½•åç»­å…ƒç´ ç§»åŠ¨åˆ°å·¦ä¾§ï¼ˆä»å…¶ç´¢å¼•ä¸­å‡å»ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">E</span> <span class="hljs-title function_">remove</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>) &#123;<br>        <span class="hljs-title function_">rangeCheck</span>(index);<br><br>        <span class="hljs-variable">modCount</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>;<br>        <span class="hljs-variable">E</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> <span class="hljs-title function_">elementData</span>(index);<br><br>        int <span class="hljs-variable">numMoved</span> <span class="hljs-operator">=</span> <span class="hljs-variable">size</span> <span class="hljs-operator">-</span> index <span class="hljs-operator">-</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">numMoved</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>)<br>            <span class="hljs-title class_">System</span>.<span class="hljs-property">arraycopy</span>(<span class="hljs-variable">elementData</span>, index <span class="hljs-operator">+</span> <span class="hljs-number">1</span>, <span class="hljs-variable">elementData</span>, index,<br>                    <span class="hljs-variable">numMoved</span>);<br>        <span class="hljs-variable">elementData</span>[<span class="hljs-operator">-</span><span class="hljs-operator">-</span><span class="hljs-variable">size</span>] <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// clear to let GC do its work</span><br>        <span class="hljs-comment">//ä»åˆ—è¡¨ä¸­åˆ é™¤çš„å…ƒç´ </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">oldValue</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šå…ƒç´ çš„ç¬¬ä¸€ä¸ªå‡ºç°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ å¦‚æœåˆ—è¡¨ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™å®ƒä¸ä¼šæ›´æ”¹ã€‚</span><br><span class="hljs-comment">     * è¿”å›trueï¼Œå¦‚æœæ­¤åˆ—è¡¨åŒ…å«æŒ‡å®šçš„å…ƒç´ </span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">boolean</span> <span class="hljs-title function_">remove</span>(<span class="hljs-params">Object</span> <span class="hljs-params">o</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">o</span> <span class="hljs-operator">==</span> <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">for</span> (int index <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; index <span class="hljs-operator">&lt;</span> <span class="hljs-variable">size</span>; index<span class="hljs-operator">+</span><span class="hljs-operator">+</span>)<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">elementData</span>[index] <span class="hljs-operator">==</span> <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-title function_">fastRemove</span>(index);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">for</span> (int index <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; index <span class="hljs-operator">&lt;</span> <span class="hljs-variable">size</span>; index<span class="hljs-operator">+</span><span class="hljs-operator">+</span>)<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">o</span>.<span class="hljs-property">equals</span>(<span class="hljs-variable">elementData</span>[index])) &#123;<br>                    <span class="hljs-title function_">fastRemove</span>(index);<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * Private remove method that skips bounds checking and does not</span><br><span class="hljs-comment">     * return the value removed.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">private</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">fastRemove</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>) &#123;<br>        <span class="hljs-variable">modCount</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>;<br>        int <span class="hljs-variable">numMoved</span> <span class="hljs-operator">=</span> <span class="hljs-variable">size</span> <span class="hljs-operator">-</span> index <span class="hljs-operator">-</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">numMoved</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>)<br>            <span class="hljs-title class_">System</span>.<span class="hljs-property">arraycopy</span>(<span class="hljs-variable">elementData</span>, index <span class="hljs-operator">+</span> <span class="hljs-number">1</span>, <span class="hljs-variable">elementData</span>, index,<br>                    <span class="hljs-variable">numMoved</span>);<br>        <span class="hljs-variable">elementData</span>[<span class="hljs-operator">-</span><span class="hljs-operator">-</span><span class="hljs-variable">size</span>] <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// clear to let GC do its work</span><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»åˆ—è¡¨ä¸­åˆ é™¤æ‰€æœ‰å…ƒç´ ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">clear</span>() &#123;<br>        <span class="hljs-variable">modCount</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>;<br><br>        <span class="hljs-comment">// æŠŠæ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ çš„å€¼è®¾ä¸ºnull</span><br>        <span class="hljs-keyword">for</span> (int <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> <span class="hljs-operator">&lt;</span> <span class="hljs-variable">size</span>; <span class="hljs-variable">i</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>)<br>            <span class="hljs-variable">elementData</span>[<span class="hljs-variable">i</span>] <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŒ‰æŒ‡å®šé›†åˆçš„Iteratorè¿”å›çš„é¡ºåºå°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">boolean</span> <span class="hljs-title function_">addAll</span>(<span class="hljs-params">Collection</span>&lt;? <span class="hljs-params">extends</span> <span class="hljs-params">E</span>&gt; <span class="hljs-params">c</span>) &#123;<br>        <span class="hljs-title class_">Object</span>[] <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-variable">c</span>.<span class="hljs-property">toArray</span>();<br>        int <span class="hljs-variable">numNew</span> <span class="hljs-operator">=</span> <span class="hljs-variable">a</span>.<span class="hljs-property">length</span>;<br>        <span class="hljs-title function_">ensureCapacityInternal</span>(<span class="hljs-variable">size</span> <span class="hljs-operator">+</span> <span class="hljs-variable">numNew</span>);  <span class="hljs-comment">// Increments modCount</span><br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">arraycopy</span>(<span class="hljs-variable">a</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">elementData</span>, <span class="hljs-variable">size</span>, <span class="hljs-variable">numNew</span>);<br>        <span class="hljs-variable">size</span> <span class="hljs-operator">+</span><span class="hljs-operator">=</span> <span class="hljs-variable">numNew</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">numNew</span> <span class="hljs-operator">!=</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å°†æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ æ’å…¥åˆ°æ­¤åˆ—è¡¨ä¸­ï¼Œä»æŒ‡å®šçš„ä½ç½®å¼€å§‹ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">boolean</span> <span class="hljs-title function_">addAll</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>, <span class="hljs-params">Collection</span>&lt;? <span class="hljs-params">extends</span> <span class="hljs-params">E</span>&gt; <span class="hljs-params">c</span>) &#123;<br>        <span class="hljs-title function_">rangeCheckForAdd</span>(index);<br><br>        <span class="hljs-title class_">Object</span>[] <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-variable">c</span>.<span class="hljs-property">toArray</span>();<br>        int <span class="hljs-variable">numNew</span> <span class="hljs-operator">=</span> <span class="hljs-variable">a</span>.<span class="hljs-property">length</span>;<br>        <span class="hljs-title function_">ensureCapacityInternal</span>(<span class="hljs-variable">size</span> <span class="hljs-operator">+</span> <span class="hljs-variable">numNew</span>);  <span class="hljs-comment">// Increments modCount</span><br><br>        int <span class="hljs-variable">numMoved</span> <span class="hljs-operator">=</span> <span class="hljs-variable">size</span> <span class="hljs-operator">-</span> index;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">numMoved</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>)<br>            <span class="hljs-title class_">System</span>.<span class="hljs-property">arraycopy</span>(<span class="hljs-variable">elementData</span>, index, <span class="hljs-variable">elementData</span>, index <span class="hljs-operator">+</span> <span class="hljs-variable">numNew</span>,<br>                    <span class="hljs-variable">numMoved</span>);<br><br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">arraycopy</span>(<span class="hljs-variable">a</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">elementData</span>, index, <span class="hljs-variable">numNew</span>);<br>        <span class="hljs-variable">size</span> <span class="hljs-operator">+</span><span class="hljs-operator">=</span> <span class="hljs-variable">numNew</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">numNew</span> <span class="hljs-operator">!=</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤æ‰€æœ‰ç´¢å¼•ä¸ºfromIndex ï¼ˆå«ï¼‰å’ŒtoIndexä¹‹é—´çš„å…ƒç´ ã€‚</span><br><span class="hljs-comment">     * å°†ä»»ä½•åç»­å…ƒç´ ç§»åŠ¨åˆ°å·¦ä¾§ï¼ˆå‡å°‘å…¶ç´¢å¼•ï¼‰ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">protected</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">removeRange</span>(<span class="hljs-params">int</span> <span class="hljs-params">fromIndex</span>, <span class="hljs-params">int</span> <span class="hljs-params">toIndex</span>) &#123;<br>        <span class="hljs-variable">modCount</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>;<br>        int <span class="hljs-variable">numMoved</span> <span class="hljs-operator">=</span> <span class="hljs-variable">size</span> <span class="hljs-operator">-</span> <span class="hljs-variable">toIndex</span>;<br>        <span class="hljs-title class_">System</span>.<span class="hljs-property">arraycopy</span>(<span class="hljs-variable">elementData</span>, <span class="hljs-variable">toIndex</span>, <span class="hljs-variable">elementData</span>, <span class="hljs-variable">fromIndex</span>,<br>                <span class="hljs-variable">numMoved</span>);<br><br>        <span class="hljs-comment">// clear to let GC do its work</span><br>        int <span class="hljs-variable">newSize</span> <span class="hljs-operator">=</span> <span class="hljs-variable">size</span> <span class="hljs-operator">-</span> (<span class="hljs-variable">toIndex</span> <span class="hljs-operator">-</span> <span class="hljs-variable">fromIndex</span>);<br>        <span class="hljs-keyword">for</span> (int <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-variable">newSize</span>; <span class="hljs-variable">i</span> <span class="hljs-operator">&lt;</span> <span class="hljs-variable">size</span>; <span class="hljs-variable">i</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>) &#123;<br>            <span class="hljs-variable">elementData</span>[<span class="hljs-variable">i</span>] <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-variable">newSize</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ£€æŸ¥ç»™å®šçš„ç´¢å¼•æ˜¯å¦åœ¨èŒƒå›´å†…ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">private</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">rangeCheck</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>) &#123;<br>        <span class="hljs-keyword">if</span> (index <span class="hljs-operator">&gt;=</span> <span class="hljs-variable">size</span>)<br>            <span class="hljs-variable">throw</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">IndexOutOfBoundsException</span>(<span class="hljs-title function_">outOfBoundsMsg</span>(index));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * addå’ŒaddAllä½¿ç”¨çš„rangeCheckçš„ä¸€ä¸ªç‰ˆæœ¬</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">private</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">rangeCheckForAdd</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>) &#123;<br>        <span class="hljs-keyword">if</span> (index <span class="hljs-operator">&gt;</span> <span class="hljs-variable">size</span> <span class="hljs-operator">||</span> index <span class="hljs-operator">&lt;</span> <span class="hljs-number">0</span>)<br>            <span class="hljs-variable">throw</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">IndexOutOfBoundsException</span>(<span class="hljs-title function_">outOfBoundsMsg</span>(index));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›IndexOutOfBoundsExceptionç»†èŠ‚ä¿¡æ¯</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">outOfBoundsMsg</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Index: &quot;</span> <span class="hljs-operator">+</span> index <span class="hljs-operator">+</span> <span class="hljs-string">&quot;, Size: &quot;</span> <span class="hljs-operator">+</span> <span class="hljs-variable">size</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šé›†åˆä¸­åŒ…å«çš„æ‰€æœ‰å…ƒç´ ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">boolean</span> <span class="hljs-title function_">removeAll</span>(<span class="hljs-params">Collection</span>&lt;?&gt; <span class="hljs-params">c</span>) &#123;<br>        <span class="hljs-title class_">Objects</span>.<span class="hljs-property">requireNonNull</span>(<span class="hljs-variable">c</span>);<br>        <span class="hljs-comment">//å¦‚æœæ­¤åˆ—è¡¨è¢«ä¿®æ”¹åˆ™è¿”å›true</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">batchRemove</span>(<span class="hljs-variable">c</span>, <span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»…ä¿ç•™æ­¤åˆ—è¡¨ä¸­åŒ…å«åœ¨æŒ‡å®šé›†åˆä¸­çš„å…ƒç´ ã€‚</span><br><span class="hljs-comment">     * æ¢å¥è¯è¯´ï¼Œä»æ­¤åˆ—è¡¨ä¸­åˆ é™¤å…¶ä¸­ä¸åŒ…å«åœ¨æŒ‡å®šé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-variable">boolean</span> <span class="hljs-title function_">retainAll</span>(<span class="hljs-params">Collection</span>&lt;?&gt; <span class="hljs-params">c</span>) &#123;<br>        <span class="hljs-title class_">Objects</span>.<span class="hljs-property">requireNonNull</span>(<span class="hljs-variable">c</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">batchRemove</span>(<span class="hljs-variable">c</span>, <span class="hljs-literal">true</span>);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»åˆ—è¡¨ä¸­çš„æŒ‡å®šä½ç½®å¼€å§‹ï¼Œè¿”å›åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼ˆæŒ‰æ­£ç¡®é¡ºåºï¼‰çš„åˆ—è¡¨è¿­ä»£å™¨ã€‚</span><br><span class="hljs-comment">     * æŒ‡å®šçš„ç´¢å¼•è¡¨ç¤ºåˆå§‹è°ƒç”¨å°†è¿”å›çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºnext ã€‚ åˆå§‹è°ƒç”¨previouså°†è¿”å›æŒ‡å®šç´¢å¼•å‡1çš„å…ƒç´ ã€‚</span><br><span class="hljs-comment">     * è¿”å›çš„åˆ—è¡¨è¿­ä»£å™¨æ˜¯fail-fast ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">ListIterator</span><span class="hljs-operator">&lt;</span><span class="hljs-variable">E</span><span class="hljs-operator">&gt;</span> <span class="hljs-title function_">listIterator</span>(<span class="hljs-params">int</span> <span class="hljs-params">index</span>) &#123;<br>        <span class="hljs-keyword">if</span> (index <span class="hljs-operator">&lt;</span> <span class="hljs-number">0</span> <span class="hljs-operator">||</span> index <span class="hljs-operator">&gt;</span> <span class="hljs-variable">size</span>)<br>            <span class="hljs-variable">throw</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">IndexOutOfBoundsException</span>(<span class="hljs-string">&quot;Index: &quot;</span> <span class="hljs-operator">+</span> index);<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">ListItr</span>(index);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›åˆ—è¡¨ä¸­çš„åˆ—è¡¨è¿­ä»£å™¨ï¼ˆæŒ‰é€‚å½“çš„é¡ºåºï¼‰ã€‚</span><br><span class="hljs-comment">     * è¿”å›çš„åˆ—è¡¨è¿­ä»£å™¨æ˜¯fail-fast ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">ListIterator</span><span class="hljs-operator">&lt;</span><span class="hljs-variable">E</span><span class="hljs-operator">&gt;</span> <span class="hljs-title function_">listIterator</span>() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">ListItr</span>(<span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»¥æ­£ç¡®çš„é¡ºåºè¿”å›è¯¥åˆ—è¡¨ä¸­çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚</span><br><span class="hljs-comment">     * è¿”å›çš„è¿­ä»£å™¨æ˜¯fail-fast ã€‚</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-variable">public</span> <span class="hljs-title class_">Iterator</span><span class="hljs-operator">&lt;</span><span class="hljs-variable">E</span><span class="hljs-operator">&gt;</span> <span class="hljs-title function_">iterator</span>() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title class_">Itr</span>();<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="äºŒã€ArrayList-æ‰©å®¹æœºåˆ¶"><a href="#äºŒã€ArrayList-æ‰©å®¹æœºåˆ¶" class="headerlink" title="äºŒã€ArrayList æ‰©å®¹æœºåˆ¶"></a>äºŒã€ArrayList æ‰©å®¹æœºåˆ¶</h3><p>å…ˆäº†è§£ä¸€ä¸‹åŸºç¡€çš„ ArrayList çš„æ‰©å®¹æœºåˆ¶æ¦‚å¿µï¼š<code>ArrayList</code> çš„å†…éƒ¨ä½¿ç”¨æ•°ç»„å­˜å‚¨å…ƒç´ ï¼Œå½“æ·»åŠ çš„å…ƒç´ è¶…è¿‡å½“å‰æ•°ç»„å®¹é‡æ—¶ï¼Œ<code>ArrayList</code> ä¼šè‡ªåŠ¨æ‰©å®¹ï¼ˆé€šå¸¸æ˜¯æ‰©å¤§åˆ°åŸæ¥çš„ 1.5 å€ï¼‰ï¼Œä»¥å®¹çº³æ›´å¤šçš„å…ƒç´ ã€‚</p><p>è¿™é‡Œä»¥æ— å‚æ„é€ å‡½æ•°åˆ›å»ºçš„ ArrayList ä¸ºä¾‹åˆ†æ, ï¼ˆJDK8ï¼‰</p><h4 id="add-æ–¹æ³•"><a href="#add-æ–¹æ³•" class="headerlink" title="add æ–¹æ³•"></a>add æ–¹æ³•</h4><p>æˆ‘ä»¬æ¥çœ‹ add æ–¹æ³•</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ã€‚</span><br><span class="hljs-comment"> */</span> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>&#123; <br><span class="hljs-comment">//æ·»åŠ å…ƒç´ ä¹‹å‰ï¼Œå…ˆè°ƒç”¨ensureCapacityInternal æ–¹æ³•</span><br>    <span class="hljs-built_in">ensureCapacityInternal</span>(size + <span class="hljs-number">1</span>);  <span class="hljs-comment">// Increments modCount!!  </span><br>    <span class="hljs-comment">//è¿™é‡Œçœ‹åˆ°ArrayListæ·»åŠ å…ƒç´ çš„å®è´¨å°±ç›¸å½“äºä¸ºæ•°ç»„èµ‹å€¼</span><br>    elementData[size++] = e;  <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>ï¼šJDK11 ç§»é™¤äº† <code>ensureCapacityInternal()</code> å’Œ <code>ensureExplicitCapacity()</code> æ–¹æ³•</p></blockquote><h4 id="ensureCapacityInternal-æ–¹æ³•"><a href="#ensureCapacityInternal-æ–¹æ³•" class="headerlink" title="ensureCapacityInternal æ–¹æ³•"></a>ensureCapacityInternal æ–¹æ³•</h4><p>è¿›å…¥ ensureCapacityInternal æ–¹æ³•</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//å¾—åˆ°æœ€å°æ‰©å®¹é‡</span><br><span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">ensureCapacityInternal</span>(<span class="hljs-params">int minCapacity</span>) &#123;  <br>    <span class="hljs-keyword">if</span> (elementData == <span class="hljs-variable constant_">DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span>) &#123;  <br>    <span class="hljs-comment">// è·å–é»˜è®¤çš„å®¹é‡å’Œä¼ å…¥å‚æ•°çš„æ¯”è¾ƒæœ€å¤§å€¼</span><br>        minCapacity = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-variable constant_">DEFAULT_CAPACITY</span>, minCapacity);  <br>    &#125;  <br>  <br>    <span class="hljs-title function_">ensureExplicitCapacity</span>(minCapacity);  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>add</code> æ–¹æ³• é¦–å…ˆè°ƒç”¨äº†<code>ensureCapacityInternal(size + 1)</code>,  ArrayList çš„é»˜è®¤å®¹é‡æ˜¯ 10ï¼›</p><p>å½“ è¦ add è¿›ç¬¬ 1 ä¸ªå…ƒç´ æ—¶ï¼ŒminCapacity ä¸º 1ï¼Œåœ¨ Math.max( )æ–¹æ³•æ¯”è¾ƒåï¼ŒminCapacity ä¸º 10ã€‚</p><h4 id="ensureExplicitCapacity-æ–¹æ³•"><a href="#ensureExplicitCapacity-æ–¹æ³•" class="headerlink" title="ensureExplicitCapacity() æ–¹æ³•"></a><code>ensureExplicitCapacity()</code> æ–¹æ³•</h4><p>è¿›å…¥åˆ° <code>ensureExplicitCapacity()</code> æ–¹æ³•</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span><br>private void <span class="hljs-built_in">ensureExplicitCapacity</span>(int minCapacity) &#123;  <br>    modCount++;  <br>  <br>    <span class="hljs-comment">// overflow-conscious code  </span><br>    if (minCapacity - elementData.length &gt; <span class="hljs-number">0</span>)  <br>    <span class="hljs-comment">//è°ƒç”¨growæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼Œè°ƒç”¨æ­¤æ–¹æ³•ä»£è¡¨å·²ç»å¼€å§‹æ‰©å®¹äº†</span><br>        <span class="hljs-built_in">grow</span>(minCapacity);  <br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å½“ add æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ åˆ° ArrayList æ—¶ï¼Œ<ul><li>elementData.length ä¸º 0 ï¼ˆæ­¤æ—¶è¿˜æ˜¯ä¸€ä¸ªç©ºçš„ listï¼‰ï¼›</li><li>æ‰§è¡Œ <code>ensureCapacityInternal()</code> æ–¹æ³• ï¼Œ minCapacity æ­¤æ—¶ä¸º 10ã€‚</li><li>æ­¤æ—¶ï¼Œ<code>minCapacity - elementData.length &gt; 0</code>æˆç«‹ï¼Œä¼šè¿›å…¥ <code>grow(minCapacity)</code> æ–¹æ³•ã€‚</li></ul></li><li>å½“ add ç¬¬ 2 ä¸ªå…ƒç´ æ—¶ï¼Œ<ul><li>minCapacity ä¸º 2ï¼Œæ­¤æ—¶ elementData.length(å®¹é‡)åœ¨æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ åæ‰©å®¹æˆ 10 äº†ã€‚</li><li>æ­¤æ—¶ï¼Œ<code>minCapacity - elementData.length &gt; 0</code> ä¸æˆç«‹ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥ ï¼ˆæ‰§è¡Œï¼‰<code>grow(minCapacity)</code> æ–¹æ³•ã€‚</li></ul></li><li>æ·»åŠ ç¬¬ 3ã€4Â·Â·Â·åˆ°ç¬¬ 10 ä¸ªå…ƒç´ æ—¶ï¼Œä¾ç„¶ä¸ä¼šæ‰§è¡Œ grow æ–¹æ³•ï¼Œæ•°ç»„å®¹é‡éƒ½ä¸º 10ã€‚</li></ul><p>ç›´åˆ°æ·»åŠ ç¬¬ 11 ä¸ªå…ƒç´ ï¼ŒminCapacity(ä¸º 11)æ¯” elementData.lengthï¼ˆä¸º 10ï¼‰è¦å¤§ã€‚è¿›å…¥ grow æ–¹æ³•è¿›è¡Œæ‰©å®¹ã€‚</p><h4 id="grow-æ–¹æ³•"><a href="#grow-æ–¹æ³•" class="headerlink" title="grow æ–¹æ³•"></a><code>grow æ–¹æ³•</code></h4><p>è¿›å…¥åˆ° <code>grow æ–¹æ³•</code></p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-comment">//è¦åˆ†é…çš„æœ€å¤§æ•°ç»„å¤§å°</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> int MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="hljs-number">8</span>;<br><br><br><span class="hljs-comment">/**  </span><br><span class="hljs-comment"> * Increases the capacity to ensure that it can hold at least the number of elements specified by the minimum capacity argument. </span><br><span class="hljs-comment"> * @param minCapacity - the desired minimum capacity  </span><br><span class="hljs-comment"> * ArrayListæ‰©å®¹çš„æ ¸å¿ƒæ–¹æ³•ã€‚</span><br><span class="hljs-comment">*/</span><br> <span class="hljs-keyword">private</span> void grow(int minCapacity) &#123;  <br>    <span class="hljs-comment">// overflow-conscious code  </span><br>    <span class="hljs-comment">// oldCapacityä¸ºæ—§å®¹é‡ï¼ŒnewCapacityä¸ºæ–°å®¹é‡</span><br>    int oldCapacity = elementData.length;  <br>    <span class="hljs-comment">//å°†oldCapacity å³ç§»ä¸€ä½ï¼Œå…¶æ•ˆæœç›¸å½“äºoldCapacity /2ï¼Œ</span><br>    <span class="hljs-comment">//ä½è¿ç®—çš„é€Ÿåº¦è¿œè¿œå¿«äºæ•´é™¤è¿ç®—ï¼Œæ•´å¥è¿ç®—å¼çš„ç»“æœå°±æ˜¯å°†æ–°å®¹é‡æ›´æ–°ä¸ºæ—§å®¹é‡çš„1.5å€ï¼Œ</span><br>    int <span class="hljs-keyword">new</span><span class="hljs-type">Capacity</span> = oldCapacity + (oldCapacity &gt;&gt; <span class="hljs-number">1</span>);  <br>    <span class="hljs-comment">//æ£€æŸ¥æ–°å®¹é‡æ˜¯å¦å¤§äºæœ€å°éœ€è¦å®¹é‡ï¼Œè‹¥è¿˜æ˜¯å°äºæœ€å°éœ€è¦å®¹é‡ï¼Œé‚£ä¹ˆå°±æŠŠæœ€å°éœ€è¦å®¹é‡å½“ä½œæ•°ç»„çš„æ–°å®¹é‡ï¼Œ</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span><span class="hljs-type">Capacity</span> - minCapacity &lt; <span class="hljs-number">0</span>)  <br>        <span class="hljs-keyword">new</span><span class="hljs-type">Capacity</span> = minCapacity;  <br>    <span class="hljs-comment">// å¦‚æœæ–°å®¹é‡å¤§äº MAX_ARRAY_SIZE,è¿›å…¥(æ‰§è¡Œ) `hugeCapacity()` æ–¹æ³•æ¥æ¯”è¾ƒ minCapacity å’Œ MAX_ARRAY_SIZEï¼Œ</span><br>    <span class="hljs-comment">//å¦‚æœminCapacityå¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º`Integer.MAX_VALUE`ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º `Integer.MAX_VALUE - 8`ã€‚</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span><span class="hljs-type">Capacity</span> - MAX_ARRAY_SIZE &gt; <span class="hljs-number">0</span>)  <br>        <span class="hljs-keyword">new</span><span class="hljs-type">Capacity</span> = hugeCapacity(minCapacity);  <br>    <span class="hljs-comment">// minCapacity is usually close to size, so this is a win:  </span><br>    elementData = Arrays.copyOf(elementData, <span class="hljs-keyword">new</span><span class="hljs-type">Capacity</span>);  <br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å½“ add ç¬¬ 1 ä¸ªå…ƒç´ æ—¶ï¼Œ<ul><li>oldCapacity ä¸º 0ï¼Œç»æ¯”è¾ƒåç¬¬ä¸€ä¸ª if åˆ¤æ–­æˆç«‹ï¼Œ**newCapacity &#x3D; minCapacity(ä¸º 10)**ã€‚</li><li>ä½†æ˜¯ç¬¬äºŒä¸ª if åˆ¤æ–­ä¸ä¼šæˆç«‹ï¼Œå³ newCapacity ä¸æ¯” MAX_ARRAY_SIZE å¤§ï¼Œåˆ™ä¸ä¼šè¿›å…¥ <code>hugeCapacity</code> æ–¹æ³•ã€‚</li><li>æ•°ç»„å®¹é‡ä¸º 10ï¼Œadd æ–¹æ³•ä¸­ return true, </li><li>size å¢ä¸º 1ã€‚ã€elementData[size++] &#x3D; e;  ã€‘</li></ul></li><li>å½“ add ç¬¬ 11 ä¸ªå…ƒç´ è¿›å…¥ grow æ–¹æ³•æ—¶ï¼Œ<ul><li>newCapacity ä¸º 15ï¼Œæ¯” minCapacityï¼ˆä¸º 11ï¼‰å¤§ï¼Œç¬¬ä¸€ä¸ª if åˆ¤æ–­ä¸æˆç«‹ã€‚</li><li>æ–°å®¹é‡æ²¡æœ‰å¤§äºæ•°ç»„æœ€å¤§ sizeï¼Œä¸ä¼šè¿›å…¥ hugeCapacity æ–¹æ³•ã€‚æ•°ç»„å®¹é‡æ‰©ä¸º 15ï¼Œ</li><li>add æ–¹æ³•ä¸­ return true,  size å¢ä¸º 11ã€‚</li></ul></li><li>ä»¥æ­¤ç±»æ¨Â·Â·Â·Â·Â·Â·</li></ul><h4 id="hugeCapacity-æ–¹æ³•"><a href="#hugeCapacity-æ–¹æ³•" class="headerlink" title="hugeCapacity() æ–¹æ³•"></a><code>hugeCapacity()</code> æ–¹æ³•</h4><p>å¦‚æœæ–°å®¹é‡å¤§äº MAX_ARRAY_SIZE,è¿›å…¥(æ‰§è¡Œ) <code>hugeCapacity()</code> æ–¹æ³•</p><p>å¦‚æœ minCapacity å¤§äºæœ€å¤§å®¹é‡ï¼Œåˆ™æ–°å®¹é‡åˆ™ä¸º<code>Integer.MAX_VALUE</code>ï¼Œå¦åˆ™ï¼Œæ–°å®¹é‡å¤§å°åˆ™ä¸º MAX_ARRAY_SIZE å³ä¸º <code>Integer.MAX_VALUE - 8</code>ã€‚</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">hugeCapacity</span><span class="hljs-params">(<span class="hljs-type">int</span> minCapacity)</span> </span>&#123;  <br>    <span class="hljs-keyword">if</span> (minCapacity &lt; <span class="hljs-number">0</span>) <span class="hljs-comment">// overflow  </span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">OutOfMemoryError</span>();  <br><span class="hljs-comment">//å¯¹minCapacityå’ŒMAX_ARRAY_SIZEè¿›è¡Œæ¯”è¾ƒ</span><br><span class="hljs-comment">//è‹¥minCapacityå¤§ï¼Œå°†Integer.MAX_VALUEä½œä¸ºæ–°æ•°ç»„çš„å¤§å°</span><br><span class="hljs-comment">//è‹¥MAX_ARRAY_SIZEå¤§ï¼Œå°†MAX_ARRAY_SIZEä½œä¸ºæ–°æ•°ç»„çš„å¤§å°</span><br><span class="hljs-comment">//MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;</span><br>    <span class="hljs-keyword">return</span> (minCapacity &gt; MAX_ARRAY_SIZE) ?  <br>        Integer.MAX_VALUE :  <br>        MAX_ARRAY_SIZE;  <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å°ç»“-â˜…â˜…"><a href="#å°ç»“-â˜…â˜…" class="headerlink" title="å°ç»“  â˜…â˜…"></a>å°ç»“  â˜…â˜…</h4><p>æµç¨‹å›¾è¾“å‡ºï¼š</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311151356624.png" alt="image.png"></p><p>é€šè¿‡é¢è¯•é¢˜çš„æ–¹å¼æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼š</p><blockquote><p>è®²ä¸€ä¸‹ ArrayList çš„æ‰©å®¹æœºåˆ¶ã€‚</p></blockquote><p>ArrayList çš„é»˜è®¤åˆå§‹å®¹é‡æ˜¯10ï¼Œå®¹é‡ä¸è¶³æ—¶ï¼Œä¼šæ‰©å®¹åˆ°åŸæ¥çš„ 1.5 å€ã€‚</p><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/20240208120458.png" alt="image.png"></p><h3 id="è®°å½•-Records"><a href="#è®°å½•-Records" class="headerlink" title="è®°å½• Records"></a>è®°å½• Records</h3><h4 id="å…³äº-oldCapacity-oldCapacity-1-çš„è¯´æ˜ï¼š"><a href="#å…³äº-oldCapacity-oldCapacity-1-çš„è¯´æ˜ï¼š" class="headerlink" title="å…³äº oldCapacity + (oldCapacity &gt;&gt; 1) çš„è¯´æ˜ï¼š"></a>å…³äº oldCapacity + (oldCapacity &gt;&gt; 1) çš„è¯´æ˜ï¼š</h4><p><strong>int newCapacity &#x3D; oldCapacity + (oldCapacity &gt;&gt; 1),æ‰€ä»¥ ArrayList æ¯æ¬¡æ‰©å®¹ä¹‹åå®¹é‡éƒ½ä¼šå˜ä¸ºåŸæ¥çš„ 1.5 å€å·¦å³ï¼ˆoldCapacity ä¸ºå¶æ•°å°±æ˜¯ 1.5 å€ï¼Œå¦åˆ™æ˜¯ 1.5 å€å·¦å³ï¼‰ï¼</strong> å¥‡å¶ä¸åŒï¼Œæ¯”å¦‚ï¼š10+10&#x2F;2 &#x3D; 15, 33+33&#x2F;2&#x3D;49ã€‚å¦‚æœæ˜¯å¥‡æ•°çš„è¯ä¼šä¸¢æ‰å°æ•°.</p><blockquote><p>â€œ&gt;&gt;â€ï¼ˆç§»ä½è¿ç®—ç¬¦ï¼‰ï¼š&gt;&gt;1 å³ç§»ä¸€ä½ç›¸å½“äºé™¤ 2ï¼Œå³ç§» n ä½ç›¸å½“äºé™¤ä»¥ 2 çš„ n æ¬¡æ–¹ã€‚è¿™é‡Œ oldCapacity æ˜æ˜¾å³ç§»äº† 1 ä½æ‰€ä»¥ç›¸å½“äº oldCapacity &#x2F;2ã€‚å¯¹äºå¤§æ•°æ®çš„ 2 è¿›åˆ¶è¿ç®—,ä½ç§»è¿ç®—ç¬¦æ¯”é‚£äº›æ™®é€šè¿ç®—ç¬¦çš„è¿ç®—è¦å¿«å¾ˆå¤š,å› ä¸ºç¨‹åºä»…ä»…ç§»åŠ¨ä¸€ä¸‹è€Œå·²,ä¸å»è®¡ç®—,è¿™æ ·æé«˜äº†æ•ˆç‡,èŠ‚çœäº†èµ„æº</p></blockquote><h4 id="å…³äº-Arrays-copyOf-æ–¹æ³•"><a href="#å…³äº-Arrays-copyOf-æ–¹æ³•" class="headerlink" title="å…³äº Arrays.copyOf()æ–¹æ³•"></a>å…³äº <code>Arrays.copyOf()</code>æ–¹æ³•</h4><p>æºç ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T,U&gt; T[] copyOf(U[] original, int <span class="hljs-keyword">new</span><span class="hljs-type">Length</span>, Class&lt;? extends T[]&gt; <span class="hljs-keyword">new</span><span class="hljs-type">Type</span>) &#123;  <br><span class="hljs-comment">// ç”³è¯·ä¸€ä¸ªæ–°çš„æ•°ç»„</span><br>    <span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">&quot;unchecked&quot;</span>)  <br>    T[] copy = ((Object)<span class="hljs-keyword">new</span><span class="hljs-type">Type</span> == (Object)Object[].class)  <br>        ? (T[]) <span class="hljs-keyword">new</span> <span class="hljs-type">Object</span>[<span class="hljs-keyword">new</span><span class="hljs-type">Length</span>]  <br>        : <span class="hljs-type"></span>(T[]) <span class="hljs-keyword">Array</span>.<span class="hljs-keyword">new</span><span class="hljs-type">Instance</span>(<span class="hljs-keyword">new</span><span class="hljs-type">Type</span>.getComponentType(), <span class="hljs-keyword">new</span><span class="hljs-type">Length</span>); <br>    <span class="hljs-comment">// è°ƒç”¨System.arraycopy,å°†æºæ•°ç»„ä¸­çš„æ•°æ®è¿›è¡Œæ‹·è´,å¹¶è¿”å›æ–°çš„æ•°ç»„     </span><br>    System.arraycopy(original, <span class="hljs-number">0</span>, copy, <span class="hljs-number">0</span>,  <br>                     Math.min(original.length, <span class="hljs-keyword">new</span><span class="hljs-type">Length</span>));  <br>    <span class="hljs-keyword">return</span> copy;  <br>&#125;<br></code></pre></td></tr></table></figure><p><code>System.arraycopy()</code> æ–¹æ³•</p><p>æºç ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-comment">// arraycopy æ˜¯ä¸€ä¸ª native æ–¹æ³•,æ¥ä¸‹æ¥è§£é‡Šä¸€ä¸‹å„ä¸ªå‚æ•°çš„å…·ä½“æ„ä¹‰</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">*   å¤åˆ¶æ•°ç»„</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> src æºæ•°ç»„</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> srcPos æºæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> dest ç›®æ ‡æ•°ç»„</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> destPos ç›®æ ‡æ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®</span><br><span class="hljs-comment">* <span class="hljs-doctag">@param</span> length è¦å¤åˆ¶çš„æ•°ç»„å…ƒç´ çš„æ•°é‡</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">arraycopy</span><span class="hljs-params">(Object src,  <span class="hljs-keyword">int</span>  srcPos,</span></span><br><span class="hljs-params"><span class="hljs-function">                                    Object dest, <span class="hljs-keyword">int</span> destPos,</span></span><br><span class="hljs-params"><span class="hljs-function">                                    <span class="hljs-keyword">int</span> length)</span></span>;<br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒï¼š</p><ul><li><a href="https://javaguide.cn/java/collection/arraylist-source-code.html">https://javaguide.cn/java/collection/arraylist-source-code.html</a></li><li><a href="https://blog.csdn.net/czxlylc/article/details/106892156">https://blog.csdn.net/czxlylc/article/details/106892156</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>é›†åˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>é›†åˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaé›†åˆ_åŸºç¡€æ¦‚å¿µ_è¡¥å……å†…å®¹02</title>
    <link href="/2023/11/14/Java%E9%9B%86%E5%90%88_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5_%E8%A1%A5%E5%85%85%E5%86%85%E5%AE%B902/"/>
    <url>/2023/11/14/Java%E9%9B%86%E5%90%88_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5_%E8%A1%A5%E5%85%85%E5%86%85%E5%AE%B902/</url>
    
    <content type="html"><![CDATA[<h4 id="1ã€Seté›†åˆæ˜¯å¦‚ä½•ä¿è¯å¯¹è±¡ä¸é‡å¤çš„ï¼Ÿ"><a href="#1ã€Seté›†åˆæ˜¯å¦‚ä½•ä¿è¯å¯¹è±¡ä¸é‡å¤çš„ï¼Ÿ" class="headerlink" title="1ã€Seté›†åˆæ˜¯å¦‚ä½•ä¿è¯å¯¹è±¡ä¸é‡å¤çš„ï¼Ÿ"></a>1ã€Seté›†åˆæ˜¯å¦‚ä½•ä¿è¯å¯¹è±¡ä¸é‡å¤çš„ï¼Ÿ</h4><p>HashSet çš„åº•å±‚é‡‡ç”¨HashMapæ¥å­˜æ”¾æ•°æ®,  ä»–æ‰§è¡Œæ·»åŠ å…ƒç´ æ“ä½œçš„æ—¶å€™æ˜¯å°†å…ƒç´ ä½œä¸º Map çš„Keyï¼›</p><p>HashMapä¿è¯keyçš„ä¸é‡å¤æ€§ï¼Œå¯¹äºé‡å¤çš„keyï¼ŒHashMapä¼šæ ¹æ®å‚æ•°onlyIfAbsentçš„è®¾ç½®å’ŒåŸvalueæ˜¯å¦ä¸ºç©ºä¸¤ä¸ªæ¡ä»¶æ¥<strong>åˆ¤æ–­æ˜¯å¦æ›¿æ¢æ–°value</strong>ï¼Œ</p><p>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºHashSetï¼Œè¿™ä¸ªvalueåªæ˜¯ä¸ªç©ºçš„Objectç±»çš„å¯¹è±¡ï¼Œæ²¡æœ‰ä»»ä½•å®é™…ä½œç”¨ï¼ŒHashSetä¸­çš„å…ƒç´ å®é™…ä¸Šæ˜¯å­˜å‚¨åœ¨keyä¸Šçš„ã€‚é’ˆå¯¹é‡å¤çš„keyï¼Œ<strong>HashMapåªæœ‰å¯¹äºvalueçš„å¤„ç†ï¼Œå¹¶ä¸ä¼šæ›¿æ¢key</strong>ï¼Œå› æ­¤åœ¨HashSetä¸­åŠ å…¥ç›¸åŒå…ƒç´ ä¸ä¼šè¦†ç›–ã€‚</p><p>æºç ç›¸å…³å†…å®¹ï¼š</p><p>HashSet çš„æ·»åŠ æ–¹æ³•</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-built_in">add</span>(E e) &#123;  <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">map</span>.<span class="hljs-property">put</span>(e, PRESENT)==<span class="hljs-literal">null</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><p>hashmap çš„ put æ–¹æ³•</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span>(K <span class="hljs-built_in">key</span>, V value) &#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">key</span> == <span class="hljs-literal">null</span>)<br>          <span class="hljs-keyword">return</span> <span class="hljs-title function_">putForNullKey</span>(value);<br>      <span class="hljs-type">int</span> hash = <span class="hljs-title function_">hash</span>(<span class="hljs-built_in">key</span>.<span class="hljs-property">hashCode</span>());<span class="hljs-comment">//----------1----------</span><br>      <span class="hljs-type">int</span> i = <span class="hljs-title function_">indexFor</span>(hash, table.<span class="hljs-property">length</span>);<span class="hljs-comment">//-----------2---------</span><br>      <span class="hljs-keyword">for</span> (Entry e = table[i]; e != <span class="hljs-literal">null</span>; e = e.<span class="hljs-property">next</span>) &#123;<span class="hljs-comment">//-----------3---------</span><br>          <span class="hljs-built_in">Object</span> k;<br>          <span class="hljs-keyword">if</span> (e.<span class="hljs-property">hash</span> == hash &amp;&amp; ((k = e.<span class="hljs-property">key</span>) == <span class="hljs-built_in">key</span> || <span class="hljs-built_in">key</span>.<span class="hljs-property">equals</span>(k))) &#123;<br>              V oldValue = e.<span class="hljs-property">value</span>;<br>              e.<span class="hljs-property">value</span> = value;<br>              e.<span class="hljs-property">recordAccess</span>(<span class="hljs-variable">this</span>);<br>              <span class="hljs-keyword">return</span> oldValue;<br>          &#125;<br>      &#125;<span class="hljs-comment">//------------------4--------------------</span><br>      modCount++;<br>      <span class="hljs-title function_">addEntry</span>(hash, <span class="hljs-built_in">key</span>, value, i);<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>  &#125;<br></code></pre></td></tr></table></figure><p>å½“å‘HashMapä¸­æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œ</p><ul><li><strong>é¦–å…ˆè®¡ç®—å…ƒç´ çš„hashcodeå€¼</strong>ï¼Œç„¶åæ ¹æ®1å¤„çš„ä»£ç è®¡ç®—å‡ºHashcodeçš„å€¼ï¼Œ</li><li>å†æ ¹æ®2å¤„çš„ä»£ç è®¡ç®—å‡ºè¿™ä¸ªå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼Œ<ul><li>å¦‚æœ<strong>è¿™ä¸ªä½ç½®ä¸ºç©ºï¼Œå°±å°†å…ƒç´ æ·»åŠ è¿›å»</strong>ï¼›</li><li>å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™çœ‹3-4çš„ä»£ç ï¼Œéå†ç´¢å¼•ä¸ºiçš„é“¾ä¸Šçš„å…ƒç´ ï¼Œ<strong>å¦‚æœkeyé‡å¤ï¼Œåˆ™æ›¿æ¢å¹¶è¿”å›oldValueå€¼ã€‚</strong></li></ul></li></ul><p><strong>æ€»ç»“</strong>ï¼šç»“æœå‘HashSetä¸­åŠ å…¥ç›¸åŒå…ƒç´ ä¸ä¼šè¿›è¡Œè¦†ç›–ã€‚å› ä¸ºHashSetåº•å±‚ä½¿ç”¨HashMapå®ç°ï¼Œå…ƒç´ å­˜åœ¨HashMapçš„keyä¸­ã€‚åœ¨HashMapä¸­ï¼Œå¤šæ¬¡putç›¸åŒçš„keyï¼Œåªä¼šè¦†ç›–valueï¼Œè€Œä¸å­˜åœ¨keyçš„æƒ…å†µã€‚</p><h4 id="2ã€ä½¿ç”¨forå¾ªç¯åˆ é™¤å…ƒç´ é™·é˜±"><a href="#2ã€ä½¿ç”¨forå¾ªç¯åˆ é™¤å…ƒç´ é™·é˜±" class="headerlink" title="2ã€ä½¿ç”¨forå¾ªç¯åˆ é™¤å…ƒç´ é™·é˜±"></a>2ã€ä½¿ç”¨forå¾ªç¯åˆ é™¤å…ƒç´ é™·é˜±</h4><p>å…ˆæ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªç¨‹åºï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> &#123;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>List&lt;String&gt; list = <span class="hljs-keyword">new</span> LinkedList&lt;String&gt;();<br>list.<span class="hljs-keyword">add</span>(<span class="hljs-string">&quot;A&quot;</span>);<br>list.<span class="hljs-keyword">add</span>(<span class="hljs-string">&quot;B&quot;</span>);<br>list.<span class="hljs-keyword">add</span>(<span class="hljs-string">&quot;C&quot;</span>);<br><br><span class="hljs-keyword">for</span>(<span class="hljs-built_in">int</span> i=<span class="hljs-number">0</span>; i&lt;list.size(); i++)&#123;<br>list.<span class="hljs-keyword">remove</span>(i);<br>&#125;<br><br><span class="hljs-keyword">for</span>(String item:list)&#123;<br>System.<span class="hljs-keyword">out</span>.println(item);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥å…ˆçŒœçŒœè¿™ä¸ªç¨‹åºè¾“å‡ºä»€ä¹ˆï¼Ÿ</p><p>æŒ‰æˆ‘ä»¬çš„æ€è·¯ï¼Œåº”è¯¥æ˜¯è¾“ä¸å‡ºä»€ä¹ˆï¼Œ<strong>ä½†æ˜¯æ‰§è¡Œå®ƒï¼Œè¾“å‡ºçš„å´æ˜¯ï¼šB</strong>ã€‚</p><p>åˆ†æä¸‹è¿™ä¸ªç¨‹åºï¼Œå½“ç¬¬ä¸€æ­¥removeå®Œåï¼Œé›†åˆå†…è¿˜å‰©2ä¸ªå…ƒç´ ï¼Œæ­¤æ—¶iä¸º1ï¼Œè€Œlist.size()çš„å€¼ä¸º2ï¼Œä»0å¼€å§‹çš„è¯ï¼Œiä¸º1æ—¶ï¼Œæ­£å¥½æŒ‡å‘ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è¯´å½“removeå®ŒAåï¼Œç›´æ¥å°±è·³åˆ°Cï¼Œå°†Bæ¼äº†ã€‚</p><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> &#123;<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>List&lt;String&gt; list = <span class="hljs-keyword">new</span> LinkedList&lt;String&gt;();<br>list.<span class="hljs-keyword">add</span>(<span class="hljs-string">&quot;A&quot;</span>);<br>list.<span class="hljs-keyword">add</span>(<span class="hljs-string">&quot;B&quot;</span>);<br>list.<span class="hljs-keyword">add</span>(<span class="hljs-string">&quot;C&quot;</span>);<br><br><span class="hljs-keyword">for</span>(<span class="hljs-built_in">int</span> i=<span class="hljs-number">0</span>; i&lt;list.size(); i++)&#123;<br>list.<span class="hljs-keyword">remove</span>(i);<br>i -= <span class="hljs-number">1</span>;<span class="hljs-comment">//æ¯æ¬¡åˆ é™¤å®Œåï¼Œiå‡å°‘1</span><br>&#125;<br><br><span class="hljs-keyword">for</span>(String item:list)&#123;<br>System.<span class="hljs-keyword">out</span>.println(item);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3ã€è®²è¿°ä¸€ä¸‹-lengthã€length-ã€size-çš„åŒºåˆ«ã€‚"><a href="#3ã€è®²è¿°ä¸€ä¸‹-lengthã€length-ã€size-çš„åŒºåˆ«ã€‚" class="headerlink" title="3ã€è®²è¿°ä¸€ä¸‹ lengthã€length()ã€size() çš„åŒºåˆ«ã€‚"></a>3ã€è®²è¿°ä¸€ä¸‹ lengthã€length()ã€size() çš„åŒºåˆ«ã€‚</h4><ul><li>java ä¸­çš„ <code>length</code>å±æ€§æ˜¯é’ˆå¯¹æ•°ç»„è¯´çš„,æ¯”å¦‚è¯´ä½ å£°æ˜äº†ä¸€ä¸ªæ•°ç»„,æƒ³çŸ¥é“è¿™ä¸ªæ•°ç»„çš„é•¿åº¦åˆ™ç”¨åˆ°äº† length è¿™ä¸ªå±æ€§.</li><li>java ä¸­çš„ <code>length()</code> æ–¹æ³•æ˜¯é’ˆå¯¹å­—ç¬¦ä¸²è¯´çš„,å¦‚æœæƒ³çœ‹è¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦åˆ™ç”¨åˆ° <code>length()</code> è¿™ä¸ªæ–¹æ³•.</li><li>java ä¸­çš„ <code>size()</code> æ–¹æ³•æ˜¯é’ˆå¯¹æ³›å‹é›†åˆè¯´çš„,å¦‚æœæƒ³çœ‹è¿™ä¸ªæ³›å‹æœ‰å¤šå°‘ä¸ªå…ƒç´ ,å°±è°ƒç”¨æ­¤æ–¹æ³•æ¥æŸ¥çœ‹!</li></ul><h4 id="4ã€åœ¨-HashMap-ä¸­ï¼Œä¸ºä»€ä¹ˆä¸ä¸€ä¸‹å­æŠŠæ•´ä¸ªé“¾è¡¨å˜ä¸ºçº¢é»‘æ ‘å‘¢"><a href="#4ã€åœ¨-HashMap-ä¸­ï¼Œä¸ºä»€ä¹ˆä¸ä¸€ä¸‹å­æŠŠæ•´ä¸ªé“¾è¡¨å˜ä¸ºçº¢é»‘æ ‘å‘¢" class="headerlink" title="4ã€åœ¨ HashMap ä¸­ï¼Œä¸ºä»€ä¹ˆä¸ä¸€ä¸‹å­æŠŠæ•´ä¸ªé“¾è¡¨å˜ä¸ºçº¢é»‘æ ‘å‘¢"></a>4ã€åœ¨ HashMap ä¸­ï¼Œä¸ºä»€ä¹ˆä¸ä¸€ä¸‹å­æŠŠæ•´ä¸ªé“¾è¡¨å˜ä¸ºçº¢é»‘æ ‘å‘¢</h4><p>ä¸ºä»€ä¹ˆéè¦ç­‰åˆ°é“¾è¡¨çš„é•¿åº¦å¤§äºç­‰äº8çš„æ—¶å€™ï¼Œæ‰è½¬å˜æˆçº¢é»‘æ ‘ï¼Ÿ</p><p>ï¼ˆ1ï¼‰æ„é€ çº¢é»‘æ ‘è¦æ¯”æ„é€ é“¾è¡¨å¤æ‚ï¼Œåœ¨é“¾è¡¨çš„èŠ‚ç‚¹ä¸å¤šçš„æ—¶å€™ï¼Œä»æ•´ä½“çš„æ€§èƒ½çœ‹æ¥ï¼Œ æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„ç»“æ„å¯èƒ½ä¸ä¸€å®šæ¯”æ•°ç»„+é“¾è¡¨çš„ç»“æ„æ€§èƒ½é«˜ã€‚å°±å¥½æ¯”æ€é¸¡ç„‰ç”¨ç‰›åˆ€çš„æ„æ€ã€‚</p><p>ï¼ˆ2ï¼‰HashMapé¢‘ç¹çš„æ‰©å®¹ï¼Œä¼šé€ æˆåº•éƒ¨çº¢é»‘æ ‘ä¸æ–­çš„è¿›è¡Œæ‹†åˆ†å’Œé‡ç»„ï¼Œè¿™æ˜¯éå¸¸è€—æ—¶çš„ã€‚å› æ­¤ï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨é•¿åº¦æ¯”è¾ƒé•¿çš„æ—¶å€™è½¬å˜æˆçº¢é»‘æ ‘æ‰ä¼š<strong>æ˜¾è‘—æé«˜æ•ˆç‡</strong>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>é›†åˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java é›†åˆ_è¿›é˜¶å†…å®¹</title>
    <link href="/2023/11/14/Java%E9%9B%86%E5%90%88_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5_%E8%A1%A5%E5%85%85%E5%86%85%E5%AE%B901/"/>
    <url>/2023/11/14/Java%E9%9B%86%E5%90%88_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5_%E8%A1%A5%E5%85%85%E5%86%85%E5%AE%B901/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹é›†åˆç›¸å…³çš„æ¦‚å¿µï¼Œå¯¹äº Java é›†åˆåŸºç¡€æ¦‚å¿µçš„ä¸€ä¸ªè¡¥å……</p><h4 id="1ã€ä»€ä¹ˆæ˜¯-fail-fastæœºåˆ¶ï¼Œè®²è¿°ä¸€ä¸‹ä»–å’Œ-fail-safe-çš„å¼‚åŒã€‚"><a href="#1ã€ä»€ä¹ˆæ˜¯-fail-fastæœºåˆ¶ï¼Œè®²è¿°ä¸€ä¸‹ä»–å’Œ-fail-safe-çš„å¼‚åŒã€‚" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯ fail-fastæœºåˆ¶ï¼Œè®²è¿°ä¸€ä¸‹ä»–å’Œ fail-safe çš„å¼‚åŒã€‚"></a>1ã€ä»€ä¹ˆæ˜¯ fail-fastæœºåˆ¶ï¼Œè®²è¿°ä¸€ä¸‹ä»–å’Œ fail-safe çš„å¼‚åŒã€‚</h4><p>é”™è¯¯æ£€æŸ¥æœºåˆ¶</p><ul><li>å¿«é€Ÿå¤±è´¥ fail-fast<ul><li>å½“æ–¹æ³•æ£€æµ‹åˆ°å¯¹è±¡çš„å¹¶å‘ä¿®æ”¹ï¼Œä½†ä¸å…è®¸è¿™ç§ä¿®æ”¹æ—¶å°±æŠ›å‡ºè¯¥å¼‚å¸¸</li></ul></li><li>fail-safe æœºåˆ¶<ul><li>fail-safe ä»»ä½•å¯¹é›†åˆç»“æ„çš„ä¿®æ”¹éƒ½ä¼šåœ¨ä¸€ä¸ªå¤åˆ¶çš„é›†åˆä¸Šè¿›è¡Œï¼Œå› æ­¤ä¸ä¼šæŠ›å‡ºConcurrentModificationException</li></ul></li></ul><p><strong>fail-fast è§£å†³æ–¹æ³•</strong></p><ul><li>æ–¹æ¡ˆä¸€ï¼šåœ¨éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ¶‰åŠåˆ°æ”¹å˜modCount å€¼çš„åœ°æ–¹å…¨éƒ¨åŠ ä¸Šsynchronized æˆ–è€…ç›´æ¥ä½¿ç”¨ Collection  synchronizedListï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä¸æ¨èï¼Œå› ä¸ºå¢åˆ é€ æˆçš„åŒæ­¥é”å¯èƒ½ä¼šé˜»å¡éå†æ“ä½œã€‚</li><li>æ–¹æ¡ˆäºŒï¼šä½¿ç”¨CopyOnWriteArrayList æ›¿æ¢ ArrayLIstï¼Œæ¨èä½¿ç”¨è¯¥æ–¹æ¡ˆï¼ˆå³fail-safeï¼‰ã€‚</li></ul><p><strong>fail-fastå’Œ fail-safe çš„åŒºåˆ«</strong></p><table><thead><tr><th></th><th>Fail Fast Iterator</th><th>Fail Safe Iterator</th></tr></thead><tbody><tr><td>Throw ConcurrentModification Exception</td><td>Yes</td><td>No</td></tr><tr><td>Clone object</td><td>No</td><td>Yes</td></tr><tr><td>Memory Overhead</td><td>No</td><td>Yes</td></tr><tr><td>Examples</td><td>HashMap,Vector,ArrayList,HashSet</td><td>CopyOnWriteArrayList,  <br>ConcurrentHashMap</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><h4 id="2ã€é€šè¿‡å®ç°-Comparable-æˆ–è€…-Comparator-æ¥å£æ¥è¿›è¡Œæ’åº"><a href="#2ã€é€šè¿‡å®ç°-Comparable-æˆ–è€…-Comparator-æ¥å£æ¥è¿›è¡Œæ’åº" class="headerlink" title="2ã€é€šè¿‡å®ç° Comparable æˆ–è€… Comparator æ¥å£æ¥è¿›è¡Œæ’åº"></a>2ã€é€šè¿‡å®ç° Comparable æˆ–è€… Comparator æ¥å£æ¥è¿›è¡Œæ’åº</h4><p><strong>ä¸€ç§æƒ…å†µæ˜¯é›†åˆç±»æœ¬èº«è‡ªå¸¦æ’åºåŠŸèƒ½</strong>ï¼Œå¦‚å‰é¢è¯´è¿‡çš„TreeSetã€SortedSetã€SortedMapç­‰ï¼Œ</p><p>å¦ä¸€ç§å°±æ˜¯æœ¬èº«ä¸å¸¦æ’åºåŠŸèƒ½ï¼Œæˆ‘ä»¬é€šè¿‡ä¸ºéœ€è¦æ’åºçš„ç±»å®ç° Comparable æˆ–è€… Comparator æ¥å£æ¥å®ç°ã€‚</p><p>å…ˆæ¥çœ‹ä¸¤ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ˜¯å®ç°Comparableçš„ï¼Œä¸€ä¸ªæ˜¯å®ç° Comparator çš„</p><p>ï¼ˆ1ï¼‰å®ç°Comparableçš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xtfggef.list.test;<br> <br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.Collections;<br><span class="hljs-keyword">import</span> java.util.List;<br> <br><span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComparableTest</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>    List&lt;User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();  <br>    users.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;egg&quot;</span>, <span class="hljs-number">23</span>));  <br>    users.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;niu&quot;</span>, <span class="hljs-number">22</span>));  <br>    users.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;qing&quot;</span>, <span class="hljs-number">28</span>));  <br>  <br>    Collections.sort(users);  <br>    <span class="hljs-keyword">for</span> (User user : users) &#123;  <br>        System.out.println(user.getName() + <span class="hljs-string">&quot; &quot;</span> + user.getAge());  <br>    &#125;  <br>&#125;<br>&#125;<br> <br><span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparable</span> &#123;<br><span class="hljs-keyword">private</span> String name;<br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br><span class="hljs-built_in">super</span>();<br><span class="hljs-built_in">this</span>.name = name;<br><span class="hljs-built_in">this</span>.age = age;<br>&#125;<br> <br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> name;<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> &#123;<br><span class="hljs-built_in">this</span>.name = name;<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> age;<br>&#125;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br><span class="hljs-built_in">this</span>.age = age;<br>&#125;<br> <br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Object o)</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.age - ((User) o).getAge();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰ä¸‹é¢æ˜¯å®ç°Comparatoræ¥å£çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xtfggef.comparator.test;<br> <br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Collections;<br><span class="hljs-keyword">import</span> java.util.Comparator;<br><span class="hljs-keyword">import</span> java.util.List;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComparatorTest</span> &#123;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;  <br>        List&lt;User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();  <br>        users.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;egg&quot;</span>, <span class="hljs-number">21</span>));  <br>        users.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;niu&quot;</span>, <span class="hljs-number">22</span>));  <br>        users.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;gg&quot;</span>, <span class="hljs-number">29</span>));  <br>        <span class="hljs-type">UserComparator</span> <span class="hljs-variable">comparator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserComparator</span>();  <br>        Collections.sort(users, comparator);  <br>        <span class="hljs-keyword">for</span> (User user : users) &#123;  <br>            System.out.println(user.getUsername() + <span class="hljs-string">&quot; &quot;</span> + user.getAge());  <br>        &#125;  <br>    &#125;  <br>  <br>&#125;  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;  <br>    <span class="hljs-keyword">private</span> String username;  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String username, <span class="hljs-type">int</span> age)</span> &#123;  <br>        <span class="hljs-built_in">super</span>();  <br>        <span class="hljs-built_in">this</span>.username = username;  <br>        <span class="hljs-built_in">this</span>.age = age;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> username;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.username = username;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;  <br>        <span class="hljs-keyword">return</span> age;  <br>    &#125;  <br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;  <br>        <span class="hljs-built_in">this</span>.age = age;  <br>    &#125;  <br>&#125;  <br>  <br>  <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserComparator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparator</span>&lt;User&gt; &#123;  <br>    <span class="hljs-meta">@Override</span>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(User user1, User user2)</span> &#123;  <br>        <span class="hljs-type">int</span> <span class="hljs-variable">age1</span> <span class="hljs-operator">=</span> user1.getAge();  <br>        <span class="hljs-type">int</span> <span class="hljs-variable">age2</span> <span class="hljs-operator">=</span> user2.getAge();  <br>        <span class="hljs-keyword">if</span> (age1 &lt; age2) &#123;  <br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;  <br>        &#125;  <br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ğŸ‘† ä¸Šé¢è¿™ç§ Comparator å®ç°è¿™ä¸ªæ¥å£çš„æ—¶å€™ï¼Œ ğŸ‘‰ Comparatoræ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œæ‰€ä»¥åœ¨å®ç°Comparatoræ¥å£æ—¶ï¼Œç±»çš„æ³›å‹ç±»å‹éœ€è¦æŒ‡å®šå…·ä½“ç±»å‹ï¼Œä»¥é¿å…ç±»å‹æ“¦é™¤å¸¦æ¥çš„é—®é¢˜ã€‚</p><hr><p>é€šè¿‡ä¸Šé¢çš„è¿™ä¸¤ä¸ªå°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒComparatorå’ŒComparableç”¨äºä¸åŒçš„åœºæ™¯ï¼Œå®ç°å¯¹å¯¹è±¡çš„æ¯”è¾ƒä»è€Œè¿›è¡Œæ’åºã€‚</p><p>æ€»ç»“ä¸ºï¼š</p><p><strong>ç›¸åŒç‚¹ï¼š</strong> äºŒè€…éƒ½å¯ä»¥å®ç°å¯¹è±¡çš„æ’åºï¼Œä¸è®ºç”¨ Arraysçš„æ–¹æ³•è¿˜æ˜¯ç”¨ Collectionsçš„sort()æ–¹æ³•ã€‚</p><p><strong>ä¸åŒç‚¹ï¼š</strong></p><p>ï¼ˆ1ï¼‰å®ç°Comparableæ¥å£çš„ç±»ï¼Œä¼¼ä¹æ˜¯<strong>é¢„å…ˆçŸ¥é“è¯¥ç±»å°†è¦è¿›è¡Œæ’åº</strong>ï¼Œéœ€è¦æ’åºçš„ç±»å®ç°Comparableæ¥å£ï¼Œæ˜¯ä¸€ç§â€œé™æ€ç»‘å®šæ’åºâ€ã€‚</p><p>ï¼ˆ2ï¼‰å®ç°Comparatorçš„ç±»ä¸éœ€è¦ï¼Œè®¾è®¡è€…æ— éœ€äº‹å…ˆä¸ºéœ€è¦æ’åºçš„ç±»å®ç°ä»»ä½•æ¥å£ã€‚</p><p>ï¼ˆ3ï¼‰Comparatoræ¥å£é‡Œæœ‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•compare()å’Œequals()ï¼Œ<strong>è€ŒComparableæ¥å£é‡Œåªæœ‰ä¸€ä¸ªæ–¹æ³•</strong>ï¼šcompareTo()ã€‚</p><p>ï¼ˆ4ï¼‰Comparatoræ¥å£æ— éœ€æ”¹å˜æ’åºç±»çš„å†…éƒ¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ç°ç®—æ³•å’Œæ•°æ®åˆ†ç¦»ï¼Œæ˜¯ä¸€ä¸ªè‰¯å¥½çš„è®¾è®¡ï¼Œæ˜¯ä¸€ç§â€œåŠ¨æ€ç»‘å®šæ’åºâ€ã€‚</p><p>ï¼ˆ5ï¼‰Comparatoræ¥å£å¯ä»¥ä½¿ç”¨å¤šç§æ’åºæ ‡å‡†ï¼Œæ¯”å¦‚å‡åºã€é™åºç­‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>JavaåŸºç¡€</category>
      
      <category>é›†åˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git é…ç½® SSH è¿æ¥</title>
    <link href="/2023/11/13/Git%20%E9%85%8D%E7%BD%AE%20SSH%20%E8%BF%9E%E6%8E%A5/"/>
    <url>/2023/11/13/Git%20%E9%85%8D%E7%BD%AE%20SSH%20%E8%BF%9E%E6%8E%A5/</url>
    
    <content type="html"><![CDATA[<h3 id="é…ç½®-SSH-è¿æ¥"><a href="#é…ç½®-SSH-è¿æ¥" class="headerlink" title="é…ç½® SSH è¿æ¥"></a>é…ç½® SSH è¿æ¥</h3><p>å›åˆ°Git Bashä¸­ï¼Œé…ç½®Githubè´¦æˆ·ä¿¡æ¯ï¼ˆ<code>ç”¨æˆ·å</code>â€‹å’Œ<code>é‚®ç®±</code>â€‹éƒ½æ›¿æ¢æˆä½ è‡ªå·±Githubä¸Šçš„ï¼‰ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">git config --global user.name &quot;`ç”¨æˆ·å`&quot;<br>git config --global user.email &quot;é‚®ç®±&quot;<br></code></pre></td></tr></table></figure><p>åœ¨Git Bashä¸­è¾“å…¥ï¼š<code>ssh-keygen -t rsa -C &quot;ä½ çš„Githubé‚®ç®±&quot;</code>â€‹ ç”Ÿæˆssh</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">ssh-keygen -t rsa -C &quot;é‚®ç®±&quot;<br></code></pre></td></tr></table></figure><p>ç„¶åæŒ‰Git Bashç»™å‡ºçš„è·¯å¾„<code>(C:\Users\Lete.ssh)</code>â€‹æ‰¾åˆ°<code>id_rsa.pub</code>â€‹æ–‡ä»¶ å¹¶å¤åˆ¶å…¶ä¸­çš„å†…å®¹</p><p>è¿›åˆ°æ–°å»ºçš„Githubä»“åº“ ç‚¹å‡»å³ä¸Šè§’<code>setting</code>â€‹è¿›å…¥è®¾ç½®æ‰¾åˆ°<code>Deploykeys</code>â€‹é€‰æ‹© <code>Add Deploy keys</code>â€‹ <code>Title</code>â€‹éšä¾¿å¡«å†™ <code>Key</code>â€‹çš„å†…å®¹å¡«åˆšæ‰<code>id_rsa.pub</code>â€‹æ–‡ä»¶ä¸­å¤åˆ¶çš„å†…å®¹</p><p>â€<br>ä¿®æ”¹æœ¬åœ°Gité…ç½®ï¼Œè®¾ç½®ä½¿ç”¨SSHåè®®è¿æ¥GitHubã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹æœ¬åœ°Gité…ç½®ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">git config <span class="hljs-attr">--global</span> url.&quot;git<span class="hljs-keyword">@github</span>.<span class="hljs-attribute">com</span>:<span class="hljs-string">&quot;.insteadOf &quot;</span><span class="hljs-attribute">https</span>://github.com/<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šå°†Gité…ç½®ä¸­çš„ <code>https://github.com/</code>â€‹ æ›¿æ¢ä¸º <code>git@github.com:</code>â€‹ï¼Œä»è€Œä½¿ç”¨SSHåè®®è¿æ¥GitHubã€‚</p><p>é…ç½®åå†éƒ¨ç½²æäº¤</p><h3 id="å¸¸ç”¨çš„ä¸€äº›å‘½ä»¤"><a href="#å¸¸ç”¨çš„ä¸€äº›å‘½ä»¤" class="headerlink" title="å¸¸ç”¨çš„ä¸€äº›å‘½ä»¤"></a>å¸¸ç”¨çš„ä¸€äº›å‘½ä»¤</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">æŸ¥çœ‹ç”¨æˆ·åÂ ï¼šgit config <span class="hljs-keyword">user</span>.name<br><br>æŸ¥çœ‹å¯†ç ï¼šÂ git config <span class="hljs-keyword">user</span>.<span class="hljs-keyword">password</span><br><br>æŸ¥çœ‹é‚®ç®±ï¼šgit config <span class="hljs-keyword">user</span>.email<br><br>æŸ¥çœ‹é…ç½®ä¿¡æ¯ï¼š $ git config <span class="hljs-comment">--list</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitå…¥é—¨_åŸºæœ¬æ“ä½œ</title>
    <link href="/2023/11/13/Git%E5%85%A5%E9%97%A8_%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
    <url>/2023/11/13/Git%E5%85%A5%E9%97%A8_%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<p>åŸºæœ¬çš„ä¸€äº› Git å…¥é—¨æ“ä½œè®°å½•</p><h3 id="1ã€å°†æŸä¸ªç›®å½•æ–‡ä»¶ä¸Šä¼ åˆ°-Github-æŸä¸ªä»“åº“"><a href="#1ã€å°†æŸä¸ªç›®å½•æ–‡ä»¶ä¸Šä¼ åˆ°-Github-æŸä¸ªä»“åº“" class="headerlink" title="1ã€å°†æŸä¸ªç›®å½•æ–‡ä»¶ä¸Šä¼ åˆ° Github æŸä¸ªä»“åº“"></a>1ã€å°†æŸä¸ªç›®å½•æ–‡ä»¶ä¸Šä¼ åˆ° Github æŸä¸ªä»“åº“</h3><p>è¦å°†æŸä¸ªç›®å½•æ–‡ä»¶ä¸Šä¼ åˆ°GithubæŸä¸ªä»“åº“ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs undefined"># åˆå§‹åŒ–ä»“åº“<br>git init<br># æäº¤åˆ°æœ¬åœ°gitä»“åº“ å°†æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹æ·»åŠ åˆ°gitä»“åº“<br>git add .<br># æäº¤åˆ°æœ¬åœ°gitä»“åº“,å¹¶æ·»åŠ ä¸€æ¡æäº¤ä¿¡æ¯<br>git commit -m &quot;Initial commit&quot;<br>#åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°†æœ¬åœ°gitä»“åº“ä¸Githubä¸Šçš„ä»“åº“è¿›è¡Œå…³è”<br>git remote add origin &lt;Githubä»“åº“URL&gt;<br># è¿›è¡Œæ¨é€<br>git push -u origin master<br># å¦‚æœç›®æ ‡ä»“åº“å’Œæœ¬åœ°ç›®å½•æ–‡ä»¶å†²çªï¼Œå¯ä»¥å…ˆæ‹‰å»æœ€æ–°ä»“åº“ä»£ç å†è¿›è¡Œæ¨é€<br>git pull origin master<br># æˆ–è€…ç›´æ¥å¼ºåˆ¶æ¨é€ï¼ˆä¼šç›´æ¥è¦†ç›–è¿œç¨‹ä»“åº“å†…å®¹ï¼‰ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼ºåˆ¶æ¨é€å¯èƒ½ä¼šè¦†ç›–å…¶ä»–äººæäº¤çš„ä»£ç ï¼Œå› æ­¤éœ€è¦è°¨æ…ä½¿ç”¨ã€‚<br>git push --force origin master<br></code></pre></td></tr></table></figure><p>â€</p><blockquote><p>Gitçš„å·¥ä½œæµç¨‹æ ¸å¿ƒ</p></blockquote><ul><li>0ã€<strong>å‡†å¤‡ä»“åº“</strong>ï¼šåˆ›å»ºæˆ–ä»æœåŠ¡ç«¯å…‹éš†ä¸€ä¸ªä»“åº“ã€‚</li><li>1ã€<strong>æ¬ç –</strong>ï¼šåœ¨å·¥ä½œç›®å½•ä¸­æ·»åŠ ã€ä¿®æ”¹ä»£ç ã€‚</li><li>2ã€<strong>æš‚å­˜</strong>ï¼ˆgit addï¼‰ï¼šå°†éœ€è¦è¿›è¡Œç‰ˆæœ¬ç®¡ç†çš„æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒºåŸŸã€‚</li><li>3ã€<strong>æäº¤</strong>ï¼ˆgit commitï¼‰ï¼šå°†æš‚å­˜åŒºåŸŸçš„æ–‡ä»¶æäº¤åˆ°Gitä»“åº“ã€‚</li><li>4ã€<strong>æ¨é€</strong>ï¼ˆgit pushï¼‰ï¼šå°†æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ŒåŒæ­¥ç‰ˆæœ¬åº“ã€‚</li><li>5ã€<strong>è·å–æ›´æ–°</strong>ï¼ˆfetch&#x2F;pullï¼‰ï¼šä»æœåŠ¡ç«¯æ›´æ–°åˆ°æœ¬åœ°ï¼Œè·å–ä»–äººæ¨é€çš„æ›´æ–°ï¼Œä¸ä»–äººåä½œã€å…±äº«ã€‚</li></ul><p><img src="https://obsidian-picture.oss-cn-shenzhen.aliyuncs.com/luoblog/202311250040140.png" alt="image.png"></p><ul><li><code>git commit -a</code>æŒ‡ä»¤çœç•¥äº†<code>add</code>åˆ°æš‚å­˜åŒºçš„æ­¥éª¤ï¼Œç›´æ¥æäº¤å·¥ä½œåŒºçš„ä¿®æ”¹å†…å®¹åˆ°ç‰ˆæœ¬åº“ï¼Œä¸åŒ…æ‹¬æ–°å¢çš„æ–‡ä»¶ã€‚</li><li><code>git fetch</code>ã€<code>git pull</code>Â éƒ½æ˜¯ä»è¿œç¨‹æœåŠ¡ç«¯è·å–æœ€æ–°è®°å½•ï¼ŒåŒºåˆ«æ˜¯<code>git pull</code>å¤šäº†ä¸€ä¸ªæ­¥éª¤ï¼Œå°±æ˜¯è‡ªåŠ¨åˆå¹¶æ›´æ–°å·¥ä½œåŒºã€‚</li><li><code>git checkout .</code>ã€<code>git checkout [file]</code>Â ä¼šæ¸…é™¤å·¥ä½œåŒºä¸­æœªæ·»åŠ åˆ°æš‚å­˜åŒºçš„ä¿®æ”¹ï¼Œç”¨æš‚å­˜åŒºå†…å®¹æ›¿æ¢å·¥ä½œåŒºã€‚</li><li><code>git checkout HEAD .</code>ã€Â <code>git checkout HEAD [file]</code>Â ä¼šæ¸…é™¤å·¥ä½œåŒºã€æš‚å­˜åŒºçš„ä¿®æ”¹ï¼Œç”¨HEADæŒ‡å‘çš„å½“å‰åˆ†æ”¯æœ€æ–°ç‰ˆæœ¬æ›¿æ¢æš‚å­˜åŒºã€å·¥ä½œåŒºã€‚</li><li><code>git diff</code>Â ç”¨æ¥å¯¹æ¯”ä¸åŒéƒ¨åˆ†ä¹‹é—´çš„åŒºåˆ«ï¼Œå¦‚æš‚å­˜åŒºã€å·¥ä½œåŒºï¼Œæœ€æ–°ç‰ˆæœ¬ä¸æœªæäº¤å†…å®¹ï¼Œä¸åŒç‰ˆæœ¬ä¹‹é—´ç­‰ã€‚</li><li><code>git reset</code>æ˜¯ä¸“é—¨ç”¨æ¥æ’¤é”€ä¿®æ”¹ã€å›é€€ç‰ˆæœ¬çš„æŒ‡ä»¤ï¼Œæ›¿ä»£ä¸Šé¢<code>checkout</code>çš„æ’¤é”€åŠŸèƒ½ã€‚</li></ul><hr><p>å‚è€ƒ</p><ul><li><a href="https://www.cnblogs.com/anding/p/16987769.html">https://www.cnblogs.com/anding/p/16987769.html</a></li><li><a href="https://git-scm.com/book/zh/v2/">https://git-scm.com/book/zh/v2/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>éƒ¨ç½²</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
